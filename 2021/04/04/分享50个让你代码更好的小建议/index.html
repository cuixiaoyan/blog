

<!DOCTYPE html>
<html lang="zh-CN" >



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/blog/img/favicon.png">
  <link rel="icon" type="image/png" href="https://cuixiaoyande.oss-cn-shanghai.aliyuncs.com/%E6%99%B4_1562464329327_1562474498717.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="cuixiaoyan">
  <meta name="keywords" content="">
  <title>工作四年，分享50个让你代码更好的小建议 - 崔笑颜的博客</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/blog/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/blog/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"cuixiaoyan.github.io","root":"/blog/","version":"1.8.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/blog/js/utils.js" ></script>
  <script  src="/blog/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.3.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/blog/">&nbsp;<strong>cuixiaoyan</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/wallhaven-76vmmy.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="工作四年，分享50个让你代码更好的小建议">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-04-04 10:00" pubdate>
        2021年4月4日 上午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      9.2k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      120
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">工作四年，分享50个让你代码更好的小建议</h1>
            
            <div class="markdown-body">
              <h3 id="1-仅是判断是否存在时，select-count-比-select-具体的列，更好。"><a href="#1-仅是判断是否存在时，select-count-比-select-具体的列，更好。" class="headerlink" title="1. 仅是判断是否存在时，select count 比 select 具体的列，更好。"></a>1. 仅是判断是否存在时，select count 比 select 具体的列，更好。</h3><p>我们经常遇到类似的业务场景，如，判断某个用户<code>userId</code>是否是会员。</p>
<p><strong>（反例）：</strong>  一些小伙伴会这样实现，先查从用户信息表查出用户记录，然后再去判断是否是会员:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs csharp">&lt;<span class="hljs-keyword">select</span> id=<span class="hljs-string">&quot;selectUserByUserId&quot;</span> resultMap=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;<br>     selct user_id , vip_flag <span class="hljs-keyword">from</span>  user_info <span class="hljs-keyword">where</span> user_id =<span class="hljs-meta">#&#123;userId&#125;;</span><br> &lt;/<span class="hljs-keyword">select</span>&gt;<br><br><span class="hljs-function">boolean <span class="hljs-title">isVip</span> (<span class="hljs-params">String userId</span>)</span>&#123;<br>  UserInfo userInfo = userInfoDAp.selectUserByUserId(userId);<br>  <span class="hljs-keyword">return</span> UserInfo!=<span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-string">&quot;Y&quot;</span>.<span class="hljs-keyword">equals</span>(userInfo.getVipFlag())<br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<p><strong>（正例）：</strong> 针对这种业务场景，其实更好的实现，是直接<code>select count</code>一下，如下：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">&lt;<span class="hljs-keyword">select</span> id=<span class="hljs-string">&quot;countVipUserByUserId&quot;</span> resultType=<span class="hljs-string">&quot;java.lang.Integer&quot;</span>&gt;<br>     selct <span class="hljs-built_in">count</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">from</span>  user_info <span class="hljs-keyword">where</span> user_id =#&#123;userId&#125; <span class="hljs-keyword">and</span> vip_flag =<span class="hljs-string">&#x27;Y&#x27;</span>;<br> &lt;/<span class="hljs-keyword">select</span>&gt;<br> <br> <span class="hljs-keyword">boolean</span> isVip (<span class="hljs-keyword">String</span> userId)&#123;<br>  int vipNum = userInfoDAp.countVipUserByUserId(userId);<br>  return vipNum&gt;0<br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<h3 id="2-复杂的if逻辑条件，可以调整顺序，让程序更高效"><a href="#2-复杂的if逻辑条件，可以调整顺序，让程序更高效" class="headerlink" title="2. 复杂的if逻辑条件，可以调整顺序，让程序更高效"></a>2. 复杂的if逻辑条件，可以调整顺序，让程序更高效</h3><p>假设业务需求是这样：如果用户是会员，并且第一次登陆时，需要发一条通知的短信。假如没有经过思考，代码很可能直接这样写了。</p>
<figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-function"><span class="hljs-title">if</span>(<span class="hljs-variable">isUserVip</span> &amp;&amp; <span class="hljs-variable">isFirstLogin</span>)&#123;</span><br><span class="hljs-function">    <span class="hljs-title">sendMsgNotify</span>();</span><br><span class="hljs-function">&#125;</span><br><span class="hljs-function">复制代码</span><br></code></pre></td></tr></table></figure>
<p>假设总共有5个请求进来，isUserVip通过的有3个请求，isFirstLogin通过的有1个请求。 那么以上代码，isUserVip执行的次数为5次，isFirstLogin执行的次数也是3次，如下：</p>
<p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/b30c2899d10f4258bf1fc94a9ebf324c~tplv-k3u1fbpfcp-watermark.image" srcset="/blog/img/loading.gif" alt="image.png"></p>
<p>如果调整一下isUserVip和isFirstLogin的顺序呢？</p>
<figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-function"><span class="hljs-title">if</span>(<span class="hljs-variable">isFirstLogin</span> &amp;&amp; <span class="hljs-variable">isUserVip</span> )&#123;</span><br><span class="hljs-function">    <span class="hljs-title">sendMsg</span>();</span><br><span class="hljs-function">&#125;</span><br><span class="hljs-function">复制代码</span><br></code></pre></td></tr></table></figure>
<p>isFirstLogin执行的次数是5次，isUserVip执行的次数是1次，如下：</p>
<p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/103a20c642e04ea899d74c4cb8187b28~tplv-k3u1fbpfcp-watermark.image" srcset="/blog/img/loading.gif" alt="image.png"></p>
<p>如果你的isFirstLogin，判断逻辑只是select count 一下数据库表，isUserVip也是select count 一下数据库表的话，显然，把isFirstLogin放在前面更高效。</p>
<h3 id="3-写查询Sql的时候，只查你需要用到的字段，还有通用的字段，拒绝反手的select"><a href="#3-写查询Sql的时候，只查你需要用到的字段，还有通用的字段，拒绝反手的select" class="headerlink" title="3. 写查询Sql的时候，只查你需要用到的字段，还有通用的字段，拒绝反手的select *"></a>3. 写查询Sql的时候，只查你需要用到的字段，还有通用的字段，拒绝反手的select *</h3><p><strong>反例：</strong></p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs axapta"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> user_info <span class="hljs-keyword">where</span> user_id =<span class="hljs-meta">#&#123;userId&#125;;</span><br>复制代码<br></code></pre></td></tr></table></figure>
<p><strong>正例：</strong></p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript"> selct user_id , vip_flag <span class="hljs-keyword">from</span>  user_info <span class="hljs-keyword">where</span> user_id =<span class="hljs-comment">#&#123;userId&#125;;</span><br>复制代码<br></code></pre></td></tr></table></figure>
<p><strong>理由：</strong></p>
<ul>
<li>节省资源、减少网络开销。</li>
<li>可能用到覆盖索引，减少回表，提高查询效率。</li>
</ul>
<h3 id="4-优化你的程序，拒绝创建不必要的对象"><a href="#4-优化你的程序，拒绝创建不必要的对象" class="headerlink" title="4. 优化你的程序，拒绝创建不必要的对象"></a>4. 优化你的程序，拒绝创建不必要的对象</h3><p>如果你的变量，后面的逻辑判断，一定会被赋值；或者说，只是一个字符串变量，直接初始化字符串常量就可以了，没有必要愣是要new String().</p>
<p>反例：</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">String</span> s = <span class="hljs-keyword">new</span> <span class="hljs-keyword">String</span> (<span class="hljs-string">&quot;欢迎关注公众号：捡田螺的小男孩&quot;</span>);<br>复制代码<br></code></pre></td></tr></table></figure>
<p>正例：</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs 1c">String s=  <span class="hljs-string">&quot;欢迎关注公众号：捡田螺的小男孩 ”;</span><br>复制代码<br></code></pre></td></tr></table></figure>
<h3 id="5-初始化集合时，指定容量"><a href="#5-初始化集合时，指定容量" class="headerlink" title="5. 初始化集合时，指定容量"></a>5. 初始化集合时，指定容量</h3><p>阿里的开发手册，也明确提到这个点： </p>
<p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/image-20210404075408639.png" srcset="/blog/img/loading.gif" alt="image-20210404075408639"></p>
<p>假设你的map要存储的元素个数是15个左右，最优写法如下</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs lasso"> <span class="hljs-comment">//initialCapacity = 15/0.75+1=21</span><br> <span class="hljs-built_in">Map</span> <span class="hljs-built_in">map</span> = <span class="hljs-literal">new</span> HashMap(<span class="hljs-number">21</span>);<br> 又因为hashMap的容量跟<span class="hljs-number">2</span>的幂有关，所以可以取<span class="hljs-number">32</span>的容量<br> <span class="hljs-built_in">Map</span> <span class="hljs-built_in">map</span> = <span class="hljs-literal">new</span> HashMap(<span class="hljs-number">32</span>);<br>复制代码<br></code></pre></td></tr></table></figure>
<h3 id="6-catch了异常，需要打印出具体的exception，方便更好定位问题"><a href="#6-catch了异常，需要打印出具体的exception，方便更好定位问题" class="headerlink" title="6.catch了异常，需要打印出具体的exception，方便更好定位问题"></a>6.catch了异常，需要打印出具体的exception，方便更好定位问题</h3><p><strong>反例：</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">try</span>&#123;<br>  <span class="hljs-comment">// do something</span><br>&#125;<span class="hljs-keyword">catch</span>(Exception e)&#123;<br>  <span class="hljs-built_in">log</span>.info(<span class="hljs-string">&quot;捡田螺的小男孩，你的程序有异常啦&quot;</span>);<br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<p><strong>正例：</strong></p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">try</span>&#123;<br>  <span class="hljs-comment">// do something</span><br>&#125;<span class="hljs-keyword">catch</span>(Exception e)&#123;<br>  <span class="hljs-built_in">log</span>.info(<span class="hljs-string">&quot;捡田螺的小男孩，你的程序有异常啦：&quot;</span>,e); <span class="hljs-comment">//把exception打印出来</span><br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<p><strong>理由：</strong></p>
<ul>
<li>反例中，并没有把exception出来，到时候排查问题就不好查了啦，到底是SQl写错的异常还是IO异常，还是其他呢？所以应该把exception打印到日志中哦~</li>
</ul>
<h3 id="7-打印日志的时候，对象没有覆盖Object的toString的方法，直接把类名打印出来了。"><a href="#7-打印日志的时候，对象没有覆盖Object的toString的方法，直接把类名打印出来了。" class="headerlink" title="7. 打印日志的时候，对象没有覆盖Object的toString的方法，直接把类名打印出来了。"></a>7. 打印日志的时候，对象没有覆盖Object的toString的方法，直接把类名打印出来了。</h3><p>我们在打印日志的时候，经常想看下一个请求参数对象request是什么。于是很容易有类似以下这些代码：</p>
<figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs vbscript">publick <span class="hljs-built_in">Response</span> dealWithRequest(<span class="hljs-built_in">Request</span> <span class="hljs-built_in">request</span>)&#123;<br>   log.info(<span class="hljs-string">&quot;请求参数是：&quot;</span>.<span class="hljs-built_in">request</span>.toString)<br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<p>打印结果如下：</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs autoit">请求参数是：<span class="hljs-keyword">local</span>.Request<span class="hljs-symbol">@49476842</span><br>复制代码<br></code></pre></td></tr></table></figure>
<p>这是因为对象的toString方法，默认的实现是“类名@散列码的无符号十六进制”。所以你看吧，这样子打印日志就没啥意思啦，你都不知道打印的是什么内容。</p>
<p>所以一般对象(尤其作为传参的对象），<strong>都覆盖重写toString()方法</strong>：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Request</span> </span>&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">String</span> age;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">String</span> name;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">String</span> <span class="hljs-function"><span class="hljs-title">toString</span>(<span class="hljs-params"></span>)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Request&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;age=&#x27;&quot;</span> + age + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br>&#125;<br><br>publick Response <span class="hljs-function"><span class="hljs-title">dealWithRequest</span>(<span class="hljs-params">Request request</span>)</span>&#123;<br>   log.info(<span class="hljs-string">&quot;请求参数是：&quot;</span>.request.toString)<br>&#125;<br><br><br>复制代码<br></code></pre></td></tr></table></figure>
<p>打印结果如下：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">请求参数是：Request&#123;<span class="hljs-attribute">age</span>=<span class="hljs-string">&#x27;26&#x27;</span>, <span class="hljs-attribute">name</span>=<span class="hljs-string">&#x27;公众号：捡田螺的小男孩&#x27;</span>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<h3 id="8-一个方法，拒绝过长的参数列表。"><a href="#8-一个方法，拒绝过长的参数列表。" class="headerlink" title="8. 一个方法，拒绝过长的参数列表。"></a>8. 一个方法，拒绝过长的参数列表。</h3><p>假设有这么一个公有方法，形参有四个。。。</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> getUserInfo（<span class="hljs-keyword">String</span> name,<span class="hljs-keyword">String</span> age,<span class="hljs-keyword">String</span> sex,<span class="hljs-keyword">String</span> mobile)&#123;<br>  <span class="hljs-comment">// do something ...</span><br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<p>如果现在需要多传一个version参数进来，并且你的公有方法是类似dubbo这种对外提供的接口的话，那么你的接口是不是需要兼容老版本啦？</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> getUserInfo（<span class="hljs-keyword">String</span> name,<span class="hljs-keyword">String</span> age,<span class="hljs-keyword">String</span> sex,<span class="hljs-keyword">String</span> mobile)&#123;<br>  <span class="hljs-comment">// do something ...</span><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 新接口调这里</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> getNewUserInfo（<span class="hljs-keyword">String</span> name,<span class="hljs-keyword">String</span> age,<span class="hljs-keyword">String</span> sex,<span class="hljs-keyword">String</span> mobile，<span class="hljs-keyword">String</span> version)&#123;<br>  <span class="hljs-comment">// do something ...</span><br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<p>所以呢，一般一个方法的参数，一般不宜过长。过长的参数列表，不仅看起来不优雅，并且接口升级时，可能还要考虑新老版本兼容。如果参数实在是多怎么办呢？可以用个DTO对象包装一下这些参数呢~如下：</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> getUserInfo（UserInfoParamDTO userInfoParamDTO)&#123;<br>  <span class="hljs-comment">// do something ...</span><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserInfoParamDTO</span>&#123;</span><br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">String</span> name;<br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">String</span> age; <br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">String</span> sex;<br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">String</span> mobile;<br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<p>用个DTO对象包装一下，即使后面有参数变动，也可以不用动对外接口了，好处杠杠的。</p>
<h3 id="9-使用缓冲流，减少IO操作"><a href="#9-使用缓冲流，减少IO操作" class="headerlink" title="9. 使用缓冲流，减少IO操作"></a>9. 使用缓冲流，减少IO操作</h3><p><strong>反例：</strong></p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  公众号：捡田螺的小男孩</span><br><span class="hljs-comment"> *  @desc: 复制一张图片文件</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainTest</span> &#123;</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">String</span>[] args)</span> throws FileNotFoundException </span>&#123;<br>        <span class="hljs-keyword">long</span> <span class="hljs-built_in">begin</span> = System.currentTimeMillis();<br>        <span class="hljs-keyword">try</span> (FileInputStream input = <span class="hljs-keyword">new</span> FileInputStream(<span class="hljs-string">&quot;C:/456.png&quot;</span>);<br>             FileOutputStream output = <span class="hljs-keyword">new</span> FileOutputStream(<span class="hljs-string">&quot;C:/789.png&quot;</span>)) &#123;<br>            <span class="hljs-keyword">byte</span>[] bytes = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">1024</span>];<br>            <span class="hljs-keyword">int</span> i;<br>            <span class="hljs-keyword">while</span> ((i = input.<span class="hljs-built_in">read</span>(bytes)) != <span class="hljs-number">-1</span>) &#123;<br>                output.<span class="hljs-built_in">write</span>(bytes,<span class="hljs-number">0</span>,i);<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            <span class="hljs-built_in">log</span>.error(<span class="hljs-string">&quot;复制文件发生异常&quot;</span>,e);<br>        &#125;<br>        <span class="hljs-built_in">log</span>.info(<span class="hljs-string">&quot;常规流读写，总共耗时ms：&quot;</span>+(System.currentTimeMillis() - <span class="hljs-built_in">begin</span>));<br>    &#125;<br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css">常规流读写，总共耗时<span class="hljs-selector-tag">ms</span><span class="hljs-selector-pseudo">:52</span><br>复制代码<br></code></pre></td></tr></table></figure>
<p>使用<code>FileInputStream</code>、<code>FileOutputStream</code>实现文件读写功能，是没有什么问题的。但是呢，可以使用缓冲流<code>BufferedReader</code>、<code>BufferedWriter</code>、<code>BufferedInputStream</code>、<code>BufferedOutputStream</code>等，减少IO次数，提高读写效率。</p>
<blockquote>
<p>如果是不带缓冲的流，读取到一个字节或者字符的，就会直接输出数据了。而带缓冲的流，读取到一个字节或者字符时，先不输出，而是等达到缓冲区的最大容量，才一次性输出。</p>
</blockquote>
<p><strong>正例：</strong></p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  公众号：捡田螺的小男孩</span><br><span class="hljs-comment"> *  @desc: 复制一张图片文件</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainTest</span> &#123;</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">String</span>[] args)</span> throws FileNotFoundException </span>&#123;<br>        <span class="hljs-keyword">long</span> <span class="hljs-built_in">begin</span> = System.currentTimeMillis();<br>        <span class="hljs-keyword">try</span> (BufferedInputStream bufferedInputStream = <span class="hljs-keyword">new</span> BufferedInputStream(<span class="hljs-keyword">new</span> FileInputStream(<span class="hljs-string">&quot;C:/456.png&quot;</span>));<br>        BufferedOutputStream  bufferedOutputStream = <span class="hljs-keyword">new</span> BufferedOutputStream(<span class="hljs-keyword">new</span> FileOutputStream(<span class="hljs-string">&quot;C:/789.png&quot;</span>))) &#123;<br>            <span class="hljs-keyword">byte</span>[] bytes = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">1024</span>];<br>            <span class="hljs-keyword">int</span> i;<br>            <span class="hljs-keyword">while</span> ((i = input.<span class="hljs-built_in">read</span>(bytes)) != <span class="hljs-number">-1</span>) &#123;<br>                output.<span class="hljs-built_in">write</span>(bytes,<span class="hljs-number">0</span>,i);<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            <span class="hljs-built_in">log</span>.error(<span class="hljs-string">&quot;复制文件发生异常&quot;</span>,e);<br>        &#125;<br>        <span class="hljs-built_in">log</span>.info(<span class="hljs-string">&quot;总共耗时ms&quot;</span>+(System.currentTimeMillis() - <span class="hljs-built_in">begin</span>));<br>    &#125;<br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css">缓冲流读写，总共耗时<span class="hljs-selector-tag">ms</span><span class="hljs-selector-pseudo">:12</span><br>复制代码<br></code></pre></td></tr></table></figure>
<h3 id="10-优化你的程序逻辑，比如前面已经查到的数据，在后面的方法也用到的话，是可以把往下传参的，减少方法调用-查表"><a href="#10-优化你的程序逻辑，比如前面已经查到的数据，在后面的方法也用到的话，是可以把往下传参的，减少方法调用-查表" class="headerlink" title="10. 优化你的程序逻辑，比如前面已经查到的数据，在后面的方法也用到的话，是可以把往下传参的，减少方法调用/查表"></a>10. 优化你的程序逻辑，比如前面已经查到的数据，在后面的方法也用到的话，是可以把往下传参的，减少方法调用/查表</h3><p><strong>反例：</strong></p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">public Response deal<span class="hljs-constructor">Request(Request <span class="hljs-params">request</span>)</span>&#123;<br>    <br>    UserInfo userInfo = userInfoDao.select<span class="hljs-constructor">UserByUserId(<span class="hljs-params">request</span>.<span class="hljs-params">getUserId</span>)</span>;<br>     <span class="hljs-keyword">if</span>(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Objects</span>.</span></span>is<span class="hljs-constructor">Null(<span class="hljs-params">request</span>)</span>)&#123;<br>       return ;<br>     &#125;<br>   <br>    insert<span class="hljs-constructor">UserVip(<span class="hljs-params">request</span>.<span class="hljs-params">getUserId</span>)</span>;<br>   <br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> insertUserVip（String userId）&#123;<br>      <span class="hljs-comment">//又查了一次 </span><br>      UserInfo userInfo = userInfoDao.select<span class="hljs-constructor">UserByUserId(<span class="hljs-params">request</span>.<span class="hljs-params">getUserId</span>)</span>;<br>      <span class="hljs-comment">//插入用户vip流水</span><br>      insert<span class="hljs-constructor">UserVipFlow(<span class="hljs-params">userInfo</span>)</span>;<br>      ....<br>&#125;<br><br>复制代码<br></code></pre></td></tr></table></figure>
<p>很显然，以上程序代码，已经查到 userInfo，然后又把userId传下去，又查多了一次。。。实际上，可以把userInfo传下去的，这样可以省去一次查表操作，程序更高效。</p>
<p><strong>正例：</strong></p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">public Response deal<span class="hljs-constructor">Request(Request <span class="hljs-params">request</span>)</span>&#123;<br>    <br>    UserInfo userInfo = userInfoDao.select<span class="hljs-constructor">UserByUserId(<span class="hljs-params">request</span>.<span class="hljs-params">getUserId</span>)</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Objects</span>.</span></span>is<span class="hljs-constructor">Null(<span class="hljs-params">request</span>)</span>)&#123;<br>       return ;<br>     &#125;<br>   <br>    insert<span class="hljs-constructor">UserVip(<span class="hljs-params">userInfo</span>)</span>;<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> insertUserVip（UserInfo userInfo）&#123;<br>      <span class="hljs-comment">//插入用户vip流水</span><br>      insert<span class="hljs-constructor">UserVipFlow(<span class="hljs-params">userInfo</span>)</span>;<br>      ....<br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<h3 id="11-不要为了方便，直接在代码中使用0-1等魔法值，应该要用enum枚举代替。"><a href="#11-不要为了方便，直接在代码中使用0-1等魔法值，应该要用enum枚举代替。" class="headerlink" title="11. 不要为了方便，直接在代码中使用0,1等魔法值，应该要用enum枚举代替。"></a>11. 不要为了方便，直接在代码中使用0,1等魔法值，应该要用enum枚举代替。</h3><p><strong>反例：</strong></p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;0&quot;</span>.equals(userInfo.getVipFlag))&#123;<br>    <span class="hljs-regexp">//</span>非会员，提示去开通会员<br>    tipOpenVip(userInfo);<br>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;1&quot;</span>.equals(userInfo.getVipFlag))&#123;<br>    <span class="hljs-regexp">//</span>会员，加勋章返回<br>    addMedal（userInfo）;<br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<p><strong>正例：</strong></p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-keyword">if</span>(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">UserVipEnum</span>.</span><span class="hljs-module"><span class="hljs-identifier">NOT_VIP</span>.</span></span>getCode.equals(userInfo.getVipFlag))&#123;<br>    <span class="hljs-comment">//非会员，提示去开通会员</span><br>    tip<span class="hljs-constructor">OpenVip(<span class="hljs-params">userInfo</span>)</span>;<br>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">UserVipEnum</span>.</span><span class="hljs-module"><span class="hljs-identifier">VIP</span>.</span></span>getCode.equals(userInfo.getVipFlag))&#123;<br>    <span class="hljs-comment">//会员，加勋章返回</span><br>    addMedal（userInfo）;<br>&#125;<br><br>public enum UserVipEnum &#123;<br><br>    <span class="hljs-constructor">VIP(<span class="hljs-string">&quot;1&quot;</span>,<span class="hljs-string">&quot;会员&quot;</span>)</span>,<br>    <span class="hljs-constructor">NOT_VIP(<span class="hljs-string">&quot;0&quot;</span>,<span class="hljs-string">&quot;非会员&quot;</span>)</span>,:;<br><br>    <span class="hljs-keyword">private</span> String code; <br>    <span class="hljs-keyword">private</span> String desc;<br><br>    <span class="hljs-constructor">UserVipEnum(String <span class="hljs-params">code</span>, String <span class="hljs-params">desc</span>)</span> &#123;<br>        this.code = code;<br>        this.desc = desc;<br>    &#125;<br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<p>写代码的时候，不要一时兴起，就直接使用魔法值哈。使用魔法值，维护代码起来很难受的。</p>
<h3 id="12-当成员变量值不会改变时，优先定义为静态常量"><a href="#12-当成员变量值不会改变时，优先定义为静态常量" class="headerlink" title="12. 当成员变量值不会改变时，优先定义为静态常量"></a>12. 当成员变量值不会改变时，优先定义为静态常量</h3><p><strong>反例：</strong></p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-symbol">Task</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> long timeout = <span class="hljs-number">10</span>L;<br>    ...<br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<p><strong>正例：</strong></p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Task</span> &#123;</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> TIMEOUT = <span class="hljs-number">10L</span>;<br>    ...<br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<blockquote>
<p>因为如果定义为static，即类静态常量，在每个实例对象中，它只有一份副本。如果是成员变量，每个实例对象中，都各有一份副本。显然，如果这个变量不会变的话，定义为静态常量更好一些。</p>
</blockquote>
<h3 id="13-注意检验空指针，不要轻易相信业务，说正常逻辑某个参数不可能为空。"><a href="#13-注意检验空指针，不要轻易相信业务，说正常逻辑某个参数不可能为空。" class="headerlink" title="13. 注意检验空指针，不要轻易相信业务，说正常逻辑某个参数不可能为空。"></a>13. 注意检验空指针，不要轻易相信业务，说正常逻辑某个参数不可能为空。</h3><p>NullPointerException 在我们日常开发中非常常见，我们代码开发过程中，一定要对空指针保持灵敏的嗅觉。</p>
<p>主要有这几类空指针问题：</p>
<ul>
<li>包装类型的空指针问题</li>
<li>级联调用的空指针问题</li>
<li>Equals方法左边的空指针问题</li>
<li>ConcurrentHashMap 类似容器不支持 k-v为 null。</li>
<li>集合，数组直接获取元素</li>
<li>对象直接获取属性</li>
</ul>
<p><strong>反例：</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NullPointTest</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-function"><span class="hljs-title">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>)</span> &#123;<br>        <span class="hljs-built_in">String</span> s = <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">if</span> (s.equals(<span class="hljs-string">&quot;666&quot;</span>)) &#123; <span class="hljs-comment">//s可能为空，会导致空指针问题</span><br>            System.out.println(<span class="hljs-string">&quot;公众号：捡田螺的小男孩，干货满满&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br><br>复制代码<br></code></pre></td></tr></table></figure>
<h3 id="14，捕获到的异常，不能忽略它，至少打点日志。"><a href="#14，捕获到的异常，不能忽略它，至少打点日志。" class="headerlink" title="14，捕获到的异常，不能忽略它，至少打点日志。"></a>14，捕获到的异常，不能忽略它，至少打点日志。</h3><p><strong>反例：</strong></p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testIgnoreException</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>    <span class="hljs-keyword">try</span> &#123;       <br>        <span class="hljs-comment">// 搞事情</span><br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;    <br>        <span class="hljs-comment">//捕获了异常，啥事情不做，日志也不打？？</span><br>    &#125;<br>&#125;<br><br>复制代码<br></code></pre></td></tr></table></figure>
<p><strong>正例：</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-function"><span class="hljs-title">testIgnoreException</span>(<span class="hljs-params"></span>)</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">// 搞事情</span><br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;     <br>        log.error(<span class="hljs-string">&quot;异常了，联系开发小哥哥看看哈&quot;</span>,e); <br>    &#125;<br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<h3 id="15-采用Lambda表达式替换内部匿名类，使代码更优雅"><a href="#15-采用Lambda表达式替换内部匿名类，使代码更优雅" class="headerlink" title="15. 采用Lambda表达式替换内部匿名类，使代码更优雅"></a>15. 采用Lambda表达式替换内部匿名类，使代码更优雅</h3><p>JDK8出现了新特性-Lambda表达式。Lambda表达式不仅比匿名内部类更加优雅，并且在大多数虚拟机中，都是采用invokeDynamic指令实现，相对于匿名内部类，效率也更高</p>
<p><strong>反例：</strong></p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs aspectj">  <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sortUserInfoList</span><span class="hljs-params">(List&lt;UserInfo&gt; userInfoList)</span></span>&#123;<br>      userInfoList.sort(<span class="hljs-keyword">new</span> Comparator&lt;UserInfo&gt;() &#123;<br>          <span class="hljs-meta">@Override</span><br>          <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">compare</span><span class="hljs-params">(UserInfo user1, UserInfo user2)</span> </span>&#123;<br>              Long userId1 = user1.getUserId();<br>              Long userId2 = user2.getUserId();<br>              <span class="hljs-function"><span class="hljs-keyword">return</span> userId1.<span class="hljs-title">compareTo</span><span class="hljs-params">(userId2)</span></span>;<br>          &#125;&#125;);<br>      &#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<p><strong>正例：</strong></p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs livescript">   public <span class="hljs-literal">void</span> sortUserInfoList(List&lt;UserInfo&gt; userInfoList)&#123;<br>       userInfoList.sort<span class="hljs-function"><span class="hljs-params">((user1, user2) -&gt; &#123;</span></span><br><span class="hljs-function"><span class="hljs-params">           Long userId1 = user1.getUserId();</span></span><br><span class="hljs-function"><span class="hljs-params">           Long userId2 = user2.getUserId();</span></span><br><span class="hljs-function"><span class="hljs-params">           <span class="hljs-keyword">return</span> userId1.compareTo(userId2);</span></span><br><span class="hljs-function"><span class="hljs-params">       &#125;)</span>;</span><br><span class="hljs-function">   &#125;</span><br><span class="hljs-function">复制代码</span><br></code></pre></td></tr></table></figure>
<h3 id="16-通知类（如发邮件，有短信）的代码，建议异步处理。"><a href="#16-通知类（如发邮件，有短信）的代码，建议异步处理。" class="headerlink" title="16. 通知类（如发邮件，有短信）的代码，建议异步处理。"></a>16. 通知类（如发邮件，有短信）的代码，建议异步处理。</h3><p>假设业务流程这样：需要在用户登陆时，添加个短信通知它的粉丝。 很容易想到的实现流程如下：</p>
<p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/image-20210404075450152.png" srcset="/blog/img/loading.gif" alt="image-20210404075450152"></p>
<p>假设提供sendMsgNotify服务的系统挂了，或者调用sendMsgNotify失败了，那么用户登陆就失败了。。。 一个通知功能导致了登陆主流程不可用，明显的捡了芝麻丢西瓜。那么有没有鱼鱼熊掌兼得的方法呢？有的，给发短信接口捕获异常处理，或者另开线程异步处理，如下：</p>
<p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/image-20210404075509515.png" srcset="/blog/img/loading.gif" alt="image-20210404075509515"></p>
<p>因此，添加通知类等不是非主要，可降级的接口时，应该静下心来考虑是否会影响主要流程，思考怎么处理最好。</p>
<h3 id="17-处理Java日期时，当心YYYY格式设置的问题。"><a href="#17-处理Java日期时，当心YYYY格式设置的问题。" class="headerlink" title="17. 处理Java日期时，当心YYYY格式设置的问题。"></a>17. 处理Java日期时，当心YYYY格式设置的问题。</h3><p>日常开发中，我们经常需要处理日期。我们要当时日期格式化的时候，年份是大写<code>YYYY</code>的坑。</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">Calendar calendar = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Calendar</span>.</span></span>get<span class="hljs-constructor">Instance()</span>;<br>calendar.set(<span class="hljs-number">2019</span>, Calendar.DECEMBER, <span class="hljs-number">31</span>);<br><br>Date testDate = calendar.get<span class="hljs-constructor">Time()</span>;<br><br>SimpleDateFormat dtf = <span class="hljs-keyword">new</span> <span class="hljs-constructor">SimpleDateFormat(<span class="hljs-string">&quot;YYYY-MM-dd&quot;</span>)</span>;<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;2019-12-31 转 YYYY-MM-dd 格式后 &quot;</span> + dtf.format(testDate));<br>复制代码<br></code></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs subunit">2019<span class="hljs-string">-12</span><span class="hljs-string">-31</span> 转 YYYY-MM-dd 格式后 2020<span class="hljs-string">-12</span><span class="hljs-string">-31</span><br>复制代码<br></code></pre></td></tr></table></figure>
<blockquote>
<p>为什么明明是2019年12月31号，就转了一下格式，就变成了2020年12月31号了？因为YYYY是基于周来计算年的，它指向当天所在周属于的年份，一周从周日开始算起，周六结束，只要本周跨年，那么这一周就算下一年的了。正确姿势是使用yyyy格式。</p>
</blockquote>
<p><img src="/Users/cuixiaoyan/Library/Application%20Support/typora-user-images/image-20210404075903220.png" srcset="/blog/img/loading.gif" alt="image-20210404075903220"></p>
<h3 id="18-如果一个类确定不会被继承，不会拿来搞AOP骚操作，可以指定final修饰符，如用final修饰一个工具类。"><a href="#18-如果一个类确定不会被继承，不会拿来搞AOP骚操作，可以指定final修饰符，如用final修饰一个工具类。" class="headerlink" title="18. 如果一个类确定不会被继承，不会拿来搞AOP骚操作，可以指定final修饰符，如用final修饰一个工具类。"></a>18. 如果一个类确定不会被继承，不会拿来搞AOP骚操作，可以指定final修饰符，如用final修饰一个工具类。</h3><p><strong>正例：</strong></p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Tools</span> &#123;</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testFinal</span><span class="hljs-params">()</span></span>&#123;<br>        System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">&quot;工具类方法&quot;</span>);<br>    &#125;<br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<p>一个类指定了final修饰符，它不会被继承了，并且其所有方法都是final的了。Java编译器会找机会内联所有的final方法，提升了Java运行效率。</p>
<h3 id="19-static静态变量不要依赖spring实例化变量，可能会导致初始化出错"><a href="#19-static静态变量不要依赖spring实例化变量，可能会导致初始化出错" class="headerlink" title="19. static静态变量不要依赖spring实例化变量，可能会导致初始化出错"></a>19. static静态变量不要依赖spring实例化变量，可能会导致初始化出错</h3><p>之前看到项目有类似的代码。静态变量依赖于spring容器的bean。</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"> <span class="hljs-keyword">private</span> static SmsService smsService = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">SpringContextUtils</span>.</span></span>get<span class="hljs-constructor">Bean(SmsService.<span class="hljs-params">class</span>)</span>;<br>复制代码<br></code></pre></td></tr></table></figure>
<p>这个静态的smsService有可能获取不到的，因为类加载顺序不是确定的，而以上的代码，静态的smsService初始化强制依赖spring容器的实例了。正确的写法可以这样，如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"> <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SmsService  smsService =<span class="hljs-literal">null</span>;<br> <br> <span class="hljs-comment">//使用到的时候采取获取</span><br> <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SmsService <span class="hljs-function"><span class="hljs-title">getSmsService</span>(<span class="hljs-params"></span>)</span>&#123;<br>   <span class="hljs-keyword">if</span>(smsService==<span class="hljs-literal">null</span>)&#123;<br>      smsService = SpringContextUtils.getBean(SmsService.class);<br>   &#125;<br>   <span class="hljs-keyword">return</span> smsService;<br> &#125;<br><br>复制代码<br></code></pre></td></tr></table></figure>
<h3 id="20-与类成员变量无关的方法，应当声明成静态方法"><a href="#20-与类成员变量无关的方法，应当声明成静态方法" class="headerlink" title="20. 与类成员变量无关的方法，应当声明成静态方法"></a>20. 与类成员变量无关的方法，应当声明成静态方法</h3><p>有些方法，与实例成员变量无关，就可以声明为静态方法。这一点，工具类用得很多。<strong>反例如下</strong>：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * BigDecimal的工具类</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BigDecimalUtils</span> </span>&#123;<br> <br>    <span class="hljs-keyword">public</span>  BigDecimal <span class="hljs-function"><span class="hljs-title">ifNullSetZERO</span>(<span class="hljs-params">BigDecimal <span class="hljs-keyword">in</span></span>)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">in</span> != <span class="hljs-literal">null</span> ？ <span class="hljs-keyword">in</span> : BigDecimal.ZERO;<br>    &#125;<br> <br>    <span class="hljs-keyword">public</span> BigDecimal <span class="hljs-function"><span class="hljs-title">sum</span>(<span class="hljs-params">BigDecimal ...<span class="hljs-keyword">in</span></span>)</span>&#123;<br>        BigDecimal result = BigDecimal.ZERO;<br>        <span class="hljs-keyword">for</span> (int i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">in</span>.length; i++)&#123;<br>            result = result.add(ifNullSetZERO(<span class="hljs-keyword">in</span>[i]));<br>        &#125;<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<p>因为BigDecimalUtils工具类的方法都没有static修饰，所以，你要使用的时候，每次都要new一下啦,那不就耗资源去<strong>反复创建对象</strong>了嘛！！</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">BigDecimalUtils </span><span class="hljs-keyword">bigDecimalUtils </span>= new <span class="hljs-keyword">BigDecimalUtils（）;</span><br><span class="hljs-keyword">bigDecimalUtils.sum(a,b);</span><br><span class="hljs-keyword">复制代码</span><br></code></pre></td></tr></table></figure>
<p>所以可以声明成静态变量，使用的时候，直接<code>类名.方法</code>调用即可，正例如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * BigDecimal的工具类</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BigDecimalUtils</span> </span>&#123;<br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span>  BigDecimal <span class="hljs-function"><span class="hljs-title">ifNullSetZERO</span>(<span class="hljs-params">BigDecimal <span class="hljs-keyword">in</span></span>)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">in</span> != <span class="hljs-literal">null</span> ？ <span class="hljs-keyword">in</span> : BigDecimal.ZERO;<br>    &#125;<br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> BigDecimal <span class="hljs-function"><span class="hljs-title">sum</span>(<span class="hljs-params">BigDecimal ...<span class="hljs-keyword">in</span></span>)</span>&#123;<br>        BigDecimal result = BigDecimal.ZERO;<br>        <span class="hljs-keyword">for</span> (int i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">in</span>.length; i++)&#123;<br>            result = result.add(ifNullSetZERO(<span class="hljs-keyword">in</span>[i]));<br>        &#125;<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<h3 id="21-不要用一个Exception捕捉所有可能的异常。"><a href="#21-不要用一个Exception捕捉所有可能的异常。" class="headerlink" title="21. 不要用一个Exception捕捉所有可能的异常。"></a>21. 不要用一个Exception捕捉所有可能的异常。</h3><p><strong>反例:</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> test()&#123;<br>    <span class="hljs-keyword">try</span>&#123;<br>        <span class="hljs-comment">//…抛出 IOException 的代码调用</span><br>        <span class="hljs-comment">//…抛出 SQLException 的代码调用</span><br>    &#125;<span class="hljs-keyword">catch</span>(<span class="hljs-built_in">Exception</span> e)&#123;<br>        <span class="hljs-comment">//用基类 Exception 捕捉的所有可能的异常，如果多个层次都这样捕捉，会丢失原始异常的有效信息哦</span><br>        log.info(“<span class="hljs-built_in">Exception</span> in test,<span class="hljs-built_in">exception</span>:&#123;&#125;”, e);<br>    &#125;<br>&#125;<br><br>复制代码<br></code></pre></td></tr></table></figure>
<p><strong>正例：</strong></p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">test</span>()&#123;<br>    <span class="hljs-selector-tag">try</span>&#123;<br>        <span class="hljs-comment">//…抛出 IOException 的代码调用</span><br>        <span class="hljs-comment">//…抛出 SQLException 的代码调用</span><br>    &#125;<span class="hljs-selector-tag">catch</span>(IOException e)&#123;<br>        <span class="hljs-comment">//仅仅捕捉 IOException</span><br>        <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.info</span>(“IOException in test,<span class="hljs-attribute">exception</span>:&#123;&#125;”, e);<br>    &#125;<span class="hljs-selector-tag">catch</span>(SQLException e)&#123;<br>        <span class="hljs-comment">//仅仅捕捉 SQLException</span><br>        <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.info</span>(“SQLException in test,<span class="hljs-attribute">exception</span>:&#123;&#125;”, e);<br>    &#125;<br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<h3 id="22-函数不要过度封装，言简意赅即可。"><a href="#22-函数不要过度封装，言简意赅即可。" class="headerlink" title="22. 函数不要过度封装，言简意赅即可。"></a>22. 函数不要过度封装，言简意赅即可。</h3><p><strong>反例：</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 函数封装</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">boolean</span> <span class="hljs-function"><span class="hljs-title">isUserVip</span>(<span class="hljs-params"><span class="hljs-built_in">Boolean</span> isVip</span>)</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Boolean</span>.TRUE.equals(isVip);<br>&#125;<br><br><span class="hljs-comment">// 使用代码</span><br><span class="hljs-built_in">boolean</span> isVip = isVip(user.getUserVip());<br>复制代码<br></code></pre></td></tr></table></figure>
<p><strong>正例：</strong></p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs lasso"><span class="hljs-built_in">boolean</span> isVip = <span class="hljs-built_in">Boolean</span>.<span class="hljs-literal">TRUE</span>.<span class="hljs-keyword">equals</span>(user.getUserVip());<br>复制代码<br></code></pre></td></tr></table></figure>
<p>函数不要过度封装，把意思表达清楚即可。并且，方法调用会引起入栈和出栈，导致消耗更多的CPU和内存，过度封装，会损耗性能的！</p>
<h3 id="23-如果变量的初值一定会被覆盖，就没有必要给变量赋初值。"><a href="#23-如果变量的初值一定会被覆盖，就没有必要给变量赋初值。" class="headerlink" title="23. 如果变量的初值一定会被覆盖，就没有必要给变量赋初值。"></a>23. 如果变量的初值一定会被覆盖，就没有必要给变量赋初值。</h3><p><strong>反例:</strong></p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs pf">List<span class="hljs-variable">&lt;UserInfo&gt;</span> <span class="hljs-keyword">user</span>List = new ArrayList<span class="hljs-variable">&lt;&gt;</span>();<br>if (isAll) &#123;<br>    <span class="hljs-keyword">user</span>List = <span class="hljs-keyword">user</span>InfoDAO.queryAll();<br>&#125; else &#123;<br>    <span class="hljs-keyword">user</span>List = <span class="hljs-keyword">user</span>InfoDAO.queryActive();<br>&#125;<br><br>复制代码<br></code></pre></td></tr></table></figure>
<p><strong>正例：</strong></p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs pf">List<span class="hljs-variable">&lt;UserInfo&gt;</span> <span class="hljs-keyword">user</span>List ;<br>if (isAll) &#123;<br>    <span class="hljs-keyword">user</span>List = <span class="hljs-keyword">user</span>InfoDAO.queryAll();<br>&#125; else &#123;<br>    <span class="hljs-keyword">user</span>List = <span class="hljs-keyword">user</span>InfoDAO.queryActive();<br>&#125;<br><br>复制代码<br></code></pre></td></tr></table></figure>
<h3 id="24-金额数值计算要使用BigDecimal"><a href="#24-金额数值计算要使用BigDecimal" class="headerlink" title="24.金额数值计算要使用BigDecimal"></a>24.金额数值计算要使用BigDecimal</h3><p>看下这个浮点数计算的例子吧：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> DoubleTest &#123;<br>    <span class="hljs-built_in">public</span> static <span class="hljs-type">void</span> main(String[] args) &#123;<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(<span class="hljs-number">0.1</span>+<span class="hljs-number">0.2</span>);<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(<span class="hljs-number">1.0</span><span class="hljs-number">-0.8</span>);<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(<span class="hljs-number">4.015</span>*<span class="hljs-number">100</span>);<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(<span class="hljs-number">123.3</span>/<span class="hljs-number">100</span>);<br><br>        <span class="hljs-type">double</span> amount1 = <span class="hljs-number">3.15</span>;<br>        <span class="hljs-type">double</span> amount2 = <span class="hljs-number">2.10</span>;<br>        <span class="hljs-keyword">if</span> (amount1 - amount2 == <span class="hljs-number">1.05</span>)&#123;<br>            <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(&quot;OK&quot;);<br>        &#125;<br>    &#125;<br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plain">0.30000000000000004<br>0.19999999999999996<br>401.49999999999994<br>1.2329999999999999<br>复制代码<br></code></pre></td></tr></table></figure>
<blockquote>
<p>因为计算机是以二进制存储数值的，对于浮点数也是。对于计算机而言，0.1无法精确表达，这就是为什么浮点数会导致精确度缺失的。因此，金额计算，一般都是用BigDecimal 类型</p>
</blockquote>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-keyword">new</span> <span class="hljs-constructor">BigDecimal(0.1)</span>.add(<span class="hljs-keyword">new</span> <span class="hljs-constructor">BigDecimal(0.2)</span>));<br><span class="hljs-comment">//output:</span><br><span class="hljs-number">0.3000000000000000166533453693773481063544750213623046875</span><br>复制代码<br></code></pre></td></tr></table></figure>
<p>其实，使用 BigDecimal 表示和计算浮点数，必须使用字符串的构造方法来初始化 BigDecimal，并且，还要关注BigDecimal的几位小数点，它有八种舍入模式等</p>
<h3 id="25-注意Arrays-asList的几个坑"><a href="#25-注意Arrays-asList的几个坑" class="headerlink" title="25.  注意Arrays.asList的几个坑"></a>25.  注意Arrays.asList的几个坑</h3><ul>
<li><strong>基本类型不能作为 Arrays.asList方法的参数，否则会被当做一个参数。</strong></li>
</ul>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ArrayAsListTest</span> &#123;</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">String</span>[] args)</span> </span>&#123;<br>        <span class="hljs-keyword">int</span>[] <span class="hljs-built_in">array</span> = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;;<br>        List <span class="hljs-built_in">list</span> = Arrays.asList(<span class="hljs-built_in">array</span>);<br>        System.out.<span class="hljs-built_in">println</span>(<span class="hljs-built_in">list</span>.<span class="hljs-built_in">size</span>());<br>    &#125;<br>&#125;<br><span class="hljs-comment">//运行结果</span><br><span class="hljs-number">1</span><br>复制代码<br></code></pre></td></tr></table></figure>
<ul>
<li><strong>Arrays.asList 返回的 List 不支持增删操作。</strong></li>
</ul>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">public <span class="hljs-keyword">class</span> ArrayAsListTest &#123;<br>    public static void main(String<span class="hljs-literal">[]</span> args) &#123;<br>        String<span class="hljs-literal">[]</span> <span class="hljs-built_in">array</span> = &#123;<span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-string">&quot;2&quot;</span>, <span class="hljs-string">&quot;3&quot;</span>&#125;;<br>        List <span class="hljs-built_in">list</span> = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Arrays</span>.</span></span><span class="hljs-keyword">as</span><span class="hljs-constructor">List(<span class="hljs-params">array</span>)</span>;<br>        <span class="hljs-built_in">list</span>.add(<span class="hljs-string">&quot;5&quot;</span>);<br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-built_in">list</span>.size<span class="hljs-literal">()</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 运行结果</span><br>Exception <span class="hljs-keyword">in</span> thread <span class="hljs-string">&quot;main&quot;</span> java.lang.UnsupportedOperationException<br>	at java.util.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">AbstractList</span>.</span></span>add(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">AbstractList</span>.</span></span>java:<span class="hljs-number">148</span>)<br>	at java.util.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">AbstractList</span>.</span></span>add(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">AbstractList</span>.</span></span>java:<span class="hljs-number">108</span>)<br>	at <span class="hljs-keyword">object</span>.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ArrayAsListTest</span>.</span></span>main(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ArrayAsListTest</span>.</span></span>java:<span class="hljs-number">11</span>)<br><br>复制代码<br></code></pre></td></tr></table></figure>
<p>Arrays.asList 返回的 List 并不是我们期望的 java.util.ArrayList，而是 Arrays 的内部类ArrayList。内部类的ArrayList没有实现add方法，而是父类的add方法的实现，是会抛出异常的呢。</p>
<ul>
<li><strong>使用Arrays.asLis的时候，对原始数组的修改会影响到我们获得的那个List</strong></li>
</ul>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">public <span class="hljs-keyword">class</span> ArrayAsListTest &#123;<br>    public static void main(String<span class="hljs-literal">[]</span> args) &#123;<br>        String<span class="hljs-literal">[]</span> arr = &#123;<span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-string">&quot;2&quot;</span>, <span class="hljs-string">&quot;3&quot;</span>&#125;;<br>        List <span class="hljs-built_in">list</span> = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Arrays</span>.</span></span><span class="hljs-keyword">as</span><span class="hljs-constructor">List(<span class="hljs-params">arr</span>)</span>;<br>        arr<span class="hljs-literal">[<span class="hljs-number">1</span>]</span> = <span class="hljs-string">&quot;4&quot;</span>;<br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;原始数组&quot;</span>+<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Arrays</span>.</span></span><span class="hljs-keyword">to</span><span class="hljs-constructor">String(<span class="hljs-params">arr</span>)</span>);<br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;list数组&quot;</span> + <span class="hljs-built_in">list</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//运行结果</span><br>原始数组<span class="hljs-literal">[<span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>]</span><br><span class="hljs-built_in">list</span>数组<span class="hljs-literal">[<span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>]</span><br>复制代码<br></code></pre></td></tr></table></figure>
<h3 id="26，及时关闭IO资源流"><a href="#26，及时关闭IO资源流" class="headerlink" title="26，及时关闭IO资源流"></a>26，及时关闭IO资源流</h3><p>应该大家都有过这样的经历，windows系统桌面如果打开太多文件或者系统软件，就会觉得电脑很卡。当然，我们linux服务器也一样，平时操作文件，或者数据库连接，IO资源流如果没关闭，那么这个IO资源就会被它占着，这样别人就没有办法用了，这就造成资源浪费。</p>
<p>所以使用完IO流，记得关闭哈。可以使用try-with-resource关闭的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * 关注公众号，捡田螺的小男孩</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">try</span> (FileInputStream inputStream = <span class="hljs-keyword">new</span> <span class="hljs-function"><span class="hljs-title">FileInputStream</span>(<span class="hljs-params"><span class="hljs-keyword">new</span> File(<span class="hljs-string">&quot;jay.txt&quot;</span>)</span>)</span> &#123;<br>    <span class="hljs-comment">// use resources   </span><br>&#125; <span class="hljs-keyword">catch</span> (FileNotFoundException e) &#123;<br>    log.error(e);<br>&#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>    log.error(e);<br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<h3 id="27-尽量使用函数内的基本类型临时变量"><a href="#27-尽量使用函数内的基本类型临时变量" class="headerlink" title="27. 尽量使用函数内的基本类型临时变量"></a>27. 尽量使用函数内的基本类型临时变量</h3><blockquote>
<ul>
<li>在方法函数内，基本类型参数以及临时变量，都是保存在栈中的，访问速度比较快。</li>
<li>对象类型的参数和临时变量的引用都保存在栈中，内容都保存在堆中，访问速度较慢。</li>
<li>在类中，任何类型的成员变量都保存在堆（Heap）中，访问速度较慢。</li>
</ul>
</blockquote>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs axapta"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AccumulatorUtil</span> </span>&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">double</span> result = <span class="hljs-number">0.0</span>D;<br>    <span class="hljs-comment">//反例</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> addAllOne( <span class="hljs-built_in">double</span>[] values) &#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-built_in">double</span> value : values) &#123;<br>            result += value;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">//正例，先在方法内声明一个局部临时变量，累加完后，再赋值给方法外的成员变量</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> addAll1Two(<span class="hljs-built_in">double</span>[] values) &#123;<br>        <span class="hljs-built_in">double</span> <span class="hljs-keyword">sum</span> = <span class="hljs-number">0.0</span>D;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-built_in">double</span> value : values) &#123;<br>            <span class="hljs-keyword">sum</span> += value;<br>        &#125;<br>        result += <span class="hljs-keyword">sum</span>;<br>    &#125;<br>&#125;<br><br>复制代码<br></code></pre></td></tr></table></figure>
<h3 id="28-如果数据库一次查询的数量过多，建议分页处理。"><a href="#28-如果数据库一次查询的数量过多，建议分页处理。" class="headerlink" title="28. 如果数据库一次查询的数量过多，建议分页处理。"></a>28. 如果数据库一次查询的数量过多，建议分页处理。</h3><p>如果你的Sql一次性查出来的数据量比较多，建议分页处理。</p>
<p><strong>反例：</strong></p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> user_id,name,age <span class="hljs-keyword">from</span> user_info ;<br><br>复制代码<br></code></pre></td></tr></table></figure>
<p><strong>正例：</strong></p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> user_id,name,age <span class="hljs-keyword">from</span> user_info <span class="hljs-keyword">limit</span> #&#123;<span class="hljs-keyword">offset</span>&#125;,#&#123;pageSize&#125;;<br>复制代码<br></code></pre></td></tr></table></figure>
<p>如果偏移量特别大的时候，查询效率就变得低下。可以这接种方式优化：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">//方案一 ：返回上次查询的最大记录(偏移量)<br><span class="hljs-keyword">select</span> id，<span class="hljs-type">name</span> <span class="hljs-keyword">from</span> user_info <span class="hljs-keyword">where</span> id&gt;<span class="hljs-number">10000</span> <span class="hljs-keyword">limit</span> #&#123;pageSize&#125;.<br><br>//方案二：<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> + 索引<br><span class="hljs-keyword">select</span> id，<span class="hljs-type">name</span> <span class="hljs-keyword">from</span> user_info <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> id  <span class="hljs-keyword">limit</span> #&#123;<span class="hljs-keyword">offset</span>&#125;,#&#123;pageSize&#125;<br><br>//方案三：在业务允许的情况下限制页数：<br><br>复制代码<br></code></pre></td></tr></table></figure>
<h3 id="29-尽量减少对变量的重复计算"><a href="#29-尽量减少对变量的重复计算" class="headerlink" title="29. 尽量减少对变量的重复计算"></a>29. 尽量减少对变量的重复计算</h3><p>一般我们写代码的时候，会以以下的方式实现遍历：</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">list</span>.<span class="hljs-built_in">size</span>; i++)&#123;<br><br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<p>如果list数据量比较小那还好。如果list比较大时，可以优化成这样：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>, <span class="hljs-type">int</span> <span class="hljs-built_in">length</span> = list.size; i &lt; <span class="hljs-built_in">length</span>; i++)&#123;<br><br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<p>理由：</p>
<ul>
<li>对方法的调用，即使是只有一个语句，也是有有消耗的，比如创建栈帧。如果list比较大时，多次调用list.size也是会有资源消耗的。</li>
</ul>
<h3 id="30-修改对外老接口的时候，思考接口的兼容性。"><a href="#30-修改对外老接口的时候，思考接口的兼容性。" class="headerlink" title="30. 修改对外老接口的时候，思考接口的兼容性。"></a>30. 修改对外老接口的时候，思考接口的兼容性。</h3><p>很多bug都是因为修改了对外老接口，但是却不做兼容导致的。关键这个问题多数是比较严重的，可能直接导致系统发版失败的。新手程序员很容易就犯这个错误了哦~</p>
<p>所以，如果你的需求是在原来接口上修改，，尤其这个接口是对外提供服务的话，一定要考虑接口兼容。举个例子吧，比如dubbo接口，原本是只接收A，B参数，现在你加了一个参数C，就可以考虑这样处理。</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-comment">//老接口</span><br>void old<span class="hljs-constructor">Service(A,B)</span>;&#123;<br>  <span class="hljs-comment">//兼容新接口，传个null代替C</span><br>  <span class="hljs-keyword">new</span><span class="hljs-constructor">Service(A,B,<span class="hljs-params">null</span>)</span>;<br>&#125;<br><br><span class="hljs-comment">//新接口，暂时不能删掉老接口，需要做兼容。</span><br>void <span class="hljs-keyword">new</span><span class="hljs-constructor">Service(A,B,C)</span>;<br>复制代码<br></code></pre></td></tr></table></figure>
<h3 id="31-代码采取措施避免运行时错误（如数组边界溢出，被零除等）"><a href="#31-代码采取措施避免运行时错误（如数组边界溢出，被零除等）" class="headerlink" title="31 代码采取措施避免运行时错误（如数组边界溢出，被零除等）"></a>31 代码采取措施避免运行时错误（如数组边界溢出，被零除等）</h3><p>日常开发中，我们需要采取措施规避数组边界溢出，被零整除，空指针等运行时错误。</p>
<p>类似代码比较常见:</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">String</span> name = <span class="hljs-built_in">list</span>.<span class="hljs-built_in">get</span>(<span class="hljs-number">1</span>).getName(); <span class="hljs-comment">//list可能越界，因为不一定有2个元素哈</span><br>复制代码<br></code></pre></td></tr></table></figure>
<p>所以，应该采取措施，预防一下数组边界溢出，<strong>正例：</strong></p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-keyword">if</span>(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">CollectionsUtil</span>.</span></span>is<span class="hljs-constructor">NotEmpty(<span class="hljs-params">list</span>)</span>&amp;&amp; <span class="hljs-built_in">list</span>.size<span class="hljs-literal">()</span>&gt;<span class="hljs-number">1</span>)&#123;<br>  String name = <span class="hljs-built_in">list</span>.get(<span class="hljs-number">1</span>).get<span class="hljs-constructor">Name()</span>; <br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<h3 id="32-注意-ArrayList-toArray-强转的坑"><a href="#32-注意-ArrayList-toArray-强转的坑" class="headerlink" title="32. 注意 ArrayList.toArray() 强转的坑"></a>32. 注意 ArrayList.toArray() 强转的坑</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ArrayListTest</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-function"><span class="hljs-title">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>)</span> &#123;<br>        List&lt;<span class="hljs-built_in">String</span>&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;<span class="hljs-built_in">String</span>&gt;(<span class="hljs-number">1</span>);<br>        list.add(<span class="hljs-string">&quot;公众号：捡田螺的小男孩&quot;</span>);<br>        <span class="hljs-built_in">String</span>[] array21 = (<span class="hljs-built_in">String</span>[])list.toArray();<span class="hljs-comment">//类型转换异常</span><br>    &#125;<br>&#125;<br><br>复制代码<br></code></pre></td></tr></table></figure>
<p>因为返回的是Object类型，Object类型数组强转String数组，会发生ClassCastException。解决方案是，使用toArray()重载方法toArray(T[] a)</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">String</span>[] array1 = <span class="hljs-built_in">list</span>.toArray(<span class="hljs-keyword">new</span> <span class="hljs-keyword">String</span>[<span class="hljs-number">0</span>]);<span class="hljs-comment">//可以正常运行</span><br>复制代码<br></code></pre></td></tr></table></figure>
<h3 id="33-尽量不在循环里远程调用、或者数据库操作，优先考虑批量进行。"><a href="#33-尽量不在循环里远程调用、或者数据库操作，优先考虑批量进行。" class="headerlink" title="33. 尽量不在循环里远程调用、或者数据库操作，优先考虑批量进行。"></a>33. 尽量不在循环里远程调用、或者数据库操作，优先考虑批量进行。</h3><p>程操作或者数据库操作都是比较耗网络、IO资源的，所以尽量不在循环里远程调用、不在循环里操作数据库，能批量一次性查回来尽量不要循环多次去查。（但是呢，也不要一次性查太多数据哈，要分批500一次酱紫）</p>
<p><strong>正例：</strong></p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">remote<span class="hljs-constructor">BatchQuery(<span class="hljs-params">param</span>)</span>;<br>复制代码<br></code></pre></td></tr></table></figure>
<p><strong>反例：</strong></p>
<figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-function"><span class="hljs-title">for</span>(<span class="hljs-variable">int</span> <span class="hljs-variable">i</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">i</span>&lt;<span class="hljs-variable">n</span>;<span class="hljs-variable">i</span>++)&#123;</span><br><span class="hljs-function">  <span class="hljs-title">remoteSingleQuery</span>(<span class="hljs-variable">param</span>)</span><br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<h3 id="34-写完代码，脑洞一下多线程执行会怎样，注意并发一致性问题"><a href="#34-写完代码，脑洞一下多线程执行会怎样，注意并发一致性问题" class="headerlink" title="34. 写完代码，脑洞一下多线程执行会怎样，注意并发一致性问题"></a>34. 写完代码，脑洞一下多线程执行会怎样，注意并发一致性问题</h3><p>我们经常见的一些业务场景，就是先查下有没有记录，再进行对应的操作（比如修改）。但是呢，(查询+修改)合在一起不是原子操作哦，脑洞下多线程，就会发现有问题了，</p>
<p><strong>反例：</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">if</span>(<span class="hljs-function"><span class="hljs-title">isAvailable</span>(<span class="hljs-params">ticketId</span>)</span>&#123;  <span class="hljs-comment">//非原子操作	</span><br>    <span class="hljs-number">1</span>、给现金增加操作	<br>    <span class="hljs-number">2</span>、deleteTicketById(ticketId)	<br>&#125;<span class="hljs-keyword">else</span>&#123;	<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;没有可用现金券&quot;</span>;<br>&#125;<br><br>复制代码<br></code></pre></td></tr></table></figure>
<p>为了更容易理解它，看这个流程图吧：</p>
<p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/image-20210404075941431.png" srcset="/blog/img/loading.gif" alt="image-20210404075941431"></p>
<ul>
<li>1.线程A加现金</li>
<li>2.线程B加现金</li>
<li>3.线程A删除票标志</li>
<li>4.线程B删除票标志</li>
</ul>
<p>显然这样存在并发问题，正例应该利用数据库删除操作的原子性，如下：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">if</span><span class="hljs-params">(deleteAvailableTicketById(ticketId)</span></span> == <span class="hljs-number">1</span>)&#123;	<span class="hljs-comment">//原子操作</span><br>    <span class="hljs-number">1</span>、给现金增加操作	<br>&#125;<span class="hljs-keyword">else</span>&#123;	<br>    return “没有可用现金券”	<br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<h3 id="35-多线程异步优先考虑恰当的线程池，而不是new-thread-同时考虑线程池是否隔离"><a href="#35-多线程异步优先考虑恰当的线程池，而不是new-thread-同时考虑线程池是否隔离" class="headerlink" title="35 多线程异步优先考虑恰当的线程池，而不是new thread,同时考虑线程池是否隔离"></a>35 多线程异步优先考虑恰当的线程池，而不是new thread,同时考虑线程池是否隔离</h3><p>为什么优先使用线程池？使用线程池有这几点好处呀</p>
<ul>
<li>它帮我们管理线程，避免增加创建线程和销毁线程的资源损耗。</li>
<li>提高响应速度。</li>
<li>重复利用。</li>
</ul>
<p>同时呢，尽量不要所有业务都共用一个线程池，需要考虑线程池隔离。就是不同的关键业务，分配不同的线程池，然后线程池参数也要考虑恰当哈。之前写过几篇线程池的，觉得还不错，有兴趣的朋友可以看一下哈</p>
<h3 id="36-优化程序结构，尽量减少方法的重复调用"><a href="#36-优化程序结构，尽量减少方法的重复调用" class="headerlink" title="36. 优化程序结构，尽量减少方法的重复调用"></a>36. 优化程序结构，尽量减少方法的重复调用</h3><p><strong>反例：</strong></p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs arduino">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">listDetail</span><span class="hljs-params">(List&lt;UserInfo&gt; userInfoList)</span> </span>&#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; userInfoList.<span class="hljs-built_in">size</span>(); i++) &#123;<br>            <span class="hljs-comment">//重复调用userList.size()方法了</span><br>        &#125;<br>    &#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<p><strong>正例：</strong></p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs arduino"> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">listDetail</span><span class="hljs-params">(List&lt;UserInfo&gt; userInfoList)</span> </span>&#123;<br>        <span class="hljs-keyword">int</span> length = userInfoList.<span class="hljs-built_in">size</span>();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; length; i++) &#123;<br>            <span class="hljs-comment">//减少调用userList.size()方法，只在length变量调了一次。</span><br>        &#125;<br>    &#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<h3 id="37，直接大文件或者一次性从数据库读取太多数据到内存，可能导致OOM问题"><a href="#37，直接大文件或者一次性从数据库读取太多数据到内存，可能导致OOM问题" class="headerlink" title="37，直接大文件或者一次性从数据库读取太多数据到内存，可能导致OOM问题"></a>37，直接大文件或者一次性从数据库读取太多数据到内存，可能导致OOM问题</h3><p>如果一次性把大文件或者数据库太多数据达到内存，是会导致OOM的。所以，为什么查询DB数据库，一般都建议分批。</p>
<p>读取文件的话，一般文件不会太大，才使用Files.readAllLines()。为什么呢？因为它是直接把文件都读到内存的，预估下不会OOM才使用这个吧，可以看下它的源码：</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs processing"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;<span class="hljs-keyword">String</span>&gt; readAllLines(Path path, Charset cs) <span class="hljs-keyword">throws</span> IOException &#123;<br>    <span class="hljs-keyword">try</span> (<span class="hljs-keyword">BufferedReader</span> reader = newBufferedReader(path, cs)) &#123;<br>        List&lt;<span class="hljs-keyword">String</span>&gt; result = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (;;) &#123;<br>            <span class="hljs-keyword">String</span> <span class="hljs-built_in">line</span> = reader.readLine();<br>            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">line</span> == <span class="hljs-keyword">null</span>)<br>                <span class="hljs-keyword">break</span>;<br>            result.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">line</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<p>如果是太大的文件，可以使用Files.line()按需读取，当时读取文件这些，一般是使用完需要关闭资源流的哈。</p>
<h3 id="38-调用第三方接口，需要考虑异常处理，安全性，超时重试这几个点。"><a href="#38-调用第三方接口，需要考虑异常处理，安全性，超时重试这几个点。" class="headerlink" title="38. 调用第三方接口，需要考虑异常处理，安全性，超时重试这几个点。"></a>38. 调用第三方接口，需要考虑异常处理，安全性，超时重试这几个点。</h3><p>日常开发中，经常需要调用第三方服务，或者分布式远程服务的的话，需要考虑：</p>
<ul>
<li>异常处理（比如，你调别人的接口，如果异常了，怎么处理，是重试还是当做失败）</li>
<li>超时（没法预估对方接口一般多久返回，一般设置个超时断开时间，以保护你的接口）</li>
<li>重试次数（你的接口调失败，需不需要重试，需要站在业务上角度思考这个问题）</li>
</ul>
<blockquote>
<p>简单一个例子，你一个http请求调别人的服务，需要考虑设置connect-time，和retry次数。</p>
</blockquote>
<h3 id="39-不要使用循环拷贝集合，尽量使用JDK提供的方法拷贝集合"><a href="#39-不要使用循环拷贝集合，尽量使用JDK提供的方法拷贝集合" class="headerlink" title="39 不要使用循环拷贝集合，尽量使用JDK提供的方法拷贝集合"></a>39 不要使用循环拷贝集合，尽量使用JDK提供的方法拷贝集合</h3><blockquote>
<ul>
<li>JDK提供原生API方法，可以直接指定集合的容量，避免多次扩容损耗性能。</li>
<li>这些方法的底层调用System.arraycopy方法实现，进行数据的批量拷贝效率更高。</li>
</ul>
</blockquote>
<p><strong>反例：</strong></p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs pf">public List<span class="hljs-variable">&lt;UserInfo&gt;</span> copyMergeList(List<span class="hljs-variable">&lt;UserInfo&gt;</span> user1List, List<span class="hljs-variable">&lt;UserInfo&gt;</span> user2List) &#123;<br>     List<span class="hljs-variable">&lt;UserInfo&gt;</span> <span class="hljs-keyword">user</span>List = new ArrayList<span class="hljs-variable">&lt;&gt;</span>(user1List.size() + user2List.size());<br>     <span class="hljs-keyword">for</span> (UserInfo <span class="hljs-keyword">user</span> : user1List) &#123;<br>         <span class="hljs-keyword">user</span>List.add(<span class="hljs-keyword">user</span>);<br>     &#125;<br>     <span class="hljs-keyword">for</span> (UserInfo <span class="hljs-keyword">user</span> : user2List) &#123;<br>         <span class="hljs-keyword">user</span>List.add(<span class="hljs-keyword">user</span>);<br>     &#125;<br><br>     return user1List;<br> &#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<p><strong>正例：</strong></p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs pf">public List<span class="hljs-variable">&lt;UserInfo&gt;</span> copyMergeList(List<span class="hljs-variable">&lt;UserInfo&gt;</span> user1List, List<span class="hljs-variable">&lt;UserInfo&gt;</span> user2List) &#123;<br>     List<span class="hljs-variable">&lt;UserInfo&gt;</span> <span class="hljs-keyword">user</span>List = new ArrayList<span class="hljs-variable">&lt;&gt;</span>(user1List.size() + user2List.size());<br>     <span class="hljs-keyword">user</span>List.addAll(user1List);<br>     <span class="hljs-keyword">user</span>List.addAll(user2List);<br>     return user1List;<br> &#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<h3 id="40-对于复杂的代码逻辑，添加清楚的注释"><a href="#40-对于复杂的代码逻辑，添加清楚的注释" class="headerlink" title="40. 对于复杂的代码逻辑，添加清楚的注释"></a>40. 对于复杂的代码逻辑，添加清楚的注释</h3><p>写代码的时候，是没有必要写太多的注释的，好的方法变量命名就是最好的注释。但是，如果是业务逻辑很复杂的代码，真的非常有必要写清楚注释。清楚的注释，更有利于后面的维护。</p>
<h3 id="41-多线程情况下，考虑线性安全问题"><a href="#41-多线程情况下，考虑线性安全问题" class="headerlink" title="41. 多线程情况下，考虑线性安全问题"></a>41. 多线程情况下，考虑线性安全问题</h3><p>在高并发情况下，HashMap可能会出现死循环。因为它是非线性安全的，可以考虑使用ConcurrentHashMap。 所以这个也尽量养成习惯，不要上来反手就是一个new HashMap();</p>
<ul>
<li>Hashmap、Arraylist、LinkedList、TreeMap等都是线性不安全的；</li>
<li>Vector、Hashtable、ConcurrentHashMap等都是线性安全的</li>
</ul>
<h3 id="42-使用spring事务功能时，注意这几个事务未生效的坑"><a href="#42-使用spring事务功能时，注意这几个事务未生效的坑" class="headerlink" title="42. 使用spring事务功能时，注意这几个事务未生效的坑"></a>42. 使用spring事务功能时，注意这几个事务未生效的坑</h3><p>日常业务开发中，我们经常跟事务打交道，事务失效主要有以下几个场景：</p>
<ul>
<li>底层数据库引擎不支持事务</li>
<li>在非public修饰的方法使用</li>
<li>rollbackFor属性设置错误</li>
<li>本类方法直接调用</li>
<li>异常被try…catch吃了，导致事务失效。</li>
</ul>
<p><strong>反例：</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TransactionTest</span></span>&#123;<br>  <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-function"><span class="hljs-title">A</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-comment">//插入一条数据</span><br>    <span class="hljs-comment">//调用方法B (本地的类调用，事务失效了)</span><br>    B();<br>  &#125;<br>  <br>  <span class="hljs-meta">@Transactional</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-function"><span class="hljs-title">B</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-comment">//插入数据</span><br>  &#125;<br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<p><strong>注解的事务方法给本类方法直接调用，事务失效</strong></p>
<h3 id="43-使用Executors声明线程池，newFixedThreadPool的OOM问题"><a href="#43-使用Executors声明线程池，newFixedThreadPool的OOM问题" class="headerlink" title="43. 使用Executors声明线程池，newFixedThreadPool的OOM问题"></a>43. 使用Executors声明线程池，newFixedThreadPool的OOM问题</h3><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"> ExecutorService executor = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Executors</span>.</span></span><span class="hljs-keyword">new</span><span class="hljs-constructor">FixedThreadPool(10)</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; Integer.MAX_VALUE; i++) &#123;<br>            executor.execute(<span class="hljs-literal">()</span> -&gt; &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Thread</span>.</span></span>sleep(<span class="hljs-number">10000</span>);<br>                &#125; catch (InterruptedException e) &#123;<br>                    <span class="hljs-comment">//do nothing</span><br>                &#125;<br>            &#125;);<br>        &#125;<br><br>复制代码<br></code></pre></td></tr></table></figure>
<p>IDE指定JVM参数：-Xmx8m -Xms8m :</p>
<p><img src="/Users/cuixiaoyan/Library/Application%20Support/typora-user-images/image-20210404080311614.png" srcset="/blog/img/loading.gif" alt="image-20210404080311614"></p>
<p>运行结果：</p>
<p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/image-20210404080325825.png" srcset="/blog/img/loading.gif" alt="image-20210404080325825"></p>
<p>我们看下源码，其实newFixedThreadPool使用的是无界队列！</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ExecutorService <span class="hljs-keyword">new</span><span class="hljs-type">FixedThreadPool</span>(int nThreads) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-type">ThreadPoolExecutor</span>(nThreads, nThreads,<br>                                  <span class="hljs-number">0</span>L, TimeUnit.MILLISECONDS,<br>                                  <span class="hljs-keyword">new</span> <span class="hljs-type">LinkedBlockingQueue</span>&lt;Runnable&gt;());<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LinkedBlockingQueue</span>&lt;<span class="hljs-title">E</span>&gt; <span class="hljs-keyword"><span class="hljs-keyword">extends</span> <span class="hljs-type">AbstractQueue</span></span>&lt;<span class="hljs-title">E</span>&gt;</span><br><span class="hljs-class">        <span class="hljs-keyword"><span class="hljs-keyword">implements</span> <span class="hljs-type">BlockingQueue</span></span>&lt;<span class="hljs-title">E</span>&gt;, <span class="hljs-title">java</span>.<span class="hljs-title">io</span>.<span class="hljs-title">Serializable</span> </span>&#123;<br>    ...<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Creates a &#123;@code LinkedBlockingQueue&#125; with a capacity of</span><br><span class="hljs-comment">     * &#123;@link Integer#MAX_VALUE&#125;.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> LinkedBlockingQueue() &#123;<br>        <span class="hljs-built_in">this</span>(Integer.MAX_VALUE);<br>    &#125;<br>...<br>&#125;<br><br>复制代码<br></code></pre></td></tr></table></figure>
<blockquote>
<p>newFixedThreadPool线程池的核心线程数是固定的，它使用了近乎于无界的LinkedBlockingQueue阻塞队列。当核心线程用完后，任务会入队到阻塞队列，如果任务执行的时间比较长，没有释放，会导致越来越多的任务堆积到阻塞队列，最后导致机器的内存使用不停的飙升，造成JVM OOM。</p>
</blockquote>
<h3 id="44-catch住异常后，尽量不要使用e-printStackTrace-而是使用log打印。"><a href="#44-catch住异常后，尽量不要使用e-printStackTrace-而是使用log打印。" class="headerlink" title="44. catch住异常后，尽量不要使用e.printStackTrace(),而是使用log打印。"></a>44. catch住异常后，尽量不要使用e.printStackTrace(),而是使用log打印。</h3><p><strong>反例：</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">try</span>&#123;<br>  <span class="hljs-comment">// do what you want  </span><br>&#125;<span class="hljs-keyword">catch</span>(Exception e)&#123;<br>  e.printStackTrace();<br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<p><strong>正例：</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">try</span>&#123;<br>  <span class="hljs-comment">// do what you want  </span><br>&#125;<span class="hljs-keyword">catch</span>(Exception e)&#123;<br>  <span class="hljs-built_in">log</span>.info(<span class="hljs-string">&quot;你的程序有异常啦&quot;</span>,e);<br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<h3 id="45-接口需要考虑幂等性"><a href="#45-接口需要考虑幂等性" class="headerlink" title="45. 接口需要考虑幂等性"></a>45. 接口需要考虑幂等性</h3><p>接口是需要考虑幂等性的，尤其抢红包、转账这些重要接口。最直观的业务场景，就是用户连着点两次，你的接口有没有hold住。</p>
<p>一般幂等技术方案有这几种:</p>
<ul>
<li>查询操作</li>
<li>唯一索引</li>
<li>token机制，防止重复提交</li>
<li>数据库的delete/update操作</li>
<li>乐观锁</li>
<li>悲观锁</li>
<li>Redis、zookeeper 分布式锁（以前抢红包需求，用了Redis分布式锁）</li>
<li>状态机幂等</li>
</ul>
<h3 id="46-对于行数比较多的函数，建议划分小函数，增强可读性。"><a href="#46-对于行数比较多的函数，建议划分小函数，增强可读性。" class="headerlink" title="46. 对于行数比较多的函数，建议划分小函数，增强可读性。"></a>46. 对于行数比较多的函数，建议划分小函数，增强可读性。</h3><p><strong>反例：</strong></p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> Test &#123;<br>    private String <span class="hljs-type">name</span>;<br>    private Vector&lt;<span class="hljs-keyword">Order</span>&gt; orders = <span class="hljs-built_in">new</span> Vector&lt;<span class="hljs-keyword">Order</span>&gt;();<br><br>    <span class="hljs-built_in">public</span> <span class="hljs-type">void</span> printOwing() &#123;<br>        //print banner<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(&quot;****************&quot;);<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(&quot;*****customer Owes *****&quot;);<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(&quot;****************&quot;);<br><br>        //calculate totalAmount<br>        Enumeration env = orders.elements();<br>        <span class="hljs-type">double</span> totalAmount = <span class="hljs-number">0.0</span>;<br>        <span class="hljs-keyword">while</span> (env.hasMoreElements()) &#123;<br>            <span class="hljs-keyword">Order</span> <span class="hljs-keyword">order</span> = (<span class="hljs-keyword">Order</span>) env.nextElement();<br>            totalAmount += <span class="hljs-keyword">order</span>.getAmout();<br>        &#125;<br><br>        //print details<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(&quot;name:&quot; + <span class="hljs-type">name</span>);<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(&quot;amount:&quot; + totalAmount);<br>    &#125;<br>&#125;<br><br>复制代码<br></code></pre></td></tr></table></figure>
<p><strong>正例：</strong></p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> Test &#123;<br>    private String <span class="hljs-type">name</span>;<br>    private Vector&lt;<span class="hljs-keyword">Order</span>&gt; orders = <span class="hljs-built_in">new</span> Vector&lt;<span class="hljs-keyword">Order</span>&gt;();<br><br>    <span class="hljs-built_in">public</span> <span class="hljs-type">void</span> printOwing() &#123;<br><br>        //print banner<br>        printBanner();<br>        //calculate totalAmount<br>        <span class="hljs-type">double</span> totalAmount = getTotalAmount();<br>        //print details<br>        printDetail(totalAmount);<br>    &#125;<br><br>    <span class="hljs-type">void</span> printBanner()&#123;<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(&quot;****************&quot;);<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(&quot;*****customer Owes *****&quot;);<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(&quot;****************&quot;);<br>    &#125;<br><br>    <span class="hljs-type">double</span> getTotalAmount()&#123;<br>        Enumeration env = orders.elements();<br>        <span class="hljs-type">double</span> totalAmount = <span class="hljs-number">0.0</span>;<br>        <span class="hljs-keyword">while</span> (env.hasMoreElements()) &#123;<br>            <span class="hljs-keyword">Order</span> <span class="hljs-keyword">order</span> = (<span class="hljs-keyword">Order</span>) env.nextElement();<br>            totalAmount += <span class="hljs-keyword">order</span>.getAmout();<br>        &#125;<br>        <span class="hljs-keyword">return</span> totalAmount;<br>    &#125;<br><br>    <span class="hljs-type">void</span> printDetail(<span class="hljs-type">double</span> totalAmount)&#123;<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(&quot;name:&quot; + <span class="hljs-type">name</span>);<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(&quot;amount:&quot; + totalAmount);<br>    &#125;<br>    <br>&#125;<br><br>复制代码<br></code></pre></td></tr></table></figure>
<p>一个过于冗长的函数或者一段需要注释才能让人理解用途的代码，可以考虑把它切分成一个功能明确的函数单元，并定义清晰简短的函数名，这样会让代码变得更加优雅。</p>
<h3 id="47-你的关键业务代码，一般建议搞点日志保驾护航。"><a href="#47-你的关键业务代码，一般建议搞点日志保驾护航。" class="headerlink" title="47. 你的关键业务代码，一般建议搞点日志保驾护航。"></a>47. 你的关键业务代码，一般建议搞点日志保驾护航。</h3><p>关键业务代码无论身处何地，都应该有足够的日志保驾护航。</p>
<blockquote>
<p>比如：你实现转账业务，转个几百万，然后转失败了，接着客户投诉，然后你还没有打印到日志，想想那种水深火热的困境下，你却毫无办法。。。</p>
</blockquote>
<p>那么，你的转账业务都需要那些日志信息呢？至少，方法调用前，入参需要打印需要吧，接口调用后，需要捕获一下异常吧，同时打印异常相关日志吧，如下：</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">transfer</span><span class="hljs-params">(TransferDTO transferDTO)</span></span>&#123;<br>    <span class="hljs-built_in">log</span>.info(<span class="hljs-string">&quot;invoke tranfer begin&quot;</span>);<br>    <span class="hljs-comment">//打印入参</span><br>    <span class="hljs-built_in">log</span>.info(<span class="hljs-string">&quot;invoke tranfer,paramters:&#123;&#125;&quot;</span>,transferDTO);<br>    <span class="hljs-keyword">try</span> &#123;<br>      res=  transferService.<span class="hljs-built_in">transfer</span>(transferDTO);<br>    &#125;<span class="hljs-keyword">catch</span>(Exception e)&#123;<br>     <span class="hljs-built_in">log</span>.error(<span class="hljs-string">&quot;transfer fail,cifno:&#123;&#125;，account：&#123;&#125;&quot;</span>,transferDTO.getCifno（），<br>     transferDTO.getaccount（）)<br>     <span class="hljs-built_in">log</span>.error(<span class="hljs-string">&quot;transfer fail,exception:&#123;&#125;&quot;</span>,e);<br>    &#125;<br>    <span class="hljs-built_in">log</span>.info(<span class="hljs-string">&quot;invoke tranfer end&quot;</span>);<br>    &#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<p>除了打印足够的日志，我们还需要注意一点是，日志级别别混淆使用，别本该打印info的日志，你却打印成error级别，告警半夜三更催你起来排查问题就不好了。</p>
<h3 id="48-某些可变因素，如红包皮肤等等，做成配置化是否会更好呢。"><a href="#48-某些可变因素，如红包皮肤等等，做成配置化是否会更好呢。" class="headerlink" title="48. 某些可变因素，如红包皮肤等等，做成配置化是否会更好呢。"></a>48. 某些可变因素，如红包皮肤等等，做成配置化是否会更好呢。</h3><p>假如产品提了个红包需求，圣诞节的时候，红包皮肤为圣诞节相关的，春节的时候，红包皮肤等。</p>
<p>反例:</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs gauss"><span class="hljs-keyword">if</span>(duringChristmas)&#123;<br>   img = redPacketChristmasSkin;<br>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(duringSpringFestival)&#123;<br>   img =  redSpringFestivalSkin;<br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<p>如果到了元宵节的时候，运营小姐姐突然又有想法，红包皮肤换成灯笼相关的，这时候，是不是要去修改代码了，重新发布了？从一开始，实现一张红包皮肤的配置表，将红包皮肤做成配置化呢？更换红包皮肤，只需修改一下表数据就好了。</p>
<h3 id="49，-直接迭代需要使用的集合-无须在额外操作"><a href="#49，-直接迭代需要使用的集合-无须在额外操作" class="headerlink" title="49，.直接迭代需要使用的集合,无须在额外操作"></a>49，.直接迭代需要使用的集合,无须在额外操作</h3><p>直接迭代需要使用的集合，无需通过其它操作获取数据，比较典型就是Map的迭代遍历：</p>
<p><strong>反例：</strong></p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pf">Map<span class="hljs-variable">&lt;Long, UserDO&gt;</span> <span class="hljs-keyword">user</span>Map = ...;<br><span class="hljs-keyword">for</span> (Long <span class="hljs-keyword">user</span>Id : <span class="hljs-keyword">user</span>Map.keySet()) &#123;<br>    UserDO <span class="hljs-keyword">user</span> = <span class="hljs-keyword">user</span>Map.get(<span class="hljs-keyword">user</span>Id);<br>    ...<br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<p><strong>正例：</strong></p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs pf">Map<span class="hljs-variable">&lt;Long, UserDO&gt;</span> <span class="hljs-keyword">user</span>Map = ...;<br><span class="hljs-keyword">for</span> (Map.Entry<span class="hljs-variable">&lt;Long, UserDO&gt;</span> <span class="hljs-keyword">user</span>Entry : <span class="hljs-keyword">user</span>Map.entrySet()) &#123;<br>    Long <span class="hljs-keyword">user</span>Id = <span class="hljs-keyword">user</span>Entry.getKey();<br>    UserDO <span class="hljs-keyword">user</span> = <span class="hljs-keyword">user</span>Entry.getValue();<br>    ...<br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>
<h3 id="50-策略模式-工厂方法优化冗余的if-else"><a href="#50-策略模式-工厂方法优化冗余的if-else" class="headerlink" title="50. 策略模式+工厂方法优化冗余的if else"></a>50. 策略模式+工厂方法优化冗余的if else</h3><p>反例：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs csharp">    String medalType = <span class="hljs-string">&quot;guest&quot;</span>;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;guest&quot;</span>.<span class="hljs-keyword">equals</span>(medalType)) &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;嘉宾勋章&quot;</span>);<br>     &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;vip&quot;</span>.<span class="hljs-keyword">equals</span>(medalType)) &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;会员勋章&quot;</span>);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;guard&quot;</span>.<span class="hljs-keyword">equals</span>(medalType)) &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;展示守护勋章&quot;</span>);<br>    &#125;<br>    ...<br><br>复制代码<br></code></pre></td></tr></table></figure>
<p>首先，我们把每个条件逻辑代码块，抽象成一个公共的接口，我们根据每个逻辑条件，定义相对应的策略实现类，可得以下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//勋章接口</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">IMedalService</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">showMedal</span><span class="hljs-params">()</span></span>;<br>&#125;<br><br><span class="hljs-comment">//守护勋章策略实现类</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GuardMedalServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">IMedalService</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">showMedal</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;展示守护勋章&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-comment">//嘉宾勋章策略实现类</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GuestMedalServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">IMedalService</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">showMedal</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;嘉宾勋章&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-comment">//VIP勋章策略实现类</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VipMedalServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">IMedalService</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">showMedal</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;会员勋章&quot;</span>);<br>    &#125;<br>&#125;<br><br>复制代码<br></code></pre></td></tr></table></figure>
<p>接下来，我们再定义策略工厂类，用来管理这些勋章实现策略类，如下：</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-comment">//勋章服务工产类</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MedalServicesFactory</span> &#123;</span><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&lt;<span class="hljs-keyword">String</span>, IMedalService&gt; <span class="hljs-built_in">map</span> = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br>    <span class="hljs-keyword">static</span> &#123;<br>        <span class="hljs-built_in">map</span>.<span class="hljs-built_in">put</span>(<span class="hljs-string">&quot;guard&quot;</span>, <span class="hljs-keyword">new</span> GuardMedalServiceImpl());<br>        <span class="hljs-built_in">map</span>.<span class="hljs-built_in">put</span>(<span class="hljs-string">&quot;vip&quot;</span>, <span class="hljs-keyword">new</span> VipMedalServiceImpl());<br>        <span class="hljs-built_in">map</span>.<span class="hljs-built_in">put</span>(<span class="hljs-string">&quot;guest&quot;</span>, <span class="hljs-keyword">new</span> GuestMedalServiceImpl());<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> IMedalService <span class="hljs-title">getMedalService</span><span class="hljs-params">(<span class="hljs-keyword">String</span> medalType)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">map</span>.<span class="hljs-built_in">get</span>(medalType);<br>    &#125;<br>&#125;<br><br>复制代码<br></code></pre></td></tr></table></figure>
<p>优化后，正例如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript">ublic <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-function"><span class="hljs-title">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>)</span> &#123;<br>        <span class="hljs-built_in">String</span> medalType = <span class="hljs-string">&quot;guest&quot;</span>;<br>        IMedalService medalService = MedalServicesFactory.getMedalService(medalType);<br>        medalService.showMedal();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/blog/tags/java/">java</a>
                    
                      <a class="hover-with-bg" href="/blog/tags/%E6%8A%80%E5%B7%A7/">技巧</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/blog/2021/04/10/Spring%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7%E4%B9%8B%E6%89%A9%E5%B1%95%E7%82%B9%E7%9A%84%E5%BA%94%E7%94%A8/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Spring奇技淫巧之扩展点的应用</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/blog/2021/03/28/%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/">
                        <span class="hidden-mobile">策略模式</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments">
                
                
  <div id="vcomments"></div>
  <script type="text/javascript">
    Fluid.utils.waitElementVisible('vcomments', function() {
      Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js', function () {
        new Valine({
          el: "#vcomments",
          app_id: "55Wn8cr3lOMRDrIvOPa99oFp-gzGzoHsz",
          app_key: "JNGtsKo81rNkmQNAspsS7IEV",
          placeholder: "说点什么",
          path: window.location.pathname,
          avatar: "retro",
          meta: ["nick","mail","link"],
          pageSize: "5",
          lang: "zh-CN",
          highlight: false,
          recordIP: false,
          serverURLs: "",
        });
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the
    <a target="_blank" href="https://valine.js.org" rel="nofollow noopener noopener">comments powered by Valine.</a>
  </noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
    
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/blog/js/debouncer.js" ></script>
<script  src="/blog/js/events.js" ></script>
<script  src="/blog/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/blog/js/lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/blog/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/blog/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/blog/js/boot.js" ></script>



</body>
</html>
