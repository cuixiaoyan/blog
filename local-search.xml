<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>æ¥å£ä¸Šæ³¨è§£AOPæ‹¦æˆªä¸åˆ°åœºæ™¯å…¼å®¹</title>
    <link href="/blog/2021/06/08/%E6%8E%A5%E5%8F%A3%E4%B8%8A%E6%B3%A8%E8%A7%A3AOP%E6%8B%A6%E6%88%AA%E4%B8%8D%E5%88%B0%E5%9C%BA%E6%99%AF%E5%85%BC%E5%AE%B9/"/>
    <url>/blog/2021/06/08/%E6%8E%A5%E5%8F%A3%E4%B8%8A%E6%B3%A8%E8%A7%A3AOP%E6%8B%A6%E6%88%AA%E4%B8%8D%E5%88%B0%E5%9C%BA%E6%99%AF%E5%85%BC%E5%AE%B9/</url>
    
    <content type="html"><![CDATA[<p>åœ¨ Java çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œé¢å‘æ¥å£çš„ç¼–ç¨‹å¯èƒ½æ˜¯å¤§å®¶çš„å¸¸æ€ï¼Œåˆ‡é¢ä¹Ÿæ˜¯å„ä½å¤§ä½¬ä½¿ç”¨ Spring æ—¶ï¼Œæˆ–å¤šæˆ–å°‘ä¼šä½¿ç”¨çš„ä¸€é¡¹åŸºæœ¬æŠ€èƒ½ï¼›ç»“æœè¿™ä¸¤ä¸ªç¢°åˆ°ä¸€èµ·ï¼Œæœ‰æ„æ€çš„äº‹æƒ…å°±å‘ç”Ÿäº†ï¼Œæ¥å£æ–¹æ³•ä¸Šæ·»åŠ æ³¨è§£ï¼Œé¢å‘æ³¨è§£çš„åˆ‡é¢æ‹¦æˆªï¼Œå±…ç„¶ä¸ç”Ÿæ•ˆ</p><p>è¿™å°±æœ‰ç‚¹å¥‡æ€ªäº†å•Šï¼Œæœ€å¼€å§‹é‡åˆ°è¿™ä¸ªé—®é¢˜æ—¶ï¼Œè¡¨ç¤ºéš¾ä»¥ç›¸ä¿¡ï¼›äº‹åŠ¡æ³¨è§£ä¹ŸæŒºå¤šæ˜¯å†™åœ¨æ¥å£ä¸Šçš„ï¼Œå¥½åƒä¹Ÿæ²¡æœ‰é‡åˆ°è¿™ä¸ªé—®é¢˜ï¼ˆéš¾é“æ˜¯ä¹Ÿä¸ç”Ÿæ•ˆï¼Œåªæ˜¯è‡ªå·±æ²¡æœ‰å…³æ³¨åˆ°ï¼Ÿï¼‰</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å¥½å¥½ç…ç…ï¼Œè¿™åˆ°åº•æ˜¯æ€ä¹ˆä¸ªæƒ…å†µ</p><h2 id="I-åœºæ™¯å¤ç°"><a href="#I-åœºæ™¯å¤ç°" class="headerlink" title="I. åœºæ™¯å¤ç°"></a>I. åœºæ™¯å¤ç°</h2><p>è¿™ä¸ªåœºæ™¯å¤ç°ç›¸å¯¹è€Œè¨€æ¯”è¾ƒç®€å•äº†ï¼Œä¸€ä¸ªæ¥å£ï¼Œä¸€ä¸ªå®ç°ç±»ï¼›ä¸€ä¸ªæ³¨è§£ï¼Œä¸€ä¸ªåˆ‡é¢å®Œäº‹</p><h3 id="1-é¡¹ç›®ç¯å¢ƒ"><a href="#1-é¡¹ç›®ç¯å¢ƒ" class="headerlink" title="1. é¡¹ç›®ç¯å¢ƒ"></a>1. é¡¹ç›®ç¯å¢ƒ</h3><p>é‡‡ç”¨<code>SpringBoot 2.2.1.RELEASE</code> + <code>IDEA</code> + <code>maven</code> è¿›è¡Œå¼€å‘</p><p>æ·»åŠ  aop ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br></code></pre></td></tr></table></figure><h3 id="2-å¤ç°-case"><a href="#2-å¤ç°-case" class="headerlink" title="2. å¤ç° case"></a>2. å¤ç° case</h3><p>å£°æ˜ä¸€ä¸ªæ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Target(ElementType.METHOD)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> AnoDot &#123;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>æ‹¦æˆªåˆ‡é¢ï¼Œä¸‹é¢è¿™æ®µä»£ç æ¥è‡ªä¹‹å‰åˆ†äº«çš„åšæ–‡ <a href="https://spring.hhui.top/spring-blog/2019/03/13/190313-SpringCloud%E5%BA%94%E7%94%A8%E7%AF%87%E4%B9%8BAOP%E5%AE%9E%E7%8E%B0%E6%97%A5%E5%BF%97%E5%8A%9F%E8%83%BD/">ã€åŸºç¡€ç³»åˆ—ã€‘AOP å®ç°ä¸€ä¸ªæ—¥å¿—æ’ä»¶ï¼ˆåº”ç”¨ç¯‡ï¼‰</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Aspect</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LogAspect</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String SPLIT_SYMBOL = <span class="hljs-string">&quot;|&quot;</span>;<br><br><br>    <span class="hljs-meta">@Pointcut(&quot;execution(public * com.git.hui.boot.aop.demo.*.*(..)) || @annotation(AnoDot)&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">pointcut</span><span class="hljs-params">()</span> </span>&#123;<br>    &#125;<br><br>    <span class="hljs-meta">@Around(value = &quot;pointcut()&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">doAround</span><span class="hljs-params">(ProceedingJoinPoint proceedingJoinPoint)</span> <span class="hljs-keyword">throws</span> Throwable </span>&#123;<br>        Object res = <span class="hljs-keyword">null</span>;<br>        String req = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">long</span> start = System.currentTimeMillis();<br>        <span class="hljs-keyword">try</span> &#123;<br>            req = buildReqLog(proceedingJoinPoint);<br>            res = proceedingJoinPoint.proceed();<br>            <span class="hljs-keyword">return</span> res;<br>        &#125; <span class="hljs-keyword">catch</span> (Throwable e) &#123;<br>            res = <span class="hljs-string">&quot;Un-Expect-Error&quot;</span>;<br>            <span class="hljs-keyword">throw</span> e;<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">long</span> end = System.currentTimeMillis();<br>            System.out.println(req + <span class="hljs-string">&quot;&quot;</span> + JSON.toJSONString(res) + SPLIT_SYMBOL + (end - start));<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">buildReqLog</span><span class="hljs-params">(ProceedingJoinPoint joinPoint)</span> </span>&#123;<br>        <span class="hljs-comment">// ç›®æ ‡å¯¹è±¡</span><br>        Object target = joinPoint.getTarget();<br>        <span class="hljs-comment">// æ‰§è¡Œçš„æ–¹æ³•</span><br>        Method method = ((MethodSignature) joinPoint.getSignature()).getMethod();<br>        <span class="hljs-comment">// è¯·æ±‚å‚æ•°</span><br>        Object[] args = joinPoint.getArgs();<br><br>        StringBuilder builder = <span class="hljs-keyword">new</span> StringBuilder(target.getClass().getName());<br>        builder.append(SPLIT_SYMBOL).append(method.getName()).append(SPLIT_SYMBOL);<br>        <span class="hljs-keyword">for</span> (Object arg : args) &#123;<br>            builder.append(JSON.toJSONString(arg)).append(<span class="hljs-string">&quot;,&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> builder.substring(<span class="hljs-number">0</span>, builder.length() - <span class="hljs-number">1</span>) + SPLIT_SYMBOL;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ç„¶åå®šä¹‰ä¸€ä¸ªæ¥å£ä¸å®ç°ç±»ï¼Œæ³¨æ„ä¸‹é¢çš„ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªæ³¨è§£åœ¨æ¥å£ä¸Šï¼Œä¸€ä¸ªæ³¨è§£åœ¨å®ç°ç±»ä¸Š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">BaseApi</span> </span>&#123;<br>    <span class="hljs-meta">@AnoDot</span><br>    <span class="hljs-function">String <span class="hljs-title">print</span><span class="hljs-params">(String obj)</span></span>;<br><br>    <span class="hljs-function">String <span class="hljs-title">print2</span><span class="hljs-params">(String obj)</span></span>;<br>&#125;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseApiImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">BaseApi</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">print</span><span class="hljs-params">(String obj)</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;ano in interface:&quot;</span> + obj);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;return:&quot;</span> + obj;<br>    &#125;<br><br>    <span class="hljs-meta">@AnoDot</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">print2</span><span class="hljs-params">(String obj)</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;ano in impl:&quot;</span> + obj);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;return:&quot;</span> + obj;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>æµ‹è¯• case</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Application</span> </span>&#123;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Application</span><span class="hljs-params">(BaseApi baseApi)</span> </span>&#123;<br>        System.out.println(baseApi.print(<span class="hljs-string">&quot;hello world&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;-----------&quot;</span>);<br>        System.out.println(baseApi.print2(<span class="hljs-string">&quot;hello world&quot;</span>));<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        SpringApplication.run(Application.class);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>æ‰§è¡Œåè¾“å‡ºç»“æœå¦‚ä¸‹ï¼ˆæœ‰å›¾æœ‰çœŸç›¸ï¼Œåˆ«è¯´æˆ‘éª—ä½  ğŸ™ƒï¼‰</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/825c84d3c2e74897a4833c26aa1a4a8a~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><h3 id="3-äº‹åŠ¡æ³¨è§£æµ‹è¯•"><a href="#3-äº‹åŠ¡æ³¨è§£æµ‹è¯•" class="headerlink" title="3. äº‹åŠ¡æ³¨è§£æµ‹è¯•"></a>3. äº‹åŠ¡æ³¨è§£æµ‹è¯•</h3><p>ä¸Šé¢è¿™ä¸ªä¸ç”Ÿæ•ˆï¼Œé‚£æˆ‘ä»¬é€šå¸¸å†™åœ¨æ¥å£ä¸Šçš„äº‹åŠ¡æ³¨è§£ï¼Œä¼šç”Ÿæ•ˆä¹ˆï¼Ÿ</p><p>æ·»åŠ  mysql æ“ä½œçš„ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>æ•°æ®åº“é…ç½® <code>application.properties</code></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment">## DataSource</span><br><span class="hljs-meta">spring.datasource.url</span>=<span class="hljs-string">jdbc:mysql://127.0.0.1:3306/story?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false&amp;serverTimezone=GMT%2b8</span><br><span class="hljs-meta">spring.datasource.username</span>=<span class="hljs-string">root</span><br><span class="hljs-meta">spring.datasource.password</span>=<span class="hljs-string"></span><br><br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°±æ˜¯æˆ‘ä»¬çš„æ¥å£å®šä¹‰ä¸å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">TransApi</span> </span>&#123;<br>    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span><br>    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">update</span><span class="hljs-params">(<span class="hljs-keyword">int</span> id)</span></span>;<br>&#125;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TransApiImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">TransApi</span> </span>&#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> JdbcTemplate jdbcTemplate;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">update</span><span class="hljs-params">(<span class="hljs-keyword">int</span> id)</span> </span>&#123;<br>        String sql = <span class="hljs-string">&quot;replace into money (id, name, money) values (&quot;</span> + id + <span class="hljs-string">&quot;, &#x27;äº‹åŠ¡æµ‹è¯•&#x27;, 200)&quot;</span>;<br>        jdbcTemplate.execute(sql);<br><br>        Object ans = jdbcTemplate.queryForMap(<span class="hljs-string">&quot;select * from money where id = 111&quot;</span>);<br>        System.out.println(ans);<br><br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;äº‹åŠ¡å›æ»š&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>æ³¨æ„ä¸Šé¢çš„ update æ–¹æ³•ï¼Œäº‹åŠ¡æ³¨è§£åœ¨æ¥å£ä¸Šï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦ç¡®è®¤è°ƒç”¨ä¹‹åï¼Œæ˜¯å¦ä¼šå›æ»š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Application</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Application</span><span class="hljs-params">(TransApiImpl transApi, JdbcTemplate jdbcTemplate)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            transApi.update(<span class="hljs-number">111</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            System.out.println(e.getMessage());<br>        &#125;<br><br>        System.out.println(jdbcTemplate.queryForList(<span class="hljs-string">&quot;select * from money where id=111&quot;</span>));<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        SpringApplication.run(Application.class);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/4d903bbd1356440ab79cf56fb94f6b10~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>å›æ»šäº†ï¼Œæœ‰æœ¨æœ‰ï¼ï¼ï¼</p><p>æœç„¶æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œå“å¾—æˆ‘ä¸€èº«å†·æ±—ï¼Œè¿™è¦æ˜¯æœ‰é—®é¢˜ï¼Œé‚£å°±â€¦(ä¸æ•¢æƒ³ä¸æ•¢æƒ³)</p><p>æ‰€ä»¥é—®é¢˜æ¥äº†ï¼Œä¸ºå•¥ç¬¬ä¸€ç§æ–¹å¼ä¸ç”Ÿæ•ˆå‘¢ï¼Ÿï¼Ÿï¼Ÿ</p><h2 id="II-æ¥å£æ³¨è§£åˆ‡é¢æ‹¦æˆªå®ç°"><a href="#II-æ¥å£æ³¨è§£åˆ‡é¢æ‹¦æˆªå®ç°" class="headerlink" title="II. æ¥å£æ³¨è§£åˆ‡é¢æ‹¦æˆªå®ç°"></a>II. æ¥å£æ³¨è§£åˆ‡é¢æ‹¦æˆªå®ç°</h2><p>æš‚ä¸”æŒ‰ä¸‹æ¢å¯»ç©¶ç«Ÿçš„æ¬²æœ›ï¼Œå…ˆçœ‹ä¸‹å¦‚æœæƒ³è®©æˆ‘ä»¬å¯ä»¥æ‹¦æˆªæ¥å£ä¸Šçš„æ³¨è§£ï¼Œå¯ä»¥æ€ä¹ˆåšå‘¢?</p><p>æ—¢ç„¶æ‹¦æˆªä¸ä¸Šï¼Œå¤šåŠæ˜¯å› ä¸ºå­ç±»æ²¡æœ‰ç»§æ‰¿çˆ¶ç±»çš„æ³¨è§£ï¼Œæ‰€ä»¥åœ¨è¿›è¡Œåˆ‡ç‚¹åŒ¹é…æ—¶ï¼ŒåŒ¹é…ä¸åˆ°ï¼›æ—¢ç„¶å¦‚æ­¤ï¼Œé‚£å°±è®©å®ƒåœ¨åŒ¹é…æ—¶ï¼Œæ‰¾ä¸‹çˆ¶ç±»çœ‹æœ‰æ²¡æœ‰å¯¹åº”çš„æ³¨è§£</p><h3 id="1-è‡ªå®šä¹‰-Pointcut"><a href="#1-è‡ªå®šä¹‰-Pointcut" class="headerlink" title="1. è‡ªå®šä¹‰ Pointcut"></a>1. è‡ªå®šä¹‰ Pointcut</h3><p>è™½è¯´æ˜¯è‡ªå®šä¹‰ï¼Œä½†ä¹Ÿæ²¡æœ‰è¦æ±‚æˆ‘ä»¬ç›´æ¥å®ç°è¿™ä¸ªæ¥å£ï¼Œæˆ‘ä»¬é€‰æ‹©<code>StaticMethodMatcherPointcut</code>æ¥è¡¥å…¨é€»è¾‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.core.annotation.AnnotatedElementUtils;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LogPointCut</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StaticMethodMatcherPointcut</span> </span>&#123;<br><br>    <span class="hljs-meta">@SneakyThrows</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">matches</span><span class="hljs-params">(Method method, Class&lt;?&gt; aClass)</span> </span>&#123;<br>        <span class="hljs-comment">// ç›´æ¥ä½¿ç”¨springå·¥å…·åŒ…ï¼Œæ¥è·å–methodä¸Šçš„æ³¨è§£ï¼ˆä¼šæ‰¾çˆ¶ç±»ä¸Šçš„æ³¨è§£ï¼‰</span><br>        <span class="hljs-keyword">return</span> AnnotatedElementUtils.hasAnnotation(method, AnoDot.class);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬é‡‡ç”¨å£°æ˜å¼æ¥å®ç°åˆ‡é¢é€»è¾‘</p><h3 id="2-è‡ªå®šä¹‰-Advice"><a href="#2-è‡ªå®šä¹‰-Advice" class="headerlink" title="2. è‡ªå®šä¹‰ Advice"></a>2. è‡ªå®šä¹‰ Advice</h3><p>è¿™ä¸ª advice å°±æ˜¯æˆ‘ä»¬éœ€è¦æ‰§è¡Œçš„åˆ‡é¢é€»è¾‘ï¼Œå’Œä¸Šé¢çš„æ—¥å¿—è¾“å‡ºå·®ä¸å¤šï¼ŒåŒºåˆ«åœ¨äºå‚æ•°ä¸åŒ</p><p>è‡ªå®šä¹‰ advice å®ç°è‡ªæ¥å£<code>MethodInterceptor</code>ï¼Œé¡¶å±‚æ¥å£æ˜¯<code>Advice</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LogAdvice</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">MethodInterceptor</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String SPLIT_SYMBOL = <span class="hljs-string">&quot;|&quot;</span>;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">invoke</span><span class="hljs-params">(MethodInvocation methodInvocation)</span> <span class="hljs-keyword">throws</span> Throwable </span>&#123;<br>        Object res = <span class="hljs-keyword">null</span>;<br>        String req = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">long</span> start = System.currentTimeMillis();<br>        <span class="hljs-keyword">try</span> &#123;<br>            req = buildReqLog(methodInvocation);<br>            res = methodInvocation.proceed();<br>            <span class="hljs-keyword">return</span> res;<br>        &#125; <span class="hljs-keyword">catch</span> (Throwable e) &#123;<br>            res = <span class="hljs-string">&quot;Un-Expect-Error&quot;</span>;<br>            <span class="hljs-keyword">throw</span> e;<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">long</span> end = System.currentTimeMillis();<br>            System.out.println(<span class="hljs-string">&quot;ExtendLogAspect:&quot;</span> + req + <span class="hljs-string">&quot;&quot;</span> + JSON.toJSONString(res) + SPLIT_SYMBOL + (end - start));<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">buildReqLog</span><span class="hljs-params">(MethodInvocation joinPoint)</span> </span>&#123;<br>        <span class="hljs-comment">// ç›®æ ‡å¯¹è±¡</span><br>        Object target = joinPoint.getThis();<br>        <span class="hljs-comment">// æ‰§è¡Œçš„æ–¹æ³•</span><br>        Method method = joinPoint.getMethod();<br>        <span class="hljs-comment">// è¯·æ±‚å‚æ•°</span><br>        Object[] args = joinPoint.getArguments();<br><br>        StringBuilder builder = <span class="hljs-keyword">new</span> StringBuilder(target.getClass().getName());<br>        builder.append(SPLIT_SYMBOL).append(method.getName()).append(SPLIT_SYMBOL);<br>        <span class="hljs-keyword">for</span> (Object arg : args) &#123;<br>            builder.append(JSON.toJSONString(arg)).append(<span class="hljs-string">&quot;,&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> builder.substring(<span class="hljs-number">0</span>, builder.length() - <span class="hljs-number">1</span>) + SPLIT_SYMBOL;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="3-è‡ªå®šä¹‰-Advisor"><a href="#3-è‡ªå®šä¹‰-Advisor" class="headerlink" title="3. è‡ªå®šä¹‰ Advisor"></a>3. è‡ªå®šä¹‰ Advisor</h3><p>å°†ä¸Šé¢è‡ªå®šä¹‰çš„åˆ‡ç‚¹ pointcut ä¸é€šçŸ¥ advice æ•´åˆï¼Œå®ç°æˆ‘ä»¬çš„åˆ‡é¢</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LogAdvisor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractBeanFactoryPointcutAdvisor</span> </span>&#123;<br>    <span class="hljs-meta">@Setter</span><br>    <span class="hljs-keyword">private</span> Pointcut logPointCut;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Pointcut <span class="hljs-title">getPointcut</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> logPointCut;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="4-æœ€åæ³¨å†Œåˆ‡é¢"><a href="#4-æœ€åæ³¨å†Œåˆ‡é¢" class="headerlink" title="4. æœ€åæ³¨å†Œåˆ‡é¢"></a>4. æœ€åæ³¨å†Œåˆ‡é¢</h3><p>è¯´æ˜¯æ³¨å†Œï¼Œå®é™…ä¸Šå°±æ˜¯å£°æ˜ä¸º beanï¼Œä¸¢åˆ° spring å®¹å™¨ä¸­è€Œå·²</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> LogAdvisor <span class="hljs-title">init</span><span class="hljs-params">()</span> </span>&#123;<br>    LogAdvisor logAdvisor = <span class="hljs-keyword">new</span> LogAdvisor();<br>    <span class="hljs-comment">// è‡ªå®šä¹‰å®ç°å§¿åŠ¿</span><br>    logAdvisor.setLogPointCut(<span class="hljs-keyword">new</span> LogPointCut());<br>    logAdvisor.setAdvice(<span class="hljs-keyword">new</span> LogAdvice());<br>    <span class="hljs-keyword">return</span> logAdvisor;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ç„¶åå†æ¬¡æ‰§è¡Œä¸Šé¢çš„æµ‹è¯•ç”¨ä¾‹ï¼Œè¾“å‡ºå¦‚ä¸‹</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/7ca7e497951640048fb6b0d15e458629~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>æ¥å£ä¸Šçš„æ³¨è§£ä¹Ÿè¢«æ‹¦æˆªäº†ï¼Œä½†æ˜¯æœ€åä¸€ä¸ªè€—æ—¶çš„è¾“å‡ºï¼Œæœ‰ç‚¹å¤¸å¼ äº†å•Šï¼Œé‡‡ç”¨ä¸Šé¢è¿™ç§æ–¹å¼ï¼Œè¿™ä¸ªè€—æ—¶æœ‰ç‚¹å¤¸å¼ äº†å•Šï¼Œç”Ÿäº§ç¯å¢ƒè¿™ä¹ˆä¸€æï¼Œå²‚ä¸æ˜¯åˆ†åˆ†é’Ÿå·é“ºç›–çš„èŠ‚å¥</p><ul><li>å¯ä»¥å€ŸåŠ© StopWatch æ¥æŸ¥çœ‹åˆ°åº•æ˜¯å“ªé‡Œçš„å¼€é”€å¢åŠ äº†è¿™ä¹ˆå¤š ï¼ˆå…³äº StopWatch çš„ä½¿ç”¨ï¼Œä¸‹ç¯‡ä»‹ç»ï¼‰</li><li>å•æ¬¡æ‰§è¡Œçš„ç»Ÿè®¡åå·®é—®é¢˜ï¼Œå°†ä¸Šé¢çš„è°ƒç”¨ï¼Œæ‰§è¡Œä¸€ç™¾éä¹‹åï¼Œå†çœ‹è€—æ—¶ï¼Œè¶‹äºå¹³è¡¡ï¼Œå¦‚ä¸‹å›¾</li></ul><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/c3fa3c026e67418e90a9367986331e45~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><h3 id="5-å°ç»“"><a href="#5-å°ç»“" class="headerlink" title="5. å°ç»“"></a>5. å°ç»“</h3><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å®ç°äº†æ¥å£ä¸Šæ³¨è§£çš„æ‹¦æˆªï¼Œè™½è¯´è§£å†³äº†æˆ‘ä»¬çš„éœ€æ±‚ï¼Œä½†æ˜¯ç–‘æƒ‘çš„åœ°æ–¹ä¾ç„¶æ²¡æœ‰ç­”æ¡ˆ</p><ul><li>ä¸ºå•¥æ¥å£ä¸Šçš„æ³¨è§£æ‹¦æˆªä¸åˆ° ï¼Ÿ</li><li>ä¸ºå•¥äº‹åŠ¡æ³¨è§£ï¼Œæ”¾åœ¨æ¥å£ä¸Šå¯ä»¥ç”Ÿæ•ˆï¼Œäº‹åŠ¡æ³¨è§£çš„å®ç°æœºåˆ¶æ˜¯æ€æ ·çš„ï¼Ÿ</li><li>è‡ªå®šä¹‰çš„åˆ‡ç‚¹ï¼Œå¯ä»¥é…åˆæˆ‘ä»¬çš„æ³¨è§£æ¥ç©ä¹ˆï¼Ÿ</li><li>ä¸ºä»€ä¹ˆé¦–æ¬¡æ‰§è¡Œæ—¶ï¼Œè€—æ—¶æ¯”è¾ƒå¤šï¼›å¤šæ¬¡æ‰§è¡Œä¹‹åï¼Œåˆ™è€—æ—¶è¶‹äºæ­£å¸¸ï¼Ÿ</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>æ³¨è§£</tag>
      
      <tag>AOP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JAVAåŒä¸€IPè®¿é—®åŒä¸€æ¥å£è¿›è¡Œé¢‘ç‡é™åˆ¶</title>
    <link href="/blog/2021/06/07/JAVA%E5%90%8C%E4%B8%80IP%E8%AE%BF%E9%97%AE%E5%90%8C%E4%B8%80%E6%8E%A5%E5%8F%A3%E8%BF%9B%E8%A1%8C%E9%A2%91%E7%8E%87%E9%99%90%E5%88%B6/"/>
    <url>/blog/2021/06/07/JAVA%E5%90%8C%E4%B8%80IP%E8%AE%BF%E9%97%AE%E5%90%8C%E4%B8%80%E6%8E%A5%E5%8F%A3%E8%BF%9B%E8%A1%8C%E9%A2%91%E7%8E%87%E9%99%90%E5%88%B6/</url>
    
    <content type="html"><![CDATA[<h4 id="1-å¦‚ä½•å¯¹åŒä¸€IPè®¿é—®åŒä¸€æ¥å£è¿›è¡Œæ¯ç§’ã€æ¯åˆ†é’Ÿã€æ¯å°æ—¶é¢‘ç‡é™åˆ¶"><a href="#1-å¦‚ä½•å¯¹åŒä¸€IPè®¿é—®åŒä¸€æ¥å£è¿›è¡Œæ¯ç§’ã€æ¯åˆ†é’Ÿã€æ¯å°æ—¶é¢‘ç‡é™åˆ¶" class="headerlink" title="1.å¦‚ä½•å¯¹åŒä¸€IPè®¿é—®åŒä¸€æ¥å£è¿›è¡Œæ¯ç§’ã€æ¯åˆ†é’Ÿã€æ¯å°æ—¶é¢‘ç‡é™åˆ¶"></a>1.å¦‚ä½•å¯¹åŒä¸€IPè®¿é—®åŒä¸€æ¥å£è¿›è¡Œæ¯ç§’ã€æ¯åˆ†é’Ÿã€æ¯å°æ—¶é¢‘ç‡é™åˆ¶</h4><p>è¯ä¸å¤šè¯´ï¼Œç›´æ¥å¼€å¹²ï¼Œé¦–å…ˆå†™ä¸€ä¸ªæ³¨è§£ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.lang.annotation.*;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ¥å£é™æµ</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> rs</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Inherited</span><br><span class="hljs-meta">@Documented</span><br><span class="hljs-meta">@Target(&#123;ElementType.FIELD,ElementType.TYPE,ElementType.METHOD&#125;)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> VisitLimit &#123;<br>    <span class="hljs-comment">//æ ‡è¯† æŒ‡å®šsecæ—¶é—´æ®µå†…çš„è®¿é—®æ¬¡æ•°é™åˆ¶</span><br>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">limit</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> 5</span>;  <br>    <span class="hljs-comment">//æ ‡è¯† æ—¶é—´æ®µ</span><br>    <span class="hljs-function"><span class="hljs-keyword">long</span> <span class="hljs-title">sec</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> 5</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨æ³¨è§£çš„åŸå› æ˜¯ï¼šæˆ‘ä»¬ä½¿ç”¨æ‹¦æˆªå™¨åœ¨è¯·æ±‚å¤„ç†ä¹‹å‰ï¼Œæ£€æŸ¥æŸä¸ªè¯·æ±‚æ¥å£æ˜¯å¦æœ‰è¯¥æ³¨è§£ï¼Œå¦‚æœæœ‰è¯¥æ³¨è§£ï¼Œè·å–è®¿é—®æ¬¡æ•°å’Œæ—¶é—´æ®µï¼ˆæ¯”å¦‚ï¼šåœ¨1sä¸­åªèƒ½è®¿é—®ä¸€æ¬¡ï¼‰ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥å†™ä¸€ä¸ªæ‹¦æˆªå™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.test.annotation.VisitLimit;<br><span class="hljs-keyword">import</span> org.test.exception.BusinessException;<br><span class="hljs-keyword">import</span> org.test.redis.RedisCache;<br><span class="hljs-keyword">import</span> org.test.service.redis.RedisService;<br><span class="hljs-keyword">import</span> org.test.util.IPUtils;<br><span class="hljs-keyword">import</span> org.test.util.RedisUtils;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><span class="hljs-keyword">import</span> org.springframework.web.method.HandlerMethod;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.ModelAndView;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.handler.HandlerInterceptorAdapter;<br><br><span class="hljs-keyword">import</span> javax.servlet.ServletOutputStream;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VisitLimitInterceptor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HandlerInterceptorAdapter</span> </span>&#123;<br> <br>    <span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> RedisUtils redisService;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¤„ç†è¯·æ±‚ä¹‹å‰è¢«è°ƒç”¨</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> request</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> response</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> handler</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-keyword">if</span> (handler <span class="hljs-keyword">instanceof</span> HandlerMethod) &#123;<br>            HandlerMethod handlerMethod = (HandlerMethod) handler;<br>            Method method = handlerMethod.getMethod();<br>            <span class="hljs-keyword">if</span> (!method.isAnnotationPresent(VisitLimit.class)) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>            &#125;<br>            VisitLimit accessLimit = method.getAnnotation(VisitLimit.class);<br>            <span class="hljs-keyword">if</span> (accessLimit == <span class="hljs-keyword">null</span>) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>            &#125;<br>            <span class="hljs-keyword">int</span> limit = accessLimit.limit();<br>            <span class="hljs-keyword">long</span> sec = accessLimit.sec();<br>            String key = IPUtils.getIpAddr(request) + request.getRequestURI();<br>            Integer maxLimit =<span class="hljs-keyword">null</span>;<br>            Object value =redisService.get(key);<br>            <span class="hljs-keyword">if</span>(value!=<span class="hljs-keyword">null</span> &amp;&amp; !value.equals(<span class="hljs-string">&quot;&quot;</span>)) &#123;<br>            maxLimit = Integer.valueOf(String.valueOf(value));<br>            &#125;<br>            <span class="hljs-keyword">if</span> (maxLimit == <span class="hljs-keyword">null</span>) &#123;<br>            redisService.set(key, <span class="hljs-string">&quot;1&quot;</span>, sec);<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (maxLimit &lt; limit) &#123;<br>            Integer i = maxLimit+<span class="hljs-number">1</span>;<br>            redisService.set(key, i.toString(), sec);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-comment">//              output(response, &quot;è¯·æ±‚å¤ªé¢‘ç¹!&quot;);</span><br><span class="hljs-comment">//            return false;</span><br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BusinessException(<span class="hljs-number">500</span>,<span class="hljs-string">&quot;è¯·æ±‚å¤ªé¢‘ç¹!&quot;</span>);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>    &#125;<br> <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">postHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br> <br>    &#125;<br> <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">afterCompletion</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br> <br>    &#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œç”¨åˆ°äº†redis,è§£é‡Šä¸€ä¸‹redisçš„keyï¼ˆIP+URLï¼‰è®°å½•äº†æŸä¸ªipè®¿é—®æŸä¸ªæ¥å£ï¼Œvalueå­˜çš„æ˜¯è®¿é—®çš„æ¬¡æ•°ï¼ŒåŠ ä¸Šä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œè¿‡æœŸæ—¶é—´å°±æ˜¯æˆ‘ä»¬åœ¨æ³¨è§£ä¸Šèµ‹å€¼çš„å€¼ã€‚</p><p>è¿™é‡Œçš„redisçš„éƒ¨åˆ†ä»£ç ä¹Ÿè´´å‡ºæ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RedisUtils</span> </span>&#123;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> RedisTemplate redisTemplate;<br><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å†™å…¥ç¼“å­˜è®¾ç½®æ—¶æ•ˆæ—¶é—´</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> expireTime æœ‰æ•ˆæ—¶é—´ï¼Œå•ä½ç§’</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">set</span><span class="hljs-params">(<span class="hljs-keyword">final</span> String key, Object value, Long expireTime)</span> </span>&#123;<br>        <span class="hljs-keyword">boolean</span> result = <span class="hljs-keyword">false</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            ValueOperations&lt;Serializable, Object&gt; operations = redisTemplate.opsForValue();<br>            operations.set(key, value);<br>            redisTemplate.expire(key, expireTime, TimeUnit.SECONDS);<br>            result = <span class="hljs-keyword">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>#æ€ä¹ˆè·å–ç”¨æˆ·çš„çœŸå®IPå‘¢???å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.slf4j.Logger;<br><span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;<br><br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * IP Utils</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> rs</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IPUtils</span> </span>&#123;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Logger logger = LoggerFactory.getLogger(IPUtils.class);<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è·å–IPåœ°å€</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> * ä½¿ç”¨Nginxç­‰åå‘ä»£ç†è½¯ä»¶ï¼Œ åˆ™ä¸èƒ½é€šè¿‡request.getRemoteAddr()è·å–IPåœ°å€</span><br><span class="hljs-comment"> * å¦‚æœä½¿ç”¨äº†å¤šçº§åå‘ä»£ç†çš„è¯ï¼ŒX-Forwarded-Forçš„å€¼å¹¶ä¸æ­¢ä¸€ä¸ªï¼Œè€Œæ˜¯ä¸€ä¸²IPåœ°å€ï¼ŒX-Forwarded-Forä¸­ç¬¬ä¸€ä¸ªéunknownçš„æœ‰æ•ˆIPå­—ç¬¦ä¸²ï¼Œåˆ™ä¸ºçœŸå®IPåœ°å€</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">getIpAddr</span><span class="hljs-params">(HttpServletRequest request)</span> </span>&#123;<br>    String ip = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            ip = request.getHeader(<span class="hljs-string">&quot;x-forwarded-for&quot;</span>);<br>         <span class="hljs-keyword">if</span> (ip != <span class="hljs-keyword">null</span> &amp;&amp; ip.length() != <span class="hljs-number">0</span> &amp;&amp; !<span class="hljs-string">&quot;unknown&quot;</span>.equalsIgnoreCase(ip)) &#123;<br>             <span class="hljs-comment">// å¤šæ¬¡åå‘ä»£ç†åä¼šæœ‰å¤šä¸ªipå€¼ï¼Œç¬¬ä¸€ä¸ªipæ‰æ˜¯çœŸå®ip</span><br>             <span class="hljs-keyword">if</span>( ip.indexOf(<span class="hljs-string">&quot;,&quot;</span>)!=-<span class="hljs-number">1</span> )&#123;<br>                 ip = ip.split(<span class="hljs-string">&quot;,&quot;</span>)[<span class="hljs-number">0</span>];<br>             &#125;<br>         &#125;<br>         <span class="hljs-keyword">if</span> (ip == <span class="hljs-keyword">null</span> || ip.length() == <span class="hljs-number">0</span> || <span class="hljs-string">&quot;unknown&quot;</span>.equalsIgnoreCase(ip)) &#123;<br>             ip = request.getHeader(<span class="hljs-string">&quot;Proxy-Client-IP&quot;</span>);<br>         &#125;<br>         <span class="hljs-keyword">if</span> (ip == <span class="hljs-keyword">null</span> || ip.length() == <span class="hljs-number">0</span> || <span class="hljs-string">&quot;unknown&quot;</span>.equalsIgnoreCase(ip)) &#123;<br>             ip = request.getHeader(<span class="hljs-string">&quot;WL-Proxy-Client-IP&quot;</span>);<br>         &#125;<br>         <span class="hljs-keyword">if</span> (ip == <span class="hljs-keyword">null</span> || ip.length() == <span class="hljs-number">0</span> || <span class="hljs-string">&quot;unknown&quot;</span>.equalsIgnoreCase(ip)) &#123;<br>             ip = request.getHeader(<span class="hljs-string">&quot;HTTP_CLIENT_IP&quot;</span>);<br>         &#125;<br>         <span class="hljs-keyword">if</span> (ip == <span class="hljs-keyword">null</span> || ip.length() == <span class="hljs-number">0</span> || <span class="hljs-string">&quot;unknown&quot;</span>.equalsIgnoreCase(ip)) &#123;<br>             ip = request.getHeader(<span class="hljs-string">&quot;HTTP_X_FORWARDED_FOR&quot;</span>);<br>         &#125;<br>         <span class="hljs-keyword">if</span> (ip == <span class="hljs-keyword">null</span> || ip.length() == <span class="hljs-number">0</span> || <span class="hljs-string">&quot;unknown&quot;</span>.equalsIgnoreCase(ip)) &#123;<br>             ip = request.getHeader(<span class="hljs-string">&quot;X-Real-IP&quot;</span>);<br>         &#125;<br>         <span class="hljs-keyword">if</span> (ip == <span class="hljs-keyword">null</span> || ip.length() == <span class="hljs-number">0</span> || <span class="hljs-string">&quot;unknown&quot;</span>.equalsIgnoreCase(ip)) &#123;<br>             ip = request.getRemoteAddr();<br>         &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        logger.error(<span class="hljs-string">&quot;IPUtils ERROR &quot;</span>, e);<br>        &#125;<br>        <br>        <span class="hljs-keyword">return</span> ip;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸‹é¢æ¥æ­£å¼ä½¿ç”¨ä¸€ä¸‹</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@VisitLimit</span>(limit = <span class="hljs-number">1</span>, sec = <span class="hljs-number">1</span>)<br><span class="hljs-variable">@RequestMapping</span>(value = <span class="hljs-string">&quot;/close&quot;</span>, method = RequestMethod.POST)<br></code></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼ä¸èƒ½å¾ˆå¥½çš„åº”å¯¹çªå‘è¯·æ±‚ï¼Œéœ€è¦å¯¹è¿™ä¸€ç±»æƒ…å½¢å¹³æ»‘å¤„ç†ï¼Œæ¯”å¦‚200mså¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼Œä¸‹é¢å°±åˆ°<strong>ä»¤ç‰Œæ¡¶</strong>å‡ºåœºäº†ï¼</p><h2 id="äºŒã€ä»¤ç‰Œæ¡¶å®æˆ˜ä»‹ç»"><a href="#äºŒã€ä»¤ç‰Œæ¡¶å®æˆ˜ä»‹ç»" class="headerlink" title="äºŒã€ä»¤ç‰Œæ¡¶å®æˆ˜ä»‹ç»"></a>äºŒã€ä»¤ç‰Œæ¡¶å®æˆ˜ä»‹ç»</h2><p>2.1 å…ˆæ¥ä¸ªæ€»ç»“å§ï¼Œè®©å¤§å®¶åˆ†æ¸…ä»€ä¹ˆæ—¶å€™ç”¨ä»¤ç‰Œæ¡¶ï¼Œä»€ä¹ˆæ—¶å€™ç”¨æ¼æ¡¶</p><ul><li>ä»¤ç‰Œæ¡¶ï¼šç”Ÿäº§ä¸€ä¸ªä»¤ç‰Œæ¶ˆè´¹ä¸€ä¸ª</li><li>æ¼æ¡¶ï¼š å¤„ç†å¤§æµé‡ï¼Œå¹¶ä¸”ä»¥å›ºå®šçš„é€Ÿåº¦å¹³æ»‘å¤„ç†</li></ul><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/14ff9094e5dd4cdcb351af00a3ce0f55~tplv-k3u1fbpfcp-zoom-1.image" alt="image.png"></p><p>ä½¿ç”¨åœºæ™¯ï¼šgetewayç½‘å…³</p><p>Bucket4jæ˜¯åŸºäºä»¤ç‰Œæ¡¶ç®—æ³•å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.test.gateway.filter.limit;<br><br><span class="hljs-keyword">import</span> java.time.Duration;<br><span class="hljs-keyword">import</span> java.util.Map;<br><span class="hljs-keyword">import</span> java.util.concurrent.ConcurrentHashMap;<br><br><span class="hljs-keyword">import</span> org.slf4j.Logger;<br><span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;<br><span class="hljs-keyword">import</span> org.springframework.cloud.gateway.filter.GatewayFilter;<br><span class="hljs-keyword">import</span> org.springframework.cloud.gateway.filter.GatewayFilterChain;<br><span class="hljs-keyword">import</span> org.springframework.core.Ordered;<br><span class="hljs-keyword">import</span> org.springframework.core.io.buffer.DataBuffer;<br><span class="hljs-keyword">import</span> org.springframework.http.HttpHeaders;<br><span class="hljs-keyword">import</span> org.springframework.http.server.reactive.ServerHttpRequest;<br><span class="hljs-keyword">import</span> org.springframework.http.server.reactive.ServerHttpResponse;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><span class="hljs-keyword">import</span> org.springframework.util.StringUtils;<br><span class="hljs-keyword">import</span> org.springframework.web.server.ServerWebExchange;<br><br><span class="hljs-keyword">import</span> io.github.bucket4j.Bandwidth;<br><span class="hljs-keyword">import</span> io.github.bucket4j.Bucket;<br><span class="hljs-keyword">import</span> io.github.bucket4j.Bucket4j;<br><span class="hljs-keyword">import</span> io.github.bucket4j.Refill;<br><span class="hljs-keyword">import</span> reactor.core.publisher.Mono;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RateLimitByIpFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">GatewayFilter</span>, <span class="hljs-title">Ordered</span> </span>&#123;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> Logger logger = LoggerFactory.getLogger(RateLimitByIpFilter.class);<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> capacity;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> refillTokens;<br><br><span class="hljs-keyword">private</span> Duration refillDuration;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&lt;String, Bucket&gt; CACHE = <span class="hljs-keyword">new</span> ConcurrentHashMap&lt;&gt;();<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">RateLimitByIpFilter</span><span class="hljs-params">()</span> </span>&#123;<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">RateLimitByIpFilter</span><span class="hljs-params">(<span class="hljs-keyword">int</span> capacity, <span class="hljs-keyword">int</span> refillTokens, Duration refillDuration)</span> </span>&#123;<br><span class="hljs-keyword">this</span>.capacity = capacity;<br><span class="hljs-keyword">this</span>.refillTokens = refillTokens;<br><span class="hljs-keyword">this</span>.refillDuration = refillDuration;<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title">filter</span><span class="hljs-params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> </span>&#123;<br>String ip = getIpAddr(exchange.getRequest());<br><span class="hljs-keyword">if</span> (ip.indexOf(<span class="hljs-string">&quot;192.168&quot;</span>) != -<span class="hljs-number">1</span> || ip.indexOf(<span class="hljs-string">&quot;172.31.202&quot;</span>) != -<span class="hljs-number">1</span>) &#123;<br><span class="hljs-keyword">return</span> chain.filter(exchange);<br>&#125;<br>Bucket bucket = CACHE.computeIfAbsent(ip, k -&gt; createNewBucket());<br>logger.info(<span class="hljs-string">&quot;é™é¢‘æ¥è®¿ip: &quot;</span> + ip + <span class="hljs-string">&quot;, å¯ç”¨ä»¤ç‰Œæ•°é‡ï¼š&quot;</span> + bucket.getAvailableTokens());<br><span class="hljs-keyword">if</span> (bucket.tryConsume(<span class="hljs-number">1</span>)) &#123;<br><span class="hljs-keyword">return</span> chain.filter(exchange);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-comment">// ä¸åˆæ³•(è¶…è¿‡é™æµ)</span><br>ServerHttpResponse response = exchange.getResponse();<br><span class="hljs-comment">// è®¾ç½®headers</span><br>HttpHeaders httpHeaders = response.getHeaders();<br>httpHeaders.add(<span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-string">&quot;application/json; charset=UTF-8&quot;</span>);<br>httpHeaders.add(<span class="hljs-string">&quot;Cache-Control&quot;</span>, <span class="hljs-string">&quot;no-store, no-cache, must-revalidate, max-age=0&quot;</span>);<br><span class="hljs-comment">// è®¾ç½®body</span><br>String warningStr = <span class="hljs-string">&quot;&#123;\&quot;code\&quot;:\&quot;500\&quot;,\&quot;message\&quot;:\&quot;è¶…è¿‡é™æµ\&quot;&#125;&quot;</span>;<br>DataBuffer bodyDataBuffer = response.bufferFactory().wrap(warningStr.getBytes());<br><span class="hljs-keyword">return</span> response.writeWith(Mono.just(bodyDataBuffer));<br>&#125;<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getOrder</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">return</span> -<span class="hljs-number">1000</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">private</span> Bucket <span class="hljs-title">createNewBucket</span><span class="hljs-params">()</span> </span>&#123;<br>Refill refill = Refill.of(refillTokens, refillDuration);<br>Bandwidth limit = Bandwidth.classic(capacity, refill);<br><span class="hljs-keyword">return</span> Bucket4j.builder().addLimit(limit).build();<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">getIpAddr</span><span class="hljs-params">(ServerHttpRequest request)</span> </span>&#123;<br>String ip = <span class="hljs-string">&quot;&quot;</span>;<br>String str = request.getHeaders().getFirst(<span class="hljs-string">&quot;x-forwarded-for&quot;</span>);<br><span class="hljs-keyword">if</span> (StringUtils.isEmpty(str)) &#123;<br>ip = request.getRemoteAddress().getAddress().getHostAddress();<br>logger.info(<span class="hljs-string">&quot;é€šè¿‡addressæ–¹å¼é™æµè·å–åˆ°çš„IPä¸ºï¼š&quot;</span> + ip);<br><span class="hljs-keyword">return</span> ip;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>String[] ips = str.split(<span class="hljs-string">&quot;,&quot;</span>);<br><span class="hljs-keyword">for</span> (String s : ips) &#123;<br><span class="hljs-keyword">if</span> (s.indexOf(<span class="hljs-string">&quot;192.168&quot;</span>) != -<span class="hljs-number">1</span> || s.indexOf(<span class="hljs-string">&quot;172.31.202&quot;</span>) != -<span class="hljs-number">1</span>) &#123;<br><span class="hljs-keyword">continue</span>;<br>&#125;<br>ip = ip + s + <span class="hljs-string">&quot;,&quot;</span>;<br>&#125;<br>ip = ip.substring(<span class="hljs-number">0</span>, ip.length() - <span class="hljs-number">1</span>);<br>logger.info(<span class="hljs-string">&quot;é€šè¿‡x-forwarded-foré™æµè·å–åˆ°çš„IPï¼Œä¸”è¿‡æ»¤æ‰å†…ç½‘åçš„åœ°å€ä¸ºï¼š&quot;</span> + ip);<br><span class="hljs-keyword">if</span> (ip.indexOf(<span class="hljs-string">&quot;,&quot;</span>) != -<span class="hljs-number">1</span>) &#123;<br>ip = ip.substring(<span class="hljs-number">0</span>, ip.indexOf(<span class="hljs-string">&quot;,&quot;</span>));<br><span class="hljs-keyword">return</span> ip.trim();<br>&#125;<br><span class="hljs-keyword">return</span> ip.trim();<br>&#125;<br>&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>é…ç½®route: TEST-AUTH/**çš„apiæ¥å£éƒ½ä¼šè·¯ç”±åˆ°TEST-AUTHæœåŠ¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GateWayApplication</span> </span>&#123;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>SpringApplication.run(GateWayApplication.class, args);<br>&#125;<br><br><span class="hljs-meta">@Bean</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> RouteLocator <span class="hljs-title">routeLocator</span><span class="hljs-params">(RouteLocatorBuilder builder)</span> </span>&#123;<br><span class="hljs-keyword">return</span> builder.routes()<br><span class="hljs-comment">// è®¤è¯ä¸­å¿ƒ</span><br>.route(r -&gt; r.path(<span class="hljs-string">&quot;/TEST-AUTH/**&quot;</span>)<br>.filters(f -&gt; f.stripPrefix(<span class="hljs-number">1</span>).filter(<span class="hljs-keyword">new</span> RateLimitByIpFilter(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, Duration.ofSeconds(<span class="hljs-number">1</span>))))<br>.uri(<span class="hljs-string">&quot;lb://TEST-AUTH&quot;</span>).id(<span class="hljs-string">&quot;TEST-AUTH&quot;</span>))<br>.build();<br>&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€åˆ†å¸ƒå¼é™æµï¼ˆè¿™é‡Œæ‘˜è‡ªäº¬ä¸œæŠ¢è´­ä¸šåŠ¡ï¼‰"><a href="#ä¸‰ã€åˆ†å¸ƒå¼é™æµï¼ˆè¿™é‡Œæ‘˜è‡ªäº¬ä¸œæŠ¢è´­ä¸šåŠ¡ï¼‰" class="headerlink" title="ä¸‰ã€åˆ†å¸ƒå¼é™æµï¼ˆè¿™é‡Œæ‘˜è‡ªäº¬ä¸œæŠ¢è´­ä¸šåŠ¡ï¼‰"></a>ä¸‰ã€åˆ†å¸ƒå¼é™æµï¼ˆè¿™é‡Œæ‘˜è‡ªäº¬ä¸œæŠ¢è´­ä¸šåŠ¡ï¼‰</h2><p>ä½¿ç”¨Redis+Luaçš„æ–¹å¼æ¥å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java">local key = <span class="hljs-string">&quot;rate.limit:&quot;</span> .. KEYS[<span class="hljs-number">1</span>] --é™æµKEY<br>local limit = tonumber(ARGV[<span class="hljs-number">1</span>])        --é™æµå¤§å°<br>local current = tonumber(redis.call(<span class="hljs-string">&#x27;get&#x27;</span>, key) or <span class="hljs-string">&quot;0&quot;</span>)<br><span class="hljs-keyword">if</span> current + <span class="hljs-number">1</span> &gt; limit then --å¦‚æœè¶…å‡ºé™æµå¤§å°<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br><span class="hljs-keyword">else</span>  --è¯·æ±‚æ•°+<span class="hljs-number">1</span>ï¼Œå¹¶è®¾ç½®<span class="hljs-number">1</span>ç§’è¿‡æœŸ<br>  redis.call(<span class="hljs-string">&quot;INCRBY&quot;</span>, key,<span class="hljs-string">&quot;1&quot;</span>)<br>   redis.call(<span class="hljs-string">&quot;expire&quot;</span>, key,<span class="hljs-string">&quot;1&quot;</span>)<br>   <span class="hljs-keyword">return</span>  <span class="hljs-number">1</span><br>end<br>å¤åˆ¶ä»£ç <br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">accquire</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException, URISyntaxException </span>&#123;<br>    Jedis jedis = <span class="hljs-keyword">new</span> Jedis(<span class="hljs-string">&quot;127.0.0.1&quot;</span>);<br>    File luaFile = <span class="hljs-keyword">new</span> File(RedisLimitRateWithLUA.class.getResource(<span class="hljs-string">&quot;/&quot;</span>).toURI().getPath() + <span class="hljs-string">&quot;limit.lua&quot;</span>);<br>    String luaScript = FileUtils.readFileToString(luaFile);<br><br>    String key = <span class="hljs-string">&quot;ip:&quot;</span> + System.currentTimeMillis()/<span class="hljs-number">1000</span>; <span class="hljs-comment">// å½“å‰ç§’</span><br>    String limit = <span class="hljs-string">&quot;5&quot;</span>; <span class="hljs-comment">// æœ€å¤§é™åˆ¶</span><br>    List&lt;String&gt; keys = <span class="hljs-keyword">new</span> ArrayList&lt;String&gt;();<br>    keys.add(key);<br>    List&lt;String&gt; args = <span class="hljs-keyword">new</span> ArrayList&lt;String&gt;();<br>    args.add(limit);<br>    Long result = (Long)(jedis.eval(luaScript, keys, args)); <span class="hljs-comment">// æ‰§è¡Œluaè„šæœ¬ï¼Œä¼ å…¥å‚æ•°</span><br>    <span class="hljs-keyword">return</span> result == <span class="hljs-number">1</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ç®€å•è¯´æ˜ä¸€ä¸‹ï¼šredis k = rate.limit:ip:å½“å‰ç§’ V: 5</p>]]></content>
    
    
    
    <tags>
      
      <tag>JAVA</tag>
      
      <tag>IP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¤šçº¿ç¨‹æ¡ä»¶ä¸‹åˆ†æ®µå¤„ç†Listé›†åˆ</title>
    <link href="/blog/2021/06/06/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%9D%A1%E4%BB%B6%E4%B8%8B%E5%88%86%E6%AE%B5%E5%A4%84%E7%90%86List%E9%9B%86%E5%90%88/"/>
    <url>/blog/2021/06/06/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%9D%A1%E4%BB%B6%E4%B8%8B%E5%88%86%E6%AE%B5%E5%A4%84%E7%90%86List%E9%9B%86%E5%90%88/</url>
    
    <content type="html"><![CDATA[<p>ç¬¬ä¸€æ¬¡æ¥è§¦åˆ°å¤šçº¿ç¨‹å¤„ç†åŒä¸€ä¸ªä»»åŠ¡ï¼Œæ˜¯ä½¿ç”¨IOå¤šçº¿ç¨‹ä¸‹è½½æ–‡ä»¶ï¼Œä¹‹åä¹Ÿä¸€ç›´æ²¡æœ‰å†å¤„ç†è¿™ä¸€å—çš„ä»»åŠ¡ï¼Œç›´åˆ°å‰å‡ å¤©æœ‰åŒäº‹é—®æˆ‘ï¼Œä¸ºä»€ä¹ˆå¤šçº¿ç¨‹å¤„ç†ä¸€ä¸ªlisté›†åˆä¼šå‡ºç°å„ç§bugï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨å¤šçº¿ç¨‹çš„æ–¹å¼å¤„ç†åŒä¸€ä¸ªlisté›†åˆã€‚</p><p>ç¬¬ä¸€ã€ä¸ºä»€ä¹ˆä¼šå‡ºç°ç±»ä¼¼äºé‡å¤å¤„ç†æŸä¸€ä¸ªæ¨¡å—çš„é—®é¢˜ï¼Ÿ</p><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œåœ¨Javaä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„å·¥ä½œå†…å­˜ï¼Œçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„æ‰€æœ‰æ“ä½œéƒ½å¿…é¡»åœ¨è‡ªå·±çš„å·¥ä½œå†…å­˜ä¸­è¿›è¡Œï¼Œä¸èƒ½ç›´æ¥ä»ä¸»å†…å­˜ä¸­è¯»å†™ã€‚</p><p>å¦‚æœçº¿ç¨‹1çš„ä¿®æ”¹å†…å®¹æƒ³è¢«çº¿ç¨‹2å¾—åˆ°ï¼Œé‚£ä¹ˆçº¿ç¨‹1å·¥ä½œå†…å­˜ä¸­ä¿®æ”¹åçš„å…±äº«å˜é‡éœ€è¦å…ˆåˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼Œå†æŠŠä¸»å†…å­˜ä¸­æ›´æ–°è¿‡çš„å…±äº«å˜é‡æ›´æ–°åˆ°å·¥ä½œå†…å­˜2ä¸­ã€‚</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/fd0ed7fd279d498fb0f7ceb8288fabc0~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p><p>è¿™ä¸ªæ—¶å€™ä¸€èˆ¬æˆ‘ä»¬æ˜¯è€ƒè™‘ä½¿ç”¨javaä¸­å„ç§åŒæ­¥åŒ–çš„æ–¹æ³•ï¼Œé¦–å…ˆï¼Œå› ä¸ºæ˜¯éœ€è¦é«˜æ•ˆå¤„ç†listé›†åˆï¼Œæ‰€ä»¥å¯ä»¥æ’é™¤synchronizedæ–¹æ³•ï¼Œäºæ˜¯æˆ‘æƒ³åˆ°äº†ä½¿ç”¨CompletionServiceæ“ä½œå¼‚æ­¥ä»»åŠ¡ã€‚</p><p>å¤§å®¶å¯ä»¥åœ¨è¿™ç¯‡æ–‡ç« çœ‹åˆ°å…·ä½“çš„è¯¦è§£ï¼š <a href="https://juejin.cn/post/6908882835235405832">ã€è¿›é˜¶ä¹‹è·¯ã€‘çº¿ç¨‹æ± æ‹“å±•ä¸CompletionServiceæ“ä½œå¼‚æ­¥ä»»åŠ¡</a></p><h2 id="ä¸€ã€CompletionService"><a href="#ä¸€ã€CompletionService" class="headerlink" title="ä¸€ã€CompletionService"></a>ä¸€ã€CompletionService</h2><p>é¦–å…ˆï¼ŒæŒ‰ç…§ä¹‹å‰æ–‡ç« çš„æ–¹æ³•è‡ªå®šä¹‰ä¸€ä¸ªWeedThreadPool</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs scala">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WeedThreadPool</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ThreadPoolExecutor</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ThreadLocal</span>&lt;<span class="hljs-type">Long</span>&gt; startTime =<span class="hljs-keyword">new</span> <span class="hljs-type">ThreadLocal</span>&lt;&gt;();<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> log =<span class="hljs-type">Logger</span>.getLogger(<span class="hljs-string">&quot;WeedThreadPool&quot;</span>);<br>    <span class="hljs-comment">//ç»Ÿè®¡æ‰§è¡Œæ¬¡æ•°</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">AtomicLong</span> numTasks =<span class="hljs-keyword">new</span> <span class="hljs-type">AtomicLong</span>();<br>    <span class="hljs-comment">//ç»Ÿè®¡æ€»æ‰§è¡Œæ—¶é—´</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">AtomicLong</span> totalTime =<span class="hljs-keyword">new</span> <span class="hljs-type">AtomicLong</span>();<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è¿™é‡Œæ˜¯å®ç°çº¿ç¨‹æ± çš„æ„é€ æ–¹æ³•ï¼Œæˆ‘éšä¾¿é€‰äº†ä¸€ä¸ªï¼Œå¤§å®¶å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚æ‰¾åˆ°åˆé€‚çš„æ„é€ æ–¹æ³•</span><br><span class="hljs-comment">     */</span><br>    public <span class="hljs-type">WeedThreadPool</span>(int corePoolSize, int maximumPoolSize, long keepAliveTime, <span class="hljs-type">TimeUnit</span> unit, <span class="hljs-type">BlockingQueue</span>&lt;<span class="hljs-type">Runnable</span>&gt; workQueue) &#123;<br>        <span class="hljs-keyword">super</span>(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ç„¶åå°±æ˜¯å®ç°çº¿ç¨‹æ± å¤„ç†listé›†åˆçš„æ–¹æ³•</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> WeedExecutorServiceDemo &#123;<br>    BlockingQueue&lt;Runnable&gt; taskQueue;<br>    final static WeedThreadPool weedThreadPool = <span class="hljs-built_in">new</span> WeedThreadPool(<span class="hljs-number">3</span>, <span class="hljs-number">10</span>, <span class="hljs-number">1</span>, TimeUnit.SECONDS, <span class="hljs-built_in">new</span> ArrayBlockingQueue&lt;Runnable&gt;(<span class="hljs-number">100</span>));<br>    // å¼€å§‹æ—¶é—´<br><br>    <span class="hljs-built_in">public</span> static <span class="hljs-type">void</span> main(String[] args) throws InterruptedException, ExecutionException &#123;<br>        //è®°å½•ä»»åŠ¡å¼€å§‹æ—¶é—´<br>        long start = <span class="hljs-keyword">System</span>.currentTimeMillis();<br>        CompletionService&lt;List&lt;<span class="hljs-type">Integer</span>&gt;&gt; cs = <span class="hljs-built_in">new</span> ExecutorCompletionService&lt;&gt;(weedThreadPool);<br>        <span class="hljs-type">int</span> tb=<span class="hljs-number">1</span>;<br>        //ç”Ÿæˆé›†åˆ<br>        List&lt;List&lt;<span class="hljs-type">Integer</span>&gt;&gt; list1 =<span class="hljs-built_in">new</span> ArrayList();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>            List&lt;<span class="hljs-type">Integer</span>&gt; list =<span class="hljs-built_in">new</span> ArrayList();<br>            //éšæœºç”Ÿæˆä»»åŠ¡å¤„ç†<br>            <span class="hljs-type">int</span> hb=tb;<br>            tb =tb*<span class="hljs-number">2</span>;<br>            <span class="hljs-type">int</span> finalTb = tb;<br>            cs.submit(<span class="hljs-built_in">new</span> Callable&lt;List&lt;<span class="hljs-type">Integer</span>&gt;&gt;()&#123;<br><br>                @Override<br>                <span class="hljs-built_in">public</span> List&lt;<span class="hljs-type">Integer</span>&gt; <span class="hljs-keyword">call</span>() throws <span class="hljs-keyword">Exception</span> &#123;<br>                    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = hb; j&lt; finalTb; j++)&#123;<br>                        list.<span class="hljs-keyword">add</span>(j);<br>                    &#125;<br>                    <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(Thread.currentThread().getName()+&quot;[&quot;+list+&quot;]&quot;);<br><br>                    <span class="hljs-keyword">return</span> list;<br>                &#125;<br>            &#125;);<br>        &#125;<br>        //æ³¨æ„åœ¨å¤„ç†å®Œæ¯•åç»“æŸä»»åŠ¡<br>        weedThreadPool.shutdown();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>            Future&lt;List&lt;<span class="hljs-type">Integer</span>&gt;&gt; future = cs.take();<br>            <span class="hljs-keyword">if</span> (future != <span class="hljs-keyword">null</span>) &#123;<br>                list1.<span class="hljs-keyword">add</span>(future.<span class="hljs-keyword">get</span>());<br>                <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(future.<span class="hljs-keyword">get</span>());<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">System</span>.err.println(&quot;æ‰§è¡Œä»»åŠ¡æ¶ˆè€—äº† ï¼š&quot; + (<span class="hljs-keyword">System</span>.currentTimeMillis() - <span class="hljs-keyword">start</span>) + &quot;æ¯«ç§’&quot;);<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(&quot;çµæœ[&quot;+list1.size()+&quot;]===&quot;+list1);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>å¤„ç†ç»“æœï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/55d934b7d65b4c41abd4f567529f9c5b~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p><p>ä»ç»“æœä¸Šæ¥çœ‹ï¼Œè¿˜æ˜¯æ¯”è¾ƒç¾å¥½çš„ï¼Œé€šè¿‡CompletionServiceèƒ½å¤Ÿæ¯”è¾ƒå¿«é€Ÿåœ°åˆ†æ®µå¤„ç†ä»»åŠ¡ï¼Œæˆ‘ä¹‹å‰ä¹Ÿæœ‰æè¿‡ï¼Œåˆç†çš„çº¿ç¨‹æ± å¤§å°è®¾è®¡æœ‰åŠ©äºæé«˜ä»»åŠ¡çš„å¤„ç†æ•ˆç‡ï¼Œç½‘ä¸Šé€šç”¨çš„è®¾ç½®æ–¹æ³•ä¸€èˆ¬æ˜¯è¿™æ ·çš„ï¼š</p><blockquote><p>æœ€ä½³çº¿ç¨‹æ•°ç›® = ï¼ˆï¼ˆçº¿ç¨‹ç­‰å¾…æ—¶é—´+çº¿ç¨‹CPUæ—¶é—´ï¼‰/çº¿ç¨‹CPUæ—¶é—´ ï¼‰* CPUæ•°ç›®</p></blockquote><p>è¿›è€Œå¾—å‡º</p><blockquote><p>æœ€ä½³çº¿ç¨‹æ•°ç›® = ï¼ˆçº¿ç¨‹ç­‰å¾…æ—¶é—´ä¸çº¿ç¨‹CPUæ—¶é—´ä¹‹æ¯” + 1ï¼‰* CPUæ•°ç›®</p></blockquote><h2 id="äºŒã€ForkJoinPool"><a href="#äºŒã€ForkJoinPool" class="headerlink" title="äºŒã€ForkJoinPool"></a>äºŒã€ForkJoinPool</h2><p>å½“ç„¶ï¼Œé™¤äº†ä½¿ç”¨CompletionServiceä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ForkJoinPoolæ¥è®¾è®¡ä¸€ä¸ªå¤„ç†æ–¹æ³•ã€‚</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/4f251ca321074c22b4f3a09df402a5cf~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p><p>ForkJoinPoolå’ŒThreadPoolExecutoréƒ½æ˜¯ç»§æ‰¿è‡ªAbstractExecutorServiceæŠ½è±¡ç±»ï¼Œæ‰€ä»¥å®ƒå’ŒThreadPoolExecutorçš„ä½¿ç”¨å‡ ä¹æ²¡æœ‰å¤šå°‘åŒºåˆ«ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯å°†å¤§çš„ä»»åŠ¡æ‹†åˆ†æˆå¤šä¸ªå°ä»»åŠ¡ï¼Œç„¶ååœ¨å°†å¤šä¸ªå°ä»»åŠ¡å¤„ç†æ±‡æ€»åˆ°ä¸€ä¸ªç»“æœä¸Šã€‚</p><p>ForkJoinPoolæ¡†æ¶é€šè¿‡åˆå§‹åŒ–ForkJoinTaskæ¥æ‰§è¡Œä»»åŠ¡ï¼Œå¹¶æä¾›äº†ä»¥ä¸‹ä¸¤ä¸ªå­ç±»ï¼š</p><ul><li><strong>RecursiveAction</strong>ï¼šç”¨äºæ²¡æœ‰è¿”å›ç»“æœçš„ä»»åŠ¡ã€‚</li><li><strong>RecursiveTask</strong> ï¼šç”¨äºæœ‰è¿”å›ç»“æœçš„ä»»åŠ¡ã€‚</li></ul><p>æˆ‘ä»¬å®ç°çš„è¿‡ç¨‹ä¸­å¯ä»¥ä½¿ç”¨RecursiveTaskæ–¹æ³•æ¥åˆ†æ®µå¤„ç†listé›†åˆã€‚</p><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs processing"><span class="hljs-keyword">public</span> class RecursiveTaskDemo &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ExecutorService executor = <span class="hljs-keyword">new</span> ThreadPoolExecutor(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">10</span>, TimeUnit.SECONDS, <span class="hljs-keyword">new</span> LinkedBlockingQueue(<span class="hljs-number">10</span>));<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> totalRow = <span class="hljs-number">53000</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> splitRow = <span class="hljs-number">10000</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> main(<span class="hljs-keyword">String</span>[] args) <span class="hljs-keyword">throws</span> InterruptedException, ExecutionException &#123;<br>        <span class="hljs-keyword">long</span> start = System.currentTimeMillis();<br>        <span class="hljs-comment">//å…ˆå¾ªç¯ç”Ÿæˆå¾…å¾…å¤„ç†é›†åˆ</span><br>        List&lt;Integer&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;(totalRow);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; totalRow; i++) &#123;<br>            list.<span class="hljs-built_in">add</span>(i);<br>        &#125;<br>        <span class="hljs-comment">//è®¡ç®—å‡ºéœ€è¦åˆ›å»ºçš„ä»»åŠ¡æ•°</span><br>        <span class="hljs-built_in">int</span> loopNum = (<span class="hljs-built_in">int</span>)Math.<span class="hljs-built_in">ceil</span>((<span class="hljs-keyword">double</span>)totalRow/splitRow);<br>        ForkJoinPool pool = <span class="hljs-keyword">new</span> ForkJoinPool(loopNum);<br>        ForkJoinTask&lt;List&gt; submit = pool.submit(<span class="hljs-keyword">new</span> MyTask(list, <span class="hljs-number">0</span>, list.<span class="hljs-built_in">size</span>()));<br><br>        List&lt;List&lt;Integer&gt;&gt;list1=<span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>        list1.<span class="hljs-built_in">add</span>(submit.<span class="hljs-built_in">get</span>());<br>        System.err.<span class="hljs-built_in">println</span>(<span class="hljs-string">&quot;æ‰§è¡Œä»»åŠ¡æ¶ˆè€—äº† ï¼š&quot;</span> + (System.currentTimeMillis() - start) + <span class="hljs-string">&quot;æ¯«ç§’&quot;</span>);<br>        System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">&quot;çµæœ[&quot;</span>+list1.<span class="hljs-built_in">size</span>()+<span class="hljs-string">&quot;]===&quot;</span>+list1);<br>    &#125;<br>    <span class="hljs-comment">//ç»§æ‰¿RecursiveTask</span><br>    <span class="hljs-keyword">static</span> class MyTask extends RecursiveTask&lt;List&gt; &#123;<br>        <span class="hljs-keyword">private</span> List&lt;Integer&gt; list;<br>        <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> startRow;<br>        <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> endRow;<br><br>        <span class="hljs-keyword">public</span> MyTask(List&lt;Integer&gt; list, <span class="hljs-built_in">int</span> startRow, <span class="hljs-built_in">int</span> endRow) &#123;<br>            <span class="hljs-keyword">this</span>.list = list;<br>            <span class="hljs-keyword">this</span>.startRow = startRow;<br>            <span class="hljs-keyword">this</span>.endRow = endRow;<br>        &#125;<br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * é€’å½’å¤„ç†æ•°æ®ï¼Œè®¡ç®—</span><br><span class="hljs-comment">         * @return</span><br><span class="hljs-comment">         */</span><br>        @Override<br>        <span class="hljs-keyword">protected</span> List compute() &#123;<br>            <span class="hljs-keyword">if</span> (endRow - startRow &lt;= splitRow) &#123;<br>                List&lt;Integer&gt; ret = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>                <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = startRow; i &lt; endRow; i++) &#123;<br>                    <span class="hljs-comment">//é€’å½’å¤„ç†æ•°æ®</span><br>                    ret.<span class="hljs-built_in">add</span>(list.<span class="hljs-built_in">get</span>(i));<br>                &#125;<br>                System.out.<span class="hljs-built_in">println</span>(Thread.currentThread().getName()+<span class="hljs-string">&quot;[&quot;</span>+ret+<span class="hljs-string">&quot;]&quot;</span>);<br>                <span class="hljs-keyword">return</span> ret;<br>            &#125;<br>            <span class="hljs-built_in">int</span> loopNum = (<span class="hljs-built_in">int</span>)Math.<span class="hljs-built_in">ceil</span>((<span class="hljs-keyword">double</span>)totalRow/splitRow);<br>            <span class="hljs-built_in">int</span> startRow = <span class="hljs-number">0</span>;<br>            List&lt;MyTask&gt; myTaskList = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>            <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; loopNum; i++) &#123;<br>                <span class="hljs-keyword">if</span> (startRow &gt; totalRow) &#123;<br>                    <span class="hljs-keyword">break</span>;<br>                &#125;<br>                <span class="hljs-built_in">int</span> endRow = Math.<span class="hljs-built_in">min</span>(startRow + splitRow, totalRow);<br>                System.out.<span class="hljs-built_in">println</span>(<span class="hljs-keyword">String</span>.format(<span class="hljs-string">&quot;startRowï¼š%s, endRow:%s&quot;</span>, startRow, endRow));<br>                myTaskList.<span class="hljs-built_in">add</span>(<span class="hljs-keyword">new</span> MyTask(list, startRow, endRow));<br>                startRow += splitRow;<br>            &#125;<br>            <span class="hljs-comment">//è°ƒç”¨ä¸åŒçº¿ç¨‹ä¸Šç‹¬ç«‹æ‰§è¡Œçš„ä»»åŠ¡</span><br>            invokeAll(myTaskList);<br>            List&lt;Integer&gt; ret = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>            <span class="hljs-comment">//å½’å¹¶</span><br>            <span class="hljs-keyword">for</span> (MyTask myTask : myTaskList) &#123;<br>                ret.addAll(myTask.<span class="hljs-built_in">join</span>());<br>            &#125;<br>            <span class="hljs-keyword">return</span> ret;<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>å¤„ç†ç»“æœï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/5f4bebd2dd974fcdb763dc602a87b5c4~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p><p>é€šè¿‡ä¸Šæ–‡å±•ç¤ºçš„æ–¹æ³•ï¼Œå¤§å®¶å¯ä»¥åœ¨ä¸åŠ é”çš„æ–¹å¼æ¥å¢åŠ ä»»åŠ¡å¤„ç†çš„æ•ˆç‡ï¼Œé‡åˆ°ç±»ä¼¼äºçˆ¬è™«æ•°æ®å¤„ç†ã€æ•°æ®è¿ç§»ç­‰åœºæ™¯éƒ½å¯ä»¥é‡‡ç”¨ï¼Œå®æµ‹æ•ˆæœè¿˜ä¸é”™ã€‚å½“ç„¶ï¼Œæ ¹æ®å¤„ç†ç»“æœæ¥åˆ†æï¼ŒCompletionServiceçš„æ•ˆç‡å¤§æ¦‚æ›´é«˜ä¸€äº›~ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>List</tag>
      
      <tag>å¤šçº¿ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>GraphicsMagickæ–‡å­—æ°´å°åŠä¸­æ–‡ä¹±ç </title>
    <link href="/blog/2021/06/05/GraphicsMagick%E6%96%87%E5%AD%97%E6%B0%B4%E5%8D%B0%E5%8F%8A%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81/"/>
    <url>/blog/2021/06/05/GraphicsMagick%E6%96%87%E5%AD%97%E6%B0%B4%E5%8D%B0%E5%8F%8A%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81/</url>
    
    <content type="html"><![CDATA[<blockquote><p><strong>éœ€æ±‚èƒŒæ™¯ï¼š</strong> å›¾ç‰‡æœåŠ¡éœ€è¦æä¾›æ–‡å­—æ°´å°åŠŸèƒ½ã€‚æ”¯æŒè‡ªå®šä¹‰å­—ä½“é¢œè‰²ã€ç±»å‹ã€é€æ˜åº¦ä»¥åŠæ°´å°ä½ç½®ï¼Œå¯¹å¤–æš´éœ²çš„å­—ä½“ç±»å‹æ˜¯ï¼šæ¥·ä½“ã€å®‹ä½“ã€é»‘ä½“ã€‚</p></blockquote><p>è¿™éœ€æ±‚çœ‹ä¼¼å¾ˆç®€å•ï¼Œå…¶å®ä¼šæœ‰å¾ˆå¤šå‘ã€‚ä¸‹é¢ä¸€èµ·æ¥çœ‹ä¸‹ã€‚<code>ä¸‹é¢æ˜¯ä¸ªäººåœ¨å®ç°è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ï¼Œåœ¨æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ä»¥åŠç›¸åº”åšå®¢ä¸‹å¹¶æ²¡æœ‰æ‰¾åˆ°å¾ˆå¥½çš„è§£å†³åŠæ³•ï¼Œå¦‚æœå…¶ä»–å¤§ä½¬æœ‰æ›´å¥½çš„å®ç°ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºä¸€èµ·è®¨è®ºã€‚</code></p><p><strong>å®˜æ–¹æ–‡æ¡£ï¼š</strong></p><ul><li><a href="http://www.graphicsmagick.org/convert.html">www.graphicsmagick.org/convert.htmâ€¦</a></li><li><a href="http://www.graphicsmagick.org/composite.html">www.graphicsmagick.org/composite.hâ€¦</a></li></ul><h2 id="æ–‡å­—æ°´å°"><a href="#æ–‡å­—æ°´å°" class="headerlink" title="æ–‡å­—æ°´å°"></a>æ–‡å­—æ°´å°</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gm convert -font <span class="hljs-variable">$&#123;fontType&#125;</span> -fill <span class="hljs-variable">$&#123;color&#125;</span> -pointsize <span class="hljs-variable">$&#123;fontSize&#125;</span> -draw <span class="hljs-string">&quot;text <span class="hljs-variable">$&#123;dx&#125;</span>,<span class="hljs-variable">$&#123;dy&#125;</span> &#x27;<span class="hljs-variable">$&#123;textContent&#125;</span>&#x27;&quot;</span> <span class="hljs-variable">$&#123;sourceImgPath&#125;</span> <span class="hljs-variable">$&#123;distImgPath&#125;</span><br></code></pre></td></tr></table></figure><h3 id="å‚æ•°è§£æ"><a href="#å‚æ•°è§£æ" class="headerlink" title="å‚æ•°è§£æ"></a>å‚æ•°è§£æ</h3><table><thead><tr><th>å‚æ•°</th><th>å®šä¹‰</th></tr></thead><tbody><tr><td>fontType</td><td>å­—ä½“ç±»å‹</td></tr><tr><td>color</td><td>å­—ä½“é¢œè‰²</td></tr><tr><td>fontSize</td><td>å­—ä½“å¤§å°</td></tr><tr><td>dx</td><td>æ°´å°ä½ç½®</td></tr><tr><td>dy</td><td>æ°´å°ä½ç½®</td></tr><tr><td>textContent</td><td>æ–‡å­—å†…å®¹</td></tr><tr><td>sourceImgPath</td><td>æºå›¾ç‰‡è·¯å¾„</td></tr><tr><td>distImgPath</td><td>ç›®æ ‡å›¾ç‰‡è·¯å¾„</td></tr></tbody></table><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>åŸå›¾å¤–ç½‘è®¿é—®åœ°å€ï¼š<a href="https://cvte-dev-public.seewo.com/shan-test/f60e65b7440840708c3bc827d69adcca">cvte-dev-public.seewo.com/shan-test/fâ€¦</a></p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/5967579d657a4dc0afb751b5c38a422a~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p><ul><li><p>è‹±æ–‡æ–‡å­—æ°´å°</p><ul><li>æµ‹è¯•å‘½ä»¤ï¼š<code>gm convert -font Helvetica -fill red -pointsize 50 -draw &quot;text 100,100 &#39;Hello World&#39;&quot; example.jpg test.jpg</code></li></ul><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/56647254ca2349609d735619a64f2201~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p></li><li><p>ä¸­æ–‡æ–‡å­—æ°´å°ï¼ˆä¹±ç ï¼‰</p><ul><li>æµ‹è¯•å‘½ä»¤ï¼š<code>gm convert -font Helvetica -fill red -pointsize 50 -draw &quot;text 100,100 &#39;ä½ å¥½&#39;&quot; example.jpg test.jpg</code></li></ul><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/f5190b02a11446a4b13b322435b30abe~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p></li></ul><h3 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h3><ul><li><p>é¦–å…ˆå‡ºç°ä¸­æ–‡ä¹±ç åº”è¯¥æ˜¯æˆ‘ä»¬æœ¬æœºç¯å¢ƒçš„å­—ä½“åº“é—®é¢˜ï¼Œä½†æ˜¯æˆ‘macç”µè„‘ä¸Šçš„å­—ä½“é›†æ˜¯æ”¯æŒä¸­æ–‡å­—ä½“çš„ï¼Œæ›´æ¢å­—ä½“ç±»å‹å¹¶ä¸èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p></li><li><p>ç›®å‰æ–‡å­—æ°´å°çš„å‘½ä»¤æ˜¯å¦å¯ä»¥æ»¡è¶³éœ€æ±‚ï¼Ÿ</p><ul><li><p>æŸ¥çœ‹æ–‡æ¡£ï¼Œæ²¡æœ‰æ‰¾åˆ°å¯ä»¥æŒ‡å®šæ–‡å­—é€æ˜åº¦</p></li><li><p>æ–‡å­—ä½ç½®å¯¹æ¯”ç°æœ‰æœåŠ¡å•†çš„æ°´å°ä½ç½®æœ‰å‡ºå…¥ï¼š</p><ul><li><p>æµ‹è¯•ç”¨ä¾‹ï¼šå­—ä½“å¤§å°50pxã€ä½ç½®ï¼ˆ100,100ï¼‰ï¼Œçº¢è‰²å­—ä½“</p><ul><li><a href="https://cvte-dev-public.seewo.com/shan-test/f6a3b5adab244a3b9b19624b3ec32144">é˜¿é‡Œäº‘æ°´å°æ•ˆæœ</a></li></ul><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/ca9b9b3bebf246b8a75898a6e75518c1~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p><ul><li><a href="https://store-tg1.cvte.com/shan-test/ef3593ea21594c588ed91437e9f7ae21">ä¸ƒç‰›äº‘æ°´å°æ•ˆæœ</a></li></ul><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/2246c4f57d6d4b309fb4f184e8ab1bee~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p></li></ul></li></ul></li><li><p><strong>æ€»ç»“ï¼š</strong> ç›®å‰æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼Œå¹¶æœªæ‰¾åˆ°å¯¹äºæ–‡å­—æ°´å°é€æ˜åº¦çš„å‚æ•°è®¾ç½®ï¼Œä»¥åŠæ–‡å­—æ°´å°çš„ä½ç½®ä¸é¢„æœŸä½ç½®ç›¸å·®è¾ƒå¤§ã€‚è¿™ç§æ–¹å¼æ— æ³•æ»¡è¶³éœ€æ±‚ï¼Œè€Œä¸”éœ€è¦è§£å†³ä¸­æ–‡ä¹±ç é—®é¢˜ï¼Œæ‰€ä»¥æš‚æ—¶ä¸å†å¾€æ–‡å­—æ°´å°å‘½ä»¤çš„æ–¹å‘å»å°è¯•ã€‚ç›®å‰çš„æƒ³æ³•æ˜¯ï¼šå…ˆæ ¹æ®æ–‡å­—ç”Ÿæˆé€æ˜çš„ä¸´æ—¶å›¾ç‰‡ï¼Œå†å°†ä¸´æ—¶å›¾ç‰‡ä½œä¸ºå›¾ç‰‡æ°´å°æ‰“åˆ°åŸå›¾ä¸Šï¼Œè¿™ç§æ–¹å¼å¯ä»¥è®¾ç½®é€æ˜åº¦ã€‚</p></li></ul><h2 id="å›¾ç‰‡æ°´å°"><a href="#å›¾ç‰‡æ°´å°" class="headerlink" title="å›¾ç‰‡æ°´å°"></a>å›¾ç‰‡æ°´å°</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gm composite -gravity <span class="hljs-variable">$&#123;gravity&#125;</span> -dissolve <span class="hljs-variable">$&#123;dissolve&#125;</span> -geometry +<span class="hljs-variable">$&#123;dx&#125;</span>+<span class="hljs-variable">$&#123;dy&#125;</span> <span class="hljs-variable">$&#123;tmpImgPath&#125;</span> <span class="hljs-variable">$&#123;sourceImgPath&#125;</span> <span class="hljs-variable">$&#123;distImgPath&#125;</span><br></code></pre></td></tr></table></figure><h3 id="å‚æ•°è§£æ-1"><a href="#å‚æ•°è§£æ-1" class="headerlink" title="å‚æ•°è§£æ"></a>å‚æ•°è§£æ</h3><table><thead><tr><th>å‚æ•°</th><th>å®šä¹‰</th><th>å‚æ•°èŒƒå›´</th></tr></thead><tbody><tr><td>gravity</td><td>æ°´å°ç›¸å¯¹ä½ç½®</td><td>NorthWestï¼šå·¦ä¸Š   Northï¼šä¸­ä¸Š   NorthEastï¼šå³ä¸Š   Westï¼šå·¦ä¸­   Centerï¼šä¸­éƒ¨   Eastï¼šå³ä¸­   SouthWestï¼šå·¦ä¸‹   Southï¼šä¸­ä¸‹   SouthEastï¼šå³ä¸‹</td></tr><tr><td>dissolve</td><td>æ°´å°é€æ˜åº¦</td><td>[1, 100]   é»˜è®¤å€¼ï¼š100ï¼Œä¸é€æ˜</td></tr><tr><td>dx</td><td>æŒ‡å®šæ°´å°çš„æ°´å¹³è¾¹è·ï¼Œ å³è·ç¦»å›¾ç‰‡è¾¹ç¼˜çš„æ°´å¹³è·ç¦»ã€‚è¿™ä¸ªå‚æ•°åªæœ‰å½“æ°´å°ä½ç½®æ˜¯å·¦ä¸Šã€å·¦ä¸­ã€å·¦ä¸‹ã€å³ä¸Šã€å³ä¸­ã€å³ä¸‹æ‰æœ‰æ„ä¹‰</td><td></td></tr><tr><td>dy</td><td>æŒ‡å®šæ°´å°çš„å‚ç›´è¾¹è·ï¼Œå³è·ç¦»å›¾ç‰‡è¾¹ç¼˜çš„å‚ç›´è·ç¦»ï¼Œ è¿™ä¸ªå‚æ•°åªæœ‰å½“æ°´å°ä½ç½®æ˜¯å·¦ä¸Šã€ä¸­ä¸Šã€å³ä¸Šã€å·¦ä¸‹ã€ä¸­ä¸‹ã€å³ä¸‹æ‰æœ‰æ„ä¹‰</td><td></td></tr><tr><td>tmpImgPath</td><td>ä¸´æ—¶å›¾ç‰‡çš„è·¯å¾„</td><td></td></tr><tr><td>sourceImgPath</td><td>æºå›¾ç‰‡è·¯å¾„</td><td></td></tr><tr><td>distImgPath</td><td>ç›®æ ‡å›¾ç‰‡è·¯å¾„</td><td></td></tr></tbody></table><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/a2666f43407c46958b5da37c958d41fe~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p><h3 id="ç¤ºä¾‹-1"><a href="#ç¤ºä¾‹-1" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>äº‹å…ˆç”Ÿæˆäº†ä¸´æ—¶æ–‡ä»¶ï¼ˆåé¢å†æ•™ä½ ä»¬æ€ä¹ˆç©ï¼‰ï¼š<a href="https://cvte-dev-public.seewo.com/shan-test/b949becb4a064f989693026302f242ca">text.png</a></p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/db0c061e7c2b4b18927892ec530a8c60~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p><p>å›¾ç‰‡å¤„ç†å‘½ä»¤ï¼š<code>gm composite -gravity NorthWest -dissolve 100 -geometry +100+100 text.png example.jpg test.jpg</code></p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e179c8c6f6994a1e9c718562de71efb5~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p><p><strong>ä½ç½®å¯¹äº†ï¼</strong> é‚£æ¥ä¸‹æ¥å°±æ˜¯è§£å†³<strong>ä¸­æ–‡ä¹±ç é—®é¢˜</strong>äº†ï¼Œç”Ÿæˆä¸´æ—¶æ–‡å­—å›¾ç‰‡è¿˜æ˜¯éœ€è¦è§£å†³å­—ä½“åº“é—®é¢˜ã€‚</p><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><h3 id="1ã€å®‰è£…å­—ä½“åº“"><a href="#1ã€å®‰è£…å­—ä½“åº“" class="headerlink" title="1ã€å®‰è£…å­—ä½“åº“"></a>1ã€å®‰è£…å­—ä½“åº“</h3><p>ä¸ºäº†æ–¹ä¾¿ç®¡ç†ï¼Œæˆ‘ç›´æ¥æŠŠéœ€è¦çš„å­—ä½“é›†æ”¾åˆ°é¡¹ç›®ä¸­ï¼Œåœ¨é¡¹ç›®å¯åŠ¨æ—¶ï¼Œå°†å­—ä½“é›†æ‹·è´åˆ°æ“ä½œç³»ç»Ÿï¼Œå¹¶è¿›è¡Œ Map æ˜ å°„ã€‚</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/9e90e89b9e9d4d4aa48995a4bc03d8b2~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p><blockquote><p>å­—ä½“é›†æ–‡ä»¶éœ€è¦å¯ä»¥è‡ªå–ï¼š</p><ul><li><a href="https://cvte-dev-public.seewo.com/shan-test/f779c1d3572d4a6fb533c102c6cebe42">HeiTi.ttc</a>ï¼ˆé»‘ä½“ï¼‰</li><li><a href="https://cvte-dev-public.seewo.com/shan-test/b0f8219d926d4632aa1a60f57d74176e">KaiTi.ttf</a>ï¼ˆæ¥·ä½“ï¼‰</li><li><a href="https://cvte-dev-public.seewo.com/shan-test/2c249a668d634d09b9986368c32d93b6">SongTi.ttc</a>ï¼ˆå®‹ä½“ï¼‰</li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ç”Ÿæˆé»˜è®¤çš„ä¸­æ–‡å­—ä½“</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ChineseFontComponent</span> </span>&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Map&lt;String, Font&gt; chineseFontMap;<br><br>    <span class="hljs-meta">@PostConstruct</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initFont</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        chineseFontMap = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br>        String heiTiFontPath = <span class="hljs-string">&quot;font/HeiTi.ttc&quot;</span>;<br>        String kaiTiFontPath = <span class="hljs-string">&quot;font/KaiTi.ttf&quot;</span>;<br>        String songTiFontPath = <span class="hljs-string">&quot;font/SongTi.ttc&quot;</span>;<br>        createChineseFont(<span class="hljs-string">&quot;HeiTi&quot;</span>, heiTiFontPath);<br>        createChineseFont(<span class="hljs-string">&quot;KaiTi&quot;</span>, kaiTiFontPath);<br>        createChineseFont(<span class="hljs-string">&quot;SongTi&quot;</span>, songTiFontPath);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆ›å»ºä¸­æ–‡å­—ä½“</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key       å­—ä½“ç±»å‹çš„key</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> fontPath  å­—ä½“è·¯å¾„</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">createChineseFont</span><span class="hljs-params">(String key, String fontPath)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        log.info(<span class="hljs-string">&quot;åˆå§‹åŒ–ä¸­æ–‡å­—ä½“: &#123;&#125;, path: &#123;&#125;&quot;</span>, key, fontPath);<br>        InputStream fisInJar = <span class="hljs-keyword">new</span> ClassPathResource(fontPath).getInputStream();<br>        File file = File.createTempFile(<span class="hljs-string">&quot;Font-&quot;</span>, <span class="hljs-string">&quot;.ttf&quot;</span>);<br>        <span class="hljs-comment">//å°†jaråŒ…é‡Œçš„å­—ä½“æ–‡ä»¶å¤åˆ¶åˆ°æ“ä½œç³»ç»Ÿçš„ç›®å½•é‡Œ</span><br>        OutputStream fosInOs = <span class="hljs-keyword">new</span> FileOutputStream(file);<br>        <span class="hljs-keyword">byte</span>[] buffer = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">1024</span>];<br>        <span class="hljs-keyword">int</span> readLength = fisInJar.read(buffer);<br>        <span class="hljs-keyword">while</span> (readLength != -<span class="hljs-number">1</span>) &#123;<br>            fosInOs.write(buffer, <span class="hljs-number">0</span>, readLength);<br>            readLength = fisInJar.read(buffer);<br>        &#125;<br>        IOUtils.closeQuietly(fosInOs);<br>        IOUtils.closeQuietly(fisInJar);<br>        Font font;<br>        <span class="hljs-keyword">try</span> &#123;<br>            font = Font.createFont(Font.TRUETYPE_FONT, file);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            log.error(<span class="hljs-string">&quot;åŠ è½½é»˜è®¤ä¸­æ–‡å­—ä½“å¤±è´¥&quot;</span>, e);<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ImageServiceException(ErrorCode.COMMON_SERVER_ERROR, <span class="hljs-string">&quot;åŠ è½½é»˜è®¤ä¸­æ–‡å­—ä½“å¤±è´¥: &quot;</span>+e.getMessage());<br>        &#125;<br>        chineseFontMap.put(key, font);<br>        log.info(<span class="hljs-string">&quot;åˆå§‹åŒ–ä¸­æ–‡å­—ä½“å®Œæˆ: &#123;&#125;&quot;</span>, key);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·å–ä¸­æ–‡å­—ä½“</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Font <span class="hljs-title">getChineseFont</span><span class="hljs-params">(String key)</span> </span>&#123;<br>        Font font = chineseFontMap.get(key);<br>        <span class="hljs-keyword">return</span> font == <span class="hljs-keyword">null</span> ? chineseFontMap.get(FontTypeEnum.KaiTi.toString()) : font;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2ã€å°†æ–‡å­—è½¬æ¢ä¸ºé€æ˜çš„ä¸´æ—¶å›¾ç‰‡"><a href="#2ã€å°†æ–‡å­—è½¬æ¢ä¸ºé€æ˜çš„ä¸´æ—¶å›¾ç‰‡" class="headerlink" title="2ã€å°†æ–‡å­—è½¬æ¢ä¸ºé€æ˜çš„ä¸´æ—¶å›¾ç‰‡"></a>2ã€å°†æ–‡å­—è½¬æ¢ä¸ºé€æ˜çš„ä¸´æ—¶å›¾ç‰‡</h3><p>é€›äº†ä¸€åœˆ<code>GraphicsMagick</code>å®˜ç½‘ï¼Œæ²¡çœ‹åˆ°æœ‰å°†æ–‡å­—è½¬æ¢ä¸ºå›¾ç‰‡çš„æ“ä½œï¼Œè¿™é‡Œä½¿ç”¨JDKè‡ªå¸¦çš„<code>ImageIO</code>ç”Ÿæˆä¸´æ—¶æ–‡ä»¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å°†æ–‡å­—è½¬æ¢ä¸ºå›¾ç‰‡ï¼ˆè§£å†³ä¸­æ–‡å­—ç¬¦ä¹±ç ä»¥åŠæ–‡å­—é€æ˜åº¦é—®é¢˜ï¼‰</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> text      æ–‡æœ¬å†…å®¹</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> fontType  å­—ä½“ç±»å‹ï¼ˆHeiTiã€KaiTiã€SongTiï¼‰</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> fontSize  å­—ä½“å¤§å°</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> fontColor å­—ä½“é¢œè‰²</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> outFile   è¾“å‡ºæ–‡ä»¶è·¯å¾„</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">convertFontToImage</span><span class="hljs-params">(String text, String fontType, Integer fontSize, String fontColor, String outFile)</span> </span>&#123;<br>    <span class="hljs-keyword">long</span> startTime = System.currentTimeMillis();<br>    Color textColor = Color.BLACK;<br>    <span class="hljs-keyword">if</span> (StringUtils.isNotBlank(fontColor)) &#123;<br>        textColor = <span class="hljs-keyword">new</span> Color(Integer.valueOf(fontColor, <span class="hljs-number">16</span>));<br>    &#125;<br>    <span class="hljs-comment">// è·å–å­—ä½“åº“æ˜ å°„å­—ä½“é›†</span><br>    Font font = chineseFontComponent.getChineseFont(fontType).deriveFont(Font.PLAIN, fontSize);<br>    File file = <span class="hljs-keyword">new</span> File(outFile);<br>    <span class="hljs-comment">// è·å–fontçš„æ ·å¼åº”ç”¨åœ¨strä¸Šçš„æ•´ä¸ªçŸ©å½¢</span><br>    Rectangle2D r = font.getStringBounds(text, <span class="hljs-keyword">new</span> FontRenderContext(AffineTransform.getScaleInstance(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>),<span class="hljs-keyword">false</span>,<span class="hljs-keyword">false</span>));<br>    <span class="hljs-comment">// è·å–å•ä¸ªå­—ç¬¦çš„é«˜åº¦</span><br>    <span class="hljs-keyword">int</span> unitHeight = (<span class="hljs-keyword">int</span>) Math.floor(r.getHeight()); <br>    <span class="hljs-comment">// è·å–æ•´ä¸ªstrç”¨äº†fontæ ·å¼çš„å®½åº¦è¿™é‡Œç”¨å››èˆäº”å…¥å+1ä¿è¯å®½åº¦ç»å¯¹èƒ½å®¹çº³è¿™ä¸ªå­—ç¬¦ä¸²ä½œä¸ºå›¾ç‰‡çš„å®½åº¦</span><br>    <span class="hljs-keyword">int</span> width = (<span class="hljs-keyword">int</span>)Math.round(r.getWidth())+<span class="hljs-number">1</span>;<br>    <span class="hljs-comment">// æŠŠå•ä¸ªå­—ç¬¦çš„é«˜åº¦+3ä¿è¯é«˜åº¦ç»å¯¹èƒ½å®¹çº³å­—ç¬¦ä¸²ä½œä¸ºå›¾ç‰‡çš„é«˜åº¦</span><br>    <span class="hljs-keyword">int</span> height = unitHeight+<span class="hljs-number">3</span>; <br>    <span class="hljs-comment">// åˆ›å»ºå›¾ç‰‡</span><br>    BufferedImage image = <span class="hljs-keyword">new</span> BufferedImage(width, height, BufferedImage.TYPE_INT_RGB);<br>    Graphics2D g2d = image.createGraphics();<br>    image = g2d.getDeviceConfiguration().createCompatibleImage(width, height, Transparency.TRANSLUCENT);<br>    g2d.dispose();<br>    g2d = image.createGraphics();<br>    g2d.setStroke(<span class="hljs-keyword">new</span> BasicStroke(<span class="hljs-number">1</span>));<br>    g2d.setColor(textColor); <span class="hljs-comment">// åœ¨æ¢æˆæ‰€éœ€è¦çš„å­—ä½“é¢œè‰²</span><br>    g2d.setFont(font);<br>    g2d.drawString(text, <span class="hljs-number">0</span>, font.getSize());<br>    <span class="hljs-keyword">try</span> &#123;<br>        ImageIO.write(image, <span class="hljs-string">&quot;png&quot;</span>, file); <span class="hljs-comment">// è¾“å‡ºpngå›¾ç‰‡</span><br>    &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>        log.error(<span class="hljs-string">&quot;æ–‡å­—æ°´å°ç”Ÿæˆä¸´æ—¶æ–‡ä»¶å‡ºç°å¼‚å¸¸&quot;</span>, e);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>    &#125;<br>    log.info(<span class="hljs-string">&quot;ç”Ÿæˆä¸´æ—¶æ–‡ä»¶æ—¶é—´ï¼š&#123;&#125; ms&quot;</span>, (System.currentTimeMillis()-startTime));<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>âš ï¸æ³¨æ„ï¼š</strong> ImageIOåœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹å®¹æ˜“é€ æˆOOMï¼Œæ‰€ä»¥ç”Ÿæˆä¸´æ—¶æ–‡ä»¶è¿™ä¸ªæ“ä½œéœ€è¦ä½¿ç”¨çº¿ç¨‹æ± æ§åˆ¶å¹¶å‘æ•°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * çº¿ç¨‹æ± é…ç½®ç±»</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThreadPoolExecutorConfig</span> </span>&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> textWaterMarkThreadPoolSize = <span class="hljs-number">100</span>;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> textWaterMarkThreadPoolQueueSize = <span class="hljs-number">1000</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ–‡å­—æ°´å°çº¿ç¨‹æ± </span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean(name = &quot;textWaterMarkThreadPool&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> ExecutorService <span class="hljs-title">getTextWaterMarkThreadPoolTaskServiceExecutor</span><span class="hljs-params">()</span></span>&#123;<br>        log.info(<span class="hljs-string">&quot;textWaterMarkThreadPoolçº¿ç¨‹æ± å¼€å§‹åˆå§‹åŒ–ï¼Œçº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°ï¼š&#123;&#125;&quot;</span>, textWaterMarkThreadPoolSize);<br>        ThreadFactory threadFactory = <span class="hljs-keyword">new</span> ThreadFactoryBuilder().setNameFormat(<span class="hljs-string">&quot;TextWaterMark-task-%d&quot;</span>).build();<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ThreadPoolExecutor(textWaterMarkThreadPoolSize, textWaterMarkThreadPoolSize, <span class="hljs-number">0L</span>,<br>                TimeUnit.SECONDS, <span class="hljs-keyword">new</span> LinkedBlockingDeque&lt;&gt;(textWaterMarkThreadPoolQueueSize),<br>                threadFactory, <span class="hljs-keyword">new</span> ThreadPoolExecutor.AbortPolicy());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3ã€ä½¿ç”¨GMåˆæˆå›¾ç‰‡"><a href="#3ã€ä½¿ç”¨GMåˆæˆå›¾ç‰‡" class="headerlink" title="3ã€ä½¿ç”¨GMåˆæˆå›¾ç‰‡"></a>3ã€ä½¿ç”¨GMåˆæˆå›¾ç‰‡</h3><ul><li>å°†æ°´å°æ–‡å­—ç”Ÿæˆé€æ˜çš„èƒŒæ™¯å›¾ç‰‡<ul><li>æäº¤ä»»åŠ¡åˆ°çº¿ç¨‹æ± ï¼Œå¹¶è·å–ç»“æœ</li></ul></li><li>ä½¿ç”¨GMåˆæˆå›¾ç‰‡</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å°†æ–‡å­—ç”Ÿæˆå›¾ç‰‡ï¼Œå†åˆæˆ</span><br><span class="hljs-comment">// 1ã€ç”Ÿæˆé€æ˜çš„èƒŒæ™¯å›¾ç‰‡</span><br>File tmpTextFile = File.createTempFile(<span class="hljs-string">&quot;TmpText-&quot;</span>, <span class="hljs-string">&quot;.png&quot;</span>);<br><span class="hljs-keyword">boolean</span> res = textWaterMarkThreadPool.submit(() -&gt; <span class="hljs-keyword">this</span>.convertFontToImage(text, fontType, fontSize, color, tmpTextFile.getAbsolutePath())).get();<br><span class="hljs-keyword">if</span> (! res) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ImageServiceException(ErrorCode.IMAGE_HANDLER_ERROR, <span class="hljs-string">&quot;æ–‡å­—æ°´å°ç”Ÿæˆä¸´æ—¶æ–‡ä»¶å¼‚å¸¸&quot;</span>);<br>&#125;<br><span class="hljs-comment">// 2ã€åˆæˆå›¾ç‰‡</span><br>CompositeCommand compositeCommand = <span class="hljs-keyword">new</span> CompositeCommand();<br>compositeCommand.watermarkImg(gravityEnum, dx, dy, dissolve, tmpTextFile.getAbsolutePath()).addImage(sourceImg, distPath);<br>pooledGMService.execute(compositeCommand.getCmdArgs());<br></code></pre></td></tr></table></figure><h3 id="4ã€æœ€ç»ˆç»“æœ"><a href="#4ã€æœ€ç»ˆç»“æœ" class="headerlink" title="4ã€æœ€ç»ˆç»“æœ"></a>4ã€æœ€ç»ˆç»“æœ</h3><p><strong>æµ‹è¯•éœ€æ±‚ï¼š</strong> æ–‡å­—ä½ç½®ï¼š(100, 100)ã€æ–‡å­—å†…å®¹ï¼šâ€œä½ å¥½ï¼Œä¸–ç•Œâ€ï¼Œé€æ˜åº¦ï¼š60%ï¼Œé¢œè‰²ï¼šff0000ï¼Œæ–‡å­—ç±»å‹ï¼šé»‘ä½“ï¼Œæ–‡å­—å¤§å°ï¼š40pxã€‚</p><ul><li><a href="https://cvte-dev-public.seewo.com/shan-test/fb56c8886ad34e69926ac35a51c2d127">é˜¿é‡Œäº‘æ–‡å­—æ°´å°æ•ˆæœ</a></li></ul><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/b5a4c16cfa3943db9297307d4f123690~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p><ul><li><a href="https://cvte-dev-public.seewo.com/shan-test/52927fed12f546539c6796fd7fad07ce">è‡ªç ”å›¾ç‰‡æ°´å°æ•ˆæœ</a></li></ul><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c7088e59808e48d0836dcea0fed93848~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p>]]></content>
    
    
    
    <tags>
      
      <tag>GraphicsMagick</tag>
      
      <tag>æ°´å°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBooté¡¹ç›®ç˜¦èº«</title>
    <link href="/blog/2021/06/04/SpringBoot%E9%A1%B9%E7%9B%AE%E7%98%A6%E8%BA%AB/"/>
    <url>/blog/2021/06/04/SpringBoot%E9%A1%B9%E7%9B%AE%E7%98%A6%E8%BA%AB/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€å‰è¨€"><a href="#ä¸€ã€å‰è¨€" class="headerlink" title="ä¸€ã€å‰è¨€"></a>ä¸€ã€å‰è¨€</h1><p>SpringBoot éƒ¨ç½²èµ·æ¥è™½ç„¶ç®€å•ï¼Œå¦‚æœæœåŠ¡å™¨éƒ¨ç½²åœ¨å…¬å¸å†…ç½‘ï¼Œé€Ÿåº¦è¿˜è¡Œï¼Œä½†æ˜¯å¦‚æœéƒ¨ç½²åœ¨å…¬ç½‘ï¼ˆé˜¿é‡Œäº‘ç­‰äº‘æœåŠ¡å™¨ä¸Šï¼‰ï¼Œéƒ¨ç½²èµ·æ¥å®åœ¨å¤´ç–¼ï¼šç¼–è¯‘å‡ºæ¥çš„ Jar åŒ…å¾ˆå¤§ï¼Œå¦‚æœå·¥ç¨‹å¼•å…¥äº†è®¸å¤šå¼€æºç»„ä»¶ï¼ˆSpringCloud ç­‰ï¼‰ï¼Œé‚£å°±æ›´å¤§äº†ã€‚</p><p>è¿™ä¸ªæ—¶å€™å¦‚æœæƒ³è¦å¯¹çº¿ä¸Šè¿è¡Œå·¥ç¨‹æœ‰ä¸€äº›å¾®è°ƒï¼Œåˆ™éå¸¸ç—›è‹¦</p><h1 id="äºŒã€ç˜¦èº«å‰çš„-Jar-åŒ…"><a href="#äºŒã€ç˜¦èº«å‰çš„-Jar-åŒ…" class="headerlink" title="äºŒã€ç˜¦èº«å‰çš„ Jar åŒ…"></a>äºŒã€ç˜¦èº«å‰çš„ Jar åŒ…</h1><p>Tomcat åœ¨éƒ¨ç½² Web å·¥ç¨‹çš„æ—¶å€™ï¼Œå¯ä»¥è¿›è¡Œå¢é‡æ›´æ–°ï¼ŒSpringBoot ä¹Ÿæ˜¯å¯ä»¥çš„ï½</p><p>SpringBoot ç¼–è¯‘å‡ºæ¥çš„ Jar åŒ…ä¸­ï¼Œç£ç›˜å ç”¨å¤§çš„ï¼Œæ˜¯ä¸€äº›å¤–éƒ¨ä¾èµ–åº“ï¼ˆjar åŒ…ï¼‰ï¼Œä¾‹å¦‚ï¼š</p><p>è¿›å…¥é¡¹ç›®å·¥ç¨‹æ ¹ç›®å½•ï¼Œæ‰§è¡Œ mvn clean install å‘½ä»¤ï¼Œå¾—åˆ°çš„ Jar åŒ…ï¼Œç”¨å‹ç¼©è½¯ä»¶æ‰“å¼€ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/d191cf2d49c042cbba8a1450db41f628~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>æ•´ä¸ª Jar åŒ… 18.18 MB, ä½†æ˜¯ BOOT-INF/lib å°±å ç”¨äº†å°†è¿‘ 18 MBï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/1eedabed015b40758873bbd1ec8dc2cf~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><h1 id="ä¸‰ã€è§£å†³æ–¹æ³•"><a href="#ä¸‰ã€è§£å†³æ–¹æ³•" class="headerlink" title="ä¸‰ã€è§£å†³æ–¹æ³•"></a>ä¸‰ã€è§£å†³æ–¹æ³•</h1><p>æ­¥éª¤ 1: æ­£å¸¸ç¼–è¯‘ JAR åŒ…ï¼Œè§£å‹å‡º lib æ–‡ä»¶å¤¹</p><p>POM æ–‡ä»¶å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/38c98d9e9b7b45aa84366ddd3beaac70~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>è¿›å…¥é¡¹ç›®æ ¹ç›®å½•ï¼Œæ‰§è¡Œå‘½ä»¤ï¼šmvn clean install</p><p>å°†ç¼–è¯‘åçš„ Jar åŒ…è§£å‹ï¼Œæ‹·è´ BOOT-INF ç›®å½•ä¸‹çš„ lib æ–‡ä»¶å¤¹ åˆ°ç›®æ ‡è·¯å¾„ï¼›</p><p>æ­¥éª¤ 2: ä¿®æ”¹ pom.xml é…ç½®ï¼Œç¼–è¯‘å‡ºä¸å¸¦ lib æ–‡ä»¶å¤¹çš„ Jar åŒ…</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/49f3d7bb81314f16bfeeec61e326a2d0~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>é…ç½®å®Œæˆåï¼Œå†æ¬¡æ‰§è¡Œç¼–è¯‘ï¼šmvn clean install</p><p>ç”Ÿæˆçš„ Jar åŒ…ä½“ç§¯æ˜æ˜¾å˜å°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œ å¤–éƒ¨çš„ jar åŒ…å·²ç»ä¸ä¼šè¢«å¼•å…¥äº†ï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/76c686a9bc2c4cb9a00497cac2f436cc~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>æ­¥éª¤ 3: è¿è¡Œç¼–è¯‘åçš„ Jar åŒ…</p><p>å°† æ­¥éª¤ 1 è§£å‹å‡ºæ¥çš„ lib æ–‡ä»¶å¤¹ã€æ­¥éª¤ 2 ç¼–è¯‘çš„ jar åŒ…æ”¾åœ¨åŒä¸€ä¸ªç›®å½•, è¿è¡Œä¸‹é¢å‘½ä»¤ï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/a8763842b17f413584be84069cbf07c9~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>æˆ–è€…åœ¨ maven ä¸­è¾“å…¥ä¸€ä¸‹å‘½ä»¤å¯¼å‡ºéœ€è¦ç”¨åˆ°çš„ jar åŒ…</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/baade11e805d47f695f4a40d970f452e~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>å¤‡æ³¨ï¼š</p><p>å°†/path/to/æ”¹æˆå®é™…çš„è·¯å¾„ã€‚</p><p>-Dloader.path=lib æ–‡ä»¶å¤¹è·¯å¾„</p><p>æœ€ç»ˆç›®å½•æ–‡ä»¶ç»“æ„æ˜¯ï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/52623002e80b451796f9085b19c0b987~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>è¯´æ˜</p><p>1ã€é€šå¸¸ï¼Œä¸€ä¸ªå·¥ç¨‹é¡¹ç›®æ¶æ„ç¡®å®šåï¼Œå¼•å…¥çš„ jar åŒ…åŸºæœ¬ä¸Šä¸ä¼šå˜ï¼Œæ”¹å˜çš„å¤§éƒ¨åˆ†æ˜¯ä¸šåŠ¡é€»è¾‘ï¼›</p><p>2ã€åé¢å¦‚æœéœ€è¦å˜æ›´ä¸šåŠ¡é€»è¾‘ï¼Œåªéœ€è¦è½»é‡åœ°ç¼–è¯‘å·¥ç¨‹ï¼Œå¤§å¤§æé«˜é¡¹ç›®éƒ¨ç½²çš„æ•ˆç‡ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>SpringBoot</tag>
      
      <tag>jar</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java8æ–°ç‰¹æ€§Lambdaè¡¨è¾¾å¼</title>
    <link href="/blog/2021/06/01/Java8%E6%96%B0%E7%89%B9%E6%80%A7Lambda%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
    <url>/blog/2021/06/01/Java8%E6%96%B0%E7%89%B9%E6%80%A7Lambda%E8%A1%A8%E8%BE%BE%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<blockquote><p>é›†åˆä¼˜åŒ–äº†å¯¹è±¡çš„å­˜å‚¨ï¼Œè€Œæµå’Œå¯¹è±¡çš„å¤„ç†æœ‰å…³ã€‚</p></blockquote><p>æµæ˜¯ä¸€ç³»åˆ—ä¸ç‰¹å®šå­˜å‚¨æœºåˆ¶æ— å…³çš„å…ƒç´ â€”â€”å®é™…ä¸Šï¼Œæµå¹¶æ²¡æœ‰â€œå­˜å‚¨â€ä¹‹è¯´ã€‚</p><p>åˆ©ç”¨æµï¼Œæ— éœ€è¿­ä»£é›†åˆä¸­çš„å…ƒç´ ï¼Œå°±å¯ä»¥æå–å’Œæ“ä½œå®ƒä»¬ã€‚è¿™äº›ç®¡é“é€šå¸¸è¢«ç»„åˆåœ¨ä¸€èµ·ï¼Œåœ¨æµä¸Šå½¢æˆä¸€æ¡æ“ä½œç®¡é“ã€‚</p><p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå°†å¯¹è±¡å­˜å‚¨åœ¨é›†åˆæ˜¯ä¸ºäº†å¤„ç†ä»–ä»¬ï¼Œå› æ­¤ä½ å°†ä¼šå‘ç°ç¼–ç¨‹ç„¦ç‚¹ä»é›†åˆè½¬ç§»åˆ°äº†æµã€‚æµçš„ä¸€ä¸ªæ ¸å¿ƒå¥½å¤„æ˜¯ï¼Œå®ƒä½¿å¾—<strong>ç¨‹åºæ›´åŠ çŸ­å°å¹¶ä¸”æ›´æ˜“ç†è§£</strong>ã€‚å½“ Lambda è¡¨è¾¾å¼å’Œæ–¹æ³•å¼•ç”¨å’Œæµä¸€èµ·ä½¿ç”¨çš„æ—¶å€™ä¼šè®©äººæ„Ÿè§‰è‡ªæˆä¸€ä½“ã€‚æµä½¿å¾— Java 8 æ›´æ·»é­…åŠ›ã€‚</p><p>å‡å¦‚ä½ è¦éšæœºå±•ç¤º 5 è‡³ 20 ä¹‹é—´ä¸é‡å¤çš„æ•´æ•°å¹¶è¿›è¡Œæ’åºã€‚å®é™…ä¸Šï¼Œä½ çš„å…³æ³¨ç‚¹é¦–å…ˆæ˜¯åˆ›å»ºä¸€ä¸ªæœ‰åºé›†åˆã€‚å›´ç»•è¿™ä¸ªé›†åˆè¿›è¡Œåç»­æ“ä½œã€‚ä½†ä½¿ç”¨æµå¼ç¼–ç¨‹ï¼Œå°±å¯ä»¥ç®€å•é™ˆè¿°ä½ æƒ³åšä»€ä¹ˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/Randoms.java</span><br><span class="hljs-keyword">import</span> java.util.*;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Randoms</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-keyword">new</span> Random(<span class="hljs-number">47</span>)<br>            .ints(<span class="hljs-number">5</span>, <span class="hljs-number">20</span>)<br>            .distinct()<br>            .limit(<span class="hljs-number">7</span>)<br>            .sorted()<br>            .forEach(System.out::println);<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plain">6<br>10<br>13<br>16<br>17<br>18<br>19<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>é¦–å…ˆï¼Œæˆ‘ä»¬ç»™ <strong>Random</strong> å¯¹è±¡ä¸€ä¸ªç§å­ï¼ˆä»¥ä¾¿ç¨‹åºå†æ¬¡è¿è¡Œæ—¶äº§ç”Ÿç›¸åŒçš„è¾“å‡ºï¼‰ã€‚<code>ints()</code> æ–¹æ³•äº§ç”Ÿä¸€ä¸ªæµå¹¶ä¸” <code>ints()</code> æ–¹æ³•æœ‰å¤šç§æ–¹å¼çš„é‡è½½ â€” ä¸¤ä¸ªå‚æ•°é™å®šäº†æ•°å€¼äº§ç”Ÿçš„è¾¹ç•Œã€‚è¿™å°†ç”Ÿæˆä¸€ä¸ªæ•´æ•°æµã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸­é—´æµæ“ä½œï¼ˆintermediate stream operationï¼‰ <code>distinct()</code> æ¥è·å–å®ƒä»¬çš„éé‡å¤å€¼ï¼Œç„¶åä½¿ç”¨ <code>limit()</code> æ–¹æ³•è·å–å‰ 7 ä¸ªå…ƒç´ ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>sorted()</code> æ–¹æ³•æ’åºã€‚æœ€ç»ˆä½¿ç”¨ <code>forEach()</code> æ–¹æ³•éå†è¾“å‡ºï¼Œå®ƒæ ¹æ®ä¼ é€’ç»™å®ƒçš„å‡½æ•°å¯¹æ¯ä¸ªæµå¯¹è±¡æ‰§è¡Œæ“ä½œã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¼ é€’äº†ä¸€ä¸ªå¯ä»¥åœ¨æ§åˆ¶å°æ˜¾ç¤ºæ¯ä¸ªå…ƒç´ çš„æ–¹æ³•å¼•ç”¨ã€‚<code>System.out::println</code> ã€‚</p><p>æ³¨æ„ <code>Randoms.java</code> ä¸­æ²¡æœ‰å£°æ˜ä»»ä½•å˜é‡ã€‚æµå¯ä»¥åœ¨ä¸ä½¿ç”¨èµ‹å€¼æˆ–å¯å˜æ•°æ®çš„æƒ…å†µä¸‹å¯¹æœ‰çŠ¶æ€çš„ç³»ç»Ÿå»ºæ¨¡ï¼Œè¿™éå¸¸æœ‰ç”¨ã€‚</p><p>å£°æ˜å¼ç¼–ç¨‹ï¼ˆDeclarative programmingï¼‰æ˜¯ä¸€ç§ï¼šå£°æ˜è¦åšä»€ä¹ˆï¼Œè€Œéæ€ä¹ˆåšçš„ç¼–ç¨‹é£æ ¼ã€‚æ­£å¦‚æˆ‘ä»¬åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­æ‰€çœ‹åˆ°çš„ã€‚<strong>æ³¨æ„</strong>ï¼Œå‘½ä»¤å¼ç¼–ç¨‹çš„å½¢å¼æ›´éš¾ä»¥ç†è§£ã€‚ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/ImperativeRandoms.java</span><br><span class="hljs-keyword">import</span> java.util.*;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ImperativeRandoms</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Random rand = <span class="hljs-keyword">new</span> Random(<span class="hljs-number">47</span>);<br>        SortedSet&lt;Integer&gt; rints = <span class="hljs-keyword">new</span> TreeSet&lt;&gt;();<br>        <span class="hljs-keyword">while</span>(rints.size() &lt; <span class="hljs-number">7</span>) &#123;<br>            <span class="hljs-keyword">int</span> r = rand.nextInt(<span class="hljs-number">20</span>);<br>            <span class="hljs-keyword">if</span>(r &lt; <span class="hljs-number">5</span>) <span class="hljs-keyword">continue</span>;<br>            rints.add(r);<br>        &#125;<br>        System.out.println(rints);<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-string">[7, 8, 9, 11, 13, 15, 18]</span><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>åœ¨ <code>Randoms.java</code> ä¸­ï¼Œæˆ‘ä»¬æ— éœ€å®šä¹‰ä»»ä½•å˜é‡ï¼Œä½†åœ¨è¿™é‡Œæˆ‘ä»¬å®šä¹‰äº† 3 ä¸ªå˜é‡ï¼š <code>rand</code>ï¼Œ<code>rints</code> å’Œ <code>r</code>ã€‚ç”±äº <code>nextInt()</code> æ–¹æ³•æ²¡æœ‰ä¸‹é™çš„åŸå› ï¼ˆå…¶å†…ç½®çš„ä¸‹é™æ°¸è¿œä¸º 0ï¼‰ï¼Œè¿™æ®µä»£ç å®ç°èµ·æ¥æ›´å¤æ‚ã€‚æ‰€ä»¥æˆ‘ä»¬è¦ç”Ÿæˆé¢å¤–çš„å€¼æ¥è¿‡æ»¤å°äº 5 çš„ç»“æœã€‚</p><p><strong>æ³¨æ„</strong>ï¼Œä½ å¿…é¡»è¦ç ”ç©¶ç¨‹åºçš„çœŸæ­£æ„å›¾ï¼Œè€Œåœ¨ <code>Randoms.java</code> ä¸­ï¼Œä»£ç åªæ˜¯å‘Šè¯‰äº†ä½ å®ƒæ­£åœ¨åšä»€ä¹ˆã€‚è¿™ç§è¯­ä¹‰æ¸…æ™°æ€§ä¹Ÿæ˜¯ Java 8 çš„æµå¼ç¼–ç¨‹æ›´å—æ¨å´‡çš„é‡è¦åŸå› ã€‚</p><p>åœ¨ <code>ImperativeRandoms.java</code> ä¸­æ˜¾å¼åœ°ç¼–å†™è¿­ä»£æœºåˆ¶ç§°ä¸ºå¤–éƒ¨è¿­ä»£ã€‚è€Œåœ¨ <code>Randoms.java</code> ä¸­ï¼Œæµå¼ç¼–ç¨‹é‡‡ç”¨å†…éƒ¨è¿­ä»£ï¼Œè¿™æ˜¯æµå¼ç¼–ç¨‹çš„æ ¸å¿ƒç‰¹æ€§ä¹‹ä¸€ã€‚è¿™ç§æœºåˆ¶ä½¿å¾—ç¼–å†™çš„ä»£ç å¯è¯»æ€§æ›´å¼ºï¼Œä¹Ÿæ›´èƒ½åˆ©ç”¨å¤šæ ¸å¤„ç†å™¨çš„ä¼˜åŠ¿ã€‚é€šè¿‡æ”¾å¼ƒå¯¹è¿­ä»£è¿‡ç¨‹çš„æ§åˆ¶ï¼Œæˆ‘ä»¬æŠŠæ§åˆ¶æƒäº¤ç»™å¹¶è¡ŒåŒ–æœºåˆ¶ã€‚æˆ‘ä»¬å°†åœ¨<a href="24-Concurrent-Programming.md">å¹¶å‘ç¼–ç¨‹</a>ä¸€ç« ä¸­å­¦ä¹ è¿™éƒ¨åˆ†å†…å®¹ã€‚</p><p>å¦ä¸€ä¸ªé‡è¦æ–¹é¢ï¼Œæµæ˜¯æ‡’åŠ è½½çš„ã€‚è¿™ä»£è¡¨ç€å®ƒåªåœ¨ç»å¯¹å¿…è¦æ—¶æ‰è®¡ç®—ã€‚ä½ å¯ä»¥å°†æµçœ‹ä½œâ€œå»¶è¿Ÿåˆ—è¡¨â€ã€‚ç”±äºè®¡ç®—å»¶è¿Ÿï¼Œæµä½¿æˆ‘ä»¬èƒ½å¤Ÿè¡¨ç¤ºéå¸¸å¤§ï¼ˆç”šè‡³æ— é™ï¼‰çš„åºåˆ—ï¼Œè€Œä¸éœ€è¦è€ƒè™‘å†…å­˜é—®é¢˜ã€‚</p><h2 id="æµæ”¯æŒ"><a href="#æµæ”¯æŒ" class="headerlink" title="æµæ”¯æŒ"></a>æµæ”¯æŒ</h2><p>Java è®¾è®¡è€…é¢ä¸´ç€è¿™æ ·ä¸€ä¸ªéš¾é¢˜ï¼šç°å­˜çš„å¤§é‡ç±»åº“ä¸ä»…ä¸º Java æ‰€ç”¨ï¼ŒåŒæ—¶ä¹Ÿè¢«åº”ç”¨åœ¨æ•´ä¸ª Java ç”Ÿæ€åœˆæ•°ç™¾ä¸‡è¡Œçš„ä»£ç ä¸­ã€‚å¦‚ä½•å°†ä¸€ä¸ªå…¨æ–°çš„æµçš„æ¦‚å¿µèå…¥åˆ°ç°æœ‰ç±»åº“ä¸­å‘¢ï¼Ÿ</p><p>æ¯”å¦‚åœ¨ <strong>Random</strong> ä¸­æ·»åŠ æ›´å¤šçš„æ–¹æ³•ã€‚åªè¦ä¸æ”¹å˜åŸæœ‰çš„æ–¹æ³•ï¼Œç°æœ‰ä»£ç å°±ä¸ä¼šå—åˆ°å¹²æ‰°ã€‚</p><p>é—®é¢˜æ˜¯ï¼Œæ¥å£éƒ¨åˆ†æ€ä¹ˆæ”¹é€ å‘¢ï¼Ÿç‰¹åˆ«æ˜¯æ¶‰åŠé›†åˆç±»æ¥å£çš„éƒ¨åˆ†ã€‚å¦‚æœä½ æƒ³æŠŠä¸€ä¸ªé›†åˆè½¬æ¢ä¸ºæµï¼Œç›´æ¥å‘æ¥å£æ·»åŠ æ–°æ–¹æ³•ä¼šç ´åæ‰€æœ‰è€çš„æ¥å£å®ç°ç±»ã€‚</p><p>Java 8 é‡‡ç”¨çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼šåœ¨<a href="10-Interfaces.md">æ¥å£</a>ä¸­æ·»åŠ è¢« <code>default</code>ï¼ˆ<code>é»˜è®¤</code>ï¼‰ä¿®é¥°çš„æ–¹æ³•ã€‚é€šè¿‡è¿™ç§æ–¹æ¡ˆï¼Œè®¾è®¡è€…ä»¬å¯ä»¥å°†æµå¼ï¼ˆ<em>stream</em>ï¼‰æ–¹æ³•å¹³æ»‘åœ°åµŒå…¥åˆ°ç°æœ‰ç±»ä¸­ã€‚æµæ–¹æ³•é¢„ç½®çš„æ“ä½œå‡ ä¹å·²æ»¡è¶³äº†æˆ‘ä»¬å¹³å¸¸æ‰€æœ‰çš„éœ€æ±‚ã€‚æµæ“ä½œçš„ç±»å‹æœ‰ä¸‰ç§ï¼šåˆ›å»ºæµï¼Œä¿®æ”¹æµå…ƒç´ ï¼ˆä¸­é—´æ“ä½œï¼Œ Intermediate Operationsï¼‰ï¼Œæ¶ˆè´¹æµå…ƒç´ ï¼ˆç»ˆç«¯æ“ä½œï¼Œ Terminal Operationsï¼‰ã€‚æœ€åä¸€ç§ç±»å‹é€šå¸¸æ„å‘³ç€æ”¶é›†æµå…ƒç´ ï¼ˆé€šå¸¸æ˜¯åˆ°é›†åˆä¸­ï¼‰ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸‹æ¯ç§ç±»å‹çš„æµæ“ä½œã€‚</p><h2 id="æµåˆ›å»º"><a href="#æµåˆ›å»º" class="headerlink" title="æµåˆ›å»º"></a>æµåˆ›å»º</h2><p>ä½ å¯ä»¥é€šè¿‡ <code>Stream.of()</code> å¾ˆå®¹æ˜“åœ°å°†ä¸€ç»„å…ƒç´ è½¬åŒ–æˆä¸ºæµï¼ˆ<code>Bubble</code> ç±»åœ¨æœ¬ç« çš„åé¢å®šä¹‰ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/StreamOf.java</span><br><span class="hljs-keyword">import</span> java.util.stream.*;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StreamOf</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Stream.of(<span class="hljs-keyword">new</span> Bubble(<span class="hljs-number">1</span>), <span class="hljs-keyword">new</span> Bubble(<span class="hljs-number">2</span>), <span class="hljs-keyword">new</span> Bubble(<span class="hljs-number">3</span>))<br>            .forEach(System.out::println);<br>        Stream.of(<span class="hljs-string">&quot;It&#x27;s &quot;</span>, <span class="hljs-string">&quot;a &quot;</span>, <span class="hljs-string">&quot;wonderful &quot;</span>, <span class="hljs-string">&quot;day &quot;</span>, <span class="hljs-string">&quot;for &quot;</span>, <span class="hljs-string">&quot;pie!&quot;</span>)<br>            .forEach(System.out::print);<br>        System.out.println();<br>        Stream.of(<span class="hljs-number">3.14159</span>, <span class="hljs-number">2.718</span>, <span class="hljs-number">1.618</span>)<br>            .forEach(System.out::println);<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-function"><span class="hljs-title">Bubble</span>(<span class="hljs-number">1</span>)</span><br><span class="hljs-function"><span class="hljs-title">Bubble</span>(<span class="hljs-number">2</span>)</span><br><span class="hljs-function"><span class="hljs-title">Bubble</span>(<span class="hljs-number">3</span>)</span><br><span class="hljs-variable">It</span><span class="hljs-string">&#x27;s a wonderful day for pie!</span><br><span class="hljs-string">3.14159</span><br><span class="hljs-string">2.718</span><br><span class="hljs-string">1.618</span><br><span class="hljs-string">å¤åˆ¶ä»£ç </span><br></code></pre></td></tr></table></figure><p>æ¯ä¸ªé›†åˆéƒ½å¯é€šè¿‡ <code>stream()</code> äº§ç”Ÿä¸€ä¸ªæµã€‚ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.*;<br><span class="hljs-keyword">import</span> java.util.stream.*;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CollectionToStream</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        List&lt;Bubble&gt; bubbles = Arrays.asList(<span class="hljs-keyword">new</span> Bubble(<span class="hljs-number">1</span>), <span class="hljs-keyword">new</span> Bubble(<span class="hljs-number">2</span>), <span class="hljs-keyword">new</span> Bubble(<span class="hljs-number">3</span>));<br>        System.out.println(bubbles.stream()<br>            .mapToInt(b -&gt; b.i)<br>            .sum());<br>        <br>        Set&lt;String&gt; w = <span class="hljs-keyword">new</span> HashSet&lt;&gt;(Arrays.asList(<span class="hljs-string">&quot;It&#x27;s a wonderful day for pie!&quot;</span>.split(<span class="hljs-string">&quot; &quot;</span>)));<br>        w.stream()<br>         .map(x -&gt; x + <span class="hljs-string">&quot; &quot;</span>)<br>         .forEach(System.out::print);<br>        System.out.println();<br>        <br>        Map&lt;String, Double&gt; m = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br>        m.put(<span class="hljs-string">&quot;pi&quot;</span>, <span class="hljs-number">3.14159</span>);<br>        m.put(<span class="hljs-string">&quot;e&quot;</span>, <span class="hljs-number">2.718</span>);<br>        m.put(<span class="hljs-string">&quot;phi&quot;</span>, <span class="hljs-number">1.618</span>);<br>        m.entrySet().stream()<br>                    .map(e -&gt; e.getKey() + <span class="hljs-string">&quot;: &quot;</span> + e.getValue())<br>                    .forEach(System.out::println);<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs vbnet"><span class="hljs-number">6</span><br>a pie! It<span class="hljs-comment">&#x27;s for wonderful day</span><br><span class="hljs-symbol">phi:</span> <span class="hljs-number">1.618</span><br><span class="hljs-symbol">e:</span> <span class="hljs-number">2.718</span><br><span class="hljs-symbol">pi:</span> <span class="hljs-number">3.14159</span><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><ul><li>åˆ›å»º <code>List&lt;Bubble&gt;</code> å¯¹è±¡åï¼Œåªéœ€ç®€å•è°ƒç”¨<strong>æ‰€æœ‰é›†åˆä¸­éƒ½æœ‰</strong>çš„ <code>stream()</code>ã€‚</li><li>ä¸­é—´æ“ä½œ <code>map()</code> ä¼šè·å–æµä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œå¹¶ä¸”å¯¹æµä¸­å…ƒç´ åº”ç”¨æ“ä½œä»è€Œäº§ç”Ÿæ–°çš„å…ƒç´ ï¼Œå¹¶å°†å…¶ä¼ é€’åˆ°åç»­çš„æµä¸­ã€‚é€šå¸¸ <code>map()</code> ä¼šè·å–å¯¹è±¡å¹¶äº§ç”Ÿæ–°çš„å¯¹è±¡ï¼Œä½†åœ¨è¿™é‡Œäº§ç”Ÿäº†ç‰¹æ®Šçš„ç”¨äºæ•°å€¼ç±»å‹çš„æµã€‚ä¾‹å¦‚ï¼Œ<code>mapToInt()</code> æ–¹æ³•å°†ä¸€ä¸ªå¯¹è±¡æµï¼ˆobject streamï¼‰è½¬æ¢æˆä¸ºåŒ…å«æ•´å‹æ•°å­—çš„ <code>IntStream</code>ã€‚</li><li>é€šè¿‡è°ƒç”¨å­—ç¬¦ä¸²çš„ <code>split()</code>æ¥è·å–å…ƒç´ ç”¨äºå®šä¹‰å˜é‡ <code>w</code>ã€‚</li><li>ä¸ºäº†ä» <strong>Map</strong> é›†åˆä¸­äº§ç”Ÿæµæ•°æ®ï¼Œæˆ‘ä»¬é¦–å…ˆè°ƒç”¨ <code>entrySet()</code> äº§ç”Ÿä¸€ä¸ªå¯¹è±¡æµï¼Œæ¯ä¸ªå¯¹è±¡éƒ½åŒ…å«ä¸€ä¸ª <code>key</code> é”®ä»¥åŠä¸å…¶ç›¸å…³è”çš„ <code>value</code> å€¼ã€‚ç„¶ååˆ†åˆ«è°ƒç”¨ <code>getKey()</code> å’Œ <code>getValue()</code> è·å–å€¼ã€‚</li></ul><h3 id="éšæœºæ•°æµ"><a href="#éšæœºæ•°æµ" class="headerlink" title="éšæœºæ•°æµ"></a>éšæœºæ•°æµ</h3><p><code>Random</code> ç±»è¢«ä¸€ç»„ç”Ÿæˆæµçš„æ–¹æ³•å¢å¼ºäº†ã€‚ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/RandomGenerators.java</span><br><span class="hljs-keyword">import</span> java.util.*;<br><span class="hljs-keyword">import</span> java.util.stream.*;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RandomGenerators</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">show</span><span class="hljs-params">(Stream&lt;T&gt; stream)</span> </span>&#123;<br>        stream<br>        .limit(<span class="hljs-number">4</span>)<br>        .forEach(System.out::println);<br>        System.out.println(<span class="hljs-string">&quot;++++++++&quot;</span>);<br>    &#125;<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Random rand = <span class="hljs-keyword">new</span> Random(<span class="hljs-number">47</span>);<br>        show(rand.ints().boxed());<br>        show(rand.longs().boxed());<br>        show(rand.doubles().boxed());<br>        <span class="hljs-comment">// æ§åˆ¶ä¸Šé™å’Œä¸‹é™ï¼š</span><br>        show(rand.ints(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>).boxed());<br>        show(rand.longs(<span class="hljs-number">50</span>, <span class="hljs-number">100</span>).boxed());<br>        show(rand.doubles(<span class="hljs-number">20</span>, <span class="hljs-number">30</span>).boxed());<br>        <span class="hljs-comment">// æ§åˆ¶æµå¤§å°ï¼š</span><br>        show(rand.ints(<span class="hljs-number">2</span>).boxed());<br>        show(rand.longs(<span class="hljs-number">2</span>).boxed());<br>        show(rand.doubles(<span class="hljs-number">2</span>).boxed());<br>        <span class="hljs-comment">// æ§åˆ¶æµçš„å¤§å°å’Œç•Œé™</span><br>        show(rand.ints(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">9</span>).boxed());<br>        show(rand.longs(<span class="hljs-number">3</span>, <span class="hljs-number">12</span>, <span class="hljs-number">22</span>).boxed());<br>        show(rand.doubles(<span class="hljs-number">3</span>, <span class="hljs-number">11.5</span>, <span class="hljs-number">12.3</span>).boxed());<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">-1172028779<br>1717241110<br>-2014573909<br>229403722<br><span class="hljs-code">+++</span><span class="hljs-code">+++</span>++<br>2955289354441303771<br>3476817843704654257<br>-8917117694134521474<br>4941259272818818752<br><span class="hljs-code">+++</span><span class="hljs-code">+++</span>++<br>0.2613610344283964<br>0.0508673570556899<br>0.8037155449603999<br>0.7620665811558285<br><span class="hljs-code">+++</span><span class="hljs-code">+++</span>++<br>16<br>10<br>11<br>12<br><span class="hljs-code">+++</span><span class="hljs-code">+++</span>++<br>65<br>99<br>54<br>58<br><span class="hljs-code">+++</span><span class="hljs-code">+++</span>++<br>29.86777681078574<br>24.83968447804611<br>20.09247112332014<br>24.046793846338723<br><span class="hljs-code">+++</span><span class="hljs-code">+++</span>++<br>1169976606<br>1947946283<br><span class="hljs-code">+++</span><span class="hljs-code">+++</span>++<br>2970202997824602425<br>-2325326920272830366<br><span class="hljs-code">+++</span><span class="hljs-code">+++</span>++<br>0.7024254510631527<br>0.6648552384607359<br><span class="hljs-code">+++</span><span class="hljs-code">+++</span>++<br>6<br>7<br>7<br><span class="hljs-code">+++</span><span class="hljs-code">+++</span>++<br>17<br>12<br>20<br><span class="hljs-code">+++</span><span class="hljs-code">+++</span>++<br>12.27872414236691<br>11.732085449736195<br>12.196509449817267<br><span class="hljs-code">+++</span><span class="hljs-code">+++</span>++<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>ä¸ºäº†æ¶ˆé™¤å†—ä½™ä»£ç ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªæ³›å‹æ–¹æ³• <code>show(Stream&lt;T&gt; stream)</code> ï¼ˆåœ¨è®²è§£æ³›å‹ä¹‹å‰å°±ä½¿ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œç¡®å®æœ‰ç‚¹ä½œå¼Šï¼Œä½†æ˜¯å›æŠ¥æ˜¯å€¼å¾—çš„ï¼‰ã€‚ç±»å‹å‚æ•° <code>T</code> å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•å¯¹ <strong>Integer</strong>ã€<strong>Long</strong> å’Œ <strong>Double</strong> ç±»å‹éƒ½ç”Ÿæ•ˆã€‚ä½†æ˜¯ <strong>Random</strong> ç±»åªèƒ½ç”ŸæˆåŸºæœ¬ç±»å‹ <strong>int</strong>ï¼Œ <strong>long</strong>ï¼Œ <strong>double</strong> çš„æµã€‚å¹¸è¿çš„æ˜¯ï¼Œ <code>boxed()</code> æµæ“ä½œå°†ä¼šè‡ªåŠ¨åœ°æŠŠåŸºæœ¬ç±»å‹åŒ…è£…æˆä¸ºå¯¹åº”çš„è£…ç®±ç±»å‹ï¼Œä»è€Œä½¿å¾— <code>show()</code> èƒ½å¤Ÿæ¥å—æµã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <strong>Random</strong> ä¸ºä»»æ„å¯¹è±¡é›†åˆåˆ›å»º <strong>Supplier</strong>ã€‚å¦‚ä¸‹æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶æä¾›å­—ç¬¦ä¸²å¯¹è±¡çš„ä¾‹å­ã€‚</p><p>Cheese.dat æ–‡ä»¶å†…å®¹ï¼š</p><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs oxygene"><span class="hljs-comment">// streams/Cheese.dat</span><br><span class="hljs-keyword">Not</span> much <span class="hljs-keyword">of</span> a cheese shop really, <span class="hljs-keyword">is</span> it?<br>Finest <span class="hljs-keyword">in</span> the district, sir.<br><span class="hljs-keyword">And</span> what leads you <span class="hljs-keyword">to</span> that conclusion?<br>Well, it<span class="hljs-string">&#x27;s so clean.</span><br><span class="hljs-string">It&#x27;</span>s certainly uncontaminated <span class="hljs-keyword">by</span> cheese.<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬é€šè¿‡ <strong>File</strong> ç±»å°† Cheese.dat æ–‡ä»¶çš„æ‰€æœ‰è¡Œè¯»å–åˆ° <code>List&lt;String&gt;</code> ä¸­ã€‚ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/RandomWords.java</span><br><span class="hljs-keyword">import</span> java.util.*;<br><span class="hljs-keyword">import</span> java.util.stream.*;<br><span class="hljs-keyword">import</span> java.util.function.*;<br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.nio.file.*;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RandomWords</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Supplier</span>&lt;<span class="hljs-title">String</span>&gt; </span>&#123;<br>    List&lt;String&gt; words = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>    Random rand = <span class="hljs-keyword">new</span> Random(<span class="hljs-number">47</span>);<br>    RandomWords(String fname) <span class="hljs-keyword">throws</span> IOException &#123;<br>        List&lt;String&gt; lines = Files.readAllLines(Paths.get(fname));<br>        <span class="hljs-comment">// ç•¥è¿‡ç¬¬ä¸€è¡Œ</span><br>        <span class="hljs-keyword">for</span> (String line : lines.subList(<span class="hljs-number">1</span>, lines.size())) &#123;<br>            <span class="hljs-keyword">for</span> (String word : line.split(<span class="hljs-string">&quot;[ .?,]+&quot;</span>))<br>                words.add(word.toLowerCase());<br>        &#125;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">get</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> words.get(rand.nextInt(words.size()));<br>    &#125;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> words.stream()<br>            .collect(Collectors.joining(<span class="hljs-string">&quot; &quot;</span>));<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        System.out.println(<br>            Stream.generate(<span class="hljs-keyword">new</span> RandomWords(<span class="hljs-string">&quot;Cheese.dat&quot;</span>))<br>                .limit(<span class="hljs-number">10</span>)<br>                .collect(Collectors.joining(<span class="hljs-string">&quot; &quot;</span>)));<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-keyword">it</span> shop sir <span class="hljs-keyword">the</span> much cheese <span class="hljs-keyword">by</span> conclusion district <span class="hljs-keyword">is</span><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œä½ å¯ä»¥çœ‹åˆ°æ›´ä¸ºå¤æ‚çš„ <code>split()</code> è¿ç”¨ã€‚åœ¨æ„é€ å™¨ä¸­ï¼Œæ¯ä¸€è¡Œéƒ½è¢« <code>split()</code> é€šè¿‡ç©ºæ ¼æˆ–è€…è¢«æ–¹æ‹¬å·åŒ…è£¹çš„ä»»æ„æ ‡ç‚¹ç¬¦å·è¿›è¡Œåˆ†å‰²ã€‚åœ¨ç»“æŸæ–¹æ‹¬å·åé¢çš„ <code>+</code> ä»£è¡¨ <code>+</code> å‰é¢çš„ä¸œè¥¿å¯ä»¥å‡ºç°ä¸€æ¬¡æˆ–è€…å¤šæ¬¡ã€‚</p><p>æˆ‘ä»¬æ³¨æ„åˆ°åœ¨æ„é€ å‡½æ•°ä¸­å¾ªç¯ä½“ä½¿ç”¨å‘½ä»¤å¼ç¼–ç¨‹ï¼ˆå¤–éƒ¨è¿­ä»£ï¼‰ã€‚åœ¨ä»¥åçš„ä¾‹å­ä¸­ï¼Œä½ ç”šè‡³ä¼šçœ‹åˆ°æˆ‘ä»¬å¦‚ä½•æ¶ˆé™¤è¿™ä¸€ç‚¹ã€‚è¿™ç§æ—§çš„å½¢å¼è™½ä¸æ˜¯ç‰¹åˆ«ç³Ÿç³•ï¼Œä½†ä½¿ç”¨æµä¼šè®©äººæ„Ÿè§‰æ›´å¥½ã€‚</p><p>åœ¨ <code>toString()</code> å’Œä¸»æ–¹æ³•ä¸­ä½ çœ‹åˆ°äº† <code>collect()</code> æ”¶é›†æ“ä½œï¼Œå®ƒæ ¹æ®å‚æ•°æ¥ç»„åˆæ‰€æœ‰æµä¸­çš„å…ƒç´ ã€‚</p><p>å½“ä½ ä½¿ç”¨ <strong>Collectors.</strong><code>joining()</code>ï¼Œä½ å°†ä¼šå¾—åˆ°ä¸€ä¸ª <code>String</code> ç±»å‹çš„ç»“æœï¼Œæ¯ä¸ªå…ƒç´ éƒ½æ ¹æ® <code>joining()</code> çš„å‚æ•°æ¥è¿›è¡Œåˆ†å‰²ã€‚è¿˜æœ‰è®¸å¤šä¸åŒçš„ <code>Collectors</code> ç”¨äºäº§ç”Ÿä¸åŒçš„ç»“æœã€‚</p><p>åœ¨ä¸»æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æå‰çœ‹åˆ°äº† <strong>Stream.</strong><code>generate()</code> çš„ç”¨æ³•ï¼Œå®ƒå¯ä»¥æŠŠä»»æ„  <code>Supplier&lt;T&gt;</code> ç”¨äºç”Ÿæˆ <code>T</code> ç±»å‹çš„æµã€‚</p><h3 id="int-ç±»å‹çš„èŒƒå›´"><a href="#int-ç±»å‹çš„èŒƒå›´" class="headerlink" title="int ç±»å‹çš„èŒƒå›´"></a>int ç±»å‹çš„èŒƒå›´</h3><p><code>IntStream</code> ç±»æä¾›äº†  <code>range()</code> æ–¹æ³•ç”¨äºç”Ÿæˆæ•´å‹åºåˆ—çš„æµã€‚ç¼–å†™å¾ªç¯æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šæ›´åŠ ä¾¿åˆ©ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/Ranges.java</span><br><span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> java.util.stream.IntStream.*;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Ranges</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-comment">// ä¼ ç»Ÿæ–¹æ³•:</span><br>        <span class="hljs-keyword">int</span> result = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">10</span>; i &lt; <span class="hljs-number">20</span>; i++)<br>            result += i;<br>        System.out.println(result);<br>        <span class="hljs-comment">// for-in å¾ªç¯:</span><br>        result = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i : range(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>).toArray())<br>            result += i;<br>        System.out.println(result);<br>        <span class="hljs-comment">// ä½¿ç”¨æµ:</span><br>        System.out.println(range(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>).sum());<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plain">145<br>145<br>145<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>åœ¨ä¸»æ–¹æ³•ä¸­çš„ç¬¬ä¸€ç§æ–¹å¼æ˜¯æˆ‘ä»¬ä¼ ç»Ÿç¼–å†™ <code>for</code> å¾ªç¯çš„æ–¹å¼ï¼›ç¬¬äºŒç§æ–¹å¼ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>range()</code> åˆ›å»ºäº†æµå¹¶å°†å…¶è½¬åŒ–ä¸ºæ•°ç»„ï¼Œç„¶ååœ¨ <code>for-in</code> ä»£ç å—ä¸­ä½¿ç”¨ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ èƒ½åƒç¬¬ä¸‰ç§æ–¹æ³•é‚£æ ·å…¨ç¨‹ä½¿ç”¨æµæ˜¯æ›´å¥½çš„ã€‚æˆ‘ä»¬å¯¹èŒƒå›´ä¸­çš„æ•°å­—è¿›è¡Œæ±‚å’Œã€‚åœ¨æµä¸­å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä½¿ç”¨ <code>sum()</code> æ“ä½œæ±‚å’Œã€‚</p><p>æ³¨æ„ <strong>IntStream.</strong><code>range()</code> ç›¸æ¯” <code>onjava.Range.range()</code> æ‹¥æœ‰æ›´å¤šçš„é™åˆ¶ã€‚è¿™æ˜¯ç”±äºå…¶å¯é€‰çš„ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œåè€…å…è®¸æ­¥é•¿å¤§äº 1ï¼Œå¹¶ä¸”å¯ä»¥ä»å¤§åˆ°å°æ¥ç”Ÿæˆã€‚</p><p>å®ç”¨å°åŠŸèƒ½ <code>repeat()</code> å¯ä»¥ç”¨æ¥æ›¿æ¢ç®€å•çš„ <code>for</code> å¾ªç¯ã€‚ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// onjava/Repeat.java</span><br><span class="hljs-keyword">package</span> onjava;<br><span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> java.util.stream.IntStream.*;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Repeat</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">repeat</span><span class="hljs-params">(<span class="hljs-keyword">int</span> n, Runnable action)</span> </span>&#123;<br>        range(<span class="hljs-number">0</span>, n).forEach(i -&gt; action.run());<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>å…¶äº§ç”Ÿçš„å¾ªç¯æ›´åŠ æ¸…æ™°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/Looping.java</span><br><span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> onjava.Repeat.*;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Looping</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">hi</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;Hi!&quot;</span>);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        repeat(<span class="hljs-number">3</span>, () -&gt; System.out.println(<span class="hljs-string">&quot;Looping!&quot;</span>));<br>        repeat(<span class="hljs-number">2</span>, Looping::hi);<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs erlang-repl">Looping!<br>Looping!<br>Looping!<br>Hi!<br>Hi!<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>åŸåˆ™ä¸Šï¼Œåœ¨ä»£ç ä¸­åŒ…å«å¹¶è§£é‡Š <code>repeat()</code> å¹¶ä¸å€¼å¾—ã€‚è¯šç„¶å®ƒæ˜¯ä¸€ä¸ªç›¸å½“é€æ˜çš„å·¥å…·ï¼Œä½†ç»“æœå–å†³äºä½ çš„å›¢é˜Ÿå’Œå…¬å¸çš„è¿ä½œæ–¹å¼ã€‚</p><h3 id="generate"><a href="#generate" class="headerlink" title="generate()"></a>generate()</h3><p>å‚ç…§ <code>RandomWords.java</code> ä¸­ <strong>Stream.</strong><code>generate()</code> æ­é… <code>Supplier&lt;T&gt;</code> ä½¿ç”¨çš„ä¾‹å­ã€‚ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/Generator.java</span><br><span class="hljs-keyword">import</span> java.util.*;<br><span class="hljs-keyword">import</span> java.util.function.*;<br><span class="hljs-keyword">import</span> java.util.stream.*;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Generator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Supplier</span>&lt;<span class="hljs-title">String</span>&gt; </span>&#123;<br>    Random rand = <span class="hljs-keyword">new</span> Random(<span class="hljs-number">47</span>);<br>    <span class="hljs-keyword">char</span>[] letters = <span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>.toCharArray();<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">get</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span> + letters[rand.nextInt(letters.length)];<br>    &#125;<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        String word = Stream.generate(<span class="hljs-keyword">new</span> Generator())<br>                            .limit(<span class="hljs-number">30</span>)<br>                            .collect(Collectors.joining());<br>        System.out.println(word);<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs">YNZBRNYGCFOWZNTCQRGSEGZMMJMROE<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>Random.nextInt()</code> æ–¹æ³•æ¥æŒ‘é€‰å­—æ¯è¡¨ä¸­çš„å¤§å†™å­—æ¯ã€‚<code>Random.nextInt()</code> çš„å‚æ•°ä»£è¡¨å¯ä»¥æ¥å—çš„æœ€å¤§çš„éšæœºæ•°èŒƒå›´ï¼Œæ‰€ä»¥ä½¿ç”¨æ•°ç»„è¾¹ç•Œæ˜¯ç»è¿‡æ·±æ€ç†Ÿè™‘çš„ã€‚</p><p>å¦‚æœè¦åˆ›å»ºåŒ…å«ç›¸åŒå¯¹è±¡çš„æµï¼Œåªéœ€è¦ä¼ é€’ä¸€ä¸ªç”Ÿæˆé‚£äº›å¯¹è±¡çš„ <code>lambda</code> åˆ° <code>generate()</code> ä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/Duplicator.java</span><br><span class="hljs-keyword">import</span> java.util.stream.*;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Duplicator</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Stream.generate(() -&gt; <span class="hljs-string">&quot;duplicate&quot;</span>)<br>              .limit(<span class="hljs-number">3</span>)<br>              .forEach(System.out::println);<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mel"><span class="hljs-keyword">duplicate</span><br><span class="hljs-keyword">duplicate</span><br><span class="hljs-keyword">duplicate</span><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>å¦‚ä¸‹æ˜¯åœ¨æœ¬ç« ä¹‹å‰ä¾‹å­ä¸­ä½¿ç”¨è¿‡çš„ <code>Bubble</code> ç±»ã€‚<strong>æ³¨æ„</strong>å®ƒåŒ…å«äº†è‡ªå·±çš„é™æ€ç”Ÿæˆå™¨ï¼ˆStatic generatorï¼‰æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/Bubble.java</span><br><span class="hljs-keyword">import</span> java.util.function.*;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Bubble</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> i;<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Bubble</span><span class="hljs-params">(<span class="hljs-keyword">int</span> n)</span> </span>&#123;<br>        i = n;<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Bubble(&quot;</span> + i + <span class="hljs-string">&quot;)&quot;</span>;<br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> count = <span class="hljs-number">0</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Bubble <span class="hljs-title">bubbler</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Bubble(count++);<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>ç”±äº <code>bubbler()</code> ä¸ <code>Supplier&lt;Bubble&gt;</code> æ˜¯æ¥å£å…¼å®¹çš„ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶æ–¹æ³•å¼•ç”¨ç›´æ¥ä¼ é€’ç»™ <strong>Stream.</strong><code>generate()</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/Bubbles.java</span><br><span class="hljs-keyword">import</span> java.util.stream.*;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Bubbles</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Stream.generate(Bubble::bubbler)<br>              .limit(<span class="hljs-number">5</span>)<br>              .forEach(System.out::println);<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">Bubble</span><span class="hljs-params">(<span class="hljs-number">0</span>)</span></span><br><span class="hljs-function"><span class="hljs-title">Bubble</span><span class="hljs-params">(<span class="hljs-number">1</span>)</span></span><br><span class="hljs-function"><span class="hljs-title">Bubble</span><span class="hljs-params">(<span class="hljs-number">2</span>)</span></span><br><span class="hljs-function"><span class="hljs-title">Bubble</span><span class="hljs-params">(<span class="hljs-number">3</span>)</span></span><br><span class="hljs-function"><span class="hljs-title">Bubble</span><span class="hljs-params">(<span class="hljs-number">4</span>)</span></span><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¿™æ˜¯åˆ›å»ºå•ç‹¬å·¥å‚ç±»ï¼ˆSeparate Factory classï¼‰çš„å¦ä¸€ç§æ–¹å¼ã€‚åœ¨å¾ˆå¤šæ–¹é¢å®ƒæ›´åŠ æ•´æ´ï¼Œä½†æ˜¯è¿™æ˜¯ä¸€ä¸ªå¯¹äºä»£ç ç»„ç»‡å’Œå“å‘³çš„é—®é¢˜â€”â€”ä½ æ€»æ˜¯å¯ä»¥åˆ›å»ºä¸€ä¸ªå®Œå…¨ä¸åŒçš„å·¥å‚ç±»ã€‚</p><h3 id="iterate"><a href="#iterate" class="headerlink" title="iterate()"></a>iterate()</h3><p><strong>Stream.</strong><code>iterate()</code> ä»¥ç§å­ï¼ˆç¬¬ä¸€ä¸ªå‚æ•°ï¼‰å¼€å¤´ï¼Œå¹¶å°†å…¶ä¼ ç»™æ–¹æ³•ï¼ˆç¬¬äºŒä¸ªå‚æ•°ï¼‰ã€‚æ–¹æ³•çš„ç»“æœå°†æ·»åŠ åˆ°æµï¼Œå¹¶å­˜å‚¨ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ç”¨äºä¸‹æ¬¡è°ƒç”¨ <code>iterate()</code>ï¼Œä¾æ¬¡ç±»æ¨ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ <code>iterate()</code> ç”Ÿæˆä¸€ä¸ªæ–æ³¢é‚£å¥‘æ•°åˆ—ã€‚ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/Fibonacci.java</span><br><span class="hljs-keyword">import</span> java.util.stream.*;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Fibonacci</span> </span>&#123;<br>    <span class="hljs-keyword">int</span> x = <span class="hljs-number">1</span>;<br>    <br>    <span class="hljs-function">Stream&lt;Integer&gt; <span class="hljs-title">numbers</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> Stream.iterate(<span class="hljs-number">0</span>, i -&gt; &#123;<br>            <span class="hljs-keyword">int</span> result = x + i;<br>            x = i;<br>            <span class="hljs-keyword">return</span> result;<br>        &#125;);<br>    &#125;<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-keyword">new</span> Fibonacci().numbers()<br>                       .skip(<span class="hljs-number">20</span>) <span class="hljs-comment">// è¿‡æ»¤å‰ 20 ä¸ª</span><br>                       .limit(<span class="hljs-number">10</span>) <span class="hljs-comment">// ç„¶åå– 10 ä¸ª</span><br>                       .forEach(System.out::println);<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-number">6765</span><br><span class="hljs-number">10946</span><br><span class="hljs-number">17711</span><br><span class="hljs-number">28657</span><br><span class="hljs-number">46368</span><br><span class="hljs-number">75025</span><br><span class="hljs-number">121393</span><br><span class="hljs-number">196418</span><br><span class="hljs-number">317811</span><br><span class="hljs-number">514229</span><br><span class="hljs-string">å¤åˆ¶ä»£ç </span><br></code></pre></td></tr></table></figure><p>æ–æ³¢é‚£å¥‘æ•°åˆ—å°†æ•°åˆ—ä¸­æœ€åä¸¤ä¸ªå…ƒç´ è¿›è¡Œæ±‚å’Œä»¥äº§ç”Ÿä¸‹ä¸€ä¸ªå…ƒç´ ã€‚<code>iterate()</code> åªèƒ½è®°å¿†ç»“æœï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åˆ©ç”¨ä¸€ä¸ªå˜é‡ <code>x</code> è¿½è¸ªå¦å¤–ä¸€ä¸ªå…ƒç´ ã€‚</p><p>åœ¨ä¸»æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªä¹‹å‰æ²¡æœ‰è§è¿‡çš„ <code>skip()</code> æ“ä½œã€‚å®ƒæ ¹æ®å‚æ•°ä¸¢å¼ƒæŒ‡å®šæ•°é‡çš„æµå…ƒç´ ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸¢å¼ƒäº†å‰ 20 ä¸ªå…ƒç´ ã€‚</p><h3 id="æµçš„å»ºé€ è€…æ¨¡å¼"><a href="#æµçš„å»ºé€ è€…æ¨¡å¼" class="headerlink" title="æµçš„å»ºé€ è€…æ¨¡å¼"></a>æµçš„å»ºé€ è€…æ¨¡å¼</h3><p>åœ¨å»ºé€ è€…è®¾è®¡æ¨¡å¼ï¼ˆä¹Ÿç§°æ„é€ å™¨æ¨¡å¼ï¼‰ä¸­ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ª <code>builder</code> å¯¹è±¡ï¼Œä¼ é€’ç»™å®ƒå¤šä¸ªæ„é€ å™¨ä¿¡æ¯ï¼Œæœ€åæ‰§è¡Œâ€œæ„é€ â€ã€‚<strong>Stream</strong> åº“æä¾›äº†è¿™æ ·çš„ <code>Builder</code>ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é‡æ–°å®¡è§†æ–‡ä»¶è¯»å–å¹¶å°†å…¶è½¬æ¢æˆä¸ºå•è¯æµçš„è¿‡ç¨‹ã€‚ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/FileToWordsBuilder.java</span><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.nio.file.*;<br><span class="hljs-keyword">import</span> java.util.stream.*;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileToWordsBuilder</span> </span>&#123;<br>    Stream.Builder&lt;String&gt; builder = Stream.builder();<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">FileToWordsBuilder</span><span class="hljs-params">(String filePath)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        Files.lines(Paths.get(filePath))<br>             .skip(<span class="hljs-number">1</span>) <span class="hljs-comment">// ç•¥è¿‡å¼€å¤´çš„æ³¨é‡Šè¡Œ</span><br>             .forEach(line -&gt; &#123;<br>                  <span class="hljs-keyword">for</span> (String w : line.split(<span class="hljs-string">&quot;[ .?,]+&quot;</span>))<br>                      builder.add(w);<br>              &#125;);<br>    &#125;<br>    <br>    <span class="hljs-function">Stream&lt;String&gt; <span class="hljs-title">stream</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> builder.build();<br>    &#125;<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-keyword">new</span> FileToWordsBuilder(<span class="hljs-string">&quot;Cheese.dat&quot;</span>)<br>            .stream()<br>            .limit(<span class="hljs-number">7</span>)<br>            .map(w -&gt; w + <span class="hljs-string">&quot; &quot;</span>)<br>            .forEach(System.out::print);<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">Not much <span class="hljs-keyword">of</span> <span class="hljs-keyword">a</span> cheese shop really<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼Œæ„é€ å™¨ä¼šæ·»åŠ æ–‡ä»¶ä¸­çš„æ‰€æœ‰å•è¯ï¼ˆé™¤äº†ç¬¬ä¸€è¡Œï¼Œå®ƒæ˜¯åŒ…å«æ–‡ä»¶è·¯å¾„ä¿¡æ¯çš„æ³¨é‡Šï¼‰ï¼Œä½†æ˜¯å…¶å¹¶æ²¡æœ‰è°ƒç”¨ <code>build()</code>ã€‚åªè¦ä½ ä¸è°ƒç”¨ <code>stream()</code> æ–¹æ³•ï¼Œå°±å¯ä»¥ç»§ç»­å‘ <code>builder</code> å¯¹è±¡ä¸­æ·»åŠ å•è¯ã€‚</p><p>åœ¨è¯¥ç±»çš„æ›´å®Œæ•´å½¢å¼ä¸­ï¼Œä½ å¯ä»¥æ·»åŠ ä¸€ä¸ªæ ‡å¿—ä½ç”¨äºæŸ¥çœ‹ <code>build()</code> æ˜¯å¦è¢«è°ƒç”¨ï¼Œå¹¶ä¸”å¯èƒ½çš„è¯å¢åŠ ä¸€ä¸ªå¯ä»¥æ·»åŠ æ›´å¤šå•è¯çš„æ–¹æ³•ã€‚åœ¨ <code>Stream.Builder</code> è°ƒç”¨ <code>build()</code> æ–¹æ³•åç»§ç»­å°è¯•æ·»åŠ å•è¯ä¼šäº§ç”Ÿä¸€ä¸ªå¼‚å¸¸ã€‚</p><h3 id="Arrays"><a href="#Arrays" class="headerlink" title="Arrays"></a>Arrays</h3><p><code>Arrays</code> ç±»ä¸­å«æœ‰ä¸€ä¸ªåä¸º <code>stream()</code> çš„é™æ€æ–¹æ³•ç”¨äºæŠŠæ•°ç»„è½¬æ¢æˆä¸ºæµã€‚æˆ‘ä»¬å¯ä»¥é‡å†™ <code>interfaces/Machine.java</code> ä¸­çš„ä¸»æ–¹æ³•ç”¨äºåˆ›å»ºä¸€ä¸ªæµï¼Œå¹¶å°† <code>execute()</code> åº”ç”¨äºæ¯ä¸€ä¸ªå…ƒç´ ã€‚ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/Machine2.java</span><br><span class="hljs-keyword">import</span> java.util.*;<br><span class="hljs-keyword">import</span> onjava.Operations;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Machine2</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Arrays.stream(<span class="hljs-keyword">new</span> Operations[] &#123;<br>            () -&gt; Operations.show(<span class="hljs-string">&quot;Bing&quot;</span>),<br>            () -&gt; Operations.show(<span class="hljs-string">&quot;Crack&quot;</span>),<br>            () -&gt; Operations.show(<span class="hljs-string">&quot;Twist&quot;</span>),<br>            () -&gt; Operations.show(<span class="hljs-string">&quot;Pop&quot;</span>)<br>        &#125;).forEach(Operations::execute);<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">Bing</span><br><span class="hljs-symbol">Crack</span><br><span class="hljs-symbol">Twist</span><br><span class="hljs-symbol">Pop</span><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p><code>new Operations[]</code> è¡¨è¾¾å¼åŠ¨æ€åˆ›å»ºäº† <code>Operations</code> å¯¹è±¡çš„æ•°ç»„ã€‚</p><p><code>stream()</code> åŒæ ·å¯ä»¥äº§ç”Ÿ <strong>IntStream</strong>ï¼Œ<strong>LongStream</strong> å’Œ <strong>DoubleStream</strong>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/ArrayStreams.java</span><br><span class="hljs-keyword">import</span> java.util.*;<br><span class="hljs-keyword">import</span> java.util.stream.*;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ArrayStreams</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Arrays.stream(<span class="hljs-keyword">new</span> <span class="hljs-keyword">double</span>[] &#123; <span class="hljs-number">3.14159</span>, <span class="hljs-number">2.718</span>, <span class="hljs-number">1.618</span> &#125;)<br>            .forEach(n -&gt; System.out.format(<span class="hljs-string">&quot;%f &quot;</span>, n));<br>        System.out.println();<br>        <br>        Arrays.stream(<span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[] &#123; <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span> &#125;)<br>            .forEach(n -&gt; System.out.format(<span class="hljs-string">&quot;%d &quot;</span>, n));<br>        System.out.println();<br>        <br>        Arrays.stream(<span class="hljs-keyword">new</span> <span class="hljs-keyword">long</span>[] &#123; <span class="hljs-number">11</span>, <span class="hljs-number">22</span>, <span class="hljs-number">44</span>, <span class="hljs-number">66</span> &#125;)<br>            .forEach(n -&gt; System.out.format(<span class="hljs-string">&quot;%d &quot;</span>, n));<br>        System.out.println();<br>        <br>        <span class="hljs-comment">// é€‰æ‹©ä¸€ä¸ªå­åŸŸ:</span><br>        Arrays.stream(<span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[] &#123; <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">15</span>, <span class="hljs-number">28</span>, <span class="hljs-number">37</span> &#125;, <span class="hljs-number">3</span>, <span class="hljs-number">6</span>)<br>            .forEach(n -&gt; System.out.format(<span class="hljs-string">&quot;%d &quot;</span>, n));<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dns"><span class="hljs-number">3.141590 2</span>.<span class="hljs-number">718000 1</span>.<span class="hljs-number">618000</span><br><span class="hljs-number">1</span> <span class="hljs-number">3</span> <span class="hljs-number">5</span><br><span class="hljs-number">11 22 44 66</span><br><span class="hljs-number">7</span> <span class="hljs-number">15</span> <span class="hljs-number">28</span><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>æœ€åä¸€æ¬¡ <code>stream()</code> çš„è°ƒç”¨æœ‰ä¸¤ä¸ªé¢å¤–çš„å‚æ•°ã€‚ç¬¬ä¸€ä¸ªå‚æ•°å‘Šè¯‰ <code>stream()</code> ä»æ•°ç»„çš„å“ªä¸ªä½ç½®å¼€å§‹é€‰æ‹©å…ƒç´ ï¼Œç¬¬äºŒä¸ªå‚æ•°ç”¨äºå‘ŠçŸ¥åœ¨å“ªé‡Œåœæ­¢ã€‚æ¯ç§ä¸åŒç±»å‹çš„ <code>stream()</code> éƒ½æœ‰ç±»ä¼¼çš„æ“ä½œã€‚</p><h3 id="æ­£åˆ™è¡¨è¾¾å¼"><a href="#æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼"></a>æ­£åˆ™è¡¨è¾¾å¼</h3><p>Java çš„æ­£åˆ™è¡¨è¾¾å¼å°†åœ¨<a href="18-Strings.md">å­—ç¬¦ä¸²</a>è¿™ä¸€ç« èŠ‚è¯¦ç»†ä»‹ç»ã€‚Java 8 åœ¨ <code>java.util.regex.Pattern</code> ä¸­å¢åŠ äº†ä¸€ä¸ªæ–°çš„æ–¹æ³• <code>splitAsStream()</code>ã€‚è¿™ä¸ªæ–¹æ³•å¯ä»¥æ ¹æ®ä¼ å…¥çš„å…¬å¼å°†å­—ç¬¦åºåˆ—è½¬åŒ–ä¸ºæµã€‚ä½†æ˜¯æœ‰ä¸€ä¸ªé™åˆ¶ï¼Œè¾“å…¥åªèƒ½æ˜¯ <strong>CharSequence</strong>ï¼Œå› æ­¤ä¸èƒ½å°†æµä½œä¸º <code>splitAsStream()</code> çš„å‚æ•°ã€‚</p><p>æˆ‘ä»¬å†ä¸€æ¬¡æŸ¥çœ‹å°†æ–‡ä»¶å¤„ç†ä¸ºå•è¯æµçš„è¿‡ç¨‹ã€‚è¿™ä¸€æ¬¡ï¼Œæˆ‘ä»¬ä½¿ç”¨æµå°†æ–‡ä»¶åˆ†å‰²ä¸ºå•ç‹¬çš„å­—ç¬¦ä¸²ï¼Œæ¥ç€ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å°†å­—ç¬¦ä¸²è½¬åŒ–ä¸ºå•è¯æµã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/FileToWordsRegexp.java</span><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.nio.file.*;<br><span class="hljs-keyword">import</span> java.util.stream.*;<br><span class="hljs-keyword">import</span> java.util.regex.Pattern;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileToWordsRegexp</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> String all;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">FileToWordsRegexp</span><span class="hljs-params">(String filePath)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        all = Files.lines(Paths.get(filePath))<br>        .skip(<span class="hljs-number">1</span>) <span class="hljs-comment">// First (comment) line</span><br>        .collect(Collectors.joining(<span class="hljs-string">&quot; &quot;</span>));<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Stream&lt;String&gt; <span class="hljs-title">stream</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> Pattern<br>        .compile(<span class="hljs-string">&quot;[ .,?]+&quot;</span>).splitAsStream(all);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span><br>    main(String[] args) <span class="hljs-keyword">throws</span> Exception &#123;<br>        FileToWordsRegexp fw = <span class="hljs-keyword">new</span> FileToWordsRegexp(<span class="hljs-string">&quot;Cheese.dat&quot;</span>);<br>        fw.stream()<br>          .limit(<span class="hljs-number">7</span>)<br>          .map(w -&gt; w + <span class="hljs-string">&quot; &quot;</span>)<br>          .forEach(System.out::print);<br>        fw.stream()<br>          .skip(<span class="hljs-number">7</span>)<br>          .limit(<span class="hljs-number">2</span>)<br>          .map(w -&gt; w + <span class="hljs-string">&quot; &quot;</span>)<br>          .forEach(System.out::print);<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript">Not much <span class="hljs-keyword">of</span> a cheese shop really <span class="hljs-keyword">is</span> <span class="hljs-keyword">it</span><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>åœ¨æ„é€ å™¨ä¸­æˆ‘ä»¬è¯»å–äº†æ–‡ä»¶ä¸­çš„æ‰€æœ‰å†…å®¹ï¼ˆè·³è¿‡ç¬¬ä¸€è¡Œæ³¨é‡Šï¼Œå¹¶å°†å…¶è½¬åŒ–æˆä¸ºå•è¡Œå­—ç¬¦ä¸²ï¼‰ã€‚ç°åœ¨ï¼Œå½“ä½ è°ƒç”¨ <code>stream()</code> çš„æ—¶å€™ï¼Œå¯ä»¥åƒå¾€å¸¸ä¸€æ ·è·å–ä¸€ä¸ªæµï¼Œä½†è¿™æ¬¡ä½ å¯ä»¥å¤šæ¬¡è°ƒç”¨ <code>stream()</code> åœ¨å·²å­˜å‚¨çš„å­—ç¬¦ä¸²ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„æµã€‚è¿™é‡Œæœ‰ä¸ªé™åˆ¶ï¼Œæ•´ä¸ªæ–‡ä»¶å¿…é¡»å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼›åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹è¿™å¹¶ä¸æ˜¯ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯è¿™æŸå¤±äº†æµæ“ä½œéå¸¸é‡è¦çš„ä¼˜åŠ¿ï¼š</p><ol><li>æµâ€œä¸éœ€è¦å­˜å‚¨â€ã€‚å½“ç„¶å®ƒä»¬éœ€è¦ä¸€äº›å†…éƒ¨å­˜å‚¨ï¼Œä½†æ˜¯è¿™åªæ˜¯åºåˆ—çš„ä¸€å°éƒ¨åˆ†ï¼Œå’ŒæŒæœ‰æ•´ä¸ªåºåˆ—å¹¶ä¸ç›¸åŒã€‚</li><li>å®ƒä»¬æ˜¯æ‡’åŠ è½½è®¡ç®—çš„ã€‚</li></ol><p>å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬ç¨åå°±ä¼šçŸ¥é“å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h2 id="ä¸­é—´æ“ä½œ"><a href="#ä¸­é—´æ“ä½œ" class="headerlink" title="ä¸­é—´æ“ä½œ"></a>ä¸­é—´æ“ä½œ</h2><p>ä¸­é—´æ“ä½œç”¨äºä»ä¸€ä¸ªæµä¸­è·å–å¯¹è±¡ï¼Œå¹¶å°†å¯¹è±¡ä½œä¸ºå¦ä¸€ä¸ªæµä»åç«¯è¾“å‡ºï¼Œä»¥è¿æ¥åˆ°å…¶ä»–æ“ä½œã€‚</p><h3 id="è·Ÿè¸ªå’Œè°ƒè¯•"><a href="#è·Ÿè¸ªå’Œè°ƒè¯•" class="headerlink" title="è·Ÿè¸ªå’Œè°ƒè¯•"></a>è·Ÿè¸ªå’Œè°ƒè¯•</h3><p><code>peek()</code> æ“ä½œçš„ç›®çš„æ˜¯å¸®åŠ©è°ƒè¯•ã€‚å®ƒå…è®¸ä½ æ— ä¿®æ”¹åœ°æŸ¥çœ‹æµä¸­çš„å…ƒç´ ã€‚ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/Peeking.java</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Peeking</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        FileToWords.stream(<span class="hljs-string">&quot;Cheese.dat&quot;</span>)<br>        .skip(<span class="hljs-number">21</span>)<br>        .limit(<span class="hljs-number">4</span>)<br>        .map(w -&gt; w + <span class="hljs-string">&quot; &quot;</span>)<br>        .peek(System.out::print)<br>        .map(String::toUpperCase)<br>        .peek(System.out::print)<br>        .map(String::toLowerCase)<br>        .forEach(System.out::print);<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">Well</span> WELL well <span class="hljs-keyword">it</span> <span class="hljs-keyword">IT</span> <span class="hljs-keyword">it</span> s S s so SO so<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p><code>FileToWords</code> ç¨åå®šä¹‰ï¼Œä½†å®ƒçš„åŠŸèƒ½å®ç°è²Œä¼¼å’Œä¹‹å‰æˆ‘ä»¬çœ‹åˆ°çš„å·®ä¸å¤šï¼šäº§ç”Ÿå­—ç¬¦ä¸²å¯¹è±¡çš„æµã€‚ä¹‹ååœ¨å…¶é€šè¿‡ç®¡é“æ—¶è°ƒç”¨ <code>peek()</code> è¿›è¡Œå¤„ç†ã€‚</p><p>å› ä¸º <code>peek()</code> ç¬¦åˆæ— è¿”å›å€¼çš„ <strong>Consumer</strong> å‡½æ•°å¼æ¥å£ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½è§‚å¯Ÿï¼Œæ— æ³•ä½¿ç”¨ä¸åŒçš„å…ƒç´ æ¥æ›¿æ¢æµä¸­çš„å¯¹è±¡ã€‚</p><h3 id="æµå…ƒç´ æ’åº"><a href="#æµå…ƒç´ æ’åº" class="headerlink" title="æµå…ƒç´ æ’åº"></a>æµå…ƒç´ æ’åº</h3><p>åœ¨ <code>Randoms.java</code> ä¸­ï¼Œæˆ‘ä»¬ç†Ÿè¯†äº† <code>sorted()</code> çš„é»˜è®¤æ¯”è¾ƒå™¨å®ç°ã€‚å…¶å®å®ƒè¿˜æœ‰å¦ä¸€ç§å½¢å¼çš„å®ç°ï¼šä¼ å…¥ä¸€ä¸ª <strong>Comparator</strong> å‚æ•°ã€‚ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/SortedComparator.java</span><br><span class="hljs-keyword">import</span> java.util.*;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SortedComparator</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        FileToWords.stream(<span class="hljs-string">&quot;Cheese.dat&quot;</span>)<br>        .skip(<span class="hljs-number">10</span>)<br>        .limit(<span class="hljs-number">10</span>)<br>        .sorted(Comparator.reverseOrder())<br>        .map(w -&gt; w + <span class="hljs-string">&quot; &quot;</span>)<br>        .forEach(System.out::print);<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript">you what <span class="hljs-keyword">to</span> <span class="hljs-keyword">the</span> <span class="hljs-keyword">that</span> sir leads <span class="hljs-keyword">in</span> district And<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p><code>sorted()</code> é¢„è®¾äº†ä¸€äº›é»˜è®¤çš„æ¯”è¾ƒå™¨ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯åè½¬â€œè‡ªç„¶æ’åºâ€ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥æŠŠ Lambda å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’ç»™ <code>sorted()</code>ã€‚</p><h3 id="ç§»é™¤å…ƒç´ "><a href="#ç§»é™¤å…ƒç´ " class="headerlink" title="ç§»é™¤å…ƒç´ "></a>ç§»é™¤å…ƒç´ </h3><ul><li><code>distinct()</code>ï¼šåœ¨ <code>Randoms.java</code> ç±»ä¸­çš„ <code>distinct()</code> å¯ç”¨äºæ¶ˆé™¤æµä¸­çš„é‡å¤å…ƒç´ ã€‚ç›¸æ¯”åˆ›å»ºä¸€ä¸ª <strong>Set</strong> é›†åˆï¼Œè¯¥æ–¹æ³•çš„å·¥ä½œé‡è¦å°‘å¾—å¤šã€‚</li><li><code>filter(Predicate)</code>ï¼šè¿‡æ»¤æ“ä½œä¼šä¿ç•™ä¸ä¼ é€’è¿›å»çš„è¿‡æ»¤å™¨å‡½æ•°è®¡ç®—ç»“æœä¸º <code>true</code> çš„å…ƒç´ ã€‚</li></ul><p>åœ¨ä¸‹ä¾‹ä¸­ï¼Œ<code>isPrime()</code> ä½œä¸ºè¿‡æ»¤å™¨å‡½æ•°ï¼Œç”¨äºæ£€æµ‹è´¨æ•°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.stream.*;<br><span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> java.util.stream.LongStream.*;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Prime</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Boolean <span class="hljs-title">isPrime</span><span class="hljs-params">(<span class="hljs-keyword">long</span> n)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> rangeClosed(<span class="hljs-number">2</span>, (<span class="hljs-keyword">long</span>)Math.sqrt(n))<br>        .noneMatch(i -&gt; n % i == <span class="hljs-number">0</span>);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> LongStream <span class="hljs-title">numbers</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> iterate(<span class="hljs-number">2</span>, i -&gt; i + <span class="hljs-number">1</span>)<br>        .filter(Prime::isPrime);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-keyword">new</span> Prime().numbers()<br>        .limit(<span class="hljs-number">10</span>)<br>        .forEach(n -&gt; System.out.format(<span class="hljs-string">&quot;%d &quot;</span>, n));<br>        System.out.println();<br>        <span class="hljs-keyword">new</span> Prime().numbers()<br>        .skip(<span class="hljs-number">90</span>)<br>        .limit(<span class="hljs-number">10</span>)<br>        .forEach(n -&gt; System.out.format(<span class="hljs-string">&quot;%d &quot;</span>, n));<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs tap">2<span class="hljs-number"> 3 </span>5<span class="hljs-number"> 7 </span>11<span class="hljs-number"> 13 </span>17<span class="hljs-number"> 19 </span>23 29<br>467<span class="hljs-number"> 479 </span>487<span class="hljs-number"> 491 </span>499<span class="hljs-number"> 503 </span>509<span class="hljs-number"> 521 </span>523 541<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p><code>rangeClosed()</code> åŒ…å«äº†ä¸Šé™å€¼ã€‚å¦‚æœä¸èƒ½æ•´é™¤ï¼Œå³ä½™æ•°ä¸ç­‰äº 0ï¼Œåˆ™ <code>noneMatch()</code> æ“ä½œè¿”å› <code>true</code>ï¼Œå¦‚æœå‡ºç°ä»»ä½•ç­‰äº 0 çš„ç»“æœåˆ™è¿”å› <code>false</code>ã€‚ <code>noneMatch()</code> æ“ä½œä¸€æ—¦æœ‰å¤±è´¥å°±ä¼šé€€å‡ºã€‚</p><h3 id="åº”ç”¨å‡½æ•°åˆ°å…ƒç´ "><a href="#åº”ç”¨å‡½æ•°åˆ°å…ƒç´ " class="headerlink" title="åº”ç”¨å‡½æ•°åˆ°å…ƒç´ "></a>åº”ç”¨å‡½æ•°åˆ°å…ƒç´ </h3><ul><li><code>map(Function)</code>ï¼šå°†å‡½æ•°æ“ä½œåº”ç”¨åœ¨è¾“å…¥æµçš„å…ƒç´ ä¸­ï¼Œå¹¶å°†è¿”å›å€¼ä¼ é€’åˆ°è¾“å‡ºæµä¸­ã€‚</li><li><code>mapToInt(ToIntFunction)</code>ï¼šæ“ä½œåŒä¸Šï¼Œä½†ç»“æœæ˜¯ <strong>IntStream</strong>ã€‚</li><li><code>mapToLong(ToLongFunction)</code>ï¼šæ“ä½œåŒä¸Šï¼Œä½†ç»“æœæ˜¯ <strong>LongStream</strong>ã€‚</li><li><code>mapToDouble(ToDoubleFunction)</code>ï¼šæ“ä½œåŒä¸Šï¼Œä½†ç»“æœæ˜¯ <strong>DoubleStream</strong>ã€‚</li></ul><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>map()</code> æ˜ å°„å¤šç§å‡½æ•°åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²æµä¸­ã€‚ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/FunctionMap.java</span><br><span class="hljs-keyword">import</span> java.util.*;<br><span class="hljs-keyword">import</span> java.util.stream.*;<br><span class="hljs-keyword">import</span> java.util.function.*;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FunctionMap</span> </span>&#123;<br>    <span class="hljs-keyword">static</span> String[] elements = &#123; <span class="hljs-string">&quot;12&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;23&quot;</span>, <span class="hljs-string">&quot;45&quot;</span> &#125;;<br>    <span class="hljs-keyword">static</span> Stream&lt;String&gt;<br>    testStream() &#123;<br>        <span class="hljs-keyword">return</span> Arrays.stream(elements);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">(String descr, Function&lt;String, String&gt; func)</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot; ---( &quot;</span> + descr + <span class="hljs-string">&quot; )---&quot;</span>);<br>        testStream()<br>        .map(func)<br>        .forEach(System.out::println);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        test(<span class="hljs-string">&quot;add brackets&quot;</span>, s -&gt; <span class="hljs-string">&quot;[&quot;</span> + s + <span class="hljs-string">&quot;]&quot;</span>);<br>        test(<span class="hljs-string">&quot;Increment&quot;</span>, s -&gt; &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-keyword">return</span> Integer.parseInt(s) + <span class="hljs-number">1</span> + <span class="hljs-string">&quot;&quot;</span>;<br>            &#125;<br>            <span class="hljs-keyword">catch</span>(NumberFormatException e) &#123;<br>                <span class="hljs-keyword">return</span> s;<br>            &#125;<br>        &#125;<br>        );<br>        test(<span class="hljs-string">&quot;Replace&quot;</span>, s -&gt; s.replace(<span class="hljs-string">&quot;2&quot;</span>, <span class="hljs-string">&quot;9&quot;</span>));<br>        test(<span class="hljs-string">&quot;Take last digit&quot;</span>, s -&gt; s.length() &gt; <span class="hljs-number">0</span> ?<br>        s.charAt(s.length() - <span class="hljs-number">1</span>) + <span class="hljs-string">&quot;&quot;</span> : s);<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck">--<span class="hljs-literal">-</span><span class="hljs-comment">(</span> <span class="hljs-comment">add</span> <span class="hljs-comment">brackets</span> <span class="hljs-comment">)</span>--<span class="hljs-literal">-</span><br><span class="hljs-title">[</span><span class="hljs-comment">12</span><span class="hljs-title">]</span><br><span class="hljs-title">[</span><span class="hljs-title">]</span><br><span class="hljs-title">[</span><span class="hljs-comment">23</span><span class="hljs-title">]</span><br><span class="hljs-title">[</span><span class="hljs-comment">45</span><span class="hljs-title">]</span><br>--<span class="hljs-literal">-</span><span class="hljs-comment">(</span> <span class="hljs-comment">Increment</span> <span class="hljs-comment">)</span>--<span class="hljs-literal">-</span><br><span class="hljs-comment">13</span><br><span class="hljs-comment">24</span><br><span class="hljs-comment">46</span><br><span class="hljs-comment"></span>--<span class="hljs-literal">-</span><span class="hljs-comment">(</span> <span class="hljs-comment">Replace</span> <span class="hljs-comment">)</span>--<span class="hljs-literal">-</span><br><span class="hljs-comment">19</span><br><span class="hljs-comment">93</span><br><span class="hljs-comment">45</span><br><span class="hljs-comment"></span>--<span class="hljs-literal">-</span><span class="hljs-comment">(</span> <span class="hljs-comment">Take</span> <span class="hljs-comment">last</span> <span class="hljs-comment">digit</span> <span class="hljs-comment">)</span>--<span class="hljs-literal">-</span><br><span class="hljs-comment">2</span><br><span class="hljs-comment">3</span><br><span class="hljs-comment">5</span><br><span class="hljs-comment">å¤åˆ¶ä»£ç </span><br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„è‡ªå¢ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>Integer.parseInt()</code> å°è¯•å°†ä¸€ä¸ªå­—ç¬¦ä¸²è½¬åŒ–ä¸ºæ•´æ•°ã€‚å¦‚æœå­—ç¬¦ä¸²ä¸èƒ½è½¬åŒ–æˆä¸ºæ•´æ•°å°±ä¼šæŠ›å‡º <strong>NumberFormatException</strong> å¼‚å¸¸ï¼Œæˆ‘ä»¬åªé¡»å›è¿‡å¤´æ¥å°†åŸå§‹å­—ç¬¦ä¸²æ”¾å›åˆ°è¾“å‡ºæµä¸­ã€‚</p><p>åœ¨ä»¥ä¸Šä¾‹å­ä¸­ï¼Œ<code>map()</code> å°†ä¸€ä¸ªå­—ç¬¦ä¸²æ˜ å°„ä¸ºå¦ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½†æ˜¯æˆ‘ä»¬å®Œå…¨å¯ä»¥äº§ç”Ÿå’Œæ¥æ”¶ç±»å‹å®Œå…¨ä¸åŒçš„ç±»å‹ï¼Œä»è€Œæ”¹å˜æµçš„æ•°æ®ç±»å‹ã€‚ä¸‹é¢ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/FunctionMap2.java</span><br><span class="hljs-comment">// Different input and output types ï¼ˆä¸åŒçš„è¾“å…¥è¾“å‡ºç±»å‹ï¼‰</span><br><span class="hljs-keyword">import</span> java.util.*;<br><span class="hljs-keyword">import</span> java.util.stream.*;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Numbered</span> </span>&#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> n;<br>    Numbered(<span class="hljs-keyword">int</span> n) &#123;<br>        <span class="hljs-keyword">this</span>.n = n;<br>    &#125;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Numbered(&quot;</span> + n + <span class="hljs-string">&quot;)&quot;</span>;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FunctionMap2</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Stream.of(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>, <span class="hljs-number">13</span>)<br>        .map(Numbered::<span class="hljs-keyword">new</span>)<br>        .forEach(System.out::println);<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">Numbered</span><span class="hljs-params">(<span class="hljs-number">1</span>)</span></span><br><span class="hljs-function"><span class="hljs-title">Numbered</span><span class="hljs-params">(<span class="hljs-number">5</span>)</span></span><br><span class="hljs-function"><span class="hljs-title">Numbered</span><span class="hljs-params">(<span class="hljs-number">7</span>)</span></span><br><span class="hljs-function"><span class="hljs-title">Numbered</span><span class="hljs-params">(<span class="hljs-number">9</span>)</span></span><br><span class="hljs-function"><span class="hljs-title">Numbered</span><span class="hljs-params">(<span class="hljs-number">11</span>)</span></span><br><span class="hljs-function"><span class="hljs-title">Numbered</span><span class="hljs-params">(<span class="hljs-number">13</span>)</span></span><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å°†è·å–åˆ°çš„æ•´æ•°é€šè¿‡æ„é€ å™¨ <code>Numbered::new</code> è½¬åŒ–æˆä¸º <code>Numbered</code> ç±»å‹ã€‚</p><p>å¦‚æœä½¿ç”¨ <strong>Function</strong> è¿”å›çš„ç»“æœæ˜¯æ•°å€¼ç±»å‹çš„ä¸€ç§ï¼Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨åˆé€‚çš„ <code>mapToæ•°å€¼ç±»å‹</code> è¿›è¡Œæ›¿ä»£ã€‚ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/FunctionMap3.java</span><br><span class="hljs-comment">// Producing numeric output streamsï¼ˆ äº§ç”Ÿæ•°å€¼è¾“å‡ºæµï¼‰</span><br><span class="hljs-keyword">import</span> java.util.*;<br><span class="hljs-keyword">import</span> java.util.stream.*;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FunctionMap3</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Stream.of(<span class="hljs-string">&quot;5&quot;</span>, <span class="hljs-string">&quot;7&quot;</span>, <span class="hljs-string">&quot;9&quot;</span>)<br>        .mapToInt(Integer::parseInt)<br>        .forEach(n -&gt; System.out.format(<span class="hljs-string">&quot;%d &quot;</span>, n));<br>        System.out.println();<br>        Stream.of(<span class="hljs-string">&quot;17&quot;</span>, <span class="hljs-string">&quot;19&quot;</span>, <span class="hljs-string">&quot;23&quot;</span>)<br>        .mapToLong(Long::parseLong)<br>        .forEach(n -&gt; System.out.format(<span class="hljs-string">&quot;%d &quot;</span>, n));<br>        System.out.println();<br>        Stream.of(<span class="hljs-string">&quot;17&quot;</span>, <span class="hljs-string">&quot;1.9&quot;</span>, <span class="hljs-string">&quot;.23&quot;</span>)<br>        .mapToDouble(Double::parseDouble)<br>        .forEach(n -&gt; System.out.format(<span class="hljs-string">&quot;%f &quot;</span>, n));<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dns"><span class="hljs-number">5</span> <span class="hljs-number">7</span> <span class="hljs-number">9</span><br><span class="hljs-number">17</span> <span class="hljs-number">19</span> <span class="hljs-number">23</span><br><span class="hljs-number">17.000000</span> <span class="hljs-number">1.900000</span> <span class="hljs-number">0.230000</span><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>é—æ†¾çš„æ˜¯ï¼ŒJava è®¾è®¡è€…å¹¶æ²¡æœ‰å°½æœ€å¤§åŠªåŠ›å»æ¶ˆé™¤åŸºæœ¬ç±»å‹ã€‚</p><h3 id="åœ¨-map-ä¸­ç»„åˆæµ"><a href="#åœ¨-map-ä¸­ç»„åˆæµ" class="headerlink" title="åœ¨ map() ä¸­ç»„åˆæµ"></a>åœ¨ <code>map()</code> ä¸­ç»„åˆæµ</h3><p>å‡è®¾æˆ‘ä»¬ç°åœ¨æœ‰äº†ä¸€ä¸ªä¼ å…¥çš„å…ƒç´ æµï¼Œå¹¶ä¸”æ‰“ç®—å¯¹æµå…ƒç´ ä½¿ç”¨ <code>map()</code> å‡½æ•°ã€‚ç°åœ¨ä½ å·²ç»æ‰¾åˆ°äº†ä¸€äº›å¯çˆ±å¹¶ç‹¬ä¸€æ— äºŒçš„å‡½æ•°åŠŸèƒ½ï¼Œä½†æ˜¯é—®é¢˜æ¥äº†ï¼šè¿™ä¸ªå‡½æ•°åŠŸèƒ½æ˜¯äº§ç”Ÿä¸€ä¸ªæµã€‚æˆ‘ä»¬æƒ³è¦äº§ç”Ÿä¸€ä¸ªå…ƒç´ æµï¼Œè€Œå®é™…å´äº§ç”Ÿäº†ä¸€ä¸ªå…ƒç´ æµçš„æµã€‚</p><p><code>flatMap()</code> åšäº†ä¸¤ä»¶äº‹ï¼šå°†äº§ç”Ÿæµçš„å‡½æ•°åº”ç”¨åœ¨æ¯ä¸ªå…ƒç´ ä¸Šï¼ˆä¸ <code>map()</code> æ‰€åšçš„ç›¸åŒï¼‰ï¼Œç„¶åå°†æ¯ä¸ªæµéƒ½æ‰å¹³åŒ–ä¸ºå…ƒç´ ï¼Œå› è€Œæœ€ç»ˆäº§ç”Ÿçš„ä»…ä»…æ˜¯å…ƒç´ ã€‚</p><p><code>flatMap(Function)</code>ï¼šå½“ <code>Function</code> äº§ç”Ÿæµæ—¶ä½¿ç”¨ã€‚</p><p><code>flatMapToInt(Function)</code>ï¼šå½“ <code>Function</code> äº§ç”Ÿ <code>IntStream</code> æ—¶ä½¿ç”¨ã€‚</p><p><code>flatMapToLong(Function)</code>ï¼šå½“ <code>Function</code> äº§ç”Ÿ <code>LongStream</code> æ—¶ä½¿ç”¨ã€‚</p><p><code>flatMapToDouble(Function)</code>ï¼šå½“ <code>Function</code> äº§ç”Ÿ <code>DoubleStream</code> æ—¶ä½¿ç”¨ã€‚</p><p>ä¸ºäº†å¼„æ¸…å®ƒçš„å·¥ä½œåŸç†ï¼Œæˆ‘ä»¬ä»ä¼ å…¥ä¸€ä¸ªåˆ»æ„è®¾è®¡çš„å‡½æ•°ç»™  <code>map()</code> å¼€å§‹ã€‚è¯¥å‡½æ•°æ¥å—ä¸€ä¸ªæ•´æ•°å¹¶äº§ç”Ÿä¸€ä¸ªå­—ç¬¦ä¸²æµï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/StreamOfStreams.java</span><br><span class="hljs-keyword">import</span> java.util.stream.*;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StreamOfStreams</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Stream.of(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)<br>        .map(i -&gt; Stream.of(<span class="hljs-string">&quot;Gonzo&quot;</span>, <span class="hljs-string">&quot;Kermit&quot;</span>, <span class="hljs-string">&quot;Beaker&quot;</span>))<br>        .map(e-&gt; e.getClass().getName())<br>        .forEach(System.out::println);<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus">java<span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.stream</span>.ReferencePipeline<span class="hljs-variable">$Head</span><br>java<span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.stream</span>.ReferencePipeline<span class="hljs-variable">$Head</span><br>java<span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.stream</span>.ReferencePipeline<span class="hljs-variable">$Head</span><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¤©çœŸåœ°å¸Œæœ›èƒ½å¤Ÿå¾—åˆ°å­—ç¬¦ä¸²æµï¼Œä½†å®é™…å¾—åˆ°çš„å´æ˜¯â€œHeadâ€æµçš„æµã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>flatMap()</code> è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/FlatMap.java</span><br><span class="hljs-keyword">import</span> java.util.stream.*;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FlatMap</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Stream.of(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)<br>        .flatMap(i -&gt; Stream.of(<span class="hljs-string">&quot;Gonzo&quot;</span>, <span class="hljs-string">&quot;Fozzie&quot;</span>, <span class="hljs-string">&quot;Beaker&quot;</span>))<br>        .forEach(System.out::println);<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">Gonzo<br>Fozzie<br><span class="hljs-keyword">Beaker</span><br><span class="hljs-keyword">Gonzo</span><br><span class="hljs-keyword">Fozzie</span><br><span class="hljs-keyword">Beaker</span><br><span class="hljs-keyword">Gonzo</span><br><span class="hljs-keyword">Fozzie</span><br><span class="hljs-keyword">Beaker</span><br><span class="hljs-keyword">å¤åˆ¶ä»£ç </span><br></code></pre></td></tr></table></figure><p>ä»æ˜ å°„è¿”å›çš„æ¯ä¸ªæµéƒ½ä¼šè‡ªåŠ¨æ‰å¹³ä¸ºç»„æˆå®ƒçš„å­—ç¬¦ä¸²ã€‚</p><p>ä¸‹é¢æ˜¯å¦ä¸€ä¸ªæ¼”ç¤ºï¼Œæˆ‘ä»¬ä»ä¸€ä¸ªæ•´æ•°æµå¼€å§‹ï¼Œç„¶åä½¿ç”¨æ¯ä¸€ä¸ªæ•´æ•°å»åˆ›å»ºæ›´å¤šçš„éšæœºæ•°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/StreamOfRandoms.java</span><br><span class="hljs-keyword">import</span> java.util.*;<br><span class="hljs-keyword">import</span> java.util.stream.*;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StreamOfRandoms</span> </span>&#123;<br>    <span class="hljs-keyword">static</span> Random rand = <span class="hljs-keyword">new</span> Random(<span class="hljs-number">47</span>);<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Stream.of(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>)<br>            .flatMapToInt(i -&gt; IntStream.concat(<br>        rand.ints(<span class="hljs-number">0</span>, <span class="hljs-number">100</span>).limit(i), IntStream.of(-<span class="hljs-number">1</span>)))<br>            .forEach(n -&gt; System.out.format(<span class="hljs-string">&quot;%d &quot;</span>, n));<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs tap">58 -1<span class="hljs-number"> 55 </span>93 -1<span class="hljs-number"> 61 </span>61<span class="hljs-number"> 29 </span>-1<span class="hljs-number"> 68 </span>0<span class="hljs-number"> 22 </span>7 -1<span class="hljs-number"> 88 </span>28<span class="hljs-number"> 51 </span>89<span class="hljs-number"> 9 </span>-1<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œæˆ‘ä»¬å¼•å…¥äº† <code>concat()</code>ï¼Œå®ƒä»¥å‚æ•°é¡ºåºç»„åˆä¸¤ä¸ªæµã€‚ å¦‚æ­¤ï¼Œæˆ‘ä»¬åœ¨æ¯ä¸ªéšæœº <code>Integer</code> æµçš„æœ«å°¾æ·»åŠ ä¸€ä¸ª -1 ä½œä¸ºæ ‡è®°ã€‚ä½ å¯ä»¥çœ‹åˆ°æœ€ç»ˆæµç¡®å®æ˜¯ä»ä¸€ç»„æ‰å¹³æµä¸­åˆ›å»ºçš„ã€‚</p><p>å› ä¸º <code>rand.ints()</code> äº§ç”Ÿçš„æ˜¯ä¸€ä¸ª <code>IntStream</code>ï¼Œæ‰€ä»¥æˆ‘å¿…é¡»ä½¿ç”¨ <code>flatMap()</code>ã€<code>concat()</code> å’Œ <code>of()</code> çš„ç‰¹å®šæ•´æ•°å½¢å¼ã€‚</p><p>è®©æˆ‘ä»¬å†çœ‹ä¸€ä¸‹å°†æ–‡ä»¶åˆ’åˆ†ä¸ºå•è¯æµçš„ä»»åŠ¡ã€‚æˆ‘ä»¬æœ€åä½¿ç”¨åˆ°çš„æ˜¯ <strong>FileToWordsRegexp.java</strong>ï¼Œå®ƒçš„é—®é¢˜æ˜¯éœ€è¦å°†æ•´ä¸ªæ–‡ä»¶è¯»å…¥è¡Œåˆ—è¡¨ä¸­ â€”â€” æ˜¾ç„¶éœ€è¦å­˜å‚¨è¯¥åˆ—è¡¨ã€‚è€Œæˆ‘ä»¬çœŸæ­£æƒ³è¦çš„æ˜¯åˆ›å»ºä¸€ä¸ªä¸éœ€è¦ä¸­é—´å­˜å‚¨å±‚çš„å•è¯æµã€‚</p><p>ä¸‹é¢ï¼Œæˆ‘ä»¬å†ä½¿ç”¨ <code> flatMap()</code> æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/FileToWords.java</span><br><span class="hljs-keyword">import</span> java.nio.file.*;<br><span class="hljs-keyword">import</span> java.util.stream.*;<br><span class="hljs-keyword">import</span> java.util.regex.Pattern;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileToWords</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Stream&lt;String&gt; <span class="hljs-title">stream</span><span class="hljs-params">(String filePath)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-keyword">return</span> Files.lines(Paths.get(filePath))<br>        .skip(<span class="hljs-number">1</span>) <span class="hljs-comment">// First (comment) line</span><br>        .flatMap(line -&gt;<br>        Pattern.compile(<span class="hljs-string">&quot;\\W+&quot;</span>).splitAsStream(line));<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p><code>stream()</code> ç°åœ¨æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œå› ä¸ºå®ƒå¯ä»¥è‡ªå·±å®Œæˆæ•´ä¸ªæµåˆ›å»ºè¿‡ç¨‹ã€‚</p><p><strong>æ³¨æ„</strong>ï¼š<code>\\W+</code> æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ã€‚ä»–è¡¨ç¤ºâ€œéå•è¯å­—ç¬¦â€ï¼Œ<code>+</code> è¡¨ç¤ºâ€œå¯ä»¥å‡ºç°ä¸€æ¬¡æˆ–è€…å¤šæ¬¡â€ã€‚å°å†™å½¢å¼çš„ <code>\\w</code> è¡¨ç¤ºâ€œå•è¯å­—ç¬¦â€ã€‚</p><p>æˆ‘ä»¬ä¹‹å‰é‡åˆ°çš„é—®é¢˜æ˜¯ <code>Pattern.compile().splitAsStream()</code> äº§ç”Ÿçš„ç»“æœä¸ºæµï¼Œè¿™æ„å‘³ç€å½“æˆ‘ä»¬åªæ˜¯æƒ³è¦ä¸€ä¸ªç®€å•çš„å•è¯æµæ—¶ï¼Œåœ¨ä¼ å…¥çš„è¡Œæµï¼ˆstream of linesï¼‰ä¸Šè°ƒç”¨ <code>map()</code> ä¼šäº§ç”Ÿä¸€ä¸ªå•è¯æµçš„æµã€‚å¹¸è¿çš„æ˜¯ï¼Œ<code>flatMap()</code>  å¯ä»¥å°†å…ƒç´ æµçš„æµæ‰å¹³åŒ–ä¸ºä¸€ä¸ªç®€å•çš„å…ƒç´ æµã€‚æˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>String.split()</code> ç”Ÿæˆä¸€ä¸ªæ•°ç»„ï¼Œå…¶å¯ä»¥è¢« <code>Arrays.stream()</code> è½¬åŒ–æˆä¸ºæµï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">.flatMap(line -&gt; Arrays.stream(line.split(<span class="hljs-string">&quot;\\W+&quot;</span>))))<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>æœ‰äº†çœŸæ­£çš„ã€è€Œé <code>FileToWordsRegexp.java</code> ä¸­åŸºäºé›†åˆå­˜å‚¨çš„æµï¼Œæˆ‘ä»¬æ¯æ¬¡ä½¿ç”¨éƒ½å¿…é¡»ä»å¤´åˆ›å»ºï¼Œå› ä¸ºæµå¹¶ä¸èƒ½è¢«å¤ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/FileToWordsTest.java</span><br><span class="hljs-keyword">import</span> java.util.stream.*;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileToWordsTest</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        FileToWords.stream(<span class="hljs-string">&quot;Cheese.dat&quot;</span>)<br>        .limit(<span class="hljs-number">7</span>)<br>        .forEach(s -&gt; System.out.format(<span class="hljs-string">&quot;%s &quot;</span>, s));<br>        System.out.println();<br>        FileToWords.stream(<span class="hljs-string">&quot;Cheese.dat&quot;</span>)<br>        .skip(<span class="hljs-number">7</span>)<br>        .limit(<span class="hljs-number">2</span>)<br>        .forEach(s -&gt; System.out.format(<span class="hljs-string">&quot;%s &quot;</span>, s));<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs applescript">Not much <span class="hljs-keyword">of</span> a cheese shop really<br><span class="hljs-keyword">is</span> <span class="hljs-keyword">it</span><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>åœ¨ <code>System.out.format()</code> ä¸­çš„ <code>%s</code> è¡¨æ˜å‚æ•°ä¸º <strong>String</strong> ç±»å‹ã€‚</p><h2 id="Optionalç±»"><a href="#Optionalç±»" class="headerlink" title="Optionalç±»"></a>Optionalç±»</h2><p>åœ¨æˆ‘ä»¬å­¦ä¹ ç»ˆç«¯æ“ä½œä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»è€ƒè™‘å¦‚æœä½ åœ¨ä¸€ä¸ªç©ºæµä¸­è·å–å…ƒç´ ä¼šå‘ç”Ÿä»€ä¹ˆã€‚æˆ‘ä»¬å–œæ¬¢ä¸ºäº†â€œhappy pathâ€è€Œå°†æµè¿æ¥èµ·æ¥ï¼Œå¹¶å‡è®¾æµä¸ä¼šè¢«ä¸­æ–­ã€‚åœ¨æµä¸­æ”¾ç½® <code>null</code> æ˜¯å¾ˆå¥½çš„ä¸­æ–­æ–¹æ³•ã€‚é‚£ä¹ˆæ˜¯å¦æœ‰æŸç§å¯¹è±¡ï¼Œå¯ä½œä¸ºæµå…ƒç´ çš„æŒæœ‰è€…ï¼Œå³ä½¿æŸ¥çœ‹çš„å…ƒç´ ä¸å­˜åœ¨ä¹Ÿèƒ½å‹å¥½åœ°æç¤ºæˆ‘ä»¬ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ä¼šå‘ç”Ÿå¼‚å¸¸ï¼‰ï¼Ÿ</p><p><strong>Optional</strong> å¯ä»¥å®ç°è¿™æ ·çš„åŠŸèƒ½ã€‚ä¸€äº›æ ‡å‡†æµæ“ä½œè¿”å› <strong>Optional</strong> å¯¹è±¡ï¼Œå› ä¸ºå®ƒä»¬å¹¶ä¸èƒ½ä¿è¯é¢„æœŸç»“æœä¸€å®šå­˜åœ¨ã€‚åŒ…æ‹¬ï¼š</p><ul><li><code>findFirst()</code> è¿”å›ä¸€ä¸ªåŒ…å«ç¬¬ä¸€ä¸ªå…ƒç´ çš„ <strong>Optional</strong> å¯¹è±¡ï¼Œå¦‚æœæµä¸ºç©ºåˆ™è¿”å› <strong>Optional.empty</strong></li><li><code>findAny()</code> è¿”å›åŒ…å«ä»»æ„å…ƒç´ çš„ <strong>Optional</strong> å¯¹è±¡ï¼Œå¦‚æœæµä¸ºç©ºåˆ™è¿”å› <strong>Optional.empty</strong></li><li><code>max()</code> å’Œ <code>min()</code> è¿”å›ä¸€ä¸ªåŒ…å«æœ€å¤§å€¼æˆ–è€…æœ€å°å€¼çš„ <strong>Optional</strong> å¯¹è±¡ï¼Œå¦‚æœæµä¸ºç©ºåˆ™è¿”å› <strong>Optional.empty</strong></li></ul><p><code>reduce()</code> ä¸å†ä»¥ <code>identity</code> å½¢å¼å¼€å¤´ï¼Œè€Œæ˜¯å°†å…¶è¿”å›å€¼åŒ…è£…åœ¨ <strong>Optional</strong> ä¸­ã€‚ï¼ˆ<code>identity</code> å¯¹è±¡æˆä¸ºå…¶ä»–å½¢å¼çš„ <code>reduce()</code> çš„é»˜è®¤ç»“æœï¼Œå› æ­¤ä¸å­˜åœ¨ç©ºç»“æœçš„é£é™©ï¼‰</p><p>å¯¹äºæ•°å­—æµ <strong>IntStream</strong>ã€<strong>LongStream</strong> å’Œ <strong>DoubleStream</strong>ï¼Œ<code>average()</code> ä¼šå°†ç»“æœåŒ…è£…åœ¨ <strong>Optional</strong> ä»¥é˜²æ­¢æµä¸ºç©ºã€‚</p><p>ä»¥ä¸‹æ˜¯å¯¹ç©ºæµè¿›è¡Œæ‰€æœ‰è¿™äº›æ“ä½œçš„ç®€å•æµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/OptionalsFromEmptyStreams.java</span><br><span class="hljs-keyword">import</span> java.util.*;<br><span class="hljs-keyword">import</span> java.util.stream.*;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OptionalsFromEmptyStreams</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        System.out.println(Stream.&lt;String&gt;empty()<br>             .findFirst());<br>        System.out.println(Stream.&lt;String&gt;empty()<br>             .findAny());<br>        System.out.println(Stream.&lt;String&gt;empty()<br>             .max(String.CASE_INSENSITIVE_ORDER));<br>        System.out.println(Stream.&lt;String&gt;empty()<br>             .min(String.CASE_INSENSITIVE_ORDER));<br>        System.out.println(Stream.&lt;String&gt;empty()<br>             .reduce((s1, s2) -&gt; s1 + s2));<br>        System.out.println(IntStream.empty()<br>             .average());<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Optional</span>.</span></span>empty<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Optional</span>.</span></span>empty<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Optional</span>.</span></span>empty<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Optional</span>.</span></span>empty<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Optional</span>.</span></span>empty<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">OptionalDouble</span>.</span></span>empty<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>å½“æµä¸ºç©ºçš„æ—¶å€™ä½ ä¼šè·å¾—ä¸€ä¸ª <strong>Optional.empty</strong> å¯¹è±¡ï¼Œè€Œä¸æ˜¯æŠ›å‡ºå¼‚å¸¸ã€‚<strong>Optional</strong> æ‹¥æœ‰ <code>toString()</code> æ–¹æ³•å¯ä»¥ç”¨äºå±•ç¤ºæœ‰ç”¨ä¿¡æ¯ã€‚</p><p>æ³¨æ„ï¼Œç©ºæµæ˜¯é€šè¿‡ <code>Stream.&lt;String&gt;empty()</code> åˆ›å»ºçš„ã€‚å¦‚æœä½ åœ¨æ²¡æœ‰ä»»ä½•ä¸Šä¸‹æ–‡ç¯å¢ƒçš„æƒ…å†µä¸‹è°ƒç”¨ <code>Stream.empty()</code>ï¼ŒJava å¹¶ä¸çŸ¥é“å®ƒçš„æ•°æ®ç±»å‹ï¼›è¿™ä¸ªè¯­æ³•è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚å¦‚æœç¼–è¯‘å™¨æ‹¥æœ‰äº†è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">Stream&lt;String&gt; s = Stream.empty();<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>å°±å¯ä»¥åœ¨è°ƒç”¨ <code>empty()</code> æ—¶æ¨æ–­ç±»å‹ã€‚</p><p>è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº† <strong>Optional</strong> çš„ä¸¤ä¸ªåŸºæœ¬ç”¨æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/OptionalBasics.java</span><br><span class="hljs-keyword">import</span> java.util.*;<br><span class="hljs-keyword">import</span> java.util.stream.*;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OptionalBasics</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">(Optional&lt;String&gt; optString)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span>(optString.isPresent())<br>            System.out.println(optString.get()); <br>        <span class="hljs-keyword">else</span><br>            System.out.println(<span class="hljs-string">&quot;Nothing inside!&quot;</span>);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        test(Stream.of(<span class="hljs-string">&quot;Epithets&quot;</span>).findFirst());<br>        test(Stream.&lt;String&gt;empty().findFirst());<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs erlang-repl">Epithets<br>Nothing inside!<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>å½“ä½ æ¥æ”¶åˆ° <strong>Optional</strong> å¯¹è±¡æ—¶ï¼Œåº”é¦–å…ˆè°ƒç”¨ <code>isPresent()</code> æ£€æŸ¥å…¶ä¸­æ˜¯å¦åŒ…å«å…ƒç´ ã€‚å¦‚æœå­˜åœ¨ï¼Œå¯ä½¿ç”¨ <code>get()</code> è·å–ã€‚</p><h3 id="ä¾¿åˆ©å‡½æ•°"><a href="#ä¾¿åˆ©å‡½æ•°" class="headerlink" title="ä¾¿åˆ©å‡½æ•°"></a>ä¾¿åˆ©å‡½æ•°</h3><p>æœ‰è®¸å¤šä¾¿åˆ©å‡½æ•°å¯ä»¥è§£åŒ… <strong>Optional</strong> ï¼Œè¿™ç®€åŒ–äº†ä¸Šè¿°â€œå¯¹æ‰€åŒ…å«çš„å¯¹è±¡çš„æ£€æŸ¥å’Œæ‰§è¡Œæ“ä½œâ€çš„è¿‡ç¨‹ï¼š</p><ul><li><code>ifPresent(Consumer)</code>ï¼šå½“å€¼å­˜åœ¨æ—¶è°ƒç”¨ <strong>Consumer</strong>ï¼Œå¦åˆ™ä»€ä¹ˆä¹Ÿä¸åšã€‚</li><li><code>orElse(otherObject)</code>ï¼šå¦‚æœå€¼å­˜åœ¨åˆ™ç›´æ¥è¿”å›ï¼Œå¦åˆ™ç”Ÿæˆ <strong>otherObject</strong>ã€‚</li><li><code>orElseGet(Supplier)</code>ï¼šå¦‚æœå€¼å­˜åœ¨åˆ™ç›´æ¥è¿”å›ï¼Œå¦åˆ™ä½¿ç”¨ <strong>Supplier</strong> å‡½æ•°ç”Ÿæˆä¸€ä¸ªå¯æ›¿ä»£å¯¹è±¡ã€‚</li><li><code>orElseThrow(Supplier)</code>ï¼šå¦‚æœå€¼å­˜åœ¨ç›´æ¥è¿”å›ï¼Œå¦åˆ™ä½¿ç”¨ <strong>Supplier</strong> å‡½æ•°ç”Ÿæˆä¸€ä¸ªå¼‚å¸¸ã€‚</li></ul><p>å¦‚ä¸‹æ˜¯é’ˆå¯¹ä¸åŒä¾¿åˆ©å‡½æ•°çš„ç®€å•æ¼”ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/Optionals.java</span><br><span class="hljs-keyword">import</span> java.util.*;<br><span class="hljs-keyword">import</span> java.util.stream.*;<br><span class="hljs-keyword">import</span> java.util.function.*;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Optionals</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">basics</span><span class="hljs-params">(Optional&lt;String&gt; optString)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span>(optString.isPresent())<br>            System.out.println(optString.get()); <br>        <span class="hljs-keyword">else</span><br>            System.out.println(<span class="hljs-string">&quot;Nothing inside!&quot;</span>);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ifPresent</span><span class="hljs-params">(Optional&lt;String&gt; optString)</span> </span>&#123;<br>        optString.ifPresent(System.out::println);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">orElse</span><span class="hljs-params">(Optional&lt;String&gt; optString)</span> </span>&#123;<br>        System.out.println(optString.orElse(<span class="hljs-string">&quot;Nada&quot;</span>));<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">orElseGet</span><span class="hljs-params">(Optional&lt;String&gt; optString)</span> </span>&#123;<br>        System.out.println(<br>        optString.orElseGet(() -&gt; <span class="hljs-string">&quot;Generated&quot;</span>));<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">orElseThrow</span><span class="hljs-params">(Optional&lt;String&gt; optString)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            System.out.println(optString.orElseThrow(<br>            () -&gt; <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">&quot;Supplied&quot;</span>)));<br>        &#125; <span class="hljs-keyword">catch</span>(Exception e) &#123;<br>            System.out.println(<span class="hljs-string">&quot;Caught &quot;</span> + e);<br>        &#125;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">(String testName, Consumer&lt;Optional&lt;String&gt;&gt; cos)</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot; === &quot;</span> + testName + <span class="hljs-string">&quot; === &quot;</span>);<br>        cos.accept(Stream.of(<span class="hljs-string">&quot;Epithets&quot;</span>).findFirst());<br>        cos.accept(Stream.&lt;String&gt;empty().findFirst());<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        test(<span class="hljs-string">&quot;basics&quot;</span>, Optionals::basics);<br>        test(<span class="hljs-string">&quot;ifPresent&quot;</span>, Optionals::ifPresent);<br>        test(<span class="hljs-string">&quot;orElse&quot;</span>, Optionals::orElse);<br>        test(<span class="hljs-string">&quot;orElseGet&quot;</span>, Optionals::orElseGet);<br>        test(<span class="hljs-string">&quot;orElseThrow&quot;</span>, Optionals::orElseThrow);<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">=== basics ===</span><br>Epithets<br>Nothing inside!<br><span class="hljs-section">=== ifPresent ===</span><br>Epithets<br><span class="hljs-section">=== orElse ===</span><br>Epithets<br>Nada<br><span class="hljs-section">=== orElseGet ===</span><br>Epithets<br>Generated<br><span class="hljs-section">=== orElseThrow ===</span><br>Epithets<br>Caught java.lang.Exception: Supplied<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p><code>test()</code> é€šè¿‡ä¼ å…¥æ‰€æœ‰æ–¹æ³•éƒ½é€‚ç”¨çš„ <strong>Consumer</strong> æ¥é¿å…é‡å¤ä»£ç ã€‚</p><p><code>orElseThrow()</code> é€šè¿‡ <strong>catch</strong> å…³é”®å­—æ¥æ•è·æŠ›å‡ºçš„å¼‚å¸¸ã€‚æ›´å¤šç»†èŠ‚ï¼Œå°†åœ¨ <a href="./15-Exceptions.md">å¼‚å¸¸</a> è¿™ä¸€ç« èŠ‚ä¸­å­¦ä¹ ã€‚</p><h3 id="åˆ›å»º-Optional"><a href="#åˆ›å»º-Optional" class="headerlink" title="åˆ›å»º Optional"></a>åˆ›å»º Optional</h3><p>å½“æˆ‘ä»¬åœ¨è‡ªå·±çš„ä»£ç ä¸­åŠ å…¥ <strong>Optional</strong> æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢ 3 ä¸ªé™æ€æ–¹æ³•ï¼š</p><ul><li><code>empty()</code>ï¼šç”Ÿæˆä¸€ä¸ªç©º <strong>Optional</strong>ã€‚</li><li><code>of(value)</code>ï¼šå°†ä¸€ä¸ªéç©ºå€¼åŒ…è£…åˆ° <strong>Optional</strong> é‡Œã€‚</li><li><code>ofNullable(value)</code>ï¼šé’ˆå¯¹ä¸€ä¸ªå¯èƒ½ä¸ºç©ºçš„å€¼ï¼Œä¸ºç©ºæ—¶è‡ªåŠ¨ç”Ÿæˆ <strong>Optional.empty</strong>ï¼Œå¦åˆ™å°†å€¼åŒ…è£…åœ¨ <strong>Optional</strong> ä¸­ã€‚</li></ul><p>ä¸‹é¢æ¥çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/CreatingOptionals.java</span><br><span class="hljs-keyword">import</span> java.util.*;<br><span class="hljs-keyword">import</span> java.util.stream.*;<br><span class="hljs-keyword">import</span> java.util.function.*;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CreatingOptionals</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">(String testName, Optional&lt;String&gt; opt)</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot; === &quot;</span> + testName + <span class="hljs-string">&quot; === &quot;</span>);<br>        System.out.println(opt.orElse(<span class="hljs-string">&quot;Null&quot;</span>));<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        test(<span class="hljs-string">&quot;empty&quot;</span>, Optional.empty());<br>        test(<span class="hljs-string">&quot;of&quot;</span>, Optional.of(<span class="hljs-string">&quot;Howdy&quot;</span>));<br>        <span class="hljs-keyword">try</span> &#123;<br>            test(<span class="hljs-string">&quot;of&quot;</span>, Optional.of(<span class="hljs-keyword">null</span>));<br>        &#125; <span class="hljs-keyword">catch</span>(Exception e) &#123;<br>            System.out.println(e);<br>        &#125;<br>        test(<span class="hljs-string">&quot;ofNullable&quot;</span>, Optional.ofNullable(<span class="hljs-string">&quot;Hi&quot;</span>));<br>        test(<span class="hljs-string">&quot;ofNullable&quot;</span>, Optional.ofNullable(<span class="hljs-keyword">null</span>));<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">=== empty ===</span><br>Null<br><span class="hljs-section">=== of ===</span><br>Howdy<br>java.lang.NullPointerException<br><span class="hljs-section">=== ofNullable ===</span><br>Hi<br><span class="hljs-section">=== ofNullable ===</span><br>Null<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¸èƒ½é€šè¿‡ä¼ é€’ <code>null</code> åˆ° <code>of()</code> æ¥åˆ›å»º <code>Optional</code> å¯¹è±¡ã€‚æœ€å®‰å…¨çš„æ–¹æ³•æ˜¯ï¼Œ ä½¿ç”¨ <code>ofNullable()</code> æ¥ä¼˜é›…åœ°å¤„ç† <code>null</code>ã€‚</p><h3 id="Optional-å¯¹è±¡æ“ä½œ"><a href="#Optional-å¯¹è±¡æ“ä½œ" class="headerlink" title="Optional å¯¹è±¡æ“ä½œ"></a>Optional å¯¹è±¡æ“ä½œ</h3><p>å½“æˆ‘ä»¬çš„æµç®¡é“ç”Ÿæˆäº† <strong>Optional</strong> å¯¹è±¡ï¼Œä¸‹é¢ 3 ä¸ªæ–¹æ³•å¯ä½¿å¾— <strong>Optional</strong> çš„åç»­èƒ½åšæ›´å¤šçš„æ“ä½œï¼š</p><ul><li><code>filter(Predicate)</code>ï¼šå°† <strong>Predicate</strong> åº”ç”¨äº <strong>Optional</strong> ä¸­çš„å†…å®¹å¹¶è¿”å›ç»“æœã€‚å½“ <strong>Optional</strong> ä¸æ»¡è¶³ <strong>Predicate</strong> æ—¶è¿”å›ç©ºã€‚å¦‚æœ <strong>Optional</strong> ä¸ºç©ºï¼Œåˆ™ç›´æ¥è¿”å›ã€‚</li><li><code>map(Function)</code>ï¼šå¦‚æœ <strong>Optional</strong> ä¸ä¸ºç©ºï¼Œåº”ç”¨ <strong>Function</strong>  äº <strong>Optional</strong> ä¸­çš„å†…å®¹ï¼Œå¹¶è¿”å›ç»“æœã€‚å¦åˆ™ç›´æ¥è¿”å› <strong>Optional.empty</strong>ã€‚</li><li><code>flatMap(Function)</code>ï¼šåŒ <code>map()</code>ï¼Œä½†æ˜¯æä¾›çš„æ˜ å°„å‡½æ•°å°†ç»“æœåŒ…è£…åœ¨ <strong>Optional</strong> å¯¹è±¡ä¸­ï¼Œå› æ­¤ <code>flatMap()</code> ä¸ä¼šåœ¨æœ€åè¿›è¡Œä»»ä½•åŒ…è£…ã€‚</li></ul><p>ä»¥ä¸Šæ–¹æ³•éƒ½ä¸é€‚ç”¨äºæ•°å€¼å‹ <strong>Optional</strong>ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œæµçš„ <code>filter()</code> ä¼šåœ¨ <strong>Predicate</strong> è¿”å› <code>false</code> æ—¶ç§»é™¤æµå…ƒç´ ã€‚ è€Œ <code>Optional.filter()</code> åœ¨å¤±è´¥æ—¶ä¸ä¼šåˆ é™¤ <strong>Optional</strong>ï¼Œè€Œæ˜¯å°†å…¶ä¿ç•™ä¸‹æ¥ï¼Œå¹¶è½¬åŒ–ä¸ºç©ºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.*;<br><span class="hljs-keyword">import</span> java.util.stream.*;<br><span class="hljs-keyword">import</span> java.util.function.*;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OptionalFilter</span> </span>&#123;<br>    <span class="hljs-keyword">static</span> String[] elements = &#123;<br>            <span class="hljs-string">&quot;Foo&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;Bar&quot;</span>, <span class="hljs-string">&quot;Baz&quot;</span>, <span class="hljs-string">&quot;Bingo&quot;</span><br>    &#125;;<br>    <span class="hljs-function"><span class="hljs-keyword">static</span> Stream&lt;String&gt; <span class="hljs-title">testStream</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> Arrays.stream(elements);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">(String descr, Predicate&lt;String&gt; pred)</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot; ---( &quot;</span> + descr + <span class="hljs-string">&quot; )---&quot;</span>);<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt;= elements.length; i++) &#123;<br>            System.out.println(<br>                    testStream()<br>                            .skip(i)<br>                            .findFirst()<br>                            .filter(pred));<br>        &#125;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        test(<span class="hljs-string">&quot;true&quot;</span>, str -&gt; <span class="hljs-keyword">true</span>);<br>        test(<span class="hljs-string">&quot;false&quot;</span>, str -&gt; <span class="hljs-keyword">false</span>);<br>        test(<span class="hljs-string">&quot;str != \&quot;\&quot;&quot;</span>, str -&gt; str != <span class="hljs-string">&quot;&quot;</span>);<br>        test(<span class="hljs-string">&quot;str.length() == 3&quot;</span>, str -&gt; str.length() == <span class="hljs-number">3</span>);<br>        test(<span class="hljs-string">&quot;startsWith(\&quot;B\&quot;)&quot;</span>,<br>                str -&gt; str.startsWith(<span class="hljs-string">&quot;B&quot;</span>));<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">---( <span class="hljs-literal">true</span> )---<br>Optional<span class="hljs-literal">[F<span class="hljs-identifier">oo</span>]</span><br>Optional<span class="hljs-literal">[]</span><br>Optional<span class="hljs-literal">[B<span class="hljs-identifier">ar</span>]</span><br>Optional<span class="hljs-literal">[B<span class="hljs-identifier">az</span>]</span><br>Optional<span class="hljs-literal">[B<span class="hljs-identifier">ingo</span>]</span><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Optional</span>.</span></span>empty<br>---( <span class="hljs-literal">false</span> )---<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Optional</span>.</span></span>empty<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Optional</span>.</span></span>empty<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Optional</span>.</span></span>empty<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Optional</span>.</span></span>empty<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Optional</span>.</span></span>empty<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Optional</span>.</span></span>empty<br>---( str != <span class="hljs-string">&quot;&quot;</span> )---<br>Optional<span class="hljs-literal">[F<span class="hljs-identifier">oo</span>]</span><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Optional</span>.</span></span>empty<br>Optional<span class="hljs-literal">[B<span class="hljs-identifier">ar</span>]</span><br>Optional<span class="hljs-literal">[B<span class="hljs-identifier">az</span>]</span><br>Optional<span class="hljs-literal">[B<span class="hljs-identifier">ingo</span>]</span><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Optional</span>.</span></span>empty<br>---( str.length<span class="hljs-literal">()</span><span class="hljs-operator"> == </span><span class="hljs-number">3</span> )---<br>Optional<span class="hljs-literal">[F<span class="hljs-identifier">oo</span>]</span><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Optional</span>.</span></span>empty<br>Optional<span class="hljs-literal">[B<span class="hljs-identifier">ar</span>]</span><br>Optional<span class="hljs-literal">[B<span class="hljs-identifier">az</span>]</span><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Optional</span>.</span></span>empty<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Optional</span>.</span></span>empty<br>---( starts<span class="hljs-constructor">With(<span class="hljs-string">&quot;B&quot;</span>)</span> )---<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Optional</span>.</span></span>empty<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Optional</span>.</span></span>empty<br>Optional<span class="hljs-literal">[B<span class="hljs-identifier">ar</span>]</span><br>Optional<span class="hljs-literal">[B<span class="hljs-identifier">az</span>]</span><br>Optional<span class="hljs-literal">[B<span class="hljs-identifier">ingo</span>]</span><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Optional</span>.</span></span>empty<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>å³ä½¿è¾“å‡ºçœ‹èµ·æ¥åƒæµï¼Œç‰¹åˆ«æ˜¯ <code>test()</code> ä¸­çš„ for å¾ªç¯ã€‚æ¯ä¸€æ¬¡çš„ for å¾ªç¯æ—¶é‡æ–°å¯åŠ¨æµï¼Œç„¶åæ ¹æ® for å¾ªç¯çš„ç´¢å¼•è·³è¿‡æŒ‡å®šä¸ªæ•°çš„å…ƒç´ ï¼Œè¿™å°±æ˜¯å®ƒæœ€ç»ˆåœ¨æµä¸­çš„æ¯ä¸ªè¿ç»­å…ƒç´ ä¸Šçš„ç»“æœã€‚æ¥ä¸‹æ¥è°ƒç”¨ <code>findFirst()</code> è·å–å‰©ä½™å…ƒç´ ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œç»“æœä¼šåŒ…è£…åœ¨ <strong>Optional</strong> ä¸­ã€‚</p><p><strong>æ³¨æ„</strong>ï¼Œä¸åŒäºæ™®é€š for å¾ªç¯ï¼Œè¿™é‡Œçš„ç´¢å¼•å€¼èŒƒå›´å¹¶ä¸æ˜¯ <code>i &lt; elements.length</code>ï¼Œ è€Œæ˜¯ <code>i &lt;= elements.length</code>ã€‚æ‰€ä»¥æœ€åä¸€ä¸ªå…ƒç´ å®é™…ä¸Šè¶…å‡ºäº†æµã€‚æ–¹ä¾¿çš„æ˜¯ï¼Œè¿™å°†è‡ªåŠ¨æˆä¸º <strong>Optional.empty</strong>ï¼Œä½ å¯ä»¥åœ¨æ¯ä¸€ä¸ªæµ‹è¯•çš„ç»“å°¾ä¸­çœ‹åˆ°ã€‚</p><p>åŒ <code>map()</code> ä¸€æ · ï¼Œ <code>Optional.map()</code> åº”ç”¨äºå‡½æ•°ã€‚å®ƒä»…åœ¨ <strong>Optional</strong> ä¸ä¸ºç©ºæ—¶æ‰åº”ç”¨æ˜ å°„å‡½æ•°ï¼Œå¹¶å°† <strong>Optional</strong> çš„å†…å®¹æå–åˆ°æ˜ å°„å‡½æ•°ã€‚ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/OptionalMap.java</span><br><span class="hljs-keyword">import</span> java.util.Arrays;<br><span class="hljs-keyword">import</span> java.util.function.Function;<br><span class="hljs-keyword">import</span> java.util.stream.Stream;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OptionalMap</span> </span>&#123;<br>    <span class="hljs-keyword">static</span> String[] elements = &#123;<span class="hljs-string">&quot;12&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;23&quot;</span>, <span class="hljs-string">&quot;45&quot;</span>&#125;;<br><br>    <span class="hljs-function"><span class="hljs-keyword">static</span> Stream&lt;String&gt; <span class="hljs-title">testStream</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> Arrays.stream(elements);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">(String descr, Function&lt;String, String&gt; func)</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot; ---( &quot;</span> + descr + <span class="hljs-string">&quot; )---&quot;</span>);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt;= elements.length; i++) &#123;<br>            System.out.println(<br>                    testStream()<br>                            .skip(i)<br>                            .findFirst() <span class="hljs-comment">// Produces an Optional</span><br>                            .map(func));<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-comment">// If Optional is not empty, map() first extracts</span><br>        <span class="hljs-comment">// the contents which it then passes</span><br>        <span class="hljs-comment">// to the function:</span><br>        test(<span class="hljs-string">&quot;Add brackets&quot;</span>, s -&gt; <span class="hljs-string">&quot;[&quot;</span> + s + <span class="hljs-string">&quot;]&quot;</span>);<br>        test(<span class="hljs-string">&quot;Increment&quot;</span>, s -&gt; &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-keyword">return</span> Integer.parseInt(s) + <span class="hljs-number">1</span> + <span class="hljs-string">&quot;&quot;</span>;<br>            &#125; <span class="hljs-keyword">catch</span> (NumberFormatException e) &#123;<br>                <span class="hljs-keyword">return</span> s;<br>            &#125;<br>        &#125;);<br>        test(<span class="hljs-string">&quot;Replace&quot;</span>, s -&gt; s.replace(<span class="hljs-string">&quot;2&quot;</span>, <span class="hljs-string">&quot;9&quot;</span>));<br>        test(<span class="hljs-string">&quot;Take last digit&quot;</span>, s -&gt; s.length() &gt; <span class="hljs-number">0</span> ?<br>                s.charAt(s.length() - <span class="hljs-number">1</span>) + <span class="hljs-string">&quot;&quot;</span> : s);<br>    &#125;<br>    <span class="hljs-comment">// After the function is finished, map() wraps the</span><br>    <span class="hljs-comment">// result in an Optional before returning it:</span><br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-comment">---( Add brackets )---</span><br>Optional<span class="hljs-string">[[12]]</span><br>Optional<span class="hljs-string">[[]]</span><br>Optional<span class="hljs-string">[[23]]</span><br>Optional<span class="hljs-string">[[45]]</span><br>Optional.empty<br><span class="hljs-comment">---( Increment )---</span><br>Optional[<span class="hljs-number">13</span>]<br>Optional[]<br>Optional[<span class="hljs-number">24</span>]<br>Optional[<span class="hljs-number">46</span>]<br>Optional.empty<br><span class="hljs-comment">---( Replace )---</span><br>Optional[<span class="hljs-number">19</span>]<br>Optional[]<br>Optional[<span class="hljs-number">93</span>]<br>Optional[<span class="hljs-number">45</span>]<br>Optional.empty<br><span class="hljs-comment">---( Take last digit )---</span><br>Optional[<span class="hljs-number">2</span>]<br>Optional[]<br>Optional[<span class="hljs-number">3</span>]<br>Optional[<span class="hljs-number">5</span>]<br>Optional.empty<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>æ˜ å°„å‡½æ•°çš„è¿”å›ç»“æœä¼šè‡ªåŠ¨åŒ…è£…æˆä¸º <strong>Optional</strong>ã€‚<strong>Optional.empty</strong> ä¼šè¢«ç›´æ¥è·³è¿‡ã€‚</p><p><strong>Optional</strong> çš„ <code>flatMap()</code> åº”ç”¨äºå·²ç”Ÿæˆ <strong>Optional</strong> çš„æ˜ å°„å‡½æ•°ï¼Œæ‰€ä»¥ <code>flatMap()</code> ä¸ä¼šåƒ <code>map()</code> é‚£æ ·å°†ç»“æœå°è£…åœ¨ <strong>Optional</strong> ä¸­ã€‚ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/OptionalFlatMap.java</span><br><span class="hljs-keyword">import</span> java.util.Arrays;<br><span class="hljs-keyword">import</span> java.util.Optional;<br><span class="hljs-keyword">import</span> java.util.function.Function;<br><span class="hljs-keyword">import</span> java.util.stream.Stream;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OptionalFlatMap</span> </span>&#123;<br>    <span class="hljs-keyword">static</span> String[] elements = &#123;<span class="hljs-string">&quot;12&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;23&quot;</span>, <span class="hljs-string">&quot;45&quot;</span>&#125;;<br><br>    <span class="hljs-function"><span class="hljs-keyword">static</span> Stream&lt;String&gt; <span class="hljs-title">testStream</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> Arrays.stream(elements);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">(String descr,</span></span><br><span class="hljs-function"><span class="hljs-params">                     Function&lt;String, Optional&lt;String&gt;&gt; func)</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot; ---( &quot;</span> + descr + <span class="hljs-string">&quot; )---&quot;</span>);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt;= elements.length; i++) &#123;<br>            System.out.println(<br>                    testStream()<br>                            .skip(i)<br>                            .findFirst()<br>                            .flatMap(func));<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        test(<span class="hljs-string">&quot;Add brackets&quot;</span>,<br>                s -&gt; Optional.of(<span class="hljs-string">&quot;[&quot;</span> + s + <span class="hljs-string">&quot;]&quot;</span>));<br>        test(<span class="hljs-string">&quot;Increment&quot;</span>, s -&gt; &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-keyword">return</span> Optional.of(<br>                        Integer.parseInt(s) + <span class="hljs-number">1</span> + <span class="hljs-string">&quot;&quot;</span>);<br>            &#125; <span class="hljs-keyword">catch</span> (NumberFormatException e) &#123;<br>                <span class="hljs-keyword">return</span> Optional.of(s);<br>            &#125;<br>        &#125;);<br>        test(<span class="hljs-string">&quot;Replace&quot;</span>,<br>                s -&gt; Optional.of(s.replace(<span class="hljs-string">&quot;2&quot;</span>, <span class="hljs-string">&quot;9&quot;</span>)));<br>        test(<span class="hljs-string">&quot;Take last digit&quot;</span>,<br>                s -&gt; Optional.of(s.length() &gt; <span class="hljs-number">0</span> ?<br>                        s.charAt(s.length() - <span class="hljs-number">1</span>) + <span class="hljs-string">&quot;&quot;</span><br>                        : s));<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-comment">---( Add brackets )---</span><br>Optional<span class="hljs-string">[[12]]</span><br>Optional<span class="hljs-string">[[]]</span><br>Optional<span class="hljs-string">[[23]]</span><br>Optional<span class="hljs-string">[[45]]</span><br>Optional.empty<br> <span class="hljs-comment">---( Increment )---</span><br>Optional[<span class="hljs-number">13</span>]<br>Optional[]<br>Optional[<span class="hljs-number">24</span>]<br>Optional[<span class="hljs-number">46</span>]<br>Optional.empty<br> <span class="hljs-comment">---( Replace )---</span><br>Optional[<span class="hljs-number">19</span>]<br>Optional[]<br>Optional[<span class="hljs-number">93</span>]<br>Optional[<span class="hljs-number">45</span>]<br>Optional.empty<br> <span class="hljs-comment">---( Take last digit )---</span><br>Optional[<span class="hljs-number">2</span>]<br>Optional[]<br>Optional[<span class="hljs-number">3</span>]<br>Optional[<span class="hljs-number">5</span>]<br>Optional.empty<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>åŒ <code>map()</code>ï¼Œ<code>flatMap()</code> å°†æå–éç©º <strong>Optional</strong> çš„å†…å®¹å¹¶å°†å…¶åº”ç”¨åœ¨æ˜ å°„å‡½æ•°ã€‚å”¯ä¸€çš„åŒºåˆ«å°±æ˜¯ <code>flatMap()</code> ä¸ä¼šæŠŠç»“æœåŒ…è£…åœ¨ <strong>Optional</strong> ä¸­ï¼Œå› ä¸ºæ˜ å°„å‡½æ•°å·²ç»è¢«åŒ…è£…è¿‡äº†ã€‚åœ¨å¦‚ä¸Šç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å·²ç»åœ¨æ¯ä¸€ä¸ªæ˜ å°„å‡½æ•°ä¸­æ˜¾å¼åœ°å®Œæˆäº†åŒ…è£…ï¼Œä½†æ˜¯å¾ˆæ˜¾ç„¶ <code>Optional.flatMap()</code> æ˜¯ä¸ºé‚£äº›è‡ªå·±å·²ç»ç”Ÿæˆ <strong>Optional</strong> çš„å‡½æ•°è€Œè®¾è®¡çš„ã€‚</p><h3 id="Optional-æµ"><a href="#Optional-æµ" class="headerlink" title="Optional æµ"></a>Optional æµ</h3><p>å‡è®¾ä½ çš„ç”Ÿæˆå™¨å¯èƒ½äº§ç”Ÿ <code>null</code> å€¼ï¼Œé‚£ä¹ˆå½“ç”¨å®ƒæ¥åˆ›å»ºæµæ—¶ï¼Œä½ ä¼šè‡ªç„¶åœ°æƒ³åˆ°ç”¨  <strong>Optional</strong> æ¥åŒ…è£…å…ƒç´ ã€‚å¦‚ä¸‹æ˜¯å®ƒçš„æ ·å­ï¼Œä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/Signal.java</span><br><span class="hljs-keyword">import</span> java.util.*;<br><span class="hljs-keyword">import</span> java.util.stream.*;<br><span class="hljs-keyword">import</span> java.util.function.*;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Signal</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String msg;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Signal</span><span class="hljs-params">(String msg)</span> </span>&#123; <span class="hljs-keyword">this</span>.msg = msg; &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getMsg</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-keyword">return</span> msg; &#125;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Signal(&quot;</span> + msg + <span class="hljs-string">&quot;)&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">static</span> Random rand = <span class="hljs-keyword">new</span> Random(<span class="hljs-number">47</span>);<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Signal <span class="hljs-title">morse</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">switch</span>(rand.nextInt(<span class="hljs-number">4</span>)) &#123;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Signal(<span class="hljs-string">&quot;dot&quot;</span>);<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>: <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Signal(<span class="hljs-string">&quot;dash&quot;</span>);<br>            <span class="hljs-keyword">default</span>: <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Stream&lt;Optional&lt;Signal&gt;&gt; stream() &#123;<br>        <span class="hljs-keyword">return</span> Stream.generate(Signal::morse)<br>                .map(signal -&gt; Optional.ofNullable(signal));<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªæµçš„æ—¶å€™ï¼Œå¿…é¡»è¦å¼„æ¸…æ¥šå¦‚ä½•è§£åŒ… <strong>Optional</strong>ã€‚ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/StreamOfOptionals.java</span><br><span class="hljs-keyword">import</span> java.util.*;<br><span class="hljs-keyword">import</span> java.util.stream.*;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StreamOfOptionals</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Signal.stream()<br>                .limit(<span class="hljs-number">10</span>)<br>                .forEach(System.out::println);<br>        System.out.println(<span class="hljs-string">&quot; ---&quot;</span>);<br>        Signal.stream()<br>                .limit(<span class="hljs-number">10</span>)<br>                .filter(Optional::isPresent)<br>                .map(Optional::get)<br>                .forEach(System.out::println);<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java">Optional[Signal(dash)]<br>Optional[Signal(dot)]<br>Optional[Signal(dash)]<br>Optional.empty<br>Optional.empty<br>Optional[Signal(dash)]<br>Optional.empty<br>Optional[Signal(dot)]<br>Optional[Signal(dash)]<br>Optional[Signal(dash)]<br>---<br>Signal(dot)<br>Signal(dot)<br>Signal(dash)<br>Signal(dash)<br><br></code></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>filter()</code> æ¥ä¿ç•™é‚£äº›éç©º <strong>Optional</strong>ï¼Œç„¶ååœ¨ <code>map()</code> ä¸­ä½¿ç”¨ <code>get()</code> è·å–å…ƒç´ ã€‚ç”±äºæ¯ç§æƒ…å†µéƒ½éœ€è¦å®šä¹‰â€œç©ºå€¼â€çš„å«ä¹‰ï¼Œæ‰€ä»¥é€šå¸¸æˆ‘ä»¬è¦ä¸ºæ¯ä¸ªåº”ç”¨ç¨‹åºé‡‡ç”¨ä¸åŒçš„æ–¹æ³•ã€‚</p><h2 id="ç»ˆç«¯æ“ä½œ"><a href="#ç»ˆç«¯æ“ä½œ" class="headerlink" title="ç»ˆç«¯æ“ä½œ"></a>ç»ˆç«¯æ“ä½œ</h2><p>ä»¥ä¸‹æ“ä½œå°†ä¼šè·å–æµçš„æœ€ç»ˆç»“æœã€‚è‡³æ­¤æˆ‘ä»¬æ— æ³•å†ç»§ç»­å¾€åä¼ é€’æµã€‚å¯ä»¥è¯´ï¼Œç»ˆç«¯æ“ä½œæ€»æ˜¯æˆ‘ä»¬åœ¨æµç®¡é“ä¸­æ‰€åšçš„æœ€åä¸€ä»¶äº‹ã€‚</p><h3 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h3><ul><li><code>toArray()</code>ï¼šå°†æµè½¬æ¢æˆé€‚å½“ç±»å‹çš„æ•°ç»„ã€‚</li><li><code>toArray(generator)</code>ï¼šåœ¨ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œç”Ÿæˆè‡ªå®šä¹‰ç±»å‹çš„æ•°ç»„ã€‚</li></ul><p>å½“æˆ‘ä»¬éœ€è¦å¾—åˆ°æ•°ç»„ç±»å‹çš„æ•°æ®ä»¥ä¾¿äºåç»­æ“ä½œæ—¶ï¼Œä¸Šé¢çš„æ–¹æ³•å°±å¾ˆæœ‰ç”¨ã€‚å‡è®¾æˆ‘ä»¬éœ€è¦å¤ç”¨æµäº§ç”Ÿçš„éšæœºæ•°æ—¶ï¼Œå°±å¯ä»¥è¿™ä¹ˆä½¿ç”¨ã€‚ä»£ç ç¤ºä¾‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/RandInts.java</span><br><span class="hljs-keyword">package</span> streams;<br><span class="hljs-keyword">import</span> java.util.*;<br><span class="hljs-keyword">import</span> java.util.stream.*;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RandInts</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span>[] rints = <span class="hljs-keyword">new</span> Random(<span class="hljs-number">47</span>).ints(<span class="hljs-number">0</span>, <span class="hljs-number">1000</span>).limit(<span class="hljs-number">100</span>).toArray();<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> IntStream <span class="hljs-title">rands</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> Arrays.stream(rints);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ä¸Šä¾‹å°†100ä¸ªæ•°å€¼èŒƒå›´åœ¨ 0 åˆ° 1000 ä¹‹é—´çš„éšæœºæ•°æµè½¬æ¢æˆä¸ºæ•°ç»„å¹¶å°†å…¶å­˜å‚¨åœ¨ <code>rints</code> ä¸­ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ¯æ¬¡è°ƒç”¨ <code>rands()</code> çš„æ—¶å€™å¯ä»¥é‡å¤è·å–ç›¸åŒçš„æ•´æ•°æµã€‚</p><h3 id="å¾ªç¯"><a href="#å¾ªç¯" class="headerlink" title="å¾ªç¯"></a>å¾ªç¯</h3><ul><li><code>forEach(Consumer)</code>å¸¸è§å¦‚ <code>System.out::println</code> ä½œä¸º <strong>Consumer</strong> å‡½æ•°ã€‚</li><li><code>forEachOrdered(Consumer)</code>ï¼š ä¿è¯ <code>forEach</code> æŒ‰ç…§åŸå§‹æµé¡ºåºæ“ä½œã€‚</li></ul><p>ç¬¬ä¸€ç§å½¢å¼ï¼šæ— åºæ“ä½œï¼Œä»…åœ¨å¼•å…¥å¹¶è¡Œæµæ—¶æ‰æœ‰æ„ä¹‰ã€‚åœ¨ <a href="24-Concurrent-Programming.md">å¹¶å‘ç¼–ç¨‹</a> ç« èŠ‚ä¹‹å‰æˆ‘ä»¬ä¸ä¼šæ·±å…¥ç ”ç©¶è¿™ä¸ªé—®é¢˜ã€‚è¿™é‡Œç®€å•ä»‹ç»ä¸‹ <code>parallel()</code>ï¼šå¯å®ç°å¤šå¤„ç†å™¨å¹¶è¡Œæ“ä½œã€‚å®ç°åŸç†ä¸ºå°†æµåˆ†å‰²ä¸ºå¤šä¸ªï¼ˆé€šå¸¸æ•°ç›®ä¸º CPU æ ¸å¿ƒæ•°ï¼‰å¹¶åœ¨ä¸åŒå¤„ç†å™¨ä¸Šåˆ†åˆ«æ‰§è¡Œæ“ä½œã€‚å› ä¸ºæˆ‘ä»¬é‡‡ç”¨çš„æ˜¯å†…éƒ¨è¿­ä»£ï¼Œè€Œä¸æ˜¯å¤–éƒ¨è¿­ä»£ï¼Œæ‰€ä»¥è¿™æ˜¯å¯èƒ½å®ç°çš„ã€‚</p><p><code>parallel()</code> çœ‹ä¼¼ç®€å•ï¼Œå®åˆ™æ£˜æ‰‹ã€‚æ›´å¤šå†…å®¹å°†åœ¨ç¨åçš„ <a href="24-Concurrent-Programming.md">å¹¶å‘ç¼–ç¨‹</a> ç« èŠ‚ä¸­å­¦ä¹ ã€‚</p><p>ä¸‹ä¾‹å¼•å…¥ <code>parallel()</code> æ¥å¸®åŠ©ç†è§£ <code>forEachOrdered(Consumer)</code> çš„ä½œç”¨å’Œä½¿ç”¨åœºæ™¯ã€‚ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/ForEach.java</span><br><span class="hljs-keyword">import</span> java.util.*;<br><span class="hljs-keyword">import</span> java.util.stream.*;<br><span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> streams.RandInts.*;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ForEach</span> </span>&#123;<br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> SZ = <span class="hljs-number">14</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        rands().limit(SZ)<br>                .forEach(n -&gt; System.out.format(<span class="hljs-string">&quot;%d &quot;</span>, n));<br>        System.out.println();<br>        rands().limit(SZ)<br>                .parallel()<br>                .forEach(n -&gt; System.out.format(<span class="hljs-string">&quot;%d &quot;</span>, n));<br>        System.out.println();<br>        rands().limit(SZ)<br>                .parallel()<br>                .forEachOrdered(n -&gt; System.out.format(<span class="hljs-string">&quot;%d &quot;</span>, n));<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">258</span> <span class="hljs-number">555</span> <span class="hljs-number">693</span> <span class="hljs-number">861</span> <span class="hljs-number">961</span> <span class="hljs-number">429</span> <span class="hljs-number">868</span> <span class="hljs-number">200</span> <span class="hljs-number">522</span> <span class="hljs-number">207</span> <span class="hljs-number">288</span> <span class="hljs-number">128</span> <span class="hljs-number">551</span> <span class="hljs-number">589</span><br><span class="hljs-attribute">551</span> <span class="hljs-number">861</span> <span class="hljs-number">429</span> <span class="hljs-number">589</span> <span class="hljs-number">200</span> <span class="hljs-number">522</span> <span class="hljs-number">555</span> <span class="hljs-number">693</span> <span class="hljs-number">258</span> <span class="hljs-number">128</span> <span class="hljs-number">868</span> <span class="hljs-number">288</span> <span class="hljs-number">961</span> <span class="hljs-number">207</span><br><span class="hljs-attribute">258</span> <span class="hljs-number">555</span> <span class="hljs-number">693</span> <span class="hljs-number">861</span> <span class="hljs-number">961</span> <span class="hljs-number">429</span> <span class="hljs-number">868</span> <span class="hljs-number">200</span> <span class="hljs-number">522</span> <span class="hljs-number">207</span> <span class="hljs-number">288</span> <span class="hljs-number">128</span> <span class="hljs-number">551</span> <span class="hljs-number">589</span><br><br></code></pre></td></tr></table></figure><p>ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ä¸åŒå¤§å°çš„æ•°ç»„ï¼Œæˆ‘ä»¬æŠ½ç¦»å‡ºäº† <code>SZ</code> å˜é‡ã€‚ç»“æœå¾ˆæœ‰è¶£ï¼šåœ¨ç¬¬ä¸€ä¸ªæµä¸­ï¼Œæœªä½¿ç”¨ <code>parallel()</code> ï¼Œæ‰€ä»¥ <code>rands()</code> æŒ‰ç…§å…ƒç´ è¿­ä»£å‡ºç°çš„é¡ºåºæ˜¾ç¤ºç»“æœï¼›åœ¨ç¬¬äºŒä¸ªæµä¸­ï¼Œå¼•å…¥<code>parallel()</code> ï¼Œå³ä¾¿æµå¾ˆå°ï¼Œè¾“å‡ºçš„ç»“æœé¡ºåºä¹Ÿå’Œå‰é¢ä¸ä¸€æ ·ã€‚è¿™æ˜¯ç”±äºå¤šå¤„ç†å™¨å¹¶è¡Œæ“ä½œçš„åŸå› ã€‚å¤šæ¬¡è¿è¡Œæµ‹è¯•ï¼Œç»“æœå‡ä¸åŒã€‚å¤šå¤„ç†å™¨å¹¶è¡Œæ“ä½œå¸¦æ¥çš„éç¡®å®šæ€§å› ç´ é€ æˆäº†è¿™æ ·çš„ç»“æœã€‚</p><p>åœ¨æœ€åä¸€ä¸ªæµä¸­ï¼ŒåŒæ—¶ä½¿ç”¨äº† <code>parallel()</code> å’Œ <code>forEachOrdered()</code> æ¥å¼ºåˆ¶ä¿æŒåŸå§‹æµé¡ºåºã€‚å› æ­¤ï¼Œå¯¹éå¹¶è¡Œæµä½¿ç”¨ <code>forEachOrdered()</code> æ˜¯æ²¡æœ‰ä»»ä½•å½±å“çš„ã€‚</p><h3 id="é›†åˆ"><a href="#é›†åˆ" class="headerlink" title="é›†åˆ"></a>é›†åˆ</h3><ul><li><code>collect(Collector)</code>ï¼šä½¿ç”¨ <strong>Collector</strong> æ”¶é›†æµå…ƒç´ åˆ°ç»“æœé›†åˆä¸­ã€‚</li><li><code>collect(Supplier, BiConsumer, BiConsumer)</code>ï¼šåŒä¸Šï¼Œç¬¬ä¸€ä¸ªå‚æ•° <strong>Supplier</strong> åˆ›å»ºäº†ä¸€ä¸ªæ–°ç»“æœé›†åˆï¼Œç¬¬äºŒä¸ªå‚æ•° <strong>BiConsumer</strong> å°†ä¸‹ä¸€ä¸ªå…ƒç´ åŒ…å«åˆ°ç»“æœä¸­ï¼Œç¬¬ä¸‰ä¸ªå‚æ•° <strong>BiConsumer</strong> ç”¨äºå°†ä¸¤ä¸ªå€¼ç»„åˆèµ·æ¥ã€‚</li></ul><p>åœ¨è¿™é‡Œæˆ‘ä»¬åªæ˜¯ç®€å•ä»‹ç»äº†å‡ ä¸ª <strong>Collectors</strong> çš„è¿ç”¨ç¤ºä¾‹ã€‚å®é™…ä¸Šï¼Œå®ƒè¿˜æœ‰ä¸€äº›éå¸¸å¤æ‚çš„æ“ä½œå®ç°ï¼Œå¯é€šè¿‡æŸ¥çœ‹ <code>java.util.stream.Collectors</code> çš„ API æ–‡æ¡£äº†è§£ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…ƒç´ æ”¶é›†åˆ°ä»»æ„ä¸€ç§ç‰¹å®šçš„é›†åˆä¸­ã€‚</p><p>å‡è®¾æˆ‘ä»¬ç°åœ¨ä¸ºäº†ä¿è¯å…ƒç´ æœ‰åºï¼Œå°†å…ƒç´ å­˜å‚¨åœ¨ <strong>TreeSet</strong> ä¸­ã€‚<strong>Collectors</strong> é‡Œé¢æ²¡æœ‰ç‰¹å®šçš„ <code>toTreeSet()</code>ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†é›†åˆçš„æ„é€ å‡½æ•°å¼•ç”¨ä¼ é€’ç»™ <code>Collectors.toCollection()</code>ï¼Œä»è€Œæ„å»ºä»»ä½•ç±»å‹çš„é›†åˆã€‚ä¸‹é¢æˆ‘ä»¬æ¥å°†ä¸€ä¸ªæ–‡ä»¶ä¸­çš„å•è¯æ”¶é›†åˆ° <strong>TreeSet</strong> é›†åˆä¸­ã€‚ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/TreeSetOfWords.java</span><br><span class="hljs-keyword">import</span> java.util.*;<br><span class="hljs-keyword">import</span> java.nio.file.*;<br><span class="hljs-keyword">import</span> java.util.stream.*;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TreeSetOfWords</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span><br>    main(String[] args) <span class="hljs-keyword">throws</span> Exception &#123;<br>        Set&lt;String&gt; words2 =<br>                Files.lines(Paths.get(<span class="hljs-string">&quot;TreeSetOfWords.java&quot;</span>))<br>                        .flatMap(s -&gt; Arrays.stream(s.split(<span class="hljs-string">&quot;\\W+&quot;</span>)))<br>                        .filter(s -&gt; !s.matches(<span class="hljs-string">&quot;\\d+&quot;</span>)) <span class="hljs-comment">// No numbers</span><br>                        .map(String::trim)<br>                        .filter(s -&gt; s.length() &gt; <span class="hljs-number">2</span>)<br>                        .limit(<span class="hljs-number">100</span>)<br>                        .collect(Collectors.toCollection(TreeSet::<span class="hljs-keyword">new</span>));<br>        System.out.println(words2);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs json">[Arrays, Collectors, Exception, Files, Output, Paths,<br>Set, String, System, TreeSet, TreeSetOfWords, args,<br>class, collect, file, filter, flatMap, get, import,<br>java, length, limit, lines, main, map, matches, new,<br>nio, numbers, out, println, public, split, static,<br>stream, streams, throws, toCollection, trim, util,<br>void, words2]<br><br></code></pre></td></tr></table></figure><p><strong>Files.</strong><code>lines()</code> æ‰“å¼€ <strong>Path</strong> å¹¶å°†å…¶è½¬æ¢æˆä¸ºè¡Œæµã€‚ä¸‹ä¸€è¡Œä»£ç å°†åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªéå•è¯å­—ç¬¦ï¼ˆ<code>\\w+</code>ï¼‰è¡Œè¿›è¡Œåˆ†å‰²ï¼Œç„¶åä½¿ç”¨ <strong>Arrays.</strong><code>stream()</code> å°†å…¶è½¬åŒ–æˆä¸ºæµï¼Œå¹¶å°†ç»“æœå±•å¹³æ˜ å°„æˆä¸ºå•è¯æµã€‚ä½¿ç”¨ <code>matches(\\d+)</code> æŸ¥æ‰¾å¹¶ç§»é™¤å…¨æ•°å­—å­—ç¬¦ä¸²ï¼ˆ<strong>æ³¨æ„</strong>,<code>words2</code> æ˜¯é€šè¿‡çš„ï¼‰ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨ <strong>String.</strong><code>trim()</code> å»é™¤å•è¯ä¸¤è¾¹çš„ç©ºç™½ï¼Œ<code>filter()</code> è¿‡æ»¤æ‰€æœ‰é•¿åº¦å°äº3çš„å•è¯ï¼Œç´§æ¥ç€åªè·å–100ä¸ªå•è¯ï¼Œæœ€åå°†å…¶ä¿å­˜åˆ° <strong>TreeSet</strong> ä¸­ã€‚</p><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨æµä¸­ç”Ÿæˆ <strong>Map</strong>ã€‚ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/MapCollector.java</span><br><span class="hljs-keyword">import</span> java.util.*;<br><span class="hljs-keyword">import</span> java.util.stream.*;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Pair</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> Character c;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> Integer i;<br>    Pair(Character c, Integer i) &#123;<br>        <span class="hljs-keyword">this</span>.c = c;<br>        <span class="hljs-keyword">this</span>.i = i;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Character <span class="hljs-title">getC</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-keyword">return</span> c; &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getI</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-keyword">return</span> i; &#125;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Pair(&quot;</span> + c + <span class="hljs-string">&quot;, &quot;</span> + i + <span class="hljs-string">&quot;)&quot;</span>;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RandomPair</span> </span>&#123;<br>    Random rand = <span class="hljs-keyword">new</span> Random(<span class="hljs-number">47</span>);<br>    <span class="hljs-comment">// An infinite iterator of random capital letters:</span><br>    Iterator&lt;Character&gt; capChars = rand.ints(<span class="hljs-number">65</span>,<span class="hljs-number">91</span>)<br>            .mapToObj(i -&gt; (<span class="hljs-keyword">char</span>)i)<br>            .iterator();<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Stream&lt;Pair&gt; <span class="hljs-title">stream</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> rand.ints(<span class="hljs-number">100</span>, <span class="hljs-number">1000</span>).distinct()<br>                .mapToObj(i -&gt; <span class="hljs-keyword">new</span> Pair(capChars.next(), i));<br>    &#125;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MapCollector</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Map&lt;Integer, Character&gt; map =<br>                <span class="hljs-keyword">new</span> RandomPair().stream()<br>                        .limit(<span class="hljs-number">8</span>)<br>                        .collect(<br>                                Collectors.toMap(Pair::getI, Pair::getC));<br>        System.out.println(map);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&#123;<span class="hljs-attribute">688</span>=W, <span class="hljs-attribute">309</span>=C, <span class="hljs-attribute">293</span>=B, <span class="hljs-attribute">761</span>=N, <span class="hljs-attribute">858</span>=N, <span class="hljs-attribute">668</span>=G, <span class="hljs-attribute">622</span>=F, <span class="hljs-attribute">751</span>=N&#125;<br><br></code></pre></td></tr></table></figure><p><strong>Pair</strong> åªæ˜¯ä¸€ä¸ªåŸºç¡€çš„æ•°æ®å¯¹è±¡ã€‚<strong>RandomPair</strong> åˆ›å»ºäº†éšæœºç”Ÿæˆçš„ <strong>Pair</strong> å¯¹è±¡æµã€‚åœ¨ Java ä¸­ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥ä»¥æŸç§æ–¹å¼ç»„åˆä¸¤ä¸ªæµã€‚æ‰€ä»¥è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªæ•´æ•°æµï¼Œå¹¶ä¸”ä½¿ç”¨ <code>mapToObj()</code> å°†å…¶è½¬åŒ–æˆä¸º <strong>Pair</strong> æµã€‚ <strong>capChars</strong> éšæœºç”Ÿæˆçš„å¤§å†™å­—æ¯è¿­ä»£å™¨ä»æµå¼€å§‹ï¼Œç„¶å <code>iterator()</code> å…è®¸æˆ‘ä»¬åœ¨ <code>stream()</code> ä¸­ä½¿ç”¨å®ƒã€‚å°±æˆ‘æ‰€çŸ¥ï¼Œè¿™æ˜¯ç»„åˆå¤šä¸ªæµä»¥ç”Ÿæˆæ–°çš„å¯¹è±¡æµçš„å”¯ä¸€æ–¹æ³•ã€‚</p><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åªä½¿ç”¨æœ€ç®€å•å½¢å¼çš„ <code>Collectors.toMap()</code>ï¼Œè¿™ä¸ªæ–¹æ³•å€¼éœ€è¦ä¸€ä¸ªå¯ä»¥ä»æµä¸­è·å–é”®å€¼å¯¹çš„å‡½æ•°ã€‚è¿˜æœ‰å…¶ä»–é‡è½½å½¢å¼ï¼Œå…¶ä¸­ä¸€ç§å½¢å¼æ˜¯åœ¨é‡åˆ°é”®å€¼å†²çªæ—¶ï¼Œéœ€è¦ä¸€ä¸ªå‡½æ•°æ¥å¤„ç†è¿™ç§æƒ…å†µã€‚</p><p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ<code>java.util.stream.Collectors</code> ä¸­é¢„è®¾çš„ <strong>Collector</strong> å°±èƒ½æ»¡è¶³æˆ‘ä»¬çš„è¦æ±‚ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨ç¬¬äºŒç§å½¢å¼çš„ <code>collect()</code>ã€‚ æˆ‘æŠŠå®ƒç•™ä½œæ›´é«˜çº§çš„ç»ƒä¹ ï¼Œä¸‹ä¾‹ç»™å‡ºåŸºæœ¬ç”¨æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/SpecialCollector.java</span><br><span class="hljs-keyword">import</span> java.util.*;<br><span class="hljs-keyword">import</span> java.util.stream.*;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpecialCollector</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        ArrayList&lt;String&gt; words =<br>                FileToWords.stream(<span class="hljs-string">&quot;Cheese.dat&quot;</span>)<br>                        .collect(ArrayList::<span class="hljs-keyword">new</span>,<br>                                ArrayList::add,<br>                                ArrayList::addAll);<br>        words.stream()<br>                .filter(s -&gt; s.equals(<span class="hljs-string">&quot;cheese&quot;</span>))<br>                .forEach(System.out::println);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">cheese</span><br><span class="hljs-attribute">cheese</span><br><br></code></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œï¼Œ <strong>ArrayList</strong> çš„æ–¹æ³•å·²ç»æ‰§è¡Œäº†ä½ æ‰€éœ€è¦çš„æ“ä½œï¼Œä½†æ˜¯ä¼¼ä¹æ›´æœ‰å¯èƒ½çš„æ˜¯ï¼Œå¦‚æœä½ å¿…é¡»ä½¿ç”¨è¿™ç§å½¢å¼çš„ <code>collect()</code>ï¼Œåˆ™å¿…é¡»è‡ªå·±åˆ›å»ºç‰¹æ®Šçš„å®šä¹‰ã€‚</p><h3 id="ç»„åˆ"><a href="#ç»„åˆ" class="headerlink" title="ç»„åˆ"></a>ç»„åˆ</h3><ul><li><code>reduce(BinaryOperator)</code>ï¼šä½¿ç”¨ <strong>BinaryOperator</strong> æ¥ç»„åˆæ‰€æœ‰æµä¸­çš„å…ƒç´ ã€‚å› ä¸ºæµå¯èƒ½ä¸ºç©ºï¼Œå…¶è¿”å›å€¼ä¸º <strong>Optional</strong>ã€‚</li><li><code>reduce(identity, BinaryOperator)</code>ï¼šåŠŸèƒ½åŒä¸Šï¼Œä½†æ˜¯ä½¿ç”¨ <strong>identity</strong> ä½œä¸ºå…¶ç»„åˆçš„åˆå§‹å€¼ã€‚å› æ­¤å¦‚æœæµä¸ºç©ºï¼Œ<strong>identity</strong> å°±æ˜¯ç»“æœã€‚</li><li><code>reduce(identity, BiFunction, BinaryOperator)</code>ï¼šæ›´å¤æ‚çš„ä½¿ç”¨å½¢å¼ï¼ˆæš‚ä¸ä»‹ç»ï¼‰ï¼Œè¿™é‡ŒæŠŠå®ƒåŒ…å«åœ¨å†…ï¼Œå› ä¸ºå®ƒå¯ä»¥æé«˜æ•ˆç‡ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬å¯ä»¥æ˜¾å¼åœ°ç»„åˆ <code>map()</code> å’Œ <code>reduce()</code> æ¥æ›´ç®€å•çš„è¡¨è¾¾å®ƒã€‚</li></ul><p>ä¸‹é¢æ¥çœ‹ä¸‹ <code>reduce</code> çš„ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/Reduce.java</span><br><span class="hljs-keyword">import</span> java.util.*;<br><span class="hljs-keyword">import</span> java.util.stream.*;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Frobnitz</span> </span>&#123;<br>    <span class="hljs-keyword">int</span> size;<br>    Frobnitz(<span class="hljs-keyword">int</span> sz) &#123; size = sz; &#125;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Frobnitz(&quot;</span> + size + <span class="hljs-string">&quot;)&quot;</span>;<br>    &#125;<br>    <span class="hljs-comment">// Generator:</span><br>    <span class="hljs-keyword">static</span> Random rand = <span class="hljs-keyword">new</span> Random(<span class="hljs-number">47</span>);<br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> BOUND = <span class="hljs-number">100</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">static</span> Frobnitz <span class="hljs-title">supply</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Frobnitz(rand.nextInt(BOUND));<br>    &#125;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Reduce</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Stream.generate(Frobnitz::supply)<br>                .limit(<span class="hljs-number">10</span>)<br>                .peek(System.out::println)<br>                .reduce((fr0, fr1) -&gt; fr0.size &lt; <span class="hljs-number">50</span> ? fr0 : fr1)<br>                .ifPresent(System.out::println);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">Frobnitz</span><span class="hljs-params">(<span class="hljs-number">58</span>)</span></span><br><span class="hljs-function"><span class="hljs-title">Frobnitz</span><span class="hljs-params">(<span class="hljs-number">55</span>)</span></span><br><span class="hljs-function"><span class="hljs-title">Frobnitz</span><span class="hljs-params">(<span class="hljs-number">93</span>)</span></span><br><span class="hljs-function"><span class="hljs-title">Frobnitz</span><span class="hljs-params">(<span class="hljs-number">61</span>)</span></span><br><span class="hljs-function"><span class="hljs-title">Frobnitz</span><span class="hljs-params">(<span class="hljs-number">61</span>)</span></span><br><span class="hljs-function"><span class="hljs-title">Frobnitz</span><span class="hljs-params">(<span class="hljs-number">29</span>)</span></span><br><span class="hljs-function"><span class="hljs-title">Frobnitz</span><span class="hljs-params">(<span class="hljs-number">68</span>)</span></span><br><span class="hljs-function"><span class="hljs-title">Frobnitz</span><span class="hljs-params">(<span class="hljs-number">0</span>)</span></span><br><span class="hljs-function"><span class="hljs-title">Frobnitz</span><span class="hljs-params">(<span class="hljs-number">22</span>)</span></span><br><span class="hljs-function"><span class="hljs-title">Frobnitz</span><span class="hljs-params">(<span class="hljs-number">7</span>)</span></span><br><span class="hljs-function"><span class="hljs-title">Frobnitz</span><span class="hljs-params">(<span class="hljs-number">29</span>)</span></span><br><br></code></pre></td></tr></table></figure><p><strong>Frobnitz</strong> åŒ…å«äº†ä¸€ä¸ªåä¸º <code>supply()</code> çš„ç”Ÿæˆå™¨ï¼›å› ä¸ºè¿™ä¸ªæ–¹æ³•å¯¹äº <code>Supplier&lt;Frobnitz&gt;</code> æ˜¯ç­¾åå…¼å®¹çš„ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶æ–¹æ³•å¼•ç”¨ä¼ é€’ç»™ <code>Stream.generate()</code>ï¼ˆè¿™ç§ç­¾åå…¼å®¹æ€§è¢«ç§°ä½œç»“æ„ä¸€è‡´æ€§ï¼‰ã€‚æ— â€œåˆå§‹å€¼â€çš„ <code>reduce()</code>æ–¹æ³•è¿”å›å€¼æ˜¯ <strong>Optional</strong> ç±»å‹ã€‚<code>Optional.ifPresent()</code> åªæœ‰åœ¨ç»“æœéç©ºçš„æ—¶å€™æ‰ä¼šè°ƒç”¨ <code>Consumer&lt;Frobnitz&gt;</code> ï¼ˆ<code>println</code> æ–¹æ³•å¯ä»¥è¢«è°ƒç”¨æ˜¯å› ä¸º <strong>Frobnitz</strong> å¯ä»¥é€šè¿‡ <code>toString()</code> æ–¹æ³•è½¬æ¢æˆ <strong>String</strong>ï¼‰ã€‚</p><p>Lambda è¡¨è¾¾å¼ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•° <code>fr0</code> æ˜¯ä¸Šä¸€æ¬¡è°ƒç”¨ <code>reduce()</code> çš„ç»“æœã€‚è€Œç¬¬äºŒä¸ªå‚æ•° <code>fr1</code> æ˜¯ä»æµä¼ é€’è¿‡æ¥çš„å€¼ã€‚</p><p><code>reduce()</code> ä¸­çš„ Lambda è¡¨è¾¾å¼ä½¿ç”¨äº†ä¸‰å…ƒè¡¨è¾¾å¼æ¥è·å–ç»“æœï¼Œå½“å…¶é•¿åº¦å°äº 50 çš„æ—¶å€™è·å– <code>fr0</code> å¦åˆ™è·å–åºåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªå€¼ <code>fr1</code>ã€‚å½“å–å¾—ç¬¬ä¸€ä¸ªé•¿åº¦å°äº 50 çš„ <code>Frobnitz</code>ï¼Œåªè¦å¾—åˆ°ç»“æœå°±ä¼šå¿½ç•¥å…¶ä»–ã€‚è¿™æ˜¯ä¸ªéå¸¸å¥‡æ€ªçš„çº¦æŸï¼Œ ä¹Ÿç¡®å®è®©æˆ‘ä»¬å¯¹ <code>reduce()</code> æœ‰äº†æ›´å¤šçš„äº†è§£ã€‚</p><h3 id="åŒ¹é…"><a href="#åŒ¹é…" class="headerlink" title="åŒ¹é…"></a>åŒ¹é…</h3><ul><li><code>allMatch(Predicate)</code> ï¼šå¦‚æœæµçš„æ¯ä¸ªå…ƒç´ æ ¹æ®æä¾›çš„ <strong>Predicate</strong> éƒ½è¿”å› true æ—¶ï¼Œç»“æœè¿”å›ä¸º trueã€‚åœ¨ç¬¬ä¸€ä¸ª false æ—¶ï¼Œåˆ™åœæ­¢æ‰§è¡Œè®¡ç®—ã€‚</li><li><code>anyMatch(Predicate)</code>ï¼šå¦‚æœæµä¸­çš„ä»»æ„ä¸€ä¸ªå…ƒç´ æ ¹æ®æä¾›çš„ <strong>Predicate</strong> è¿”å› true æ—¶ï¼Œç»“æœè¿”å›ä¸º trueã€‚åœ¨ç¬¬ä¸€ä¸ª false æ˜¯åœæ­¢æ‰§è¡Œè®¡ç®—ã€‚</li><li><code>noneMatch(Predicate)</code>ï¼šå¦‚æœæµçš„æ¯ä¸ªå…ƒç´ æ ¹æ®æä¾›çš„ <strong>Predicate</strong> éƒ½è¿”å› false æ—¶ï¼Œç»“æœè¿”å›ä¸º trueã€‚åœ¨ç¬¬ä¸€ä¸ª true æ—¶åœæ­¢æ‰§è¡Œè®¡ç®—ã€‚</li></ul><p>æˆ‘ä»¬å·²ç»åœ¨ <code>Prime.java</code> ä¸­çœ‹åˆ°äº† <code>noneMatch()</code> çš„ç¤ºä¾‹ï¼›<code>allMatch()</code> å’Œ <code>anyMatch()</code> çš„ç”¨æ³•åŸºæœ¬ä¸Šæ˜¯ç­‰åŒçš„ã€‚ä¸‹é¢æˆ‘ä»¬æ¥æ¢ç©¶ä¸€ä¸‹çŸ­è·¯è¡Œä¸ºã€‚ä¸ºäº†æ¶ˆé™¤å†—ä½™ä»£ç ï¼Œæˆ‘ä»¬åˆ›å»ºäº† <code>show()</code>ã€‚é¦–å…ˆæˆ‘ä»¬å¿…é¡»çŸ¥é“å¦‚ä½•ç»Ÿä¸€åœ°æè¿°è¿™ä¸‰ä¸ªåŒ¹é…å™¨çš„æ“ä½œï¼Œç„¶åå†å°†å…¶è½¬æ¢ä¸º <strong>Matcher</strong> æ¥å£ã€‚ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/Matching.java</span><br><span class="hljs-comment">// Demonstrates short-circuiting of *Match() operations</span><br><span class="hljs-keyword">import</span> java.util.stream.*;<br><span class="hljs-keyword">import</span> java.util.function.*;<br><span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> streams.RandInts.*;<br><br><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Matcher</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BiPredicate</span>&lt;<span class="hljs-title">Stream</span>&lt;<span class="hljs-title">Integer</span>&gt;, <span class="hljs-title">Predicate</span>&lt;<span class="hljs-title">Integer</span>&gt;&gt; </span>&#123;&#125;<br>        <br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Matching</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">show</span><span class="hljs-params">(Matcher match, <span class="hljs-keyword">int</span> val)</span> </span>&#123;<br>        System.out.println(<br>                match.test(<br>                        IntStream.rangeClosed(<span class="hljs-number">1</span>, <span class="hljs-number">9</span>)<br>                                .boxed()<br>                                .peek(n -&gt; System.out.format(<span class="hljs-string">&quot;%d &quot;</span>, n)),<br>                        n -&gt; n &lt; val));<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        show(Stream::allMatch, <span class="hljs-number">10</span>);<br>        show(Stream::allMatch, <span class="hljs-number">4</span>);<br>        show(Stream::anyMatch, <span class="hljs-number">2</span>);<br>        show(Stream::anyMatch, <span class="hljs-number">0</span>);<br>        show(Stream::noneMatch, <span class="hljs-number">5</span>);<br>        show(Stream::noneMatch, <span class="hljs-number">0</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">1 </span><span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">8</span> <span class="hljs-number">9</span> true<br><span class="hljs-symbol">1 </span><span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> false<br><span class="hljs-symbol">1 </span>true<br><span class="hljs-symbol">1 </span><span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">8</span> <span class="hljs-number">9</span> false<br><span class="hljs-symbol">1 </span>false<br><span class="hljs-symbol">1 </span><span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">8</span> <span class="hljs-number">9</span> true<br><br></code></pre></td></tr></table></figure><p><strong>BiPredicate</strong> æ˜¯ä¸€ä¸ªäºŒå…ƒè°“è¯ï¼Œå®ƒåªèƒ½æ¥å—ä¸¤ä¸ªå‚æ•°ä¸”åªè¿”å› true æˆ–è€… falseã€‚å®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æˆ‘ä»¬è¦æµ‹è¯•çš„æµï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªè°“è¯ <strong>Predicate</strong>ã€‚<strong>Matcher</strong> é€‚ç”¨äºæ‰€æœ‰çš„ <strong>Stream::*Match</strong> æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¼ é€’æ¯ä¸€ä¸ªåˆ° <code>show()</code> ä¸­ã€‚<code>match.test()</code> çš„è°ƒç”¨ä¼šè¢«è½¬æ¢æˆ <strong>Stream::*Match</strong> å‡½æ•°çš„è°ƒç”¨ã€‚</p><p><code>show()</code> è·å–ä¸¤ä¸ªå‚æ•°ï¼Œ<strong>Matcher</strong> åŒ¹é…å™¨å’Œç”¨äºè¡¨ç¤ºè°“è¯æµ‹è¯• <strong>n &lt; val</strong> ä¸­æœ€å¤§å€¼çš„ <strong>val</strong>ã€‚è¿™ä¸ªæ–¹æ³•ç”Ÿæˆä¸€ä¸ª1-9ä¹‹é—´çš„æ•´æ•°æµã€‚<code>peek()</code> æ˜¯ç”¨äºå‘æˆ‘ä»¬å±•ç¤ºæµ‹è¯•åœ¨çŸ­è·¯ä¹‹å‰çš„æƒ…å†µã€‚ä»è¾“å‡ºä¸­å¯ä»¥çœ‹åˆ°æ¯æ¬¡éƒ½å‘ç”Ÿäº†çŸ­è·¯ã€‚</p><h3 id="æŸ¥æ‰¾"><a href="#æŸ¥æ‰¾" class="headerlink" title="æŸ¥æ‰¾"></a>æŸ¥æ‰¾</h3><ul><li><code>findFirst()</code>ï¼šè¿”å›ç¬¬ä¸€ä¸ªæµå…ƒç´ çš„ <strong>Optional</strong>ï¼Œå¦‚æœæµä¸ºç©ºè¿”å› <strong>Optional.empty</strong>ã€‚</li><li><code>findAny(</code>ï¼šè¿”å›å«æœ‰ä»»æ„æµå…ƒç´ çš„ <strong>Optional</strong>ï¼Œå¦‚æœæµä¸ºç©ºè¿”å› <strong>Optional.empty</strong>ã€‚</li></ul><p>ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/SelectElement.java</span><br><span class="hljs-keyword">import</span> java.util.*;<br><span class="hljs-keyword">import</span> java.util.stream.*;<br><span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> streams.RandInts.*;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SelectElement</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        System.out.println(rands().findFirst().getAsInt());<br>        System.out.println(<br>                rands().parallel().findFirst().getAsInt());<br>        System.out.println(rands().findAny().getAsInt());<br>        System.out.println(<br>                rands().parallel().findAny().getAsInt());<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plain">258<br>258<br>258<br>242<br><br></code></pre></td></tr></table></figure><p><code>findFirst()</code> æ— è®ºæµæ˜¯å¦ä¸ºå¹¶è¡ŒåŒ–çš„ï¼Œæ€»æ˜¯ä¼šé€‰æ‹©æµä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚å¯¹äºéå¹¶è¡Œæµï¼Œ<code>findAny()</code>ä¼šé€‰æ‹©æµä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆå³ä½¿ä»å®šä¹‰ä¸Šæ¥çœ‹æ˜¯é€‰æ‹©ä»»æ„å…ƒç´ ï¼‰ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>parallel()</code> æ¥å¹¶è¡Œæµä»è€Œå¼•å…¥ <code>findAny()</code> é€‰æ‹©éç¬¬ä¸€ä¸ªæµå…ƒç´ çš„å¯èƒ½æ€§ã€‚</p><p>å¦‚æœå¿…é¡»é€‰æ‹©æµä¸­æœ€åä¸€ä¸ªå…ƒç´ ï¼Œé‚£å°±ä½¿ç”¨ <code>reduce()</code>ã€‚ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/LastElement.java</span><br><span class="hljs-keyword">import</span> java.util.*;<br><span class="hljs-keyword">import</span> java.util.stream.*;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LastElement</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        OptionalInt last = IntStream.range(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>)<br>                .reduce((n1, n2) -&gt; n2);<br>        System.out.println(last.orElse(-<span class="hljs-number">1</span>));<br>        <span class="hljs-comment">// Non-numeric object:</span><br>        Optional&lt;String&gt; lastobj =<br>                Stream.of(<span class="hljs-string">&quot;one&quot;</span>, <span class="hljs-string">&quot;two&quot;</span>, <span class="hljs-string">&quot;three&quot;</span>)<br>                        .reduce((n1, n2) -&gt; n2);<br>        System.out.println(<br>                lastobj.orElse(<span class="hljs-string">&quot;Nothing there!&quot;</span>));<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-number">19</span><br><span class="hljs-literal">three</span><br><br></code></pre></td></tr></table></figure><p><code>reduce()</code>  çš„å‚æ•°åªæ˜¯ç”¨æœ€åä¸€ä¸ªå…ƒç´ æ›¿æ¢äº†æœ€åä¸¤ä¸ªå…ƒç´ ï¼Œæœ€ç»ˆåªç”Ÿæˆæœ€åä¸€ä¸ªå…ƒç´ ã€‚å¦‚æœä¸ºæ•°å­—æµï¼Œä½ å¿…é¡»ä½¿ç”¨ç›¸è¿‘çš„æ•°å­— <strong>Optional</strong> ç±»å‹ï¼ˆ numeric optional typeï¼‰ï¼Œå¦åˆ™ä½¿ç”¨ <strong>Optional</strong> ç±»å‹ï¼Œå°±åƒä¸Šä¾‹ä¸­çš„ <code>Optional&lt;String&gt;</code>ã€‚</p><h3 id="ä¿¡æ¯"><a href="#ä¿¡æ¯" class="headerlink" title="ä¿¡æ¯"></a>ä¿¡æ¯</h3><ul><li><code>count()</code>ï¼šæµä¸­çš„å…ƒç´ ä¸ªæ•°ã€‚</li><li><code>max(Comparator)</code>ï¼šæ ¹æ®æ‰€ä¼ å…¥çš„ <strong>Comparator</strong> æ‰€å†³å®šçš„â€œæœ€å¤§â€å…ƒç´ ã€‚</li><li><code>min(Comparator)</code>ï¼šæ ¹æ®æ‰€ä¼ å…¥çš„ <strong>Comparator</strong> æ‰€å†³å®šçš„â€œæœ€å°â€å…ƒç´ ã€‚</li></ul><p><strong>String</strong> ç±»å‹æœ‰é¢„è®¾çš„ <strong>Comparator</strong> å®ç°ã€‚ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/Informational.java</span><br><span class="hljs-keyword">import</span> java.util.stream.*;<br><span class="hljs-keyword">import</span> java.util.function.*;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Informational</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span><br>    main(String[] args) <span class="hljs-keyword">throws</span> Exception &#123;<br>        System.out.println(<br>                FileToWords.stream(<span class="hljs-string">&quot;Cheese.dat&quot;</span>).count());<br>        System.out.println(<br>                FileToWords.stream(<span class="hljs-string">&quot;Cheese.dat&quot;</span>)<br>                        .min(String.CASE_INSENSITIVE_ORDER)<br>                        .orElse(<span class="hljs-string">&quot;NONE&quot;</span>));<br>        System.out.println(<br>                FileToWords.stream(<span class="hljs-string">&quot;Cheese.dat&quot;</span>)<br>                        .max(String.CASE_INSENSITIVE_ORDER)<br>                        .orElse(<span class="hljs-string">&quot;NONE&quot;</span>));<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-number">32</span><br><span class="hljs-keyword">a</span><br>you<br><br></code></pre></td></tr></table></figure><p><code>min()</code> å’Œ <code>max()</code> çš„è¿”å›ç±»å‹ä¸º <strong>Optional</strong>ï¼Œè¿™éœ€è¦æˆ‘ä»¬ä½¿ç”¨ <code>orElse()</code>æ¥è§£åŒ…ã€‚</p><h3 id="æ•°å­—æµä¿¡æ¯"><a href="#æ•°å­—æµä¿¡æ¯" class="headerlink" title="æ•°å­—æµä¿¡æ¯"></a>æ•°å­—æµä¿¡æ¯</h3><ul><li><code>average()</code> ï¼šæ±‚å–æµå…ƒç´ å¹³å‡å€¼ã€‚</li><li><code>max()</code> å’Œ <code>min()</code>ï¼šæ•°å€¼æµæ“ä½œæ— éœ€ <strong>Comparator</strong>ã€‚</li><li><code>sum()</code>ï¼šå¯¹æ‰€æœ‰æµå…ƒç´ è¿›è¡Œæ±‚å’Œã€‚</li><li><code>summaryStatistics()</code>ï¼šç”Ÿæˆå¯èƒ½æœ‰ç”¨çš„æ•°æ®ã€‚ç›®å‰å¹¶ä¸å¤ªæ¸…æ¥šè¿™ä¸ªæ–¹æ³•å­˜åœ¨çš„å¿…è¦æ€§ï¼Œå› ä¸ºæˆ‘ä»¬å…¶å®å¯ä»¥ç”¨æ›´ç›´æ¥çš„æ–¹æ³•è·å¾—éœ€è¦çš„æ•°æ®ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// streams/NumericStreamInfo.java</span><br><span class="hljs-keyword">import</span> java.util.stream.*;<br><span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> streams.RandInts.*;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NumericStreamInfo</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        System.out.println(rands().average().getAsDouble());<br>        System.out.println(rands().max().getAsInt());<br>        System.out.println(rands().min().getAsInt());<br>        System.out.println(rands().sum());<br>        System.out.println(rands().summaryStatistics());<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs routeros">507.94<br>998<br>8<br>50794<br>IntSummaryStatistics&#123;<span class="hljs-attribute">count</span>=100, <span class="hljs-attribute">sum</span>=50794, <span class="hljs-attribute">min</span>=8, <span class="hljs-attribute">average</span>=507.940000, <span class="hljs-attribute">max</span>=998&#125;<br><br></code></pre></td></tr></table></figure><p>ä¸Šä¾‹æ“ä½œå¯¹äº <strong>LongStream</strong> å’Œ <strong>DoubleStream</strong> åŒæ ·é€‚ç”¨ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Java8</tag>
      
      <tag>Lambda</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/blog/2021/06/01/%E5%89%AF%E6%9C%AC/"/>
    <url>/blog/2021/06/01/%E5%89%AF%E6%9C%AC/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ä¸»æµçš„å››ç§é™æµç­–ç•¥éƒ½å¯ä»¥é€šè¿‡rediså®ç°</title>
    <link href="/blog/2021/05/30/%E4%B8%BB%E6%B5%81%E7%9A%84%E5%9B%9B%E7%A7%8D%E9%99%90%E6%B5%81%E7%AD%96%E7%95%A5%E9%83%BD%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87redis%E5%AE%9E%E7%8E%B0/"/>
    <url>/blog/2021/05/30/%E4%B8%BB%E6%B5%81%E7%9A%84%E5%9B%9B%E7%A7%8D%E9%99%90%E6%B5%81%E7%AD%96%E7%95%A5%E9%83%BD%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87redis%E5%AE%9E%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h1><ul><li>åœ¨webå¼€å‘ä¸­åŠŸèƒ½æ˜¯åŸºçŸ³ï¼Œé™¤äº†åŠŸèƒ½ä»¥å¤–è¿ç»´å’Œé˜²æŠ¤å°±æ˜¯é‡å¤´èœäº†ã€‚å› ä¸ºåœ¨ç½‘ç«™è¿è¡ŒæœŸé—´å¯èƒ½ä¼šå› ä¸ºçªç„¶çš„è®¿é—®é‡å¯¼è‡´ä¸šåŠ¡å¼‚å¸¸ã€ä¹Ÿæœ‰å¯èƒ½é­å—åˆ«äººæ¶æ„æ”»å‡»</li><li>æ‰€ä»¥æˆ‘ä»¬çš„æ¥å£éœ€è¦å¯¹æµé‡è¿›è¡Œé™åˆ¶ã€‚ä¿—ç§°çš„QPSä¹Ÿæ˜¯å¯¹æµé‡çš„ä¸€ç§æè¿°</li><li>é’ˆå¯¹é™æµç°åœ¨å¤§å¤šåº”è¯¥æ˜¯ä»¤ç‰Œæ¡¶ç®—æ³•ï¼Œå› ä¸ºå®ƒèƒ½ä¿è¯æ›´å¤šçš„ååé‡ã€‚é™¤äº†ä»¤ç‰Œæ¡¶ç®—æ³•è¿˜æœ‰ä»–çš„å‰èº«æ¼æ¡¶ç®—æ³•å’Œç®€å•çš„è®¡æ•°ç®—æ³•</li><li>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹è¿™å››ç§ç®—æ³•</li></ul><h1 id="å›ºå®šæ—¶é—´çª—å£ç®—æ³•"><a href="#å›ºå®šæ—¶é—´çª—å£ç®—æ³•" class="headerlink" title="å›ºå®šæ—¶é—´çª—å£ç®—æ³•"></a>å›ºå®šæ—¶é—´çª—å£ç®—æ³•</h1><ul><li>å›ºå®šæ—¶é—´çª—å£ç®—æ³•ä¹Ÿå¯ä»¥å«åšç®€å•è®¡æ•°ç®—æ³•ã€‚ç½‘ä¸Šæœ‰å¾ˆå¤šéƒ½å°†è®¡æ•°ç®—æ³•å•ç‹¬æŠ½ç¦»å‡ºæ¥ã€‚ä½†æ˜¯ç¬”è€…è®¤ä¸ºè®¡æ•°ç®—æ³•æ˜¯ä¸€ç§æ€æƒ³ï¼Œè€Œå›ºå®šæ—¶é—´çª—å£ç®—æ³•æ˜¯ä»–çš„ä¸€ç§å®ç°</li><li>åŒ…æ‹¬ä¸‹é¢æ»‘åŠ¨æ—¶é—´çª—å£ç®—æ³•ä¹Ÿæ˜¯è®¡æ•°ç®—æ³•çš„ä¸€ç§å®ç°ã€‚å› ä¸ºè®¡æ•°å¦‚æœä¸å’Œæ—¶é—´è¿›è¡Œç»‘å®šçš„è¯é‚£ä¹ˆå¤±å»äº†é™æµçš„æœ¬è´¨äº†ã€‚å°±å˜æˆäº†æ‹’ç»äº†</li></ul><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/6d0987a5f6de48eaa186711fbff0db74~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210508103957917"></p><h2 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h2><ul><li>åœ¨å›ºå®šçš„æ—¶é—´å†…å‡ºç°æµé‡æº¢å‡ºå¯ä»¥ç«‹å³åšå‡ºé™æµã€‚æ¯ä¸ªæ—¶é—´çª—å£ä¸ä¼šç›¸äº’å½±å“</li><li>åœ¨æ—¶é—´å•å…ƒå†…ä¿éšœç³»ç»Ÿçš„ç¨³å®šã€‚ä¿éšœçš„æ—¶é—´å•å…ƒå†…ç³»ç»Ÿçš„ååé‡ä¸Šé™</li></ul><h2 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h2><ul><li>æ­£å¦‚å›¾ç¤ºä¸€æ ·ï¼Œä»–çš„æœ€å¤§é—®é¢˜å°±æ˜¯ä¸´ç•ŒçŠ¶æ€ã€‚åœ¨ä¸´ç•ŒçŠ¶æ€æœ€åæƒ…å†µä¼šå—åˆ°ä¸¤å€æµé‡è¯·æ±‚</li><li>é™¤äº†ä¸´ç•Œçš„æƒ…å†µï¼Œè¿˜æœ‰ä¸€ç§æ˜¯åœ¨ä¸€ä¸ªå•å…ƒæ—¶é—´çª—å†…å‰æœŸå¦‚æœå¾ˆå¿«çš„æ¶ˆè€—å®Œè¯·æ±‚é˜ˆå€¼ã€‚é‚£ä¹ˆå‰©ä¸‹çš„æ—¶é—´å°†ä¼šæ— æ³•è¯·æ±‚ã€‚è¿™æ ·å°±ä¼šå› ä¸ºä¸€ç¬é—´çš„æµé‡å¯¼è‡´ä¸€æ®µæ—¶é—´å†…ç³»ç»Ÿä¸å¯ç”¨ã€‚è¿™åœ¨äº’è”ç½‘é«˜å¯ç”¨çš„ç³»ç»Ÿä¸­æ˜¯ä¸èƒ½æ¥å—çš„ã€‚</li></ul><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><ul><li>å¥½äº†ï¼Œå…³äºåŸç†ä»‹ç»åŠä¼˜ç¼ºç‚¹æˆ‘ä»¬å·²ç»äº†è§£äº†ã€‚ä¸‹é¢æˆ‘ä»¬åŠ¨æ‰‹å®ç°å®ƒ</li><li>é¦–å…ˆæˆ‘ä»¬åœ¨å®ç°è¿™ç§è®¡æ•°æ—¶ï¼Œé‡‡ç”¨redisæ˜¯éå¸¸å¥½çš„é€‰æ‹©ã€‚è¿™é‡Œæˆ‘ä»¬é€šè¿‡rediså®ç°</li></ul><h3 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(value = &quot;/start&quot;,method = RequestMethod.GET)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String,Object&gt; <span class="hljs-title">start</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> Map&lt;String, Object&gt; paramMap)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> testService.startQps(paramMap);<br>    &#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><h3 id="service"><a href="#service" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title">startQps</span><span class="hljs-params">(Map&lt;String, Object&gt; paramMap)</span> </span>&#123;<br>    <span class="hljs-comment">//æ ¹æ®å‰ç«¯ä¼ é€’çš„qpsä¸Šçº¿</span><br>    Integer times = <span class="hljs-number">100</span>;<br>    <span class="hljs-keyword">if</span> (paramMap.containsKey(<span class="hljs-string">&quot;times&quot;</span>)) &#123;<br>        times = Integer.valueOf(paramMap.get(<span class="hljs-string">&quot;times&quot;</span>).toString());<br>    &#125;<br>    String redisKey = <span class="hljs-string">&quot;redisQps&quot;</span>;<br>    RedisAtomicInteger redisAtomicInteger = <span class="hljs-keyword">new</span> RedisAtomicInteger(redisKey, redisTemplate.getConnectionFactory());<br>    <span class="hljs-keyword">int</span> no = redisAtomicInteger.getAndIncrement();<br>    <span class="hljs-comment">//è®¾ç½®æ—¶é—´å›ºå®šæ—¶é—´çª—å£é•¿åº¦ 1S</span><br>    <span class="hljs-keyword">if</span> (no == <span class="hljs-number">0</span>) &#123;<br>        redisAtomicInteger.expire(<span class="hljs-number">1</span>, TimeUnit.SECONDS);<br>    &#125;<br>    <span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦è¶…é™  time=2 è¡¨ç¤ºqps=3</span><br>    <span class="hljs-keyword">if</span> (no &gt; times) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;qps refuse request&quot;</span>);<br>    &#125;<br>    <span class="hljs-comment">//è¿”å›æˆåŠŸå‘ŠçŸ¥</span><br>    Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br>    map.put(<span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-string">&quot;success&quot;</span>);<br>    <span class="hljs-keyword">return</span> map;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><h3 id="ç»“æœæµ‹è¯•"><a href="#ç»“æœæµ‹è¯•" class="headerlink" title="ç»“æœæµ‹è¯•"></a>ç»“æœæµ‹è¯•</h3><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/e8d7b3347b7f4ba1b3012328e0377d17~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210508135718284"></p><ul><li><p>æˆ‘ä»¬è®¾ç½®çš„qps=3 ï¼Œ  æˆ‘ä»¬å¯ä»¥çœ‹åˆ°äº”ä¸ªå¹¶å‘è¿›æ¥åå‰ä¸‰ä¸ªæ­£å¸¸è®¿é—®ï¼Œåé¢ä¸¤ä¸ªå°±å¤±è´¥äº†ã€‚ç¨ç­‰ä¸€æ®µæ—¶é—´æˆ‘ä»¬åœ¨å¹¶å‘è®¿é—®ï¼Œå‰ä¸‰ä¸ªåˆå¯ä»¥æ­£å¸¸è®¿é—®ã€‚è¯´æ˜åˆ°äº†ä¸‹ä¸€ä¸ªæ—¶é—´çª—å£</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/cbe866d8ab2f41b0a1b3ad7d24941370~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210508140028835"></p></li></ul><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/79c243b1ef2c4e37872f418ea999e375~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210508141549335"></p><h1 id="æ»‘åŠ¨æ—¶é—´çª—å£ç®—æ³•"><a href="#æ»‘åŠ¨æ—¶é—´çª—å£ç®—æ³•" class="headerlink" title="æ»‘åŠ¨æ—¶é—´çª—å£ç®—æ³•"></a>æ»‘åŠ¨æ—¶é—´çª—å£ç®—æ³•</h1><ul><li>é’ˆå¯¹å›ºå®šæ—¶é—´çª—å£çš„ç¼ºç‚¹â€“ä¸´ç•Œå€¼å‡ºç°åŒå€æµé‡é—®é¢˜ã€‚ æˆ‘ä»¬çš„æ»‘åŠ¨æ—¶é—´çª—å£å°±äº§ç”Ÿäº†ã€‚</li><li>å…¶å®å¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯é’ˆå¯¹å›ºå®šæ—¶é—´çª—å£ï¼Œå°†æ—¶é—´çª—å£ç»Ÿè®¡ä»åŸæ¥çš„å›ºå®šé—´éš”å˜æˆæ›´åŠ ç»†åº¦åŒ–çš„å•å…ƒäº†ã€‚</li><li>åœ¨ä¸Šé¢æˆ‘ä»¬å›ºå®šæ—¶é—´çª—å£æ¼”ç¤ºä¸­æˆ‘ä»¬è®¾ç½®çš„æ—¶é—´å•å…ƒæ˜¯1S ã€‚ é’ˆå¯¹1Sæˆ‘ä»¬å°†1Sæ‹†æˆæ—¶é—´æˆ³ã€‚</li><li>å›ºå®šæ—¶é—´çª—å£æ˜¯ç»Ÿè®¡å•å…ƒéšç€æ—¶é—´çš„æ¨ç§»ä¸æ–­å‘åè¿›è¡Œã€‚è€Œæ»‘åŠ¨æ—¶é—´çª—å£æ˜¯æˆ‘ä»¬è®¤ä¸ºçš„æƒ³è±¡å‡ºä¸€ä¸ªæ—¶é—´å•å…ƒæŒ‰ç…§ç›¸å¯¹è®ºçš„æ€æƒ³å°†æ—¶é—´å›ºå®šï¼Œæˆ‘ä»¬çš„æŠ½è±¡æ—¶é—´å•å…ƒè‡ªå·±ç§»åŠ¨ã€‚æŠ½è±¡çš„æ—¶é—´å•å…ƒæ¯”å®é™…çš„æ—¶é—´å•å…ƒæ›´å°ã€‚</li><li>è¯»è€…å¯ä»¥çœ‹ä¸‹ä¸‹é¢çš„åŠ¨å›¾ï¼Œå°±å¯ä»¥ç†è§£äº†ã€‚</li></ul><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/774e0952ddda4e4291f087890053ffed~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><h2 id="ä¼˜ç‚¹-1"><a href="#ä¼˜ç‚¹-1" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h2><ul><li>å®è´¨ä¸Šå°±æ˜¯å›ºå®šæ—¶é—´çª—å£ç®—æ³•çš„æ”¹è¿›ã€‚æ‰€ä»¥å›ºå®šæ—¶é—´çª—å£çš„ç¼ºç‚¹å°±æ˜¯ä»–çš„ä¼˜ç‚¹ã€‚</li><li>å†…éƒ¨æŠ½è±¡ä¸€ä¸ªæ»‘åŠ¨çš„æ—¶é—´çª—ï¼Œå°†æ—¶é—´æ›´åŠ å°åŒ–ã€‚å­˜åœ¨è¾¹ç•Œçš„é—®é¢˜æ›´åŠ å°ã€‚å®¢æˆ·æ„ŸçŸ¥æ›´å¼±äº†ã€‚</li></ul><h2 id="ç¼ºç‚¹-1"><a href="#ç¼ºç‚¹-1" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h2><ul><li>ä¸ç®¡æ˜¯å›ºå®šæ—¶é—´çª—å£ç®—æ³•è¿˜æ˜¯æ»‘åŠ¨æ—¶é—´çª—å£ç®—æ³•ï¼Œä»–ä»¬éƒ½æ˜¯åŸºäºè®¡æ•°å™¨ç®—æ³•è¿›è¡Œä¼˜åŒ–ï¼Œä½†æ˜¯ä»–ä»¬å¯¹å¾…é™æµçš„ç­–ç•¥å¤ªç²—æš´äº†ã€‚</li><li>ä¸ºä»€ä¹ˆè¯´ç²—æš´å‘¢ï¼Œæœªé™æµä»–ä»¬æ­£å¸¸æ”¾è¡Œã€‚ä¸€æ—¦è¾¾åˆ°é™æµåå°±ä¼šç›´æ¥æ‹’ç»ã€‚è¿™æ ·æˆ‘ä»¬ä¼šæŸå¤±ä¸€éƒ¨åˆ†è¯·æ±‚ã€‚è¿™å¯¹äºä¸€ä¸ªäº§å“æ¥è¯´ä¸å¤ªå‹å¥½</li></ul><h2 id="å®ç°-1"><a href="#å®ç°-1" class="headerlink" title="å®ç°"></a>å®ç°</h2><ul><li>æ»‘åŠ¨æ—¶é—´çª—å£æ˜¯å°†æ—¶é—´æ›´åŠ ç»†åŒ–ï¼Œä¸Šé¢æˆ‘ä»¬æ˜¯é€šè¿‡redis#setnxå®ç°çš„ã€‚è¿™é‡Œæˆ‘ä»¬å°±æ— æ³•é€šè¿‡ä»–ç»Ÿä¸€è®°å½•äº†ã€‚æˆ‘ä»¬åº”è¯¥åŠ ä¸Šæ›´å°çš„æ—¶é—´å•å…ƒå­˜å‚¨åˆ°ä¸€ä¸ªé›†åˆæ±‡æ€»ã€‚ç„¶åæ ¹æ®é›†åˆçš„æ€»é‡è®¡ç®—é™æµã€‚redisçš„zsettæ•°æ®ç»“æ„å°±å’Œç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚ã€‚</li><li>ä¸ºä»€ä¹ˆé€‰æ‹©zsetå‘¢ï¼Œå› ä¸ºredisçš„zsetä¸­é™¤äº†å€¼ä»¥å¤–è¿˜æœ‰ä¸€ä¸ªæƒé‡ã€‚ä¼šæ ¹æ®è¿™ä¸ªæƒé‡è¿›è¡Œæ’åºã€‚å¦‚æœæˆ‘ä»¬å°†æˆ‘ä»¬çš„æ—¶é—´å•å…ƒåŠæ—¶é—´æˆ³ä½œä¸ºæˆ‘ä»¬çš„æƒé‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬è·å–ç»Ÿè®¡çš„æ—¶å€™åªéœ€è¦æŒ‰ç…§ä¸€ä¸ªæ—¶é—´æˆ³èŒƒå›´å°±å¯ä»¥äº†ã€‚</li><li>å› ä¸ºzsetå†…å…ƒç´ æ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„å€¼é‡‡ç”¨uuidæˆ–è€…é›ªèŠ±ç®—æ³•ä¸€ç±»çš„idç”Ÿæˆå™¨</li></ul><h3 id="controller-1"><a href="#controller-1" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(value = &quot;/startList&quot;,method = RequestMethod.GET)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String,Object&gt; <span class="hljs-title">startList</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> Map&lt;String, Object&gt; paramMap)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> testService.startList(paramMap);<br>    &#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><h3 id="service-1"><a href="#service-1" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java">String redisKey = <span class="hljs-string">&quot;qpsZset&quot;</span>;<br>        Integer times = <span class="hljs-number">100</span>;<br>        <span class="hljs-keyword">if</span> (paramMap.containsKey(<span class="hljs-string">&quot;times&quot;</span>)) &#123;<br>            times = Integer.valueOf(paramMap.get(<span class="hljs-string">&quot;times&quot;</span>).toString());<br>        &#125;<br>        <span class="hljs-keyword">long</span> currentTimeMillis = System.currentTimeMillis();<br>        <span class="hljs-keyword">long</span> interMills = inter * <span class="hljs-number">1000L</span>;<br>        Long count = redisTemplate.opsForZSet().count(redisKey, currentTimeMillis - interMills, currentTimeMillis);<br>        <span class="hljs-keyword">if</span> (count &gt; times) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;qps refuse request&quot;</span>);<br>        &#125;<br>        redisTemplate.opsForZSet().add(redisKey, UUID.randomUUID().toString(), currentTimeMillis);<br>        Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br>        map.put(<span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-string">&quot;success&quot;</span>);<br>        <span class="hljs-keyword">return</span> map;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><h3 id="ç»“æœæµ‹è¯•-1"><a href="#ç»“æœæµ‹è¯•-1" class="headerlink" title="ç»“æœæµ‹è¯•"></a>ç»“æœæµ‹è¯•</h3><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/71e8932b64d64367b048e9628aa6d7c4~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210508150557980"></p><ul><li>å’Œå›ºå®šæ—¶é—´çª—å£é‡‡ç”¨ç›¸åŒçš„å¹¶å‘ã€‚ä¸ºä»€ä¹ˆä¸Šé¢ä¹Ÿä¼šå‡ºç°ä¸´ç•ŒçŠ¶å†µå‘¢ã€‚å› ä¸ºåœ¨ä»£ç é‡Œæ—¶é—´å•å…ƒé—´éš”æ¯”å›ºå®šæ—¶é—´é—´éš”é‡‡ç”¨è¿˜è¦å¤§ ã€‚ ä¸Šé¢æ¼”ç¤ºå›ºå®šæ—¶é—´çª—å£æ—¶é—´å•å…ƒæ˜¯1Så‡ºç°äº†æœ€åæƒ…å†µã€‚è€Œæ»‘åŠ¨æ—¶é—´çª—å£è®¾è®¡ä¸Šå°±åº”è¯¥é—´éš”æ›´çŸ­ã€‚è€Œæˆ‘è®¾ç½®æˆ10S ä¹Ÿæ²¡æœ‰å‡ºç°åçš„æƒ…å†µ</li><li>è¿™é‡Œå°±è¯´æ˜æ»‘åŠ¨æ¯”å›ºå®šçš„ä¼˜å¤„äº†ã€‚å¦‚æœæˆ‘ä»¬è°ƒæ›´å°åº”è¯¥æ›´åŠ ä¸ä¼šå‡ºç°ä¸´ç•Œé—®é¢˜ï¼Œä¸è¿‡è¯´åˆ°åº•ä»–è¿˜æ˜¯é¿å…ä¸äº†ä¸´ç•Œå‡ºç°çš„é—®é¢˜</li></ul><h1 id="æ¼æ¡¶ç®—æ³•"><a href="#æ¼æ¡¶ç®—æ³•" class="headerlink" title="æ¼æ¡¶ç®—æ³•"></a>æ¼æ¡¶ç®—æ³•</h1><ul><li>æ»‘åŠ¨æ—¶é—´çª—å£è™½ç„¶å¯ä»¥æå¤§ç¨‹åº¦çš„è§„é¿ä¸´ç•Œå€¼é—®é¢˜ï¼Œä½†æ˜¯å§‹ç»ˆè¿˜æ˜¯é¿å…ä¸äº†</li><li>å¦å¤–æ—¶é—´ç®—æ³•è¿˜æœ‰ä¸ªè‡´å‘½çš„é—®é¢˜ï¼Œä»–æ— æ³•é¢å¯¹çªå¦‚å…¶æ¥çš„å¤§é‡æµé‡ï¼Œå› ä¸ºä»–åœ¨è¾¾åˆ°é™æµåç›´æ¥å°±æ‹’ç»äº†å…¶ä»–é¢å¤–æµé‡</li><li>é’ˆå¯¹è¿™ä¸ªé—®é¢˜æˆ‘ä»¬ç»§ç»­ä¼˜åŒ–æˆ‘ä»¬çš„é™æµç®—æ³•ã€‚ æ¼æ¡¶ç®—æ³•åº”è¿è€Œç”Ÿ</li></ul><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/e374223ef38248fb8a30cc12de223adf~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210508154607271"></p><h2 id="ä¼˜ç‚¹-2"><a href="#ä¼˜ç‚¹-2" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h2><ul><li>é¢å¯¹é™æµæ›´åŠ çš„æŸ”æ€§ï¼Œä¸åœ¨ç²—æš´çš„æ‹’ç»ã€‚</li><li>å¢åŠ äº†æ¥å£çš„æ¥æ”¶æ€§</li><li>ä¿è¯ä¸‹æµæœåŠ¡æ¥æ”¶çš„ç¨³å®šæ€§ã€‚å‡åŒ€ä¸‹å‘</li></ul><h2 id="ç¼ºç‚¹-2"><a href="#ç¼ºç‚¹-2" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h2><ul><li>æˆ‘è§‰å¾—æ²¡æœ‰ç¼ºç‚¹ã€‚éè¦é¸¡è›‹é‡ŒæŒ‘éª¨å¤´é‚£æˆ‘åªèƒ½è¯´æ¼æ¡¶å®¹é‡æ˜¯ä¸ªçŸ­æ¿</li></ul><h2 id="å®ç°-2"><a href="#å®ç°-2" class="headerlink" title="å®ç°"></a>å®ç°</h2><h3 id="controller-2"><a href="#controller-2" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(value = &quot;/startLoutong&quot;,method = RequestMethod.GET)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String,Object&gt; <span class="hljs-title">startLoutong</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> Map&lt;String, Object&gt; paramMap)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> testService.startLoutong(paramMap);<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><h3 id="service-2"><a href="#service-2" class="headerlink" title="service"></a>service</h3><ul><li>åœ¨serviceä¸­æˆ‘ä»¬é€šè¿‡redisçš„listçš„åŠŸèƒ½æ¨¡æ‹Ÿå‡ºæ¡¶çš„æ•ˆæœã€‚è¿™é‡Œä»£ç æ˜¯å®éªŒå®¤æ€§è´¨çš„ã€‚åœ¨çœŸå®ä½¿ç”¨ä¸­æˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘å¹¶å‘çš„é—®é¢˜</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title">startLoutong</span><span class="hljs-params">(Map&lt;String, Object&gt; paramMap)</span> </span>&#123;<br>    String redisKey = <span class="hljs-string">&quot;qpsList&quot;</span>;<br>    Integer times = <span class="hljs-number">100</span>;<br>    <span class="hljs-keyword">if</span> (paramMap.containsKey(<span class="hljs-string">&quot;times&quot;</span>)) &#123;<br>        times = Integer.valueOf(paramMap.get(<span class="hljs-string">&quot;times&quot;</span>).toString());<br>    &#125;<br>    Long size = redisTemplate.opsForList().size(redisKey);<br>    <span class="hljs-keyword">if</span> (size &gt;= times) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;qps refuse request&quot;</span>);<br>    &#125;<br>    Long aLong = redisTemplate.opsForList().rightPush(redisKey, paramMap);<br>    <span class="hljs-keyword">if</span> (aLong &gt; times) &#123;<br>        <span class="hljs-comment">//ä¸ºäº†é˜²æ­¢å¹¶å‘åœºæ™¯ã€‚è¿™é‡Œæ·»åŠ å®Œæˆä¹‹åä¹Ÿè¦éªŒè¯ã€‚  å³ä½¿è¿™æ ·æœ¬æ®µä»£ç åœ¨é«˜å¹¶å‘ä¹Ÿæœ‰é—®é¢˜ã€‚æ­¤å¤„æ¼”ç¤ºä½œç”¨</span><br>        redisTemplate.opsForList().trim(redisKey, <span class="hljs-number">0</span>, times-<span class="hljs-number">1</span>);<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;qps refuse request&quot;</span>);<br>    &#125;<br>    Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br>    map.put(<span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-string">&quot;success&quot;</span>);<br>    <span class="hljs-keyword">return</span> map;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><h3 id="ä¸‹æ¸¸æ¶ˆè´¹"><a href="#ä¸‹æ¸¸æ¶ˆè´¹" class="headerlink" title="ä¸‹æ¸¸æ¶ˆè´¹"></a>ä¸‹æ¸¸æ¶ˆè´¹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SchedulerTask</span> </span>&#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    RedisTemplate redisTemplate;<br><br>    <span class="hljs-keyword">private</span> String redisKey=<span class="hljs-string">&quot;qpsList&quot;</span>;<br><br>    <span class="hljs-meta">@Scheduled(cron=&quot;*/1 * * * * ?&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">process</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-comment">//ä¸€æ¬¡æ€§æ¶ˆè´¹ä¸¤ä¸ª</span><br>        System.out.println(<span class="hljs-string">&quot;æ­£åœ¨æ¶ˆè´¹ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚&quot;</span>);<br>        redisTemplate.opsForList().trim(redisKey, <span class="hljs-number">2</span>, -<span class="hljs-number">1</span>);<br>    &#125;<br><br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><ul><li>æˆ‘ä»¬è¿˜æ˜¯é€šè¿‡50å¹¶å‘å¾ªç¯10æ¬¡è®¿é—®ã€‚æˆ‘ä»¬å¯ä»¥å‘ç°åªæœ‰åœ¨ä¸€å¼€å§‹èƒ½è¾¾åˆ°æ¯”è¾ƒé«˜çš„ååé‡ã€‚åœ¨éšåæ¡¶çš„å®¹é‡æ»¡äº†ä¹‹åã€‚è€Œä¸‹æ¸¸æ°´æ»´é€Ÿç‡æ¯”ä¸Šæ¸¸è¯·æ±‚é€Ÿç‡æ…¢çš„æƒ…å†µä¸‹ã€‚åªèƒ½ä»¥ä¸‹æ¸¸æ’å®šçš„é€Ÿåº¦æ¥æ”¶è®¿é—®ã€‚</li><li>ä»–çš„é—®é¢˜ä¹Ÿæš´éœ²çš„å¾ˆæ˜æ˜¾ã€‚é’ˆå¯¹æ—¶é—´çª—å£çš„ä¸è¶³æ¼æ¡¶è¿›è¡Œçš„ä¸è¶³ï¼Œä½†æ˜¯ä»æ˜¯ä¸è¶³ã€‚æ— æ³•å½»åº•é¿å…è¯·æ±‚æº¢å‡ºçš„é—®é¢˜ã€‚</li><li>è¯·æ±‚æº¢å‡ºæœ¬èº«å°±æ˜¯ä¸€ç§ç¾éš¾æ€§çš„é—®é¢˜ã€‚æ‰€æœ‰çš„ç®—æ³•ç›®å‰éƒ½æ²¡æœ‰è§£å†³è¿™ä¸ªé—®é¢˜ã€‚åªæ˜¯åœ¨å‡ç¼“ä»–å¸¦æ¥çš„é—®é¢˜</li></ul><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/4935f88aba314abb90655ba7be2264bb~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><h1 id="ä»¤ç‰Œæ¡¶ç®—æ³•"><a href="#ä»¤ç‰Œæ¡¶ç®—æ³•" class="headerlink" title="ä»¤ç‰Œæ¡¶ç®—æ³•"></a>ä»¤ç‰Œæ¡¶ç®—æ³•</h1><ul><li>ä»¤ç‰Œæ¡¶å’Œæ¼æ¡¶æ³•æ˜¯ä¸€æ ·çš„ã€‚åªä¸è¿‡å°†æ¡¶çš„ä½œç”¨æ–¹å‘æ”¹å˜äº†ä¸€ä¸‹ã€‚</li><li>æ¼æ¡¶çš„å‡ºæ°´é€Ÿåº¦æ˜¯æ’å®šçš„ï¼Œå¦‚æœæµé‡çªç„¶å¢åŠ çš„è¯æˆ‘ä»¬å°±åªèƒ½æ‹’ç»å…¥æ± </li><li>ä½†æ˜¯ä»¤ç‰Œæ¡¶æ˜¯å°†ä»¤ç‰Œæ”¾å…¥æ¡¶ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“æ­£å¸¸æƒ…å†µä¸‹ä»¤ç‰Œå°±æ˜¯ä¸€ä¸²å­—ç¬¦å½“æ¡¶æ»¡äº†å°±æ‹’ç»ä»¤ç‰Œçš„å…¥æ± ï¼Œä½†æ˜¯é¢å¯¹é«˜æµé‡çš„æ—¶å€™æ­£å¸¸åŠ ä¸Šæˆ‘ä»¬çš„è¶…æ—¶æ—¶é—´å°±ç•™ä¸‹è¶³å¤Ÿé•¿çš„æ—¶é—´ç”Ÿäº§åŠæ¶ˆè´¹ä»¤ç‰Œäº†ã€‚è¿™æ ·å°±å°½å¯èƒ½çš„ä¸ä¼šé€ æˆè¯·æ±‚çš„æ‹’ç»</li><li>æœ€åï¼Œä¸è®ºæ˜¯å¯¹äºä»¤ç‰Œæ¡¶æ‹¿ä¸åˆ°ä»¤ç‰Œè¢«æ‹’ç»ï¼Œè¿˜æ˜¯æ¼æ¡¶çš„æ°´æ»¡äº†æº¢å‡ºï¼Œéƒ½æ˜¯ä¸ºäº†ä¿è¯å¤§éƒ¨åˆ†æµé‡çš„æ­£å¸¸ä½¿ç”¨ï¼Œè€Œç‰ºç‰²æ‰äº†å°‘éƒ¨åˆ†æµé‡</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title">startLingpaitong</span><span class="hljs-params">(Map&lt;String, Object&gt; paramMap)</span> </span>&#123;<br>        String redisKey = <span class="hljs-string">&quot;lingpaitong&quot;</span>;<br>        String token = redisTemplate.opsForList().leftPop(redisKey).toString();<br>        <span class="hljs-comment">//æ­£å¸¸æƒ…å†µéœ€è¦éªŒè¯æ˜¯å¦åˆæ³•ï¼Œé˜²æ­¢ç¯¡æ”¹</span><br>        <span class="hljs-keyword">if</span> (StringUtils.isEmpty(token)) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;ä»¤ç‰Œæ¡¶æ‹’ç»&quot;</span>);<br>        &#125;<br>        Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br>        map.put(<span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-string">&quot;success&quot;</span>);<br>        <span class="hljs-keyword">return</span> map;<br>    &#125;<br><br>å¤åˆ¶ä»£ç <br><span class="hljs-meta">@Scheduled(cron=&quot;*/1 * * * * ?&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">process</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-comment">//ä¸€æ¬¡æ€§ç”Ÿäº§ä¸¤ä¸ª</span><br>        System.out.println(<span class="hljs-string">&quot;æ­£åœ¨æ¶ˆè´¹ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚&quot;</span>);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++) &#123;<br>            redisTemplate.opsForList().rightPush(redisKey, i);<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>redis</tag>
      
      <tag>é™æµ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBootä¼˜é›…åœ°å®ç°æ¥å£å‚æ•°æ ¡éªŒ</title>
    <link href="/blog/2021/05/29/SpringBoot%E4%BC%98%E9%9B%85%E5%9C%B0%E5%AE%9E%E7%8E%B0%E6%8E%A5%E5%8F%A3%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C/"/>
    <url>/blog/2021/05/29/SpringBoot%E4%BC%98%E9%9B%85%E5%9C%B0%E5%AE%9E%E7%8E%B0%E6%8E%A5%E5%8F%A3%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C/</url>
    
    <content type="html"><![CDATA[<p>validationä¸»è¦æ˜¯æ ¡éªŒç”¨æˆ·æäº¤çš„æ•°æ®çš„åˆæ³•æ€§ï¼Œæ¯”å¦‚æ˜¯å¦ä¸ºç©ºï¼Œå¯†ç æ˜¯å¦ç¬¦åˆè§„åˆ™ï¼Œé‚®ç®±æ ¼å¼æ˜¯å¦æ­£ç¡®ç­‰ç­‰ï¼Œæ ¡éªŒæ¡†æ¶æ¯”è¾ƒå¤šï¼Œç”¨çš„æ¯”è¾ƒå¤šçš„æ˜¯hibernate-validatorï¼Œ ä¹Ÿæ”¯æŒå›½é™…åŒ–ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ ¡éªŒç±»å‹çš„æ³¨è§£ï¼Œè¿™é‡Œåªæ˜¯ç®€å•åœ°æ¼”ç¤ºæ ¡éªŒæ¡†æ¶åœ¨Spring Bootä¸­çš„ç®€å•é›†æˆï¼Œè¦æƒ³äº†è§£æ›´å¤šå¯ä»¥å‚è€ƒ hibernate-validatorã€‚</p><h1 id="1-pom-xml"><a href="#1-pom-xml" class="headerlink" title="1. pom.xml"></a><strong>1. pom.xml</strong></h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-validation<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h1 id="2-dto"><a href="#2-dto" class="headerlink" title="2. dto"></a><strong>2. dto</strong></h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserInfoIDto</span> </span>&#123;<br><br>    <span class="hljs-keyword">private</span> Long id;<br><br>    <span class="hljs-meta">@NotBlank</span><br>    <span class="hljs-meta">@Length(min=3, max=10)</span><br>    <span class="hljs-keyword">private</span> String username;<br><br>    <span class="hljs-meta">@NotBlank</span><br>    <span class="hljs-meta">@Email</span><br>    <span class="hljs-keyword">private</span> String email;<br><br>    <span class="hljs-meta">@NotBlank</span><br>    <span class="hljs-meta">@Pattern(regexp=&quot;^((13[0-9])|(15[^4,\\D])|(18[0,3-9]))\\d&#123;8&#125;$&quot;, message=&quot;æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®&quot;)</span><br>    <span class="hljs-keyword">private</span> String phone;<br><br>    <span class="hljs-meta">@Min(value=18)</span><br>    <span class="hljs-meta">@Max(value = 200)</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> age;<br><br>    <span class="hljs-meta">@NotBlank</span><br>    <span class="hljs-meta">@Length(min=6, max=12, message=&quot;æ˜µç§°é•¿åº¦ä¸º6åˆ°12ä½&quot;)</span><br>    <span class="hljs-keyword">private</span> String nickname;<br><br>     <span class="hljs-comment">// Getter &amp; Setter</span><br>&#125;<br></code></pre></td></tr></table></figure><h1 id="3-controller"><a href="#3-controller" class="headerlink" title="3. controller"></a><strong>3. controller</strong></h1><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> org.springframework.validation.BindingResult;<br><span class="hljs-keyword">import</span> org.springframework.validation.FieldError;<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SimpleController</span> </span>&#123;<br><br>    <span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">&quot;/users&quot;</span>)<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">String</span> <span class="hljs-function"><span class="hljs-title">register</span>(<span class="hljs-params"><span class="hljs-meta">@Valid</span> <span class="hljs-meta">@RequestBody</span> UserInfoIDto userInfoIDto, BindingResult result</span>)</span>&#123;<br>        <span class="hljs-keyword">if</span> (result.hasErrors()) &#123;<br>            FieldError fieldError = result.getFieldError();<br>            <span class="hljs-built_in">String</span> field = fieldError.getField();<br>            <span class="hljs-built_in">String</span> msg = fieldError.getDefaultMessage();<br><br>            <span class="hljs-keyword">return</span> field + <span class="hljs-string">&quot;:&quot;</span> + msg;<br>        &#125;<br>        System.out.println(<span class="hljs-string">&quot;å¼€å§‹æ³¨å†Œç”¨æˆ·...&quot;</span>);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;success&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/p80hag.png"></p><h1 id="4-å»æ‰BindingResultå‚æ•°"><a href="#4-å»æ‰BindingResultå‚æ•°" class="headerlink" title="4. å»æ‰BindingResultå‚æ•°"></a><strong>4. å»æ‰BindingResultå‚æ•°</strong></h1><p>æ¯ä¸ªæ¥å£éƒ½éœ€è¦BindingResultå‚æ•°ï¼Œè€Œä¸”æ¯ä¸ªæ¥å£éƒ½éœ€è¦å¤„ç†é”™è¯¯ä¿¡æ¯ï¼Œè¿™æ ·å¢åŠ ä¸€ä¸ªå‚æ•°ä¹Ÿä¸ä¼˜é›…ï¼Œå¤„ç†é”™è¯¯ä¿¡æ¯ä»£ç é‡ä¹Ÿå¾ˆé‡å¤ã€‚å¦‚æœå»æ‰BindingResultå‚æ•°ï¼Œç³»ç»Ÿå°±ä¼šæŠ¥é”™MethodArgumentNotValidExceptionï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨å…¨å±€å¼‚å¸¸æ¥æ•è·è¯¥é”™è¯¯ï¼Œå¤„ç†ä¸€ä¸‹å°±å¯ä»¥çœç•¥ä¼ BindingResultå‚æ•°äº†ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SimpleController</span> </span>&#123;<br><br>    <span class="hljs-meta">@PostMapping(<span class="hljs-meta-string">&quot;/users&quot;</span>)</span><br>    <span class="hljs-keyword">public</span> String register(<span class="hljs-meta">@Valid</span> <span class="hljs-meta">@RequestBody</span> UserInfoIDto userInfoIDto)&#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;å¼€å§‹æ³¨å†Œç”¨æˆ·...&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;success&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>@RestControllerAdvice ç”¨äºæ‹¦æˆªæ‰€æœ‰çš„@RestController</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@RestControllerAdvice</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GlobalExceptionHandlerAdvice</span> </span>&#123;<br><br>    <span class="hljs-meta">@ExceptionHandler(MethodArgumentNotValidException.class)</span><br>    <span class="hljs-keyword">public</span> String methodArgumentNotValidException(MethodArgumentNotValidException e) &#123;<br>        <span class="hljs-comment">// ä»å¼‚å¸¸å¯¹è±¡ä¸­æ‹¿åˆ°ObjectErrorå¯¹è±¡</span><br>        ObjectError objectError = e.getBindingResult().getAllErrors().<span class="hljs-keyword">get</span>(<span class="hljs-number">0</span>);<br>        <span class="hljs-comment">// ç„¶åæå–é”™è¯¯æç¤ºä¿¡æ¯è¿›è¡Œè¿”å›</span><br>        <span class="hljs-keyword">return</span> objectError.getDefaultMessage();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/de4c834b26844f0588dffbd6b5c5c3b5~tplv-k3u1fbpfcp-watermark.image" alt="img"></p><h1 id="5-ç»Ÿä¸€è¿”å›æ ¼å¼"><a href="#5-ç»Ÿä¸€è¿”å›æ ¼å¼" class="headerlink" title="5. ç»Ÿä¸€è¿”å›æ ¼å¼"></a><strong>5. ç»Ÿä¸€è¿”å›æ ¼å¼</strong></h1><p>é”™è¯¯ç æšä¸¾</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Getter</span><br><span class="hljs-keyword">public</span> <span class="hljs-built_in">enum</span> ErrorCodeEnum &#123;<br>    SUCCESS(<span class="hljs-number">1000</span>, <span class="hljs-string">&quot;æˆåŠŸ&quot;</span>),<br>    FAILED(<span class="hljs-number">1001</span>, <span class="hljs-string">&quot;å“åº”å¤±è´¥&quot;</span>),<br>    VALIDATE_FAILED(<span class="hljs-number">1002</span>, <span class="hljs-string">&quot;å‚æ•°æ ¡éªŒå¤±è´¥&quot;</span>),<br>    ERROR(<span class="hljs-number">5000</span>, <span class="hljs-string">&quot;æœªçŸ¥é”™è¯¯&quot;</span>);<br><br>    <span class="hljs-keyword">private</span> Integer code;<br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">String</span> msg;<br><br>    <span class="hljs-function"><span class="hljs-title">ErrorCodeEnum</span>(<span class="hljs-params">int code, <span class="hljs-built_in">String</span> msg</span>)</span> &#123;<br>        <span class="hljs-built_in">this</span>.code = code;<br>        <span class="hljs-built_in">this</span>.msg = msg;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è‡ªå®šä¹‰å¼‚å¸¸ã€‚</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-meta">@Getter</span><br>public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">APIException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RuntimeException</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> int code;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> msg;<br><br>    public <span class="hljs-type">APIException</span>(<span class="hljs-type">ErrorCodeEnum</span> errorCodeEnum) &#123;<br>        <span class="hljs-keyword">super</span>(errorCodeEnum.getMsg());<br>        <span class="hljs-keyword">this</span>.code = errorCodeEnum.getCode();<br>        <span class="hljs-keyword">this</span>.msg = errorCodeEnum.getMsg();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å®šä¹‰è¿”å›æ ¼å¼ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@Getter</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Response</span>&lt;<span class="hljs-type">T</span>&gt; </span>&#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * çŠ¶æ€ç ï¼Œæ¯”å¦‚1000ä»£è¡¨å“åº”æˆåŠŸ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> int code;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å“åº”ä¿¡æ¯ï¼Œç”¨æ¥è¯´æ˜å“åº”æƒ…å†µ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String msg;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å“åº”çš„å…·ä½“æ•°æ®</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> T <span class="hljs-keyword">data</span>;<br><br>    <span class="hljs-keyword">public</span> Response(T <span class="hljs-keyword">data</span>) &#123;<br>        <span class="hljs-keyword">this</span>.code = ErrorCodeEnum.SUCCESS.getCode();<br>        <span class="hljs-keyword">this</span>.msg = ErrorCodeEnum.SUCCESS.getMsg();<br>        <span class="hljs-keyword">this</span>.<span class="hljs-keyword">data</span> = <span class="hljs-keyword">data</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Response(int code, String msg) &#123;<br>        <span class="hljs-keyword">this</span>.code = code;<br>        <span class="hljs-keyword">this</span>.msg = msg;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…¨å±€å¼‚å¸¸å¤„ç†å™¨å¢åŠ å¯¹APIExceptionçš„æ‹¦æˆªï¼Œå¹¶ä¿®æ”¹å¼‚å¸¸æ—¶è¿”å›çš„æ•°æ®æ ¼å¼ã€‚</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">@RestControllerAdvice<br>public <span class="hljs-keyword">class</span> GlobalExceptionHandlerAdvice &#123;<br><br>    @<span class="hljs-constructor">ExceptionHandler(MethodArgumentNotValidException.<span class="hljs-params">class</span>)</span><br>    public Response&lt;String&gt; <span class="hljs-keyword">method</span><span class="hljs-constructor">ArgumentNotValidException(MethodArgumentNotValidException <span class="hljs-params">e</span>)</span> &#123;<br>        <span class="hljs-comment">// ä»å¼‚å¸¸å¯¹è±¡ä¸­æ‹¿åˆ°ObjectErrorå¯¹è±¡</span><br>        ObjectError objectError = e.get<span class="hljs-constructor">BindingResult()</span>.get<span class="hljs-constructor">AllErrors()</span>.get(<span class="hljs-number">0</span>);<br>        <span class="hljs-comment">// ç„¶åæå–é”™è¯¯æç¤ºä¿¡æ¯è¿›è¡Œè¿”å›</span><br>        return <span class="hljs-keyword">new</span> Response&lt;&gt;(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ErrorCodeEnum</span>.</span><span class="hljs-module"><span class="hljs-identifier">VALIDATE_FAILED</span>.</span></span>get<span class="hljs-constructor">Code()</span>, objectError.get<span class="hljs-constructor">DefaultMessage()</span>);<br>    &#125;<br><br>    @<span class="hljs-constructor">ExceptionHandler(APIException.<span class="hljs-params">class</span>)</span><br>    public Response&lt;String&gt; <span class="hljs-constructor">APIExceptionHandler(APIException <span class="hljs-params">e</span>)</span> &#123;<br>        return <span class="hljs-keyword">new</span> Response&lt;&gt;(e.get<span class="hljs-constructor">Code()</span>, e.get<span class="hljs-constructor">Msg()</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>SimpleController å¢åŠ ä¸€ä¸ªæŠ›å‡ºå¼‚å¸¸çš„æ–¹æ³•ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SimpleController</span> </span>&#123;<br><br>    <span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">&quot;/users&quot;</span>)<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">String</span> <span class="hljs-function"><span class="hljs-title">register</span>(<span class="hljs-params"><span class="hljs-meta">@Valid</span> <span class="hljs-meta">@RequestBody</span> UserInfoIDto userInfoIDto</span>)</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;å¼€å§‹æ³¨å†Œç”¨æˆ·...&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;success&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">&quot;/users&quot;</span>)<br>    <span class="hljs-keyword">public</span> Response&lt;UserInfoIDto&gt; <span class="hljs-function"><span class="hljs-title">list</span>(<span class="hljs-params"></span>)</span> &#123;<br>        UserInfoIDto userInfoIDto = <span class="hljs-keyword">new</span> UserInfoIDto();<br>        userInfoIDto.setUsername(<span class="hljs-string">&quot;monday&quot;</span>);<br>        userInfoIDto.setAge(<span class="hljs-number">30</span>);<br>        userInfoIDto.setPhone(<span class="hljs-string">&quot;123456789&quot;</span>);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">true</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> APIException(ErrorCodeEnum.ERROR);<br>        &#125;<br>        <span class="hljs-comment">// ä¸ºäº†ä¿æŒæ•°æ®æ ¼å¼ç»Ÿä¸€ï¼Œå¿…é¡»ä½¿ç”¨ResponseåŒ…è£…ä¸€ä¸‹</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Response&lt;&gt;(userInfoIDto);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/45e974e9f5a14fac8a7bb4bc475539cc~tplv-k3u1fbpfcp-watermark.image" alt="img"></p><p>æŠ¥é”™è¿”å›çš„æ ¼å¼ã€‚</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/822679e70b524691af1b98402428dfbd~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>ä¸æŠ¥é”™ï¼Œè¿”å›çš„æ ¼å¼ã€‚</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/8e4fb6d102fd45dc83c98668aca504bf~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><h1 id="6-å»æ‰æ¥å£ä¸­çš„ResponseåŒ…è£…"><a href="#6-å»æ‰æ¥å£ä¸­çš„ResponseåŒ…è£…" class="headerlink" title="6. å»æ‰æ¥å£ä¸­çš„ResponseåŒ…è£…"></a><strong>6. å»æ‰æ¥å£ä¸­çš„ResponseåŒ…è£…</strong></h1><p>@RestControllerAdviceæ—¢å¯ä»¥å…¨å±€æ‹¦æˆªå¼‚å¸¸ä¹Ÿå¯æ‹¦æˆªæŒ‡å®šåŒ…ä¸‹æ­£å¸¸çš„è¿”å›å€¼ï¼Œå¯ä»¥å¯¹è¿”å›å€¼è¿›è¡Œä¿®æ”¹ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@RestControllerAdvice</span>(basePackages = &#123;<span class="hljs-string">&quot;com.example.validator.controller&quot;</span>&#125;)<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ResponseControllerAdvice</span> <span class="hljs-title">implements</span> <span class="hljs-title">ResponseBodyAdvice</span>&lt;<span class="hljs-title">Object</span>&gt; </span>&#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¯¹é‚£äº›æ–¹æ³•éœ€è¦åŒ…è£…ï¼Œå¦‚æœæ¥å£ç›´æ¥è¿”å›Responseå°±æ²¡æœ‰å¿…è¦å†åŒ…è£…äº†</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param <span class="hljs-variable">returnType</span></span></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param <span class="hljs-variable">aClass</span></span></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return </span>å¦‚æœä¸ºtrueæ‰ä¼šæ‰§è¡ŒbeforeBodyWrite</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-function"><span class="hljs-title">supports</span>(<span class="hljs-params">MethodParameter returnType, Class&lt;? <span class="hljs-keyword">extends</span> HttpMessageConverter&lt;?&gt;&gt; aClass</span>)</span> &#123;<br>        <span class="hljs-keyword">return</span> !returnType.getParameterType().equals(Response.class);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">Object</span> <span class="hljs-function"><span class="hljs-title">beforeBodyWrite</span>(<span class="hljs-params"><span class="hljs-built_in">Object</span> data, MethodParameter returnType, MediaType mediaType, Class&lt;? <span class="hljs-keyword">extends</span> HttpMessageConverter&lt;?&gt;&gt; aClass, ServerHttpRequest request, ServerHttpResponse response</span>)</span> &#123;<br>        <span class="hljs-comment">// Stringç±»å‹ä¸èƒ½ç›´æ¥åŒ…è£…ï¼Œæ‰€ä»¥è¦è¿›è¡Œäº›ç‰¹åˆ«çš„å¤„ç†</span><br>        <span class="hljs-keyword">if</span> (returnType.getGenericParameterType().equals(<span class="hljs-built_in">String</span>.class)) &#123;<br>            ObjectMapper objectMapper = <span class="hljs-keyword">new</span> ObjectMapper();<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">// å°†æ•°æ®åŒ…è£…åœ¨Responseé‡Œåï¼Œå†è½¬æ¢ä¸ºjsonå­—ç¬¦ä¸²å“åº”ç»™å‰ç«¯</span><br>                <span class="hljs-keyword">return</span> objectMapper.writeValueAsString(<span class="hljs-keyword">new</span> Response&lt;&gt;(data));<br>            &#125; <span class="hljs-keyword">catch</span> (JsonProcessingException e) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> APIException(ErrorCodeEnum.ERROR);<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">// è¿™é‡Œç»Ÿä¸€åŒ…è£…</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Response&lt;&gt;(data);<br>    &#125;<br>&#125;<br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SimpleController</span> </span>&#123;<br><br>    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">&quot;/users&quot;</span>)<br>    <span class="hljs-keyword">public</span> UserInfoIDto <span class="hljs-function"><span class="hljs-title">list</span>(<span class="hljs-params"></span>)</span> &#123;<br>        UserInfoIDto userInfoIDto = <span class="hljs-keyword">new</span> UserInfoIDto();<br>        userInfoIDto.setUsername(<span class="hljs-string">&quot;monday&quot;</span>);<br>        userInfoIDto.setAge(<span class="hljs-number">30</span>);<br>        userInfoIDto.setPhone(<span class="hljs-string">&quot;123456789&quot;</span>);<br>        <span class="hljs-comment">// ç›´æ¥è¿”å›å€¼ï¼Œä¸éœ€è¦å†ä½¿ç”¨ResponseåŒ…è£…</span><br>        <span class="hljs-keyword">return</span> userInfoIDto;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/6d82f14a5b654c1fb2d737daf6ec4b8b~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><h1 id="7-æ¯ä¸ªæ ¡éªŒé”™è¯¯éƒ½å¯¹åº”ä¸åŒçš„é”™è¯¯ç "><a href="#7-æ¯ä¸ªæ ¡éªŒé”™è¯¯éƒ½å¯¹åº”ä¸åŒçš„é”™è¯¯ç " class="headerlink" title="7. æ¯ä¸ªæ ¡éªŒé”™è¯¯éƒ½å¯¹åº”ä¸åŒçš„é”™è¯¯ç "></a><strong>7. æ¯ä¸ªæ ¡éªŒé”™è¯¯éƒ½å¯¹åº”ä¸åŒçš„é”™è¯¯ç </strong></h1><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Retention</span>(RetentionPolicy.RUNTIME)<br><span class="hljs-variable">@Target</span>(&#123;ElementType.FIELD&#125;)<br>public <span class="hljs-variable">@interface</span> ValidateErrorCode &#123;<br>    <span class="hljs-comment">/** æ ¡éªŒé”™è¯¯ç  code */</span><br>    <span class="hljs-selector-tag">int</span> <span class="hljs-selector-tag">value</span>() <span class="hljs-selector-tag">default</span> <span class="hljs-selector-tag">100000</span>;<br>&#125;<br><br>å¤åˆ¶ä»£ç <br>@<span class="hljs-selector-tag">Data</span><br><span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">UserInfoIDto</span> &#123;<br>    <span class="hljs-variable">@NotBlank</span><br>    <span class="hljs-variable">@Email</span><br>    <span class="hljs-variable">@ValidateErrorCode</span>(value = <span class="hljs-number">20000</span>)<br>    private String email;<br><br>    <span class="hljs-variable">@NotBlank</span><br>    <span class="hljs-variable">@Pattern</span>(regexp=<span class="hljs-string">&quot;^((13[0-9])|(15[^4,\\D])|(18[0,3-9]))\\d&#123;8&#125;$&quot;</span>, message=<span class="hljs-string">&quot;æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®&quot;</span>)<br>    <span class="hljs-variable">@ValidateErrorCode</span>(value = <span class="hljs-number">30000</span>)<br>    private String phone;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ ¡éªŒå¼‚å¸¸è·å–æ³¨è§£ä¸­çš„é”™è¯¯ç ã€‚</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">@<span class="hljs-constructor">ExceptionHandler(MethodArgumentNotValidException.<span class="hljs-params">class</span>)</span><br>    public Response&lt;String&gt; <span class="hljs-keyword">method</span><span class="hljs-constructor">ArgumentNotValidException(MethodArgumentNotValidException <span class="hljs-params">e</span>)</span> throws NoSuchFieldException &#123;<br>        <span class="hljs-comment">// ä»å¼‚å¸¸å¯¹è±¡ä¸­æ‹¿åˆ°ObjectErrorå¯¹è±¡</span><br>        ObjectError objectError = e.get<span class="hljs-constructor">BindingResult()</span>.get<span class="hljs-constructor">AllErrors()</span>.get(<span class="hljs-number">0</span>);<br><br>        <span class="hljs-comment">// å‚æ•°çš„Classå¯¹è±¡ï¼Œç­‰ä¸‹å¥½é€šè¿‡å­—æ®µåç§°è·å–Fieldå¯¹è±¡</span><br>        Class&lt;?&gt; parameterType = e.get<span class="hljs-constructor">Parameter()</span>.get<span class="hljs-constructor">ParameterType()</span>;<br>        <span class="hljs-comment">// æ‹¿åˆ°é”™è¯¯çš„å­—æ®µåç§°</span><br>        String fieldName = e.get<span class="hljs-constructor">BindingResult()</span>.get<span class="hljs-constructor">FieldError()</span>.get<span class="hljs-constructor">Field()</span>;<br>        Field field = parameterType.get<span class="hljs-constructor">DeclaredField(<span class="hljs-params">fieldName</span>)</span>;<br>        <span class="hljs-comment">// è·å–Fieldå¯¹è±¡ä¸Šçš„è‡ªå®šä¹‰æ³¨è§£</span><br>        ValidateErrorCode annotation = field.get<span class="hljs-constructor">Annotation(ValidateErrorCode.<span class="hljs-params">class</span>)</span>;<br>        <span class="hljs-keyword">if</span> (annotation != null) &#123;<br>            return <span class="hljs-keyword">new</span> Response&lt;&gt;(annotation.value<span class="hljs-literal">()</span>,objectError.get<span class="hljs-constructor">DefaultMessage()</span>);<br>        &#125;<br><br>        <span class="hljs-comment">// ç„¶åæå–é”™è¯¯æç¤ºä¿¡æ¯è¿›è¡Œè¿”å›</span><br>        return <span class="hljs-keyword">new</span> Response&lt;&gt;(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ErrorCodeEnum</span>.</span><span class="hljs-module"><span class="hljs-identifier">VALIDATE_FAILED</span>.</span></span>get<span class="hljs-constructor">Code()</span>, objectError.get<span class="hljs-constructor">DefaultMessage()</span>);<br>    &#125;<br></code></pre></td></tr></table></figure><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/a1b041884421458e9668814a5ca9c62d~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/71dcc393adb441e78c28da919f7fbbdb~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><h1 id="8-ä¸ªåˆ«æ¥å£ä¸ç»Ÿä¸€åŒ…è£…å“åº”"><a href="#8-ä¸ªåˆ«æ¥å£ä¸ç»Ÿä¸€åŒ…è£…å“åº”" class="headerlink" title="8. ä¸ªåˆ«æ¥å£ä¸ç»Ÿä¸€åŒ…è£…å“åº”"></a><strong>8. ä¸ªåˆ«æ¥å£ä¸ç»Ÿä¸€åŒ…è£…å“åº”</strong></h1><p>æœ‰æ—¶å€™ç¬¬ä¸‰æ–¹æ¥å£å›è°ƒæˆ‘ä»¬çš„æ¥å£ï¼Œæˆ‘ä»¬çš„æ¥å£å¿…é¡»æŒ‰ç…§ç¬¬ä¸‰æ–¹å®šä¹‰çš„è¿”å›æ ¼å¼æ¥ï¼Œæ­¤æ—¶ç¬¬ä¸‰æ–¹ä¸ä¸€å®šå’Œæˆ‘ä»¬è‡ªå·±çš„è¿”å›æ ¼å¼ä¸€æ ·ï¼Œæ‰€ä»¥è¦æä¾›ä¸€ç§å¯ä»¥ç»•è¿‡ç»Ÿä¸€åŒ…è£…çš„æ–¹å¼ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-meta">@Target(&#123;ElementType.METHOD&#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> NotResponseWrap &#123;<br>&#125;<br><br>å¤åˆ¶ä»£ç <br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SimpleController</span> </span>&#123;<br><br>    <span class="hljs-meta">@NotResponseWrap</span><br>    <span class="hljs-meta">@PostMapping(<span class="hljs-meta-string">&quot;/users&quot;</span>)</span><br>    <span class="hljs-keyword">public</span> String register(<span class="hljs-meta">@Valid</span> <span class="hljs-meta">@RequestBody</span> UserInfoIDto userInfoIDto)&#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;å¼€å§‹æ³¨å†Œç”¨æˆ·...&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;success&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ResponseControllerAdvice å¢åŠ ä¸€ä¸ªä¸åŒ…è£…çš„æ¡ä»¶ï¼Œé…ç½®äº†@NotResponseWrapæ³¨è§£å°±è·³è¿‡åŒ…è£…ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php">@Override<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> supports(MethodParameter returnType, <span class="hljs-class"><span class="hljs-keyword">Class</span>&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpMessageConverter</span>&lt;?&gt;&gt; <span class="hljs-title">aClass</span>) </span>&#123;<br>        <span class="hljs-keyword">return</span> !(returnType.getParameterType().equals(Response.<span class="hljs-keyword">class</span>) || returnType.hasMethodAnnotation(NotResponseWrap.<span class="hljs-keyword">class</span>));<br>    &#125;<br></code></pre></td></tr></table></figure><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/4727801ce2674245ad3e1d8755246568~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p>]]></content>
    
    
    
    <tags>
      
      <tag>SpringBoot</tag>
      
      <tag>æ ¡éªŒ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQLä¼˜åŒ–åŸç†</title>
    <link href="/blog/2021/05/28/MySQL%E4%BC%98%E5%8C%96%E5%8E%9F%E7%90%86/"/>
    <url>/blog/2021/05/28/MySQL%E4%BC%98%E5%8C%96%E5%8E%9F%E7%90%86/</url>
    
    <content type="html"><![CDATA[<p><strong>ySQLé€»è¾‘æ¶æ„</strong><br> å¦‚æœèƒ½åœ¨å¤´è„‘ä¸­æ„å»ºä¸€å¹…MySQLå„ç»„ä»¶ä¹‹é—´å¦‚ä½•ååŒå·¥ä½œçš„æ¶æ„å›¾ï¼Œæœ‰åŠ©äºæ·±å…¥ç†è§£MySQLæœåŠ¡å™¨ã€‚ä¸‹å›¾å±•ç¤ºäº†MySQLçš„é€»è¾‘æ¶æ„å›¾ã€‚<br> <img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/1645ac4363d74142842ea6db503bf2f7~tplv-k3u1fbpfcp-zoom-1.image" alt="img"><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/a79749b0dc46457e8b7592483403db7e~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>MySQLé€»è¾‘æ¶æ„æ•´ä½“åˆ†ä¸ºä¸‰å±‚ï¼Œæœ€ä¸Šå±‚ä¸ºå®¢æˆ·ç«¯å±‚ï¼Œå¹¶éMySQLæ‰€ç‹¬æœ‰ï¼Œè¯¸å¦‚ï¼šè¿æ¥å¤„ç†ã€æˆæƒè®¤è¯ã€å®‰å…¨ç­‰åŠŸèƒ½å‡åœ¨è¿™ä¸€å±‚å¤„ç†ã€‚</p><p>MySQLå¤§å¤šæ•°æ ¸å¿ƒæœåŠ¡å‡åœ¨ä¸­é—´è¿™ä¸€å±‚ï¼ŒåŒ…æ‹¬æŸ¥è¯¢è§£æã€åˆ†æã€ä¼˜åŒ–ã€ç¼“å­˜ã€å†…ç½®å‡½æ•°(æ¯”å¦‚ï¼šæ—¶é—´ã€æ•°å­¦ã€åŠ å¯†ç­‰å‡½æ•°)ã€‚æ‰€æœ‰çš„è·¨å­˜å‚¨å¼•æ“çš„åŠŸèƒ½ä¹Ÿåœ¨è¿™ä¸€å±‚å®ç°ï¼šå­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨ã€è§†å›¾ç­‰ã€‚<br> æœ€ä¸‹å±‚ä¸ºå­˜å‚¨å¼•æ“ï¼Œå…¶è´Ÿè´£MySQLä¸­çš„æ•°æ®å­˜å‚¨å’Œæå–ã€‚å’ŒLinuxä¸‹çš„æ–‡ä»¶ç³»ç»Ÿç±»ä¼¼ï¼Œæ¯ç§å­˜å‚¨å¼•æ“éƒ½æœ‰å…¶ä¼˜åŠ¿å’ŒåŠ£åŠ¿ã€‚ä¸­é—´çš„æœåŠ¡å±‚é€šè¿‡APIä¸å­˜å‚¨å¼•æ“é€šä¿¡ï¼Œè¿™äº›APIæ¥å£å±è”½äº†ä¸åŒå­˜å‚¨å¼•æ“é—´çš„å·®å¼‚ã€‚</p><p><strong>MySQLæŸ¥è¯¢è¿‡ç¨‹</strong><br> æˆ‘ä»¬æ€»æ˜¯å¸Œæœ›MySQLèƒ½å¤Ÿè·å¾—æ›´é«˜çš„æŸ¥è¯¢æ€§èƒ½ï¼Œæœ€å¥½çš„åŠæ³•æ˜¯å¼„æ¸…æ¥šMySQLæ˜¯å¦‚ä½•ä¼˜åŒ–å’Œæ‰§è¡ŒæŸ¥è¯¢çš„ã€‚ä¸€æ—¦ç†è§£äº†è¿™ä¸€ç‚¹ï¼Œå°±ä¼šå‘ç°ï¼šå¾ˆå¤šçš„æŸ¥è¯¢ä¼˜åŒ–å·¥ä½œå®é™…ä¸Šå°±æ˜¯éµå¾ªä¸€äº›åŸåˆ™è®©MySQLçš„ä¼˜åŒ–å™¨èƒ½å¤ŸæŒ‰ç…§é¢„æƒ³çš„åˆç†æ–¹å¼è¿è¡Œè€Œå·²ã€‚<br> å½“å‘MySQLå‘é€ä¸€ä¸ªè¯·æ±‚çš„æ—¶å€™ï¼ŒMySQLåˆ°åº•åšäº†äº›ä»€ä¹ˆå‘¢ï¼Ÿ<br> <img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/01034bb2591f4e97b1c47cda4035f9af~tplv-k3u1fbpfcp-zoom-1.image" alt="img"><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/be0aa000e60b475fa5c4e50cbb8a3f9e~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p><strong>å®¢æˆ·ç«¯/æœåŠ¡ç«¯é€šä¿¡åè®®</strong><br> MySQLå®¢æˆ·ç«¯/æœåŠ¡ç«¯é€šä¿¡åè®®æ˜¯â€œåŠåŒå·¥â€çš„ï¼šåœ¨ä»»ä¸€æ—¶åˆ»ï¼Œè¦ä¹ˆæ˜¯æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ï¼Œè¦ä¹ˆæ˜¯å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€æ•°æ®ï¼Œè¿™ä¸¤ä¸ªåŠ¨ä½œä¸èƒ½åŒæ—¶å‘ç”Ÿã€‚</p><p>ä¸€æ—¦ä¸€ç«¯å¼€å§‹å‘é€æ¶ˆæ¯ï¼Œå¦ä¸€ç«¯è¦æ¥æ”¶å®Œæ•´ä¸ªæ¶ˆæ¯æ‰èƒ½å“åº”å®ƒï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•ä¹Ÿæ— é¡»å°†ä¸€ä¸ªæ¶ˆæ¯åˆ‡æˆå°å—ç‹¬ç«‹å‘é€ï¼Œä¹Ÿæ²¡æœ‰åŠæ³•è¿›è¡Œæµé‡æ§åˆ¶ã€‚</p><p>å®¢æˆ·ç«¯ç”¨ä¸€ä¸ªå•ç‹¬çš„æ•°æ®åŒ…å°†æŸ¥è¯¢è¯·æ±‚å‘é€ç»™æœåŠ¡å™¨ï¼Œæ‰€ä»¥å½“æŸ¥è¯¢è¯­å¥å¾ˆé•¿çš„æ—¶å€™ï¼Œéœ€è¦è®¾ç½®max_allowed_packetå‚æ•°ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæŸ¥è¯¢å®åœ¨æ˜¯å¤ªå¤§ï¼ŒæœåŠ¡ç«¯ä¼šæ‹’ç»æ¥æ”¶æ›´å¤šæ•°æ®å¹¶æŠ›å‡ºå¼‚å¸¸ã€‚</p><p>ä¸ä¹‹ç›¸åçš„æ˜¯ï¼ŒæœåŠ¡å™¨å“åº”ç»™ç”¨æˆ·çš„æ•°æ®é€šå¸¸ä¼šå¾ˆå¤šï¼Œç”±å¤šä¸ªæ•°æ®åŒ…ç»„æˆã€‚ä½†æ˜¯å½“æœåŠ¡å™¨å“åº”å®¢æˆ·ç«¯è¯·æ±‚æ—¶ï¼Œå®¢æˆ·ç«¯å¿…é¡»å®Œæ•´çš„æ¥æ”¶æ•´ä¸ªè¿”å›ç»“æœï¼Œè€Œä¸èƒ½ç®€å•çš„åªå–å‰é¢å‡ æ¡ç»“æœï¼Œç„¶åè®©æœåŠ¡å™¨åœæ­¢å‘é€ã€‚å› è€Œåœ¨å®é™…å¼€å‘ä¸­ï¼Œå°½é‡ä¿æŒæŸ¥è¯¢ç®€å•ä¸”åªè¿”å›å¿…éœ€çš„æ•°æ®ï¼Œå‡å°é€šä¿¡é—´æ•°æ®åŒ…çš„å¤§å°å’Œæ•°é‡æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„ä¹ æƒ¯ï¼Œè¿™ä¹Ÿæ˜¯æŸ¥è¯¢ä¸­å°½é‡é¿å…ä½¿ç”¨SELECT *ä»¥åŠåŠ ä¸ŠLIMITé™åˆ¶çš„åŸå› ä¹‹ä¸€ã€‚</p><p><strong>æŸ¥è¯¢ç¼“å­˜</strong><br> åœ¨è§£æä¸€ä¸ªæŸ¥è¯¢è¯­å¥å‰ï¼Œå¦‚æœæŸ¥è¯¢ç¼“å­˜æ˜¯æ‰“å¼€çš„ï¼Œé‚£ä¹ˆMySQLä¼šæ£€æŸ¥è¿™ä¸ªæŸ¥è¯¢è¯­å¥æ˜¯å¦å‘½ä¸­æŸ¥è¯¢ç¼“å­˜ä¸­çš„æ•°æ®ã€‚å¦‚æœå½“å‰æŸ¥è¯¢æ°å¥½å‘½ä¸­æŸ¥è¯¢ç¼“å­˜ï¼Œåœ¨æ£€æŸ¥ä¸€æ¬¡ç”¨æˆ·æƒé™åç›´æ¥è¿”å›ç¼“å­˜ä¸­çš„ç»“æœã€‚è¿™ç§æƒ…å†µä¸‹ï¼ŒæŸ¥è¯¢ä¸ä¼šè¢«è§£æï¼Œä¹Ÿä¸ä¼šç”Ÿæˆæ‰§è¡Œè®¡åˆ’ï¼Œæ›´ä¸ä¼šæ‰§è¡Œã€‚</p><p>MySQLå°†ç¼“å­˜å­˜æ”¾åœ¨ä¸€ä¸ªå¼•ç”¨è¡¨ï¼ˆä¸è¦ç†è§£æˆtableï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ç±»ä¼¼äºHashMapçš„æ•°æ®ç»“æ„ï¼‰ï¼Œé€šè¿‡ä¸€ä¸ªå“ˆå¸Œå€¼ç´¢å¼•ï¼Œè¿™ä¸ªå“ˆå¸Œå€¼é€šè¿‡æŸ¥è¯¢æœ¬èº«ã€å½“å‰è¦æŸ¥è¯¢çš„æ•°æ®åº“ã€å®¢æˆ·ç«¯åè®®ç‰ˆæœ¬å·ç­‰ä¸€äº›å¯èƒ½å½±å“ç»“æœçš„ä¿¡æ¯è®¡ç®—å¾—æ¥ã€‚æ‰€ä»¥ä¸¤ä¸ªæŸ¥è¯¢åœ¨ä»»ä½•å­—ç¬¦ä¸Šçš„ä¸åŒï¼ˆä¾‹å¦‚ï¼šç©ºæ ¼ã€æ³¨é‡Šï¼‰ï¼Œéƒ½ä¼šå¯¼è‡´ç¼“å­˜ä¸ä¼šå‘½ä¸­ã€‚</p><p>å¦‚æœæŸ¥è¯¢ä¸­åŒ…å«ä»»ä½•ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ã€å­˜å‚¨å‡½æ•°ã€ç”¨æˆ·å˜é‡ã€ä¸´æ—¶è¡¨ã€MySQLåº“ä¸­çš„ç³»ç»Ÿè¡¨ï¼Œå…¶æŸ¥è¯¢ç»“æœéƒ½ä¸ä¼šè¢«ç¼“å­˜ã€‚æ¯”å¦‚å‡½æ•°NOW()æˆ–è€…CURRENT_DATE()ä¼šå› ä¸ºä¸åŒçš„æŸ¥è¯¢æ—¶é—´ï¼Œè¿”å›ä¸åŒçš„æŸ¥è¯¢ç»“æœï¼Œå†æ¯”å¦‚åŒ…å«CURRENT_USERæˆ–è€…CONNECION_ID()çš„æŸ¥è¯¢è¯­å¥ä¼šå› ä¸ºä¸åŒçš„ç”¨æˆ·è€Œè¿”å›ä¸åŒçš„ç»“æœï¼Œå°†è¿™æ ·çš„æŸ¥è¯¢ç»“æœç¼“å­˜èµ·æ¥æ²¡æœ‰ä»»ä½•çš„æ„ä¹‰ã€‚</p><p>æ—¢ç„¶æ˜¯ç¼“å­˜ï¼Œå°±ä¼šå¤±æ•ˆï¼Œé‚£æŸ¥è¯¢ç¼“å­˜ä½•æ—¶å¤±æ•ˆå‘¢ï¼ŸMySQLçš„æŸ¥è¯¢ç¼“å­˜ç³»ç»Ÿä¼šè·Ÿè¸ªæŸ¥è¯¢ä¸­æ¶‰åŠçš„æ¯ä¸ªè¡¨ï¼Œå¦‚æœè¿™äº›è¡¨ï¼ˆæ•°æ®æˆ–ç»“æ„ï¼‰å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆå’Œè¿™å¼ è¡¨ç›¸å…³çš„æ‰€æœ‰ç¼“å­˜æ•°æ®éƒ½å°†å¤±æ•ˆã€‚</p><p>æ­£å› ä¸ºå¦‚æ­¤ï¼Œåœ¨ä»»ä½•çš„å†™æ“ä½œæ—¶ï¼ŒMySQLå¿…é¡»å°†å¯¹åº”è¡¨çš„æ‰€æœ‰ç¼“å­˜éƒ½è®¾ç½®ä¸ºå¤±æ•ˆã€‚å¦‚æœæŸ¥è¯¢ç¼“å­˜éå¸¸å¤§æˆ–è€…ç¢ç‰‡å¾ˆå¤šï¼Œè¿™ä¸ªæ“ä½œå°±å¯èƒ½å¸¦æ¥å¾ˆå¤§çš„ç³»ç»Ÿæ¶ˆè€—ï¼Œç”šè‡³å¯¼è‡´ç³»ç»Ÿåƒµæ­»ä¸€ä¼šå„¿ã€‚è€Œä¸”æŸ¥è¯¢ç¼“å­˜å¯¹ç³»ç»Ÿçš„é¢å¤–æ¶ˆè€—ä¹Ÿä¸ä»…ä»…åœ¨å†™æ“ä½œï¼Œè¯»æ“ä½œä¹Ÿä¸ä¾‹å¤–ï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> ä»»ä½•çš„æŸ¥è¯¢è¯­å¥åœ¨å¼€å§‹ä¹‹å‰éƒ½å¿…é¡»ç»è¿‡æ£€æŸ¥ï¼Œå³ä½¿è¿™æ¡SQLè¯­å¥æ°¸è¿œä¸ä¼šå‘½ä¸­ç¼“å­˜<br><span class="hljs-bullet">2.</span> å¦‚æœæŸ¥è¯¢ç»“æœå¯ä»¥è¢«ç¼“å­˜ï¼Œé‚£ä¹ˆæ‰§è¡Œå®Œæˆåï¼Œä¼šå°†ç»“æœå­˜å…¥ç¼“å­˜ï¼Œä¹Ÿä¼šå¸¦æ¥é¢å¤–çš„ç³»ç»Ÿæ¶ˆè€—<br></code></pre></td></tr></table></figure><p>åŸºäºæ­¤ï¼Œæˆ‘ä»¬è¦çŸ¥é“å¹¶ä¸æ˜¯ä»€ä¹ˆæƒ…å†µä¸‹æŸ¥è¯¢ç¼“å­˜éƒ½ä¼šæé«˜ç³»ç»Ÿæ€§èƒ½ï¼Œç¼“å­˜å’Œå¤±æ•ˆéƒ½ä¼šå¸¦æ¥é¢å¤–æ¶ˆè€—ï¼Œåªæœ‰å½“ç¼“å­˜å¸¦æ¥çš„èµ„æºèŠ‚çº¦å¤§äºå…¶æœ¬èº«æ¶ˆè€—çš„èµ„æºæ—¶ï¼Œæ‰ä¼šç»™ç³»ç»Ÿå¸¦æ¥æ€§èƒ½æå‡ã€‚ä½†è¦å¦‚ä½•è¯„ä¼°æ‰“å¼€ç¼“å­˜æ˜¯å¦èƒ½å¤Ÿå¸¦æ¥æ€§èƒ½æå‡æ˜¯ä¸€ä»¶éå¸¸å›°éš¾çš„äº‹æƒ…ï¼Œä¹Ÿä¸åœ¨æœ¬æ–‡è®¨è®ºçš„èŒƒç•´å†…ã€‚å¦‚æœç³»ç»Ÿç¡®å®å­˜åœ¨ä¸€äº›æ€§èƒ½é—®é¢˜ï¼Œå¯ä»¥å°è¯•æ‰“å¼€æŸ¥è¯¢ç¼“å­˜ï¼Œå¹¶åœ¨æ•°æ®åº“è®¾è®¡ä¸Šåšä¸€äº›ä¼˜åŒ–ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> ç”¨å¤šä¸ªå°è¡¨ä»£æ›¿ä¸€ä¸ªå¤§è¡¨ï¼Œæ³¨æ„ä¸è¦è¿‡åº¦è®¾è®¡<br><span class="hljs-bullet">2.</span> æ‰¹é‡æ’å…¥ä»£æ›¿å¾ªç¯å•æ¡æ’å…¥<br><span class="hljs-bullet">3.</span> åˆç†æ§åˆ¶ç¼“å­˜ç©ºé—´å¤§å°ï¼Œä¸€èˆ¬æ¥è¯´å…¶å¤§å°è®¾ç½®ä¸ºå‡ åå…†æ¯”è¾ƒåˆé€‚<br><span class="hljs-bullet">4.</span> å¯ä»¥é€šè¿‡SQL<span class="hljs-emphasis">_CACHEå’ŒSQL_</span>NO<span class="hljs-emphasis">_CACHEæ¥æ§åˆ¶æŸä¸ªæŸ¥è¯¢è¯­å¥æ˜¯å¦éœ€è¦è¿›è¡Œç¼“å­˜</span><br></code></pre></td></tr></table></figure><p>æœ€åçš„å¿ å‘Šæ˜¯ä¸è¦è½»æ˜“æ‰“å¼€æŸ¥è¯¢ç¼“å­˜ï¼Œç‰¹åˆ«æ˜¯å†™å¯†é›†å‹åº”ç”¨ã€‚å¦‚æœä½ å®åœ¨æ˜¯å¿ä¸ä½ï¼Œå¯ä»¥å°†query_cache_typeè®¾ç½®ä¸ºDEMANDï¼Œè¿™æ—¶åªæœ‰åŠ å…¥SQL_CACHEçš„æŸ¥è¯¢æ‰ä¼šèµ°ç¼“å­˜ï¼Œå…¶ä»–æŸ¥è¯¢åˆ™ä¸ä¼šï¼Œè¿™æ ·å¯ä»¥éå¸¸è‡ªç”±åœ°æ§åˆ¶å“ªäº›æŸ¥è¯¢éœ€è¦è¢«ç¼“å­˜ã€‚</p><p>å½“ç„¶æŸ¥è¯¢ç¼“å­˜ç³»ç»Ÿæœ¬èº«æ˜¯éå¸¸å¤æ‚çš„ï¼Œè¿™é‡Œè®¨è®ºçš„ä¹Ÿåªæ˜¯å¾ˆå°çš„ä¸€éƒ¨åˆ†ï¼Œå…¶ä»–æ›´æ·±å…¥çš„è¯é¢˜ï¼Œæ¯”å¦‚ï¼šç¼“å­˜æ˜¯å¦‚ä½•ä½¿ç”¨å†…å­˜çš„ï¼Ÿå¦‚ä½•æ§åˆ¶å†…å­˜çš„ç¢ç‰‡åŒ–ï¼Ÿäº‹åŠ¡å¯¹æŸ¥è¯¢ç¼“å­˜æœ‰ä½•å½±å“ç­‰ç­‰ï¼Œè¯»è€…å¯ä»¥è‡ªè¡Œé˜…è¯»ç›¸å…³èµ„æ–™ï¼Œè¿™é‡Œæƒå½“æŠ›ç –å¼•ç‰å§ã€‚</p><p><strong>è¯­æ³•è§£æå’Œé¢„å¤„ç†</strong><br> MySQLé€šè¿‡å…³é”®å­—å°†SQLè¯­å¥è¿›è¡Œè§£æï¼Œå¹¶ç”Ÿæˆä¸€é¢—å¯¹åº”çš„è§£ææ ‘ã€‚è¿™ä¸ªè¿‡ç¨‹è§£æå™¨ä¸»è¦é€šè¿‡è¯­æ³•è§„åˆ™æ¥éªŒè¯å’Œè§£æã€‚æ¯”å¦‚SQLä¸­æ˜¯å¦ä½¿ç”¨äº†é”™è¯¯çš„å…³é”®å­—æˆ–è€…å…³é”®å­—çš„é¡ºåºæ˜¯å¦æ­£ç¡®ç­‰ç­‰ã€‚é¢„å¤„ç†åˆ™ä¼šæ ¹æ®MySQLè§„åˆ™è¿›ä¸€æ­¥æ£€æŸ¥è§£ææ ‘æ˜¯å¦åˆæ³•ã€‚æ¯”å¦‚æ£€æŸ¥è¦æŸ¥è¯¢çš„æ•°æ®è¡¨å’Œæ•°æ®åˆ—æ˜¯å¦å­˜åœ¨ç­‰ã€‚</p><p><strong>æŸ¥è¯¢ä¼˜åŒ–</strong><br> ç»è¿‡å‰é¢çš„æ­¥éª¤ç”Ÿæˆçš„è¯­æ³•æ ‘è¢«è®¤ä¸ºæ˜¯åˆæ³•çš„äº†ï¼Œå¹¶ä¸”ç”±ä¼˜åŒ–å™¨å°†å…¶è½¬åŒ–æˆæŸ¥è¯¢è®¡åˆ’ã€‚å¤šæ•°æƒ…å†µä¸‹ï¼Œä¸€æ¡æŸ¥è¯¢å¯ä»¥æœ‰å¾ˆå¤šç§æ‰§è¡Œæ–¹å¼ï¼Œæœ€åéƒ½è¿”å›ç›¸åº”çš„ç»“æœã€‚ä¼˜åŒ–å™¨çš„ä½œç”¨å°±æ˜¯æ‰¾åˆ°è¿™å…¶ä¸­æœ€å¥½çš„æ‰§è¡Œè®¡åˆ’ã€‚</p><p>MySQLä½¿ç”¨åŸºäºæˆæœ¬çš„ä¼˜åŒ–å™¨ï¼Œå®ƒå°è¯•é¢„æµ‹ä¸€ä¸ªæŸ¥è¯¢ä½¿ç”¨æŸç§æ‰§è¡Œè®¡åˆ’æ—¶çš„æˆæœ¬ï¼Œå¹¶é€‰æ‹©å…¶ä¸­æˆæœ¬æœ€å°çš„ä¸€ä¸ªã€‚åœ¨MySQLå¯ä»¥é€šè¿‡æŸ¥è¯¢å½“å‰ä¼šè¯çš„last_query_costçš„å€¼æ¥å¾—åˆ°å…¶è®¡ç®—å½“å‰æŸ¥è¯¢çš„æˆæœ¬ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t_message limit <span class="hljs-number">10</span>;<br><br>...çœç•¥ç»“æœé›†<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> status <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;last_query_cost&#x27;</span>;<br><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+-------------+</span><br><br><span class="hljs-operator">|</span> Variable_name   <span class="hljs-operator">|</span> <span class="hljs-keyword">Value</span>       <span class="hljs-operator">|</span><br><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+-------------+</span><br><br><span class="hljs-operator">|</span> Last_query_cost <span class="hljs-operator">|</span> <span class="hljs-number">6391.799000</span> <span class="hljs-operator">|</span><br><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+-------------+</span><br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹ä¸­çš„ç»“æœè¡¨ç¤ºä¼˜åŒ–å™¨è®¤ä¸ºå¤§æ¦‚éœ€è¦åš6391ä¸ªæ•°æ®é¡µçš„éšæœºæŸ¥æ‰¾æ‰èƒ½å®Œæˆä¸Šé¢çš„æŸ¥è¯¢ã€‚è¿™ä¸ªç»“æœæ˜¯æ ¹æ®ä¸€äº›åˆ—çš„ç»Ÿè®¡ä¿¡æ¯è®¡ç®—å¾—æ¥çš„ï¼Œè¿™äº›ç»Ÿè®¡ä¿¡æ¯åŒ…æ‹¬ï¼šæ¯å¼ è¡¨æˆ–è€…ç´¢å¼•çš„é¡µé¢ä¸ªæ•°ã€ç´¢å¼•çš„åŸºæ•°ã€ç´¢å¼•å’Œæ•°æ®è¡Œçš„é•¿åº¦ã€ç´¢å¼•çš„åˆ†å¸ƒæƒ…å†µç­‰ç­‰ã€‚</p><p>æœ‰éå¸¸å¤šçš„åŸå› ä¼šå¯¼è‡´MySQLé€‰æ‹©é”™è¯¯çš„æ‰§è¡Œè®¡åˆ’ï¼Œæ¯”å¦‚ç»Ÿè®¡ä¿¡æ¯ä¸å‡†ç¡®ã€ä¸ä¼šè€ƒè™‘ä¸å—å…¶æ§åˆ¶çš„æ“ä½œæˆæœ¬ï¼ˆç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ã€å­˜å‚¨è¿‡ç¨‹ï¼‰ã€MySQLè®¤ä¸ºçš„æœ€ä¼˜è·Ÿæˆ‘ä»¬æƒ³çš„ä¸ä¸€æ ·ï¼ˆæˆ‘ä»¬å¸Œæœ›æ‰§è¡Œæ—¶é—´å°½å¯èƒ½çŸ­ï¼Œä½†MySQLå€¼é€‰æ‹©å®ƒè®¤ä¸ºæˆæœ¬å°çš„ï¼Œä½†æˆæœ¬å°å¹¶ä¸æ„å‘³ç€æ‰§è¡Œæ—¶é—´çŸ­ï¼‰ç­‰ç­‰ã€‚</p><p>MySQLçš„æŸ¥è¯¢ä¼˜åŒ–å™¨æ˜¯ä¸€ä¸ªéå¸¸å¤æ‚çš„éƒ¨ä»¶ï¼Œå®ƒä½¿ç”¨äº†éå¸¸å¤šçš„ä¼˜åŒ–ç­–ç•¥æ¥ç”Ÿæˆä¸€ä¸ªæœ€ä¼˜çš„æ‰§è¡Œè®¡åˆ’ï¼š<br> é‡æ–°å®šä¹‰è¡¨çš„å…³è”é¡ºåºï¼ˆå¤šå¼ è¡¨å…³è”æŸ¥è¯¢æ—¶ï¼Œå¹¶ä¸ä¸€å®šæŒ‰ç…§SQLä¸­æŒ‡å®šçš„é¡ºåºè¿›è¡Œï¼Œä½†æœ‰ä¸€äº›æŠ€å·§å¯ä»¥æŒ‡å®šå…³è”é¡ºåºï¼‰</p><p>ä¼˜åŒ–MIN()å’ŒMAX()å‡½æ•°ï¼ˆæ‰¾æŸåˆ—çš„æœ€å°å€¼ï¼Œå¦‚æœè¯¥åˆ—æœ‰ç´¢å¼•ï¼Œåªéœ€è¦æŸ¥æ‰¾B+Treeç´¢å¼•æœ€å·¦ç«¯ï¼Œåä¹‹åˆ™å¯ä»¥æ‰¾åˆ°æœ€å¤§å€¼ï¼Œå…·ä½“åŸç†è§ä¸‹æ–‡ï¼‰</p><p>æå‰ç»ˆæ­¢æŸ¥è¯¢ï¼ˆæ¯”å¦‚ï¼šä½¿ç”¨Limitæ—¶ï¼ŒæŸ¥æ‰¾åˆ°æ»¡è¶³æ•°é‡çš„ç»“æœé›†åä¼šç«‹å³ç»ˆæ­¢æŸ¥è¯¢ï¼‰</p><p>ä¼˜åŒ–æ’åºï¼ˆåœ¨è€ç‰ˆæœ¬MySQLä¼šä½¿ç”¨ä¸¤æ¬¡ä¼ è¾“æ’åºï¼Œå³å…ˆè¯»å–è¡ŒæŒ‡é’ˆå’Œéœ€è¦æ’åºçš„å­—æ®µåœ¨å†…å­˜ä¸­å¯¹å…¶æ’åºï¼Œç„¶åå†æ ¹æ®æ’åºç»“æœå»è¯»å–æ•°æ®è¡Œï¼Œè€Œæ–°ç‰ˆæœ¬é‡‡ç”¨çš„æ˜¯å•æ¬¡ä¼ è¾“æ’åºï¼Œä¹Ÿå°±æ˜¯ä¸€æ¬¡è¯»å–æ‰€æœ‰çš„æ•°æ®è¡Œï¼Œç„¶åæ ¹æ®ç»™å®šçš„åˆ—æ’åºã€‚å¯¹äºI/Oå¯†é›†å‹åº”ç”¨ï¼Œæ•ˆç‡ä¼šé«˜å¾ˆå¤šï¼‰</p><p>éšç€MySQLçš„ä¸æ–­å‘å±•ï¼Œä¼˜åŒ–å™¨ä½¿ç”¨çš„ä¼˜åŒ–ç­–ç•¥ä¹Ÿåœ¨ä¸æ–­çš„è¿›åŒ–ï¼Œè¿™é‡Œä»…ä»…ä»‹ç»å‡ ä¸ªéå¸¸å¸¸ç”¨ä¸”å®¹æ˜“ç†è§£çš„ä¼˜åŒ–ç­–ç•¥ï¼Œå…¶ä»–çš„ä¼˜åŒ–ç­–ç•¥ï¼Œå¤§å®¶è‡ªè¡ŒæŸ¥é˜…å§ã€‚</p><p><strong>æŸ¥è¯¢æ‰§è¡Œå¼•æ“</strong><br> åœ¨å®Œæˆè§£æå’Œä¼˜åŒ–é˜¶æ®µä»¥åï¼ŒMySQLä¼šç”Ÿæˆå¯¹åº”çš„æ‰§è¡Œè®¡åˆ’ï¼ŒæŸ¥è¯¢æ‰§è¡Œå¼•æ“æ ¹æ®æ‰§è¡Œè®¡åˆ’ç»™å‡ºçš„æŒ‡ä»¤é€æ­¥æ‰§è¡Œå¾—å‡ºç»“æœã€‚æ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹çš„å¤§éƒ¨åˆ†æ“ä½œå‡æ˜¯é€šè¿‡è°ƒç”¨å­˜å‚¨å¼•æ“å®ç°çš„æ¥å£æ¥å®Œæˆï¼Œè¿™äº›æ¥å£è¢«ç§°ä¸ºhandler APIã€‚æŸ¥è¯¢è¿‡ç¨‹ä¸­çš„æ¯ä¸€å¼ è¡¨ç”±ä¸€ä¸ªhandlerå®ä¾‹è¡¨ç¤ºã€‚</p><p>å®é™…ä¸Šï¼ŒMySQLåœ¨æŸ¥è¯¢ä¼˜åŒ–é˜¶æ®µå°±ä¸ºæ¯ä¸€å¼ è¡¨åˆ›å»ºäº†ä¸€ä¸ªhandlerå®ä¾‹ï¼Œä¼˜åŒ–å™¨å¯ä»¥æ ¹æ®è¿™äº›å®ä¾‹çš„æ¥å£æ¥è·å–è¡¨çš„ç›¸å…³ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¡¨çš„æ‰€æœ‰åˆ—åã€ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯ç­‰ã€‚å­˜å‚¨å¼•æ“æ¥å£æä¾›äº†éå¸¸ä¸°å¯Œçš„åŠŸèƒ½ï¼Œä½†å…¶åº•å±‚ä»…æœ‰å‡ åä¸ªæ¥å£ï¼Œè¿™äº›æ¥å£åƒæ­ç§¯æœ¨ä¸€æ ·å®Œæˆäº†ä¸€æ¬¡æŸ¥è¯¢çš„å¤§éƒ¨åˆ†æ“ä½œã€‚</p><p><strong>è¿”å›ç»“æœç»™å®¢æˆ·ç«¯</strong><br> æŸ¥è¯¢æ‰§è¡Œçš„æœ€åä¸€ä¸ªé˜¶æ®µå°±æ˜¯å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚å³ä½¿æŸ¥è¯¢ä¸åˆ°æ•°æ®ï¼ŒMySQLä»ç„¶ä¼šè¿”å›è¿™ä¸ªæŸ¥è¯¢çš„ç›¸å…³ä¿¡æ¯ï¼Œæ¯”å¦‚è¯¥æŸ¥è¯¢å½±å“åˆ°çš„è¡Œæ•°ä»¥åŠæ‰§è¡Œæ—¶é—´ç­‰ã€‚</p><p>å¦‚æœæŸ¥è¯¢ç¼“å­˜è¢«æ‰“å¼€ä¸”è¿™ä¸ªæŸ¥è¯¢å¯ä»¥è¢«ç¼“å­˜ï¼ŒMySQLä¹Ÿä¼šå°†ç»“æœå­˜æ”¾åˆ°ç¼“å­˜ä¸­ã€‚<br> ç»“æœé›†è¿”å›å®¢æˆ·ç«¯æ˜¯ä¸€ä¸ªå¢é‡ä¸”é€æ­¥è¿”å›çš„è¿‡ç¨‹ã€‚æœ‰å¯èƒ½MySQLåœ¨ç”Ÿæˆç¬¬ä¸€æ¡ç»“æœæ—¶ï¼Œå°±å¼€å§‹å‘å®¢æˆ·ç«¯é€æ­¥è¿”å›ç»“æœé›†äº†ã€‚è¿™æ ·æœåŠ¡ç«¯å°±æ— é¡»å­˜å‚¨å¤ªå¤šç»“æœè€Œæ¶ˆè€—è¿‡å¤šå†…å­˜ï¼Œä¹Ÿå¯ä»¥è®©å®¢æˆ·ç«¯ç¬¬ä¸€æ—¶é—´è·å¾—è¿”å›ç»“æœã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç»“æœé›†ä¸­çš„æ¯ä¸€è¡Œéƒ½ä¼šä»¥ä¸€ä¸ªæ»¡è¶³â‘ ä¸­æ‰€æè¿°çš„é€šä¿¡åè®®çš„æ•°æ®åŒ…å‘é€ï¼Œå†é€šè¿‡TCPåè®®è¿›è¡Œä¼ è¾“ï¼Œåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½å¯¹MySQLçš„æ•°æ®åŒ…è¿›è¡Œç¼“å­˜ç„¶åæ‰¹é‡å‘é€ã€‚</p><p>å›å¤´æ€»ç»“ä¸€ä¸‹MySQLæ•´ä¸ªæŸ¥è¯¢æ‰§è¡Œè¿‡ç¨‹ï¼Œæ€»çš„æ¥è¯´åˆ†ä¸º6ä¸ªæ­¥éª¤ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">å®¢æˆ·ç«¯å‘MySQLæœåŠ¡å™¨å‘é€ä¸€æ¡æŸ¥è¯¢è¯·æ±‚<br>æœåŠ¡å™¨é¦–å…ˆæ£€æŸ¥æŸ¥è¯¢ç¼“å­˜ï¼Œå¦‚æœå‘½ä¸­ç¼“å­˜ï¼Œåˆ™ç«‹åˆ»è¿”å›å­˜å‚¨åœ¨ç¼“å­˜ä¸­çš„ç»“æœã€‚å¦åˆ™è¿›å…¥ä¸‹ä¸€é˜¶æ®µ<br>æœåŠ¡å™¨è¿›è¡Œ<span class="hljs-keyword">SQL</span>è§£æã€é¢„å¤„ç†ã€å†ç”±ä¼˜åŒ–å™¨ç”Ÿæˆå¯¹åº”çš„æ‰§è¡Œè®¡åˆ’<br>MySQLæ ¹æ®æ‰§è¡Œè®¡åˆ’ï¼Œè°ƒç”¨å­˜å‚¨å¼•æ“çš„APIæ¥æ‰§è¡ŒæŸ¥è¯¢<br>å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼ŒåŒæ—¶ç¼“å­˜æŸ¥è¯¢ç»“æœ<br></code></pre></td></tr></table></figure><p><strong>æ€§èƒ½ä¼˜åŒ–å»ºè®®</strong><br> çœ‹äº†è¿™ä¹ˆå¤šï¼Œä½ å¯èƒ½ä¼šæœŸå¾…ç»™å‡ºä¸€äº›ä¼˜åŒ–æ‰‹æ®µï¼Œæ˜¯çš„ï¼Œä¸‹é¢ä¼šä»3ä¸ªä¸åŒæ–¹é¢ç»™å‡ºä¸€äº›ä¼˜åŒ–å»ºè®®ã€‚ä½†è¯·ç­‰ç­‰ï¼Œè¿˜æœ‰ä¸€å¥å¿ å‘Šè¦å…ˆé€ç»™ä½ ï¼šä¸è¦å¬ä¿¡ä½ çœ‹åˆ°çš„å…³äºä¼˜åŒ–çš„â€œç»å¯¹çœŸç†â€ï¼ŒåŒ…æ‹¬æœ¬æ–‡æ‰€è®¨è®ºçš„å†…å®¹ï¼Œè€Œåº”è¯¥æ˜¯åœ¨å®é™…çš„ä¸šåŠ¡åœºæ™¯ä¸‹é€šè¿‡æµ‹è¯•æ¥éªŒè¯ä½ å…³äºæ‰§è¡Œè®¡åˆ’ä»¥åŠå“åº”æ—¶é—´çš„å‡è®¾ã€‚</p><p><strong>1ã€Schemeè®¾è®¡ä¸æ•°æ®ç±»å‹ä¼˜åŒ–</strong><br> é€‰æ‹©æ•°æ®ç±»å‹åªè¦éµå¾ªå°è€Œç®€å•çš„åŸåˆ™å°±å¥½ï¼Œè¶Šå°çš„æ•°æ®ç±»å‹é€šå¸¸ä¼šæ›´å¿«ï¼Œå ç”¨æ›´å°‘çš„ç£ç›˜ã€å†…å­˜ï¼Œå¤„ç†æ—¶éœ€è¦çš„CPUå‘¨æœŸä¹Ÿæ›´å°‘ã€‚è¶Šç®€å•çš„æ•°æ®ç±»å‹åœ¨è®¡ç®—æ—¶éœ€è¦æ›´å°‘çš„CPUå‘¨æœŸï¼Œæ¯”å¦‚ï¼Œæ•´å‹å°±æ¯”å­—ç¬¦æ“ä½œä»£ä»·ä½ï¼Œå› è€Œä¼šä½¿ç”¨æ•´å‹æ¥å­˜å‚¨ipåœ°å€ï¼Œä½¿ç”¨DATETIMEæ¥å­˜å‚¨æ—¶é—´ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å­—ç¬¦ä¸²ã€‚<br> è¿™é‡Œæ€»ç»“å‡ ä¸ªå¯èƒ½å®¹æ˜“ç†è§£é”™è¯¯çš„æŠ€å·§ï¼š</p><ol><li>é€šå¸¸æ¥è¯´æŠŠå¯ä¸ºNULLçš„åˆ—æ”¹ä¸ºNOT NULLä¸ä¼šå¯¹æ€§èƒ½æå‡æœ‰å¤šå°‘å¸®åŠ©ï¼Œåªæ˜¯å¦‚æœè®¡åˆ’åœ¨åˆ—ä¸Šåˆ›å»ºç´¢å¼•ï¼Œå°±åº”è¯¥å°†è¯¥åˆ—è®¾ç½®ä¸ºNOT NULLã€‚</li><li>å¯¹æ•´æ•°ç±»å‹æŒ‡å®šå®½åº¦ï¼Œæ¯”å¦‚INT(11)ï¼Œæ²¡æœ‰ä»»ä½•åµç”¨ã€‚INTä½¿ç”¨32ä½ï¼ˆ4ä¸ªå­—èŠ‚ï¼‰å­˜å‚¨ç©ºé—´ï¼Œé‚£ä¹ˆå®ƒçš„è¡¨ç¤ºèŒƒå›´å·²ç»ç¡®å®šï¼Œæ‰€ä»¥INT(1)å’ŒINT(20)å¯¹äºå­˜å‚¨å’Œè®¡ç®—æ˜¯ç›¸åŒçš„ã€‚</li><li>UNSIGNEDè¡¨ç¤ºä¸å…è®¸è´Ÿå€¼ï¼Œå¤§è‡´å¯ä»¥ä½¿æ­£æ•°çš„ä¸Šé™æé«˜ä¸€å€ã€‚æ¯”å¦‚TINYINTå­˜å‚¨èŒƒå›´æ˜¯-128 ~ 127ï¼Œè€ŒUNSIGNED TINYINTå­˜å‚¨çš„èŒƒå›´å´æ˜¯0 - 255ã€‚</li><li>é€šå¸¸æ¥è®²ï¼Œæ²¡æœ‰å¤ªå¤§çš„å¿…è¦ä½¿ç”¨DECIMALæ•°æ®ç±»å‹ã€‚å³ä½¿æ˜¯åœ¨éœ€è¦å­˜å‚¨è´¢åŠ¡æ•°æ®æ—¶ï¼Œä»ç„¶å¯ä»¥ä½¿ç”¨BIGINTã€‚æ¯”å¦‚éœ€è¦ç²¾ç¡®åˆ°ä¸‡åˆ†ä¹‹ä¸€ï¼Œé‚£ä¹ˆå¯ä»¥å°†æ•°æ®ä¹˜ä»¥ä¸€ç™¾ä¸‡ç„¶åä½¿ç”¨BIGINTå­˜å‚¨ã€‚è¿™æ ·å¯ä»¥é¿å…æµ®ç‚¹æ•°è®¡ç®—ä¸å‡†ç¡®å’ŒDECIMALç²¾ç¡®è®¡ç®—ä»£ä»·é«˜çš„é—®é¢˜ã€‚</li><li>TIMESTAMPä½¿ç”¨4ä¸ªå­—èŠ‚å­˜å‚¨ç©ºé—´ï¼ŒDATETIMEä½¿ç”¨8ä¸ªå­—èŠ‚å­˜å‚¨ç©ºé—´ã€‚å› è€Œï¼ŒTIMESTAMPåªèƒ½è¡¨ç¤º1970 - 2038å¹´ï¼Œæ¯”DATETIMEè¡¨ç¤ºçš„èŒƒå›´å°å¾—å¤šï¼Œè€Œä¸”TIMESTAMPçš„å€¼å› æ—¶åŒºä¸åŒè€Œä¸åŒã€‚</li><li>å¤§å¤šæ•°æƒ…å†µä¸‹æ²¡æœ‰ä½¿ç”¨æšä¸¾ç±»å‹çš„å¿…è¦ï¼Œå…¶ä¸­ä¸€ä¸ªç¼ºç‚¹æ˜¯æšä¸¾çš„å­—ç¬¦ä¸²åˆ—è¡¨æ˜¯å›ºå®šçš„ï¼Œæ·»åŠ å’Œåˆ é™¤å­—ç¬¦ä¸²ï¼ˆæšä¸¾é€‰é¡¹ï¼‰å¿…é¡»ä½¿ç”¨ALTER TABLEï¼ˆå¦‚æœåªåªæ˜¯åœ¨åˆ—è¡¨æœ«å°¾è¿½åŠ å…ƒç´ ï¼Œä¸éœ€è¦é‡å»ºè¡¨ï¼‰ã€‚</li><li>schemaçš„åˆ—ä¸è¦å¤ªå¤šã€‚åŸå› æ˜¯å­˜å‚¨å¼•æ“çš„APIå·¥ä½œæ—¶éœ€è¦åœ¨æœåŠ¡å™¨å±‚å’Œå­˜å‚¨å¼•æ“å±‚ä¹‹é—´é€šè¿‡è¡Œç¼“å†²æ ¼å¼æ‹·è´æ•°æ®ï¼Œç„¶ååœ¨æœåŠ¡å™¨å±‚å°†ç¼“å†²å†…å®¹è§£ç æˆå„ä¸ªåˆ—ï¼Œè¿™ä¸ªè½¬æ¢è¿‡ç¨‹çš„ä»£ä»·æ˜¯éå¸¸é«˜çš„ã€‚å¦‚æœåˆ—å¤ªå¤šè€Œå®é™…ä½¿ç”¨çš„åˆ—åˆå¾ˆå°‘çš„è¯ï¼Œæœ‰å¯èƒ½ä¼šå¯¼è‡´CPUå ç”¨è¿‡é«˜ã€‚</li><li>å¤§è¡¨ALTER TABLEéå¸¸è€—æ—¶ï¼ŒMySQLæ‰§è¡Œå¤§éƒ¨åˆ†ä¿®æ”¹è¡¨ç»“æœæ“ä½œçš„æ–¹æ³•æ˜¯ç”¨æ–°çš„ç»“æ„åˆ›å»ºä¸€ä¸ªå¼ ç©ºè¡¨ï¼Œä»æ—§è¡¨ä¸­æŸ¥å‡ºæ‰€æœ‰çš„æ•°æ®æ’å…¥æ–°è¡¨ï¼Œç„¶åå†åˆ é™¤æ—§è¡¨ã€‚å°¤å…¶å½“å†…å­˜ä¸è¶³è€Œè¡¨åˆå¾ˆå¤§ï¼Œè€Œä¸”è¿˜æœ‰å¾ˆå¤§ç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œè€—æ—¶æ›´ä¹…ã€‚å½“ç„¶æœ‰ä¸€äº›å¥‡æŠ€æ·«å·§å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæœ‰å…´è¶£å¯è‡ªè¡ŒæŸ¥é˜…ã€‚</li></ol><p><strong>2ã€åˆ›å»ºé«˜æ€§èƒ½ç´¢å¼•</strong><br> ç´¢å¼•æ˜¯æé«˜MySQLæŸ¥è¯¢æ€§èƒ½çš„ä¸€ä¸ªé‡è¦é€”å¾„ï¼Œä½†è¿‡å¤šçš„ç´¢å¼•å¯èƒ½ä¼šå¯¼è‡´è¿‡é«˜çš„ç£ç›˜ä½¿ç”¨ç‡ä»¥åŠè¿‡é«˜çš„å†…å­˜å ç”¨ï¼Œä»è€Œå½±å“åº”ç”¨ç¨‹åºçš„æ•´ä½“æ€§èƒ½ã€‚åº”å½“å°½é‡é¿å…äº‹åæ‰æƒ³èµ·æ·»åŠ ç´¢å¼•ï¼Œå› ä¸ºäº‹åå¯èƒ½éœ€è¦ç›‘æ§å¤§é‡çš„SQLæ‰èƒ½å®šä½åˆ°é—®é¢˜æ‰€åœ¨ï¼Œè€Œä¸”æ·»åŠ ç´¢å¼•çš„æ—¶é—´è‚¯å®šæ˜¯è¿œå¤§äºåˆå§‹æ·»åŠ ç´¢å¼•æ‰€éœ€è¦çš„æ—¶é—´ï¼Œå¯è§ç´¢å¼•çš„æ·»åŠ ä¹Ÿæ˜¯éå¸¸æœ‰æŠ€æœ¯å«é‡çš„ã€‚</p><p>æ¥ä¸‹æ¥å°†å‘ä½ å±•ç¤ºä¸€ç³»åˆ—åˆ›å»ºé«˜æ€§èƒ½ç´¢å¼•çš„ç­–ç•¥ï¼Œä»¥åŠæ¯æ¡ç­–ç•¥å…¶èƒŒåçš„å·¥ä½œåŸç†ã€‚ä½†åœ¨æ­¤ä¹‹å‰ï¼Œå…ˆäº†è§£ä¸ç´¢å¼•ç›¸å…³çš„ä¸€äº›ç®—æ³•å’Œæ•°æ®ç»“æ„ï¼Œå°†æœ‰åŠ©äºæ›´å¥½çš„ç†è§£åæ–‡çš„å†…å®¹ã€‚</p><p><strong>3ã€ç´¢å¼•ç›¸å…³çš„æ•°æ®ç»“æ„å’Œç®—æ³•</strong><br> é€šå¸¸æˆ‘ä»¬æ‰€è¯´çš„ç´¢å¼•æ˜¯æŒ‡B-Treeç´¢å¼•ï¼Œå®ƒæ˜¯ç›®å‰å…³ç³»å‹æ•°æ®åº“ä¸­æŸ¥æ‰¾æ•°æ®æœ€ä¸ºå¸¸ç”¨å’Œæœ‰æ•ˆçš„ç´¢å¼•ï¼Œå¤§å¤šæ•°å­˜å‚¨å¼•æ“éƒ½æ”¯æŒè¿™ç§ç´¢å¼•ã€‚ä½¿ç”¨B-Treeè¿™ä¸ªæœ¯è¯­ï¼Œæ˜¯å› ä¸ºMySQLåœ¨CREATE TABLEæˆ–å…¶å®ƒè¯­å¥ä¸­ä½¿ç”¨äº†è¿™ä¸ªå…³é”®å­—ï¼Œä½†å®é™…ä¸Šä¸åŒçš„å­˜å‚¨å¼•æ“å¯èƒ½ä½¿ç”¨ä¸åŒçš„æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚InnoDBå°±æ˜¯ä½¿ç”¨çš„B+Treeã€‚</p><p>B+Treeä¸­çš„Bæ˜¯æŒ‡balanceï¼Œæ„ä¸ºå¹³è¡¡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒB+æ ‘ç´¢å¼•å¹¶ä¸èƒ½æ‰¾åˆ°ä¸€ä¸ªç»™å®šé”®å€¼çš„å…·ä½“è¡Œï¼Œå®ƒæ‰¾åˆ°çš„åªæ˜¯è¢«æŸ¥æ‰¾æ•°æ®è¡Œæ‰€åœ¨çš„é¡µï¼Œæ¥ç€æ•°æ®åº“ä¼šæŠŠé¡µè¯»å…¥åˆ°å†…å­˜ï¼Œå†åœ¨å†…å­˜ä¸­è¿›è¡ŒæŸ¥æ‰¾ï¼Œæœ€åå¾—åˆ°è¦æŸ¥æ‰¾çš„æ•°æ®ã€‚</p><p>åœ¨ä»‹ç»B+Treeå‰ï¼Œå…ˆäº†è§£ä¸€ä¸‹äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œå®ƒæ˜¯ä¸€ç§ç»å…¸çš„æ•°æ®ç»“æ„ï¼Œå…¶å·¦å­æ ‘çš„å€¼æ€»æ˜¯å°äºæ ¹çš„å€¼ï¼Œå³å­æ ‘çš„å€¼æ€»æ˜¯å¤§äºæ ¹çš„å€¼ï¼Œå¦‚ä¸‹å›¾â‘ ã€‚å¦‚æœè¦åœ¨è¿™è¯¾æ ‘ä¸­æŸ¥æ‰¾å€¼ä¸º5çš„è®°å½•ï¼Œå…¶å¤§è‡´æµç¨‹ï¼šå…ˆæ‰¾åˆ°æ ¹ï¼Œå…¶å€¼ä¸º6ï¼Œå¤§äº5ï¼Œæ‰€ä»¥æŸ¥æ‰¾å·¦å­æ ‘ï¼Œæ‰¾åˆ°3ï¼Œè€Œ5å¤§äº3ï¼Œæ¥ç€æ‰¾3çš„å³å­æ ‘ï¼Œæ€»å…±æ‰¾äº†3æ¬¡ã€‚åŒæ ·çš„æ–¹æ³•ï¼Œå¦‚æœæŸ¥æ‰¾å€¼ä¸º8çš„è®°å½•ï¼Œä¹Ÿéœ€è¦æŸ¥æ‰¾3æ¬¡ã€‚</p><p>æ‰€ä»¥äºŒå‰æŸ¥æ‰¾æ ‘çš„å¹³å‡æŸ¥æ‰¾æ¬¡æ•°ä¸º(3 + 3 + 3 + 2 + 2 + 1) / 6 = 2.3æ¬¡ï¼Œè€Œé¡ºåºæŸ¥æ‰¾çš„è¯ï¼ŒæŸ¥æ‰¾å€¼ä¸º2çš„è®°å½•ï¼Œä»…éœ€è¦1æ¬¡ï¼Œä½†æŸ¥æ‰¾å€¼ä¸º8çš„è®°å½•åˆ™éœ€è¦6æ¬¡ï¼Œæ‰€ä»¥é¡ºåºæŸ¥æ‰¾çš„å¹³å‡æŸ¥æ‰¾æ¬¡æ•°ä¸ºï¼š(1 + 2 + 3 + 4 + 5 + 6) / 6 = 3.3æ¬¡ï¼Œå› æ­¤å¤§å¤šæ•°æƒ…å†µä¸‹äºŒå‰æŸ¥æ‰¾æ ‘çš„å¹³å‡æŸ¥æ‰¾é€Ÿåº¦æ¯”é¡ºåºæŸ¥æ‰¾è¦å¿«ã€‚<br> <img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/39bb7fdbbda743f2bbb28ea36233b4ee~tplv-k3u1fbpfcp-zoom-1.image" alt="img"><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/fccabab05f22414bb66e51eafc6299eb~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>ç”±äºäºŒå‰æŸ¥æ‰¾æ ‘å¯ä»¥ä»»æ„æ„é€ ï¼ŒåŒæ ·çš„å€¼ï¼Œå¯ä»¥æ„é€ å‡ºå¦‚å›¾â‘¡çš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œæ˜¾ç„¶è¿™æ£µäºŒå‰æ ‘çš„æŸ¥è¯¢æ•ˆç‡å’Œé¡ºåºæŸ¥æ‰¾å·®ä¸å¤šã€‚è‹¥æƒ³äºŒå‰æŸ¥æ‰¾æ•°çš„æŸ¥è¯¢æ€§èƒ½æœ€é«˜ï¼Œéœ€è¦è¿™æ£µäºŒå‰æŸ¥æ‰¾æ ‘æ˜¯å¹³è¡¡çš„ï¼Œä¹Ÿå³å¹³è¡¡äºŒå‰æ ‘ï¼ˆAVLæ ‘ï¼‰ã€‚<br> å¹³è¡¡äºŒå‰æ ‘é¦–å…ˆéœ€è¦ç¬¦åˆäºŒå‰æŸ¥æ‰¾æ ‘çš„å®šä¹‰ï¼Œå…¶æ¬¡å¿…é¡»æ»¡è¶³ä»»ä½•èŠ‚ç‚¹çš„ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®ä¸èƒ½å¤§äº1ã€‚æ˜¾ç„¶å›¾â‘¡ä¸æ»¡è¶³å¹³è¡¡äºŒå‰æ ‘çš„å®šä¹‰ï¼Œè€Œå›¾â‘ æ˜¯ä¸€è¯¾å¹³è¡¡äºŒå‰æ ‘ã€‚å¹³è¡¡äºŒå‰æ ‘çš„æŸ¥æ‰¾æ€§èƒ½æ˜¯æ¯”è¾ƒé«˜çš„ï¼ˆæ€§èƒ½æœ€å¥½çš„æ˜¯æœ€ä¼˜äºŒå‰æ ‘ï¼‰ï¼ŒæŸ¥è¯¢æ€§èƒ½è¶Šå¥½ï¼Œç»´æŠ¤çš„æˆæœ¬å°±è¶Šå¤§ã€‚æ¯”å¦‚å›¾â‘ çš„å¹³è¡¡äºŒå‰æ ‘ï¼Œå½“ç”¨æˆ·éœ€è¦æ’å…¥ä¸€ä¸ªæ–°çš„å€¼9çš„èŠ‚ç‚¹æ—¶ï¼Œå°±éœ€è¦åšå‡ºå¦‚ä¸‹å˜åŠ¨ã€‚<br> <img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/771cd567cd3a480684e16226d6fdd73d~tplv-k3u1fbpfcp-zoom-1.image" alt="img"><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/3f07a0e25e4d4d6090cf6efeac91f069~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>é€šè¿‡ä¸€æ¬¡å·¦æ—‹æ“ä½œå°±å°†æ’å…¥åçš„æ ‘é‡æ–°å˜ä¸ºå¹³è¡¡äºŒå‰æ ‘æ˜¯æœ€ç®€å•çš„æƒ…å†µäº†ï¼Œå®é™…åº”ç”¨åœºæ™¯ä¸­å¯èƒ½éœ€è¦æ—‹è½¬å¤šæ¬¡ã€‚è‡³æ­¤æˆ‘ä»¬å¯ä»¥è€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼Œå¹³è¡¡äºŒå‰æ ‘çš„æŸ¥æ‰¾æ•ˆç‡è¿˜ä¸é”™ï¼Œå®ç°ä¹Ÿéå¸¸ç®€å•ï¼Œç›¸åº”çš„ç»´æŠ¤æˆæœ¬è¿˜èƒ½æ¥å—ï¼Œä¸ºä»€ä¹ˆMySQLç´¢å¼•ä¸ç›´æ¥ä½¿ç”¨å¹³è¡¡äºŒå‰æ ‘ï¼Ÿ</p><p>éšç€æ•°æ®åº“ä¸­æ•°æ®çš„å¢åŠ ï¼Œç´¢å¼•æœ¬èº«å¤§å°éšä¹‹å¢åŠ ï¼Œä¸å¯èƒ½å…¨éƒ¨å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå› æ­¤ç´¢å¼•å¾€å¾€ä»¥ç´¢å¼•æ–‡ä»¶çš„å½¢å¼å­˜å‚¨çš„ç£ç›˜ä¸Šã€‚è¿™æ ·çš„è¯ï¼Œç´¢å¼•æŸ¥æ‰¾è¿‡ç¨‹ä¸­å°±è¦äº§ç”Ÿç£ç›˜I/Oæ¶ˆè€—ï¼Œç›¸å¯¹äºå†…å­˜å­˜å–ï¼ŒI/Oå­˜å–çš„æ¶ˆè€—è¦é«˜å‡ ä¸ªæ•°é‡çº§ã€‚</p><p>å¯ä»¥æƒ³è±¡ä¸€ä¸‹ä¸€æ£µå‡ ç™¾ä¸‡èŠ‚ç‚¹çš„äºŒå‰æ ‘çš„æ·±åº¦æ˜¯å¤šå°‘ï¼Ÿå¦‚æœå°†è¿™ä¹ˆå¤§æ·±åº¦çš„ä¸€é¢—äºŒå‰æ ‘æ”¾ç£ç›˜ä¸Šï¼Œæ¯è¯»å–ä¸€ä¸ªèŠ‚ç‚¹ï¼Œéœ€è¦ä¸€æ¬¡ç£ç›˜çš„I/Oè¯»å–ï¼Œæ•´ä¸ªæŸ¥æ‰¾çš„è€—æ—¶æ˜¾ç„¶æ˜¯ä¸èƒ½å¤Ÿæ¥å—çš„ã€‚é‚£ä¹ˆå¦‚ä½•å‡å°‘æŸ¥æ‰¾è¿‡ç¨‹ä¸­çš„I/Oå­˜å–æ¬¡æ•°?</p><p>ä¸€ç§è¡Œä¹‹æœ‰æ•ˆçš„è§£å†³æ–¹æ³•æ˜¯å‡å°‘æ ‘çš„æ·±åº¦ï¼Œå°†äºŒå‰æ ‘å˜ä¸ºmå‰æ ‘ï¼ˆå¤šè·¯æœç´¢æ ‘ï¼‰ï¼Œè€ŒB+Treeå°±æ˜¯ä¸€ç§å¤šè·¯æœç´¢æ ‘ã€‚ç†è§£B+Treeæ—¶ï¼Œåªéœ€è¦ç†è§£å…¶æœ€é‡è¦çš„ä¸¤ä¸ªç‰¹å¾å³å¯ï¼šç¬¬ä¸€ï¼Œæ‰€æœ‰çš„å…³é”®å­—ï¼ˆå¯ä»¥ç†è§£ä¸ºæ•°æ®ï¼‰éƒ½å­˜å‚¨åœ¨å¶å­èŠ‚ç‚¹ï¼ˆLeaf Pageï¼‰ï¼Œéå¶å­èŠ‚ç‚¹ï¼ˆIndex Pageï¼‰å¹¶ä¸å­˜å‚¨çœŸæ­£çš„æ•°æ®ï¼Œæ‰€æœ‰è®°å½•èŠ‚ç‚¹éƒ½æ˜¯æŒ‰é”®å€¼å¤§å°é¡ºåºå­˜æ”¾åœ¨åŒä¸€å±‚å¶å­èŠ‚ç‚¹ä¸Šã€‚å…¶æ¬¡ï¼Œæ‰€æœ‰çš„å¶å­èŠ‚ç‚¹ç”±æŒ‡é’ˆè¿æ¥ã€‚å¦‚ä¸‹å›¾ä¸ºé«˜åº¦ä¸º2çš„ç®€åŒ–äº†çš„B+Treeã€‚<br> <img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/6daac28f9e144b00ab34d21953f578de~tplv-k3u1fbpfcp-zoom-1.image" alt="img"><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/08a14c03d41243f2b880685d5505d876~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>æ€ä¹ˆç†è§£è¿™ä¸¤ä¸ªç‰¹å¾ï¼ŸMySQLå°†æ¯ä¸ªèŠ‚ç‚¹çš„å¤§å°è®¾ç½®ä¸ºä¸€ä¸ªé¡µçš„æ•´æ•°å€ï¼ˆåŸå› ä¸‹æ–‡ä¼šä»‹ç»ï¼‰ï¼Œä¹Ÿå°±æ˜¯åœ¨èŠ‚ç‚¹ç©ºé—´å¤§å°ä¸€å®šçš„æƒ…å†µä¸‹ï¼Œæ¯ä¸ªèŠ‚ç‚¹å¯ä»¥å­˜å‚¨æ›´å¤šçš„å†…ç»“ç‚¹ï¼Œè¿™æ ·æ¯ä¸ªç»“ç‚¹èƒ½ç´¢å¼•çš„èŒƒå›´æ›´å¤§æ›´ç²¾ç¡®ã€‚</p><p>æ‰€æœ‰çš„å¶å­èŠ‚ç‚¹ä½¿ç”¨æŒ‡é’ˆé“¾æ¥çš„å¥½å¤„æ˜¯å¯ä»¥è¿›è¡ŒåŒºé—´è®¿é—®ï¼Œæ¯”å¦‚ä¸Šå›¾ä¸­ï¼Œå¦‚æœæŸ¥æ‰¾å¤§äº20è€Œå°äº30çš„è®°å½•ï¼Œåªéœ€è¦æ‰¾åˆ°èŠ‚ç‚¹20ï¼Œå°±å¯ä»¥éå†æŒ‡é’ˆä¾æ¬¡æ‰¾åˆ°25ã€30ã€‚å¦‚æœæ²¡æœ‰é“¾æ¥æŒ‡é’ˆçš„è¯ï¼Œå°±æ— æ³•è¿›è¡ŒåŒºé—´æŸ¥æ‰¾ã€‚è¿™ä¹Ÿæ˜¯MySQLä½¿ç”¨B+Treeä½œä¸ºç´¢å¼•å­˜å‚¨ç»“æ„çš„é‡è¦åŸå› ã€‚</p><p>MySQLä¸ºä½•å°†èŠ‚ç‚¹å¤§å°è®¾ç½®ä¸ºé¡µçš„æ•´æ•°å€ï¼Œè¿™å°±éœ€è¦ç†è§£ç£ç›˜çš„å­˜å‚¨åŸç†ã€‚ç£ç›˜æœ¬èº«å­˜å–å°±æ¯”ä¸»å­˜æ…¢å¾ˆå¤šï¼Œåœ¨åŠ ä¸Šæœºæ¢°è¿åŠ¨æŸè€—ï¼ˆç‰¹åˆ«æ˜¯æ™®é€šçš„æœºæ¢°ç¡¬ç›˜ï¼‰ï¼Œç£ç›˜çš„å­˜å–é€Ÿåº¦å¾€å¾€æ˜¯ä¸»å­˜çš„å‡ ç™¾ä¸‡åˆ†ä¹‹ä¸€ï¼Œä¸ºäº†å°½é‡å‡å°‘ç£ç›˜I/Oï¼Œç£ç›˜å¾€å¾€ä¸æ˜¯ä¸¥æ ¼æŒ‰éœ€è¯»å–ï¼Œè€Œæ˜¯æ¯æ¬¡éƒ½ä¼šé¢„è¯»ï¼Œå³ä½¿åªéœ€è¦ä¸€ä¸ªå­—èŠ‚ï¼Œç£ç›˜ä¹Ÿä¼šä»è¿™ä¸ªä½ç½®å¼€å§‹ï¼Œé¡ºåºå‘åè¯»å–ä¸€å®šé•¿åº¦çš„æ•°æ®æ”¾å…¥å†…å­˜ï¼Œé¢„è¯»çš„é•¿åº¦ä¸€èˆ¬ä¸ºé¡µçš„æ•´æ•°å€ã€‚</p><p>é¡µæ˜¯è®¡ç®—æœºç®¡ç†å­˜å‚¨å™¨çš„é€»è¾‘å—ï¼Œç¡¬ä»¶åŠOSå¾€å¾€å°†ä¸»å­˜å’Œç£ç›˜å­˜å‚¨åŒºåˆ†å‰²ä¸ºè¿ç»­çš„å¤§å°ç›¸ç­‰çš„å—ï¼Œæ¯ä¸ªå­˜å‚¨å—ç§°ä¸ºä¸€é¡µï¼ˆè®¸å¤šOSä¸­ï¼Œé¡µçš„å¤§å°é€šå¸¸ä¸º4Kï¼‰ã€‚ä¸»å­˜å’Œç£ç›˜ä»¥é¡µä¸ºå•ä½äº¤æ¢æ•°æ®ã€‚</p><p>å½“ç¨‹åºè¦è¯»å–çš„æ•°æ®ä¸åœ¨ä¸»å­˜ä¸­æ—¶ï¼Œä¼šè§¦å‘ä¸€ä¸ªç¼ºé¡µå¼‚å¸¸ï¼Œæ­¤æ—¶ç³»ç»Ÿä¼šå‘ç£ç›˜å‘å‡ºè¯»ç›˜ä¿¡å·ï¼Œç£ç›˜ä¼šæ‰¾åˆ°æ•°æ®çš„èµ·å§‹ä½ç½®å¹¶å‘åè¿ç»­è¯»å–ä¸€é¡µæˆ–å‡ é¡µè½½å…¥å†…å­˜ä¸­ï¼Œç„¶åä¸€èµ·è¿”å›ï¼Œç¨‹åºç»§ç»­è¿è¡Œã€‚</p><p>MySQLå·§å¦™åˆ©ç”¨äº†ç£ç›˜é¢„è¯»åŸç†ï¼Œå°†ä¸€ä¸ªèŠ‚ç‚¹çš„å¤§å°è®¾ä¸ºç­‰äºä¸€ä¸ªé¡µï¼Œè¿™æ ·æ¯ä¸ªèŠ‚ç‚¹åªéœ€è¦ä¸€æ¬¡I/Oå°±å¯ä»¥å®Œå…¨è½½å…¥ã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œæ¯æ¬¡æ–°å»ºèŠ‚ç‚¹æ—¶ï¼Œç›´æ¥ç”³è¯·ä¸€ä¸ªé¡µçš„ç©ºé—´ï¼Œè¿™æ ·å°±ä¿è¯ä¸€ä¸ªèŠ‚ç‚¹ç‰©ç†ä¸Šä¹Ÿå­˜å‚¨åœ¨ä¸€ä¸ªé¡µé‡Œï¼ŒåŠ ä¹‹è®¡ç®—æœºå­˜å‚¨åˆ†é…éƒ½æ˜¯æŒ‰é¡µå¯¹é½çš„ï¼Œå°±å®ç°äº†è¯»å–ä¸€ä¸ªèŠ‚ç‚¹åªéœ€ä¸€æ¬¡I/Oã€‚</p><p>å‡è®¾B+Treeçš„é«˜åº¦ä¸ºhï¼Œä¸€æ¬¡æ£€ç´¢æœ€å¤šéœ€è¦h-1I/Oï¼ˆæ ¹èŠ‚ç‚¹å¸¸é©»å†…å­˜ï¼‰ï¼Œå¤æ‚åº¦O(h)=O(logMN)ã€‚å®é™…åº”ç”¨åœºæ™¯ä¸­ï¼ŒMé€šå¸¸è¾ƒå¤§ï¼Œå¸¸å¸¸è¶…è¿‡100ï¼Œå› æ­¤æ ‘çš„é«˜åº¦ä¸€èˆ¬éƒ½æ¯”è¾ƒå°ï¼Œé€šå¸¸ä¸è¶…è¿‡3ã€‚</p><p>æœ€åç®€å•äº†è§£ä¸‹B+TreeèŠ‚ç‚¹çš„æ“ä½œï¼Œåœ¨æ•´ä½“ä¸Šå¯¹ç´¢å¼•çš„ç»´æŠ¤æœ‰ä¸€ä¸ªå¤§æ¦‚çš„äº†è§£ï¼Œè™½ç„¶ç´¢å¼•å¯ä»¥å¤§å¤§æé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œä½†ç»´æŠ¤ç´¢å¼•ä»è¦èŠ±è´¹å¾ˆå¤§çš„ä»£ä»·ï¼Œå› æ­¤åˆç†çš„åˆ›å»ºç´¢å¼•ä¹Ÿå°±å°¤ä¸ºé‡è¦ã€‚</p><p>ä»ä»¥ä¸Šé¢çš„æ ‘ä¸ºä¾‹ï¼Œæˆ‘ä»¬å‡è®¾æ¯ä¸ªèŠ‚ç‚¹åªèƒ½å­˜å‚¨4ä¸ªå†…èŠ‚ç‚¹ã€‚é¦–å…ˆè¦æ’å…¥ç¬¬ä¸€ä¸ªèŠ‚ç‚¹28ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚<br> <img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/2b808c79ad6748c597453f40db8f31a6~tplv-k3u1fbpfcp-zoom-1.image" alt="img"><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/a3cc1efead72420b9c646a54aa3bd6c4~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>æ¥ç€æ’å…¥ä¸‹ä¸€ä¸ªèŠ‚ç‚¹70ï¼Œåœ¨Index Pageä¸­æŸ¥è¯¢åå¾—çŸ¥åº”è¯¥æ’å…¥åˆ°50 - 70ä¹‹é—´çš„å¶å­èŠ‚ç‚¹ï¼Œä½†å¶å­èŠ‚ç‚¹å·²æ»¡ï¼Œè¿™æ—¶å€™å°±éœ€è¦è¿›è¡Œä¹Ÿåˆ†è£‚çš„æ“ä½œï¼Œå½“å‰çš„å¶å­èŠ‚ç‚¹èµ·ç‚¹ä¸º50ï¼Œæ‰€ä»¥æ ¹æ®ä¸­é—´å€¼æ¥æ‹†åˆ†å¶å­èŠ‚ç‚¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚<br> <img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/f7d920b54a414adea15ad753ac819f8e~tplv-k3u1fbpfcp-zoom-1.image" alt="img"><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/ab795be406644dbdb216abacdcc7112b~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>æœ€åæ’å…¥ä¸€ä¸ªèŠ‚ç‚¹95ï¼Œè¿™æ—¶å€™Index Pageå’ŒLeaf Pageéƒ½æ»¡äº†ï¼Œå°±éœ€è¦åšä¸¤æ¬¡æ‹†åˆ†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚<br> <img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/ab8142a981c34d399617216c6441081b~tplv-k3u1fbpfcp-zoom-1.image" alt="img"><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/2c6487833f01429985a6eabf638a9491~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>æ‹†åˆ†åæœ€ç»ˆå½¢æˆäº†è¿™æ ·ä¸€é¢—æ ‘ã€‚<br> <img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/cec96fd604fd474ba257c0914675790b~tplv-k3u1fbpfcp-zoom-1.image" alt="img"><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/00ea5cc9b545428385caf617d4f9bb86~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>B+Treeä¸ºäº†ä¿æŒå¹³è¡¡ï¼Œå¯¹äºæ–°æ’å…¥çš„å€¼éœ€è¦åšå¤§é‡çš„æ‹†åˆ†é¡µæ“ä½œï¼Œè€Œé¡µçš„æ‹†åˆ†éœ€è¦I/Oæ“ä½œï¼Œä¸ºäº†å°½å¯èƒ½çš„å‡å°‘é¡µçš„æ‹†åˆ†æ“ä½œï¼ŒB+Treeä¹Ÿæä¾›äº†ç±»ä¼¼äºå¹³è¡¡äºŒå‰æ ‘çš„æ—‹è½¬åŠŸèƒ½ã€‚</p><p>å½“Leaf Pageå·²æ»¡ä½†å…¶å·¦å³å…„å¼ŸèŠ‚ç‚¹æ²¡æœ‰æ»¡çš„æƒ…å†µä¸‹ï¼ŒB+Treeå¹¶ä¸æ€¥äºå»åšæ‹†åˆ†æ“ä½œï¼Œè€Œæ˜¯å°†è®°å½•ç§»åˆ°å½“å‰æ‰€åœ¨é¡µçš„å…„å¼ŸèŠ‚ç‚¹ä¸Šã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå·¦å…„å¼Ÿä¼šè¢«å…ˆæ£€æŸ¥ç”¨æ¥åšæ—‹è½¬æ“ä½œã€‚å°±æ¯”å¦‚ä¸Šé¢ç¬¬äºŒä¸ªç¤ºä¾‹ï¼Œå½“æ’å…¥70çš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šå»åšé¡µæ‹†åˆ†ï¼Œè€Œæ˜¯å·¦æ—‹æ“ä½œã€‚<br> <img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/acd740a5d87a4fec923746e9ad8543aa~tplv-k3u1fbpfcp-zoom-1.image" alt="img"><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/29925f1e0cbe4663ad9ad0b14e7035c4~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>é€šè¿‡æ—‹è½¬æ“ä½œå¯ä»¥æœ€å¤§é™åº¦çš„å‡å°‘é¡µåˆ†è£‚ï¼Œä»è€Œå‡å°‘ç´¢å¼•ç»´æŠ¤è¿‡ç¨‹ä¸­çš„ç£ç›˜çš„I/Oæ“ä½œï¼Œä¹Ÿæé«˜ç´¢å¼•ç»´æŠ¤æ•ˆç‡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåˆ é™¤èŠ‚ç‚¹è·Ÿæ’å…¥èŠ‚ç‚¹ç±»ä¼¼ï¼Œä»ç„¶éœ€è¦æ—‹è½¬å’Œæ‹†åˆ†æ“ä½œï¼Œè¿™é‡Œå°±ä¸å†è¯´æ˜ã€‚</p><p><strong>é«˜æ€§èƒ½ç­–ç•¥</strong><br> é€šè¿‡ä¸Šæ–‡ï¼Œç›¸ä¿¡ä½ å¯¹B+Treeçš„æ•°æ®ç»“æ„å·²ç»æœ‰äº†å¤§è‡´çš„äº†è§£ï¼Œä½†MySQLä¸­ç´¢å¼•æ˜¯å¦‚ä½•ç»„ç»‡æ•°æ®çš„å­˜å‚¨å‘¢ï¼Ÿä»¥ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹æ¥è¯´æ˜ï¼Œå‡å¦‚æœ‰å¦‚ä¸‹æ•°æ®è¡¨ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> People(<br><br>    last_name <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,<br><br>    first_name <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,<br><br>    dob <span class="hljs-type">date</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,<br><br>    gender enum(`m`,`f`) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,<br><br>    key(last_name,first_name,dob)<br><br>);<br></code></pre></td></tr></table></figure><p>å¯¹äºè¡¨ä¸­æ¯ä¸€è¡Œæ•°æ®ï¼Œç´¢å¼•ä¸­åŒ…å«äº†last_nameã€first_nameã€dobåˆ—çš„å€¼ï¼Œä¸‹å›¾å±•ç¤ºäº†ç´¢å¼•æ˜¯å¦‚ä½•ç»„ç»‡æ•°æ®å­˜å‚¨çš„ã€‚<br> <img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/8b88a92154cb4c5091c1d8c97d0e8aaf~tplv-k3u1fbpfcp-zoom-1.image" alt="img"><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/f31ba9c868254d8abc4176374bf52faf~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œç´¢å¼•é¦–å…ˆæ ¹æ®ç¬¬ä¸€ä¸ªå­—æ®µæ¥æ’åˆ—é¡ºåºï¼Œå½“åå­—ç›¸åŒæ—¶ï¼Œåˆ™æ ¹æ®ç¬¬ä¸‰ä¸ªå­—æ®µï¼Œå³å‡ºç”Ÿæ—¥æœŸæ¥æ’åºï¼Œæ­£æ˜¯å› ä¸ºè¿™ä¸ªåŸå› ï¼Œæ‰æœ‰äº†ç´¢å¼•çš„â€œæœ€å·¦åŸåˆ™â€ã€‚</p><p><strong>1ã€MySQLä¸ä¼šä½¿ç”¨ç´¢å¼•çš„æƒ…å†µï¼šéç‹¬ç«‹çš„åˆ—</strong><br> â€œç‹¬ç«‹çš„åˆ—â€æ˜¯æŒ‡ç´¢å¼•åˆ—ä¸èƒ½æ˜¯è¡¨è¾¾å¼çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸èƒ½æ˜¯å‡½æ•°çš„å‚æ•°ã€‚æ¯”å¦‚ï¼š<br> <code>select * from where id + 1 = 5</code><br> æˆ‘ä»¬å¾ˆå®¹æ˜“çœ‹å‡ºå…¶ç­‰ä»·äº id = 4ï¼Œä½†æ˜¯MySQLæ— æ³•è‡ªåŠ¨è§£æè¿™ä¸ªè¡¨è¾¾å¼ï¼Œä½¿ç”¨å‡½æ•°æ˜¯åŒæ ·çš„é“ç†ã€‚</p><p><strong>2ã€å‰ç¼€ç´¢å¼•</strong><br> å¦‚æœåˆ—å¾ˆé•¿ï¼Œé€šå¸¸å¯ä»¥ç´¢å¼•å¼€å§‹çš„éƒ¨åˆ†å­—ç¬¦ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆèŠ‚çº¦ç´¢å¼•ç©ºé—´ï¼Œä»è€Œæé«˜ç´¢å¼•æ•ˆç‡ã€‚</p><p><strong>3ã€å¤šåˆ—ç´¢å¼•å’Œç´¢å¼•é¡ºåº</strong><br> åœ¨å¤šæ•°æƒ…å†µä¸‹ï¼Œåœ¨å¤šä¸ªåˆ—ä¸Šå»ºç«‹ç‹¬ç«‹çš„ç´¢å¼•å¹¶ä¸èƒ½æé«˜æŸ¥è¯¢æ€§èƒ½ã€‚ç†ç”±éå¸¸ç®€å•ï¼ŒMySQLä¸çŸ¥é“é€‰æ‹©å“ªä¸ªç´¢å¼•çš„æŸ¥è¯¢æ•ˆç‡æ›´å¥½ï¼Œæ‰€ä»¥åœ¨è€ç‰ˆæœ¬ï¼Œæ¯”å¦‚MySQL5.0ä¹‹å‰å°±ä¼šéšä¾¿é€‰æ‹©ä¸€ä¸ªåˆ—çš„ç´¢å¼•ï¼Œè€Œæ–°çš„ç‰ˆæœ¬ä¼šé‡‡ç”¨åˆå¹¶ç´¢å¼•çš„ç­–ç•¥ã€‚ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œåœ¨ä¸€å¼ ç”µå½±æ¼”å‘˜è¡¨ä¸­ï¼Œåœ¨actor_idå’Œfilm_idä¸¤ä¸ªåˆ—ä¸Šéƒ½å»ºç«‹äº†ç‹¬ç«‹çš„ç´¢å¼•ï¼Œç„¶åæœ‰å¦‚ä¸‹æŸ¥è¯¢ï¼š</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs axapta"><span class="hljs-keyword">select</span> film_id,actor_id <span class="hljs-keyword">from</span> film_actor <span class="hljs-keyword">where</span> actor_id = <span class="hljs-number">1</span> or film_id = <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>è€ç‰ˆæœ¬çš„MySQLä¼šéšæœºé€‰æ‹©ä¸€ä¸ªç´¢å¼•ï¼Œä½†æ–°ç‰ˆæœ¬åšå¦‚ä¸‹çš„ä¼˜åŒ–ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> film_id,actor_id <span class="hljs-keyword">from</span> film_actor <span class="hljs-keyword">where</span> actor_id = <span class="hljs-number">1</span> <br><br><span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span><br><br><span class="hljs-keyword">select</span> film_id,actor_id <span class="hljs-keyword">from</span> film_actor <span class="hljs-keyword">where</span> film_id = <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> actor_id &lt;&gt; <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>å½“å‡ºç°å¤šä¸ªç´¢å¼•åšç›¸äº¤æ“ä½œæ—¶ï¼ˆå¤šä¸ªANDæ¡ä»¶ï¼‰ï¼Œé€šå¸¸æ¥è¯´ä¸€ä¸ªåŒ…å«æ‰€æœ‰ç›¸å…³åˆ—çš„ç´¢å¼•è¦ä¼˜äºå¤šä¸ªç‹¬ç«‹ç´¢å¼•ã€‚</p><p>å½“å‡ºç°å¤šä¸ªç´¢å¼•åšè”åˆæ“ä½œæ—¶ï¼ˆå¤šä¸ªORæ¡ä»¶ï¼‰ï¼Œå¯¹ç»“æœé›†çš„åˆå¹¶ã€æ’åºç­‰æ“ä½œéœ€è¦è€—è´¹å¤§é‡çš„CPUå’Œå†…å­˜èµ„æºï¼Œç‰¹åˆ«æ˜¯å½“å…¶ä¸­çš„æŸäº›ç´¢å¼•çš„é€‰æ‹©æ€§ä¸é«˜ï¼Œéœ€è¦è¿”å›åˆå¹¶å¤§é‡æ•°æ®æ—¶ï¼ŒæŸ¥è¯¢æˆæœ¬æ›´é«˜ã€‚æ‰€ä»¥è¿™ç§æƒ…å†µä¸‹è¿˜ä¸å¦‚èµ°å…¨è¡¨æ‰«æã€‚</p><p>å› æ­¤explainæ—¶å¦‚æœå‘ç°æœ‰ç´¢å¼•åˆå¹¶ï¼ˆExtraå­—æ®µå‡ºç°Using unionï¼‰ï¼Œåº”è¯¥å¥½å¥½æ£€æŸ¥ä¸€ä¸‹æŸ¥è¯¢å’Œè¡¨ç»“æ„æ˜¯ä¸æ˜¯å·²ç»æ˜¯æœ€ä¼˜çš„ï¼Œå¦‚æœæŸ¥è¯¢å’Œè¡¨éƒ½æ²¡æœ‰é—®é¢˜ï¼Œé‚£åªèƒ½è¯´æ˜ç´¢å¼•å»ºçš„éå¸¸ç³Ÿç³•ï¼Œåº”å½“æ…é‡è€ƒè™‘ç´¢å¼•æ˜¯å¦åˆé€‚ï¼Œæœ‰å¯èƒ½ä¸€ä¸ªåŒ…å«æ‰€æœ‰ç›¸å…³åˆ—çš„å¤šåˆ—ç´¢å¼•æ›´é€‚åˆã€‚</p><p>å‰é¢æˆ‘ä»¬æåˆ°è¿‡ç´¢å¼•å¦‚ä½•ç»„ç»‡æ•°æ®å­˜å‚¨çš„ï¼Œä»å›¾ä¸­å¯ä»¥çœ‹åˆ°å¤šåˆ—ç´¢å¼•æ—¶ï¼Œç´¢å¼•çš„é¡ºåºå¯¹äºæŸ¥è¯¢æ˜¯è‡³å…³é‡è¦çš„ï¼Œå¾ˆæ˜æ˜¾åº”è¯¥æŠŠé€‰æ‹©æ€§æ›´é«˜çš„å­—æ®µæ”¾åˆ°ç´¢å¼•çš„å‰é¢ï¼Œè¿™æ ·é€šè¿‡ç¬¬ä¸€ä¸ªå­—æ®µå°±å¯ä»¥è¿‡æ»¤æ‰å¤§å¤šæ•°ä¸ç¬¦åˆæ¡ä»¶çš„æ•°æ®ã€‚</p><p>ç´¢å¼•é€‰æ‹©æ€§æ˜¯æŒ‡ä¸é‡å¤çš„ç´¢å¼•å€¼å’Œæ•°æ®è¡¨çš„æ€»è®°å½•æ•°çš„æ¯”å€¼ï¼Œé€‰æ‹©æ€§è¶Šé«˜æŸ¥è¯¢æ•ˆç‡è¶Šé«˜ï¼Œå› ä¸ºé€‰æ‹©æ€§è¶Šé«˜çš„ç´¢å¼•å¯ä»¥è®©MySQLåœ¨æŸ¥è¯¢æ—¶è¿‡æ»¤æ‰æ›´å¤šçš„è¡Œã€‚å”¯ä¸€ç´¢å¼•çš„é€‰æ‹©æ€§æ˜¯1ï¼Œè¿™æ—¶æœ€å¥½çš„ç´¢å¼•é€‰æ‹©æ€§ï¼Œæ€§èƒ½ä¹Ÿæ˜¯æœ€å¥½çš„ã€‚</p><p>ç†è§£ç´¢å¼•é€‰æ‹©æ€§çš„æ¦‚å¿µåï¼Œå°±ä¸éš¾ç¡®å®šå“ªä¸ªå­—æ®µçš„é€‰æ‹©æ€§è¾ƒé«˜äº†ï¼ŒæŸ¥ä¸€ä¸‹å°±çŸ¥é“äº†ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> payment <span class="hljs-keyword">where</span> staff_id = <span class="hljs-number">2</span> <span class="hljs-keyword">and</span> customer_id = <span class="hljs-number">584</span><br></code></pre></td></tr></table></figure><p>æ˜¯åº”è¯¥åˆ›å»º(staff_id,customer_id)çš„ç´¢å¼•è¿˜æ˜¯åº”è¯¥é¢ å€’ä¸€ä¸‹é¡ºåºï¼Ÿæ‰§è¡Œä¸‹é¢çš„æŸ¥è¯¢ï¼Œå“ªä¸ªå­—æ®µçš„é€‰æ‹©æ€§æ›´æ¥è¿‘1å°±æŠŠå“ªä¸ªå­—æ®µç´¢å¼•å‰é¢å°±å¥½ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-keyword">distinct</span> staff_id)<span class="hljs-operator">/</span><span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">as</span> staff_id_selectivity,<br><br>       <span class="hljs-built_in">count</span>(<span class="hljs-keyword">distinct</span> customer_id)<span class="hljs-operator">/</span><span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">as</span> customer_id_selectivity,<br><br>       <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> payment<br></code></pre></td></tr></table></figure><p>å¤šæ•°æƒ…å†µä¸‹ä½¿ç”¨è¿™ä¸ªåŸåˆ™æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œä½†ä»ç„¶æ³¨æ„ä½ çš„æ•°æ®ä¸­æ˜¯å¦å­˜åœ¨ä¸€äº›ç‰¹æ®Šæƒ…å†µã€‚ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ¯”å¦‚è¦æŸ¥è¯¢æŸä¸ªç”¨æˆ·ç»„ä¸‹æœ‰è¿‡äº¤æ˜“çš„ç”¨æˆ·ä¿¡æ¯ï¼š</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs axapta"><span class="hljs-keyword">select</span> user_id <span class="hljs-keyword">from</span> trade <span class="hljs-keyword">where</span> user_group_id = <span class="hljs-number">1</span> and trade_amount &gt; <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>MySQLä¸ºè¿™ä¸ªæŸ¥è¯¢é€‰æ‹©äº†ç´¢å¼•(user_group_id,trade_amount)ï¼Œå¦‚æœä¸è€ƒè™‘ç‰¹æ®Šæƒ…å†µï¼Œè¿™çœ‹èµ·æ¥æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œä½†å®é™…æƒ…å†µæ˜¯è¿™å¼ è¡¨çš„å¤§å¤šæ•°æ•°æ®éƒ½æ˜¯ä»è€ç³»ç»Ÿä¸­è¿ç§»è¿‡æ¥çš„ï¼Œç”±äºæ–°è€ç³»ç»Ÿçš„æ•°æ®ä¸å…¼å®¹ï¼Œæ‰€ä»¥å°±ç»™è€ç³»ç»Ÿè¿ç§»è¿‡æ¥çš„æ•°æ®èµ‹äºˆäº†ä¸€ä¸ªé»˜è®¤çš„ç”¨æˆ·ç»„ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œé€šè¿‡ç´¢å¼•æ‰«æçš„è¡Œæ•°è·Ÿå…¨è¡¨æ‰«æåŸºæœ¬æ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œç´¢å¼•ä¹Ÿå°±èµ·ä¸åˆ°ä»»ä½•ä½œç”¨ã€‚</p><p>æ¨å¹¿å¼€æ¥è¯´ï¼Œç»éªŒæ³•åˆ™å’Œæ¨è®ºåœ¨å¤šæ•°æƒ…å†µä¸‹æ˜¯æœ‰ç”¨çš„ï¼Œå¯ä»¥æŒ‡å¯¼æˆ‘ä»¬å¼€å‘å’Œè®¾è®¡ï¼Œä½†å®é™…æƒ…å†µå¾€å¾€ä¼šæ›´å¤æ‚ï¼Œå®é™…ä¸šåŠ¡åœºæ™¯ä¸‹çš„æŸäº›ç‰¹æ®Šæƒ…å†µå¯èƒ½ä¼šæ‘§æ¯ä½ çš„æ•´ä¸ªè®¾è®¡ã€‚</p><p><strong>4ã€é¿å…å¤šä¸ªèŒƒå›´æ¡ä»¶</strong><br> å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¼šç»å¸¸ä½¿ç”¨å¤šä¸ªèŒƒå›´æ¡ä»¶ï¼Œæ¯”å¦‚æƒ³æŸ¥è¯¢æŸä¸ªæ—¶é—´æ®µå†…ç™»å½•è¿‡çš„ç”¨æˆ·ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>.* <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> login_time &gt; <span class="hljs-string">&#x27;2017-04-01&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-keyword">between</span> <span class="hljs-number">18</span> <span class="hljs-keyword">and</span> <span class="hljs-number">30</span>;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæŸ¥è¯¢æœ‰ä¸€ä¸ªé—®é¢˜ï¼šå®ƒæœ‰ä¸¤ä¸ªèŒƒå›´æ¡ä»¶ï¼Œlogin_timeåˆ—å’Œageåˆ—ï¼ŒMySQLå¯ä»¥ä½¿ç”¨login_timeåˆ—çš„ç´¢å¼•æˆ–è€…ageåˆ—çš„ç´¢å¼•ï¼Œä½†æ— æ³•åŒæ—¶ä½¿ç”¨å®ƒä»¬ã€‚</p><p><strong>5ã€è¦†ç›–ç´¢å¼•</strong><br> å¦‚æœä¸€ä¸ªç´¢å¼•åŒ…å«æˆ–è€…è¯´è¦†ç›–æ‰€æœ‰éœ€è¦æŸ¥è¯¢çš„å­—æ®µçš„å€¼ï¼Œé‚£ä¹ˆå°±æ²¡æœ‰å¿…è¦å†å›è¡¨æŸ¥è¯¢ï¼Œè¿™å°±ç§°ä¸ºè¦†ç›–ç´¢å¼•ã€‚è¦†ç›–ç´¢å¼•æ˜¯éå¸¸æœ‰ç”¨çš„å·¥å…·ï¼Œå¯ä»¥æå¤§çš„æé«˜æ€§èƒ½ï¼Œå› ä¸ºæŸ¥è¯¢åªéœ€è¦æ‰«æç´¢å¼•ä¼šå¸¦æ¥è®¸å¤šå¥½å¤„ï¼š</p><p>ç´¢å¼•æ¡ç›®è¿œå°äºæ•°æ®è¡Œå¤§å°ï¼Œå¦‚æœåªè¯»å–ç´¢å¼•ï¼Œæå¤§å‡å°‘æ•°æ®è®¿é—®é‡<br> ç´¢å¼•æ˜¯æœ‰æŒ‰ç…§åˆ—å€¼é¡ºåºå­˜å‚¨çš„ï¼Œå¯¹äºI/Oå¯†é›†å‹çš„èŒƒå›´æŸ¥è¯¢è¦æ¯”éšæœºä»ç£ç›˜è¯»å–æ¯ä¸€è¡Œæ•°æ®çš„IOè¦å°‘çš„å¤š</p><p><strong>6ã€ä½¿ç”¨ç´¢å¼•æ‰«ææ¥æ’åº</strong><br> MySQLæœ‰ä¸¤ç§æ–¹å¼å¯ä»¥ç”Ÿäº§æœ‰åºçš„ç»“æœé›†ï¼Œå…¶ä¸€æ˜¯å¯¹ç»“æœé›†è¿›è¡Œæ’åºçš„æ“ä½œï¼Œå…¶äºŒæ˜¯æŒ‰ç…§ç´¢å¼•é¡ºåºæ‰«æå¾—å‡ºçš„ç»“æœè‡ªç„¶æ˜¯æœ‰åºçš„ã€‚å¦‚æœexplainçš„ç»“æœä¸­typeåˆ—çš„å€¼ä¸ºindexè¡¨ç¤ºä½¿ç”¨äº†ç´¢å¼•æ‰«ææ¥åšæ’åºã€‚</p><p>æ‰«æç´¢å¼•æœ¬èº«å¾ˆå¿«ï¼Œå› ä¸ºåªéœ€è¦ä»ä¸€æ¡ç´¢å¼•è®°å½•ç§»åŠ¨åˆ°ç›¸é‚»çš„ä¸‹ä¸€æ¡è®°å½•ã€‚ä½†å¦‚æœç´¢å¼•æœ¬èº«ä¸èƒ½è¦†ç›–æ‰€æœ‰éœ€è¦æŸ¥è¯¢çš„åˆ—ï¼Œé‚£ä¹ˆå°±ä¸å¾—ä¸æ¯æ‰«æä¸€æ¡ç´¢å¼•è®°å½•å°±å›è¡¨æŸ¥è¯¢ä¸€æ¬¡å¯¹åº”çš„è¡Œã€‚è¿™ä¸ªè¯»å–æ“ä½œåŸºæœ¬ä¸Šæ˜¯éšæœºI/Oï¼Œå› æ­¤æŒ‰ç…§ç´¢å¼•é¡ºåºè¯»å–æ•°æ®çš„é€Ÿåº¦é€šå¸¸è¦æ¯”é¡ºåºåœ°å…¨è¡¨æ‰«æè¦æ…¢ã€‚<br> åœ¨è®¾è®¡ç´¢å¼•æ—¶ï¼Œå¦‚æœä¸€ä¸ªç´¢å¼•æ—¢èƒ½å¤Ÿæ»¡è¶³æ’åºï¼Œåˆæ»¡è¶³æŸ¥è¯¢ï¼Œæ˜¯æœ€å¥½çš„ã€‚</p><p>åªæœ‰å½“ç´¢å¼•çš„åˆ—é¡ºåºå’ŒORDER BYå­å¥çš„é¡ºåºå®Œå…¨ä¸€è‡´ï¼Œå¹¶ä¸”æ‰€æœ‰åˆ—çš„æ’åºæ–¹å‘ä¹Ÿä¸€æ ·æ—¶ï¼Œæ‰èƒ½å¤Ÿä½¿ç”¨ç´¢å¼•æ¥å¯¹ç»“æœåšæ’åºã€‚å¦‚æœæŸ¥è¯¢éœ€è¦å…³è”å¤šå¼ è¡¨ï¼Œåˆ™åªæœ‰ORDER BYå­å¥å¼•ç”¨çš„å­—æ®µå…¨éƒ¨ä¸ºç¬¬ä¸€å¼ è¡¨æ—¶ï¼Œæ‰èƒ½ä½¿ç”¨ç´¢å¼•åšæ’åºã€‚</p><p>ORDER BYå­å¥å’ŒæŸ¥è¯¢çš„é™åˆ¶æ˜¯ä¸€æ ·çš„ï¼Œéƒ½è¦æ»¡è¶³æœ€å·¦å‰ç¼€çš„è¦æ±‚ï¼ˆæœ‰ä¸€ç§æƒ…å†µä¾‹å¤–ï¼Œå°±æ˜¯æœ€å·¦çš„åˆ—è¢«æŒ‡å®šä¸ºå¸¸æ•°ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼‰ï¼Œå…¶å®ƒæƒ…å†µä¸‹éƒ½éœ€è¦æ‰§è¡Œæ’åºæ“ä½œï¼Œè€Œæ— æ³•åˆ©ç”¨ç´¢å¼•æ’åºã€‚</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs axapta"><span class="hljs-comment">// æœ€å·¦åˆ—ä¸ºå¸¸æ•°ï¼Œç´¢å¼•ï¼š(date,staff_id,customer_id)</span><br><br><span class="hljs-keyword">select</span>  staff_id,customer_id <span class="hljs-keyword">from</span> demo <span class="hljs-keyword">where</span> <span class="hljs-built_in">date</span> = <span class="hljs-string">&#x27;2015-06-01&#x27;</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> staff_id,customer_id<br></code></pre></td></tr></table></figure><p><strong>7ã€å†—ä½™å’Œé‡å¤ç´¢å¼•</strong><br> å†—ä½™ç´¢å¼•æ˜¯æŒ‡åœ¨ç›¸åŒçš„åˆ—ä¸ŠæŒ‰ç…§ç›¸åŒçš„é¡ºåºåˆ›å»ºçš„ç›¸åŒç±»å‹çš„ç´¢å¼•ï¼Œåº”å½“å°½é‡é¿å…è¿™ç§ç´¢å¼•ï¼Œå‘ç°åç«‹å³åˆ é™¤ã€‚æ¯”å¦‚æœ‰ä¸€ä¸ªç´¢å¼•(A,B)ï¼Œå†åˆ›å»ºç´¢å¼•(A)å°±æ˜¯å†—ä½™ç´¢å¼•ã€‚å†—ä½™ç´¢å¼•ç»å¸¸å‘ç”Ÿåœ¨ä¸ºè¡¨æ·»åŠ æ–°ç´¢å¼•æ—¶ï¼Œæ¯”å¦‚æœ‰äººæ–°å»ºäº†ç´¢å¼•(A,B)ï¼Œä½†è¿™ä¸ªç´¢å¼•ä¸æ˜¯æ‰©å±•å·²æœ‰çš„ç´¢å¼•(A)ã€‚</p><p>å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½åº”è¯¥å°½é‡æ‰©å±•å·²æœ‰çš„ç´¢å¼•è€Œä¸æ˜¯åˆ›å»ºæ–°ç´¢å¼•ã€‚ä½†æœ‰æå°‘æƒ…å†µä¸‹å‡ºç°æ€§èƒ½æ–¹é¢çš„è€ƒè™‘éœ€è¦å†—ä½™ç´¢å¼•ï¼Œæ¯”å¦‚æ‰©å±•å·²æœ‰ç´¢å¼•è€Œå¯¼è‡´å…¶å˜å¾—è¿‡å¤§ï¼Œä»è€Œå½±å“åˆ°å…¶ä»–ä½¿ç”¨è¯¥ç´¢å¼•çš„æŸ¥è¯¢ã€‚</p><p><strong>8ã€åˆ é™¤é•¿æœŸæœªä½¿ç”¨çš„ç´¢å¼•</strong><br> å®šæœŸåˆ é™¤ä¸€äº›é•¿æ—¶é—´æœªä½¿ç”¨è¿‡çš„ç´¢å¼•æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„ä¹ æƒ¯ã€‚<br> å…³äºç´¢å¼•è¿™ä¸ªè¯é¢˜æ‰“ç®—å°±æ­¤æ‰“ä½ï¼Œæœ€åè¦è¯´ä¸€å¥ï¼Œç´¢å¼•å¹¶ä¸æ€»æ˜¯æœ€å¥½çš„å·¥å…·ï¼Œåªæœ‰å½“ç´¢å¼•å¸®åŠ©æé«˜æŸ¥è¯¢é€Ÿåº¦å¸¦æ¥çš„å¥½å¤„å¤§äºå…¶å¸¦æ¥çš„é¢å¤–å·¥ä½œæ—¶ï¼Œç´¢å¼•æ‰æ˜¯æœ‰æ•ˆçš„ã€‚å¯¹äºéå¸¸å°çš„è¡¨ï¼Œç®€å•çš„å…¨è¡¨æ‰«ææ›´é«˜æ•ˆã€‚</p><p>å¯¹äºä¸­åˆ°å¤§å‹çš„è¡¨ï¼Œç´¢å¼•å°±éå¸¸æœ‰æ•ˆã€‚å¯¹äºè¶…å¤§å‹çš„è¡¨ï¼Œå»ºç«‹å’Œç»´æŠ¤ç´¢å¼•çš„ä»£ä»·éšä¹‹å¢é•¿ï¼Œè¿™æ—¶å€™å…¶ä»–æŠ€æœ¯ä¹Ÿè®¸æ›´æœ‰æ•ˆï¼Œæ¯”å¦‚åˆ†åŒºè¡¨ã€‚æœ€åçš„æœ€åï¼Œexplainåå†ææµ‹æ˜¯ä¸€ç§ç¾å¾·ã€‚</p><p><strong>ç‰¹å®šç±»å‹æŸ¥è¯¢ä¼˜åŒ–</strong></p><p><strong>ä¼˜åŒ–COUNT()æŸ¥è¯¢</strong><br> COUNT()å¯èƒ½æ˜¯è¢«å¤§å®¶è¯¯è§£æœ€å¤šçš„å‡½æ•°äº†ï¼Œå®ƒæœ‰ä¸¤ç§ä¸åŒçš„ä½œç”¨ï¼Œå…¶ä¸€æ˜¯ç»Ÿè®¡æŸä¸ªåˆ—å€¼çš„æ•°é‡ï¼Œå…¶äºŒæ˜¯ç»Ÿè®¡è¡Œæ•°ã€‚ç»Ÿè®¡åˆ—å€¼æ—¶ï¼Œè¦æ±‚åˆ—å€¼æ˜¯éç©ºçš„ï¼Œå®ƒä¸ä¼šç»Ÿè®¡NULLã€‚å¦‚æœç¡®è®¤æ‹¬å·ä¸­çš„è¡¨è¾¾å¼ä¸å¯èƒ½ä¸ºç©ºæ—¶ï¼Œå®é™…ä¸Šå°±æ˜¯åœ¨ç»Ÿè®¡è¡Œæ•°ã€‚æœ€ç®€å•çš„å°±æ˜¯å½“ä½¿ç”¨COUNT(*)æ—¶ï¼Œå¹¶ä¸æ˜¯æˆ‘ä»¬æ‰€æƒ³è±¡çš„é‚£æ ·æ‰©å±•æˆæ‰€æœ‰çš„åˆ—ï¼Œå®é™…ä¸Šï¼Œå®ƒä¼šå¿½ç•¥æ‰€æœ‰çš„åˆ—è€Œç›´æ¥ç»Ÿè®¡æ‰€æœ‰çš„è¡Œæ•°ã€‚</p><p>æˆ‘ä»¬æœ€å¸¸è§çš„è¯¯è§£ä¹Ÿå°±åœ¨è¿™å„¿ï¼Œåœ¨æ‹¬å·å†…æŒ‡å®šäº†ä¸€åˆ—å´å¸Œæœ›ç»Ÿè®¡ç»“æœæ˜¯è¡Œæ•°ï¼Œè€Œä¸”è¿˜å¸¸å¸¸è¯¯ä»¥ä¸ºå‰è€…çš„æ€§èƒ½ä¼šæ›´å¥½ã€‚ä½†å®é™…å¹¶éè¿™æ ·ï¼Œå¦‚æœè¦ç»Ÿè®¡è¡Œæ•°ï¼Œç›´æ¥ä½¿ç”¨COUNT(*)ï¼Œæ„ä¹‰æ¸…æ™°ï¼Œä¸”æ€§èƒ½æ›´å¥½ã€‚<br> æœ‰æ—¶å€™æŸäº›ä¸šåŠ¡åœºæ™¯å¹¶ä¸éœ€è¦å®Œå…¨ç²¾ç¡®çš„COUNTå€¼ï¼Œå¯ä»¥ç”¨è¿‘ä¼¼å€¼æ¥ä»£æ›¿ï¼ŒEXPLAINå‡ºæ¥çš„è¡Œæ•°å°±æ˜¯ä¸€ä¸ªä¸é”™çš„è¿‘ä¼¼å€¼ï¼Œè€Œä¸”æ‰§è¡ŒEXPLAINå¹¶ä¸éœ€è¦çœŸæ­£åœ°å»æ‰§è¡ŒæŸ¥è¯¢ï¼Œæ‰€ä»¥æˆæœ¬éå¸¸ä½ã€‚é€šå¸¸æ¥è¯´ï¼Œæ‰§è¡ŒCOUNT()éƒ½éœ€è¦æ‰«æå¤§é‡çš„è¡Œæ‰èƒ½è·å–åˆ°ç²¾ç¡®çš„æ•°æ®ï¼Œå› æ­¤å¾ˆéš¾ä¼˜åŒ–ï¼ŒMySQLå±‚é¢è¿˜èƒ½åšå¾—ä¹Ÿå°±åªæœ‰è¦†ç›–ç´¢å¼•äº†ã€‚å¦‚æœä¸è¿˜èƒ½è§£å†³é—®é¢˜ï¼Œåªæœ‰ä»æ¶æ„å±‚é¢è§£å†³äº†ï¼Œæ¯”å¦‚æ·»åŠ æ±‡æ€»è¡¨ï¼Œæˆ–è€…ä½¿ç”¨redisè¿™æ ·çš„å¤–éƒ¨ç¼“å­˜ç³»ç»Ÿã€‚</p><p><strong>ä¼˜åŒ–å…³è”æŸ¥è¯¢</strong><br> åœ¨å¤§æ•°æ®åœºæ™¯ä¸‹ï¼Œè¡¨ä¸è¡¨ä¹‹é—´é€šè¿‡ä¸€ä¸ªå†—ä½™å­—æ®µæ¥å…³è”ï¼Œè¦æ¯”ç›´æ¥ä½¿ç”¨JOINæœ‰æ›´å¥½çš„æ€§èƒ½ã€‚å¦‚æœç¡®å®éœ€è¦ä½¿ç”¨å…³è”æŸ¥è¯¢çš„æƒ…å†µä¸‹ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼š</p><ol><li>ç¡®ä¿ONå’ŒUSINGå­—å¥ä¸­çš„åˆ—ä¸Šæœ‰ç´¢å¼•ã€‚åœ¨åˆ›å»ºç´¢å¼•çš„æ—¶å€™å°±è¦è€ƒè™‘åˆ°å…³è”çš„é¡ºåºã€‚å½“è¡¨Aå’Œè¡¨Bç”¨åˆ—cå…³è”çš„æ—¶å€™ï¼Œå¦‚æœä¼˜åŒ–å™¨å…³è”çš„é¡ºåºæ˜¯Aã€Bï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦åœ¨Aè¡¨çš„å¯¹åº”åˆ—ä¸Šåˆ›å»ºç´¢å¼•ã€‚æ²¡æœ‰ç”¨åˆ°çš„ç´¢å¼•ä¼šå¸¦æ¥é¢å¤–çš„è´Ÿæ‹…ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œé™¤éæœ‰å…¶ä»–ç†ç”±ï¼Œåªéœ€è¦åœ¨å…³è”é¡ºåºä¸­çš„ç¬¬äºŒå¼ è¡¨çš„ç›¸åº”åˆ—ä¸Šåˆ›å»ºç´¢å¼•ï¼ˆå…·ä½“åŸå› ä¸‹æ–‡åˆ†æï¼‰ã€‚</li><li>ç¡®ä¿ä»»ä½•çš„GROUP BYå’ŒORDER BYä¸­çš„è¡¨è¾¾å¼åªæ¶‰åŠåˆ°ä¸€ä¸ªè¡¨ä¸­çš„åˆ—ï¼Œè¿™æ ·MySQLæ‰æœ‰å¯èƒ½ä½¿ç”¨ç´¢å¼•æ¥ä¼˜åŒ–ã€‚</li></ol><p>è¦ç†è§£ä¼˜åŒ–å…³è”æŸ¥è¯¢çš„ç¬¬ä¸€ä¸ªæŠ€å·§ï¼Œå°±éœ€è¦ç†è§£MySQLæ˜¯å¦‚ä½•æ‰§è¡Œå…³è”æŸ¥è¯¢çš„ã€‚å½“å‰MySQLå…³è”æ‰§è¡Œçš„ç­–ç•¥éå¸¸ç®€å•ï¼Œå®ƒå¯¹ä»»ä½•çš„å…³è”éƒ½æ‰§è¡ŒåµŒå¥—å¾ªç¯å…³è”æ“ä½œï¼Œå³å…ˆåœ¨ä¸€ä¸ªè¡¨ä¸­å¾ªç¯å–å‡ºå•æ¡æ•°æ®ï¼Œç„¶ååœ¨åµŒå¥—å¾ªç¯åˆ°ä¸‹ä¸€ä¸ªè¡¨ä¸­å¯»æ‰¾åŒ¹é…çš„è¡Œï¼Œä¾æ¬¡ä¸‹å»ï¼Œç›´åˆ°æ‰¾åˆ°æ‰€æœ‰è¡¨ä¸­åŒ¹é…çš„è¡Œä¸ºä¸ºæ­¢ã€‚ç„¶åæ ¹æ®å„ä¸ªè¡¨åŒ¹é…çš„è¡Œï¼Œè¿”å›æŸ¥è¯¢ä¸­éœ€è¦çš„å„ä¸ªåˆ—ã€‚</p><p>å¤ªæŠ½è±¡äº†ï¼Ÿä»¥ä¸Šé¢çš„ç¤ºä¾‹æ¥è¯´æ˜ï¼Œæ¯”å¦‚æœ‰è¿™æ ·çš„ä¸€ä¸ªæŸ¥è¯¢ï¼š</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">SELECT <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">A</span>.</span></span>xx,<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">B</span>.</span></span>yy<br><br>FROM A INNER JOIN B <span class="hljs-constructor">USING(<span class="hljs-params">c</span>)</span><br><br>WHERE <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">A</span>.</span></span>xx IN (<span class="hljs-number">5</span>,<span class="hljs-number">6</span>)<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>å‡è®¾MySQLæŒ‰ç…§æŸ¥è¯¢ä¸­çš„å…³è”é¡ºåºAã€Bæ¥è¿›è¡Œå…³è”æ“ä½œï¼Œé‚£ä¹ˆå¯ä»¥ç”¨ä¸‹é¢çš„ä¼ªä»£ç è¡¨ç¤ºMySQLå¦‚ä½•å®Œæˆè¿™ä¸ªæŸ¥è¯¢ï¼š</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">outer_iterator = SELECT <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">A</span>.</span></span>xx,<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">A</span>.</span></span>c FROM A WHERE <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">A</span>.</span></span>xx IN (<span class="hljs-number">5</span>,<span class="hljs-number">6</span>);<br><br>outer_row = outer_iterator.next;<br><br><span class="hljs-keyword">while</span>(outer_row) &#123;<br><br>    inner_iterator = SELECT <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">B</span>.</span></span>yy FROM B WHERE <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">B</span>.</span></span>c = outer_row.c;<br><br>    inner_row = inner_iterator.next;<br><br>    <span class="hljs-keyword">while</span>(inner_row) &#123;<br><br>        output<span class="hljs-literal">[<span class="hljs-identifier">inner_row</span>.<span class="hljs-identifier">yy</span>,<span class="hljs-identifier">outer_row</span>.<span class="hljs-identifier">xx</span>]</span>;<br><br>        inner_row = inner_iterator.next;<br><br>    &#125;<br><br>    outer_row = outer_iterator.next;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæœ€å¤–å±‚çš„æŸ¥è¯¢æ˜¯æ ¹æ®A.xxåˆ—æ¥æŸ¥è¯¢çš„ï¼ŒA.cä¸Šå¦‚æœæœ‰ç´¢å¼•çš„è¯ï¼Œæ•´ä¸ªå…³è”æŸ¥è¯¢ä¹Ÿä¸ä¼šä½¿ç”¨ã€‚å†çœ‹å†…å±‚çš„æŸ¥è¯¢ï¼Œå¾ˆæ˜æ˜¾B.cä¸Šå¦‚æœæœ‰ç´¢å¼•çš„è¯ï¼Œèƒ½å¤ŸåŠ é€ŸæŸ¥è¯¢ï¼Œå› æ­¤åªéœ€è¦åœ¨å…³è”é¡ºåºä¸­çš„ç¬¬äºŒå¼ è¡¨çš„ç›¸åº”åˆ—ä¸Šåˆ›å»ºç´¢å¼•å³å¯ã€‚</p><p><strong>ä¼˜åŒ–LIMITåˆ†é¡µ</strong><br> å½“éœ€è¦åˆ†é¡µæ“ä½œæ—¶ï¼Œé€šå¸¸ä¼šä½¿ç”¨LIMITåŠ ä¸Šåç§»é‡çš„åŠæ³•å®ç°ï¼ŒåŒæ—¶åŠ ä¸Šåˆé€‚çš„ORDER BYå­—å¥ã€‚å¦‚æœæœ‰å¯¹åº”çš„ç´¢å¼•ï¼Œé€šå¸¸æ•ˆç‡ä¼šä¸é”™ï¼Œå¦åˆ™ï¼ŒMySQLéœ€è¦åšå¤§é‡çš„æ–‡ä»¶æ’åºæ“ä½œã€‚</p><p>ä¸€ä¸ªå¸¸è§çš„é—®é¢˜æ˜¯å½“åç§»é‡éå¸¸å¤§çš„æ—¶å€™ï¼Œæ¯”å¦‚ï¼šLIMIT 10000 20è¿™æ ·çš„æŸ¥è¯¢ï¼ŒMySQLéœ€è¦æŸ¥è¯¢10020æ¡è®°å½•ç„¶ååªè¿”å›20æ¡è®°å½•ï¼Œå‰é¢çš„10000æ¡éƒ½å°†è¢«æŠ›å¼ƒï¼Œè¿™æ ·çš„ä»£ä»·éå¸¸é«˜ã€‚</p><p>ä¼˜åŒ–è¿™ç§æŸ¥è¯¢ä¸€ä¸ªæœ€ç®€å•çš„åŠæ³•å°±æ˜¯å°½å¯èƒ½çš„ä½¿ç”¨è¦†ç›–ç´¢å¼•æ‰«æï¼Œè€Œä¸æ˜¯æŸ¥è¯¢æ‰€æœ‰çš„åˆ—ã€‚ç„¶åæ ¹æ®éœ€è¦åšä¸€æ¬¡å…³è”æŸ¥è¯¢å†è¿”å›æ‰€æœ‰çš„åˆ—ã€‚å¯¹äºåç§»é‡å¾ˆå¤§æ—¶ï¼Œè¿™æ ·åšçš„æ•ˆç‡ä¼šæå‡éå¸¸å¤§ã€‚è€ƒè™‘ä¸‹é¢çš„æŸ¥è¯¢ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> film_id,description <span class="hljs-keyword">FROM</span> film <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">title</span> <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">50</span>,<span class="hljs-number">5</span>;<br></code></pre></td></tr></table></figure><p>å¦‚æœè¿™å¼ è¡¨éå¸¸å¤§ï¼Œé‚£ä¹ˆè¿™ä¸ªæŸ¥è¯¢æœ€å¥½æ”¹æˆä¸‹é¢çš„æ ·å­ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> film.film_id,film.description<br><br><span class="hljs-keyword">FROM</span> film <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> (<br><br>    <span class="hljs-keyword">SELECT</span> film_id <span class="hljs-keyword">FROM</span> film <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">title</span> <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">50</span>,<span class="hljs-number">5</span><br><br>) <span class="hljs-keyword">AS</span> tmp <span class="hljs-keyword">USING</span>(film_id);<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„å»¶è¿Ÿå…³è”å°†å¤§å¤§æå‡æŸ¥è¯¢æ•ˆç‡ï¼Œè®©MySQLæ‰«æå°½å¯èƒ½å°‘çš„é¡µé¢ï¼Œè·å–éœ€è¦è®¿é—®çš„è®°å½•ååœ¨æ ¹æ®å…³è”åˆ—å›åŸè¡¨æŸ¥è¯¢æ‰€éœ€è¦çš„åˆ—ã€‚</p><p>æœ‰æ—¶å€™å¦‚æœå¯ä»¥ä½¿ç”¨ä¹¦ç­¾è®°å½•ä¸Šæ¬¡å–æ•°æ®çš„ä½ç½®ï¼Œé‚£ä¹ˆä¸‹æ¬¡å°±å¯ä»¥ç›´æ¥ä»è¯¥ä¹¦ç­¾è®°å½•çš„ä½ç½®å¼€å§‹æ‰«æï¼Œè¿™æ ·å°±å¯ä»¥é¿å…ä½¿ç”¨OFFSETï¼Œæ¯”å¦‚ä¸‹é¢çš„æŸ¥è¯¢ï¼š<br> <code>SELECT id FROM t LIMIT 10000, 10;</code><br> æ”¹ä¸ºï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> id <span class="hljs-keyword">FROM</span> t <span class="hljs-keyword">WHERE</span> id &gt; <span class="hljs-number">10000</span> <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">10</span>;<br></code></pre></td></tr></table></figure><p>å…¶å®ƒä¼˜åŒ–çš„åŠæ³•è¿˜åŒ…æ‹¬ä½¿ç”¨é¢„å…ˆè®¡ç®—çš„æ±‡æ€»è¡¨ï¼Œæˆ–è€…å…³è”åˆ°ä¸€ä¸ªå†—ä½™è¡¨ï¼Œå†—ä½™è¡¨ä¸­åªåŒ…å«ä¸»é”®åˆ—å’Œéœ€è¦åšæ’åºçš„åˆ—ã€‚</p><p><strong>ä¼˜åŒ–UNION</strong><br> MySQLå¤„ç†UNIONçš„ç­–ç•¥æ˜¯å…ˆåˆ›å»ºä¸´æ—¶è¡¨ï¼Œç„¶åå†æŠŠå„ä¸ªæŸ¥è¯¢ç»“æœæ’å…¥åˆ°ä¸´æ—¶è¡¨ä¸­ï¼Œæœ€åå†æ¥åšæŸ¥è¯¢ã€‚å› æ­¤å¾ˆå¤šä¼˜åŒ–ç­–ç•¥åœ¨UNIONæŸ¥è¯¢ä¸­éƒ½æ²¡æœ‰åŠæ³•å¾ˆå¥½çš„æ—¶å€™ã€‚ç»å¸¸éœ€è¦æ‰‹åŠ¨å°†WHEREã€LIMITã€ORDER BYç­‰å­—å¥â€œä¸‹æ¨â€åˆ°å„ä¸ªå­æŸ¥è¯¢ä¸­ï¼Œä»¥ä¾¿ä¼˜åŒ–å™¨å¯ä»¥å……åˆ†åˆ©ç”¨è¿™äº›æ¡ä»¶å…ˆä¼˜åŒ–ã€‚</p><p>é™¤éç¡®å®éœ€è¦æœåŠ¡å™¨å»é‡ï¼Œå¦åˆ™å°±ä¸€å®šè¦ä½¿ç”¨UNION ALLï¼Œå¦‚æœæ²¡æœ‰ALLå…³é”®å­—ï¼ŒMySQLä¼šç»™ä¸´æ—¶è¡¨åŠ ä¸ŠDISTINCTé€‰é¡¹ï¼Œè¿™ä¼šå¯¼è‡´æ•´ä¸ªä¸´æ—¶è¡¨çš„æ•°æ®åšå”¯ä¸€æ€§æ£€æŸ¥ï¼Œè¿™æ ·åšçš„ä»£ä»·éå¸¸é«˜ã€‚å½“ç„¶å³ä½¿ä½¿ç”¨ALLå…³é”®å­—ï¼ŒMySQLæ€»æ˜¯å°†ç»“æœæ”¾å…¥ä¸´æ—¶è¡¨ï¼Œç„¶åå†è¯»å‡ºï¼Œå†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚è™½ç„¶å¾ˆå¤šæ—¶å€™æ²¡æœ‰è¿™ä¸ªå¿…è¦ï¼Œæ¯”å¦‚æœ‰æ—¶å€™å¯ä»¥ç›´æ¥æŠŠæ¯ä¸ªå­æŸ¥è¯¢çš„ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><p><strong>ç»“è¯­</strong><br> ç†è§£æŸ¥è¯¢æ˜¯å¦‚ä½•æ‰§è¡Œä»¥åŠæ—¶é—´éƒ½æ¶ˆè€—åœ¨å“ªäº›åœ°æ–¹ï¼Œå†åŠ ä¸Šä¸€äº›ä¼˜åŒ–è¿‡ç¨‹çš„çŸ¥è¯†ï¼Œå¯ä»¥å¸®åŠ©å¤§å®¶æ›´å¥½çš„ç†è§£MySQLï¼Œç†è§£å¸¸è§ä¼˜åŒ–æŠ€å·§èƒŒåçš„åŸç†ã€‚å¸Œæœ›æœ¬æ–‡ä¸­çš„åŸç†ã€ç¤ºä¾‹èƒ½å¤Ÿå¸®åŠ©å¤§å®¶æ›´å¥½çš„å°†ç†è®ºå’Œå®è·µè”ç³»èµ·æ¥ï¼Œæ›´å¤šçš„å°†ç†è®ºçŸ¥è¯†è¿ç”¨åˆ°å®è·µä¸­ã€‚</p><p>å…¶ä»–ä¹Ÿæ²¡å•¥è¯´çš„äº†ï¼Œç»™å¤§å®¶ç•™ä¸¤ä¸ªæ€è€ƒé¢˜å§ï¼Œå¯ä»¥åœ¨è„‘è¢‹é‡Œæƒ³æƒ³ç­”æ¡ˆï¼Œè¿™ä¹Ÿæ˜¯å¤§å®¶ç»å¸¸æŒ‚åœ¨å˜´è¾¹çš„ï¼Œä½†å¾ˆå°‘æœ‰äººä¼šæ€è€ƒä¸ºä»€ä¹ˆï¼Ÿ</p><ol><li>æœ‰éå¸¸å¤šçš„ç¨‹åºå‘˜åœ¨åˆ†äº«æ—¶éƒ½ä¼šæŠ›å‡ºè¿™æ ·ä¸€ä¸ªè§‚ç‚¹ï¼šå°½å¯èƒ½ä¸è¦ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹ï¼Œå­˜å‚¨è¿‡ç¨‹éå¸¸ä¸å®¹æ˜“ç»´æŠ¤ï¼Œä¹Ÿä¼šå¢åŠ ä½¿ç”¨æˆæœ¬ï¼Œåº”è¯¥æŠŠä¸šåŠ¡é€»è¾‘æ”¾åˆ°å®¢æˆ·ç«¯ã€‚æ—¢ç„¶å®¢æˆ·ç«¯éƒ½èƒ½å¹²è¿™äº›äº‹ï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜è¦å­˜å‚¨è¿‡ç¨‹ï¼Ÿ</li><li>JOINæœ¬èº«ä¹ŸæŒºæ–¹ä¾¿çš„ï¼Œç›´æ¥æŸ¥è¯¢å°±å¥½äº†ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦è§†å›¾å‘¢ï¼Ÿ</li></ol>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„çš„ä¸‰ç§æ–¹å¼</title>
    <link href="/blog/2021/05/24/%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E6%9C%89%E5%BA%8F%E6%95%B0%E7%BB%84%E7%9A%84%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F/"/>
    <url>/blog/2021/05/24/%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E6%9C%89%E5%BA%8F%E6%95%B0%E7%BB%84%E7%9A%84%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p>è¿™æ˜¯ LeetCode ä¸Šçš„ <strong><a href="https://leetcode-cn.com/problems/merge-sorted-array/solution/gong-shui-san-xie-yi-ti-san-jie-shuang-z-47gj/">88. åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„</a></strong> ã€‚</p><p>Tag : ã€ŒåŒæŒ‡é’ˆã€ã€ã€Œæ’åºã€</p><p>ç»™ä½ ä¸¤ä¸ªæœ‰åºæ•´æ•°æ•°ç»„ nums1 å’Œ nums2ï¼Œè¯·ä½ å°† nums2 åˆå¹¶åˆ° nums1 ä¸­ï¼Œä½¿ nums1 æˆä¸ºä¸€ä¸ªæœ‰åºæ•°ç»„ã€‚</p><p>åˆå§‹åŒ– nums1 å’Œ nums2 çš„å…ƒç´ æ•°é‡åˆ†åˆ«ä¸º m å’Œ n ã€‚</p><p>ä½ å¯ä»¥å‡è®¾ nums1 çš„ç©ºé—´å¤§å°ç­‰äº m + nï¼Œè¿™æ ·å®ƒå°±æœ‰è¶³å¤Ÿçš„ç©ºé—´ä¿å­˜æ¥è‡ª nums2 çš„å…ƒç´ ã€‚</p><p>ç¤ºä¾‹ 1ï¼š</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs nix">è¾“å…¥ï¼š<span class="hljs-attr">nums1</span> = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>], <span class="hljs-attr">m</span> = <span class="hljs-number">3</span>, <span class="hljs-attr">nums2</span> = [<span class="hljs-number">2</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>], <span class="hljs-attr">n</span> = <span class="hljs-number">3</span><br><br>è¾“å‡ºï¼š[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>]<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹ 2ï¼š</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs nix">è¾“å…¥ï¼š<span class="hljs-attr">nums1</span> = [<span class="hljs-number">1</span>], <span class="hljs-attr">m</span> = <span class="hljs-number">1</span>, <span class="hljs-attr">nums2</span> = [], <span class="hljs-attr">n</span> = <span class="hljs-number">0</span><br><br>è¾“å‡ºï¼š[<span class="hljs-number">1</span>]<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>æç¤ºï¼š</p><ul><li>nums1.length == m + n</li><li>nums2.length == n</li><li>0 &lt;= m, n &lt;= 200</li><li>1 &lt;= m + n &lt;= 200</li><li>-10910^9109 &lt;= nums1[i], nums2[i] &lt;= 10910^9109</li></ul><hr><h3 id="åŒæŒ‡é’ˆï¼ˆé¢å¤–ç©ºé—´ï¼‰"><a href="#åŒæŒ‡é’ˆï¼ˆé¢å¤–ç©ºé—´ï¼‰" class="headerlink" title="åŒæŒ‡é’ˆï¼ˆé¢å¤–ç©ºé—´ï¼‰"></a>åŒæŒ‡é’ˆï¼ˆé¢å¤–ç©ºé—´ï¼‰</h3><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/e248acc91ba9435d80739fd0f6505724~tplv-k3u1fbpfcp-zoom-1.image" alt="image.png"></p><p>ä¸€ä¸ªç®€å•çš„åšæ³•æ˜¯ï¼Œåˆ›å»ºä¸€ä¸ªå’Œ nums1nums1nums1 ç­‰é•¿çš„æ•°ç»„ arrarrarrï¼Œä½¿ç”¨åŒæŒ‡é’ˆå°† num1num1num1 å’Œ nums2nums2nums2 çš„æ•°æ®è¿ç§»åˆ° arrarrarrã€‚</p><p>æœ€åå†å°† arrarrarr å¤åˆ¶åˆ° nums1nums1nums1 ä¸­ã€‚</p><p>ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">merge</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] nums1, <span class="hljs-keyword">int</span> m, <span class="hljs-keyword">int</span>[] nums2, <span class="hljs-keyword">int</span> n)</span> </span>&#123;<br>        <span class="hljs-keyword">int</span> total = m + n;<br>        <span class="hljs-keyword">int</span>[] arr = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[total];<br>        <span class="hljs-keyword">int</span> idx = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>, j = <span class="hljs-number">0</span>; i &lt; m || j &lt; n;) &#123;<br>            <span class="hljs-keyword">if</span> (i &lt; m &amp;&amp; j &lt; n) &#123;<br>                arr[idx++] = nums1[i] &lt; nums2[j] ? nums1[i++] : nums2[j++];<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i &lt; m) &#123;<br>                arr[idx++] = nums1[i++];<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (j &lt; n) &#123;<br>                arr[idx++] = nums2[j++];<br>            &#125;<br>        &#125;<br>        System.arraycopy(arr, <span class="hljs-number">0</span>, nums1, <span class="hljs-number">0</span>, total);<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><ul><li>æ—¶é—´å¤æ‚åº¦ï¼šO(m+n)O(m + n)O(m+n)</li><li>ç©ºé—´å¤æ‚åº¦ï¼šO(m+n)O(m + n)O(m+n)</li></ul><hr><h2 id="å…ˆåˆå¹¶å†æ’åº"><a href="#å…ˆåˆå¹¶å†æ’åº" class="headerlink" title="å…ˆåˆå¹¶å†æ’åº"></a>å…ˆåˆå¹¶å†æ’åº</h2><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/c4cc438310fe46a688ea5b21037eac62~tplv-k3u1fbpfcp-zoom-1.image" alt="image.png"></p><p>æˆ‘ä»¬è¿˜å¯ä»¥å°† nums2nums2nums2 çš„å†…å®¹å…ˆè¿ç§»åˆ° nums1nums1nums1 å»ï¼Œå†å¯¹ nums1nums1nums1 è¿›è¡Œæ’åºã€‚</p><p>ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">merge</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] nums1, <span class="hljs-keyword">int</span> m, <span class="hljs-keyword">int</span>[] nums2, <span class="hljs-keyword">int</span> n)</span> </span>&#123;<br>        System.arraycopy(nums2, <span class="hljs-number">0</span>, nums1, m, n);<br>        Arrays.sort(nums1);<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><ul><li>æ—¶é—´å¤æ‚åº¦ï¼šO((m+n)log(m+n))O((m + n)log{(m + n)})O((m+n)log(m+n))</li><li>ç©ºé—´å¤æ‚åº¦ï¼šO(1)O(1)O(1)</li></ul><p><strong>PS. Java ä¸­çš„ sort æ’åºæ˜¯ä¸€ä¸ªç»¼åˆæ’åºã€‚åŒ…å«æ’å…¥/åŒè½´å¿«æ’/å½’å¹¶/timsortï¼Œè¿™é‡Œå‡å®š <code>Arrays.sort</code> ä½¿ç”¨çš„æ˜¯ã€ŒåŒè½´å¿«æ’ã€ï¼Œå¹¶å¿½ç•¥é€’å½’å¸¦æ¥çš„ç©ºé—´å¼€é”€ã€‚</strong></p><hr><h3 id="åŸåœ°åˆå¹¶ï¼ˆä»å‰å¾€åï¼‰"><a href="#åŸåœ°åˆå¹¶ï¼ˆä»å‰å¾€åï¼‰" class="headerlink" title="åŸåœ°åˆå¹¶ï¼ˆä»å‰å¾€åï¼‰"></a>åŸåœ°åˆå¹¶ï¼ˆä»å‰å¾€åï¼‰</h3><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/6ea5db94c11c46849c3073410d84ac81~tplv-k3u1fbpfcp-zoom-1.image" alt="image.png"></p><p>ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ nums1nums1nums1 è¿›è¡Œåˆå¹¶æ“ä½œï¼Œä½†æ˜¯éœ€è¦ç¡®ä¿æ¯æ¬¡å¾ªç¯å¼€å§‹ï¼Œnums2nums2nums2 çš„æŒ‡é’ˆæŒ‡å‘çš„å¿…ç„¶æ˜¯æœ€å°çš„å…ƒç´ ã€‚</p><p>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ nums2nums2nums2 æ‰§è¡Œå±€éƒ¨æ’åºã€‚</p><p>ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">merge</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] nums1, <span class="hljs-keyword">int</span> m, <span class="hljs-keyword">int</span>[] nums2, <span class="hljs-keyword">int</span> n)</span> </span>&#123;<br>        <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>, j = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">while</span> (j &lt; n) &#123;<br>            <span class="hljs-keyword">if</span> (i &gt;= m) &#123;<br>                nums1[i] = nums2[j++];<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">int</span> a = nums1[i], b = nums2[j];<br>                <span class="hljs-keyword">if</span> (a &gt; b) swap(nums1, i, nums2, j);<br>                sort(nums2, j, n - <span class="hljs-number">1</span>);<br>            &#125;<br>            i++;<br>        &#125;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sort</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] nums, <span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (l &gt;= r) <span class="hljs-keyword">return</span>;<br>        <span class="hljs-keyword">int</span> x = nums[l], i = l - <span class="hljs-number">1</span>, j = r + <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">while</span> (i &lt; j) &#123;<br>            <span class="hljs-keyword">do</span> i++; <span class="hljs-keyword">while</span> (nums[i] &lt; x);<br>            <span class="hljs-keyword">do</span> j--; <span class="hljs-keyword">while</span> (nums[j] &gt; x);<br>            <span class="hljs-keyword">if</span> (i &lt; j) swap(nums, i, nums, j);<br>        &#125;<br>        sort(nums, l, j);<br>        sort(nums, j + <span class="hljs-number">1</span>, r);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">swap</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] nums1, <span class="hljs-keyword">int</span> i, <span class="hljs-keyword">int</span>[] nums2, <span class="hljs-keyword">int</span> j)</span> </span>&#123;<br>        <span class="hljs-keyword">int</span> tmp = nums1[i];<br>        nums1[i] = nums2[j];<br>        nums2[j] = tmp;<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><ul><li>æ—¶é—´å¤æ‚åº¦ï¼šO(n+m2logm)O(n + m^2 log{m})O(n+m2logm)</li><li>ç©ºé—´å¤æ‚åº¦ï¼šå¿½ç•¥é€’å½’å¼€é”€ï¼Œå¤æ‚åº¦ä¸º O(1)O(1)O(1)</li></ul><hr><h3 id="åŸåœ°åˆå¹¶ï¼ˆä»åå¾€å‰ï¼‰"><a href="#åŸåœ°åˆå¹¶ï¼ˆä»åå¾€å‰ï¼‰" class="headerlink" title="åŸåœ°åˆå¹¶ï¼ˆä»åå¾€å‰ï¼‰"></a>åŸåœ°åˆå¹¶ï¼ˆä»åå¾€å‰ï¼‰</h3><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/59720e362b38429f9e4823e78633ad81~tplv-k3u1fbpfcp-zoom-1.image" alt="image.png"></p><p>æ€è·¯å’Œã€Œæ–¹æ³•ä¸€ã€æ˜¯ç±»ä¼¼çš„ï¼Œå°†éå†æ–¹å‘ç”±ã€Œä»å‰å¾€åã€è°ƒæ•´ä¸ºã€Œä»åå¾€å‰ã€å³å¯åšåˆ° O(1)O(1)O(1) ç©ºé—´å¤æ‚åº¦ã€‚</p><p>ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">merge</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] nums1, <span class="hljs-keyword">int</span> m, <span class="hljs-keyword">int</span>[] nums2, <span class="hljs-keyword">int</span> n)</span> </span>&#123;<br>        <span class="hljs-keyword">int</span> i = m - <span class="hljs-number">1</span>, j = n - <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">int</span> idx = m + n - <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">while</span> (i &gt;= <span class="hljs-number">0</span> || j &gt;= <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">if</span> (i &gt;= <span class="hljs-number">0</span> &amp;&amp; j &gt;= <span class="hljs-number">0</span>) &#123;<br>                nums1[idx--] = nums1[i] &gt;= nums2[j] ? nums1[i--] : nums2[j--];<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i &gt;= <span class="hljs-number">0</span>) &#123;<br>                nums1[idx--] = nums1[i--];<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                nums1[idx--] = nums2[j--];<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><ul><li>æ—¶é—´å¤æ‚åº¦ï¼šO(m+n)O(m + n)O(m+n)</li><li>ç©ºé—´å¤æ‚åº¦ï¼šO(1)O(1)O(1)</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>æ•°ç»„</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redisä¸MySQLåŒå†™ä¸€è‡´æ€§å¦‚ä½•ä¿è¯</title>
    <link href="/blog/2021/05/23/Redis%E4%B8%8EMySQL%E5%8F%8C%E5%86%99%E4%B8%80%E8%87%B4%E6%80%A7%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81/"/>
    <url>/blog/2021/05/23/Redis%E4%B8%8EMySQL%E5%8F%8C%E5%86%99%E4%B8%80%E8%87%B4%E6%80%A7%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81/</url>
    
    <content type="html"><![CDATA[<h2 id="è°ˆè°ˆä¸€è‡´æ€§"><a href="#è°ˆè°ˆä¸€è‡´æ€§" class="headerlink" title="è°ˆè°ˆä¸€è‡´æ€§"></a>è°ˆè°ˆä¸€è‡´æ€§</h2><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/b1353d15b66d43eab2cf8fd9aceb61d9~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>ä¸€è‡´æ€§å°±æ˜¯æ•°æ®ä¿æŒä¸€è‡´ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¯ä»¥ç†è§£ä¸ºå¤šä¸ªèŠ‚ç‚¹ä¸­æ•°æ®çš„å€¼æ˜¯ä¸€è‡´çš„ã€‚</p><ul><li><strong>å¼ºä¸€è‡´æ€§</strong>ï¼šè¿™ç§ä¸€è‡´æ€§çº§åˆ«æ˜¯æœ€ç¬¦åˆç”¨æˆ·ç›´è§‰çš„ï¼Œå®ƒè¦æ±‚ç³»ç»Ÿå†™å…¥ä»€ä¹ˆï¼Œè¯»å‡ºæ¥çš„ä¹Ÿä¼šæ˜¯ä»€ä¹ˆï¼Œç”¨æˆ·ä½“éªŒå¥½ï¼Œä½†å®ç°èµ·æ¥å¾€å¾€å¯¹ç³»ç»Ÿçš„æ€§èƒ½å½±å“å¤§</li><li><strong>å¼±ä¸€è‡´æ€§</strong>ï¼šè¿™ç§ä¸€è‡´æ€§çº§åˆ«çº¦æŸäº†ç³»ç»Ÿåœ¨å†™å…¥æˆåŠŸåï¼Œä¸æ‰¿è¯ºç«‹å³å¯ä»¥è¯»åˆ°å†™å…¥çš„å€¼ï¼Œä¹Ÿä¸æ‰¿è¯ºå¤šä¹…ä¹‹åæ•°æ®èƒ½å¤Ÿè¾¾åˆ°ä¸€è‡´ï¼Œä½†ä¼šå°½å¯èƒ½åœ°ä¿è¯åˆ°æŸä¸ªæ—¶é—´çº§åˆ«ï¼ˆæ¯”å¦‚ç§’çº§åˆ«ï¼‰åï¼Œæ•°æ®èƒ½å¤Ÿè¾¾åˆ°ä¸€è‡´çŠ¶æ€</li><li><strong>æœ€ç»ˆä¸€è‡´æ€§</strong>ï¼šæœ€ç»ˆä¸€è‡´æ€§æ˜¯å¼±ä¸€è‡´æ€§çš„ä¸€ä¸ªç‰¹ä¾‹ï¼Œç³»ç»Ÿä¼šä¿è¯åœ¨ä¸€å®šæ—¶é—´å†…ï¼Œèƒ½å¤Ÿè¾¾åˆ°ä¸€ä¸ªæ•°æ®ä¸€è‡´çš„çŠ¶æ€ã€‚è¿™é‡Œä¹‹æ‰€ä»¥å°†æœ€ç»ˆä¸€è‡´æ€§å•ç‹¬æå‡ºæ¥ï¼Œæ˜¯å› ä¸ºå®ƒæ˜¯å¼±ä¸€è‡´æ€§ä¸­éå¸¸æ¨å´‡çš„ä¸€ç§ä¸€è‡´æ€§æ¨¡å‹ï¼Œä¹Ÿæ˜¯ä¸šç•Œåœ¨å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ•°æ®ä¸€è‡´æ€§ä¸Šæ¯”è¾ƒæ¨å´‡çš„æ¨¡å‹</li></ul><h2 id="ä¸‰ä¸ªç»å…¸çš„ç¼“å­˜æ¨¡å¼"><a href="#ä¸‰ä¸ªç»å…¸çš„ç¼“å­˜æ¨¡å¼" class="headerlink" title="ä¸‰ä¸ªç»å…¸çš„ç¼“å­˜æ¨¡å¼"></a>ä¸‰ä¸ªç»å…¸çš„ç¼“å­˜æ¨¡å¼</h2><p>ç¼“å­˜å¯ä»¥æå‡æ€§èƒ½ã€ç¼“è§£æ•°æ®åº“å‹åŠ›ï¼Œä½†æ˜¯ä½¿ç”¨ç¼“å­˜ä¹Ÿä¼šå¯¼è‡´æ•°æ®<strong>ä¸ä¸€è‡´æ€§</strong>çš„é—®é¢˜ã€‚ä¸€èˆ¬æˆ‘ä»¬æ˜¯å¦‚ä½•ä½¿ç”¨ç¼“å­˜å‘¢ï¼Ÿæœ‰ä¸‰ç§ç»å…¸çš„ç¼“å­˜æ¨¡å¼ï¼š</p><ul><li>Cache-Aside Pattern</li><li>Read-Through/Write through</li><li>Write behind</li></ul><h3 id="Cache-Aside-Pattern"><a href="#Cache-Aside-Pattern" class="headerlink" title="Cache-Aside Pattern"></a>Cache-Aside Pattern</h3><p>Cache-Aside Patternï¼Œå³<strong>æ—è·¯ç¼“å­˜æ¨¡å¼</strong>ï¼Œå®ƒçš„æå‡ºæ˜¯ä¸ºäº†å°½å¯èƒ½åœ°è§£å†³ç¼“å­˜ä¸æ•°æ®åº“çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€‚</p><h4 id="Cache-Asideè¯»æµç¨‹"><a href="#Cache-Asideè¯»æµç¨‹" class="headerlink" title="Cache-Asideè¯»æµç¨‹"></a>Cache-Asideè¯»æµç¨‹</h4><p><strong>Cache-Aside Pattern</strong>çš„è¯»è¯·æ±‚æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/16e4b4c301cc44a09b3fe1938d9c6d89~tplv-k3u1fbpfcp-zoom-1.image" alt="Cache-Asideè¯»è¯·æ±‚"></p><ol><li>è¯»çš„æ—¶å€™ï¼Œå…ˆè¯»ç¼“å­˜ï¼Œç¼“å­˜å‘½ä¸­çš„è¯ï¼Œç›´æ¥è¿”å›æ•°æ®</li><li>ç¼“å­˜æ²¡æœ‰å‘½ä¸­çš„è¯ï¼Œå°±å»è¯»æ•°æ®åº“ï¼Œä»æ•°æ®åº“å–å‡ºæ•°æ®ï¼Œæ”¾å…¥ç¼“å­˜åï¼ŒåŒæ—¶è¿”å›å“åº”ã€‚</li></ol><h4 id="Cache-Aside-å†™æµç¨‹"><a href="#Cache-Aside-å†™æµç¨‹" class="headerlink" title="Cache-Aside å†™æµç¨‹"></a>Cache-Aside å†™æµç¨‹</h4><p><strong>Cache-Aside Pattern</strong>çš„å†™è¯·æ±‚æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/b98a1c0f93cf442db57ac56b5b26c393~tplv-k3u1fbpfcp-zoom-1.image" alt="Cache-Asideå†™è¯·æ±‚"></p><p>æ›´æ–°çš„æ—¶å€™ï¼Œå…ˆ<strong>æ›´æ–°æ•°æ®åº“ï¼Œç„¶åå†åˆ é™¤ç¼“å­˜</strong>ã€‚</p><h3 id="Read-Through-Write-Throughï¼ˆè¯»å†™ç©¿é€ï¼‰"><a href="#Read-Through-Write-Throughï¼ˆè¯»å†™ç©¿é€ï¼‰" class="headerlink" title="Read-Through/Write-Throughï¼ˆè¯»å†™ç©¿é€ï¼‰"></a>Read-Through/Write-Throughï¼ˆè¯»å†™ç©¿é€ï¼‰</h3><p><strong>Read/Write Through</strong>æ¨¡å¼ä¸­ï¼ŒæœåŠ¡ç«¯æŠŠç¼“å­˜ä½œä¸ºä¸»è¦æ•°æ®å­˜å‚¨ã€‚åº”ç”¨ç¨‹åºè·Ÿæ•°æ®åº“ç¼“å­˜äº¤äº’ï¼Œéƒ½æ˜¯é€šè¿‡<strong>æŠ½è±¡ç¼“å­˜å±‚</strong>å®Œæˆçš„ã€‚</p><h4 id="Read-Through"><a href="#Read-Through" class="headerlink" title="Read-Through"></a>Read-Through</h4><p><strong>Read-Through</strong>çš„ç®€è¦æµç¨‹å¦‚ä¸‹</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/6eca809755b242119757201af531b3e2~tplv-k3u1fbpfcp-zoom-1.image" alt="Read Throughç®€è¦æµç¨‹"></p><ol><li>ä»ç¼“å­˜è¯»å–æ•°æ®ï¼Œè¯»åˆ°ç›´æ¥è¿”å›</li><li>å¦‚æœè¯»å–ä¸åˆ°çš„è¯ï¼Œä»æ•°æ®åº“åŠ è½½ï¼Œå†™å…¥ç¼“å­˜åï¼Œå†è¿”å›å“åº”ã€‚</li></ol><p>è¿™ä¸ªç®€è¦æµç¨‹æ˜¯ä¸æ˜¯è·Ÿ<strong>Cache-Aside</strong>å¾ˆåƒå‘¢ï¼Ÿå…¶å®<strong>Read-Through</strong>å°±æ˜¯å¤šäº†ä¸€å±‚<strong>Cache-Provider</strong>ï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/60d3de199b5f41daa0ad464596fd404d~tplv-k3u1fbpfcp-zoom-1.image" alt="Read-Throughæµç¨‹"></p><p>Read-Throughå®é™…åªæ˜¯åœ¨<strong>Cache-Aside</strong>ä¹‹ä¸Šè¿›è¡Œäº†ä¸€å±‚å°è£…ï¼Œå®ƒä¼šè®©ç¨‹åºä»£ç å˜å¾—æ›´ç®€æ´ï¼ŒåŒæ—¶ä¹Ÿå‡å°‘æ•°æ®æºä¸Šçš„è´Ÿè½½ã€‚</p><h4 id="Write-Through"><a href="#Write-Through" class="headerlink" title="Write-Through"></a>Write-Through</h4><p><strong>Write-Through</strong>æ¨¡å¼ä¸‹ï¼Œå½“å‘ç”Ÿå†™è¯·æ±‚æ—¶ï¼Œä¹Ÿæ˜¯ç”±<strong>ç¼“å­˜æŠ½è±¡å±‚</strong>å®Œæˆæ•°æ®æºå’Œç¼“å­˜æ•°æ®çš„æ›´æ–°,æµç¨‹å¦‚ä¸‹ï¼š <img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/bb1eaafc6ab14ca98fe603fad1fb7fc5~tplv-k3u1fbpfcp-zoom-1.image" alt="Write-Throughæµç¨‹"></p><h3 id="Write-behind-ï¼ˆå¼‚æ­¥ç¼“å­˜å†™å…¥ï¼‰"><a href="#Write-behind-ï¼ˆå¼‚æ­¥ç¼“å­˜å†™å…¥ï¼‰" class="headerlink" title="Write behind ï¼ˆå¼‚æ­¥ç¼“å­˜å†™å…¥ï¼‰"></a>Write behind ï¼ˆå¼‚æ­¥ç¼“å­˜å†™å…¥ï¼‰</h3><p><strong>Write behind</strong>è·Ÿ<strong>Read-Through/Write-Through</strong>æœ‰ç›¸ä¼¼çš„åœ°æ–¹ï¼Œéƒ½æ˜¯ç”±<code>Cache Provider</code>æ¥è´Ÿè´£ç¼“å­˜å’Œæ•°æ®åº“çš„è¯»å†™ã€‚å®ƒä¸¤åˆæœ‰ä¸ªå¾ˆå¤§çš„ä¸åŒï¼š<strong>Read/Write Through</strong>æ˜¯åŒæ­¥æ›´æ–°ç¼“å­˜å’Œæ•°æ®çš„ï¼Œ<strong>Write Behind</strong>åˆ™æ˜¯åªæ›´æ–°ç¼“å­˜ï¼Œä¸ç›´æ¥æ›´æ–°æ•°æ®åº“ï¼Œé€šè¿‡<strong>æ‰¹é‡å¼‚æ­¥</strong>çš„æ–¹å¼æ¥æ›´æ–°æ•°æ®åº“ã€‚</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/81197a8c7a164b0b9a76b8380ae29a4b~tplv-k3u1fbpfcp-watermark.image" alt="Write behindæµç¨‹"></p><p>è¿™ç§æ–¹å¼ä¸‹ï¼Œç¼“å­˜å’Œæ•°æ®åº“çš„ä¸€è‡´æ€§ä¸å¼ºï¼Œ<strong>å¯¹ä¸€è‡´æ€§è¦æ±‚é«˜çš„ç³»ç»Ÿè¦è°¨æ…ä½¿ç”¨</strong>ã€‚ä½†æ˜¯å®ƒé€‚åˆé¢‘ç¹å†™çš„åœºæ™¯ï¼ŒMySQLçš„<strong>InnoDB Buffer Poolæœºåˆ¶</strong>å°±ä½¿ç”¨åˆ°è¿™ç§æ¨¡å¼ã€‚</p><h2 id="æ“ä½œç¼“å­˜çš„æ—¶å€™ï¼Œåˆ é™¤ç¼“å­˜å‘¢ï¼Œè¿˜æ˜¯æ›´æ–°ç¼“å­˜ï¼Ÿ"><a href="#æ“ä½œç¼“å­˜çš„æ—¶å€™ï¼Œåˆ é™¤ç¼“å­˜å‘¢ï¼Œè¿˜æ˜¯æ›´æ–°ç¼“å­˜ï¼Ÿ" class="headerlink" title="æ“ä½œç¼“å­˜çš„æ—¶å€™ï¼Œåˆ é™¤ç¼“å­˜å‘¢ï¼Œè¿˜æ˜¯æ›´æ–°ç¼“å­˜ï¼Ÿ"></a>æ“ä½œç¼“å­˜çš„æ—¶å€™ï¼Œåˆ é™¤ç¼“å­˜å‘¢ï¼Œè¿˜æ˜¯æ›´æ–°ç¼“å­˜ï¼Ÿ</h2><p>ä¸€èˆ¬ä¸šåŠ¡åœºæ™¯ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„å°±æ˜¯<strong>Cache-Aside</strong>æ¨¡å¼ã€‚ æœ‰äº›å°ä¼™ä¼´å¯èƒ½ä¼šé—®ï¼Œ <strong>Cache-Aside</strong>åœ¨å†™å…¥è¯·æ±‚çš„æ—¶å€™ï¼Œä¸ºä»€ä¹ˆæ˜¯<strong>åˆ é™¤ç¼“å­˜è€Œä¸æ˜¯æ›´æ–°ç¼“å­˜</strong>å‘¢ï¼Ÿ</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/75b7c68482364471a922b713b35128f6~tplv-k3u1fbpfcp-watermark.image" alt="Cache-Asideå†™å…¥æµç¨‹"></p><p>æˆ‘ä»¬åœ¨æ“ä½œç¼“å­˜çš„æ—¶å€™ï¼Œåˆ°åº•åº”è¯¥åˆ é™¤ç¼“å­˜è¿˜æ˜¯æ›´æ–°ç¼“å­˜å‘¢ï¼Ÿæˆ‘ä»¬å…ˆæ¥çœ‹ä¸ªä¾‹å­ï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/fbc52abea19746dd8db070253f3a4609~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><ol><li>çº¿ç¨‹Aå…ˆå‘èµ·ä¸€ä¸ªå†™æ“ä½œï¼Œç¬¬ä¸€æ­¥å…ˆæ›´æ–°æ•°æ®åº“</li><li>çº¿ç¨‹Bå†å‘èµ·ä¸€ä¸ªå†™æ“ä½œï¼Œç¬¬äºŒæ­¥æ›´æ–°äº†æ•°æ®åº“</li><li>ç”±äºç½‘ç»œç­‰åŸå› ï¼Œçº¿ç¨‹Bå…ˆæ›´æ–°äº†ç¼“å­˜</li><li>çº¿ç¨‹Aæ›´æ–°ç¼“å­˜ã€‚</li></ol><p>è¿™æ—¶å€™ï¼Œç¼“å­˜ä¿å­˜çš„æ˜¯Açš„æ•°æ®ï¼ˆè€æ•°æ®ï¼‰ï¼Œæ•°æ®åº“ä¿å­˜çš„æ˜¯Bçš„æ•°æ®ï¼ˆæ–°æ•°æ®ï¼‰ï¼Œæ•°æ®<strong>ä¸ä¸€è‡´</strong>äº†ï¼Œè„æ•°æ®å‡ºç°å•¦ã€‚å¦‚æœæ˜¯<strong>åˆ é™¤ç¼“å­˜å–ä»£æ›´æ–°ç¼“å­˜</strong>åˆ™ä¸ä¼šå‡ºç°è¿™ä¸ªè„æ•°æ®é—®é¢˜ã€‚</p><p><strong>æ›´æ–°ç¼“å­˜ç›¸å¯¹äºåˆ é™¤ç¼“å­˜</strong>ï¼Œè¿˜æœ‰ä¸¤ç‚¹åŠ£åŠ¿ï¼š</p><ul><li>å¦‚æœä½ å†™å…¥çš„ç¼“å­˜å€¼ï¼Œæ˜¯ç»è¿‡å¤æ‚è®¡ç®—æ‰å¾—åˆ°çš„è¯ã€‚æ›´æ–°ç¼“å­˜é¢‘ç‡é«˜çš„è¯ï¼Œå°±æµªè´¹æ€§èƒ½å•¦ã€‚</li><li>åœ¨å†™æ•°æ®åº“åœºæ™¯å¤šï¼Œè¯»æ•°æ®åœºæ™¯å°‘çš„æƒ…å†µä¸‹ï¼Œæ•°æ®å¾ˆå¤šæ—¶å€™è¿˜æ²¡è¢«è¯»å–åˆ°ï¼Œåˆè¢«æ›´æ–°äº†ï¼Œè¿™ä¹Ÿæµªè´¹äº†æ€§èƒ½å‘¢(å®é™…ä¸Šï¼Œå†™å¤šçš„åœºæ™¯ï¼Œç”¨ç¼“å­˜ä¹Ÿä¸æ˜¯å¾ˆåˆ’ç®—äº†)</li></ul><h2 id="åŒå†™çš„æƒ…å†µä¸‹ï¼Œå…ˆæ“ä½œæ•°æ®åº“è¿˜æ˜¯å…ˆæ“ä½œç¼“å­˜ï¼Ÿ"><a href="#åŒå†™çš„æƒ…å†µä¸‹ï¼Œå…ˆæ“ä½œæ•°æ®åº“è¿˜æ˜¯å…ˆæ“ä½œç¼“å­˜ï¼Ÿ" class="headerlink" title="åŒå†™çš„æƒ…å†µä¸‹ï¼Œå…ˆæ“ä½œæ•°æ®åº“è¿˜æ˜¯å…ˆæ“ä½œç¼“å­˜ï¼Ÿ"></a>åŒå†™çš„æƒ…å†µä¸‹ï¼Œå…ˆæ“ä½œæ•°æ®åº“è¿˜æ˜¯å…ˆæ“ä½œç¼“å­˜ï¼Ÿ</h2><p><code>Cache-Aside</code>ç¼“å­˜æ¨¡å¼ä¸­ï¼Œæœ‰äº›å°ä¼™ä¼´è¿˜æ˜¯æœ‰ç–‘é—®ï¼Œåœ¨å†™å…¥è¯·æ±‚çš„æ—¶å€™ï¼Œä¸ºä»€ä¹ˆæ˜¯<strong>å…ˆæ“ä½œæ•°æ®åº“å‘¢</strong>ï¼Ÿä¸ºä»€ä¹ˆ<strong>ä¸å…ˆæ“ä½œç¼“å­˜</strong>å‘¢ï¼Ÿ</p><p>å‡è®¾æœ‰Aã€Bä¸¤ä¸ªè¯·æ±‚ï¼Œè¯·æ±‚Aåšæ›´æ–°æ“ä½œï¼Œè¯·æ±‚BåšæŸ¥è¯¢è¯»å–æ“ä½œã€‚ <img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/a30ff3d1b8374d1b8508200566b4e1c6~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p><ol><li>çº¿ç¨‹Aå‘èµ·ä¸€ä¸ªå†™æ“ä½œï¼Œç¬¬ä¸€æ­¥del cache</li><li>æ­¤æ—¶çº¿ç¨‹Bå‘èµ·ä¸€ä¸ªè¯»æ“ä½œï¼Œcache miss</li><li>çº¿ç¨‹Bç»§ç»­è¯»DBï¼Œè¯»å‡ºæ¥ä¸€ä¸ªè€æ•°æ®</li><li>ç„¶åçº¿ç¨‹BæŠŠè€æ•°æ®è®¾ç½®å…¥cache</li><li>çº¿ç¨‹Aå†™å…¥DBæœ€æ–°çš„æ•°æ®</li></ol><p>é…±ç´«å°±æœ‰é—®é¢˜å•¦ï¼Œ<strong>ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®ä¸ä¸€è‡´äº†ã€‚ç¼“å­˜ä¿å­˜çš„æ˜¯è€æ•°æ®ï¼Œæ•°æ®åº“ä¿å­˜çš„æ˜¯æ–°æ•°æ®</strong>ã€‚å› æ­¤ï¼Œ<code>Cache-Aside</code>ç¼“å­˜æ¨¡å¼ï¼Œé€‰æ‹©äº†å…ˆæ“ä½œæ•°æ®åº“è€Œä¸æ˜¯å…ˆæ“ä½œç¼“å­˜ã€‚</p><h3 id="ç¼“å­˜å»¶æ—¶åŒåˆ "><a href="#ç¼“å­˜å»¶æ—¶åŒåˆ " class="headerlink" title="ç¼“å­˜å»¶æ—¶åŒåˆ "></a>ç¼“å­˜å»¶æ—¶åŒåˆ </h3><p>æœ‰äº›å°ä¼™ä¼´å¯èƒ½ä¼šè¯´ï¼Œä¸ä¸€å®šè¦å…ˆæ“ä½œæ•°æ®åº“å‘€ï¼Œé‡‡ç”¨<strong>ç¼“å­˜å»¶æ—¶åŒåˆ </strong>ç­–ç•¥å°±å¥½å•¦ï¼Ÿä»€ä¹ˆæ˜¯å»¶æ—¶åŒåˆ å‘¢ï¼Ÿ</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/dc942a69d367464d9e778faf635f6448~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p><ol><li>å…ˆåˆ é™¤ç¼“å­˜</li><li>å†æ›´æ–°æ•°æ®åº“</li><li>ä¼‘çœ ä¸€ä¼šï¼ˆæ¯”å¦‚1ç§’ï¼‰ï¼Œå†æ¬¡åˆ é™¤ç¼“å­˜ã€‚</li></ol><p>è¿™ä¸ªä¼‘çœ ä¸€ä¼šï¼Œä¸€èˆ¬å¤šä¹…å‘¢ï¼Ÿéƒ½æ˜¯1ç§’ï¼Ÿ</p><blockquote><p>è¿™ä¸ªä¼‘çœ æ—¶é—´ =  è¯»ä¸šåŠ¡é€»è¾‘æ•°æ®çš„è€—æ—¶ + å‡ ç™¾æ¯«ç§’ã€‚ ä¸ºäº†ç¡®ä¿è¯»è¯·æ±‚ç»“æŸï¼Œå†™è¯·æ±‚å¯ä»¥åˆ é™¤è¯»è¯·æ±‚å¯èƒ½å¸¦æ¥çš„ç¼“å­˜è„æ•°æ®ã€‚</p></blockquote><h3 id="åˆ é™¤ç¼“å­˜é‡è¯•æœºåˆ¶"><a href="#åˆ é™¤ç¼“å­˜é‡è¯•æœºåˆ¶" class="headerlink" title="åˆ é™¤ç¼“å­˜é‡è¯•æœºåˆ¶"></a>åˆ é™¤ç¼“å­˜é‡è¯•æœºåˆ¶</h3><p>ä¸ç®¡æ˜¯<strong>å»¶æ—¶åŒåˆ </strong>è¿˜æ˜¯<strong>Cache-Asideçš„å…ˆæ“ä½œæ•°æ®åº“å†åˆ é™¤ç¼“å­˜</strong>ï¼Œå¦‚æœç¬¬äºŒæ­¥çš„åˆ é™¤ç¼“å­˜å¤±è´¥å‘¢ï¼Œåˆ é™¤å¤±è´¥ä¼šå¯¼è‡´è„æ•°æ®å“¦~</p><blockquote><p>åˆ é™¤å¤±è´¥å°±å¤šåˆ é™¤å‡ æ¬¡å‘€,ä¿è¯åˆ é™¤ç¼“å­˜æˆåŠŸå‘€~ æ‰€ä»¥å¯ä»¥å¼•å…¥<strong>åˆ é™¤ç¼“å­˜é‡è¯•æœºåˆ¶</strong></p></blockquote><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/85ce00ef5ad54984a0bbe183bd00b75e~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p><ol><li>å†™è¯·æ±‚æ›´æ–°æ•°æ®åº“</li><li>ç¼“å­˜å› ä¸ºæŸäº›åŸå› ï¼Œåˆ é™¤å¤±è´¥</li><li>æŠŠåˆ é™¤å¤±è´¥çš„keyæ”¾åˆ°æ¶ˆæ¯é˜Ÿåˆ—</li><li>æ¶ˆè´¹æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆæ¯ï¼Œè·å–è¦åˆ é™¤çš„key</li><li>é‡è¯•åˆ é™¤ç¼“å­˜æ“ä½œ</li></ol><h3 id="è¯»å–biglogå¼‚æ­¥åˆ é™¤ç¼“å­˜"><a href="#è¯»å–biglogå¼‚æ­¥åˆ é™¤ç¼“å­˜" class="headerlink" title="è¯»å–biglogå¼‚æ­¥åˆ é™¤ç¼“å­˜"></a>è¯»å–biglogå¼‚æ­¥åˆ é™¤ç¼“å­˜</h3><p>é‡è¯•åˆ é™¤ç¼“å­˜æœºåˆ¶è¿˜å¯ä»¥ï¼Œå°±æ˜¯ä¼šé€ æˆå¥½å¤šä¸šåŠ¡ä»£ç å…¥ä¾µã€‚å…¶å®ï¼Œè¿˜å¯ä»¥é€šè¿‡<strong>æ•°æ®åº“çš„binlogæ¥å¼‚æ­¥æ·˜æ±°key</strong>ã€‚</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/f94c4fb98d2f47948f522ddc3d3a10a5~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p><p>ä»¥mysqlä¸ºä¾‹ å¯ä»¥ä½¿ç”¨é˜¿é‡Œçš„canalå°†binlogæ—¥å¿—é‡‡é›†å‘é€åˆ°MQé˜Ÿåˆ—é‡Œé¢ï¼Œç„¶åé€šè¿‡ACKæœºåˆ¶ç¡®è®¤å¤„ç†è¿™æ¡æ›´æ–°æ¶ˆæ¯ï¼Œåˆ é™¤ç¼“å­˜ï¼Œä¿è¯æ•°æ®ç¼“å­˜ä¸€è‡´æ€§</p>]]></content>
    
    
    
    <tags>
      
      <tag>MySQL</tag>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JDK1.8æ–°ç‰¹æ€§ä¹‹Stream</title>
    <link href="/blog/2021/05/15/DK1.8%E6%96%B0%E7%89%B9%E6%80%A7%E4%B9%8BStream/"/>
    <url>/blog/2021/05/15/DK1.8%E6%96%B0%E7%89%B9%E6%80%A7%E4%B9%8BStream/</url>
    
    <content type="html"><![CDATA[<p>é›†åˆæ˜¯Javaä¸­ä½¿ç”¨æœ€å¤šçš„APIï¼Œå‡ ä¹æ¯ä¸ªç¨‹åºå‘˜å¤©å¤©éƒ½ä¼šå’Œå®ƒæ‰“æ‹›å‘¼ï¼Œå®ƒå¯ä»¥è®©ä½ æŠŠç›¸åŒã€ç›¸ä¼¼ã€æœ‰å…³è”çš„æ•°æ®æ•´åˆåœ¨ä¸€èµ·ï¼Œä¾¿äºä½¿ç”¨ã€æå–ä»¥åŠè¿ç®—ç­‰æ“ä½œã€‚åœ¨å®é™…Javaç¨‹åºä¸­ï¼Œé›†åˆçš„ä½¿ç”¨å¾€å¾€éšç€ä¸šåŠ¡éœ€æ±‚ã€å¤æ‚åº¦è€Œå˜å¾—æ›´åŠ å¤æ‚ï¼Œåœ¨è¿™å…¶ä¸­å°†å¯èƒ½ä¼šæ¶‰åŠåˆ°æ›´å¤šçš„è¿ç®—ï¼Œå¦‚ï¼šæ±‚å’Œã€å¹³å‡å€¼ã€åˆ†ç»„ã€è¿‡æ»¤ã€æ’åºç­‰ç­‰ã€‚å¦‚ä½•è¿™äº›æ“ä½œæ··åˆå‡ºç°ï¼Œåˆè¯¥å¦‚ä½•å®ç°ï¼Ÿéš¾é“éå†ã€å†éå†ã€å†è¿ç®—ä¹ˆï¼ŸæŠ›å¼€æ€§èƒ½å› ç´ ï¼Œè¿™äº›æ“ä½œå·²ç»ä¸¥é‡å½±å“äº†ä»£ç çš„æ•´æ´ï¼Œè¿™ç§ä»£ç ä¹Ÿæ²¡æœ‰å‡ ä¸ªäººæ„¿æ„æ¥è¯»ã€‚</p><p>é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆå¥½çš„åŠæ³•æ¥è§£å†³è¿™ç§ç°çŠ¶å‘¢ï¼Ÿæ¯•ç«Ÿé›†åˆæœ€ä¸ºæœ€å¸¸ç”¨çš„æ“ä½œï¼Œéš¾é“Javaè¯­è¨€çš„è®¾è®¡è€…æ²¡æœ‰æ„è¯†åˆ°è¿™ä¸€ç‚¹å—ï¼Ÿå¦‚ä½•èƒ½å¤Ÿå¸®åŠ©ä½ èŠ‚çº¦å®è´µçš„æ—¶é—´ï¼Œè®©ç¨‹åºå‘˜æ´»å¾—æ›´è½»æ¾ä¸€ç‚¹å‘¢ï¼Ÿ</p><p>ä½ å¯èƒ½å·²ç»çŒœåˆ°äº†ï¼Œç­”æ¡ˆå°±æ˜¯æµâ€”<strong>Stream</strong>ã€‚</p><p>æœ¬æ–‡å°†ä»<code>JDK1.8</code>ä¸­<code>Stream API</code>è®²èµ·ï¼Œè®©ä½ è§‰å¾—é›†åˆæ“ä½œåŸæ¥å¯ä»¥è¿™ä¹ˆè½»æ¾ä½¿ç”¨ã€‚</p><h1 id="ä¸€ã€Streamæ˜¯ä»€ä¹ˆ"><a href="#ä¸€ã€Streamæ˜¯ä»€ä¹ˆ" class="headerlink" title="ä¸€ã€Streamæ˜¯ä»€ä¹ˆ"></a>ä¸€ã€Streamæ˜¯ä»€ä¹ˆ</h1><p><code>Stream</code>æ˜¯<code>Java API</code>ä¸­çš„æ–°æˆå‘˜ï¼Œå®ƒå…è®¸ä½ ä»¥å£°æ˜çš„æ–¹å¼å¤„ç†æ•°æ®é›†åˆï¼ˆé€šè¿‡æŸ¥è¯¢è¯­å¥æ¥è¡¨è¾¾ï¼Œè€Œä¸æ˜¯ä¸´æ—¶ç¼–å†™ä¸€ä¸ªå®ç°ï¼‰ï¼Œä½ å¯ä»¥æŠŠå®ƒçœ‹æˆæ˜¯éå†æ•°æ®é›†çš„<strong>é«˜çº§è¿­ä»£å™¨</strong>ã€‚æ­¤å¤–ï¼ŒStreamè¿˜å¯ä»¥é€æ˜åœ°å¹¶è¡Œå¤„ç†ï¼Œè€Œæ— éœ€å†™ä»»ä½•å¤šçº¿ç¨‹ä»£ç äº†ã€‚</p><p>æˆ‘ä»¬å…ˆç®€å•çš„å¯¹æ¯”ä½¿ç”¨ä¸‹Streamçš„å¥½å¤„å§ã€‚ä¸‹é¢ä¸¤æ®µä»£ç éƒ½æ˜¯å®ç°ç­›é€‰å‡ºåå­—ä¸­åŒ…å«â€œxcâ€å­—ç¬¦ä¸²çš„äººï¼Œå¹¶æŒ‰ç…§å…¶å¹´é¾„è¿›è¡Œæ’åºã€‚</p><p>ä¼ ç»Ÿæ–¹å¼(JDK1.8ä¹‹å‰ï¼ŒéStreamæµ)ï¼š</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">List&lt;People&gt; peoples = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;<span class="hljs-literal">()</span>;<br><span class="hljs-comment">// éå† + åˆ¤æ–­</span><br><span class="hljs-keyword">for</span> (People people : allPeoples) &#123;<br>    <span class="hljs-keyword">if</span> (people.get<span class="hljs-constructor">Name()</span>.contains(<span class="hljs-string">&quot;xc&quot;</span>)) &#123;<br>        peoples.add(people);<br>    &#125;<br>&#125;<br><span class="hljs-comment">// å¯¹å¹´é¾„æ’åº</span><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Collections</span>.</span></span>sort(peoples, <span class="hljs-keyword">new</span> Comparator&lt;People&gt;<span class="hljs-literal">()</span> &#123;<br>    @Override<br>    public <span class="hljs-built_in">int</span> compare(People p1, People p2) &#123;<br>        return <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Integer</span>.</span></span>compare(p1.get<span class="hljs-constructor">Age()</span>, p2.get<span class="hljs-constructor">Age()</span>);<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><p>Streamæ–¹å¼:</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">List&lt;People&gt; peoples2 = allPeoples.stream<span class="hljs-literal">()</span><br>                .filter(people -&gt; people.get<span class="hljs-constructor">Name()</span>.contains(<span class="hljs-string">&quot;xc&quot;</span>))<br>                .sorted(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Comparator</span>.</span></span>comparing(People::getAge))<br>                .collect(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Collectors</span>.</span></span><span class="hljs-keyword">to</span><span class="hljs-constructor">List()</span>);<br></code></pre></td></tr></table></figure><p>æ²¡æœ‰å¯¹æ¯”å°±æ²¡æœ‰ä¼¤å®³ï¼Œæ•ˆæœæ˜¾è€Œæ˜“è§ã€‚ä»å¼€å‘è§’åº¦æ¥çœ‹ï¼ŒStreamæ–¹å¼æœ‰ä»¥ä¸‹æ˜¾è€Œæ˜“è§çš„å¥½å¤„ï¼š</p><ul><li>ä»£ç ä»¥å£°æ˜æ–¹å¼å†™çš„ï¼šè¯´æ˜æƒ³è¦å®Œæˆä»€ä¹ˆï¼ˆç­›é€‰å‡ºæ»¡è¶³æ¡ä»¶çš„æ•°æ®ï¼‰è€Œä¸æ˜¯è¯´æ˜å¦‚ä½•å®ç°ä¸€ä¸ªæ“ä½œï¼ˆåˆ©ç”¨å¾ªç¯å’Œifæ¡ä»¶ç­‰æ§åˆ¶æµè¯­å¥ï¼‰ã€‚</li><li>å¤šä¸ªåŸºæœ¬æ“ä½œé“¾æ¥èµ·æ¥ï¼šå°†å¤šä¸ªåŸºç¡€æ“ä½œé“¾æ¥èµ·æ¥ï¼Œæ¥è¡¨è¾¾å¤æ‚çš„æ•°æ®å¤„ç†æµæ°´çº¿(å¦‚ä¸‹å›¾)ï¼ŒåŒæ—¶ä½“ç°äº†ä»£ç çš„æ¸…æ™°ã€å¯è¯»æ€§ã€‚</li></ul><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/591b9bdf32584535bab881f93680853d~tplv-k3u1fbpfcp-zoom-1.image" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><code>Stream API</code>åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œç±»ä¼¼ä¸Šé¢Streamå¤„ç†æµæ°´çº¿æ–¹å¼åº”ç”¨åœºæ™¯å¾ˆå¤šï¼Œç†è®ºä¸Šå¯ä»¥ç”Ÿæˆä¸€ä¸ªå…·æœ‰æ— ç©·é•¿çš„æµæ°´çº¿çš„ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œåœ¨å¤æ‚ä¸šåŠ¡ä¸­ä½ ç”¨ä¸ç€ä¸ºäº†è®©æŸäº›æ•°æ®å¤„ç†ä»»åŠ¡å¹¶è¡Œè€Œå»æ“å¿ƒçº¿ç¨‹å’Œé”äº†ï¼Œ<code>Stream API</code>éƒ½æ›¿ä½ åšå¥½äº†ï¼</p><p><strong><code>Stream</code>ï¼Œå³ï¼šâ€æµâ€œï¼Œé€šè¿‡å°†é›†åˆè½¬æ¢ä¸ºä¸€ç§å«åšâ€æµâ€œçš„å…ƒç´ åºåˆ—ï¼Œé€šè¿‡å£°æ˜æ–¹å¼ï¼Œå¯¹é›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ è¿›è¡Œä¸€ç³»åˆ—å¹¶è¡Œæˆ–ä¸²è¡Œçš„æµæ°´çº¿æ“ä½œã€‚</strong></p><p>æ¢å¥è¯è¯´ï¼Œä½ åªéœ€è¦å‘Šè¯‰æµä½ çš„è¦æ±‚ï¼Œæµä¾¿ä¼šåœ¨èƒŒåè‡ªè¡Œæ ¹æ®è¦æ±‚å¯¹å…ƒç´ è¿›è¡Œå¤„ç†ï¼Œè€Œä½ åªéœ€è¦ <strong>â€œåäº«å…¶æˆâ€</strong>ã€‚</p><h1 id="äºŒã€Streamæ“ä½œ"><a href="#äºŒã€Streamæ“ä½œ" class="headerlink" title="äºŒã€Streamæ“ä½œ"></a>äºŒã€Streamæ“ä½œ</h1><p>æ•´ä¸ªæµæ“ä½œå°±æ˜¯ä¸€æ¡æµæ°´çº¿ï¼Œå°†å…ƒç´ æ”¾åœ¨æµæ°´çº¿ä¸Šä¸€ä¸ªä¸ªåœ°è¿›è¡Œå¤„ç†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/47e0cab765f74703858ef19dc028b56f~tplv-k3u1fbpfcp-zoom-1.image" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å…¶ä¸­ï¼Œæ•°æ®æºæ˜¯åŸå§‹é›†åˆæ•°æ®ï¼Œç„¶åå°†å¦‚ <code>List&lt;T&gt; </code>çš„é›†åˆè½¬æ¢ä¸º<code>Stream&lt;T&gt;</code>ç±»å‹çš„æµï¼Œå¹¶å¯¹æµè¿›è¡Œä¸€ç³»åˆ—çš„æ“ä½œï¼Œæ¯”å¦‚è¿‡æ»¤ä¿ç•™éƒ¨åˆ†å…ƒç´ ã€å¯¹å…ƒç´ è¿›è¡Œæ’åºã€ç±»å‹è½¬æ¢ç­‰ï¼Œæœ€åå†è¿›è¡Œä¸€ä¸ªç»ˆæ­¢æ“ä½œï¼Œå¯ä»¥æŠŠ Stream è½¬æ¢å›é›†åˆç±»å‹ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å¯¹å…¶ä¸­çš„å„ä¸ªå…ƒç´ è¿›è¡Œå¤„ç†ï¼Œæ¯”å¦‚æ‰“å°ã€æ¯”å¦‚è®¡ç®—æ€»æ•°ã€è®¡ç®—æœ€å¤§å€¼ç­‰ã€‚</p><p>å¾ˆå¤šæµæ“ä½œæœ¬èº«å°±ä¼šè¿”å›ä¸€ä¸ªæµï¼Œæ‰€ä»¥å¤šä¸ªæ“ä½œå¯ä»¥ç›´æ¥è¿æ¥èµ·æ¥ï¼Œå°±å¦‚ä¸Šé¢ä¸¾ä¾‹ä¸­Streamæ–¹å¼çš„ä»£ç ä¸€æ ·ã€‚ <img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/109e8c6bf1e2440a8a84454b0e25bef7~tplv-k3u1fbpfcp-zoom-1.image" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å¦‚æœæ˜¯ä»¥å‰ï¼Œè¿›è¡Œè¿™ä¹ˆä¸€ç³»åˆ—æ“ä½œï¼Œä½ éœ€è¦åšä¸ªè¿­ä»£å™¨æˆ–è€… foreach å¾ªç¯ï¼Œç„¶åéå†ï¼Œä¸€æ­¥æ­¥åœ°äº²åŠ›äº²ä¸ºåœ°å»å®Œæˆè¿™äº›æ“ä½œã€‚ä½†æ˜¯å¦‚æœä½¿ç”¨æµï¼Œä½ ä¾¿å¯ä»¥ç›´æ¥å£°æ˜å¼åœ°ä¸‹æŒ‡ä»¤ï¼Œæµä¼šå¸®ä½ å®Œæˆè¿™äº›æ“ä½œã€‚</p><p>é€šè¿‡ä¸Šé¢Streamæ“ä½œæµæ°´çº¿ã€å®ä¾‹ï¼Œ<strong>Streamæ“ä½œå¤§ä½“ä¸Šåˆ†ä¸ºä¸¤ç§ï¼šä¸­é—´æ“ä½œç¬¦å’Œç»ˆæ­¢æ“ä½œç¬¦ã€‚</strong></p><h2 id="1-ä¸­é—´æ“ä½œç¬¦"><a href="#1-ä¸­é—´æ“ä½œç¬¦" class="headerlink" title="1. ä¸­é—´æ“ä½œç¬¦"></a>1. ä¸­é—´æ“ä½œç¬¦</h2><p>å¯¹äºæ•°æ®æµæ¥è¯´ï¼Œä¸­é—´æ“ä½œç¬¦åœ¨æ‰§è¡ŒæŒ‡å®šå¤„ç†é€»è¾‘åï¼Œæ•°æ®æµä¾ç„¶å¯ä»¥ä¼ é€’ç»™ä¸‹ä¸€çº§çš„æ“ä½œç¬¦ã€‚</p><p>ä¸­é—´æ“ä½œç¬¦åŒ…å«8ç§ï¼š</p><ul><li><code>map(mapToIntï¼ŒmapToLongï¼ŒmapToDouble)</code> è½¬æ¢æ“ä½œï¼šæŠŠæ¯”å¦‚<code>A-&gt;B</code>ï¼Œè¿™é‡Œé»˜è®¤æä¾›äº†è½¬<code>int</code>ï¼Œ<code>long</code>ï¼Œ<code>double</code>çš„æ“ä½œç¬¦ã€‚</li><li><code>flatmap(flatmapToIntï¼ŒflatmapToLong,flatmapToDouble) </code>æ‹å¹³æ“ä½œï¼šæ¯”å¦‚æŠŠ<code>int[]&#123;2,3,4&#125;</code>æ‹å¹³å˜æˆ <code>2ï¼Œ3ï¼Œ4 </code>,ä¹Ÿå°±æ˜¯ä»åŸæ¥çš„ä¸€ä¸ªæ•°æ®å˜æˆäº†3ä¸ªæ•°æ®ï¼Œè¿™é‡Œé»˜è®¤æä¾›äº†æ‹å¹³æˆ<code>int</code>,<code>long</code>,<code>double</code>çš„æ“ä½œã€‚</li><li><code>limit </code>é™æµæ“ä½œï¼šæ¯”å¦‚æ•°æ®æµä¸­æœ‰10ä¸ªï¼Œæˆ‘åªè¦å‰3ä¸ªå°±å¯ä»¥ä½¿ç”¨ã€‚</li><li><code>distinct</code>å»é‡æ“ä½œï¼šé‡å¤å…ƒç´ å»é‡ã€‚</li><li><code>filter</code>è¿‡æ»¤æ“ä½œï¼šå¯¹é›†åˆæ•°æ®è¿›è¡Œè¿‡æ»¤ã€‚</li><li><code>peek</code>æ¶ˆè´¹æ“ä½œï¼šå¦‚æœæƒ³å¯¹æ•°æ®è¿›è¡ŒæŸäº›æ“ä½œï¼Œå¦‚ï¼šè¯»å–ã€ç¼–è¾‘ä¿®æ”¹ç­‰ã€‚</li><li><code>skip</code>è·³è¿‡æ“ä½œï¼šè·³è¿‡æŸäº›å…ƒç´ ã€‚</li><li><code>sorted</code>æ’åºæ“ä½œï¼šå¯¹å…ƒç´ æ’åºï¼Œå‰ææ˜¯å®ç°Comparableæ¥å£ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ¯”è¾ƒå™¨ã€‚</li></ul><p>ï¼ˆå…·ä½“å¯å‚ç…§æºç <code>java.util.stream.Stream</code>ï¼‰</p><h2 id="2-ç»ˆæ­¢æ“ä½œç¬¦"><a href="#2-ç»ˆæ­¢æ“ä½œç¬¦" class="headerlink" title="2. ç»ˆæ­¢æ“ä½œç¬¦"></a>2. ç»ˆæ­¢æ“ä½œç¬¦</h2><p>æ•°æ®ç»è¿‡ä¸€ç³»åˆ—çš„ä¸­é—´æ“ä½œï¼Œå°±è½®åˆ°ç»ˆæ­¢æ“ä½œç¬¦ä¸Šåœºäº†ã€‚ç»ˆæ­¢æ“ä½œç¬¦å°±æ˜¯ç”¨æ¥å¯¹æ•°æ®è¿›è¡Œæ”¶é›†æˆ–è€…æ¶ˆè´¹çš„ï¼Œæ•°æ®åˆ°äº†ç»ˆæ­¢æ“ä½œè¿™é‡Œå°±ä¸ä¼šå‘ä¸‹æµåŠ¨äº†ï¼Œç»ˆæ­¢æ“ä½œç¬¦åªèƒ½ä½¿ç”¨ä¸€æ¬¡ã€‚</p><ul><li><code>collect </code>æ”¶é›†æ“ä½œï¼šå°†æ‰€æœ‰æ•°æ®æ”¶é›†èµ·æ¥ï¼Œè¿™ä¸ªæ“ä½œéå¸¸é‡è¦ï¼Œå®˜æ–¹çš„æä¾›çš„Collectors æä¾›äº†éå¸¸å¤šæ”¶é›†å™¨ï¼Œå¯ä»¥è¯´Streamçš„æ ¸å¿ƒåœ¨äºCollectorsã€‚</li><li><code>count </code>ç»Ÿè®¡æ“ä½œï¼šç»Ÿè®¡æœ€ç»ˆçš„æ•°æ®ä¸ªæ•°ã€‚</li><li><code>findFirstã€findAny </code>æŸ¥æ‰¾æ“ä½œï¼šæŸ¥æ‰¾ç¬¬ä¸€ä¸ªã€æŸ¥æ‰¾ä»»ä½•ä¸€ä¸ªï¼Œè¿”å›çš„ç±»å‹ä¸ºOptionalã€‚</li><li><code>noneMatchã€allMatchã€anyMatch</code>åŒ¹é…æ“ä½œï¼šæ•°æ®æµä¸­æ˜¯å¦å­˜åœ¨ç¬¦åˆæ¡ä»¶çš„å…ƒç´ ï¼Œè¿”å›å€¼ä¸ºbool å€¼ã€‚</li><li><code>minã€max</code>æœ€å€¼æ“ä½œï¼šéœ€è¦è‡ªå®šä¹‰æ¯”è¾ƒå™¨ï¼Œè¿”å›æ•°æ®æµä¸­æœ€å¤§ã€æœ€å°çš„å€¼ã€‚</li><li><code>reduce</code>è§„çº¦æ“ä½œï¼šå°†æ•´ä¸ªæ•°æ®æµçš„å€¼è§„çº¦ä¸ºä¸€ä¸ªå€¼ï¼Œcountã€minã€maxåº•å±‚å°±æ˜¯ä½¿ç”¨reduceã€‚</li><li><code>forEachã€forEachOrdered</code>éå†æ“ä½œï¼šè¿™é‡Œå°±æ˜¯å¯¹æœ€ç»ˆçš„æ•°æ®è¿›è¡Œæ¶ˆè´¹äº†ã€‚</li><li><code>toArray</code>æ•°ç»„æ“ä½œï¼šå°†æ•°æ®æµçš„å…ƒç´ è½¬æ¢æˆæ•°ç»„ã€‚</li></ul><p>è¯´äº†è¿™ä¹ˆå¤šï¼Œå¿ƒåŠ¨ä¸å¦‚è¡ŒåŠ¨ï¼Œä¿—è¯è¯´ï¼šå®è·µå‡ºçœŸç†ã€‚é‚£ä¹ˆï¼Œä¸€èµ·æ¥å®æˆ˜å§ã€‚</p><h1 id="ä¸‰ã€å®æˆ˜æ¼”ç»ƒ"><a href="#ä¸‰ã€å®æˆ˜æ¼”ç»ƒ" class="headerlink" title="ä¸‰ã€å®æˆ˜æ¼”ç»ƒ"></a>ä¸‰ã€å®æˆ˜æ¼”ç»ƒ</h1><p>Streamçš„ä¸€ç³»åˆ—æ“ä½œï¼Œå¿…é¡»è¦ä½¿ç”¨ç»ˆæ­¢æ“ä½œç¬¦ï¼Œå¦åˆ™æ•´ä¸ªæ•°æ®æµæ˜¯ä¸ä¼šæ‰§è¡Œèµ·æ¥çš„ã€‚</p><h2 id="1-map"><a href="#1-map" class="headerlink" title="1. map"></a>1. map</h2><p>è½¬æ¢ã€æ˜ å°„æ“ä½œï¼Œå°†å…ƒç´ è½¬æ¢æˆå…¶ä»–å½¢å¼æˆ–æå–ä¸€äº›ä¿¡æ¯ã€‚</p><p>æ¯”å¦‚ï¼Œä»Peopleé›†åˆä¸­è·å–æ‰€æœ‰äººçš„å¹´é¾„ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">allPeoples</span><span class="hljs-selector-class">.stream</span>()<br><span class="hljs-selector-class">.map</span>(<span class="hljs-selector-tag">People</span><span class="hljs-selector-pseudo">::getAge)</span><br><span class="hljs-selector-class">.forEach</span>(<span class="hljs-selector-tag">System</span><span class="hljs-selector-class">.out</span><span class="hljs-selector-pseudo">::println)</span>;<br></code></pre></td></tr></table></figure><h2 id="2-flatmap"><a href="#2-flatmap" class="headerlink" title="2. flatmap"></a>2. flatmap</h2><p>å°†å…ƒç´ æ‹å¹³æ‹æ‰ ï¼Œå°†æ‹æ‰çš„å…ƒç´ é‡æ–°ç»„æˆStreamï¼Œå¹¶å°†è¿™äº›Stream ä¸²è¡Œåˆå¹¶æˆä¸€æ¡Streamã€‚</p><p>æ¯”å¦‚ï¼Œå¸¦æœ‰-å­—ç¬¦çš„å­—ç¬¦ä¸²è¿›è¡Œæ‹†åˆ†ï¼Œå¹¶è¾“å‡ºï¼š</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Stream</span>.</span></span><span class="hljs-keyword">of</span>(<span class="hljs-string">&quot;x-c-b-e-y-o-n-d&quot;</span>,<span class="hljs-string">&quot;a-b-c-d&quot;</span>)<br>.flat<span class="hljs-constructor">Map(<span class="hljs-params">m</span> -&gt; Stream.<span class="hljs-params">of</span>(<span class="hljs-params">m</span>.<span class="hljs-params">split</span>(<span class="hljs-string">&quot;-&quot;</span>)</span>))<br>    .<span class="hljs-keyword">for</span><span class="hljs-constructor">Each(System.<span class="hljs-params">out</span>::<span class="hljs-params">println</span>)</span>;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs llvm"><span class="hljs-keyword">x</span><br><span class="hljs-keyword">c</span><br>b<br>e<br>y<br>o<br>n<br>d<br>a<br>b<br><span class="hljs-keyword">c</span><br>d<br></code></pre></td></tr></table></figure><h2 id="3-limit"><a href="#3-limit" class="headerlink" title="3. limit"></a>3. limit</h2><p>é™æµæ“ä½œï¼Œé™åˆ¶é›†åˆå…ƒç´ çš„ä¸ªæ•°ã€‚</p><p>æ¯”å¦‚ï¼Œé›†åˆä¸­æœ‰10ä¸ªå…ƒç´ ï¼Œæˆ‘åªè¦å‰4ä¸ªå°±å¯ä»¥ä½¿ç”¨ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">Stream</span><span class="hljs-selector-class">.of</span>(1,2,3,4,5,6,7,8,9,10)<br><span class="hljs-selector-class">.limit</span>(4)<br><span class="hljs-selector-class">.forEach</span>(<span class="hljs-selector-tag">System</span><span class="hljs-selector-class">.out</span><span class="hljs-selector-pseudo">::println)</span>;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plain">1<br>2<br>3<br>4<br></code></pre></td></tr></table></figure><h2 id="4-distinct"><a href="#4-distinct" class="headerlink" title="4. distinct"></a>4. distinct</h2><p>å»é‡æ“ä½œï¼Œé‡å¤å…ƒç´ å»é‡ï¼Œç±»ä¼¼æ•°æ®åº“ä¸­çš„å…³é”®å­—<code>distinct</code>ã€‚</p><p>æ¯”å¦‚ï¼Œé›†åˆä¸­å¯èƒ½å­˜åœ¨ä¸€äº›é‡å¤çš„æ•°æ®ï¼Œéœ€è¦è¿›è¡Œå»é‡æ“ä½œï¼š</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Stream</span>.</span></span><span class="hljs-keyword">of</span>(<span class="hljs-string">&quot;xcbeyond&quot;</span>,<span class="hljs-string">&quot;Niki&quot;</span>,<span class="hljs-string">&quot;Liky&quot;</span>,<span class="hljs-string">&quot;xcbeyond&quot;</span>)<br>.distinct<span class="hljs-literal">()</span><br>.<span class="hljs-keyword">for</span><span class="hljs-constructor">Each(System.<span class="hljs-params">out</span>::<span class="hljs-params">println</span>)</span>;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">xcbeyond</span><br><span class="hljs-attribute">Niki</span><br><span class="hljs-attribute">Liky</span><br></code></pre></td></tr></table></figure><h2 id="5-filter"><a href="#5-filter" class="headerlink" title="5. filter"></a>5. filter</h2><p>è¿‡æ»¤ã€ç­›é€‰ï¼Œå¯¹æŸäº›å…ƒç´ è¿›è¡Œè¿‡æ»¤ï¼Œä¸ç¬¦åˆç­›é€‰æ¡ä»¶çš„å°†æ— æ³•è¿›å…¥æµçš„ä¸‹æ¸¸ã€‚</p><p>æ¯”å¦‚ï¼Œç­›é€‰å‡ºä¸€ä¸ªæ•°å­—é›†åˆä¸­çš„æ‰€æœ‰å¶æ•°ï¼š</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Stream</span>.</span></span><span class="hljs-keyword">of</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>)<br>.filter(n -&gt; <span class="hljs-number">0</span><span class="hljs-operator"> == </span>n%<span class="hljs-number">2</span>)<br>.<span class="hljs-keyword">for</span><span class="hljs-constructor">Each(System.<span class="hljs-params">out</span>::<span class="hljs-params">println</span>)</span>;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plain">2<br>4<br>6<br>8<br>10<br></code></pre></td></tr></table></figure><h2 id="6-peek"><a href="#6-peek" class="headerlink" title="6. peek"></a>6. peek</h2><p>æ¶ˆè´¹æ“ä½œï¼Œå¦‚æœæƒ³å¯¹æ•°æ®è¿›è¡ŒæŸäº›æ“ä½œï¼Œå¦‚ï¼šè¯»å–ã€ç¼–è¾‘ä¿®æ”¹ç­‰ã€‚</p><p>æ¯”å¦‚ï¼Œå°†Peopleé›†åˆä¸­nameç»Ÿä¸€ä¿®æ”¹ä¸ºname+ageçš„å½¢å¼ï¼š</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">allPeoples.stream<span class="hljs-literal">()</span><br>.peek(people -&gt; people.set<span class="hljs-constructor">Name(<span class="hljs-params">people</span>.<span class="hljs-params">getName</span>()</span> + people.get<span class="hljs-constructor">Age()</span>))<br>.<span class="hljs-keyword">for</span><span class="hljs-constructor">Each(<span class="hljs-params">people</span> -&gt; System.<span class="hljs-params">out</span>.<span class="hljs-params">println</span>(<span class="hljs-params">people</span>.<span class="hljs-params">getName</span>()</span>));<br></code></pre></td></tr></table></figure><h2 id="7-skip"><a href="#7-skip" class="headerlink" title="7. skip"></a>7. skip</h2><p>è·³è¿‡æ“ä½œï¼Œè·³è¿‡æŸäº›å…ƒç´ ã€‚</p><p>æ¯”å¦‚ï¼Œä¸€ä¸ªæ•°å­—é›†åˆï¼Œè·³è¿‡å‰4ä¸ªå…ƒç´ ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">Stream</span><span class="hljs-selector-class">.of</span>(1,2,3,4,5,6,7,8,9,10)<br><span class="hljs-selector-class">.skip</span>(4)<br><span class="hljs-selector-class">.forEach</span>(<span class="hljs-selector-tag">System</span><span class="hljs-selector-class">.out</span><span class="hljs-selector-pseudo">::println)</span>;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plain">5<br>6<br>7<br>8<br>9<br>10<br></code></pre></td></tr></table></figure><h2 id="8-sorted"><a href="#8-sorted" class="headerlink" title="8. sorted"></a>8. sorted</h2><p>æ’åºæ“ä½œï¼Œå¯¹å…ƒç´ æ’åºï¼Œå‰ææ˜¯å®ç°Comparableæ¥å£ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ¯”è¾ƒå™¨ã€‚</p><p>æ¯”å¦‚ï¼Œå°†Peopleé›†åˆæŒ‰ç…§å¹´é¾„æ’åºï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">allPeoples</span><span class="hljs-selector-class">.stream</span>()<br><span class="hljs-selector-class">.sorted</span>(<span class="hljs-selector-tag">Comparator</span><span class="hljs-selector-class">.comparing</span>(<span class="hljs-selector-tag">People</span><span class="hljs-selector-pseudo">::getAge))</span><br><span class="hljs-selector-class">.forEach</span>(<span class="hljs-selector-tag">System</span><span class="hljs-selector-class">.out</span><span class="hljs-selector-pseudo">::println)</span>;<br></code></pre></td></tr></table></figure><h2 id="9-collect"><a href="#9-collect" class="headerlink" title="9. collect"></a>9. collect</h2><p>æ”¶é›†æ“ä½œï¼Œç»ˆæ­¢æ“ä½œç¬¦ï¼Œç”¨äºå°†æœ€ç»ˆçš„æ•°æ®æ”¶é›†åˆ°æ–°çš„é›†åˆä¸­ï¼Œå¦‚ï¼ŒListã€Setã€Mapç­‰é›†åˆã€‚</p><p>æ¯”å¦‚ï¼Œå°†Peopleé›†åˆæŒ‰ç…§å¹´é¾„æ’åºï¼Œå¹¶å­˜æ”¾åœ¨ä¸€ä¸ªæ–°çš„é›†åˆä¸­ï¼Œä¾›åç»­ä½¿ç”¨ï¼š</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">List&lt;People&gt; sortedPeople = allPeoples.stream<span class="hljs-literal">()</span><br>.sorted(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Comparator</span>.</span></span>comparing(People::getAge))<br>.collect(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Collectors</span>.</span></span><span class="hljs-keyword">to</span><span class="hljs-constructor">List()</span>);<br></code></pre></td></tr></table></figure><h2 id="10-count"><a href="#10-count" class="headerlink" title="10. count"></a>10. count</h2><p>ç»Ÿè®¡æ“ä½œï¼Œç”¨äºå¯¹é›†åˆå…ƒç´ ä¸ªæ•°çš„ç»Ÿè®¡ï¼Œè¿”å›ç±»å‹æ˜¯longã€‚</p><p>æ¯”å¦‚ï¼Œè®¡ç®—Peopleé›†åˆä¸­å¹´é¾„å¤§äº30çš„äººæ•°ï¼š</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs axapta"><span class="hljs-built_in">long</span> <span class="hljs-keyword">count</span> = allPeoples.stream()<br>.filter(people -&gt; people.getAge() &gt; <span class="hljs-number">30</span>)<br>    .<span class="hljs-keyword">count</span>();<br></code></pre></td></tr></table></figure><h2 id="11-findFirstã€findAny"><a href="#11-findFirstã€findAny" class="headerlink" title="11. findFirstã€findAny"></a>11. findFirstã€findAny</h2><p>æŸ¥æ‰¾æ“ä½œï¼ŒæŸ¥æ‰¾ç¬¬ä¸€ä¸ªã€ä»»ä½•ä¸€ä¸ªï¼Œè¿”å›çš„ç±»å‹ä¸º<code>Optional</code>ã€‚å¸¸ç”¨äºæŸ¥è¯¢é›†ä¸­ç¬¦åˆæ¡ä»¶çš„å…ƒç´ ï¼Œå¹¶ç»“åˆ<code>Optional.isPresent()</code>è¿›è¡Œåˆ¤æ–­ï¼Œé˜²æ­¢å‡ºç°æœªæ‰¾åˆ°è€Œå¼ºåˆ¶è·å–æ•°æ®å…ƒç´ çš„å¼‚å¸¸æƒ…å†µã€‚</p><p>æ¯”å¦‚ï¼ŒæŸ¥æ‰¾Peopleé›†åˆä¸­åå­—ä¸ºxcbeyondçš„äººï¼š</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs nix">People <span class="hljs-attr">xcbeyondPeople</span> = <span class="hljs-literal">null</span>;<br>Optional&lt;People&gt; <span class="hljs-attr">optional</span> = allPeoples.stream()<br>.filter(people -&gt; <span class="hljs-string">&quot;xcbeyond&quot;</span>.equals(people.getName()))<br>.findFirst();<br><span class="hljs-keyword">if</span> (optional.isPresent()) &#123;<br><span class="hljs-attr">xcbeyondPeople</span> = optional.get();<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="12-noneMatchã€allMatchã€anyMatch"><a href="#12-noneMatchã€allMatchã€anyMatch" class="headerlink" title="12. noneMatchã€allMatchã€anyMatch"></a>12. noneMatchã€allMatchã€anyMatch</h2><p>åŒ¹é…æ“ä½œï¼Œåˆ¤æ–­æ•°æ®æµä¸­æ˜¯å¦å­˜åœ¨ç¬¦åˆæ¡ä»¶çš„å…ƒç´ ï¼Œè¿”å›å€¼ä¸º<code>boolean</code>å€¼ã€‚</p><ul><li>noneMatchï¼šæ²¡æœ‰åŒ¹é…æ¡ä»¶çš„å…ƒç´ </li><li>allMatchã€anyMatchï¼šå…¨åŒ¹é…</li></ul><p>æ¯”å¦‚ï¼Œåˆ¤æ–­Peopleé›†åˆä¸­æ˜¯å¦æœ‰åå­—ä¸ºxcbeyondçš„äººï¼š</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">boolean <span class="hljs-built_in">bool</span> = allPeoples.stream<span class="hljs-literal">()</span><br>.all<span class="hljs-constructor">Match(<span class="hljs-params">people</span> -&gt; <span class="hljs-string">&quot;xcbeyond&quot;</span>.<span class="hljs-params">equals</span>(<span class="hljs-params">people</span>.<span class="hljs-params">getName</span>()</span>));<br></code></pre></td></tr></table></figure><h2 id="13-minã€max"><a href="#13-minã€max" class="headerlink" title="13. minã€max"></a>13. minã€max</h2><p>æœ€å€¼æ“ä½œï¼Œæ ¹æ®è‡ªå®šä¹‰æ¯”è¾ƒå™¨ï¼Œè¿”å›æ•°æ®æµä¸­æœ€å¤§ã€æœ€å°çš„å…ƒç´ ã€‚</p><p>æ¯”å¦‚ï¼Œæ‰¾åˆ°Peopleé›†åˆä¸­æœ€å¤§å¹´é¾„çš„äººï¼š</p><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pf">People <span class="hljs-keyword">max</span>AgePeople = null;<br>Optional<span class="hljs-variable">&lt;People&gt;</span> <span class="hljs-keyword">max</span>AgeOptional = <span class="hljs-literal">all</span>Peoples.stream()<br>.<span class="hljs-keyword">max</span>(Comparator.comparing(People::getAge));<br>if (<span class="hljs-keyword">max</span>AgeOptional.isPresent()) &#123;// å¯èƒ½æ²¡æœ‰ï¼Œåˆ™éœ€è¦è¿›è¡Œåˆ¤æ–­<br><span class="hljs-keyword">max</span>AgePeople = <span class="hljs-keyword">max</span>AgeOptional.get();<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="14-reduce"><a href="#14-reduce" class="headerlink" title="14. reduce"></a>14. reduce</h2><p>è§„çº¦æ“ä½œï¼šå°†æ•´ä¸ªæ•°æ®æµçš„å€¼è§„çº¦ä¸ºä¸€ä¸ªå€¼ï¼Œå…¶ä¸­countã€minã€maxåº•å±‚å°±æ˜¯ä½¿ç”¨reduceã€‚</p><p>æ¯”å¦‚ï¼Œå¯¹ä¸€ä¸ªæ•´æ•°é›†åˆè¿›è¡Œæ±‚å’Œï¼š</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs livescript">int sum = Stream.<span class="hljs-keyword">of</span>(<span class="hljs-number">1</span>,<span class="hljs-number">9</span>,<span class="hljs-number">8</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,-<span class="hljs-number">1</span>)<br>.reduce<span class="hljs-function"><span class="hljs-params">(<span class="hljs-number">0</span>,(e1,e2)-&gt;e1+e2)</span>;</span><br><span class="hljs-function"><span class="hljs-title">System</span>.<span class="hljs-title">out</span>.<span class="hljs-title">println</span><span class="hljs-params">(sum)</span>;</span><br></code></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">32<br></code></pre></td></tr></table></figure><h1 id="å››ã€æ€»ç»“"><a href="#å››ã€æ€»ç»“" class="headerlink" title="å››ã€æ€»ç»“"></a>å››ã€æ€»ç»“</h1><p>æœ¬æ–‡å°±Streamçš„åŸºç¡€ä½¿ç”¨å±‚é¢è¿›è¡Œäº†å…¨é¢çš„ä»‹ç»ã€å®æˆ˜ï¼Œå‘Šè¯‰ä½ è¯¥æ€ä¹ˆç”¨æ¯ç§æ“ä½œç¬¦ï¼Œåªæœ‰æŒæ¡äº†è¿™äº›åŸºæœ¬çš„æ“ä½œï¼Œåœ¨é¢å¯¹å®é™…å¤æ‚å¤„ç†é€»è¾‘æ—¶ï¼Œéœ€è¦è¿›ä¸€æ­¥é…åˆä½¿ç”¨ï¼Œå°±ä¼šçŸ¥é“å®ƒçš„å¦™å¤„äº†ã€‚è¿™ä¹Ÿè®©ä½ å¯¹é›†åˆçš„æ“ä½œæ›´ä¸Šä¸€æ­¥ï¼Œä¸ºä½ çœå»äº†ä¸å°‘éº»çƒ¦ã€‚å…³äºStreamæ›´æ·±å…¥çš„è¯´æ˜ï¼Œå¦‚ï¼šå¹¶è¡Œå¤„ç†ã€æ˜¯å¦é«˜æ•ˆç­‰ï¼Œå°†ä¼šåœ¨ä¹‹åçš„ç« èŠ‚è¿›è¡Œè¯¦å°½çš„é˜è¿°ã€éªŒè¯ï¼Œä»¥æ¶ˆé™¤ä½¿ç”¨ä¸­çš„ç–‘æƒ‘ä¸æ‹…å¿§ã€‚</p><p>ä¸‹ä¸€ç¯‡ï¼Œå°†ä¼šæåˆ°Streamçš„ç»ˆææ“ä½œâ€”â€”<strong>Collectors</strong>ï¼Œè®©é›†åˆä¹Ÿèƒ½åƒæ•°æ®åº“SQLä¸€æ ·ï¼Œæ¥å®Œæˆå¤æ‚çš„åˆ†ç»„ã€è¿æ¥ã€æ±‡æ€»ç­‰ï¼ŒçœŸæ­£è®©ä½ å¥½ç”¨åˆ°é£èµ·æ¥ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Stream</tag>
      
      <tag>1.8</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Sentinelå¿«é€Ÿå…¥é—¨</title>
    <link href="/blog/2021/05/09/Sentinel%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"/>
    <url>/blog/2021/05/09/Sentinel%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="Sentinel-ç®€ä»‹"><a href="#Sentinel-ç®€ä»‹" class="headerlink" title="Sentinel ç®€ä»‹"></a>Sentinel ç®€ä»‹</h1><p>éšç€å¾®æœåŠ¡çš„æµè¡Œï¼ŒæœåŠ¡å’ŒæœåŠ¡ä¹‹é—´çš„ç¨³å®šæ€§å˜å¾—è¶Šæ¥è¶Šé‡è¦ã€‚Sentinel ä»¥æµé‡ä¸ºåˆ‡å…¥ç‚¹ï¼Œä»æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§ã€ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤ç­‰å¤šä¸ªç»´åº¦ä¿æŠ¤æœåŠ¡çš„ç¨³å®šæ€§ã€‚</p><p>Sentinel å…·æœ‰ä»¥ä¸‹ç‰¹å¾:</p><ul><li><strong>ä¸°å¯Œçš„åº”ç”¨åœºæ™¯</strong>ï¼šSentinel æ‰¿æ¥äº†é˜¿é‡Œå·´å·´è¿‘ 10 å¹´çš„åŒåä¸€å¤§ä¿ƒæµé‡çš„æ ¸å¿ƒåœºæ™¯ï¼Œä¾‹å¦‚ç§’æ€ï¼ˆå³çªå‘æµé‡æ§åˆ¶åœ¨ç³»ç»Ÿå®¹é‡å¯ä»¥æ‰¿å—çš„èŒƒå›´ï¼‰ã€æ¶ˆæ¯å‰Šå³°å¡«è°·ã€é›†ç¾¤æµé‡æ§åˆ¶ã€å®æ—¶ç†”æ–­ä¸‹æ¸¸ä¸å¯ç”¨åº”ç”¨ç­‰ã€‚</li><li><strong>å®Œå¤‡çš„å®æ—¶ç›‘æ§</strong>ï¼šSentinel åŒæ—¶æä¾›å®æ—¶çš„ç›‘æ§åŠŸèƒ½ã€‚æ‚¨å¯ä»¥åœ¨æ§åˆ¶å°ä¸­çœ‹åˆ°æ¥å…¥åº”ç”¨çš„å•å°æœºå™¨ç§’çº§æ•°æ®ï¼Œç”šè‡³ 500 å°ä»¥ä¸‹è§„æ¨¡çš„é›†ç¾¤çš„æ±‡æ€»è¿è¡Œæƒ…å†µã€‚</li><li><strong>å¹¿æ³›çš„å¼€æºç”Ÿæ€</strong>ï¼šSentinel æä¾›å¼€ç®±å³ç”¨çš„ä¸å…¶å®ƒå¼€æºæ¡†æ¶/åº“çš„æ•´åˆæ¨¡å—ï¼Œä¾‹å¦‚ä¸ Spring Cloudã€Dubboã€gRPC çš„æ•´åˆã€‚æ‚¨åªéœ€è¦å¼•å…¥ç›¸åº”çš„ä¾èµ–å¹¶è¿›è¡Œç®€å•çš„é…ç½®å³å¯å¿«é€Ÿåœ°æ¥å…¥ Sentinelã€‚</li><li><strong>å®Œå–„çš„ SPI æ‰©å±•ç‚¹</strong>ï¼šSentinel æä¾›ç®€å•æ˜“ç”¨ã€å®Œå–„çš„ SPI æ‰©å±•æ¥å£ã€‚æ‚¨å¯ä»¥é€šè¿‡å®ç°æ‰©å±•æ¥å£æ¥å¿«é€Ÿåœ°å®šåˆ¶é€»è¾‘ã€‚ä¾‹å¦‚å®šåˆ¶è§„åˆ™ç®¡ç†ã€é€‚é…åŠ¨æ€æ•°æ®æºç­‰ã€‚</li></ul><p>Sentinel çš„ä¸»è¦ç‰¹æ€§ï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/9b9449c803b4467c9421f31d7f9c3420~tplv-k3u1fbpfcp-watermark.image" alt="sentinel ç‰¹å¾.png"></p><p>Sentinel çš„å¼€æºç”Ÿæ€ï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/ac27750628f7401794375fef32c34652~tplv-k3u1fbpfcp-watermark.image" alt="sentinel ç”Ÿæ€.png"></p><p>Sentinel åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†:</p><ul><li>æ ¸å¿ƒåº“ï¼ˆJava å®¢æˆ·ç«¯ï¼‰ä¸ä¾èµ–ä»»ä½•æ¡†æ¶/åº“ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Dubbo / Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒã€‚</li><li>æ§åˆ¶å°ï¼ˆDashboardï¼‰åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨ã€‚</li></ul><h1 id="Sentinelã€Hystrixã€resilience4j-å¯¹æ¯”"><a href="#Sentinelã€Hystrixã€resilience4j-å¯¹æ¯”" class="headerlink" title="Sentinelã€Hystrixã€resilience4j å¯¹æ¯”"></a>Sentinelã€Hystrixã€resilience4j å¯¹æ¯”</h1><p>åŠŸèƒ½å¯¹æ¯”</p><table><thead><tr><th></th><th>Sentinel</th><th>Hystrix</th><th>resilience4j</th></tr></thead><tbody><tr><td>éš”ç¦»ç­–ç•¥</td><td>ä¿¡å·é‡éš”ç¦»ï¼ˆå¹¶å‘æ§åˆ¶ï¼‰</td><td>çº¿ç¨‹æ± éš”ç¦»/ä¿¡å·é‡éš”ç¦»</td><td>ä¿¡å·é‡éš”ç¦»</td></tr><tr><td>ç†”æ–­é™çº§ç­–ç•¥</td><td>åŸºäºæ…¢è°ƒç”¨æ¯”ä¾‹ã€å¼‚å¸¸æ¯”ä¾‹ã€å¼‚å¸¸æ•°</td><td>åŸºäºå¼‚å¸¸æ¯”ä¾‹</td><td>åŸºäºå¼‚å¸¸æ¯”ä¾‹ã€å“åº”æ—¶é—´</td></tr><tr><td>å®æ—¶ç»Ÿè®¡å®ç°</td><td>æ»‘åŠ¨çª—å£ï¼ˆLeapArrayï¼‰</td><td>æ»‘åŠ¨çª—å£ï¼ˆåŸºäº RxJavaï¼‰</td><td>Ring Bit Buffer</td></tr><tr><td>åŠ¨æ€è§„åˆ™é…ç½®</td><td>æ”¯æŒå¤šç§æ•°æ®æº</td><td>æ”¯æŒå¤šç§æ•°æ®æº</td><td>æœ‰é™æ”¯æŒ</td></tr><tr><td>æ‰©å±•æ€§</td><td>å¤šä¸ªæ‰©å±•ç‚¹</td><td>æ’ä»¶çš„å½¢å¼</td><td>æ¥å£çš„å½¢å¼</td></tr><tr><td>åŸºäºæ³¨è§£çš„æ”¯æŒ</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>é™æµ</td><td>åŸºäº QPSï¼Œæ”¯æŒåŸºäºè°ƒç”¨å…³ç³»çš„é™æµ</td><td>æœ‰é™çš„æ”¯æŒ</td><td>Rate Limiter</td></tr><tr><td>æµé‡æ•´å½¢</td><td>æ”¯æŒé¢„çƒ­æ¨¡å¼ä¸åŒ€é€Ÿæ’é˜Ÿæ§åˆ¶æ•ˆæœ</td><td>ä¸æ”¯æŒ</td><td>ç®€å•çš„ Rate Limiter æ¨¡å¼</td></tr><tr><td>ç³»ç»Ÿè‡ªé€‚åº”ä¿æŠ¤</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr><tr><td>å¤šè¯­è¨€æ”¯æŒ</td><td>Java/Go/C++</td><td>Java</td><td>Java</td></tr><tr><td>Service Mesh æ”¯æŒ</td><td>æ”¯æŒ Envoy/Istio</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr><tr><td>æ§åˆ¶å°</td><td>æä¾›å¼€ç®±å³ç”¨çš„æ§åˆ¶å°ï¼Œå¯é…ç½®è§„åˆ™ã€å®æ—¶ç›‘æ§ã€æœºå™¨å‘ç°ç­‰</td><td>ç®€å•çš„ç›‘æ§æŸ¥çœ‹</td><td>ä¸æä¾›æ§åˆ¶å°ï¼Œå¯å¯¹æ¥å…¶å®ƒç›‘æ§ç³»ç»Ÿ</td></tr></tbody></table><h1 id="Sentinel-åè¯"><a href="#Sentinel-åè¯" class="headerlink" title="Sentinel åè¯"></a>Sentinel åè¯</h1><h2 id="èµ„æº"><a href="#èµ„æº" class="headerlink" title="èµ„æº"></a>èµ„æº</h2><p>èµ„æºæ˜¯ Sentinel çš„å…³é”®æ¦‚å¿µã€‚å®ƒå¯ä»¥æ˜¯ Java åº”ç”¨ç¨‹åºä¸­çš„ä»»ä½•å†…å®¹ï¼Œä¾‹å¦‚ï¼Œç”±åº”ç”¨ç¨‹åºæä¾›çš„æœåŠ¡ï¼Œæˆ–ç”±åº”ç”¨ç¨‹åºè°ƒç”¨çš„å…¶å®ƒåº”ç”¨æä¾›çš„æœåŠ¡ï¼Œç”šè‡³å¯ä»¥æ˜¯ä¸€æ®µä»£ç ã€‚åœ¨æ¥ä¸‹æ¥çš„æ–‡æ¡£ä¸­ï¼Œæˆ‘ä»¬éƒ½ä¼šç”¨èµ„æºæ¥æè¿°ä»£ç å—ã€‚</p><p>åªè¦é€šè¿‡ Sentinel API å®šä¹‰çš„ä»£ç ï¼Œå°±æ˜¯èµ„æºï¼Œèƒ½å¤Ÿè¢« Sentinel ä¿æŠ¤èµ·æ¥ã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨æ–¹æ³•ç­¾åï¼ŒURLï¼Œç”šè‡³æœåŠ¡åç§°ä½œä¸ºèµ„æºåæ¥æ ‡ç¤ºèµ„æºã€‚</p><h2 id="è§„åˆ™"><a href="#è§„åˆ™" class="headerlink" title="è§„åˆ™"></a>è§„åˆ™</h2><p>å›´ç»•èµ„æºçš„å®æ—¶çŠ¶æ€è®¾å®šçš„è§„åˆ™ï¼Œå¯ä»¥åŒ…æ‹¬æµé‡æ§åˆ¶è§„åˆ™ã€ç†”æ–­é™çº§è§„åˆ™ä»¥åŠç³»ç»Ÿä¿æŠ¤è§„åˆ™ã€‚æ‰€æœ‰è§„åˆ™å¯ä»¥åŠ¨æ€å®æ—¶è°ƒæ•´ã€‚</p><h2 id="æµé‡æ§åˆ¶"><a href="#æµé‡æ§åˆ¶" class="headerlink" title="æµé‡æ§åˆ¶"></a>æµé‡æ§åˆ¶</h2><h3 id="ä»€ä¹ˆæ˜¯æµé‡æ§åˆ¶"><a href="#ä»€ä¹ˆæ˜¯æµé‡æ§åˆ¶" class="headerlink" title="ä»€ä¹ˆæ˜¯æµé‡æ§åˆ¶"></a>ä»€ä¹ˆæ˜¯æµé‡æ§åˆ¶</h3><p>æµé‡æ§åˆ¶åœ¨ç½‘ç»œä¼ è¾“ä¸­æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„æ¦‚å¿µï¼Œå®ƒç”¨äºè°ƒæ•´ç½‘ç»œåŒ…çš„å‘é€æ•°æ®ã€‚ç„¶è€Œï¼Œä»ç³»ç»Ÿç¨³å®šæ€§è§’åº¦è€ƒè™‘ï¼Œåœ¨å¤„ç†è¯·æ±‚çš„é€Ÿåº¦ä¸Šï¼Œä¹Ÿæœ‰éå¸¸å¤šçš„è®²ç©¶ã€‚ä»»æ„æ—¶é—´åˆ°æ¥çš„è¯·æ±‚å¾€å¾€æ˜¯éšæœºä¸å¯æ§çš„ï¼Œè€Œç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›æ˜¯æœ‰é™çš„ã€‚æˆ‘ä»¬éœ€è¦æ ¹æ®ç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›å¯¹æµé‡è¿›è¡Œæ§åˆ¶ã€‚Sentinel ä½œä¸ºä¸€ä¸ªè°ƒé…å™¨ï¼Œå¯ä»¥æ ¹æ®éœ€è¦æŠŠéšæœºçš„è¯·æ±‚è°ƒæ•´æˆåˆé€‚çš„å½¢çŠ¶ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/17f3ea9e95b64e8eba33d46f19e6b12a~tplv-k3u1fbpfcp-watermark.image" alt="sentinel æµæ§.gif"></p><h3 id="æµé‡æ§åˆ¶è®¾è®¡ç†å¿µ"><a href="#æµé‡æ§åˆ¶è®¾è®¡ç†å¿µ" class="headerlink" title="æµé‡æ§åˆ¶è®¾è®¡ç†å¿µ"></a>æµé‡æ§åˆ¶è®¾è®¡ç†å¿µ</h3><p>æµé‡æ§åˆ¶æœ‰ä»¥ä¸‹å‡ ä¸ªè§’åº¦:</p><ul><li>èµ„æºçš„è°ƒç”¨å…³ç³»ï¼Œä¾‹å¦‚èµ„æºçš„è°ƒç”¨é“¾è·¯ï¼Œèµ„æºå’Œèµ„æºä¹‹é—´çš„å…³ç³»ï¼›</li><li>è¿è¡ŒæŒ‡æ ‡ï¼Œä¾‹å¦‚ QPSã€çº¿ç¨‹æ± ã€ç³»ç»Ÿè´Ÿè½½ç­‰ï¼›</li><li>æ§åˆ¶çš„æ•ˆæœï¼Œä¾‹å¦‚ç›´æ¥é™æµã€å†·å¯åŠ¨ã€æ’é˜Ÿç­‰ã€‚</li></ul><p>Sentinel çš„è®¾è®¡ç†å¿µæ˜¯è®©æ‚¨è‡ªç”±é€‰æ‹©æ§åˆ¶çš„è§’åº¦ï¼Œå¹¶è¿›è¡Œçµæ´»ç»„åˆï¼Œä»è€Œè¾¾åˆ°æƒ³è¦çš„æ•ˆæœã€‚</p><h2 id="ç†”æ–­é™çº§"><a href="#ç†”æ–­é™çº§" class="headerlink" title="ç†”æ–­é™çº§"></a>ç†”æ–­é™çº§</h2><h3 id="ä»€ä¹ˆæ˜¯ç†”æ–­é™çº§"><a href="#ä»€ä¹ˆæ˜¯ç†”æ–­é™çº§" class="headerlink" title="ä»€ä¹ˆæ˜¯ç†”æ–­é™çº§"></a>ä»€ä¹ˆæ˜¯ç†”æ–­é™çº§</h3><p>é™¤äº†æµé‡æ§åˆ¶ä»¥å¤–ï¼ŒåŠæ—¶å¯¹è°ƒç”¨é“¾è·¯ä¸­çš„ä¸ç¨³å®šå› ç´ è¿›è¡Œç†”æ–­ä¹Ÿæ˜¯ Sentinel çš„ä½¿å‘½ä¹‹ä¸€ã€‚ç”±äºè°ƒç”¨å…³ç³»çš„å¤æ‚æ€§ï¼Œå¦‚æœè°ƒç”¨é“¾è·¯ä¸­çš„æŸä¸ªèµ„æºå‡ºç°äº†ä¸ç¨³å®šï¼Œå¯èƒ½ä¼šå¯¼è‡´è¯·æ±‚å‘ç”Ÿå †ç§¯ï¼Œè¿›è€Œå¯¼è‡´çº§è”é”™è¯¯ã€‚</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/d6094c417c7f4ffeaf856b0ab0a396c4~tplv-k3u1fbpfcp-watermark.image" alt="sentinel ç†”æ–­é™çº§.png"></p><p>Sentinel å’Œ Hystrix çš„åŸåˆ™æ˜¯ä¸€è‡´çš„: å½“æ£€æµ‹åˆ°è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç°ä¸ç¨³å®šçš„è¡¨ç°ï¼Œä¾‹å¦‚è¯·æ±‚å“åº”æ—¶é—´é•¿æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜çš„æ—¶å€™ï¼Œåˆ™å¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œé™åˆ¶ï¼Œè®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“åˆ°å…¶å®ƒçš„èµ„æºè€Œå¯¼è‡´çº§è”æ•…éšœã€‚</p><h3 id="ç†”æ–­é™çº§è®¾è®¡ç†å¿µ"><a href="#ç†”æ–­é™çº§è®¾è®¡ç†å¿µ" class="headerlink" title="ç†”æ–­é™çº§è®¾è®¡ç†å¿µ"></a>ç†”æ–­é™çº§è®¾è®¡ç†å¿µ</h3><p>åœ¨é™åˆ¶çš„æ‰‹æ®µä¸Šï¼ŒSentinel å’Œ Hystrix é‡‡å–äº†å®Œå…¨ä¸ä¸€æ ·çš„æ–¹æ³•ã€‚</p><p>Hystrix é€šè¿‡ <a href="https://github.com/Netflix/Hystrix/wiki/How-it-Works#benefits-of-thread-pools">çº¿ç¨‹æ± éš”ç¦»</a> çš„æ–¹å¼ï¼Œæ¥å¯¹ä¾èµ–ï¼ˆåœ¨ Sentinel çš„æ¦‚å¿µä¸­å¯¹åº” <em>èµ„æº</em>ï¼‰è¿›è¡Œäº†éš”ç¦»ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯èµ„æºå’Œèµ„æºä¹‹é—´åšåˆ°äº†æœ€å½»åº•çš„éš”ç¦»ã€‚ç¼ºç‚¹æ˜¯é™¤äº†å¢åŠ äº†çº¿ç¨‹åˆ‡æ¢çš„æˆæœ¬ï¼ˆè¿‡å¤šçš„çº¿ç¨‹æ± å¯¼è‡´çº¿ç¨‹æ•°ç›®è¿‡å¤šï¼‰ï¼Œè¿˜éœ€è¦é¢„å…ˆç»™å„ä¸ªèµ„æºåšçº¿ç¨‹æ± å¤§å°çš„åˆ†é…ã€‚</p><p>Sentinel å¯¹è¿™ä¸ªé—®é¢˜é‡‡å–äº†ä¸¤ç§æ‰‹æ®µ:</p><ul><li>é€šè¿‡å¹¶å‘çº¿ç¨‹æ•°è¿›è¡Œé™åˆ¶</li></ul><p>å’Œèµ„æºæ± éš”ç¦»çš„æ–¹æ³•ä¸åŒï¼ŒSentinel é€šè¿‡é™åˆ¶èµ„æºå¹¶å‘çº¿ç¨‹çš„æ•°é‡ï¼Œæ¥å‡å°‘ä¸ç¨³å®šèµ„æºå¯¹å…¶å®ƒèµ„æºçš„å½±å“ã€‚è¿™æ ·ä¸ä½†æ²¡æœ‰çº¿ç¨‹åˆ‡æ¢çš„æŸè€—ï¼Œä¹Ÿä¸éœ€è¦æ‚¨é¢„å…ˆåˆ†é…çº¿ç¨‹æ± çš„å¤§å°ã€‚å½“æŸä¸ªèµ„æºå‡ºç°ä¸ç¨³å®šçš„æƒ…å†µä¸‹ï¼Œä¾‹å¦‚å“åº”æ—¶é—´å˜é•¿ï¼Œå¯¹èµ„æºçš„ç›´æ¥å½±å“å°±æ˜¯ä¼šé€ æˆçº¿ç¨‹æ•°çš„é€æ­¥å †ç§¯ã€‚å½“çº¿ç¨‹æ•°åœ¨ç‰¹å®šèµ„æºä¸Šå †ç§¯åˆ°ä¸€å®šçš„æ•°é‡ä¹‹åï¼Œå¯¹è¯¥èµ„æºçš„æ–°è¯·æ±‚å°±ä¼šè¢«æ‹’ç»ã€‚å †ç§¯çš„çº¿ç¨‹å®Œæˆä»»åŠ¡åæ‰å¼€å§‹ç»§ç»­æ¥æ”¶è¯·æ±‚ã€‚</p><ul><li>é€šè¿‡å“åº”æ—¶é—´å¯¹èµ„æºè¿›è¡Œé™çº§</li></ul><p>é™¤äº†å¯¹å¹¶å‘çº¿ç¨‹æ•°è¿›è¡Œæ§åˆ¶ä»¥å¤–ï¼ŒSentinel è¿˜å¯ä»¥é€šè¿‡å“åº”æ—¶é—´æ¥å¿«é€Ÿé™çº§ä¸ç¨³å®šçš„èµ„æºã€‚å½“ä¾èµ–çš„èµ„æºå‡ºç°å“åº”æ—¶é—´è¿‡é•¿åï¼Œæ‰€æœ‰å¯¹è¯¥èµ„æºçš„è®¿é—®éƒ½ä¼šè¢«ç›´æ¥æ‹’ç»ï¼Œç›´åˆ°è¿‡äº†æŒ‡å®šçš„æ—¶é—´çª—å£ä¹‹åæ‰é‡æ–°æ¢å¤ã€‚</p><h2 id="ç³»ç»Ÿè‡ªé€‚åº”ä¿æŠ¤"><a href="#ç³»ç»Ÿè‡ªé€‚åº”ä¿æŠ¤" class="headerlink" title="ç³»ç»Ÿè‡ªé€‚åº”ä¿æŠ¤"></a>ç³»ç»Ÿè‡ªé€‚åº”ä¿æŠ¤</h2><p>Sentinel åŒæ—¶æä¾›ç³»ç»Ÿç»´åº¦çš„è‡ªé€‚åº”ä¿æŠ¤èƒ½åŠ›ã€‚é˜²æ­¢é›ªå´©ï¼Œæ˜¯ç³»ç»Ÿé˜²æŠ¤ä¸­é‡è¦çš„ä¸€ç¯ã€‚å½“ç³»ç»Ÿè´Ÿè½½è¾ƒé«˜çš„æ—¶å€™ï¼Œå¦‚æœè¿˜æŒç»­è®©è¯·æ±‚è¿›å…¥ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿå´©æºƒï¼Œæ— æ³•å“åº”ã€‚åœ¨é›†ç¾¤ç¯å¢ƒä¸‹ï¼Œç½‘ç»œè´Ÿè½½å‡è¡¡ä¼šæŠŠæœ¬åº”è¿™å°æœºå™¨æ‰¿è½½çš„æµé‡è½¬å‘åˆ°å…¶å®ƒçš„æœºå™¨ä¸Šå»ã€‚å¦‚æœè¿™ä¸ªæ—¶å€™å…¶å®ƒçš„æœºå™¨ä¹Ÿå¤„åœ¨ä¸€ä¸ªè¾¹ç¼˜çŠ¶æ€çš„æ—¶å€™ï¼Œè¿™ä¸ªå¢åŠ çš„æµé‡å°±ä¼šå¯¼è‡´è¿™å°æœºå™¨ä¹Ÿå´©æºƒï¼Œæœ€åå¯¼è‡´æ•´ä¸ªé›†ç¾¤ä¸å¯ç”¨ã€‚</p><p>é’ˆå¯¹è¿™ä¸ªæƒ…å†µï¼ŒSentinel æä¾›äº†å¯¹åº”çš„ä¿æŠ¤æœºåˆ¶ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œä¿è¯ç³»ç»Ÿåœ¨èƒ½åŠ›èŒƒå›´ä¹‹å†…å¤„ç†æœ€å¤šçš„è¯·æ±‚ã€‚</p><h1 id="Sentinel-åŸç†"><a href="#Sentinel-åŸç†" class="headerlink" title="Sentinel åŸç†"></a>Sentinel åŸç†</h1><p>Sentinel çš„ä¸»è¦å·¥ä½œæœºåˆ¶å¦‚ä¸‹ï¼š</p><ul><li>å¯¹ä¸»æµæ¡†æ¶æä¾›é€‚é…æˆ–è€…æ˜¾ç¤ºçš„ APIï¼Œæ¥å®šä¹‰éœ€è¦ä¿æŠ¤çš„èµ„æºï¼Œå¹¶æä¾›è®¾æ–½å¯¹èµ„æºè¿›è¡Œå®æ—¶ç»Ÿè®¡å’Œè°ƒç”¨é“¾è·¯åˆ†æã€‚</li><li>æ ¹æ®é¢„è®¾çš„è§„åˆ™ï¼Œç»“åˆå¯¹èµ„æºçš„å®æ—¶ç»Ÿè®¡ä¿¡æ¯ï¼Œå¯¹æµé‡è¿›è¡Œæ§åˆ¶ã€‚åŒæ—¶ï¼ŒSentinel æä¾›å¼€æ”¾çš„æ¥å£ï¼Œæ–¹ä¾¿æ‚¨å®šä¹‰åŠæ”¹å˜è§„åˆ™ã€‚</li><li>Sentinel æä¾›å®æ—¶çš„ç›‘æ§ç³»ç»Ÿï¼Œæ–¹ä¾¿æ‚¨å¿«é€Ÿäº†è§£ç›®å‰ç³»ç»Ÿçš„çŠ¶æ€ã€‚</li></ul><h1 id="Sentinel-ä½¿ç”¨"><a href="#Sentinel-ä½¿ç”¨" class="headerlink" title="Sentinel ä½¿ç”¨"></a>Sentinel ä½¿ç”¨</h1><h2 id="æ™®é€šä½¿ç”¨"><a href="#æ™®é€šä½¿ç”¨" class="headerlink" title="æ™®é€šä½¿ç”¨"></a>æ™®é€šä½¿ç”¨</h2><ol><li>å¦‚æœåº”ç”¨ä½¿ç”¨ pom å·¥ç¨‹ï¼Œåˆ™åœ¨ <code>pom.xml</code> æ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹ä»£ç å³å¯ï¼š</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.csp<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>sentinel-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.8.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br></code></pre></td></tr></table></figure><ol><li>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æŠŠéœ€è¦æ§åˆ¶æµé‡çš„ä»£ç ç”¨ Sentinel API <code>SphU.entry(&quot;HelloWorld&quot;)</code> å’Œ <code>entry.exit()</code> åŒ…å›´èµ·æ¥å³å¯ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°† <code>System.out.println(&quot;hello world&quot;);</code> è¿™ç«¯ä»£ç ä½œä¸ºèµ„æºï¼Œç”¨ API åŒ…å›´èµ·æ¥ï¼ˆåŸ‹ç‚¹ï¼‰ã€‚å‚è€ƒä»£ç å¦‚ä¸‹:</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;<br>  Entry entry = <span class="hljs-keyword">null</span>;<br>  <span class="hljs-keyword">try</span> &#123;<br>    entry = SphU.entry(<span class="hljs-string">&quot;HelloWorld&quot;</span>);<br>    <span class="hljs-comment">/*æ‚¨çš„ä¸šåŠ¡é€»è¾‘ - å¼€å§‹*/</span><br>    System.out.println(<span class="hljs-string">&quot;hello world&quot;</span>);<br>    TimeUnit.MILLISECONDS.sleep(<span class="hljs-number">10</span>);<br>    <span class="hljs-comment">/*æ‚¨çš„ä¸šåŠ¡é€»è¾‘ - ç»“æŸ*/</span><br>  &#125; <span class="hljs-keyword">catch</span> (BlockException e1) &#123;<br>    <span class="hljs-comment">/*æµæ§é€»è¾‘å¤„ç† - å¼€å§‹*/</span><br>    System.out.println(<span class="hljs-string">&quot;block!&quot;</span>);<br>    <span class="hljs-comment">/*æµæ§é€»è¾‘å¤„ç† - ç»“æŸ*/</span><br>  &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>    e.printStackTrace();<br>  &#125; <span class="hljs-keyword">finally</span> &#123;<br>    <span class="hljs-keyword">if</span> (entry != <span class="hljs-keyword">null</span>) &#123;<br>      entry.exit();<br>    &#125;<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><ol><li>æ¥ä¸‹æ¥ï¼Œé€šè¿‡è§„åˆ™æ¥æŒ‡å®šå…è®¸è¯¥èµ„æºé€šè¿‡çš„è¯·æ±‚æ¬¡æ•°ï¼Œä¾‹å¦‚ä¸‹é¢çš„ä»£ç å®šä¹‰äº†èµ„æº <code>HelloWorld</code> æ¯ç§’æœ€å¤šåªèƒ½é€šè¿‡ 20 ä¸ªè¯·æ±‚ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// è§„åˆ™é…ç½®</span><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initFlowRules</span><span class="hljs-params">()</span> </span>&#123;<br>  List&lt;FlowRule&gt; rules = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>  FlowRule rule = <span class="hljs-keyword">new</span> FlowRule();<br>  rule.setResource(<span class="hljs-string">&quot;HelloWorld&quot;</span>);<br>  rule.setGrade(RuleConstant.FLOW_GRADE_QPS);<br>  <span class="hljs-comment">// Set limit QPS to 20.</span><br>  rule.setCount(<span class="hljs-number">20</span>);<br>  rules.add(rule);<br>  FlowRuleManager.loadRules(rules);<br>&#125;<br><br></code></pre></td></tr></table></figure><ol><li>Demo è¿è¡Œä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ—¥å¿— <code>~/logs/csp/$&#123;appName&#125;-metrics.log.xxx</code> é‡Œçœ‹åˆ°ä¸‹é¢çš„è¾“å‡º:</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">|--timestamp-|------date time----|-resource-|p |block|s |e|rt<br>1619954886000|2021-05-02 19:28:06|HelloWorld|20|1|20|0|12|0|0|0<br>1619954887000|2021-05-02 19:28:07|HelloWorld|20|3197|20|0|11|0|0|0<br>1619954888000|2021-05-02 19:28:08|HelloWorld|20|2857|20|0|11|0|0|0<br><br></code></pre></td></tr></table></figure><p>å…¶ä¸­ <code>p</code> ä»£è¡¨é€šè¿‡çš„è¯·æ±‚, <code>block</code> ä»£è¡¨è¢«é˜»æ­¢çš„è¯·æ±‚, <code>s</code> ä»£è¡¨æˆåŠŸæ‰§è¡Œå®Œæˆçš„è¯·æ±‚ä¸ªæ•°, <code>e</code> ä»£è¡¨ç”¨æˆ·è‡ªå®šä¹‰çš„å¼‚å¸¸, <code>rt</code> ä»£è¡¨å¹³å‡å“åº”æ—¶é•¿ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªç¨‹åºæ¯ç§’ç¨³å®šè¾“å‡º â€œhello worldâ€ 20 æ¬¡ï¼Œå’Œè§„åˆ™ä¸­é¢„å…ˆè®¾å®šçš„é˜ˆå€¼æ˜¯ä¸€æ ·çš„ã€‚</p><h2 id="æ³¨è§£æ–¹å¼"><a href="#æ³¨è§£æ–¹å¼" class="headerlink" title="æ³¨è§£æ–¹å¼"></a>æ³¨è§£æ–¹å¼</h2><ol><li>Sentinel æä¾›äº† <code>@SentinelResource</code> æ³¨è§£ç”¨äºå®šä¹‰èµ„æºï¼Œå¹¶æä¾›äº† AspectJ çš„æ‰©å±•ç”¨äºè‡ªåŠ¨å®šä¹‰èµ„æºã€å¤„ç† <code>BlockException</code> ç­‰ã€‚ä½¿ç”¨ <a href="https://github.com/alibaba/Sentinel/tree/master/sentinel-extension/sentinel-annotation-aspectj">Sentinel Annotation AspectJ Extension</a> çš„æ—¶å€™éœ€è¦å¼•å…¥ä»¥ä¸‹ä¾èµ–ï¼š</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.csp<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>sentinel-annotation-aspectj<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>x.y.z<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br></code></pre></td></tr></table></figure><ol><li>ç¤ºä¾‹</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å¯¹åº”çš„ `handleException` å‡½æ•°éœ€è¦ä½äº `ExceptionUtil` ç±»ä¸­ï¼Œå¹¶ä¸”å¿…é¡»ä¸º public static å‡½æ•°.</span><br><span class="hljs-comment">// å¯¹åº”çš„è¿”å›å€¼ä¹Ÿéœ€è¦å’Œå½“å‰æ–¹æ³•ä¸€æ ·</span><br><span class="hljs-meta">@SentinelResource(value = &quot;createOrder&quot;,</span><br><span class="hljs-meta">                  blockHandler = &quot;blockHandler&quot;,</span><br><span class="hljs-meta">                  blockHandlerClass = &#123;ExceptionUtils.class&#125;)</span><br><span class="hljs-meta">@GetMapping(&quot;/createOrder&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> OrderDto <span class="hljs-title">createOrder</span><span class="hljs-params">(OrderDto dto)</span> </span>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> OrderDto();<br>&#125;<br><br><span class="hljs-comment">// ExceptionUtils</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExceptionUtils</span> </span>&#123;<br><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> OrderDto <span class="hljs-title">blockHandler</span><span class="hljs-params">(OrderDto dto, BlockException ex)</span> </span>&#123;<br>    ex.printStackTrace();<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="SentinelResource-æ³¨è§£"><a href="#SentinelResource-æ³¨è§£" class="headerlink" title="@SentinelResource æ³¨è§£"></a>@SentinelResource æ³¨è§£</h2><blockquote><p>æ³¨æ„ï¼šæ³¨è§£æ–¹å¼åŸ‹ç‚¹ä¸æ”¯æŒ private æ–¹æ³•ã€‚</p></blockquote><p>@SentinelResource ç”¨äºå®šä¹‰èµ„æºï¼Œå¹¶æä¾›å¯é€‰çš„å¼‚å¸¸å¤„ç†å’Œ fallback é…ç½®é¡¹ã€‚ @SentinelResource æ³¨è§£åŒ…å«ä»¥ä¸‹å±æ€§ï¼š</p><ul><li>valueï¼šèµ„æºåç§°ï¼Œå¿…éœ€é¡¹ï¼ˆä¸èƒ½ä¸ºç©ºï¼‰</li><li>entryTypeï¼šentry ç±»å‹ï¼Œå¯é€‰é¡¹ï¼ˆé»˜è®¤ä¸º EntryType.OUTï¼‰</li><li>blockHandler / blockHandlerClass: blockHandler å¯¹åº”å¤„ç† BlockException çš„å‡½æ•°åç§°ï¼Œå¯é€‰é¡¹ã€‚blockHandler å‡½æ•°è®¿é—®èŒƒå›´éœ€è¦æ˜¯ publicï¼Œè¿”å›ç±»å‹éœ€è¦ä¸åŸæ–¹æ³•ç›¸åŒ¹é…ï¼Œå‚æ•°ç±»å‹éœ€è¦å’ŒåŸæ–¹æ³•ç›¸åŒ¹é…å¹¶ä¸”æœ€ååŠ ä¸€ä¸ªé¢å¤–çš„å‚æ•°ï¼Œç±»å‹ä¸º BlockExceptionã€‚blockHandler å‡½æ•°é»˜è®¤éœ€è¦å’ŒåŸæ–¹æ³•åœ¨åŒä¸€ä¸ªç±»ä¸­ã€‚è‹¥å¸Œæœ›ä½¿ç”¨å…¶ä»–ç±»çš„å‡½æ•°ï¼Œåˆ™å¯ä»¥æŒ‡å®š blockHandlerClass ä¸ºå¯¹åº”çš„ç±»çš„ Class å¯¹è±¡ï¼Œæ³¨æ„å¯¹åº”çš„å‡½æ•°å¿…éœ€ä¸º static å‡½æ•°ï¼Œå¦åˆ™æ— æ³•è§£æã€‚</li><li>fallback / fallbackClassï¼šfallback å‡½æ•°åç§°ï¼Œå¯é€‰é¡¹ï¼Œç”¨äºåœ¨æŠ›å‡ºå¼‚å¸¸çš„æ—¶å€™æä¾› fallback å¤„ç†é€»è¾‘ã€‚fallback å‡½æ•°å¯ä»¥é’ˆå¯¹æ‰€æœ‰ç±»å‹çš„å¼‚å¸¸ï¼ˆé™¤äº† exceptionsToIgnore é‡Œé¢æ’é™¤æ‰çš„å¼‚å¸¸ç±»å‹ï¼‰è¿›è¡Œå¤„ç†ã€‚fallback å‡½æ•°ç­¾åå’Œä½ç½®è¦æ±‚ï¼š<ul><li>è¿”å›å€¼ç±»å‹å¿…é¡»ä¸åŸå‡½æ•°è¿”å›å€¼ç±»å‹ä¸€è‡´ï¼›</li><li>æ–¹æ³•å‚æ•°åˆ—è¡¨éœ€è¦å’ŒåŸå‡½æ•°ä¸€è‡´ï¼Œæˆ–è€…å¯ä»¥é¢å¤–å¤šä¸€ä¸ª Throwable ç±»å‹çš„å‚æ•°ç”¨äºæ¥æ”¶å¯¹åº”çš„å¼‚å¸¸ã€‚</li><li>fallback å‡½æ•°é»˜è®¤éœ€è¦å’ŒåŸæ–¹æ³•åœ¨åŒä¸€ä¸ªç±»ä¸­ã€‚è‹¥å¸Œæœ›ä½¿ç”¨å…¶ä»–ç±»çš„å‡½æ•°ï¼Œåˆ™å¯ä»¥æŒ‡å®š fallbackClass ä¸ºå¯¹åº”çš„ç±»çš„ Class å¯¹è±¡ï¼Œæ³¨æ„å¯¹åº”çš„å‡½æ•°å¿…éœ€ä¸º static å‡½æ•°ï¼Œå¦åˆ™æ— æ³•è§£æã€‚</li></ul></li><li>defaultFallbackï¼ˆsince 1.6.0ï¼‰ï¼šé»˜è®¤çš„ fallback å‡½æ•°åç§°ï¼Œå¯é€‰é¡¹ï¼Œé€šå¸¸ç”¨äºé€šç”¨çš„ fallback é€»è¾‘ï¼ˆå³å¯ä»¥ç”¨äºå¾ˆå¤šæœåŠ¡æˆ–æ–¹æ³•ï¼‰ã€‚é»˜è®¤ fallback å‡½æ•°å¯ä»¥é’ˆå¯¹æ‰€æœ‰ç±»å‹çš„å¼‚å¸¸ï¼ˆé™¤äº† exceptionsToIgnore é‡Œé¢æ’é™¤æ‰çš„å¼‚å¸¸ç±»å‹ï¼‰è¿›è¡Œå¤„ç†ã€‚è‹¥åŒæ—¶é…ç½®äº† fallback å’Œ defaultFallbackï¼Œåˆ™åªæœ‰ fallback ä¼šç”Ÿæ•ˆã€‚defaultFallback å‡½æ•°ç­¾åè¦æ±‚ï¼š<ul><li>è¿”å›å€¼ç±»å‹å¿…é¡»ä¸åŸå‡½æ•°è¿”å›å€¼ç±»å‹ä¸€è‡´ï¼›</li><li>æ–¹æ³•å‚æ•°åˆ—è¡¨éœ€è¦ä¸ºç©ºï¼Œæˆ–è€…å¯ä»¥é¢å¤–å¤šä¸€ä¸ª Throwable ç±»å‹çš„å‚æ•°ç”¨äºæ¥æ”¶å¯¹åº”çš„å¼‚å¸¸ã€‚</li><li>defaultFallback å‡½æ•°é»˜è®¤éœ€è¦å’ŒåŸæ–¹æ³•åœ¨åŒä¸€ä¸ªç±»ä¸­ã€‚è‹¥å¸Œæœ›ä½¿ç”¨å…¶ä»–ç±»çš„å‡½æ•°ï¼Œåˆ™å¯ä»¥æŒ‡å®š fallbackClass ä¸ºå¯¹åº”çš„ç±»çš„ Class å¯¹è±¡ï¼Œæ³¨æ„å¯¹åº”çš„å‡½æ•°å¿…éœ€ä¸º static å‡½æ•°ï¼Œå¦åˆ™æ— æ³•è§£æã€‚</li></ul></li><li>exceptionsToIgnoreï¼ˆsince 1.6.0ï¼‰ï¼šç”¨äºæŒ‡å®šå“ªäº›å¼‚å¸¸è¢«æ’é™¤æ‰ï¼Œä¸ä¼šè®¡å…¥å¼‚å¸¸ç»Ÿè®¡ä¸­ï¼Œä¹Ÿä¸ä¼šè¿›å…¥ fallback é€»è¾‘ä¸­ï¼Œè€Œæ˜¯ä¼šåŸæ ·æŠ›å‡ºã€‚ 1.8.0 ç‰ˆæœ¬å¼€å§‹ï¼ŒdefaultFallback æ”¯æŒåœ¨ç±»çº§åˆ«è¿›è¡Œé…ç½®ã€‚</li></ul><blockquote><p>æ³¨ï¼š1.6.0 ä¹‹å‰çš„ç‰ˆæœ¬ fallback å‡½æ•°åªé’ˆå¯¹é™çº§å¼‚å¸¸ï¼ˆDegradeExceptionï¼‰è¿›è¡Œå¤„ç†ï¼Œä¸èƒ½é’ˆå¯¹ä¸šåŠ¡å¼‚å¸¸è¿›è¡Œå¤„ç†ã€‚</p></blockquote><p>ç‰¹åˆ«åœ°ï¼Œè‹¥ blockHandler å’Œ fallback éƒ½è¿›è¡Œäº†é…ç½®ï¼Œåˆ™è¢«é™æµé™çº§è€ŒæŠ›å‡º BlockException æ—¶åªä¼šè¿›å…¥ blockHandler å¤„ç†é€»è¾‘ã€‚è‹¥æœªé…ç½® blockHandlerã€fallback å’Œ defaultFallbackï¼Œåˆ™è¢«é™æµé™çº§æ—¶ä¼šå°† BlockException ç›´æ¥æŠ›å‡ºï¼ˆè‹¥æ–¹æ³•æœ¬èº«æœªå®šä¹‰ throws BlockException åˆ™ä¼šè¢« JVM åŒ…è£…ä¸€å±‚ UndeclaredThrowableExceptionï¼‰ã€‚</p><h2 id="Sentinel-æ§åˆ¶å°"><a href="#Sentinel-æ§åˆ¶å°" class="headerlink" title="Sentinel æ§åˆ¶å°"></a>Sentinel æ§åˆ¶å°</h2><ol><li>ä¸‹è½½æ§åˆ¶å°ç¨‹åºåœ°å€ï¼š</li></ol><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/alibaba/</span>Sentinel<span class="hljs-regexp">/releases/</span>tag/<span class="hljs-number">1.8</span>.<span class="hljs-number">1</span><br><br></code></pre></td></tr></table></figure><ol><li>å¯åŠ¨å‘½ä»¤</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">java -Dserver.port=8089 -Dcsp.sentinel.dashboard.server=127.0.0.1:8089 -Dproject.name=sentinel-dashboard -jar sentinel-dashboard-1.8.1.jar<br><br></code></pre></td></tr></table></figure><ol><li>ç™»å½•è´¦å·ï¼Œé»˜è®¤çš„ç™»å½•å¸å·å’Œå¯†ç éƒ½æ˜¯ï¼šsentinel</li><li>ç™»å½•æ§åˆ¶å°åæˆ‘ä»¬å¯ä»¥é€šè¿‡å³ä¾§èœå•å¯¹æˆ‘ä»¬çš„æœåŠ¡è¿›è¡Œé…ç½®</li></ol><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/1746e587b48a47ed9538c277a5b1fed8~tplv-k3u1fbpfcp-watermark.image" alt="sentinel ç›‘æ§.png"></p><h1 id=""><a href="#" class="headerlink" title=""></a></h1>]]></content>
    
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>Sentinel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>IDEA2021é¦–ä¸ªå¤§ç‰ˆæœ¬å‘å¸ƒ</title>
    <link href="/blog/2021/05/08/IDEA2021%E9%A6%96%E4%B8%AA%E5%A4%A7%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/"/>
    <url>/blog/2021/05/08/IDEA2021%E9%A6%96%E4%B8%AA%E5%A4%A7%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/</url>
    
    <content type="html"><![CDATA[<p>å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨ï¼</p><p>å°±åœ¨ä¸ä¹…ä¹‹å‰ï¼ŒJavaé¢†åŸŸçš„å¼€å‘ç¥å™¨<code>IntelliJ IDEA</code>ç»ˆäºè¿æ¥2021å¹´çš„ä¸€ä¸ªé‡è¦çš„å¤§ç‰ˆæœ¬æ›´æ–°ï¼š<code>IntelliJ IDEA 2021.1</code>ã€‚</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/0d5b436c8f7b4d19b4a2c53f6d3abc23~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>ç°å¦‚ä»Šå¤§é‡çš„Javaå¼€å‘è€…æ·±åº¦ä¾èµ–ç€è¿™æ¬¾å¼€å‘è½¯ä»¶ï¼Œæ­£å¦‚ç½‘ä¸Šçš„æ®µå­æ‰€è¨€ï¼šâ€œå¯ä»¥æ¯«ä¸å¤¸å¼ åœ°è¯´ï¼Œå¤šå°‘Javaç¨‹åºå‘˜ç¦»å¼€äº†IDEAå°±ä¸ä¼šå†™ä»£ç äº†ï¼ˆç‹—å¤´ï¼‰â€ï¼Œç”±æ­¤å¯è§å…¶ä½¿ç”¨çš„å¹¿æ³›ç¨‹åº¦ã€‚</p><p>æ–°ç‰ˆæœ¬ä¸€å‡ºæ¥ï¼Œæˆ‘ä¹Ÿè¿«ä¸åŠå¾…åœ°æƒ³å°è¯•ä¸€ç•ªã€‚å½“ç„¶ï¼Œä¸»åŠ›å¼€å‘æœºæˆ‘æ˜¯ä¸æ•¢ä¹±å‡çº§çš„ï¼Œæ‰€ä»¥è¿™ä¸¤å¤©ï¼Œæˆ‘åœ¨ä¸€å°å¹³æ—¶ç”¨æ¥åšæµ‹è¯•çš„è€å¼€å‘æœ¬å­ä¸Šæ›´æ–°äº†å…¨æ–°çš„IDEAã€‚</p><p>è½¯ä»¶å¯åŠ¨ç•Œé¢æ‰“å¼€çš„é‚£ä¸€ç¬é—´ï¼Œæˆ‘å°±çŸ¥é“äº‹æƒ…å¹¶ä¸ç®€å•ã€‚</p><h1 id="å…¨æ–°çš„å¯åŠ¨é¡µé¢"><a href="#å…¨æ–°çš„å¯åŠ¨é¡µé¢" class="headerlink" title="å…¨æ–°çš„å¯åŠ¨é¡µé¢"></a>å…¨æ–°çš„å¯åŠ¨é¡µé¢</h1><p>æ›´æ–°åï¼Œå…¨æ–°çš„å¯åŠ¨é¡µé¢æ›´åŠ èŠ±é‡Œèƒ¡å“¨äº†ã€‚</p><p>è½¯ä»¶å¯åŠ¨é€Ÿåº¦ä¹Ÿæ˜¯éå¸¸ä¹‹å¿«ï¼Œå°±æˆ‘è¿™å¤šå¹´è‹¦ç»ƒçš„ç«ç®­èˆ¬æ‰‹é€Ÿï¼Œéƒ½å·®ç‚¹æ²¡æˆªæ¥ä¸‹é¢è¿™å¼ å¯åŠ¨é¡µé¢å›¾ã€‚</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/0fbf04b10731427898ba772d5b975a05~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><hr><h1 id="Spaceé›†æˆ"><a href="#Spaceé›†æˆ" class="headerlink" title="Spaceé›†æˆ"></a>Spaceé›†æˆ</h1><p>JetBrainsæä¾›çš„Spaceè¿™ä¸ªåŠŸèƒ½ä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰å¬è¯´è¿‡ï¼Œè®²ç™½äº†å°±æ˜¯ä¸€å¥—é›†æˆçš„å›¢é˜Ÿåä½œç¯å¢ƒï¼Œå¯ä»¥æä¾›åŒ…æ‹¬æ„å»ºäº¤ä»˜ã€èŠå¤©åä½œã€å›¢é˜Ÿç®¡ç†ä»¥åŠé¡¹ç›®ç®¡ç†ç­‰åœ¨å†…çš„ä¸€æ•´å¥—åä½œä¸€ä½“åŒ–è§£å†³æ–¹æ¡ˆã€‚</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/da4834e6c4a5462f81fc8111ff057fef~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>æœ€æ–°çš„IDEA 2021.1æŠŠSpaceç¯å¢ƒç»™æ— ç¼åœ°é›†æˆè¿›æ¥äº†ï¼Œç°åœ¨å±äºå¼€ç®±å³ç”¨çš„çŠ¶æ€ï¼Œè½¯ä»¶çš„å³ä¸Šè§’å°±æœ‰å¿«æ·å…¥å£ï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/53a7139bcaba476382779037c3ec2135~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><hr><h1 id="æ”¯æŒWSL-2"><a href="#æ”¯æŒWSL-2" class="headerlink" title="æ”¯æŒWSL 2"></a>æ”¯æŒWSL 2</h1><p>è¿™ä¸ªåŠŸèƒ½ç›¸ä¿¡å¯¹äºå¾ˆå¤šä¾èµ–Windowsç³»ç»Ÿä»¥åŠWSLåŠŸèƒ½çš„ç”¨æˆ·æ¥è¯´ï¼Œç®€ç›´æ˜¯å–œå¤§æ™®å¥”ï¼</p><p>ä»¥å‰WSLå°±ç®—å†å¥½ç”¨ï¼Œä½†æ˜¯ä½ çš„IDEå¹¶æ²¡æœ‰å’Œå®ƒæ‰“é€šï¼Œå¤šå°‘æ€»æ˜¯ä¸€ä¸ªé—æ†¾ã€‚</p><p>è¿™ä¸‹å¥½äº†ï¼ŒäºŒè€…ç›´æ¥æ‰“é€šäº†ï¼ŒIDEAæ”¯æŒWSL 2ã€‚ä½ å¯ä»¥ç›´æ¥åœ¨æ–°ç‰ˆIDEA 2021.1ä¸­è¿è¡Œå¹¶å¼€å‘WSL 2ä¸­çš„Javaé¡¹ç›®ï¼ŒåŒ…æ‹¬Gradleç±»å‹é¡¹ç›®å’ŒMavenç±»å‹ç­‰é¡¹ç›®å‡æ”¯æŒã€‚</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/11e7a616543745b094f518e0833e0a23~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/8d07b172800a46278435e57f24f8d900~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><hr><h1 id="Run-Targets"><a href="#Run-Targets" class="headerlink" title="Run Targets"></a>Run Targets</h1><p>Run Targetsè¿™ä¸ªåŠŸèƒ½çš„æ„æ€æœ‰ç‚¹ç±»ä¼¼äºä¸Šé¢åˆšèŠè¿‡çš„WSL 2ã€‚å®ƒå…è®¸å¼€å‘è€…ç›´æ¥åœ¨è¿œç¨‹ä¸»æœºç”šè‡³åœ¨Dockerå®¹å™¨ä¸Šè¿è¡Œå’Œè°ƒè¯•é¡¹ç›®ã€‚</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/108245aa90ec4f52bba265fcc6f804a5~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>æ‰€ä»¥åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ–°ç‰ˆIDEA 2021å…è®¸å¼€å‘è€…å¯ä»¥åœ¨æœ¬åœ°ã€WSL 2ã€SSHè¿œç¨‹ä¸»æœºã€Dockerç­‰ç›®æ ‡ä¸Šè¿è¡Œé¡¹ç›®ï¼Œå¯ä»¥è¯´è´¼é¦™äº†ï¼</p><hr><h1 id="æ”¯æŒJava-16"><a href="#æ”¯æŒJava-16" class="headerlink" title="æ”¯æŒJava 16"></a>æ”¯æŒJava 16</h1><p>è¿™ä¹Ÿç®—æ˜¯ä¸€ä¸ªæ¯”è¾ƒé‡ç£…çš„æ›´æ–°ã€‚</p><p>è¿‘ä¸¤å¹´æ¥ï¼ŒJavaç‰ˆæœ¬çš„å‘å¸ƒé€Ÿåº¦ä¹Ÿæ˜¯å¿«å¦‚è€ç‹—ï¼Œæˆ‘è¿˜åœ¨ç”¨Java 8ï¼Œå®ƒéƒ½æ·¦åˆ°Java 16äº†ã€‚</p><p>å…³äºJava 16çš„æ–°ç‰¹æ€§ï¼Œæˆ‘è¿˜å‡†å¤‡å†™ç¯‡æ–‡ç« æ¥è¯¦ç»†èŠä¸€èŠå‘¢ï¼ŒåŒ…æ‹¬æ¯”å¦‚ï¼š</p><ul><li>Recordsç‰¹æ€§è½¬æ­£</li><li>instanceofæ¨¡å¼åŒ¹é…è½¬æ­£</li><li>jpackageè½¬æ­£</li><li>UnixåŸŸå¥—æ¥å­—é€šé“</li><li>å¼¹æ€§Metaspace</li><li>ZGC</li><li>çŸ¢é‡API</li><li>å¤–éƒ¨é“¾æ¥API</li><li>â€¦</li></ul><p>è¿™æ¬¡IDEA 2021ç‰ˆçš„ä¸€ä¸ªå¾ˆé‡è¦çš„æ›´æ–°å°±æ˜¯åŠ å…¥äº†å¯¹Java 16çš„åŸºæœ¬æ”¯æŒï¼Œæ³¨æ„æ˜¯åŸºæœ¬æ”¯æŒã€‚</p><p>é™¤æ­¤ä¹‹å¤–IDEAè¿˜æ–°å¢äº†å‡ é¡¹æ£€æŸ¥æœºåˆ¶ï¼Œå…¸å‹æ¯”å¦‚æ›´åŠ æ™ºèƒ½çš„æ•°æ®æµåˆ†ææ£€æŸ¥ã€‚</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/77576024e84240a88339f60125f9bd01~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>é“¾å¼æ„é€ æ–¹å¼çš„ä¼˜åŒ–æ ¼å¼è®¾ç½®ç­‰ç­‰ã€‚</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/5e9e57afa1114abaa70e646582f049d8~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>ç›®çš„éƒ½æ˜¯ä¸ºäº†å¸®åŠ©æå‡å¯è¯»æ€§ï¼Œè¿›ä¸€æ­¥æå‡ç”¨æˆ·ä½“éªŒã€‚</p><hr><h1 id="Code-With-Me"><a href="#Code-With-Me" class="headerlink" title="Code With Me"></a>Code With Me</h1><p>Code With Meæ˜¯ä¸€é¡¹ç”¨äºåä½œå¼€å‘ä¸ç»“å¯¹ç¼–ç¨‹çš„æœåŠ¡ï¼Œå¯ä»¥å®ç°<code>Host-Guest</code>æ¨¡å¼çš„â€œæ‰‹æ‘¸æ‰‹â€ï¼ˆæ»‘ç¨½ï¼‰ç»“å¯¹ç¼–ç¨‹å’Œç¾¤ä½“ç¼–ç¨‹ã€‚</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/bb9e5d49651b4c7ea0ff903b713cb15d~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>ç›®å‰ï¼Œæ–°ç‰ˆIDEAå¼€ç®±å³ç”¨åœ°æ”¯æŒäº†Code With MeåŠŸèƒ½ï¼ŒåŒæ—¶å®ƒè¿˜å…·æœ‰éŸ³é¢‘é€šè¯å’Œè§†é¢‘é€šè¯åŠŸèƒ½ï¼Œå¯ä»¥æ»¡è¶³éšæ—¶éšåœ°çš„æ²Ÿé€šéœ€æ±‚ï¼Œè¿™æ“ä½œç®€ç›´éªšåˆ°çˆ†ã€‚</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/975a2fe19c2c4ff192a4dfd38536b47a~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/0487f917947149cf804fd11c8c33645e~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><hr><h1 id="ç‰ˆæœ¬æ§åˆ¶"><a href="#ç‰ˆæœ¬æ§åˆ¶" class="headerlink" title="ç‰ˆæœ¬æ§åˆ¶"></a>ç‰ˆæœ¬æ§åˆ¶</h1><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/e5412ac81ee54d50824776bc8c1871c7~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>ç‰ˆæœ¬æ§åˆ¶è¿™ä¸€å—ç›®å‰åšäº†ä¸å°‘çš„æ›´æ–°ï¼ŒåŒ…æ‹¬å¯ä»¥æ›´å¿«åœ°å®ŒæˆPRçš„åˆ›å»ºæäº¤ï¼Œæ”¯æŒPRæ¨¡æ¿ã€‚</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/001caf51fe2a41e2b7d02e21ff134962~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>å˜æ›´æäº¤è‡³ä»£ç åº“å‰çš„è‡ªå®šä¹‰ä»£ç æ£€æŸ¥é…ç½®ã€‚</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/08ff5332c8664ffe98e9dad0190613c6~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>ä»¥åŠæ”¯æŒè‡ªå®šä¹‰Gitæäº¤æ¨¡æ¿ç­‰ç­‰ã€‚</p><hr><h1 id="å…¶ä»–ç”¨æˆ·ä½“éªŒæå‡"><a href="#å…¶ä»–ç”¨æˆ·ä½“éªŒæå‡" class="headerlink" title="å…¶ä»–ç”¨æˆ·ä½“éªŒæå‡"></a>å…¶ä»–ç”¨æˆ·ä½“éªŒæå‡</h1><h2 id="IDEAå†…ç½®HTMLç½‘é¡µé¢„è§ˆ"><a href="#IDEAå†…ç½®HTMLç½‘é¡µé¢„è§ˆ" class="headerlink" title="IDEAå†…ç½®HTMLç½‘é¡µé¢„è§ˆ"></a>IDEAå†…ç½®HTMLç½‘é¡µé¢„è§ˆ</h2><p>ä»¥å‰åœ¨IDEAä¸­é¢„è§ˆç½‘é¡µå¾—è·³åˆ°å¤–éƒ¨æµè§ˆå™¨ï¼Œè€Œç°å¦‚ä»ŠIDEçš„ç¼–è¾‘å™¨å†…éƒ¨å°±æ”¯æŒ<code>Built-in</code>çº§åˆ«çš„ç½‘é¡µé¢„è§ˆï¼Œåªéœ€è¦åœ¨å³ä¸Šè§’ç‚¹é‚£ä¸ªIDEAå°å›¾æ ‡å³å¯æ¿€æ´»ï¼Œè€Œä¸”å¯ä»¥ç¼–è¾‘ç½‘é¡µæºç æ—¶åšåˆ°åŒæ­¥æ›´æ–°å’Œé¢„è§ˆã€‚</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/e9e57262a6a646798a34ea5bbe73af61~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><h2 id="Windowsç‰ˆæœ¬ä»»åŠ¡æ å¢å¼º"><a href="#Windowsç‰ˆæœ¬ä»»åŠ¡æ å¢å¼º" class="headerlink" title="Windowsç‰ˆæœ¬ä»»åŠ¡æ å¢å¼º"></a>Windowsç‰ˆæœ¬ä»»åŠ¡æ å¢å¼º</h2><p>åœ¨Windowså¹³å°çš„æ–°ç‰ˆIDEAä¸Šï¼Œå¯ç›´æ¥åœ¨ä»»åŠ¡æ ï¼ˆæˆ–å¼€å§‹èœå•ï¼‰ä¸Šå³é”®å¿«æ·å‘¼å‡ºæœ€è¿‘ä½¿ç”¨çš„é¡¹ç›®ã€‚</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/d38cc8879aa34c41b24806d750c1425c~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><h2 id="æœç´¢æ—¶è‡ªå®šä¹‰å¤–éƒ¨ä¾èµ–é¡¹"><a href="#æœç´¢æ—¶è‡ªå®šä¹‰å¤–éƒ¨ä¾èµ–é¡¹" class="headerlink" title="æœç´¢æ—¶è‡ªå®šä¹‰å¤–éƒ¨ä¾èµ–é¡¹"></a>æœç´¢æ—¶è‡ªå®šä¹‰å¤–éƒ¨ä¾èµ–é¡¹</h2><p>è®²ç™½äº†ï¼Œå°±æ˜¯ä½¿æœç´¢èŒƒå›´æ›´æ˜“äºè‡ªå®šä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨è®¾ç½®ä¸­è¿›è¡ŒScopeå®šä¹‰ï¼Œè‡ªè¡Œé€‰æ‹©External Dependenciesçš„èŒƒå›´æ˜¯å¦åŒ…å«ã€‚</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/b114d1f88ad848c789108dab8cc837a8~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><h2 id="çª—å£æ‹†åˆ†ä¼˜åŒ–"><a href="#çª—å£æ‹†åˆ†ä¼˜åŒ–" class="headerlink" title="çª—å£æ‹†åˆ†ä¼˜åŒ–"></a>çª—å£æ‹†åˆ†ä¼˜åŒ–</h2><p>å½“ä½ å¯¹ç¼–è¾‘å™¨é‡Œçš„å¤šä¸ªæ–‡ä»¶è¿›è¡Œå‚ç›´çª—å£æ‹†åˆ†æ—¶ï¼ŒåŒå‡»æŸä¸ªTabå°±å¯ä»¥å°†å½“å‰æ–‡ä»¶çª—å£æœ€å¤§åŒ–ï¼Œå†æ¬¡åŒå‡»Tabåˆ™ä¼šè¿˜åŸã€‚</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/69ccfa7fb5bf4638acee50b8237b973c~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><hr><p>å½“ç„¶é™¤äº†è¿™äº›ä¹‹å¤–ï¼Œæ–°ç‰ˆIDEAè¿˜æ–°å¢äº†å¾ˆå¤šæ›´æ–°å’Œå¢å¼ºï¼Œæ¯”å¦‚ï¼šå¯¹Kotlinã€Scalaã€JavaScriptç­‰è¯­è¨€çš„å¼€å‘ä¼˜åŒ–ã€å¯¹å¸¸è§æ¡†æ¶ä¸æŠ€æœ¯çš„ä¼˜åŒ–å’Œæ”¯æŒã€å¯¹Kuberneteså’ŒDockerçš„æ›´æ–°æ”¯æŒå’Œæ”¹è¿›ã€æ•°æ®åº“å·¥å…·çš„æ›´æ–°æ”¯æŒç­‰ç­‰ï¼Œç”±äºæ—¶é—´æœ‰é™ï¼Œåœ¨æ­¤å°±ä¸ä¸€ä¸€èµ˜è¿°äº†ï¼Œæœ‰éœ€è¦çš„å¯ä»¥æŒ‰éœ€ç»†ç©¶ã€‚</p><p>æœ€åï¼Œè®©æˆ‘ä»¬ä¸€èµ·å¤§å–Šä¸€å¥ï¼šâ€œIDEAï¼Œyydsï¼â€</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/69e06fcd540e4009b7b75987e2498d76~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>ä½œè€…ï¼šCodeSheep<br>é“¾æ¥ï¼š<a href="https://juejin.cn/post/6959729508786110494">https://juejin.cn/post/6959729508786110494</a><br>æ¥æºï¼šæ˜é‡‘<br>è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>å·¥å…·</tag>
      
      <tag>IDEA2021</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨BeanUtilså±æ€§è½¬æ¢å·¥å…·</title>
    <link href="/blog/2021/05/07/BeanUtils%E5%B1%9E%E6%80%A7%E8%BD%AC%E6%8D%A2%E5%B7%A5%E5%85%B7/"/>
    <url>/blog/2021/05/07/BeanUtils%E5%B1%9E%E6%80%A7%E8%BD%AC%E6%8D%A2%E5%B7%A5%E5%85%B7/</url>
    
    <content type="html"><![CDATA[<h2 id="1-èƒŒæ™¯"><a href="#1-èƒŒæ™¯" class="headerlink" title="1 èƒŒæ™¯"></a>1 èƒŒæ™¯</h2><p>ä¹‹å‰åœ¨ä¸“æ ä¸­è®²è¿‡â€œä¸æ¨èä½¿ç”¨å±æ€§æ‹·è´å·¥å…·â€ï¼Œæ¨èç›´æ¥å®šä¹‰è½¬æ¢ç±»å’Œæ–¹æ³•ä½¿ç”¨ IDEA æ’ä»¶è‡ªåŠ¨å¡«å…… get / set å‡½æ•°ã€‚</p><p><strong>ä¸æ¨èçš„ä¸»è¦ç†ç”±æ˜¯ï¼š</strong></p><p>æœ‰äº›å±æ€§æ‹·è´å·¥å…·æ€§èƒ½æœ‰ç‚¹å·® æœ‰äº›å±æ€§æ‹·è´å·¥å…·æœ‰â€œBUGâ€ ä½¿ç”¨å±æ€§æ‹·è´å·¥å…·å®¹æ˜“å­˜åœ¨ä¸€äº›éšæ‚£ï¼ˆåé¢ä¾‹å­ä¼šè®²åˆ°ï¼‰</p><h2 id="2-ç¤ºä¾‹"><a href="#2-ç¤ºä¾‹" class="headerlink" title="2 ç¤ºä¾‹"></a>2 ç¤ºä¾‹</h2><p>é¦–å…ˆå…¬å¸å†…éƒ¨å°±é‡åˆ°è¿‡ commons åŒ…çš„ BeanUtils è¿›è¡Œå±æ€§æ‹·è´æ€§èƒ½è¾ƒå·®çš„çœŸå®æ¡ˆä¾‹ï¼Œç„¶åè¯¥åŒäº‹æ¢æˆäº† Spring çš„ BeanUtils æ€§èƒ½å¥½äº†å¾ˆå¤šï¼Œæ„Ÿå…´è¶£å¤§å®¶å¯ä»¥ä½¿ç”¨æ€§èƒ½æµ‹è¯•æ¡†æ¶æˆ–è€…åŸºå‡†æµ‹è¯•æ¡†æ¶å»å¯¹æ¯”ï¼Œè¿™é‡Œå°±ä¸å¯¹æ¯”äº†ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ Spring çš„ BeanUtils çš„å±æ€§æ‹·è´ä¼šå­˜åœ¨å•¥é—®é¢˜ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java">`<span class="hljs-keyword">import</span> lombok.Data;`<br>`<span class="hljs-keyword">import</span> java.util.List;`<br>`<span class="hljs-meta">@Data</span>`<br>`<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span> </span>&#123;`<br> `<span class="hljs-keyword">private</span> String name;`<br> `<span class="hljs-keyword">private</span> List&lt;Integer&gt; ids;`<br>`&#125;`<br>`<span class="hljs-meta">@Data</span>`<br>`<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span> </span>&#123;`<br> `<span class="hljs-keyword">private</span> String name;`<br> `<span class="hljs-keyword">private</span> List&lt;String&gt; ids;`<br>`&#125;`<br>å¤åˆ¶ä»£ç <br>`<span class="hljs-keyword">import</span> org.springframework.beans.BeanUtils;`<br>`<span class="hljs-keyword">import</span> java.util.Arrays;`<br>`<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BeanUtilDemo</span> </span>&#123;`<br> `<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;`<br> `A first = <span class="hljs-keyword">new</span> A();`<br> `first.setName(<span class="hljs-string">&quot;demo&quot;</span>);`<br> `first.setIds(Arrays.asList(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>));`<br> `B second = <span class="hljs-keyword">new</span> B();`<br> `BeanUtils.copyProperties(first, second);`<br> `<span class="hljs-comment">// ç±»å‹è½¬æ¢å¼‚å¸¸`</span><br> `<span class="hljs-keyword">for</span> (String each : second.getIds()) &#123;`<br> `System.out.println(each);`<br> `&#125;`<br> `&#125;`<br>`&#125;`<br><br></code></pre></td></tr></table></figure><p>å¤§å®¶è¿è¡Œä¸Šè¿°ç¤ºä¾‹æ—¶ï¼Œä¼šå‘ç”Ÿç±»å‹è½¬æ¢å¼‚å¸¸ã€‚</p><p>æ‰“æ–­ç‚¹å¯ä»¥çœ‹åˆ°ï¼Œå±æ€§æ‹·è´ä¹‹å B ç±»å‹çš„ second å¯¹è±¡ä¸­ ids ä»ç„¶ä¸º Integer ç±»å‹ï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/cb821056275d46f48b3db29947f9c884~tplv-k3u1fbpfcp-zoom-1.image" alt="å›¾ç‰‡"></p><p>å¦‚æœä¸è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œç›´æ¥è¿›è¡Œæ‰“å°ï¼Œå¹¶ä¸ä¼šæŠ¥é”™ã€‚</p><p>ä½¿ç”¨CGlib åœ¨ä¸å®šä¹‰Converter çš„æƒ…å†µä¸‹ä¹Ÿä¼šé‡åˆ°ç±»ä¼¼é—®é¢˜ï¼š</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">`import org.easymock.cglib.beans.BeanCopier<span class="hljs-comment">;`</span><br>`import java.util.Arrays<span class="hljs-comment">;`</span><br>`public class BeanUtilDemo &#123;`<br> `public static void main(String[] args) &#123;`<br> `A first = <span class="hljs-keyword">new</span> A()<span class="hljs-comment">;`</span><br> `first.setName(<span class="hljs-string">&quot;demo&quot;</span>)<span class="hljs-comment">;`</span><br> `first.setIds(Arrays.asList(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>))<span class="hljs-comment">;`</span><br> `B second = <span class="hljs-keyword">new</span> B()<span class="hljs-comment">;`</span><br> `final BeanCopier beanCopier = BeanCopier.create(A.class, B.class, <span class="hljs-literal">false</span>)<span class="hljs-comment">;`</span><br> `beanCopier.copy(first,second,null)<span class="hljs-comment">;`</span><br><span class="hljs-title"> `for (String each :</span> second.getIds()) &#123;// ç±»å‹è½¬æ¢å¼‚å¸¸`<br> `System.out.println(each)<span class="hljs-comment">;`</span><br> `&#125;`<br> `&#125;`<br>`&#125;`<br><br></code></pre></td></tr></table></figure><p>åŒæ ·ï¼Œé—®é¢˜åœ¨è¿è¡Œæ—¶æ‰æš´éœ²å‡ºæ¥ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸‹ mapstructï¼š</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">`import org.mapstruct.Mapper<span class="hljs-comment">;`</span><br>`import org.mapstruct.factory.Mappers<span class="hljs-comment">;`</span><br>`@Mapper`<br>`public interface Converter &#123;`<br> `Converter INSTANCE = Mappers.getMapper(Converter.class)<span class="hljs-comment">;`</span><br> `B aToB(A car)<span class="hljs-comment">;`</span><br>`&#125;`<br>`import java.util.Arrays<span class="hljs-comment">;`</span><br>`public class BeanUtilDemo &#123;`<br> `public static void main(String[] args) &#123;`<br> `A first = <span class="hljs-keyword">new</span> A()<span class="hljs-comment">;`</span><br> `first.setName(<span class="hljs-string">&quot;demo&quot;</span>)<span class="hljs-comment">;`</span><br> `first.setIds(Arrays.asList(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>))<span class="hljs-comment">;`</span><br> `B second = Converter.INSTANCE.aToB(first)<span class="hljs-comment">;`</span><br><span class="hljs-title"> `for (String each :</span> second.getIds()) &#123;// æ­£å¸¸`<br> `System.out.println(each)<span class="hljs-comment">;`</span><br> `&#125;`<br> `&#125;`<br>`&#125;`<br><br></code></pre></td></tr></table></figure><p>å¯ä»¥æˆåŠŸçš„å°† A ä¸­ Listè½¬ä¸º B ä¸­çš„ Listç±»å‹ã€‚</p><p>æˆ‘ä»¬çœ‹ä¸‹ç¼–è¯‘ç”Ÿæˆçš„ Converter å®ç°ç±»ï¼š</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">`import java.util.ArrayList<span class="hljs-comment">;`</span><br>`import java.util.List<span class="hljs-comment">;`</span><br>`import javax.annotation.Generated<span class="hljs-comment">;`</span><br>`import org.springframework.stereotype.Component<span class="hljs-comment">;`</span><br>`@Generated(`<br> `value = <span class="hljs-string">&quot;org.mapstruct.ap.MappingProcessor&quot;</span>,`<br> `comments = <span class="hljs-string">&quot;version: 1.3.1.Final, compiler: javac, environment: Java 1.8.0_202 (Oracle Corporation)&quot;</span>`<br>`)`<br>`@Component`<br>`public class ConverterImpl implements Converter &#123;`<br> `@Override`<br> `public B aToB(A car) &#123;`<br> `if ( car == null ) &#123;`<br> `return null<span class="hljs-comment">;`</span><br> `&#125;`<br> `B b = <span class="hljs-keyword">new</span> B()<span class="hljs-comment">;`</span><br> `b.setName( car.getName() )<span class="hljs-comment">;`</span><br> `b.setIds( integerListToStringList( car.getIds() ) )<span class="hljs-comment">;`</span><br> `return b<span class="hljs-comment">;`</span><br> `&#125;`<br> `protected List&lt;String&gt; integerListToStringList(List&lt;Integer&gt; list) &#123;`<br> `if ( list == null ) &#123;`<br> `return null<span class="hljs-comment">;`</span><br> `&#125;`<br> `List&lt;String&gt; list1 = <span class="hljs-keyword">new</span> ArrayList&lt;String&gt;( list.size() )<span class="hljs-comment">;`</span><br><span class="hljs-title"> `for ( Integer integer :</span> list ) &#123;`<br> `list1.add( String.valueOf( integer ) )<span class="hljs-comment">;`</span><br> `&#125;`<br> `return list1<span class="hljs-comment">;`</span><br> `&#125;`<br>`&#125;`<br><br></code></pre></td></tr></table></figure><p>è‡ªåŠ¨å¸®æˆ‘ä»¬è¿›è¡Œäº†è½¬æ¢ï¼Œæˆ‘ä»¬å¯èƒ½æ²¡æœ‰æ„è¯†åˆ°ç±»å‹å¹¶ä¸ä¸€è‡´ã€‚</p><p>å¦‚æœæˆ‘ä»¬åœ¨ A ç±»ä¸­æ·»åŠ ä¸€ä¸ª String number å±æ€§ï¼Œåœ¨ B ç±»ä¸­æ·»åŠ ä¸€ä¸ª Long number å±æ€§ï¼Œä½¿ç”¨ mapstruect å½“ number è®¾ç½®ä¸ºéæ•°å­—ç±»å‹æ—¶å°±ä¼šæŠ¥ .NumberFormatExceptionã€‚</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">`@Override`<br>`public B aToB(A car) &#123;`<br> `if ( car == null ) &#123;`<br> `return null<span class="hljs-comment">;`</span><br> `&#125;`<br> `B b = <span class="hljs-keyword">new</span> B()<span class="hljs-comment">;`</span><br> `b.setName( car.getName() )<span class="hljs-comment">;`</span><br> `if ( car.getNumber() != null ) &#123; // é—®é¢˜å‡ºåœ¨è¿™é‡Œ`<br> `b.setNumber( Long.parseLong( car.getNumber() ) )<span class="hljs-comment">;`</span><br> `&#125;`<br> `b.setIds( integerListToStringList( car.getIds() ) )<span class="hljs-comment">;`</span><br> `return b<span class="hljs-comment">;`</span><br>`&#125;`<br><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ cglib é»˜è®¤åˆ™ä¸ä¼šæ˜ å°„ number å±æ€§ï¼ŒB ä¸­çš„ number ä¸º nullã€‚</p><p>å¦‚æœæ‰‹åŠ¨å®šä¹‰è½¬æ¢å™¨ï¼Œä½¿ç”¨ IDEA æ’ä»¶(å¦‚ generateO2O)è‡ªåŠ¨è½¬æ¢ï¼š</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">`public final class A2BConverter &#123;`<br> `public static B from(A first) &#123;`<br> `B b = <span class="hljs-keyword">new</span> B()<span class="hljs-comment">;`</span><br> `b.setName(first.getName())<span class="hljs-comment">;`</span><br> `b.setIds(first.getIds())<span class="hljs-comment">;`</span><br> `return b<span class="hljs-comment">;`</span><br> `&#125;`<br>`&#125;`<br><br></code></pre></td></tr></table></figure><p>åœ¨ç¼–ç é˜¶æ®µå°±å¯ä»¥éå¸¸æ˜ç¡®åœ°å‘ç°è¿™ä¸ªé—®é¢˜ï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/eee57aceb1ae42599cf03fff6d8d5fee~tplv-k3u1fbpfcp-zoom-1.image" alt="å›¾ç‰‡"></p><h2 id="3-ç»“è®º"><a href="#3-ç»“è®º" class="headerlink" title="3 ç»“è®º"></a>3 ç»“è®º</h2><p>ç”±äº Java çš„æ³›å‹å…¶å®æ˜¯ç¼–è¯‘æœŸæ£€æŸ¥ï¼Œç¼–è¯‘åæ³›å‹æ“¦é™¤ï¼Œå¯¼è‡´è¿è¡Œæ—¶ Listå’Œ Listéƒ½æ˜¯ List ç±»å‹ï¼Œå¯ä»¥æ­£å¸¸èµ‹å€¼ã€‚è¿™å°±å¯¼è‡´åœ¨ä½¿ç”¨å¾ˆå¤šå±æ€§æ˜ å°„å·¥å…·æ—¶ï¼Œç¼–è¯‘æ—¶ä¸å®¹æ˜“æ˜æ˜¾çš„é”™è¯¯ã€‚</p><p>mapstruct è‡ªå®šä¹‰äº†æ³¨è§£å¤„ç†å™¨ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µå¯ä»¥è¯»å–æ˜ å°„åŒæ–¹çš„æ³›å‹ç±»å‹ï¼Œè¿›è€Œè¿›è¡Œæ˜ å°„ã€‚ä½†æ˜¯è¿™ç§æ˜ å°„ä¹Ÿå¾ˆå¯æ€•ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬ç”±äºç²—å¿ƒç­‰åŸå› å®šä¹‰é”™äº†ç±»å‹ï¼Œè‡ªåŠ¨å¸®åŠ©æˆ‘ä»¬è¿›è¡Œäº†è½¬æ¢ï¼Œä¼šå¸¦äº†å¾ˆå¤šå‰¯ä½œç”¨ã€‚</p><p>ä¹‹å‰å¯¹å„ç§å±æ€§æ˜ å°„å·¥å…·çš„æ€§èƒ½è¿›è¡Œäº†ç®€å•çš„å¯¹æ¯”ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/01dbea76a40048e9a81d277c391d6a92~tplv-k3u1fbpfcp-zoom-1.image" alt="å›¾ç‰‡"></p><p>å› æ­¤æ…ç”¨å±æ€§è½¬æ¢å·¥å…·ï¼Œå¦‚æœå¯èƒ½å»ºè®®è‡ªå®šä¹‰è½¬æ¢ç±»ï¼Œä½¿ç”¨IDEAæ’ä»¶è‡ªåŠ¨å¡«å……ï¼Œæ•ˆç‡ä¹ŸæŒºé«˜ï¼Œ A æˆ– B ä¸­ä»»ä½•å±æ€§ç±»å‹ä¸åŒ¹é…ï¼Œç”šè‡³åˆ é™¤ä¸€ä¸ªå±æ€§ï¼Œç¼–è¯‘é˜¶æ®µå³å¯æŠ¥é”™ï¼Œè€Œä¸”ç›´æ¥è°ƒç”¨ get set çš„æ•ˆç‡ä¹Ÿæ˜¯éå¸¸é«˜çš„ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>BeanUtils</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¦‚ä½•å‡†ç¡®åˆ¤æ–­ä»€ä¹ˆæ—¶å€™å¯ä»¥ç»™å¤§è¡¨åŠ ç´¢å¼•</title>
    <link href="/blog/2021/05/06/%E5%A6%82%E4%BD%95%E5%87%86%E7%A1%AE%E5%88%A4%E6%96%AD%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E5%8F%AF%E4%BB%A5%E7%BB%99%E5%A4%A7%E8%A1%A8%E5%8A%A0%E7%B4%A2%E5%BC%95/"/>
    <url>/blog/2021/05/06/%E5%A6%82%E4%BD%95%E5%87%86%E7%A1%AE%E5%88%A4%E6%96%AD%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E5%8F%AF%E4%BB%A5%E7%BB%99%E5%A4%A7%E8%A1%A8%E5%8A%A0%E7%B4%A2%E5%BC%95/</url>
    
    <content type="html"><![CDATA[<h4 id="å¯¼è¯»"><a href="#å¯¼è¯»" class="headerlink" title="å¯¼è¯»"></a>å¯¼è¯»</h4><p>ä»¥ç¤¾äº¤å¹³å°çš„ç”¨æˆ·è¡¨ä¸ºä¾‹ï¼Œéšç€ä¸šåŠ¡çš„å¿«é€Ÿå¢é•¿ï¼Œç”¨æˆ·è¡¨userå•è¡¨æ•°æ®é‡è¶Šæ¥è¶Šå¤§ï¼Œæ­¤æ—¶ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ç»™userè¡¨æ·»åŠ ç´¢å¼•ï¼Œæ•°æ®è§„æ¨¡å¯¹æ·»åŠ è¿‡ç¨‹çš„å½±å“åŠ¿å¿…è¦è€ƒè™‘åœ¨å†…ï¼Œä½†æ˜¯ï¼Œå•è¡¨æ•°æ®è§„æ¨¡å¯¹æ·»åŠ ç´¢å¼•ä¼šäº§ç”Ÿä»€ä¹ˆæ ·çš„å½±å“å‘¢ï¼Œæˆ‘ä»¬åœ¨ä»€ä¹ˆæ ·çš„æ•°æ®åº“è¯·æ±‚çŠ¶æ€ä¸‹ç»™å¤§è¡¨æ·»åŠ ç´¢å¼•æ¯”è¾ƒå¥½å‘¢ï¼Ÿ</p><blockquote><p>ä»Šå¤©ï¼Œæˆ‘å°±è¯¦ç»†å›ç­”ä¸€ä¸‹ä¸Šé¢ä¸¤ä¸ªé—®é¢˜ï¼š</p><ol><li>å•è¡¨æ•°æ®è§„æ¨¡å¯¹æ·»åŠ ç´¢å¼•ä¼šäº§ç”Ÿä»€ä¹ˆæ ·çš„ä¸šåŠ¡å½±å“ï¼Ÿ</li><li>åœ¨ä»€ä¹ˆæ ·çš„æ•°æ®åº“è¯·æ±‚çŠ¶æ€ä¸‹ç»™å¤§è¡¨æ·»åŠ ç´¢å¼•æ¯”è¾ƒå¥½ï¼Ÿ</li></ol></blockquote><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œå½“æˆ‘ä»¬å›ç­”äº†ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œé‚£ä¹ˆï¼Œç¬¬äºŒä¸ªé—®é¢˜çš„ç­”æ¡ˆä¹Ÿå°±æµ®å‡ºæ°´é¢äº†ã€‚</p><h4 id="Row-Log"><a href="#Row-Log" class="headerlink" title="Row Log"></a>Row Log</h4><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªç»“æ„ï¼Œå®ƒå«<code>Row Log</code>ï¼Œç”¨äºåœ¨DDLè¿‡ç¨‹ä¸­è®°å½•DMLæ“ä½œçš„æ—¥å¿—æ–‡ä»¶ã€‚</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/13ee77835ae4471e96c3a5828df3749f~tplv-k3u1fbpfcp-watermark.image" alt="image-20210102173304826.png"></p><p>æˆ‘ä»¥userè¡¨ä¸ºä¾‹ï¼Œè®²è§£ä¸€ä¸‹<code>Row Log</code>ã€‚å®ƒæœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š</p><ol><li>æ¯ä¸ªç´¢å¼•å¯¹åº”ä¸€ä¸ªRow Logï¼Œå¦‚ä¸Šå›¾ä¸ºuserè¡¨çš„ç´¢å¼•<code>index_age_birth</code>å¯¹åº”çš„Row Logã€‚</li></ol><p>Row Logåœ¨é€»è¾‘ä¸Šç”±å¤šä¸ªBlockç»„æˆï¼Œæ¯ä¸ªBlockå¯ä»¥å­˜å‚¨å¤šä¸ªDMLæ“ä½œã€ä¸€ä¸ªDMLæ“ä½œä¹Ÿä¼šè½åœ¨å¤šä¸ªBlockä¸­ã€‚å¦‚ä¸Šå›¾ä¸­çš„Logä»£è¡¨DMLæ“ä½œï¼š</p><ol><li>æœ€å‰é¢ä¸¤ä¸ªLogå­˜åœ¨ç¬¬äºŒä¸ªBlockä¸­</li><li>ç¬¬3ä¸ªLogå’Œç¬¬4ä¸ªLogçš„å‰åŠéƒ¨åˆ†å­˜åœ¨ç¬¬ä¸‰ä¸ªBlockä¸­</li><li>ç¬¬4ä¸ªLogçš„ååŠéƒ¨åˆ†å’Œç¬¬5ä¸ªLogå­˜åœ¨æœ€åä¸€ä¸ªBlockä¸­</li></ol><p>åœ¨ç‰©ç†å­˜å‚¨ä¸Š<code>Row Log</code>åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š</p><ol><li>å†…å­˜æ—¥å¿—ï¼šå†…å­˜ä¸­ä¼šå­˜æ”¾ä¸€ä¸ªæ€»å¤§å°ç­‰äº<code>inndob_sort_buffer_size</code>çš„Blockï¼Œç”¨äºå†™å…¥DMLæ“ä½œ</li><li>æ–‡ä»¶æ—¥å¿—ï¼šå½“å†…å­˜ä¸­çš„Blockå†™æ»¡ï¼Œä¹Ÿå°±æ˜¯å¤§å°å¤§äº<code>innodb_sort_buffer_size</code>ï¼Œä¸”å°äº<code>innodb_online_alter_log_max_size</code>æ—¶ï¼Œå†™æ»¡çš„Blockä¼šåˆ·åˆ°ç£ç›˜ä¸Šï¼Œç©ºå‡ºå†…å­˜ä¸­çš„Blockç»™åç»­çš„Logå†™å…¥ï¼Œæ—¥å¿—æ–‡ä»¶ä¸­ï¼Œæ‰€æœ‰Blockæ€»å¤§å°å¦‚æœè¶…è¿‡<code>innodb_online_alter_log_max_size</code>ï¼Œå†™å…¥å°±ä¼šæŠ¥é”™</li></ol><p><code>Row Log</code>çš„æ ¸å¿ƒç»“æ„å¦‚ä¸‹ï¼š</p><ol><li>Logï¼šè¡¨ç¤ºDMLæ“ä½œæ—¥å¿—ï¼Œå®ƒçš„ç»“æ„ä¸º<code>æ“ä½œflag + äº‹åŠ¡id + æ“ä½œè®°å½•</code>ï¼Œå…¶ä¸­ï¼Œæ“ä½œflagåŒ…å«ä¸¤ç§ï¼š<code>INSERTå’ŒDELETEï¼ŒUPDATEçœ‹ä½œæ˜¯å…ˆDELETEï¼Œå†INSERT</code>ã€‚æ¯”å¦‚ï¼Œä¸Šå›¾ç¬¬ä¸€ä¸ªLogä¸­åŒ…å«ä¸€æ¡è®°å½•<code>&lt;0x61 + 1234 + &lt;25, 1998-01-02, 1&gt;&gt;</code>ï¼Œå…¶ä¸­ï¼Œ<code>0x61</code>ä»£è¡¨è¿™æ˜¯ä¸€ä¸ªæ’å…¥æ“ä½œï¼Œ<code>1234</code>è¡¨ç¤ºè¿™ä¸ªæ“ä½œçš„äº‹åŠ¡idï¼Œ<code>&lt;25, 1998-01-02, 1&gt;</code>è¡¨ç¤ºæ“ä½œçš„è®°å½•ã€‚</li><li>headï¼šè¿™æ˜¯ç”¨äºå°†Blockä¸­çš„Logå›æ”¾åˆ°ç´¢å¼•æ ‘æ—¶ï¼Œç”¨æ¥æ‰«æBlockä¸­Logçš„æŒ‡é’ˆï¼Œæ‰«å®Œä¸€ä¸ªLogï¼ŒheadæŒ‡é’ˆå‘åç§»åˆ°ä¸‹ä¸€ä¸ªLogã€‚å¦‚ä¸Šå›¾ï¼Œå› ä¸ºä»Blockçš„å¤´éƒ¨å¼€å§‹æ‰«æï¼ŒheadæŒ‡é’ˆåœ¨å›æ”¾å‰å¤„åœ¨Blockçš„ç¬¬ä¸€ä¸ªLogçš„ä½ç½®ã€‚</li><li>tailï¼šè¿™æ˜¯ç”¨äºå°†DMLæ“ä½œå†™å…¥ä¸€ä¸ªBlockæ—¶ï¼Œç”¨æ¥å®šä½Blockä¸­Logæ’å…¥ä½ç½®çš„æŒ‡é’ˆï¼Œæ’å…¥å®Œä¸€ä¸ªLogï¼ŒtailæŒ‡é’ˆå‘åç§»åŠ¨åˆ°æ–°æ’å…¥çš„Logã€‚å¦‚ä¸Šå›¾ï¼Œå› ä¸ºä»Blockçš„å¤´éƒ¨å¼€å§‹æ’å…¥Logï¼Œæ‰€ä»¥ï¼ŒtailæŒ‡é’ˆåœ¨æ’å…¥å‰å¤„åœ¨Blockçš„ç¬¬ä¸€ä¸ªLogçš„ä½ç½®ã€‚</li><li>blocksï¼šæ— è®ºæ˜¯headè¿˜æ˜¯tailæŒ‡é’ˆï¼Œéƒ½åŒ…å«ä¸€ä¸ªblockså­—æ®µï¼Œè¡¨ç¤ºRow Logæ—¥å¿—æ–‡ä»¶ä¸­åŒ…å«çš„Blockæ•°é‡</li></ol><h4 id="Row-Logè¿½åŠ "><a href="#Row-Logè¿½åŠ " class="headerlink" title="Row Logè¿½åŠ "></a>Row Logè¿½åŠ </h4><p>ä¸‹é¢æˆ‘ä»¬å†æ¥çœ‹ä¸‹Logæ˜¯å¦‚ä½•è¿½åŠ åˆ°Row Logçš„ï¼Ÿæˆ‘ä»¥userè¡¨çš„<code>index_age_birth</code>ç´¢å¼•çš„Row Logä¸ºä¾‹æ¥è¯´æ˜ï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/e4ed81de7ab54c4885b4e60350e52e33~tplv-k3u1fbpfcp-watermark.image" alt="image-20210102173453682.png"></p><p>è§ä¸Šå›¾ï¼Œä»ä¸Šåˆ°ä¸‹ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹è¿™ä¸ªè¿½åŠ çš„è¿‡ç¨‹ï¼š</p><ol><li><p>å¦‚æœå†…å­˜ä¸­æ²¡æœ‰Blockï¼Œåˆ›å»ºä¸€ä¸ª<code>innodb_sort_buffer_size</code>å¤§å°çš„Blockï¼ŒtailæŒ‡é’ˆæŒ‡å‘Blockä¸­çš„ç¬¬ä¸€ä¸ªLogï¼Œå¦‚æœæœ‰Blockï¼ŒtailæŒ‡é’ˆæŒ‡å‘Blockä¸­æœ€åä¸€ä¸ªLogã€‚å¦‚ä¸Šå›¾ï¼Œå†…å­˜ä¸­æœ‰Blockï¼ŒtailæŒ‡å‘Blockä¸­æœ€åä¸€ä¸ªLogï¼Œä¹Ÿå°±æ˜¯è™šçº¿æ¡†å‰é¢é‚£ä¸ªLog</p></li><li><p>æ ¹æ®å³å°†æ’å…¥çš„DMLæ“ä½œæ—¥å¿—å¤§å°ï¼Œå¾—åˆ°Blockä¸­ä¸‹ä¸€ä¸ªLogç›¸å¯¹æœ€åä¸€ä¸ªLogçš„åç§»é‡ã€‚å¦‚ä¸Šå›¾ä¸­çš„offsetï¼Œè¿™é‡Œåˆ†ä¸¤ç§æƒ…å†µï¼š</p><p>(1) å¦‚æœ<code>DMLæ“ä½œæ—¥å¿—å¤§å° &gt;= innodb_sort_buffer_size - å½“å‰Blockä¸­å·²æœ‰Logçš„æ€»å¤§å°ï¼Œåˆ™åç§»é‡ä¸ºinnodb_sort_buffer_size - å½“å‰Blockä¸­å·²æœ‰Logçš„æ€»å¤§å°</code></p><p>(2) å¦‚æœ<code>DMLæ“ä½œæ—¥å¿—å¤§å° &lt; innodb_sort_buffer_size - å½“å‰Blockä¸­å·²æœ‰Logçš„æ€»å¤§å°ï¼Œåˆ™åç§»é‡ä¸ºDMLæ“ä½œæ—¥å¿—å¤§å°</code></p></li><li><p>æ ¹æ®tailæŒ‡é’ˆå’Œåç§»é‡ï¼Œå°†æ’å…¥çš„DMLæ“ä½œæ—¥å¿—æ‹·è´åˆ°å†…å­˜çš„Blockã€‚è¿™é‡ŒåŒæ ·åˆ†ä¸¤ç§æƒ…å†µï¼š</p><p>(1) å…¨æ‹·è´</p><ul><li>å¦‚æœ<code>DMLæ“ä½œæ—¥å¿—å¤§å° &lt; innodb_sort_buffer_size - å½“å‰Blockä¸­å·²æœ‰Logçš„æ€»å¤§å°</code>ï¼Œå°†DMLæ“ä½œæ—¥å¿—å…¨éƒ¨æ‹·è´åˆ°Blockä¸­æœ«å°¾Logã€‚å¦‚ä¸Šå›¾ï¼Œå…¨æ‹·è´æœ€å³ä¾§ï¼Œå°†DMLæ—¥å¿—<code>&lt;0x61 + 3355 + &lt;25, 1998-01-02, 1&gt;&gt;</code>å®Œæ•´æ‹·è´åˆ°æœ«å°¾Logï¼Œç„¶åï¼Œå°†tailç§»åˆ°è¢«æ‹·è´çš„Logä¸Š</li></ul><p>(2) åŠæ‹·è´</p><ul><li>å¦‚æœ<code>DMLæ“ä½œæ—¥å¿—å¤§å° &gt;= innodb_sort_buffer_size - å½“å‰Blockä¸­å·²æœ‰Logçš„æ€»å¤§å°</code>ï¼Œæ‹·è´DMLæ“ä½œæ—¥å¿—çš„å‰é¢éƒ¨åˆ†åˆ°tailåé¢åç§»é‡å¤§å°çš„ç©ºé—´ã€‚å¦‚ä¸Šå›¾åŠæ‹·è´é‡Œçš„ä¸ŠåŠéƒ¨åˆ†ï¼Œå°†DMLæ—¥å¿—<code>&lt;0x61 + 3355 + &lt;25, 1998-01-02, 1&gt;&gt;</code>çš„å‰åŠéƒ¨åˆ†æ‹·è´åˆ°æœ«å°¾Logï¼Œç„¶åï¼Œå°†tailç§»åˆ°è¢«æ‹·è´çš„Logä¸Š</li><li>å°†å†…å­˜ä¸­æ•´ä¸ªBlockå†™å…¥Row Logæ—¥å¿—æ–‡ä»¶ã€‚å¦‚ä¸Šå›¾ï¼ŒåŠæ‹·è´é‡Œä¸ŠåŠéƒ¨åˆ†å¤§æ‹¬å·åŒ…å«äº†æ•´ä¸ªBlockï¼ŒåŒæ—¶å°†è¯¥Blocké€šè¿‡ç®­å¤´ï¼Œå†™å…¥<code>row_log_file</code></li><li>é‡æ–°å°†tailç§»åˆ°å†…å­˜ç©ºBlockçš„å¤´éƒ¨ï¼Œå°†DMLæ“ä½œçš„ååŠéƒ¨åˆ†æ‹·è´åˆ°tailåé¢åç§»é‡å¤§å°çš„ç©ºé—´ã€‚å¦‚ä¸Šå›¾åŠæ‹·è´é‡Œçš„ä¸‹åŠéƒ¨åˆ†ï¼Œå°†DMLæ—¥å¿—<code>&lt;0x61 + 3355 + &lt;25, 1998-01-02, 1&gt;&gt;</code>çš„ååŠéƒ¨åˆ†æ‹·è´åˆ°Blockçš„å¤´éƒ¨</li><li>å¦‚ä¸Šå›¾ï¼Œtail.blocks + 1ï¼Œä»£è¡¨Row Logæ—¥å¿—æ–‡ä»¶ä¸­æ–°å¢äº†ä¸€ä¸ªBlockã€‚</li></ul></li></ol><h4 id="Row-Logå›æ”¾"><a href="#Row-Logå›æ”¾" class="headerlink" title="Row Logå›æ”¾"></a>Row Logå›æ”¾</h4><p>MySQLå°†DMLæ—¥å¿—å†™åˆ°Row Logåªæ˜¯ä¸ºäº†åœ¨æ‰§è¡ŒDDLæœŸé—´ï¼Œå¯ä»¥å¹¶è¡Œæ‰§è¡ŒDMLï¼Œæœ€åï¼Œè¿™äº›DMLæ—¥å¿—è¿˜æ˜¯è¦æ›´æ–°(å›æ”¾)åˆ°ç´¢å¼•æ ‘ä¸Šçš„ï¼Œæ‰€ä»¥ï¼ŒåŒæ ·ä»¥ç´¢å¼•<code>index_age_birth</code>ä¸ºä¾‹ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸‹Row Logä¸­çš„æ—¥å¿—æ˜¯å¦‚ä½•æ›´æ–°åˆ°ç´¢å¼•æ ‘çš„ï¼Ÿ</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/b3ecf4add8134aa8a9a1192f5bea16c0~tplv-k3u1fbpfcp-watermark.image" alt="image-20210102173617242.png"></p><p>ä»ä¸Šåˆ°ä¸‹ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸Šé¢è¿™å¼ å›¾ï¼š</p><ol><li><p>MySQLå…ˆæ‰«æç£ç›˜ä¸Šçš„Row Logæ–‡ä»¶ï¼Œéå†æ–‡ä»¶ä¸­çš„Blockï¼Œå¦‚ä¸Šå›¾ï¼Œæ–‡ä»¶æ‰«æéƒ¨åˆ†ä¸ºä¸€ä¸ªBlockçš„éå†ï¼š</p><p>(1) headæŒ‡é’ˆæŒ‡å‘Blockçš„å¤´éƒ¨Logï¼Œä»è¯¥Logå¼€å§‹ï¼Œå°†å¤´éƒ¨Logå†™å…¥ç´¢å¼•æ ‘ã€‚å¦‚ä¸Šå›¾ï¼Œæ–‡ä»¶æ‰«æä¸­çš„æœ€ä¸Šé¢éƒ¨åˆ†ï¼Œå°†DMLæ—¥å¿—<code>0x61 + 3355 + &lt;25, 1998-01-02, 1&gt;&gt;</code>ä¸­çš„è®°å½•å†™å…¥ç´¢å¼•æ ‘<code>index_age_birth</code>çš„ç¬¬ä¸€ä¸ªå¶å­èŠ‚ç‚¹ã€‚</p><p>(2) å¤´éƒ¨Logæ¸…ç©ºï¼Œå°†headæŒ‡é’ˆç§»åˆ°åé¢ä¸€ä¸ªLogã€‚å¦‚ä¸Šå›¾ï¼Œæ–‡ä»¶æ‰«æä¸­çš„ç¬¬äºŒå—é•¿æ–¹æ¡†ã€‚</p><p>(3) é‡å¤(1)å’Œ(2)ä¸¤æ­¥ï¼Œç›´åˆ°headæŒ‡é’ˆç§»åˆ°Blockä¸­æœ€åä¸€ä¸ªLogï¼Œç„¶åï¼Œå°†è¯¥Logä¸­çš„è®°å½•å†™å…¥ç´¢å¼•æ ‘<code>index_age_birth</code>ã€‚å¦‚ä¸Šå›¾ï¼Œæ–‡ä»¶æ‰«æä¸­çš„ç¬¬ä¸‰ä¸ªé•¿æ–¹æ¡†åŠæ–¹æ¡†ä¸­æœ€åä¸€ä¸ªLogä¸­çš„è®°å½•å†™å…¥ç´¢å¼•æ ‘<code>index_age_birth</code>çš„ç¬¬äºŒä¸ªå¶å­èŠ‚ç‚¹ã€‚ã€‚</p></li><li><p>é‡å¤æ­¥éª¤1ï¼Œå°†Row Logæ–‡ä»¶ä¸­æ‰€æœ‰Blockå†…çš„Logå…¨éƒ¨å†™å…¥ç´¢å¼•æ ‘<code>index_age_birth</code>ï¼Œè‡³æ­¤ï¼ŒRow Logæ–‡ä»¶æ¸…ç©ºã€‚å¦‚ä¸Šå›¾ï¼Œæ–‡ä»¶æ‰«æä¸­æœ€åä¸€ä¸ªè™šçº¿é•¿æ–¹æ¡†ï¼Œè¡¨ç¤ºRow Logæ–‡ä»¶æ¸…ç©ºã€‚</p></li><li><p>ç”±äºDMLæ—¥å¿—å†™Row Logå’ŒDDLåŒæ—¶è¿›è¡Œï¼Œç»“åˆã€ŠRow Logè¿½åŠ ã€‹ä¸­çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬ä¼šå‘ç°å¤§éƒ¨åˆ†Blockå†™å…¥äº†Row Logæ–‡ä»¶ï¼Œä½†æ˜¯ï¼Œè¿˜ä¼šå­˜åœ¨å°éƒ¨åˆ†DMLæ—¥å¿—ç•™å­˜åœ¨å†…å­˜çš„Blockä¸­ï¼Œæ‰€ä»¥ï¼ŒMySQLéœ€è¦å°†è¿™éƒ¨åˆ†ç•™å­˜çš„Logå†å†™å…¥ç´¢å¼•æ ‘ä¸­ï¼Œå…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p>(1) å¯¹æ•°æ®å­—å…¸åŠ æ’å®ƒé”ï¼Œç¦æ­¢æ–°çš„DMLæ“ä½œï¼Œ<strong>psï¼šå¦‚æœä¸åŠ é”ï¼Œä¼šå¯¼è‡´å†…å­˜ä¸­Blockä¸æ–­æ›´æ–°ï¼Œæ— æ³•åˆ¤æ–­DMLæ“ä½œä½•æ—¶ç»“æŸ</strong>ã€‚</p><p>(2) æ‰§è¡Œæ­¥éª¤1ï¼Œå°†å†…å­˜Blockä¸­çš„Logå…¨éƒ¨å†™å…¥ç´¢å¼•æ ‘<code>index_age_birth</code>ï¼Œå¦‚ä¸Šå›¾ï¼Œå†…å­˜æ‰«æéƒ¨åˆ†ã€‚</p></li></ol><h4 id="Bulk-Load"><a href="#Bulk-Load" class="headerlink" title="Bulk Load"></a>Bulk Load</h4><p>åœ¨è®²è§£æ·»åŠ ç´¢å¼•çš„è¿‡ç¨‹ä¹‹å‰ï¼Œè¿˜æœ‰ä¸€ä¸ªæ¦‚å¿µå†è®²è§£ä¸€ä¸‹ï¼Œè¿™å°±æ˜¯<code>Bulk Load</code>ï¼Œåœ¨æ·»åŠ ç´¢å¼•çš„è¿‡ç¨‹ä¸­ï¼Œä¼šå°†å·²æ’åºçš„è®°å½•æ‰¹é‡æ’å…¥ç´¢å¼•æ ‘çš„å¶å­èŠ‚ç‚¹ä¸­ï¼Œè¿™ä¸ªæ‰¹é‡æ’å…¥çš„è¿‡ç¨‹å°±å«åš<code>Bulk Load</code>ï¼Œæˆ‘ä»¥ç´¢å¼•<code>index_age_birth</code>ä¸ºä¾‹ï¼Œè®²è§£ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ï¼Œè§ä¸‹å›¾ï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/f91e90d283084d53bd4d815f705c3048~tplv-k3u1fbpfcp-watermark.image" alt="image-20210102173655135.png"></p><ol><li>ä»å·²æ’åºçš„è®°å½•é›†ä¸­åˆ†å¤šæ‰¹å†™å…¥å†…å­˜çš„bulkä¸­ã€‚å¦‚ä¸Šå›¾ï¼ŒMySQLå°†æœ€å·¦è¾¹å·²æ’åºçš„è®°å½•é›†æ‹†åˆ†æˆä¸¤æ‰¹å†™å…¥2ä¸ªbulkä¸­ï¼Œä¸Šé¢çš„bulkåŒ…å«<code>15, 2008-02-03, 2</code>å’Œ<code>15, 2008-02-06, 5</code>ä¸¤æ¡è®°å½•ï¼Œä¸‹é¢çš„bulkåŒ…å«<code>16, 2007-06-06, 6</code>ã€<code>17, 2006-03-03, 4</code>å’Œ<code>18, 2002-06-07, 3</code> ä¸‰æ¡è®°å½•ã€‚</li><li>ä»¥bulkä¸ºå•ä½ï¼Œå°†bulkä¸­çš„è®°å½•é›†ä¸€æ¬¡æ’å…¥ç´¢å¼•æ ‘ä¸­ã€‚å¦‚ä¸Šå›¾ï¼Œä¸Šé¢çš„bulkè®°å½•é›†æ’å…¥åˆ°ç´¢å¼•æ ‘<code>index_age_birth</code>çš„ç¬¬ä¸‰ä¸ªå¶å­èŠ‚ç‚¹ï¼Œä¸‹é¢çš„bulkè®°å½•é›†æ’å…¥åˆ°ç´¢å¼•æ ‘<code>index_age_birth</code>çš„å€’æ•°ç¬¬äºŒä¸ªå¶å­èŠ‚ç‚¹ã€‚</li></ol><h4 id="æ·»åŠ ç´¢å¼•"><a href="#æ·»åŠ ç´¢å¼•" class="headerlink" title="æ·»åŠ ç´¢å¼•"></a>æ·»åŠ ç´¢å¼•</h4><p>Row Logçš„è¿½åŠ å’Œå›æ”¾ï¼Œä»¥åŠBulk Loadæ˜¯æ·»åŠ ç´¢å¼•è¿‡ç¨‹ä¸­çš„æ ¸å¿ƒæ­¥éª¤ï¼Œè®²å®Œè¿™ä¸‰ä¸ªæ­¥éª¤ï¼Œä¸‹é¢æˆ‘å†æ¥çœ‹ä¸€ä¸‹InnoDBå¼•æ“ä¸­MySQLæ·»åŠ ç´¢å¼•çš„è¿‡ç¨‹å°±æ¯”è¾ƒå®¹æ˜“ç†è§£äº†ï¼Œè¯¥è¿‡ç¨‹ä¸»è¦åˆ†ä¸‰ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¥userè¡¨ä¸ºä¾‹è¯¦ç»†è®²è§£ä¸€ä¸‹ï¼š</p><p><strong>Prepareé˜¶æ®µ</strong>ï¼š</p><ol><li>æ ¹æ®æ—§è¡¨userçš„è¡¨ç»“æ„æ–‡ä»¶frmï¼Œåˆ›å»ºä¸€ä¸ªå‰¯æœ¬è¡¨ç»“æ„frmæ–‡ä»¶ï¼Œå°†æ–°ç´¢å¼•æ·»åŠ åˆ°å‰¯æœ¬ä¸­</li><li>è·å¾—MDLæ’ä»–é”ï¼Œç¦æ­¢è¯»å†™æ•°æ®å­—å…¸åŠæ—§userè¡¨ï¼Œå…³äºMDLé”ï¼Œæˆ‘ä¼šåœ¨ã€ŠMySQLé”å…¨è§£æã€‹è¯¦ç»†è®²è§£</li><li>æ ¹æ®alterç±»å‹ï¼Œç¡®å®šæ‰§è¡Œæ–¹å¼ï¼Œä¸€å…±ä¸¤ç§æ‰§è¡Œæ–¹å¼ï¼šCOPYã€INPLACE</li><li>æ›´æ–°å†…å­˜ä¸­çš„æ•°æ®å­—å…¸ï¼Œæ ‡è®°userè¡¨æ‰€æœ‰ç´¢å¼•<code>online_status</code>ä¸º<code>ONLINE_INDEX_CREATION</code>ï¼Œè¡¨ç¤ºè¯¥è¡¨ç´¢å¼•éƒ½å¤„åœ¨åœ¨çº¿DDLçŠ¶æ€ã€‚å…³äºæ•°æ®å­—å…¸çš„ç»“æ„ï¼Œæˆ‘åœ¨ã€Šæˆ‘ä»¬å¯ä»¥å¹²é¢„MySQLé€‰æ‹©æ­£ç¡®çš„æ‰§è¡Œè®¡åˆ’å—ï¼Ÿã€‹ä¸­æœ‰è®²è§£è¿‡ã€‚</li><li>æ ¹æ®æ—§è¡¨userçš„ibdæ–‡ä»¶ï¼Œåˆ›å»ºå‰¯æœ¬ibdæ–‡ä»¶</li></ol><p><strong>DDLæ‰§è¡Œé˜¶æ®µï¼š</strong></p><ol><li><p>é™çº§MDLé”ä¸ºå…±äº«é”ï¼Œå…è®¸è¯»å†™æ•°æ®å­—å…¸åŠæ—§userè¡¨</p></li><li><p>æ‰«ææ—§è¡¨userçš„èšé›†ç´¢å¼•ä¸­å¶å­èŠ‚ç‚¹æ¯ä¸€æ¡è®°å½•</p><p>(1) ç”³è¯·ä¸€ä¸ª<code>sort_buffer</code>ï¼Œå¤§å°ä¸º<code>innodb_sort_buffer_size/ç´¢å¼•å¶å­èŠ‚ç‚¹ä¸­æœ€å°çš„è®°å½•çš„å¤§å°</code></p><p>(2) å°†æ¯ä¸€æ¡è®°å½•å†™å…¥<code>sort_buffer</code></p><p>(3) <code>sort_buffer</code>å†™æ»¡åå¯¹é‡Œé¢çš„è®°å½•è¿›è¡Œå‡åºæ’åº</p><p>(4) <code>sort_buffer</code>å†™æ»¡äº†ï¼Œå¦‚æœä¸´æ—¶æ–‡ä»¶ä¸å­˜åœ¨ï¼Œå°±åˆ›å»ºä¸€ä¸ªä¸´æ—¶æ–‡ä»¶</p><p>(5) éå†<code>sort_buffer</code>è®°å½•ï¼Œå°†<code>sort_buffer</code>ä¸­çš„è®°å½•å†™å…¥æ–‡ä»¶ä¸­</p><p>â€‹     a. ç”Ÿæˆä¸€ä¸ªblockï¼Œå°†è®°å½•æ·»åŠ åˆ°block</p><p>(6) å°†blockå†™å…¥ä¸´æ—¶æ–‡ä»¶</p></li><li><p>éå†æ—§è¡¨èšç°‡ç´¢å¼•çš„è®°å½•å®Œæˆåï¼Œä¸´æ—¶æ–‡ä»¶ä¸­å°±åŒ…å«å¤šä¸ªblockï¼Œæ¯ä¸ªblockåŒ…å«å·²æ’åºçš„è®°å½•</p></li><li><p>ä½¿ç”¨å½’å¹¶æ’åºå¯¹ä¸´æ—¶æ–‡ä»¶ä¸­çš„blockå†…è®°å½•è¿›è¡Œæ’åº</p></li><li><p>éå†å‰¯æœ¬frmä¸­çš„èšé›†ç´¢å¼•å’Œè¾…åŠ©ç´¢å¼•</p><p>(1) æœç´¢ç´¢å¼•æ ‘ï¼Œå®šä½åˆ°æ ‘ç§æœ€å³è¾¹çš„å¶å­èŠ‚ç‚¹</p><p>(2) åˆ¤æ–­è¯¥èŠ‚ç‚¹æ˜¯å¦å¯ä»¥æœ‰è¶³å¤Ÿç©ºé—´æ‰¹é‡æ’å…¥è®°å½•ï¼Œå¦‚æœæ²¡æœ‰å°±åˆ›å»ºä¸€ä¸ªæ–°çš„å¶å­èŠ‚ç‚¹ï¼Œæ‰§è¡Œæ­¥éª¤(3)ï¼Œå¦åˆ™ï¼Œæ‰§è¡Œæ­¥éª¤(4)</p><p>(3) å°†æ–°èŠ‚ç‚¹æ¥åˆ°ç´¢å¼•æ ‘çš„å³ä¸‹è§’ï¼Œæ‰§è¡Œæ­¥éª¤(4)</p><p>(4) éå†ä¸´æ—¶æ–‡ä»¶ä¸­çš„è®°å½•ï¼Œå°†è®°å½•é€šè¿‡bulk loadæ–¹å¼å†™å…¥å¶å­èŠ‚ç‚¹</p><p>(5) è°ƒæ•´æ’å…¥è®°å½•çš„å¶å­èŠ‚ç‚¹å†…è®°å½•çš„slotä¿¡æ¯ï¼Œå…³äºslotï¼Œæˆ‘åœ¨ã€ŠInnoDBæ˜¯é¡ºåºæŸ¥æ‰¾B-Treeå¶å­èŠ‚ç‚¹çš„å—ï¼Ÿã€‹ä¸­è¯¦ç»†è®²è§£è¿‡ã€‚</p></li><li><p>åœ¨è¿™ä¸ªé˜¶æ®µï¼Œä¸æ­¤åŒæ—¶ï¼Œuserè¡¨çš„æ‰€æœ‰DMLæ“ä½œæ—¥å¿—å†™å…¥Row Logï¼Œå³ã€ŠRow Logè¿½åŠ ã€‹ä¸­è®²è§£çš„è¿‡ç¨‹</p></li><li><p>é‡æ”¾è¯¥é˜¶æ®µäº§ç”Ÿçš„userè¡¨çš„Row Logæ—¥å¿—åˆ°ç´¢å¼•ä¸­ï¼Œç›´åˆ°Row Logä¸­çš„æœ€åä¸€ä¸ªblockï¼Œå³ã€ŠRow Logå›æ”¾ã€‹ä¸­è®²è§£çš„è¿‡ç¨‹ã€‚</p></li></ol><p><strong>Commité˜¶æ®µ</strong>ï¼š</p><ol><li>å‡çº§MDLé”ä¸ºæ’å®ƒé”ï¼Œç¦æ­¢è¯»å†™æ•°æ®å­—å…¸åŠæ—§userè¡¨</li><li>å°†Row Logä¸­æœ€åä¸€ä¸ªblockï¼Œå³å†…å­˜ä¸­Blockå¯¹åº”çš„DMLæ—¥å¿—æ’å…¥ç´¢å¼•æ ‘ï¼Œè¿‡ç¨‹å‚è§<strong>DDLæ‰§è¡Œé˜¶æ®µ</strong>ä¸­çš„æ­¥éª¤(7)</li><li>æ›´æ–°å†…å­˜ä¸­çš„æ•°æ®å­—å…¸ï¼Œå…³äºæ•°æ®å­—å…¸çš„ç»“æ„ï¼Œæˆ‘åœ¨ã€Šæˆ‘ä»¬å¯ä»¥å¹²é¢„MySQLé€‰æ‹©æ­£ç¡®çš„æ‰§è¡Œè®¡åˆ’å—ï¼Ÿã€‹ä¸­æœ‰è®²è§£è¿‡ã€‚</li><li>å°†DDLæ‰§è¡Œæ“ä½œè®°å½•redoæ—¥å¿—</li><li>renameå‰¯æœ¬ibdæ–‡ä»¶å’Œfrmæ–‡ä»¶ä¸ºæ—§è¡¨åï¼Œå³åŸuserè¡¨çš„frmå’Œibdæ–‡ä»¶å</li></ol><p>åœ¨è®²è§£å®Œæ·»åŠ ç´¢å¼•çš„è¿‡ç¨‹åï¼Œæˆ‘ä»¬å‘ç°å½±å“ä¸šåŠ¡DMLæ“ä½œçš„ç¯èŠ‚åŒ…å«ï¼š</p><ol><li>å¾ªç¯éå†æ—§è¡¨èšç°‡ç´¢å¼•å¶å­èŠ‚ç‚¹çš„æ‰€æœ‰è®°å½•ï¼Œå¦‚æœè¡¨è®°å½•éå¸¸å¤šï¼Œéå¸¸æ¶ˆè€—CPUï¼Œå¦‚æœDDLé•¿æ—¶é—´å ç”¨CPUèµ„æºï¼ŒåŠ¿å¿…ä¼šå½±å“MySQLçš„è¿æ¥æ•°ï¼Œå¯¼è‡´MySQLå¤„ç†DMLæ“ä½œçš„å¹¶å‘è¯·æ±‚æ•°ä¸‹é™</li><li>å½’å¹¶æ’åºä½¿ç”¨çš„ç£ç›˜ä¸´æ—¶æ–‡ä»¶åšè®°å½•æ’åºï¼Œå¦‚æœæ–‡ä»¶ä¸­çš„å·²æ’åºè®°å½•é›†éå¸¸å¤šï¼Œé‚£ä¹ˆï¼Œå½’å¹¶æ’åºè¿‡ç¨‹ä¸­äº§ç”Ÿå¤§é‡çš„ç£ç›˜IOï¼Œåœ¨MySQLå¤„ç†æŸ¥è¯¢æ—¶ï¼Œå¦‚æœå†…å­˜ä¸­æ²¡æœ‰æŸ¥è¯¢çš„ç»“æœï¼Œæ­¤æ—¶ï¼Œ<code>buffer pool</code>åˆæ»¡äº†ï¼Œè§¦å‘åˆ·è„è¡Œä¸ºï¼Œè¿™æ—¶å°±ä¼šå‡ºç°æŸ¥è¯¢è¯·æ±‚ç­‰å¾…åˆ·è„ç»“æŸï¼ŒæŸ¥è¯¢å“åº”å˜æ…¢ã€‚</li></ol><p>å¯èƒ½è¿™æ—¶å€™ä½ ä¼šé—®ï¼ŒPrepareé˜¶æ®µå’ŒCommité˜¶æ®µéƒ½åŠ äº†æ’å®ƒé”ï¼Œä¸ºä»€ä¹ˆè¿™ä¸¤ä¸ªç¯èŠ‚ä¸å½±å“DMLæ“ä½œå‘¢ï¼Ÿå› ä¸ºè™½ç„¶è¿™ä¸¤ä¸ªé˜¶æ®µéƒ½åŠ äº†æ’å®ƒé”ï¼Œä½†æ˜¯ï¼ŒåŠ é”åçš„æ“ä½œéƒ½æ˜¯å°æ•°æ®è§„æ¨¡çš„æ“ä½œï¼Œæ‰€ä»¥ï¼ŒåŠ é”æ—¶é—´å¾ˆçŸ­ï¼Œå¯¹DMLçš„å½±å“ä¸å¤§ï¼Œæ‰€ä»¥ï¼Œå¯ä»¥å¿½ç•¥ä¸è®¡ã€‚</p><blockquote><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬çœ‹çœ‹ä¸Šé¢ä¸¤ä¸ªé—®é¢˜æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ</p><p>é’ˆå¯¹ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œç”±äºè¡¨ä¸­çš„åŸæœ‰è®°å½•çš„æ•°é‡æ˜¯ç”±ä¸šåŠ¡å‘å±•å†³å®šçš„ï¼Œä¸šåŠ¡å‘å±•å¿«ï¼Œè®°å½•æ•°å°±ä¼šå¤šï¼Œè¿™ç‚¹æˆ‘ä»¬æ— æ³•æ§åˆ¶ï¼Œæ‰€ä»¥ï¼Œé’ˆå¯¹è¡¨æ•°æ®é‡å¤§å¯¼è‡´æ‰«æèšç°‡ç´¢å¼•å˜æ…¢ï¼Œæˆ‘ä»¬åªèƒ½è§„é¿DDLå¸¦æ¥çš„é£é™©ï¼Œè§„é¿æ–¹æ³•å¦‚ä¸‹ï¼š</p><ol><li>è¯„ä¼°è¡¨ä¸­çš„æ•°æ®é‡</li><li>è§‚å¯ŸMySQLçš„CPUä½¿ç”¨ç‡</li></ol><p>ç»“åˆä¸Šé¢ä¸¤ä¸ªå› ç´ ï¼Œå¦‚æœæ•°æ®é‡ä¸å¤§ï¼Œé‚£ä¹ˆï¼Œåªè¦åœ¨éæç«¯é«˜å³°æœŸæ‰§è¡ŒDDLï¼Œå¯¹DMLçš„ å½±å“æ˜¯ä¸å¤§çš„ã€‚å¦‚æœæ•°æ®é‡å¾ˆå¤§ï¼Œå»ºè®®æ‰¾åˆ°MySQLçš„CPUä½¿ç”¨ç‡æ¯”è¾ƒä½çš„æƒ…å†µä¸‹åšDDLï¼Œä¿è¯ä¸å½±å“DMLæ“ä½œ.ã€‚</p><p>é’ˆå¯¹ç¬¬äºŒä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒæ•´å‚æ•°<code>innodb_sort_buffer_size</code>ï¼Œå°†å…¶è°ƒå¤§ï¼Œä½¿å½’å¹¶æ’åºæ¥æºçš„ä¸´æ—¶æ–‡ä»¶ä¸­å·²æ’åºçš„blockæ•°é‡å°½å¯èƒ½å°‘ï¼Œå‡å°‘å¤§é‡blockçš„åˆå¹¶ï¼Œä»è€Œé™ä½ç£ç›˜IO</p></blockquote><h4 id="ä¸»ä»æ¨¡å¼ä¸‹çš„é—®é¢˜"><a href="#ä¸»ä»æ¨¡å¼ä¸‹çš„é—®é¢˜" class="headerlink" title="ä¸»ä»æ¨¡å¼ä¸‹çš„é—®é¢˜"></a>ä¸»ä»æ¨¡å¼ä¸‹çš„é—®é¢˜</h4><p>å¹³æ—¶æˆ‘ä»¬ç”¨çš„æœ€å¤šçš„MySQLæ¶æ„å°±æ˜¯ä¸»ä»æ¨¡å¼ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œåœ¨çº¿DDLçš„è¿‡ç¨‹æ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿ</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/3403ff7b515b482c8eac458b6127353d~tplv-k3u1fbpfcp-watermark.image" alt="image-20210102165130582.png"></p><ol><li>ç»“åˆã€Šæ·»åŠ ç´¢å¼•ã€‹ä¸­çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬çŸ¥é“DDLå’ŒDMLå¹¶è¡Œé˜¶æ®µï¼ŒDDLä¸€è¾¹æ‰§è¡Œï¼ŒDMLä¸€è¾¹å†™å…¥Row Logã€‚å¦‚ä¸Šå›¾ï¼Œå·¦è¾¹åœ¨masterä¸­ï¼ŒDDLå’ŒINSERTï¼Œä»¥åŠUPDATEå¹¶è¡Œæ‰§è¡Œï¼ŒDDLåœ¨æ‰§è¡Œçš„åŒæ—¶ï¼ŒINSERTå’ŒUPDATEå¹¶è¡Œå†™å…¥Row Log</li><li>DDLå’ŒDMLå¹¶è¡Œè¿‡ç¨‹ä¸­ï¼Œå°†DDLæ“ä½œå’Œå¹¶è¡Œçš„DMLæŒ‰åºå†™å…¥binlogã€‚å¦‚ä¸Šå›¾ï¼Œå·¦è¾¹masterå°†DDLå’ŒINSERTã€UPDATEæ“ä½œæŒ‰åºå†™å…¥binlogï¼ŒDDLç¬¬ä¸€ã€å…¶æ¬¡æ˜¯INSERTï¼Œæœ€åæ˜¯UPDATE</li><li>DDLæ‰§è¡Œç»“æŸï¼Œå°†masterçš„binlogåŒæ­¥åˆ°slaveä¸Šã€‚å¦‚ä¸Šå›¾ï¼Œå°†å·¦è¾¹masterçš„binlogä¸­çš„ä¸‰æ¡æ“ä½œåŒæ­¥åˆ°slaveä¸Š</li><li>åœ¨slaveä¸Šä¾æ¬¡å›æ”¾DDLå’ŒDMLã€‚å¦‚ä¸Šå›¾ï¼Œå³è¾¹åœ¨slaveä¸­ä¾æ¬¡æ‰§è¡ŒDDLã€INSERTå’ŒUPDATE</li></ol><p>é€šè¿‡ä¸Šé¢è¿™ä¸ªè¿‡ç¨‹ï¼Œä½ åº”è¯¥å·²ç»æƒ³åˆ°ï¼Œåœ¨DDLå’ŒDMLå¹¶è¡Œçš„é˜¶æ®µï¼Œå¦‚æœäº§ç”Ÿå¤§é‡çš„DMLæ“ä½œï¼Œé‚£ä¹ˆï¼Œåœ¨slaveç«¯å›æ”¾è¿™äº›DMLæ“ä½œä¼šè€—è´¹å¤§é‡çš„æ—¶é—´ï¼Œä¼šå½±å“ä»åº“è¯»çš„æ•°æ®ä¸€è‡´æ€§ã€‚æ‰€ä»¥ï¼Œè¿™å°±æ˜¯ä¸»ä»æ¨¡å¼ä¸‹ï¼Œåœ¨çº¿DDLçš„é—®é¢˜å’Œé£é™©ã€‚</p><h4 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><p>é€šè¿‡æœ¬ç« çš„è®²è§£ï¼Œæˆ‘æƒ³ä½ åº”è¯¥å¯¹MySQLçš„åœ¨çº¿DDLçš„æœºåˆ¶æœ‰äº†æ¸…æ™°çš„è®¤è¯†ï¼ŒåŒæ—¶ï¼Œé€šè¿‡åœ¨çº¿DDLæœºåˆ¶çš„è®²è§£ï¼Œæˆ‘ä»¬ä¹Ÿå‘ç°äº†ä¸€äº›ä¼˜åŒ–çš„æ–¹æ³•ï¼š</p><table><thead><tr><th>ç›®çš„</th><th>è§£å†³æ–¹æ³•</th></tr></thead><tbody><tr><td>å‡å°‘ä¸šåŠ¡å½±å“</td><td>è°ƒå¤§<code>innodb_sort_buffer_size</code>ï¼Œé™ä½ç£ç›˜IO</td></tr><tr><td>é¿å…DDLè¿‡ç¨‹ä¸­å†™Row Logæº¢å‡º</td><td>è°ƒå¤§<code>innodb_online_alter_log_max_size</code></td></tr><tr><td>ä¸€å®šè¦åœ¨é«˜å³°æœŸåšDDL</td><td>å»ºè®®ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·ï¼Œæ¯”å¦‚ï¼Œgh-ostï¼Œå®ƒæ˜¯é€šè¿‡binlogå®ŒæˆDDLçš„ï¼Œé¿å…äº†æ‰«æèšç°‡ç´¢å¼•å¸¦æ¥çš„CPUå¼€é”€</td></tr></tbody></table>]]></content>
    
    
    
    <tags>
      
      <tag>mysql</tag>
      
      <tag>ç´¢å¼•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java è®¾è®¡æ¨¡å¼ä¹‹å•ä¾‹æ¨¡å¼</title>
    <link href="/blog/2021/05/05/Java%20%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/"/>
    <url>/blog/2021/05/05/Java%20%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/61076ca4e6e542f78055b8e1db68effc~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><blockquote><p>å®šä¹‰ï¼šæŒ‡ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œä¸”è¯¥ç±»èƒ½è‡ªè¡Œåˆ›å»ºè¿™ä¸ªå®ä¾‹çš„ä¸€ç§æ¨¡å¼ã€‚</p></blockquote><h2 id="1-ç‰¹ç‚¹"><a href="#1-ç‰¹ç‚¹" class="headerlink" title="1. ç‰¹ç‚¹"></a>1. ç‰¹ç‚¹</h2><p>å•ä¾‹æ¨¡å¼æœ‰ 3 ä¸ªç‰¹ç‚¹ï¼š</p><ol><li>å•ä¾‹ç±»åªæœ‰ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼›</li><li>è¯¥å•ä¾‹å¯¹è±¡å¿…é¡»ç”±å•ä¾‹ç±»è‡ªè¡Œåˆ›å»ºï¼›</li><li>å•ä¾‹ç±»å¯¹å¤–æä¾›ä¸€ä¸ªè®¿é—®è¯¥å•ä¾‹çš„å…¨å±€è®¿é—®ç‚¹ã€‚</li></ol><p>ä¸€èˆ¬æ¥è¯´ï¼Œç³»ç»Ÿä¸­åªéœ€è¦æœ‰ä¸€ä¸ªå®ä¾‹å°±èƒ½æ»¡è¶³ç³»ç»Ÿéœ€è¦æ—¶ï¼Œé‚£ä¹ˆå°±å¯ä»¥è®¾è®¡æˆå•ä¾‹æ¨¡å¼ã€‚</p><p>æ¯”å¦‚ Windows çš„å›æ”¶ç«™ï¼Œæ•°æ®åº“çš„è¿æ¥æ± ï¼Œç³»ç»Ÿä¸­çš„æ—¥å¿—å¯¹è±¡ç­‰ç­‰ã€‚ï¼ˆå½“ç„¶ï¼Œå¦‚æœä½ éè¦è®¾è®¡æˆå¤šä¸ªï¼Œæˆ‘ä¹Ÿæ²¡æœ‰åŠæ³•æ˜¯ä¸æ˜¯ï¼‰</p><h2 id="2-ä¼˜ç‚¹å’Œç¼ºç‚¹"><a href="#2-ä¼˜ç‚¹å’Œç¼ºç‚¹" class="headerlink" title="2. ä¼˜ç‚¹å’Œç¼ºç‚¹"></a>2. ä¼˜ç‚¹å’Œç¼ºç‚¹</h2><p>å•ä¾‹æ¨¡å¼çš„ä¼˜ç‚¹ï¼š</p><ol><li>å•ä¾‹æ¨¡å¼å¯ä»¥ä¿è¯å†…å­˜é‡Œåªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå‡å°‘äº†å†…å­˜çš„å¼€é”€ã€‚</li><li>å¯ä»¥é¿å…å¯¹èµ„æºçš„å¤šé‡å ç”¨ã€‚</li><li>å•ä¾‹æ¨¡å¼è®¾ç½®å…¨å±€è®¿é—®ç‚¹ï¼Œå¯ä»¥ä¼˜åŒ–å’Œå…±äº«èµ„æºçš„è®¿é—®ã€‚</li></ol><p>å•ä¾‹æ¨¡å¼çš„ç¼ºç‚¹ï¼š</p><ol><li>å•ä¾‹æ¨¡å¼ä¸€èˆ¬æ²¡æœ‰æ¥å£ï¼Œæ‰©å±•å›°éš¾ã€‚å¦‚æœè¦æ‰©å±•ï¼Œåˆ™é™¤äº†ä¿®æ”¹åŸæ¥çš„ä»£ç ï¼Œæ²¡æœ‰ç¬¬äºŒç§é€”å¾„ï¼Œè¿èƒŒå¼€é—­åŸåˆ™ã€‚</li><li>åœ¨å¹¶å‘æµ‹è¯•ä¸­ï¼Œå•ä¾‹æ¨¡å¼ä¸åˆ©äºä»£ç è°ƒè¯•ã€‚åœ¨è°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå•ä¾‹ä¸­çš„ä»£ç æ²¡æœ‰æ‰§è¡Œå®Œï¼Œä¹Ÿä¸èƒ½æ¨¡æ‹Ÿç”Ÿæˆä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚</li><li>å•ä¾‹æ¨¡å¼çš„åŠŸèƒ½ä»£ç é€šå¸¸å†™åœ¨ä¸€ä¸ªç±»ä¸­ï¼Œå¦‚æœåŠŸèƒ½è®¾è®¡ä¸åˆç†ï¼Œåˆ™å¾ˆå®¹æ˜“è¿èƒŒå•ä¸€èŒè´£åŸåˆ™ã€‚</li></ol><h2 id="3-ç»“æ„"><a href="#3-ç»“æ„" class="headerlink" title="3. ç»“æ„"></a>3. ç»“æ„</h2><p>å•ä¾‹æ¨¡å¼çš„ UML ç±»å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œéå¸¸ç®€å•ï¼Œåªæœ‰ä¸€ä¸ªç±»ã€‚</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/930e26b803944d9e8caffffb94e2e2f1~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>ä¸Šè¿°ç±»å›¾å¾ˆå¥½åœ°ä½“ç°äº†å•ä¾‹æ¨¡å¼çš„3ä¸ªç‰¹ç‚¹ã€‚</p><ol><li>ä¸€ä¸ªç§æœ‰å®ä¾‹å¸¸é‡ <code>INSTANCE</code>ï¼Œä¿è¯åªæœ‰ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼›</li><li>ä¸€ä¸ªç§æœ‰çš„æ„é€ å™¨ <code>private Singleton()&#123;&#125;</code> ä¿è¯å¤–éƒ¨æ— æ³•å®ä¾‹åŒ–ï¼Œåªèƒ½ç”±è‡ªèº«åˆ›å»ºï¼›</li><li>é€šè¿‡å…¬å…±çš„ <code>getInstance()</code> æ–¹æ³•æä¾›ä¸€ä¸ªè®¿é—®è¯¥å•ä¾‹çš„å…¨å±€è®¿é—®ç‚¹ã€‚</li></ol><h2 id="4-å®ç°"><a href="#4-å®ç°" class="headerlink" title="4. å®ç°"></a>4. å®ç°</h2><p>å•ä¾‹æ¨¡å¼å¯ä»¥æŒ‰ä¸åŒç»´åº¦å¯¹å…¶è¿›è¡Œåˆ†ç±»ï¼š</p><ul><li>çº¿ç¨‹å®‰å…¨ç»´åº¦ï¼šçº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼ã€çº¿ç¨‹ä¸å®‰å…¨çš„å•ä¾‹æ¨¡å¼</li><li>å¯¹è±¡åˆ›å»ºæ—¶æœºï¼šé¥¿æ±‰å¼çš„å•ä¾‹æ¨¡å¼ã€æ‡’æ±‰å¼çš„å•ä¾‹æ¨¡å¼<ul><li>é¥¿æ±‰å¼ - ç¬¬ä¸€æ¬¡è°ƒç”¨å‰ï¼ˆæˆ–è¯´ç±»è¢« JVM åŠ è½½æ—¶ï¼‰å°±å·²ç»è¢«å®ä¾‹åŒ–äº†ã€‚</li><li>æ‡’æ±‰å¼ - åªæœ‰åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨çš„æ—¶å€™æ‰ä¼šè¢«å®ä¾‹åŒ–ã€‚</li></ul></li></ul><h3 id="4-1-æšä¸¾ç±»å•ä¾‹"><a href="#4-1-æšä¸¾ç±»å•ä¾‹" class="headerlink" title="4.1 æšä¸¾ç±»å•ä¾‹"></a>4.1 æšä¸¾ç±»å•ä¾‹</h3><p>å› ä¸º Java ä¿è¯æšä¸¾ç±»çš„æ¯ä¸ªæšä¸¾éƒ½æ˜¯å•ä¾‹ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ç¼–å†™ä¸€ä¸ªåªæœ‰ä¸€ä¸ªæšä¸¾çš„ç±»å³å¯ï¼Œè€Œä¸”å®ƒæ˜¯<strong>çº¿ç¨‹å®‰å…¨</strong>çš„ã€‚</p><p>æšä¸¾ç±»ä¹Ÿå®Œå…¨å¯ä»¥åƒå…¶ä»–ç±»é‚£æ ·å®šä¹‰è‡ªå·±çš„å­—æ®µã€æ–¹æ³•ï¼Œå¦‚ä¸‹æ–¹å®ä¾‹ä»£ç ä¸­çš„ <code>name</code> å‚æ•°ï¼Œ<code>getName()</code> åŠ <code>setName()</code> æ–¹æ³•ç­‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.junmoyu.singleton;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æšä¸¾çš„å•ä¾‹å®ç° - çº¿ç¨‹å®‰å…¨</span><br><span class="hljs-comment"> * ç»å¯¹é˜²æ­¢å¤šå®ä¾‹åŒ–ï¼Œå³ä½¿æ˜¯åœ¨é¢ååºåˆ—åŒ–å’Œåå°„æ”»å‡»æ—¶</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">EnumSingleton</span> </span>&#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å”¯ä¸€å®ä¾‹</span><br><span class="hljs-comment">     */</span><br>    INSTANCE;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¦‚æœæ²¡æœ‰åˆå§‹åŒ–çš„å†…å®¹ï¼Œå¯åˆ é™¤æ­¤æ–¹æ³•</span><br><span class="hljs-comment">     */</span><br>    EnumSingleton() &#123;<br>        System.out.println(getClass().getCanonicalName() + <span class="hljs-string">&quot; è¢«å®ä¾‹åŒ–ï¼Œå†…å­˜åœ°å€ä¸ºï¼š&quot;</span> + hashCode());<br>        <span class="hljs-keyword">this</span>.name = <span class="hljs-string">&quot;è«è¯­&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> String name;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setName</span><span class="hljs-params">(String name)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.name = name;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p><code>Effective Java</code> ä¹¦ä¸­ä¹Ÿæ¨èä½¿ç”¨è¿™ç§å•ä¾‹æ¨¡å¼ã€‚å› ä¸ºå®ƒè¶³å¤Ÿç®€å•ï¼Œçº¿ç¨‹å®‰å…¨ï¼Œä¸”å¤©ç„¶å¯ä»¥é˜²æ­¢å¤šå®ä¾‹åŒ–ï¼Œå³ä½¿æ˜¯åœ¨é¢ååºåˆ—åŒ–å’Œåå°„æ”»å‡»æ—¶ã€‚</p></blockquote><p>å¦‚æœéœ€è¦åœ¨å•ä¾‹ä¸­åšåˆå§‹åŒ–æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨æ„é€ æ–¹æ³•å®ç°ï¼Œå¦åˆ™æ˜¯ä¸éœ€è¦æ„é€ æ–¹æ³•çš„ã€‚ä½¿ç”¨æ—¶å¯ä»¥ç›´æ¥ç”¨ <code>EnumSingleton.INSTANCE.getName()</code> æ¥è°ƒç”¨å•ä¾‹ä¸­çš„æ–¹æ³•ã€‚</p><p>åœ¨ç±»ä¸­æ·»åŠ ä¸€ä¸ª <code>main()</code> æ–¹æ³•æµ‹è¯•ä¸€ä¸‹çœ‹çœ‹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">EnumSingleton</span> </span>&#123;<br>    INSTANCE;<br><br>    <span class="hljs-comment">// ... çœç•¥å…¶ä»–ä»£ç </span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-comment">// å»¶è¿ŸåŠ è½½æµ‹è¯•</span><br>        System.out.println(<span class="hljs-string">&quot;æµ‹è¯•ä»£ç å¯åŠ¨&quot;</span>);<br>        Thread.sleep(<span class="hljs-number">1000</span>);<br><br>        <span class="hljs-comment">// æ–¹æ³•è°ƒç”¨æµ‹è¯•</span><br>        System.out.println(<span class="hljs-string">&quot;name: &quot;</span> + EnumSingleton.INSTANCE.getName());<br>        EnumSingleton.INSTANCE.setName(<span class="hljs-string">&quot;junmoyu.com&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;name: &quot;</span> + EnumSingleton.INSTANCE.getName());<br><br>        <span class="hljs-comment">// åå°„æµ‹è¯•</span><br>        <span class="hljs-comment">// æšä¸¾å¤©ç„¶é˜²æ­¢åå°„æ”»å‡»</span><br>        Class&lt;EnumSingleton&gt; clazz = (Class&lt;EnumSingleton&gt;) Class.forName(<span class="hljs-string">&quot;com.junmoyu.singleton.EnumSingleton&quot;</span>);<br>        Constructor&lt;EnumSingleton&gt; constructor = clazz.getDeclaredConstructor(<span class="hljs-keyword">null</span>);<br>        <span class="hljs-comment">// è¿™é‡Œå°†ç›´æ¥æŠ›å‡ºå¼‚å¸¸</span><br>        EnumSingleton singleton = constructor.newInstance();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿è¡Œåç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.junmoyu</span><span class="hljs-selector-class">.singleton</span><span class="hljs-selector-class">.EnumSingleton</span> è¢«å®ä¾‹åŒ–ï¼Œ<span class="hljs-selector-tag">hashCode</span>ï¼š460141958<br>ä»£ç å¯åŠ¨<br><span class="hljs-selector-tag">name</span>: è«è¯­<br><span class="hljs-selector-tag">name</span>: <span class="hljs-selector-tag">junmoyu</span><span class="hljs-selector-class">.com</span><br><span class="hljs-selector-tag">Exception</span> <span class="hljs-selector-tag">in</span> <span class="hljs-selector-tag">thread</span> &quot;<span class="hljs-selector-tag">main</span>&quot; <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.NoSuchMethodException</span>: <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.junmoyu</span><span class="hljs-selector-class">.singleton</span><span class="hljs-selector-class">.EnumSingleton</span>.&lt;<span class="hljs-selector-tag">init</span>&gt;()<br><span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.Class</span><span class="hljs-selector-class">.getConstructor0</span>(<span class="hljs-selector-tag">Class</span><span class="hljs-selector-class">.java</span><span class="hljs-selector-pseudo">:3082)</span><br><span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.Class</span><span class="hljs-selector-class">.getDeclaredConstructor</span>(<span class="hljs-selector-tag">Class</span><span class="hljs-selector-class">.java</span><span class="hljs-selector-pseudo">:2178)</span><br><span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.junmoyu</span><span class="hljs-selector-class">.singleton</span><span class="hljs-selector-class">.EnumSingleton</span><span class="hljs-selector-class">.main</span>(<span class="hljs-selector-tag">EnumSingleton</span><span class="hljs-selector-class">.java</span><span class="hljs-selector-pseudo">:51)</span><br></code></pre></td></tr></table></figure><p>ä»ç»“æœä¸­å¯ä»¥çœ‹å‡ºï¼Œæšä¸¾ç±»çš„å•ä¾‹æ¨¡å¼ä¸æ˜¯å»¶è¿ŸåŠ è½½çš„ï¼Œä¸”å¯ä»¥é˜²æ­¢åå°„åˆ›å»ºå¤šä¸ªå®ä¾‹ã€‚å…³äºåå°„çš„è¯é¢˜ä¼šåœ¨åé¢çš„ç« èŠ‚ä¸“é—¨è®²è§£ã€‚</p><h3 id="4-2-é¥¿æ±‰å¼å•ä¾‹"><a href="#4-2-é¥¿æ±‰å¼å•ä¾‹" class="headerlink" title="4.2 é¥¿æ±‰å¼å•ä¾‹"></a>4.2 é¥¿æ±‰å¼å•ä¾‹</h3><p>é¥¿æ±‰å¼å•ä¾‹ï¼Œå…¶åˆ›å»ºå¯¹è±¡çš„æ—¶æœºæ˜¯åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨ä¹‹å‰ï¼Œåœ¨ç±»è¢« JVM åŠ è½½æ—¶å°±ä¼šè¢«åˆ›å»ºã€‚å…¶ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.junmoyu.singleton;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼ - çº¿ç¨‹å®‰å…¨</span><br><span class="hljs-comment"> * è¯¥ç±»åœ¨ç¨‹åºåŠ è½½æ—¶å°±å·²ç»åˆå§‹åŒ–å®Œæˆäº†</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EagerlySingleton</span> </span>&#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆå§‹åŒ–é™æ€å®ä¾‹</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> EagerlySingleton INSTANCE = <span class="hljs-keyword">new</span> EagerlySingleton();<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç§æœ‰æ„é€ å‡½æ•°ï¼Œä¿è¯æ— æ³•ä»å¤–éƒ¨è¿›è¡Œå®ä¾‹åŒ–</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">EagerlySingleton</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(getClass().getCanonicalName() + <span class="hljs-string">&quot; è¢«å®ä¾‹åŒ–ï¼ŒhashCodeï¼š&quot;</span> + hashCode());<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¯è¢«ç”¨æˆ·è°ƒç”¨ä»¥è·å–ç±»çš„å®ä¾‹</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> EagerlySingleton <span class="hljs-title">getInstance</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> INSTANCE;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-comment">// å»¶è¿ŸåŠ è½½æµ‹è¯•</span><br>        System.out.println(<span class="hljs-string">&quot;æµ‹è¯•ä»£ç å¯åŠ¨&quot;</span>);<br>        Thread.sleep(<span class="hljs-number">1000</span>);<br><br>        <span class="hljs-comment">// å¤šçº¿ç¨‹æµ‹è¯•</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123;<br>            <span class="hljs-keyword">new</span> Thread(() -&gt; System.out.println(<span class="hljs-string">&quot;å¤šçº¿ç¨‹æµ‹è¯•ï¼šhashCodeï¼š&quot;</span> + <span class="hljs-string">&quot;@&quot;</span> + EagerlySingleton.getInstance().hashCode())).start();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>é¥¿æ±‰å¼å•ä¾‹</strong>æä¾›äº†å·²è¢«å®ä¾‹åŒ–çš„é™æ€å®ä¾‹ <code>INSTANCE</code>ï¼Œæ‰€ä»¥ä¸å­˜åœ¨å¤šä¸ªçº¿ç¨‹åˆ›å»ºå¤šä¸ªå®ä¾‹çš„æƒ…å†µï¼Œæ‰€ä»¥å®ƒæ˜¯<strong>çº¿ç¨‹å®‰å…¨</strong>çš„ã€‚</p><p>è¿™ç§å•ä¾‹æ¨¡å¼çš„ç¼ºç‚¹æ˜¯å³ä½¿å•ä¾‹æ²¡æœ‰è¢«ä½¿ç”¨ï¼Œå¯¹è±¡ä¹Ÿä¼šè¢«åˆ›å»ºï¼Œå ç”¨èµ„æºï¼ˆä½†å…¶å®å¹¶ä¸ä¼šå ç”¨å¤ªå¤šèµ„æºï¼Œè§†å…·ä½“ä¸šåŠ¡æƒ…å†µè€Œå®šï¼‰ã€‚è¿è¡Œ<code>main()</code>æ–¹æ³•æµ‹è¯•ä¸€ä¸‹ã€‚</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-keyword">com</span>.junmoyu.singleton.EagerlySingleton è¢«å®ä¾‹åŒ–ï¼ŒhashCodeï¼š<span class="hljs-number">460141958</span><br>æµ‹è¯•ä»£ç å¯åŠ¨<br>å¤šçº¿ç¨‹æµ‹è¯•ï¼šhashCodeï¼š<span class="hljs-subst">@460141958</span><br>å¤šçº¿ç¨‹æµ‹è¯•ï¼šhashCodeï¼š<span class="hljs-subst">@460141958</span><br>å¤šçº¿ç¨‹æµ‹è¯•ï¼šhashCodeï¼š<span class="hljs-subst">@460141958</span><br>å¤šçº¿ç¨‹æµ‹è¯•ï¼šhashCodeï¼š<span class="hljs-subst">@460141958</span><br>å¤šçº¿ç¨‹æµ‹è¯•ï¼šhashCodeï¼š<span class="hljs-subst">@460141958</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°<strong>é¥¿æ±‰å¼å•ä¾‹</strong>çš„ç¡®æ˜¯<strong>å»¶è¿ŸåŠ è½½</strong>çš„ï¼Œè€Œä¸”<strong>çº¿ç¨‹å®‰å…¨</strong>ã€‚å…¶å®çº¿ç¨‹å®‰å…¨é—®é¢˜æ¯”è¾ƒéš¾ä»¥æµ‹è¯•ï¼Œå› ä¸ºæ­¤ç±»çš„ç¡®æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥ä»…åšæ¼”ç¤ºï¼Œåé¢ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜çš„å•ä¾‹æ–¹å¼ä¼šç€é‡è¯´æ˜ã€‚åå°„çš„é—®é¢˜åé¢ä¹Ÿä¼šæœ‰ä¸“é—¨çš„ç« èŠ‚è¿›è¡Œè¯´æ˜ã€‚</p><h3 id="4-3-é™æ€å†…éƒ¨ç±»å•ä¾‹"><a href="#4-3-é™æ€å†…éƒ¨ç±»å•ä¾‹" class="headerlink" title="4.3 é™æ€å†…éƒ¨ç±»å•ä¾‹"></a>4.3 é™æ€å†…éƒ¨ç±»å•ä¾‹</h3><p>é™æ€å†…éƒ¨ç±»å®ç°çš„å•ä¾‹ä¸ä¸Šé¢çš„é¥¿æ±‰å¼å•ä¾‹æœ‰ç‚¹ç›¸ä¼¼ï¼Œè¿™ç§å•ä¾‹æ¨¡å¼ä¹Ÿæ˜¯ <strong>çº¿ç¨‹å®‰å…¨</strong>çš„ï¼Œä½†å®ƒå´æ˜¯å»¶è¿ŸåŠ è½½çš„ï¼Œæ‰€ä»¥å¯¹äºä¸€äº›éœ€è¦å»¶è¿ŸåŠ è½½çš„å•ä¾‹æ¥è¯´ï¼Œè¿™ç§æ–¹å¼æ˜¯ä¸€ç§éå¸¸ä¸é”™çš„é€‰æ‹©ã€‚å…¶ä»£ç å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.junmoyu.singleton;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * é™æ€å†…éƒ¨ç±» - çº¿ç¨‹å®‰å…¨ï¼Œå»¶è¿ŸåŠ è½½</span><br><span class="hljs-comment"> * å†™æ³•ç®€å•ï¼Œä¸”å¯å»¶è¿ŸåŠ è½½ï¼Œè¾ƒæ¨èæ­¤ç§å®ç°</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StaticInnerClassSingleton</span> </span>&#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä½¿ç”¨é™æ€å†…éƒ¨ç±»æ¥å®ç°å»¶è¿ŸåŠ è½½</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelperHolder</span> </span>&#123;<br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> StaticInnerClassSingleton INSTANCE = <span class="hljs-keyword">new</span> StaticInnerClassSingleton();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç§æœ‰æ„é€ æ–¹æ³•</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">StaticInnerClassSingleton</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(getClass().getCanonicalName() + <span class="hljs-string">&quot; è¢«å®ä¾‹åŒ–ï¼ŒhashCodeï¼š&quot;</span> + hashCode());<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·å–å•ä¾‹å®ä¾‹</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> StaticInnerClassSingleton <span class="hljs-title">getInstance</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> HelperHolder.INSTANCE;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-comment">// å»¶è¿ŸåŠ è½½æµ‹è¯•</span><br>        System.out.println(<span class="hljs-string">&quot;æµ‹è¯•ä»£ç å¯åŠ¨&quot;</span>);<br>        Thread.sleep(<span class="hljs-number">1000</span>);<br><br>        <span class="hljs-comment">// å¤šçº¿ç¨‹æµ‹è¯•</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123;<br>            <span class="hljs-keyword">new</span> Thread(() -&gt; System.out.println(<span class="hljs-string">&quot;å¤šçº¿ç¨‹æµ‹è¯•ï¼šhashCodeï¼š&quot;</span> + <span class="hljs-string">&quot;@&quot;</span> + StaticInnerClassSingleton.getInstance().hashCode())).start();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸é¥¿æ±‰å¼å•ä¾‹ä¸åŒçš„æ˜¯ï¼Œé™æ€å†…éƒ¨ç±»å•ä¾‹æ˜¯å»¶è¿ŸåŠ è½½çš„ï¼Œå¯¹äºä¸€äº›å ç”¨èµ„æºå¤šä¸”ä½¿ç”¨é¢‘ç‡ä¸é«˜çš„å•ä¾‹æ¥è¯´æ˜¯ä¸ªéå¸¸ä¸é”™çš„å®ç°ï¼Œè€Œä¸”å®ƒä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¦‚æœä½ çš„ä¸šåŠ¡éœ€è¦çº¿ç¨‹å®‰å…¨ä¸”å»¶è¿ŸåŠ è½½çš„å•ä¾‹æ¨¡å¼ï¼Œé‚£ä¹ˆé™æ€å†…éƒ¨ç±»æ˜¯ä¸ªéå¸¸ä¸é”™çš„é€‰æ‹©ã€‚åŒæ ·è¿è¡Œ <code>main()</code> è¿›è¡Œæµ‹è¯•ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs avrasm">æµ‹è¯•ä»£ç å¯åŠ¨<br><span class="hljs-keyword">com</span>.junmoyu.singleton.StaticInnerClassSingleton è¢«å®ä¾‹åŒ–ï¼ŒhashCodeï¼š<span class="hljs-number">1251394951</span><br>å¤šçº¿ç¨‹æµ‹è¯•ï¼šhashCodeï¼š<span class="hljs-subst">@1251394951</span><br>å¤šçº¿ç¨‹æµ‹è¯•ï¼šhashCodeï¼š<span class="hljs-subst">@1251394951</span><br>å¤šçº¿ç¨‹æµ‹è¯•ï¼šhashCodeï¼š<span class="hljs-subst">@1251394951</span><br>å¤šçº¿ç¨‹æµ‹è¯•ï¼šhashCodeï¼š<span class="hljs-subst">@1251394951</span><br>å¤šçº¿ç¨‹æµ‹è¯•ï¼šhashCodeï¼š<span class="hljs-subst">@1251394951</span><br></code></pre></td></tr></table></figure><p>é€šè¿‡æ—¥å¿—å¯ä»¥æ˜æ˜¾å‘ç°ï¼Œå½“ä¸»çº¿ç¨‹ <code>main()</code>å¯åŠ¨ä¹‹åï¼Œä¸”ç¡çœ ç­‰å¾…ä¸€åˆ†é’Ÿï¼Œåœ¨è°ƒç”¨äº† <code>StaticInnerClassSingleton.getInstance().hashCode()</code> æ–¹æ³•æ—¶è¯¥ç±»æ‰è¢«å®ä¾‹åŒ–ï¼Œä¸”åœ¨å¤šçº¿ç¨‹ä¸­ï¼Œä»…è¢«å®ä¾‹åŒ–äº†ä¸€æ¬¡ã€‚</p><h3 id="4-4-æ‡’æ±‰å¼å•ä¾‹-çº¿ç¨‹ä¸å®‰å…¨"><a href="#4-4-æ‡’æ±‰å¼å•ä¾‹-çº¿ç¨‹ä¸å®‰å…¨" class="headerlink" title="4.4 æ‡’æ±‰å¼å•ä¾‹ - çº¿ç¨‹ä¸å®‰å…¨"></a>4.4 æ‡’æ±‰å¼å•ä¾‹ - çº¿ç¨‹ä¸å®‰å…¨</h3><p>æ‡’æ±‰å¼çš„ç‰¹ç‚¹å°±æ˜¯<strong>å»¶è¿ŸåŠ è½½</strong>ï¼Œå³å¯¹è±¡ä¼šåœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶æ‰ä¼šè¢«å®ä¾‹åŒ–ï¼Œé¿å…èµ„æºæ¶ˆè€—ã€‚</p><p>å¦‚ä¸‹æ–¹ä»£ç æ‰€ç¤ºï¼Œè¿™æ˜¯æœ€ç®€å•çš„ä¸€ç§å†™æ³•ï¼Œä½†è¿™æ˜¯ <strong>çº¿ç¨‹ä¸å®‰å…¨</strong> çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.junmoyu.singleton;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ‡’æ±‰å¼ - çº¿ç¨‹ä¸å®‰å…¨</span><br><span class="hljs-comment"> * éå¸¸ä¸æ¨èä½¿ç”¨</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThreadUnsafeLazyLoadedSingleton</span> </span>&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ThreadUnsafeLazyLoadedSingleton INSTANCE = <span class="hljs-keyword">null</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç§æœ‰æ„é€ æ–¹æ³•</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">ThreadUnsafeLazyLoadedSingleton</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(getClass().getCanonicalName() + <span class="hljs-string">&quot; è¢«å®ä¾‹åŒ–ï¼ŒhashCodeï¼š&quot;</span> + hashCode());<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¯è¢«ç”¨æˆ·è°ƒç”¨ä»¥è·å–ç±»çš„å®ä¾‹ - çº¿ç¨‹ä¸å®‰å…¨</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ThreadUnsafeLazyLoadedSingleton <span class="hljs-title">getInstance</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (INSTANCE == <span class="hljs-keyword">null</span>) &#123;<br>            INSTANCE = <span class="hljs-keyword">new</span> ThreadUnsafeLazyLoadedSingleton();<br>        &#125;<br>        <span class="hljs-keyword">return</span> INSTANCE;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-comment">// å»¶è¿ŸåŠ è½½æµ‹è¯•</span><br>        System.out.println(<span class="hljs-string">&quot;æµ‹è¯•ä»£ç å¯åŠ¨&quot;</span>);<br>        Thread.sleep(<span class="hljs-number">1000</span>);<br><br>        <span class="hljs-comment">// å¤šçº¿ç¨‹æµ‹è¯•</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123;<br>            <span class="hljs-keyword">new</span> Thread(() -&gt; System.out.println(<span class="hljs-string">&quot;å¤šçº¿ç¨‹æµ‹è¯•ï¼šhashCodeï¼š&quot;</span> + <span class="hljs-string">&quot;@&quot;</span> + ThreadUnsafeLazyLoadedSingleton.getInstance().hashCode())).start();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç›´æ¥è¿è¡Œ <code>main()</code> æµ‹è¯•ä¸€ä¸‹ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs stylus">æµ‹è¯•ä»£ç å¯åŠ¨<br>com<span class="hljs-selector-class">.junmoyu</span><span class="hljs-selector-class">.singleton</span><span class="hljs-selector-class">.ThreadUnsafeLazyLoadedSingleton</span> è¢«å®ä¾‹åŒ–ï¼ŒhashCodeï¼š<span class="hljs-number">847507483</span><br>å¤šçº¿ç¨‹æµ‹è¯•ï¼šhashCodeï¼š@<span class="hljs-number">847507483</span><br>com<span class="hljs-selector-class">.junmoyu</span><span class="hljs-selector-class">.singleton</span><span class="hljs-selector-class">.ThreadUnsafeLazyLoadedSingleton</span> è¢«å®ä¾‹åŒ–ï¼ŒhashCodeï¼š<span class="hljs-number">319699154</span><br>å¤šçº¿ç¨‹æµ‹è¯•ï¼šhashCodeï¼š@<span class="hljs-number">319699154</span><br>com<span class="hljs-selector-class">.junmoyu</span><span class="hljs-selector-class">.singleton</span><span class="hljs-selector-class">.ThreadUnsafeLazyLoadedSingleton</span> è¢«å®ä¾‹åŒ–ï¼ŒhashCodeï¼š<span class="hljs-number">758108352</span><br>å¤šçº¿ç¨‹æµ‹è¯•ï¼šhashCodeï¼š@<span class="hljs-number">758108352</span><br>å¤šçº¿ç¨‹æµ‹è¯•ï¼šhashCodeï¼š@<span class="hljs-number">847507483</span><br>å¤šçº¿ç¨‹æµ‹è¯•ï¼šhashCodeï¼š@<span class="hljs-number">847507483</span><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>ä»ç»“æœå¯ä»¥æ˜æ˜¾çš„çœ‹åˆ°ï¼Œè¯¥ç±»è™½ç„¶æ˜¯å»¶è¿ŸåŠ è½½çš„ï¼Œä½†æ˜¯åœ¨å¤šçº¿ç¨‹ä¸­ï¼Œè¢«å®ä¾‹åŒ–å¤šæ¬¡ï¼Œè¿™æ˜¯çº¿ç¨‹ä¸å®‰å…¨ï¼Œéå¸¸ä¸æ¨èä½¿ç”¨ï¼</p><h3 id="4-5-æ‡’æ±‰å¼å•ä¾‹-çº¿ç¨‹å®‰å…¨"><a href="#4-5-æ‡’æ±‰å¼å•ä¾‹-çº¿ç¨‹å®‰å…¨" class="headerlink" title="4.5 æ‡’æ±‰å¼å•ä¾‹ - çº¿ç¨‹å®‰å…¨"></a>4.5 æ‡’æ±‰å¼å•ä¾‹ - çº¿ç¨‹å®‰å…¨</h3><p>æ—¢ç„¶ä¸Šä¸€ç§æ–¹å¼æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œé‚£ä¹ˆåŸºäºä¸Šé¢çš„å†™æ³•ï¼Œåšä¸€äº›ä¿®æ”¹ï¼Œè®©å®ƒçº¿ç¨‹å®‰å…¨ä¸å°±å¯ä»¥å˜›ã€‚æ¯”è¾ƒç®€å•çš„ä¸€ç§åšæ³•æ˜¯åœ¨<code>getInstance()</code>æ–¹æ³•ä¸ŠåŠ é”ï¼Œæ·»åŠ  <code>synchronized</code> å…³é”®å­—å³å¯ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.junmoyu.singleton;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ‡’æ±‰å¼ - çº¿ç¨‹å®‰å…¨ï¼Œå»¶è¿ŸåŠ è½½</span><br><span class="hljs-comment"> * ä½†å› ä¸º getInstance() æ–¹æ³•åŠ é”ï¼Œå¯¼è‡´å¤šçº¿ç¨‹ä¸‹æ€§èƒ½è¾ƒå·®ï¼Œä¸æ¨èä½¿ç”¨</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThreadSafeLazyLoadedSingleton</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ThreadSafeLazyLoadedSingleton INSTANCE = <span class="hljs-keyword">null</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç§æœ‰æ„é€ æ–¹æ³•</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">ThreadSafeLazyLoadedSingleton</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(getClass().getCanonicalName() + <span class="hljs-string">&quot; è¢«å®ä¾‹åŒ–ï¼ŒhashCodeï¼š&quot;</span> + hashCode());<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¯è¢«ç”¨æˆ·è°ƒç”¨ä»¥è·å–ç±»çš„å®ä¾‹ - çº¿ç¨‹å®‰å…¨</span><br><span class="hljs-comment">     * ä½¿ç”¨ synchronized åŠ é”ä»¥å®ç°çº¿ç¨‹å®‰å…¨</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> ThreadSafeLazyLoadedSingleton <span class="hljs-title">getInstance</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (INSTANCE == <span class="hljs-keyword">null</span>) &#123;<br>            INSTANCE = <span class="hljs-keyword">new</span> ThreadSafeLazyLoadedSingleton();<br>        &#125;<br>        <span class="hljs-keyword">return</span> INSTANCE;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡åŠ é”ï¼Œæ¯æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹å…è®¸è®¿é—® <code>getInstance()</code>ï¼Œå®ä¾‹åŒ–å¯¹è±¡ï¼Œå½“å®ä¾‹åŒ–å®Œæˆåï¼Œè¿™ä¸ªçº¿ç¨‹æ‰ä¼šè§£é”ï¼Œå…¶ä»–çº¿ç¨‹å°±æ²¡åŠæ³•åˆ›å»ºå®ä¾‹äº†ï¼Œä¹Ÿå°±å®ç°äº†çº¿ç¨‹å®‰å…¨ã€‚</p><p>ä½†æ˜¯è¿™ç§æ–¹å¼æœ‰ä¸€ä¸ªå¾ˆå¤§çš„ç¼ºç‚¹ï¼Œå°±æ˜¯æ¯æ¬¡ä½¿ç”¨æ—¶éƒ½ä¼šå› ä¸º<strong>é”</strong>è€Œéå¸¸æ¶ˆè€—æ€§èƒ½ï¼Œå› ä¸ºæ¯æ¬¡è°ƒç”¨ <code>getInstance()</code> éƒ½åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®ï¼Œå…¶ä»–çº¿ç¨‹åªèƒ½å¹²ç­‰ç€ã€‚æ‰€ä»¥è¿™ç§æ–¹å¼ä¹Ÿæ˜¯ä¸æ¨èçš„ã€‚æµ‹è¯•ä»£ç å¤§å®¶å¯è‡ªå·±è¿è¡Œçœ‹çœ‹ç»“æœã€‚</p><h3 id="4-6-æ‡’æ±‰å¼å•ä¾‹-åŒé‡æ ¡éªŒé”"><a href="#4-6-æ‡’æ±‰å¼å•ä¾‹-åŒé‡æ ¡éªŒé”" class="headerlink" title="4.6 æ‡’æ±‰å¼å•ä¾‹ - åŒé‡æ ¡éªŒé”"></a>4.6 æ‡’æ±‰å¼å•ä¾‹ - åŒé‡æ ¡éªŒé”</h3><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä»¥ä¸Šä¸¤ç§æ‡’æ±‰å¼å•ä¾‹éƒ½æœ‰éå¸¸æ˜æ˜¾çš„ç¼ºé™·ï¼Œé‚£ä¹ˆæ€ä¹ˆè§£å†³å‘¢ï¼Ÿ</p><p>åŸºäºä¸Šä¸€ç§æ–¹å¼çš„ä»£ç ï¼Œæ—¢ç„¶åœ¨æ–¹æ³•ä¸ŠåŠ é”ä¼šå½±å“æ€§èƒ½ï¼Œé‚£ä¹ˆæˆ‘ä»¬æŠŠé”åŠ åœ¨æ–¹æ³•é‡Œé¢ï¼ŒåŠ é”ä¹‹å‰å…ˆåˆ¤æ–­ä¸€ä¸‹æ˜¯å¦å·²ç»å®ä¾‹åŒ–äº†æ˜¯ä¸æ˜¯å°±å¯ä»¥äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThreadSafeLazyLoadedSingleton</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ThreadSafeLazyLoadedSingleton <span class="hljs-title">getInstance</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (INSTANCE == <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-comment">// 1 å·ä½ç½®</span><br>            <span class="hljs-keyword">synchronized</span> (ThreadSafeLazyLoadedSingleton.class) &#123;<br>                <span class="hljs-comment">// 2 å·ä½ç½®</span><br>                INSTANCE = <span class="hljs-keyword">new</span> ThreadSafeLazyLoadedSingleton();<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> INSTANCE;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚ä¸Šæ–¹ä»£ç æ‰€ç¤ºï¼Œè¿™æ ·å°±ä¸ä¼šå‡ºç°æ¯æ¬¡è°ƒç”¨ <code>getInstance()</code>éƒ½åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®å¯¼è‡´æ€§èƒ½é—®é¢˜äº†æ˜¯ä¸æ˜¯ã€‚</p><p>ä½†æ˜¯ä»”ç»†æƒ³ä¸€æƒ³ä¸Šé¢æ˜¯ä¸æ˜¯åœ¨å¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹è¿˜æ˜¯ä¼šæœ‰é—®é¢˜å‘¢ï¼Ÿæ¯”å¦‚æ­¤æ—¶æœ‰çº¿ç¨‹Aå’Œçº¿ç¨‹Bä¸¤ä¸ªçº¿ç¨‹ï¼Œä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è®¿é—® <code>getInstance()</code>æ–¹æ³•ï¼ŒåŒæ—¶åˆ°è¾¾ <strong>1 å·ä½ç½®</strong>ï¼Œæ­¤æ—¶ä»–ä»¬ä¼šäº‰æŠ¢é”ï¼Œå› ä¸ºåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ä¸‹é¢çš„ä»£ç å—ã€‚</p><p>å‡è®¾çº¿ç¨‹Aæ­¤æ—¶æŠ¢åˆ°äº†é”ï¼Œçº¿ç¨‹BæœªæŠ¢åˆ°é”ï¼Œåœ¨1å·ä½ç½®ç­‰å¾…ã€‚å½“çº¿ç¨‹Aåœ¨ <strong>2 å·ä½ç½®</strong> åˆ›å»ºå®Œå®ä¾‹ï¼Œè¿”å›ä¹‹åè§£é”ï¼Œæ­¤æ—¶å¯¹è±¡å·²ç»è¢«å®ä¾‹åŒ–äº†ã€‚è§£é”ä¹‹åï¼Œçº¿ç¨‹Bå°±å¯ä»¥è·å–é”äº†ï¼Œè·å–é”ä¹‹åï¼Œçº¿ç¨‹Bä¹Ÿå¯ä»¥å†åˆ›å»ºä¸€ä¸ªå®ä¾‹ã€‚</p><p>é’ˆå¯¹ä¸Šé¢è¿™ç§æƒ…å†µï¼Œè¿˜éœ€è¦å†è¿›è¡Œä¼˜åŒ–ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThreadSafeLazyLoadedSingleton</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ThreadSafeLazyLoadedSingleton <span class="hljs-title">getInstance</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (INSTANCE == <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-comment">// 1 å·ä½ç½®</span><br>            <span class="hljs-keyword">synchronized</span> (ThreadSafeLazyLoadedSingleton.class) &#123;<br>                <span class="hljs-comment">// 2 å·ä½ç½®</span><br>                <span class="hljs-keyword">if</span> (INSTANCE == <span class="hljs-keyword">null</span>) &#123;<br>                    INSTANCE = <span class="hljs-keyword">new</span> ThreadSafeLazyLoadedSingleton();<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> INSTANCE;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ <strong>2 å·ä½ç½®</strong> åŒæ ·åŠ ä¸Šéç©ºåˆ¤æ–­ï¼Œè¿™æ ·å³ä½¿å‡ºç°ä¸Šè¿°çš„æƒ…å†µï¼Œå½“å®ä¾‹åŒ–ä¹‹åï¼Œå…¶ä»–çº¿ç¨‹è·å–é”ï¼Œè¿›å…¥åˆ° <strong>2 å·ä½ç½®</strong>ï¼Œä¹Ÿæ— æ³•å†åˆ›å»ºå®ä¾‹äº†ã€‚è¿™ç§æ–¹å¼å°±æ˜¯æ‡’æ±‰å¼å•ä¾‹çš„æœ€ç»ˆè§£å†³æ–¹æ¡ˆï¼š<strong>åŒé‡æ ¡éªŒé”</strong>ã€‚</p><p>è‡³äºä¸ºä»€ä¹ˆè¦åŒé‡æ ¡éªŒï¼Œç­”æ¡ˆå°±åœ¨ä¸Šé¢çš„é‚£ä¸ªä¾‹å­é‡Œé¢äº†ã€‚<strong>åŒé‡æ ¡éªŒé”</strong> å•ä¾‹æ¨¡å¼å®Œæ•´çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.junmoyu.singleton;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ‡’æ±‰å¼æœ€ç»ˆè§£å†³æ–¹æ¡ˆ - çº¿ç¨‹å®‰å…¨ï¼Œå»¶è¿ŸåŠ è½½</span><br><span class="hljs-comment"> * ä¹Ÿå«åŒé‡æ ¡éªŒé”</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DoubleCheckLockingSingleton</span> </span>&#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åŠ å…¥ volatile ä¿è¯çº¿ç¨‹å¯è§æ€§ï¼Œé˜²æ­¢æŒ‡ä»¤é‡æ’å¯¼è‡´å®ä¾‹è¢«å¤šæ¬¡å®ä¾‹åŒ–</span><br><span class="hljs-comment">     * å¦åˆ™çº¿ç¨‹ä¸å®‰å…¨</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">static</span> DoubleCheckLockingSingleton INSTANCE = <span class="hljs-keyword">null</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç§æœ‰æ„é€ æ–¹æ³•</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">DoubleCheckLockingSingleton</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(getClass().getCanonicalName() + <span class="hljs-string">&quot; è¢«å®ä¾‹åŒ–ï¼ŒhashCodeï¼š&quot;</span> + hashCode());<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * çº¿ç¨‹å®‰å…¨çš„å®ä¾‹è·å–ï¼Œä½¿ç”¨åŒé‡æ£€æŸ¥ï¼Œé¿å…æ¯æ¬¡è·å–å®ä¾‹æ—¶éƒ½åŠ é”</span><br><span class="hljs-comment">     * ä½†è¿™ç§æ¨¡å¼ä¾ç„¶æ˜¯æœ‰éšæ‚£çš„ï¼ŒINSTANCE å¸¸é‡å¿…é¡»æ·»åŠ  volatile å…³é”®å­—æ‰èƒ½é¿å…æŒ‡ä»¤é‡æ’ï¼Œä¿æŒçº¿ç¨‹å¯è§æ€§</span><br><span class="hljs-comment">     * è€Œ volatile åœ¨ JDK 1.5 ä¹‹åæ‰æ”¯æŒ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> DoubleCheckLockingSingleton <span class="hljs-title">getInstance</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (INSTANCE == <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-keyword">synchronized</span> (DoubleCheckLockingSingleton.class) &#123;<br>                <span class="hljs-keyword">if</span> (INSTANCE == <span class="hljs-keyword">null</span>) &#123;<br>                    INSTANCE = <span class="hljs-keyword">new</span> DoubleCheckLockingSingleton();<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> INSTANCE;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æµ‹è¯•æ–¹æ³•ä¸ä¹‹å‰ä¸€æ ·ï¼Œåœ¨æ­¤å°±ä¸æ¼”ç¤ºäº†ã€‚</p><p>è¦æ³¨æ„çš„äº‹ï¼Œè¿™ç§å®ç°æ–¹å¼ï¼Œ<code>INSTANCE</code> å¸¸é‡æ˜¯å¿…é¡»è¦åŠ ä¸Š <code>volatile</code> å…³é”®å­—çš„ï¼Œä¸ç„¶è¿˜æ˜¯ä¸èƒ½ä¿è¯å®Œå…¨çš„çº¿ç¨‹å®‰å…¨ï¼Œä¸åŠ  <code>volatile</code>  å¯èƒ½ä¼šå› ä¸º JVM æŒ‡ä»¤é‡æ’è€Œå‡ºç°é—®é¢˜ã€‚å…·ä½“åŸå› åœ¨ä¸‹ä¸€ä¸ªç« èŠ‚è¯¦ç»†è¯´æ˜ã€‚</p><h2 id="5-è¿›é˜¶"><a href="#5-è¿›é˜¶" class="headerlink" title="5. è¿›é˜¶"></a>5. è¿›é˜¶</h2><h3 id="5-1-volatile-å…³é”®å­—è§£æ"><a href="#5-1-volatile-å…³é”®å­—è§£æ" class="headerlink" title="5.1 volatile å…³é”®å­—è§£æ"></a>5.1 volatile å…³é”®å­—è§£æ</h3><p>é¦–å…ˆæ¥çœ‹ä¸€ä¸‹ <strong>åŒé‡æ ¡éªŒé”</strong> ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ã€‚æˆ‘ä»¬å…ˆè¦äº†è§£å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹(new å…³é”®å­—)ï¼Œå®ƒç®€å•çš„åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µ:</p><p>1.åˆ†é…å¯¹è±¡å†…å­˜ç©ºé—´ã€‚ 2.åˆå§‹åŒ–å¯¹è±¡ã€‚ 3.è®¾ç½®å¯¹è±¡æŒ‡å‘å†…å­˜ç©ºé—´ã€‚</p><p>ä½†æ˜¯å®é™…ä¸Šç¬¬äºŒæ­¥å’Œç¬¬ä¸‰æ­¥çš„é¡ºåºæ˜¯å¯ä»¥äº’æ¢çš„ï¼Œåœ¨ JVM çš„ä¼˜åŒ–ä¸­å­˜åœ¨ä¸€ç§æŒ‡ä»¤é‡æ’åºçš„æœºåˆ¶ï¼Œå¯ä»¥åŠ å¿« JVM çš„è¿è¡Œé€Ÿåº¦ã€‚</p><p>é‚£ä¹ˆç°åœ¨æˆ‘ä»¬æ¥åšä¸ªå®éªŒï¼Œè¿è¡Œ <code>DoubleCheckLockingSingleton.main()</code> æ–¹æ³•åï¼Œåœ¨ <code>target</code> ç›®å½•ä¸‹æ‰¾åˆ°å®ƒçš„ <code>DoubleCheckLockingSingleton.class</code> æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨ <code>javap -c DoubleCheckLockingSingleton.class &gt; DCL.txt</code> æ¥ç”Ÿæˆå­—èŠ‚ç æ–‡ä»¶ã€‚</p><p>æ‰“å¼€æ–‡ä»¶å¯ä»¥åœ¨ <code>public static com.junmoyu.singleton.DoubleCheckLockingSingleton getInstance();</code> ä¸‹æ–¹çœ‹åˆ° <code>getInstance()</code> æ–¹æ³•æ•´ä¸ªå­—èŠ‚ç æ‰§è¡Œè¿‡ç¨‹ã€‚</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs gauss"><span class="hljs-number">17</span>: <span class="hljs-keyword">new</span>           <span class="hljs-meta">#9      <span class="hljs-comment">// class com/junmoyu/singleton/ThreadSafeLazyLoadedSingleton</span></span><br><span class="hljs-number">20</span>: dup<br><span class="hljs-number">21</span>: invokespecial <span class="hljs-meta">#10     <span class="hljs-comment">// Method &quot;&lt;init&gt;&quot;:()V</span></span><br><span class="hljs-number">24</span>: putstatic     <span class="hljs-meta">#5      <span class="hljs-comment">// Field INSTANCE:Lcom/junmoyu/singleton/ThreadSafeLazyLoadedSingleton;</span></span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢å››ä¸ªæ­¥éª¤æ˜¯èŠ‚é€‰äº† <code>new DoubleCheckLockingSingleton()</code> çš„æ‰§è¡Œè¿‡ç¨‹ã€‚</p><ul><li>17 : new æŒ‡ä»¤åœ¨ java å †ä¸Šä¸º ThreadSafeLazyLoadedSingleton å¯¹è±¡åˆ†é…å†…å­˜ç©ºé—´ï¼Œå¹¶å°†åœ°å€å‹å…¥æ“ä½œæ ˆé¡¶</li><li>20 : dup æŒ‡ä»¤ä¸ºå¤åˆ¶æ“ä½œæ ˆé¡¶å€¼ï¼Œå¹¶å°†å…¶å‹å…¥æ ˆé¡¶ï¼Œè¿™æ—¶æ“ä½œæ ˆä¸Šæœ‰è¿ç»­ç›¸åŒçš„ä¸¤ä¸ªå¯¹è±¡åœ°å€</li><li>21 : è°ƒç”¨å®ä¾‹çš„æ„é€ å‡½æ•°ï¼Œå®ä¾‹åŒ–å¯¹è±¡ï¼Œè¿™ä¸€æ­¥ä¼šå¼¹å‡ºä¸€ä¸ªä¹‹å‰å…¥æ ˆçš„å¯¹è±¡åœ°å€</li><li>24 : å°†å¯¹è±¡åœ°å€èµ‹å€¼ç»™å¸¸é‡ <code>INSTANCE</code></li></ul><p>ç”±ä¸Šå¯çœ‹åˆ°åˆ›å»ºä¸€ä¸ªå¯¹è±¡å¹¶éåŸå­æ“ä½œï¼Œè€Œæ˜¯åˆ†æˆäº†å¤šä¸ªæ­¥éª¤ï¼Œå¦‚æœ JVM é‡æ’åºåï¼Œ21 åœ¨ 24 ä¹‹åï¼Œæ­¤æ—¶åˆ†é…å®Œäº†å¯¹è±¡çš„å†…å­˜ç©ºé—´ï¼Œä¸”æŠŠå†…å­˜åœ°å€å¤åˆ¶ç»™äº†å¸¸é‡ <code>INSTANCE</code>ï¼Œé‚£ä¹ˆæ­¤æ—¶ <code>INSTANCE != null</code>ã€‚</p><p>å¦‚æœæ­¤æ—¶æœ‰å¦å¤–ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ <code>getInstance()</code> å°±ä¼šç›´æ¥è¿”å› <code>INSTANCE</code> å¸¸é‡ï¼Œç„¶è€Œå¯¹è±¡å…¶å®è¿˜æ²¡æœ‰å®ä¾‹åŒ–å®Œæˆï¼Œè¿”å›çš„å°†æ˜¯ä¸€ä¸ªç©ºçš„å¯¹è±¡ã€‚æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><table><thead><tr><th>æ‰§è¡Œæ­¥éª¤</th><th>çº¿ç¨‹1</th><th>çº¿ç¨‹2</th></tr></thead><tbody><tr><td>step1</td><td>åˆ†é…å¯¹è±¡å†…å­˜ç©ºé—´</td><td></td></tr><tr><td>step2</td><td>å°†å¯¹è±¡å†…å­˜åœ°å€èµ‹å€¼ç»™å¸¸é‡ INSTANCE</td><td></td></tr><tr><td>step3</td><td></td><td>åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸º null</td></tr><tr><td>step4</td><td></td><td>å¯¹è±¡ä¸ä¸º null, è¿”å› INSTANCE</td></tr><tr><td>step5</td><td></td><td>è®¿é—® INSTANCE å¯¹è±¡</td></tr><tr><td>step6</td><td>åˆå§‹åŒ–å¯¹è±¡</td><td></td></tr></tbody></table><p>å¦‚æœå‡ºç°ä¸Šè¡¨æ‰€ç¤ºçš„æƒ…å†µï¼Œé‚£ä¹ˆçº¿ç¨‹2å°†è·å–åˆ°ä¸€ä¸ªç©ºçš„å¯¹è±¡ï¼Œè®¿é—®å¯¹è±¡çš„å‚æ•°æˆ–æ–¹æ³•éƒ½å°†å‡ºç°å¼‚å¸¸ã€‚æ‰€ä»¥éœ€è¦åŠ ä¸Š <strong>volatile</strong> å…³é”®å­—ã€‚<strong>volatile</strong> å…³é”®å­—æœ‰ä¸¤ä¸ªä½œç”¨ï¼š</p><ol><li>ä¿è¯å¯¹è±¡çš„å¯è§æ€§ã€‚</li><li>é˜²æ­¢æŒ‡ä»¤é‡æ’åºã€‚</li></ol><blockquote><p>å¯¹è±¡çš„åˆ›å»ºå¯èƒ½å‘ç”ŸæŒ‡ä»¤çš„é‡æ’åºï¼Œä½¿ç”¨ volatile å¯ä»¥ç¦æ­¢æŒ‡ä»¤çš„é‡æ’åºï¼Œä¿è¯å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„çº¿ç¨‹å®‰å…¨ã€‚</p></blockquote><p>é‚£ä¹ˆè‡³æ­¤ï¼Œç›¸ä¿¡ä½ å¯¹ <strong>åŒé‡æ ¡éªŒé”</strong> çš„å•ä¾‹ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ volatile å…³é”®å­—çš„åŸå› å·²ç»äº†è§£æ¸…æ¥šäº†ã€‚</p><p>ä½†æ˜¯ä½ å¯èƒ½è¿˜æœ‰ä¸€ä¸ªç–‘æƒ‘ï¼Œä¸ºä»€ä¹ˆä¹‹å‰åœ¨ <code>public static synchronized LazyLoadedSingleton getInstance()</code> æ–¹æ³•ä¸ŠåŠ é”æ—¶å¹¶æœªæåˆ°éœ€è¦åŠ  volatile å…³é”®å­—å‘¢ã€‚</p><p>å…¶å®åŸå› ä¹Ÿå¾ˆç®€å•ï¼Œå› ä¸ºè¿™é‡Œé”çš„æ˜¯æ–¹æ³•ï¼Œå³ä½¿å‡ºç°äº†æŒ‡ä»¤é‡æ’ï¼Œå…¶ä»–çš„çº¿ç¨‹åœ¨è°ƒç”¨ <code>getInstance()</code> æ—¶ä¹Ÿæ— æ³•è·å–å®ä¾‹ï¼Œå› ä¸ºæ–¹æ³•è¢«åŠ é”äº†ï¼Œè‡ªç„¶ä¹Ÿä¸ä¼šå‡ºç°é—®é¢˜ï¼Œåªæ˜¯æ–¹æ³•åŠ é”æ€§èƒ½æŸè€—è¾ƒå¤§è€Œå·²ã€‚</p><p>åœ¨ <code>Spring</code> æºç ä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°ç±»ä¼¼çš„ä¾‹å­ï¼Œå¦‚ <code>org.springframework.beans.factory.xml.DefaultNamespaceHandlerResolver</code> ç±»ä¸­çš„ <code>private volatile Map&lt;String, Object&gt; handlerMappings;</code> å‚æ•°ä¸ <code>private Map&lt;String, Object&gt; getHandlerMappings()</code> æ–¹æ³•å°±æ˜¯ä½¿ç”¨ <strong>åŒé‡æ ¡éªŒé”</strong> çš„æ–¹å¼ç¼–å†™çš„ã€‚æ„Ÿå…´è¶£çš„å¯ä»¥è‡ªè¡ŒæŸ¥çœ‹ã€‚</p><h3 id="5-2-åå°„ä¼šå¯¼è‡´å•ä¾‹å¤±æ•ˆå˜›ï¼Ÿ"><a href="#5-2-åå°„ä¼šå¯¼è‡´å•ä¾‹å¤±æ•ˆå˜›ï¼Ÿ" class="headerlink" title="5.2 åå°„ä¼šå¯¼è‡´å•ä¾‹å¤±æ•ˆå˜›ï¼Ÿ"></a>5.2 åå°„ä¼šå¯¼è‡´å•ä¾‹å¤±æ•ˆå˜›ï¼Ÿ</h3><p>è‡³äºåå°„ä¼šä¸ä¼šå¯¼è‡´å•ä¾‹å¤±æ•ˆï¼Œæˆ‘ä»¬ä¸å¦¨æµ‹è¯•ä¸€ä¸‹ã€‚åœ¨å„ä¸ªå•ä¾‹ç±»çš„ <code>main()</code> æ–¹æ³•ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EagerlySingleton</span> </span>&#123;<br>    <span class="hljs-comment">// ...</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-comment">// åå°„æµ‹è¯•</span><br>        <span class="hljs-comment">// é€šè¿‡åå°„çš„æ–¹å¼ç›´æ¥è°ƒç”¨ç§æœ‰æ„é€ å™¨ï¼ˆé€šè¿‡åœ¨æ„é€ å™¨é‡ŒæŠ›å‡ºå¼‚å¸¸å¯ä»¥è§£å†³æ­¤é—®é¢˜ï¼‰</span><br>        Class&lt;EagerlySingleton&gt; clazz = (Class&lt;EagerlySingleton&gt;) Class.forName(<span class="hljs-string">&quot;com.junmoyu.singleton.EagerlySingleton&quot;</span>);<br>        Constructor&lt;EagerlySingleton&gt; constructor = clazz.getDeclaredConstructor(<span class="hljs-keyword">null</span>);<br><br>        EagerlySingleton singleton1 = constructor.newInstance();<br>        EagerlySingleton singleton2 = constructor.newInstance();<br><br>        System.out.println(<span class="hljs-string">&quot;åå°„æµ‹è¯•ï¼šsingleton1 hashCodeï¼š&quot;</span> + <span class="hljs-string">&quot;@&quot;</span> + singleton1.hashCode());<br>        System.out.println(<span class="hljs-string">&quot;åå°„æµ‹è¯•ï¼šsingleton2 hashCodeï¼š&quot;</span> + <span class="hljs-string">&quot;@&quot;</span> + singleton2.hashCode());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿è¡ŒåæŸ¥çœ‹æ—¥å¿—å¯ä»¥å‘ç°ï¼Œä¸¤ä¸ªå¯¹è±¡çš„ hashCode æ˜¯ä¸ä¸€æ ·çš„ã€‚é™¤äº†æšä¸¾å®ç°çš„å•ä¾‹æ¨¡å¼å¤–ï¼Œå…¶ä»–æ‹¥æœ‰ç§æœ‰æ„é€ å™¨çš„å®ç°æ–¹å¼å‡å¯é€šè¿‡åå°„æ¥åˆ›å»ºå¤šä¸ªå®ä¾‹ã€‚</p><p>è¦è§£å†³çš„è¯ä¹Ÿå¾ˆç®€å•ã€‚é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼çš„å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼ - çº¿ç¨‹å®‰å…¨</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EagerlySingleton</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> EagerlySingleton INSTANCE = <span class="hljs-keyword">new</span> EagerlySingleton();<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">EagerlySingleton</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-comment">// é˜²æ­¢é€šè¿‡åå°„è¿›è¡Œå®ä¾‹åŒ–ä»è€Œç ´åå•ä¾‹</span><br>        <span class="hljs-comment">// æœ€å¥½æ”¾åœ¨å¼€å¤´ï¼Œå¦‚ä¸éœ€è¦åˆ é™¤å³å¯</span><br>        <span class="hljs-keyword">if</span> (INSTANCE != <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalStateException(<span class="hljs-string">&quot;Already initialized.&quot;</span>);<br>        &#125;<br>        System.out.println(getClass().getCanonicalName() + <span class="hljs-string">&quot; è¢«å®ä¾‹åŒ–ï¼ŒhashCodeï¼š&quot;</span> + hashCode());<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> EagerlySingleton <span class="hljs-title">getInstance</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> INSTANCE;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…¶ä»–æ–¹å¼å®ç°çš„å•ä¾‹å’Œé¥¿æ±‰å¼å•ä¾‹ä¸€æ ·ï¼Œåœ¨æ­¤å°±ä¸ä¸€ä¸€è¯´æ˜äº†ã€‚å†æ¬¡è¿è¡Œ <code>main()</code> æ–¹æ³•æµ‹è¯•åå°„ã€‚å¯ä»¥æ‰“å°æ—¥å¿—å¦‚ä¸‹ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css">...<br><span class="hljs-selector-tag">Caused</span> <span class="hljs-selector-tag">by</span>: <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.IllegalStateException</span>: <span class="hljs-selector-tag">Already</span> <span class="hljs-selector-tag">initialized</span>.<br><span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.junmoyu</span><span class="hljs-selector-class">.singleton</span><span class="hljs-selector-class">.StaticInnerClassSingleton</span>.&lt;<span class="hljs-selector-tag">init</span>&gt;(<span class="hljs-selector-tag">StaticInnerClassSingleton</span><span class="hljs-selector-class">.java</span><span class="hljs-selector-pseudo">:27)</span><br>... 5 <span class="hljs-selector-tag">more</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æƒ³è¦é€šè¿‡åå°„å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œç›´æ¥æŠ›å‡ºäº†å¼‚å¸¸ï¼Œå¹¶æ²¡æœ‰è¿›è¡Œå®ä¾‹åŒ–çš„æ“ä½œã€‚</p><h3 id="5-3-ååºåˆ—åŒ–é—®é¢˜"><a href="#5-3-ååºåˆ—åŒ–é—®é¢˜" class="headerlink" title="5.3 ååºåˆ—åŒ–é—®é¢˜"></a>5.3 ååºåˆ—åŒ–é—®é¢˜</h3><p>é™¤äº†åå°„ä»¥å¤–ï¼Œä½¿ç”¨ååºåˆ—åŒ–ä¹ŸåŒæ ·ä¼šç ´åå•ä¾‹ã€‚</p><p>è¿˜æ˜¯ä»¥ <code>EagerlySingleton</code> ç±»æ¥æµ‹è¯•ï¼Œå…ˆè®©å…¶å®ç° <code>Serializable</code> æ¥å£ï¼Œç„¶ååœ¨ <code>main()</code> æ–¹æ³•é‡Œé¢æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.junmoyu.singleton.serializable;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EagerlySingleton</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> EagerlySingleton INSTANCE = <span class="hljs-keyword">new</span> EagerlySingleton();<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">EagerlySingleton</span><span class="hljs-params">()</span> </span>&#123;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> EagerlySingleton <span class="hljs-title">getInstance</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> INSTANCE;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-comment">// ååºåˆ—åŒ–æµ‹è¯•</span><br>        <span class="hljs-comment">// å°†å¯¹è±¡å†™å…¥æ–‡ä»¶</span><br>        ObjectOutputStream os = <span class="hljs-keyword">new</span> ObjectOutputStream(<span class="hljs-keyword">new</span> FileOutputStream(<span class="hljs-string">&quot;tempFile&quot;</span>));<br>        EagerlySingleton osInstance = EagerlySingleton.getInstance();<br>        System.out.println(<span class="hljs-string">&quot;ååºåˆ—åŒ–æµ‹è¯•ï¼šosInstance hashCodeï¼š&quot;</span> + <span class="hljs-string">&quot;@&quot;</span> + osInstance.hashCode());<br>        os.writeObject(osInstance);<br><br>        <span class="hljs-comment">// ä»æ–‡ä»¶ä¸­è¯»å–å¯¹è±¡</span><br>        File file = <span class="hljs-keyword">new</span> File(<span class="hljs-string">&quot;tempFile&quot;</span>);<br>        ObjectInputStream is = <span class="hljs-keyword">new</span> ObjectInputStream(<span class="hljs-keyword">new</span> FileInputStream(file));<br>        EagerlySingleton isInstance = (EagerlySingleton) is.readObject();<br>        <span class="hljs-comment">// æŸ¥çœ‹ hashCode æ˜¯å¦ç›¸åŒ</span><br>        System.out.println(<span class="hljs-string">&quot;ååºåˆ—åŒ–æµ‹è¯•ï¼šisInstance hashCodeï¼š&quot;</span> + <span class="hljs-string">&quot;@&quot;</span> + isInstance.hashCode());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿è¡Œ <code>main()</code>æ–¹æ³•æµ‹è¯•ä¸€ä¸‹ï¼ŒæŸ¥çœ‹æ—¥å¿—ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.junmoyu</span><span class="hljs-selector-class">.singleton</span><span class="hljs-selector-class">.serializable</span><span class="hljs-selector-class">.DoubleCheckLockingSingleton</span> è¢«å®ä¾‹åŒ–ï¼Œ<span class="hljs-selector-tag">hashCode</span>ï¼š460141958<br>ååºåˆ—åŒ–æµ‹è¯•ï¼š<span class="hljs-selector-tag">osInstance</span> <span class="hljs-selector-tag">hashCode</span>ï¼š<span class="hljs-keyword">@460141958</span><br>ååºåˆ—åŒ–æµ‹è¯•ï¼šisInstance hashCodeï¼š@<span class="hljs-number">81628611</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åºåˆ—åŒ–å¯¹è±¡å’Œååºåˆ—åŒ–ä¹‹åçš„å¯¹è±¡ hashCode å¹¶ä¸ç›¸åŒã€‚</p><p>æƒ³è¦è§£å†³ååºåˆ—åŒ–çš„é—®é¢˜ï¼Œåªéœ€è¦æ·»åŠ ä¸€ä¸ª <code>readResolve()</code> æ–¹æ³•å³å¯ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EagerlySingleton</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;<br>    <span class="hljs-comment">// ...</span><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¦‚æœæœ‰åºåˆ—åŒ–éœ€æ±‚ï¼Œéœ€è¦æ·»åŠ æ­¤æ–¹æ³•ä»¥é˜²æ­¢ååºåˆ—åŒ–æ—¶é‡æ–°åˆ›å»ºæ–°å®ä¾‹</span><br><span class="hljs-comment">     * å¦‚æ— åºåˆ—åŒ–éœ€æ±‚å¯ä¸åŠ ï¼ŒåŒæ—¶å»é™¤ implements Serializable</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> Object <span class="hljs-title">readResolve</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> INSTANCE;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å†æ¬¡è¿è¡Œ <code>main()</code>æ–¹æ³•æµ‹è¯•ä¸€ä¸‹ï¼ŒæŸ¥çœ‹æ—¥å¿—ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.junmoyu</span><span class="hljs-selector-class">.singleton</span><span class="hljs-selector-class">.serializable</span><span class="hljs-selector-class">.EagerlySingleton</span> è¢«å®ä¾‹åŒ–ï¼Œ<span class="hljs-selector-tag">hashCode</span>ï¼š460141958<br>ååºåˆ—åŒ–æµ‹è¯•ï¼š<span class="hljs-selector-tag">osInstance</span> <span class="hljs-selector-tag">hashCode</span>ï¼š<span class="hljs-keyword">@460141958</span><br>ååºåˆ—åŒ–æµ‹è¯•ï¼šisInstance hashCodeï¼š@<span class="hljs-number">460141958</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°ä¸¤ä¸ªå¯¹è±¡çš„ hashCode å·²ç»æ˜¯ä¸€è‡´çš„äº†ã€‚</p><blockquote><p>æšä¸¾ç±»çš„å•ä¾‹ï¼Œæ˜¯å¤©ç„¶å¯ä»¥ç»å¯¹é˜²æ­¢å¤šå®ä¾‹åŒ–çš„ï¼Œåå°„åŠååºåˆ—åŒ–éƒ½æ— æ•ˆã€‚</p></blockquote><p>è‡³äºä¸ºä»€ä¹ˆåŠ äº† <code>readResolve()</code>å°±å¯ä»¥é˜²æ­¢ååºåˆ—åŒ–é‡æ–°åˆ›å»ºå®ä¾‹ï¼Œå°±è¦æ·±å…¥æºç è§£æäº†ã€‚è¿™é‡Œå°±ä¸è¯¦ç»†å™è¿°äº†ï¼Œç®€å•è¯´ä¸€ä¸‹ã€‚</p><p>ååºåˆ—åŒ–çš„å¯¹è±¡è·å–æ˜¯é€šè¿‡æ–¹æ³• ObjectInputStream#readObject()ï¼Œè¿›å…¥æºç ï¼Œå¯ä»¥çœ‹åˆ° <code>Object obj = readObject0(false);</code> è¿™è¡Œä»£ç æœ€ç»ˆè¿”å›çš„å¯¹è±¡ã€‚ç»§ç»­è¿›å…¥æºç ï¼Œåœ¨ ObjectInputStream#readObject0()æ–¹æ³•ä¸­å¯ä»¥çœ‹åˆ°ä¸€ä¸ª switch é€‰æ‹©å™¨ï¼Œæ‰¾åˆ°ä¸‹é¢è¿™å—é‡ç‚¹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ObjectInputStream</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">InputStream</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ObjectInput</span>, <span class="hljs-title">ObjectStreamConstants</span> </span>&#123;<br>    <span class="hljs-comment">// ...</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> Object <span class="hljs-title">readObject0</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> unshared)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        <span class="hljs-comment">// ...</span><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">switch</span> (tc) &#123;<br>                <span class="hljs-comment">// ...</span><br>                <span class="hljs-keyword">case</span> TC_ENUM:<br>                    <span class="hljs-comment">// å•ä¾‹ä¸­ä¸ºä»€ä¹ˆæšä¸¾æœ€å®‰å…¨ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥çœ‹ä¸€ä¸‹è¿™é‡Œçš„å®ç°</span><br>                    <span class="hljs-keyword">return</span> checkResolve(readEnum(unshared));<br>                <span class="hljs-keyword">case</span> TC_OBJECT:<br>                    <span class="hljs-comment">// è¿™é‡Œçš„ readOrdinaryObject å°±æ˜¯è¯»å–å¯¹è±¡çš„æ–¹æ³•äº†</span><br>                    <span class="hljs-keyword">return</span> checkResolve(readOrdinaryObject(unshared));<br>            &#125;<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>        &#125;<br>    &#125;<br>&#125;    <br></code></pre></td></tr></table></figure><p>è¿›å…¥ <code>readOrdinaryObject()</code> æ–¹æ³•ï¼Œæœ€ç»ˆçš„ç­”æ¡ˆéƒ½åœ¨è¿™é‡Œäº†ã€‚</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/6c7edce20db04cf587705a5f3a731994~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>è¿™ä¸ªæ–¹æ³•é‡Œé¢ï¼Œæœ€é‡è¦çš„ä¸¤å—ä»£ç ï¼Œæˆ‘åœˆå‡ºæ¥äº†ã€‚ç¬¬ä¸€å—å…¶å®å°±æ˜¯æˆ‘ä»¬åœ¨æ²¡æœ‰åŠ å…¥ <code>readResolve()</code> æ–¹æ³•æ—¶ï¼Œå®ƒé€šè¿‡åå°„åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œåœ¨ç¬¬äºŒå—ä»£ç çš„åˆ¤æ–­é‡Œ <code>desc.hasReadResolveMethod() == false</code> å°†ä¸ä¼šæ‰§è¡Œ if é‡Œé¢çš„è¯­å¥ã€‚å®ƒè¿”å›å°±æ˜¯ä¹‹å‰åˆ›å»ºçš„æ–°å®ä¾‹äº†ã€‚</p><p>if ä¸­çš„ä»£ç å…¶å®å°±æ˜¯è°ƒç”¨ <code>readResolve()</code> æ–¹æ³•ï¼Œç„¶åå°†è·å–åˆ°çš„å¯¹è±¡æ›¿æ¢æ‰ç¬¬ä¸€å—ä»£ç é‡Œé¢åˆ›å»ºçš„æ–°å®ä¾‹ï¼Œè€Œ<code>readResolve()</code> æ–¹æ³•ä¸æ­£æ˜¯è¿”å›äº†å•ä¾‹çš„å®ä¾‹å˜›ã€‚æ‰€ä»¥å¦‚æœåŠ äº†è¿™ä¸ªæ–¹æ³•ï¼Œå°±ä¼šæ‰§è¡Œ if é‡Œé¢çš„ä»£ç ï¼Œç”¨å•ä¾‹çš„å®ä¾‹å»æ›¿æ¢æ‰åå°„åˆ›å»ºçš„å®ä¾‹ã€‚</p><p>æ‰€ä»¥ç°åœ¨ä½ çŸ¥é“ä¸ºä»€ä¹ˆåŠ å…¥ <code>readResolve()</code> æ–¹æ³•å°±å¯ä»¥é˜²æ­¢ååºåˆ—åŒ–äº†å§ã€‚</p><h3 id="5-4-ä½ ä»¥ä¸ºè¿™å°±ç»“æŸäº†ï¼Ÿ"><a href="#5-4-ä½ ä»¥ä¸ºè¿™å°±ç»“æŸäº†ï¼Ÿ" class="headerlink" title="5.4 ä½ ä»¥ä¸ºè¿™å°±ç»“æŸäº†ï¼Ÿ"></a>5.4 ä½ ä»¥ä¸ºè¿™å°±ç»“æŸäº†ï¼Ÿ</h3><p>è™½ç„¶ä¸æƒ³å†å•°å—¦äº†ï¼ˆå¯¹ä¸ä½äº†ï¼ï¼‰ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€ä¸ª<strong>é‡ç‚¹</strong>ï¼</p><p>å¦‚æœæœ‰ä¸¤ä¸ªç±»åŠ è½½å™¨ï¼ˆclass loaderï¼‰çš„å­˜åœ¨ï¼Œé‚£æ˜¯ä¸¤ä¸ªç±»åŠ è½½å™¨å¯èƒ½å„è‡ªåˆ›å»ºè‡ªå·±çš„å•ä¾‹æ¨¡å¼ã€‚</p><p>å› ä¸ºæ¯ä¸ªç±»åŠ è½½å™¨éƒ½å®šä¹‰äº†ä¸€ä¸ªå‘½åç©ºé—´ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªæˆ–ä»¥ä¸Šçš„ç±»åŠ è½½å™¨ï¼Œä¸åŒçš„ç±»åŠ è½½å™¨å¯èƒ½ä¼šåŠ è½½åŒä¸€ä¸ªç±»ï¼Œé‚£ä¹ˆä»æ•´ä¸ªç¨‹åºæ¥çœ‹ï¼ŒåŒä¸€ä¸ªç±»å°±è¢«åŠ è½½å¤šæ¬¡äº†ã€‚ä¹Ÿå°±æ˜¯ä¼šæœ‰å¤šä¸ªå•ä¾‹çš„å®ä¾‹å¹¶å­˜ã€‚</p><p>æ‰€ä»¥ï¼Œå¦‚æœä½ çš„ç¨‹åºæœ‰å¤šä¸ªç±»åŠ è½½å™¨åˆåŒæ—¶ä½¿ç”¨äº†å•ä¾‹æ¨¡å¼ï¼Œé‚£ä¹ˆå°±è¦å°å¿ƒäº†ã€‚æœ‰ä¸€ä¸ªè§£å†³æ–¹æ³•å°±æ˜¯<strong>ä½ å¯ä»¥è‡ªè¡ŒæŒ‡å®šç±»åŠ è½½å™¨ï¼Œå¹¶æŒ‡å®šåŒä¸€ä¸ªç±»åŠ è½½å™¨ã€‚</strong></p><h2 id="6-æ‹“å±•"><a href="#6-æ‹“å±•" class="headerlink" title="6. æ‹“å±•"></a>6. æ‹“å±•</h2><p>å¦å¤–å…¶å®è¿˜æœ‰ä¸€ç§ç¨å¾®ç‰¹æ®Šä¸€ç‚¹çš„ â€œå•ä¾‹â€ æ¨¡å¼ï¼Œå¯ä»¥ç§°ä¹‹ä¸º <strong>çº¿ç¨‹å•ä¾‹</strong>ï¼Œé‚£å°±æ˜¯ä½¿ç”¨ ThreadLocal ä½¿æ¯ä¸€ä¸ªçº¿ç¨‹æ‹¥æœ‰è‡ªå·±çš„å•ä¾‹ã€‚</p><p>æ¯”å¦‚ mybatis 3.5.x ç‰ˆæœ¬ä¸­çš„ <code>org.apache.ibatis.executor.ErrorContext</code> ç±»ï¼Œå°±æ˜¯ä½¿ç”¨äº†æ­¤ç§æ–¹å¼å®ç°çš„ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥è‡ªè¡Œç ”ç©¶ï¼Œåœ¨æ­¤ä¸å†èµ˜è¿°ã€‚ç®€å•è´´ä¸‹ä»£ç æ„Ÿå—ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.apache.ibatis.executor;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ErrorContext</span> </span>&#123;<br>    <span class="hljs-comment">// è¿™é‡Œä½¿ç”¨äº†å‡½æ•°å¼æ¥å£ Supplier&lt;T&gt;ï¼Œæ›´ä¼˜é›…çš„åˆå§‹åŒ– ThreadLocal</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ThreadLocal&lt;ErrorContext&gt; LOCAL = ThreadLocal.withInitial(ErrorContext::<span class="hljs-keyword">new</span>);<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">ErrorContext</span><span class="hljs-params">()</span> </span>&#123;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ErrorContext <span class="hljs-title">instance</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> LOCAL.get();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="7-æ€»ç»“"><a href="#7-æ€»ç»“" class="headerlink" title="7. æ€»ç»“"></a>7. æ€»ç»“</h2><p>è‡³æ­¤ï¼Œæˆ‘ä»¬è®¨è®ºäº†å…­ç§å•ä¾‹æ¨¡å¼çš„å®ç°æ–¹å¼ã€‚</p><ol><li>æšä¸¾å®ç° - çº¿ç¨‹å®‰å…¨</li><li>é¥¿æ±‰å¼å•ä¾‹ - çº¿ç¨‹å®‰å…¨</li><li>é™æ€å†…éƒ¨ç±»å®ç° - çº¿ç¨‹å®‰å…¨ã€å»¶è¿ŸåŠ è½½</li><li>æ™®é€šæ‡’æ±‰å¼ - çº¿ç¨‹ä¸å®‰å…¨ã€å»¶è¿ŸåŠ è½½</li><li>æ–¹æ³•åŠ é”æ‡’æ±‰å¼ - çº¿ç¨‹å®‰å…¨ã€å»¶è¿ŸåŠ è½½ï¼Œä½†æ€§èƒ½å·®</li><li>åŒé‡æ ¡éªŒé”æ‡’æ±‰å¼ - çº¿ç¨‹å®‰å…¨ã€å»¶è¿ŸåŠ è½½</li></ol><p>ä¸”é™¤äº†æšä¸¾å®ç°çš„å•ä¾‹å¤–ï¼Œå…¶ä»–å‡æœ‰åå°„åŠåºåˆ—åŒ–ä¼šç ´åå•ä¾‹çš„æƒ…å†µã€‚é‚£ä¹ˆç»¼åˆæ¥çœ‹çš„è¯ï¼Œæšä¸¾å®ç°çš„å•ä¾‹æ˜¯æœ€ä¼˜çš„æ–¹æ¡ˆï¼Œä¹Ÿæ˜¯ <code>Effective Java</code> ä¹¦ä¸­æ¨èçš„æ–¹æ¡ˆã€‚ç„¶è€Œåœ¨ Java åŠä¸€äº›æ¡†æ¶çš„æºç ä¸­ä½¿ç”¨æšä¸¾å•ä¾‹çš„ä¾‹å­å¾ˆå°‘ï¼Œä¸çŸ¥é“æ˜¯ä¸ºä»€ä¹ˆï¼Œå¯èƒ½æ˜¯æˆ‘çœ‹çš„æºç è¿˜ä¸å¤Ÿå¤šå§ã€‚</p><p>å› ä¸ºæšä¸¾å®ç°çš„å•ä¾‹æ¨¡å¼å…¶å®ä¹Ÿå±äºé¥¿æ±‰å¼ï¼Œæ‰€ä»¥å¦‚æœåœ¨å®ä¾‹åŒ–æ—¶éœ€è¦æ‰§è¡Œè€—æ—¶æ“ä½œçš„è¯ï¼Œåˆ™ä¸å»ºè®®ä½¿ç”¨ã€‚</p><p>é‚£ä¹ˆé™¤æ­¤ä¹‹å¤–è¾ƒå¥½çš„å•ä¾‹å®ç°è¿˜æœ‰<strong>é™æ€å†…éƒ¨ç±»</strong>çš„å®ç°ï¼Œä»¥åŠ<strong>åŒé‡æ ¡éªŒé”</strong>çš„å®ç°ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡éœ€è¦çµæ´»é€‰æ‹©ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>mysqlä¼˜åŒ–groupBy</title>
    <link href="/blog/2021/05/03/mysql%E4%BC%98%E5%8C%96groupBy/"/>
    <url>/blog/2021/05/03/mysql%E4%BC%98%E5%8C%96groupBy/</url>
    
    <content type="html"><![CDATA[<p>å½“æˆ‘ä»¬äº¤å‹å¹³å°åœ¨çº¿ä¸Šè¿è¡Œä¸€æ®µæ—¶é—´åï¼Œä¸ºäº†ç»™å¹³å°ç”¨æˆ·åœ¨æœç´¢å¥½å‹æ—¶ï¼Œåœ¨æœç´¢ç»“æœä¸­æ¨èå¹¶ç½®é¡¶ä»–æ„Ÿå…´è¶£çš„å¥½å‹ï¼Œè¿™æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šå¯¹ç”¨æˆ·çš„è¡Œä¸ºåšæ•°æ®åˆ†æï¼Œæ ¹æ®åˆ†æç»“æœç»™ä»–æ¨èå…¶æ„Ÿå…´è¶£çš„å¥½å‹ã€‚</p><blockquote><p>è¿™é‡Œï¼Œæˆ‘é‡‡ç”¨æœ€ç®€å•çš„SQLåˆ†ææ³•ï¼šå¯¹ç”¨æˆ·è¿‡å»æŸ¥çœ‹å¥½å‹çš„æ€§åˆ«å’Œå¹´é¾„è¿›è¡Œç»Ÿè®¡ï¼ŒæŒ‰ç…§å¹´é¾„è¿›è¡Œåˆ†ç»„å¾—åˆ°ç»Ÿè®¡ç»“æœã€‚ä¾æ®è¯¥ç»“æœï¼Œç»™ç”¨æˆ·æ¨èè®¡æ•°æœ€é«˜çš„æŸä¸ªæ€§åˆ«åŠå¹´é¾„çš„å¥½å‹ã€‚</p></blockquote><p>é‚£ä¹ˆï¼Œå‡è®¾æˆ‘ä»¬ç°åœ¨æœ‰ä¸€å¼ ç”¨æˆ·æµè§ˆå¥½å‹è®°å½•çš„æ˜ç»†è¡¨<code>t_user_view</code>ï¼Œè¯¥è¡¨çš„è¡¨ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `t_user_view` (<br>  `id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) unsigned <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">&#x27;è‡ªå¢id&#x27;</span>,<br>  `user_id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;ç”¨æˆ·id&#x27;</span>,<br>  `viewed_user_id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;è¢«æŸ¥çœ‹ç”¨æˆ·id&#x27;</span>,<br>  `viewed_user_sex` tinyint(<span class="hljs-number">1</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;è¢«æŸ¥çœ‹ç”¨æˆ·æ€§åˆ«&#x27;</span>,<br>  `viewed_user_age` <span class="hljs-type">int</span>(<span class="hljs-number">5</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;è¢«æŸ¥çœ‹ç”¨æˆ·å¹´é¾„&#x27;</span>,<br>  `create_time` datetime(<span class="hljs-number">3</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>(<span class="hljs-number">3</span>),<br>  `update_time` datetime(<span class="hljs-number">3</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>(<span class="hljs-number">3</span>) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>(<span class="hljs-number">3</span>),<br>  <span class="hljs-keyword">PRIMARY</span> <span class="hljs-keyword">KEY</span> (`id`),<br>  <span class="hljs-keyword">UNIQUE</span> KEY `idx_user_viewed_user` (`user_id`,`viewed_user_id`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8;<br><br></code></pre></td></tr></table></figure><p>ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨SQLç»Ÿè®¡ï¼Œè§ä¸Šé¢çš„è¡¨ç»“æ„ï¼Œæˆ‘å†—ä½™äº†è¢«æŸ¥çœ‹ç”¨æˆ·çš„æ€§åˆ«å’Œå¹´é¾„å­—æ®µã€‚</p><p>æˆ‘ä»¬å†æ¥çœ‹çœ‹è¿™å¼ è¡¨é‡Œçš„è®°å½•ï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/95ce656e6ade41e992f24f54974e209c~tplv-k3u1fbpfcp-watermark.image" alt="image-20210321202431004.png"></p><p>ç°åœ¨ç»“åˆä¸Šé¢çš„è¡¨ç»“æ„å’Œè¡¨è®°å½•ï¼Œæˆ‘ä»¥<code>user_id=1</code>çš„ç”¨æˆ·ä¸ºä¾‹ï¼Œåˆ†ç»„ç»Ÿè®¡è¯¥ç”¨æˆ·æŸ¥çœ‹çš„å¹´é¾„åœ¨18 ~ 22ä¹‹é—´çš„å¥³æ€§ç”¨æˆ·çš„æ•°é‡ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> viewed_user_age <span class="hljs-keyword">as</span> age, <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">as</span> num <span class="hljs-keyword">FROM</span> t_user_view <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> viewed_user_age <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">18</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">22</span> <span class="hljs-keyword">AND</span> viewed_user_sex <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> viewed_user_age<br><br></code></pre></td></tr></table></figure><p>å¾—åˆ°ç»Ÿè®¡ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/a99d2932bcdb464a842f8bcfd98e0682~tplv-k3u1fbpfcp-watermark.image" alt="image-20210321172324495.png"></p><p>å¯è§ï¼š</p><ul><li>è¯¥ç”¨æˆ·æŸ¥çœ‹å¹´é¾„ä¸º18çš„å¥³æ€§ç”¨æˆ·æ•°ä¸º2</li><li>è¯¥ç”¨æˆ·æŸ¥çœ‹å¹´é¾„ä¸º19çš„å¥³æ€§ç”¨æˆ·æ•°ä¸º1</li><li>è¯¥ç”¨æˆ·æŸ¥çœ‹å¹´é¾„ä¸º20çš„å¥³æ€§ç”¨æˆ·æ•°ä¸º3</li></ul><p>æ‰€ä»¥ï¼Œ<code>user_id=1</code>çš„ç”¨æˆ·å¯¹å¹´é¾„ä¸º20çš„å¥³æ€§ç”¨æˆ·æ›´æ„Ÿå…´è¶£ï¼Œå¯ä»¥æ›´å¤šæ¨è20å²çš„å¥³æ€§ç”¨æˆ·ç»™ä»–ã€‚</p><blockquote><p>å¦‚æœæ­¤æ—¶ï¼Œ<code>t_user_view</code>è¿™å¼ è¡¨çš„è®°å½•æ•°è¾¾åˆ°åƒä¸‡è§„æ¨¡ï¼Œæƒ³å¿…è¿™æ¡SQLçš„æŸ¥è¯¢æ•ˆç‡ä¼šç›´çº¿ä¸‹é™ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿæœ‰ä»€ä¹ˆåŠæ³•ä¼˜åŒ–å‘¢ï¼Ÿ</p></blockquote><p>æƒ³è¦çŸ¥é“åŸå› ï¼Œä¸å¾—ä¸å…ˆçœ‹ä¸€ä¸‹è¿™æ¡SQLæ‰§è¡Œçš„è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ</p><h3 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h3><p>æˆ‘ä»¬å…ˆç”¨<code>explain</code>çœ‹ä¸€ä¸‹è¿™æ¡SQLï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">EXPLAIN <span class="hljs-keyword">SELECT</span> viewed_user_age <span class="hljs-keyword">as</span> age, <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">as</span> num <span class="hljs-keyword">FROM</span> t_user_view <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> viewed_user_age <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">18</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">22</span> <span class="hljs-keyword">AND</span> viewed_user_sex <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> viewed_user_age<br><br></code></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œä¸Šé¢çš„<code>explain</code>è¯­å¥ï¼Œæˆ‘ä»¬å¾—åˆ°å¦‚ä¸‹ç»“æœï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/6488bd6356e240f9b47040261a6798c4~tplv-k3u1fbpfcp-watermark.image" alt="image-20210321200747868.png"></p><p>åœ¨<code>Extra</code>è¿™ä¸€åˆ—ä¸­å‡ºç°äº†ä¸‰ä¸ª<code>Using</code>ï¼Œè¿™3ä¸ª<code>Using</code>ä»£è¡¨äº†ã€Šå¯¼è¯»ã€‹ä¸­çš„<code>groupBy</code>è¯­å¥åˆ†åˆ«ç»å†äº†3ä¸ªæ‰§è¡Œé˜¶æ®µï¼š</p><ol><li>Using whereï¼šé€šè¿‡æœç´¢å¯èƒ½çš„<code>idx_user_viewed_user</code>ç´¢å¼•æ ‘å®šä½åˆ°æ»¡è¶³éƒ¨åˆ†æ¡ä»¶çš„<code>viewed_user_id</code>ï¼Œç„¶åï¼Œå›è¡¨ç»§ç»­æŸ¥æ‰¾æ»¡è¶³å…¶ä»–æ¡ä»¶çš„è®°å½•</li><li>Using temporaryï¼šä½¿ç”¨ä¸´æ—¶è¡¨æš‚å­˜å¾…<code>groupBy</code>åˆ†ç»„åŠç»Ÿè®¡å­—æ®µä¿¡æ¯</li><li>Using filesortï¼šä½¿ç”¨<code>sort_buffer</code>å¯¹åˆ†ç»„å­—æ®µè¿›è¡Œæ’åº</li></ol><p>è¿™3ä¸ªé˜¶æ®µä¸­å‡ºç°äº†ä¸€ä¸ªåè¯ï¼š<code>ä¸´æ—¶è¡¨</code>ã€‚è¿™ä¸ªåè¯æˆ‘åœ¨ã€ŠMySQLåˆ†è¡¨æ—¶æœºï¼š100wï¼Ÿ300wï¼Ÿ500wï¼Ÿéƒ½å¯¹ä¹Ÿéƒ½ä¸å¯¹ï¼ã€‹ä¸€æ–‡ä¸­æœ‰è®²åˆ°ï¼Œè¿™æ˜¯MySQLè¿æ¥çº¿ç¨‹å¯ä»¥ç‹¬ç«‹è®¿é—®å’Œå¤„ç†çš„å†…å­˜åŒºåŸŸï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ªä¸´æ—¶è¡¨é•¿ä»€ä¹ˆæ ·å‘¢ï¼Ÿ</p><blockquote><p>ä¸‹é¢æˆ‘å°±å…ˆè®²è®²è¿™å¼ MySQLçš„ä¸´æ—¶è¡¨ï¼Œç„¶åï¼Œç»“åˆä¸Šé¢æåˆ°çš„3ä¸ªé˜¶æ®µï¼Œè¯¦ç»†è®²è§£ã€Šå¯¼è¯»ã€‹ä¸­SQLçš„æ‰§è¡Œè¿‡ç¨‹ã€‚</p></blockquote><h3 id="ä¸´æ—¶è¡¨"><a href="#ä¸´æ—¶è¡¨" class="headerlink" title="ä¸´æ—¶è¡¨"></a>ä¸´æ—¶è¡¨</h3><p>æˆ‘ä»¬è¿˜æ˜¯å…ˆçœ‹çœ‹ã€Šå¯¼è¯»ã€‹ä¸­çš„è¿™æ¡åŒ…å«<code>groupBy</code>è¯­å¥çš„SQLï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªåˆ†ç»„å­—æ®µ<code>viewed_user_age</code>å’Œä¸€ä¸ªç»Ÿè®¡å­—æ®µ<code>count(*)</code>ï¼Œè¿™ä¸¤ä¸ªå­—æ®µæ˜¯è¿™æ¡SQLä¸­ç»Ÿè®¡æ‰€éœ€çš„éƒ¨åˆ†ï¼Œå¦‚æœæˆ‘ä»¬è¦åšè¿™æ ·ä¸€ä¸ªç»Ÿè®¡å’Œåˆ†ç»„ï¼Œå¹¶æŠŠç»“æœå›ºåŒ–ä¸‹æ¥ï¼Œè‚¯å®šæ˜¯éœ€è¦ä¸€ä¸ªå†…å­˜æˆ–ç£ç›˜åŒºåŸŸè½ä¸‹ç¬¬ä¸€æ¬¡ç»Ÿè®¡çš„ç»“æœï¼Œç„¶åï¼Œä»¥è¿™ä¸ªç»“æœåšä¸‹ä¸€æ¬¡çš„ç»Ÿè®¡ï¼Œå› æ­¤ï¼Œåƒè¿™ç§å­˜å‚¨ä¸­é—´ç»“æœï¼Œå¹¶ä»¥æ­¤ç»“æœåšè¿›ä¸€æ­¥å¤„ç†çš„åŒºåŸŸï¼ŒMySQLå«å®ƒ<code>ä¸´æ—¶è¡¨</code>ã€‚</p><p>åˆšåˆšæåˆ°æ—¢å¯ä»¥å°†ä¸­é—´ç»“æœè½åœ¨å†…å­˜ï¼Œä¹Ÿå¯ä»¥å°†è¿™ä¸ªç»“æœè½åœ¨ç£ç›˜ï¼Œå› æ­¤ï¼Œåœ¨MySQLä¸­å°±å‡ºç°äº†ä¸¤ç§ä¸´æ—¶è¡¨ï¼š<code>å†…å­˜ä¸´æ—¶è¡¨</code>å’Œ<code>ç£ç›˜ä¸´æ—¶è¡¨</code>ã€‚</p><h4 id="å†…å­˜ä¸´æ—¶è¡¨"><a href="#å†…å­˜ä¸´æ—¶è¡¨" class="headerlink" title="å†…å­˜ä¸´æ—¶è¡¨"></a>å†…å­˜ä¸´æ—¶è¡¨</h4><p>ä»€ä¹ˆæ˜¯å†…å­˜ä¸´æ—¶è¡¨ï¼Ÿåœ¨æ—©æœŸæ•°æ®é‡ä¸æ˜¯å¾ˆå¤§çš„æ—¶å€™ï¼Œä»¥å­˜å‚¨åˆ†ç»„åŠç»Ÿè®¡å­—æ®µä¸ºä¾‹ï¼Œé‚£ä¹ˆï¼ŒåŸºæœ¬ä¸Šå†…å­˜å°±å¯ä»¥å®Œå…¨å­˜æ”¾ä¸‹åˆ†ç»„åŠç»Ÿè®¡å­—æ®µå¯¹åº”çš„æ‰€æœ‰å€¼ï¼Œè¿™ä¸ªå­˜æ”¾å¤§å°ç”±<code>tmp_table_size</code>å‚æ•°å†³å®šã€‚è¿™æ—¶å€™ï¼Œè¿™ä¸ªå­˜æ”¾å€¼çš„å†…å­˜åŒºåŸŸï¼ŒMySQLå°±å«å®ƒå†…å­˜ä¸´æ—¶è¡¨ã€‚</p><p>æ­¤æ—¶ï¼Œæˆ–è®¸ä½ å·²ç»è§‰å¾—MySQLå°†ä¸­é—´ç»“æœå­˜æ”¾åœ¨å†…å­˜ä¸´æ—¶è¡¨ï¼Œæ€§èƒ½å·²ç»æœ‰äº†ä¿éšœï¼Œä½†æ˜¯ï¼Œåœ¨ã€ŠMySQLåˆ†è¡¨æ—¶æœºï¼š100wï¼Ÿ300wï¼Ÿ500wï¼Ÿéƒ½å¯¹ä¹Ÿéƒ½ä¸å¯¹ï¼ã€‹ä¸­ï¼Œæˆ‘æåˆ°è¿‡å†…å­˜é¢‘ç¹çš„å­˜å–ä¼šäº§ç”Ÿç¢ç‰‡ï¼Œä¸ºæ­¤ï¼ŒMySQLè®¾è®¡äº†ä¸€å¥—æ–°çš„å†…å­˜åˆ†é…å’Œé‡Šæ”¾æœºåˆ¶ï¼Œå¯ä»¥å‡å°‘ç”šè‡³é¿å…ä¸´æ—¶è¡¨å†…å­˜ç¢ç‰‡ï¼Œæå‡å†…å­˜ä¸´æ—¶è¡¨çš„åˆ©ç”¨ç‡ã€‚</p><blockquote><p>æ­¤æ—¶ï¼Œä½ å¯èƒ½ä¼šæƒ³ï¼Œåœ¨ã€Šä¸ºä»€ä¹ˆæˆ‘è°ƒå¤§äº†sort_buffer_sizeï¼Œå¹¶å‘é‡ä¸€å¤§ï¼ŒæŸ¥è¯¢æ’åºæ…¢æˆç‹—ï¼Ÿã€‹ä¸€æ–‡ä¸­ï¼Œæˆ‘è®²äº†ç”¨æˆ·æ€çš„å†…å­˜åˆ†é…å™¨ï¼š<code>ptmalloc</code>å’Œ<code>tcmalloc</code>ï¼Œæ— è®ºæ˜¯å“ªä¸ªåˆ†é…å™¨ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯é¿å…ç”¨æˆ·è¿›ç¨‹é¢‘ç¹å‘Linuxå†…æ ¸ç”³è¯·å†…å­˜ç©ºé—´ï¼Œé€ æˆ<code>CPU</code>åœ¨ç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¹‹é—´é¢‘ç¹åˆ‡æ¢ï¼Œä»è€Œå½±å“å†…å­˜å­˜å–çš„æ•ˆç‡ã€‚ç”¨å®ƒä»¬å°±å¯ä»¥è§£å†³å†…å­˜åˆ©ç”¨ç‡çš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆMySQLè¿˜è¦è‡ªå·±æä¸€å¥—ï¼Ÿ</p></blockquote><p>æˆ–è®¸MySQLçš„ä½œè€…è§‰å¾—æ— è®ºå“ªä¸ªå†…å­˜åˆ†é…å™¨ï¼Œå®ƒçš„å®ç°éƒ½è¿‡äºå¤æ‚ï¼Œè¿™äº›å¤æ‚æ€§ä¼šå½±å“MySQLå¯¹äºå†…å­˜å¤„ç†çš„æ€§èƒ½ï¼Œå› æ­¤ï¼ŒMySQLè‡ªèº«åˆå®ç°äº†ä¸€å¥—å†…å­˜åˆ†é…æœºåˆ¶ï¼š<code>MEM_ROOT</code>ã€‚å®ƒçš„å†…å­˜å¤„ç†æœºåˆ¶ç›¸å¯¹æ¯”è¾ƒç®€å•ï¼Œå†…å­˜ä¸´æ—¶è¡¨çš„åˆ†é…å°±æ˜¯é‡‡ç”¨è¿™æ ·ä¸€ç§æ–¹å¼ã€‚</p><p>ä¸‹é¢ï¼Œæˆ‘å°±ä»¥ã€Šå¯¼è¯»ã€‹ä¸­çš„SQLä¸ºä¾‹ï¼Œè¯¦ç»†è®²è§£ä¸€ä¸‹åˆ†ç»„ç»Ÿè®¡æ˜¯å¦‚ä½•ä½¿ç”¨<code>MEM_ROOT</code>å†…å­˜åˆ†é…å’Œé‡Šæ”¾æœºåˆ¶çš„ï¼Ÿ</p><h5 id="MEM-ROOT"><a href="#MEM-ROOT" class="headerlink" title="MEM_ROOT"></a>MEM_ROOT</h5><p>æˆ‘ä»¬å…ˆçœ‹çœ‹<code>MEM_ROOT</code>çš„ç»“æ„ï¼Œ<code>MEM_ROOT</code>è®¾è®¡æ¯”è¾ƒç®€å•ï¼Œä¸»è¦åŒ…å«è¿™å‡ éƒ¨åˆ†ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/2a4a62d15071443a9ecfdd816a410da7~tplv-k3u1fbpfcp-watermark.image" alt="image-20210322205718291.png"></p><p>freeï¼šä¸€ä¸ªå•å‘é“¾è¡¨ï¼Œé“¾è¡¨ä¸­æ¯ä¸€ä¸ªå•å…ƒå«<code>block</code>ï¼Œ<code>block</code>ä¸­å­˜æ”¾çš„æ˜¯ç©ºé—²çš„å†…å­˜åŒºï¼Œæ¯ä¸ª<code>block</code>åŒ…å«3ä¸ªå…ƒç´ ï¼š</p><ul><li>leftï¼š<code>block</code>ä¸­å‰©ä½™çš„å†…å­˜å¤§å°</li><li>sizeï¼š<code>block</code>å¯¹åº”å†…å­˜çš„å¤§å°</li><li>nextï¼šæŒ‡å‘ä¸‹ä¸€ä¸ª<code>block</code>çš„æŒ‡é’ˆ</li></ul><p>å¦‚ä¸Šå›¾ï¼Œ<code>free</code>æ‰€åœ¨çš„è¡Œå°±æ˜¯ä¸€ä¸ª<code>free</code>é“¾è¡¨ï¼Œé“¾è¡¨ä¸­æ¯ä¸ªç®­å¤´ç›¸è¿çš„éƒ¨åˆ†å°±æ˜¯<code>block</code>ï¼Œ<code>block</code>ä¸­æœ‰<code>left</code>å’Œ            <code>size</code>ï¼Œæ¯ä¸ª<code>block</code>ä¹‹é—´çš„ç®­å¤´å°±æ˜¯<code>next</code>æŒ‡é’ˆ</p><p>usedï¼šä¸€ä¸ªå•å‘é“¾è¡¨ï¼Œé“¾è¡¨ä¸­æ¯ä¸€ä¸ªå•å…ƒå«<code>block</code>ï¼Œ<code>block</code>ä¸­å­˜æ”¾å·²ä½¿ç”¨çš„å†…å­˜åŒºï¼ŒåŒæ ·ï¼Œæ¯ä¸ª<code>block</code>åŒ…å«ä¸Šé¢3            ä¸ªå…ƒç´ </p><p>min_mallocï¼šæ§åˆ¶ä¸€ä¸ª <code>block</code> å‰©ä½™ç©ºé—´è¿˜æœ‰å¤šå°‘çš„æ—¶å€™ä»<code>free</code>é“¾è¡¨ç§»é™¤ï¼ŒåŠ å…¥åˆ°<code>used</code>é“¾è¡¨ä¸­</p><p>block_sizeï¼š<code>block</code>å¯¹åº”å†…å­˜çš„å¤§å°</p><p>block_numï¼š<code>MEM_ROOT</code> ç®¡ç†çš„<code>block</code>æ•°é‡</p><p>first_block_usageï¼š<code>free</code>é“¾è¡¨ä¸­ç¬¬ä¸€ä¸ª<code>block</code>ä¸æ»¡è¶³ç”³è¯·ç©ºé—´å¤§å°çš„æ¬¡æ•°</p><p>pre_allocï¼šå½“é‡Šæ”¾æ•´ä¸ª<code>MEM_ROOT</code>çš„æ—¶å€™å¯ä»¥é€šè¿‡å‚æ•°æ§åˆ¶ï¼Œé€‰æ‹©ä¿ç•™<code>pre_alloc</code>æŒ‡å‘çš„<code>block</code></p><p>ä¸‹é¢æˆ‘å°±ä»¥ã€Šå¯¼è¯»ã€‹ä¸­çš„åˆ†ç»„ç»Ÿè®¡SQLä¸ºä¾‹ï¼Œçœ‹ä¸€ä¸‹<code>MEM_ROOT</code>æ˜¯å¦‚ä½•åˆ†é…å†…å­˜çš„ï¼Ÿ</p><h6 id="åˆ†é…"><a href="#åˆ†é…" class="headerlink" title="åˆ†é…"></a>åˆ†é…</h6><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/ccf3e23603a54fb1a3b820835ead6bd7~tplv-k3u1fbpfcp-watermark.image" alt="image-20210326002410273.png"></p><ol><li><p>åˆå§‹åŒ–<code>MEM_ROOT</code>ï¼Œè§ä¸Šå›¾ï¼š</p><p><code>min_malloc = 32</code></p><p><code>block_num = 4</code></p><p><code>first_block_usage = 0</code></p><p><code>pre_alloc = 0</code></p><p><code>block_size = 1000</code></p><p><code>err_handler = 0</code></p><p><code>free = 0</code></p><p><code>used = 0</code></p></li><li><p>ç”³è¯·å†…å­˜ï¼Œè§ä¸Šå›¾ï¼š</p><p>ç”±äºåˆå§‹åŒ–<code>MEM_ROOT</code>æ—¶ï¼Œ<code>free = 0</code>ï¼Œè¯´æ˜<code>free</code>é“¾è¡¨ä¸å­˜åœ¨ï¼Œæ•…å‘Linuxå†…æ ¸ç”³è¯·4ä¸ªå¤§å°ä¸º<code>1000/4=250</code>çš„<code>block</code>ï¼Œæ„é€ ä¸€ä¸ª<code>free</code>é“¾è¡¨ï¼Œå¦‚ä¸Šå›¾ï¼Œé“¾è¡¨ä¸­åŒ…å«4ä¸ª<code>block</code> ï¼Œç»“åˆå‰é¢<code>free</code>é“¾è¡¨ç»“æ„çš„è¯´æ˜ï¼Œæ¯ä¸ª<code>block</code>ä¸­<code>size</code>ä¸º250ï¼Œ<code>left</code>ä¹Ÿä¸º250</p></li><li><p>åˆ†é…å†…å­˜ï¼Œè§ä¸Šå›¾ï¼š</p><p>(1) éå†<code>free</code>é“¾è¡¨ï¼Œä»<code>free</code>é“¾è¡¨å¤´éƒ¨å–å‡ºç¬¬ä¸€ä¸ª<code>block</code>ï¼Œå¦‚ä¸Šå›¾å‘ä¸‹çš„ç®­å¤´</p><p>(2) ä»å–å‡ºçš„<code>block</code>ä¸­åˆ’åˆ†<code>220</code>å¤§å°çš„å†…å­˜åŒºï¼Œå¦‚ä¸Šå›¾å‘å³çš„ç®­å¤´ä¸Šé¢<code>-220</code>ï¼Œ<code>block</code>ä¸­çš„<code>left</code>ä»<code>250</code>å˜æˆ<code>30</code></p><p>(3) å°†åˆ’åˆ†çš„<code>220</code>å¤§å°çš„å†…å­˜åŒºåˆ†é…ç»™SQLä¸­çš„<code>groupby</code>å­—æ®µ<code>viewed_user_age</code>å’Œç»Ÿè®¡å­—æ®µ<code>count(*)</code>ï¼Œç”¨äºåé¢çš„ç»Ÿè®¡åˆ†ç»„æ•°æ®æ”¶é›†åˆ°è¯¥å†…å­˜åŒº</p><p>(4) ç”±äºç¬¬(2)æ­¥ä¸­ï¼Œåˆ†é…åçš„<code>block</code>ä¸­çš„<code>left</code>å˜æˆ<code>30</code>ï¼Œ<code>30 &lt; 32</code>ï¼Œå³å°äºç¬¬(1)æ­¥ä¸­åˆå§‹åŒ–çš„<code>min_malloc</code>ï¼Œæ‰€ä»¥ï¼Œç»“åˆä¸Šé¢<code>min_malloc</code>çš„å«ä¹‰çš„è®²è§£ï¼Œè¯¥<code>block</code>å°†æ’å…¥<code>used</code>é“¾è¡¨å°¾éƒ¨ï¼Œå¦‚ä¸Šå›¾åº•éƒ¨ï¼Œç”±äº<code>used</code>é“¾è¡¨åœ¨ç¬¬(1)æ­¥åˆå§‹åŒ–æ—¶ä¸º0ï¼Œæ‰€ä»¥ï¼Œè¯¥<code>block</code>æ’å…¥<code>used</code>é“¾è¡¨çš„å°¾éƒ¨ï¼Œå³æ’å…¥å¤´éƒ¨</p></li></ol><h6 id="é‡Šæ”¾"><a href="#é‡Šæ”¾" class="headerlink" title="é‡Šæ”¾"></a>é‡Šæ”¾</h6><p>ä¸‹é¢è¿˜æ˜¯ä»¥ã€Šå¯¼è¯»ã€‹ä¸­çš„åˆ†ç»„ç»Ÿè®¡ä¸ºä¾‹ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹<code>MEM_ROOT</code>æ˜¯å¦‚ä½•é‡Šæ”¾å†…å­˜çš„ï¼Ÿ</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/b6569d6768e14a68a647161c0e6bea2c~tplv-k3u1fbpfcp-watermark.image" alt="image-20210323233158459.png"></p><p>å¦‚ä¸Šå›¾ï¼Œ<code>MEM_ROOT</code>é‡Šæ”¾å†…å­˜çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li>éå†<code>used</code>é“¾è¡¨ä¸­ï¼Œæ‰¾åˆ°éœ€è¦é‡Šæ”¾çš„<code>block</code>ï¼Œå¦‚ä¸Šå›¾ï¼Œ<code>block(30,250)</code>ä¸ºä¹‹å‰å·²åˆ†é…ç»™åˆ†ç»„ç»Ÿè®¡ç”¨çš„<code>block</code></li><li>å°†<code>block(30,250)</code>ä¸­çš„<code>left + 220</code>ï¼Œå³<code>30 + 220 = 250</code>ï¼Œé‡Šæ”¾è¯¥<code>block</code>å·²ä½¿ç”¨çš„<code>220</code>å¤§å°çš„å†…å­˜åŒºï¼Œå¾—åˆ°é‡Šæ”¾åçš„<code>block(250,250)</code></li><li>å°†<code>block(250,250)</code>æ’å…¥<code>free</code>é“¾è¡¨å°¾éƒ¨ï¼Œå¦‚ä¸Šå›¾æ›²çº¿ç®­å¤´éƒ¨åˆ†</li></ol><p>é€šè¿‡<code>MEM_ROOT</code>å†…å­˜åˆ†é…å’Œé‡Šæ”¾çš„è®²è§£ï¼Œæˆ‘ä»¬å‘ç°<code>MEM_ROOT</code>çš„å†…å­˜ç®¡ç†æ–¹å¼æ˜¯åœ¨æ¯ä¸ª<code>Block</code>ä¸Šè¿ç»­åˆ†é…ï¼Œå†…éƒ¨ç¢ç‰‡åŸºæœ¬åœ¨æ¯ä¸ª<code>Block</code>çš„å°¾éƒ¨ï¼Œç”±<code>min_malloc</code>æˆå‘˜å˜é‡æ§åˆ¶ï¼Œä½†æ˜¯<code>min_malloc</code>çš„å€¼æ˜¯åœ¨ä»£ç ä¸­å†™æ­»çš„ï¼Œæœ‰ç‚¹ä¸å¤Ÿçµæ´»ã€‚æ‰€ä»¥ï¼Œå¯¹ä¸€ä¸ª<code>block</code>æ¥è¯´ï¼Œå½“<code>left</code>å°äº<code>min_malloc</code>ï¼Œä»å…¶ç”³è¯·çš„å†…å­˜è¶Šå¤§ï¼Œé‚£ä¹ˆ<code>block</code>ä¸­çš„<code>left</code>å€¼è¶Šå°ï¼Œé‚£ä¹ˆï¼Œè¯¥<code>block</code>çš„å†…å­˜åˆ©ç”¨ç‡è¶Šé«˜ï¼Œç¢ç‰‡è¶Šå°‘ï¼Œåä¹‹ï¼Œç¢ç‰‡è¶Šå¤šã€‚è¿™ä¸ªå†™æ­»æ˜¯MySQLçš„å†…å­˜åˆ†é…çš„ä¸€ä¸ªç¼ºé™·ã€‚</p><h4 id="ç£ç›˜ä¸´æ—¶è¡¨"><a href="#ç£ç›˜ä¸´æ—¶è¡¨" class="headerlink" title="ç£ç›˜ä¸´æ—¶è¡¨"></a>ç£ç›˜ä¸´æ—¶è¡¨</h4><p>å½“åˆ†ç»„åŠç»Ÿè®¡å­—æ®µå¯¹åº”çš„æ‰€æœ‰å€¼å¤§å°è¶…è¿‡<code>tmp_table_size</code>å†³å®šçš„å€¼ï¼Œé‚£ä¹ˆï¼ŒMySQLå°†ä½¿ç”¨ç£ç›˜æ¥å­˜å‚¨è¿™äº›å€¼ã€‚è¿™ä¸ªå­˜æ”¾å€¼çš„ç£ç›˜åŒºåŸŸï¼ŒMySQLå«å®ƒç£ç›˜ä¸´æ—¶è¡¨ã€‚</p><p>æˆ‘ä»¬éƒ½çŸ¥é“ç£ç›˜å­˜å–çš„æ€§èƒ½ä¸€å®šæ¯”å†…å­˜å­˜å–çš„æ€§èƒ½å·®å¾ˆå¤šï¼Œå› ä¸ºä¼šäº§ç”Ÿç£ç›˜IOï¼Œæ‰€ä»¥ï¼Œä¸€æ—¦åˆ†ç»„åŠç»Ÿè®¡å­—æ®µä¸å¾—ä¸å†™å…¥ç£ç›˜ï¼Œé‚£æ€§èƒ½ç›¸å¯¹æ˜¯å¾ˆå·®çš„ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å°½é‡è°ƒå¤§å‚æ•°<code>tmp_table_size</code>ï¼Œä½¿å¾—ç»„åŠç»Ÿè®¡å­—æ®µå¯ä»¥åœ¨å†…å­˜ä¸´æ—¶è¡¨ä¸­å¤„ç†ã€‚</p><h3 id="æ‰§è¡Œè¿‡ç¨‹"><a href="#æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="æ‰§è¡Œè¿‡ç¨‹"></a>æ‰§è¡Œè¿‡ç¨‹</h3><p>æ— è®ºæ˜¯ä½¿ç”¨å†…å­˜ä¸´æ—¶è¡¨ï¼Œè¿˜æ˜¯ç£ç›˜ä¸´æ—¶è¡¨ï¼Œä¸´æ—¶è¡¨å¯¹ç»„åŠç»Ÿè®¡å­—æ®µçš„å¤„ç†çš„æ–¹å¼éƒ½æ˜¯ä¸€æ ·çš„ã€‚ã€Šå¯¼è¯»ã€‹ä¸­æˆ‘æåˆ°æƒ³è¦ä¼˜åŒ–ã€Šå¯¼è¯»ã€‹ä¸­çš„é‚£æ¡SQLï¼Œå°±éœ€è¦çŸ¥é“SQLæ‰§è¡Œçš„åŸç†ï¼Œæ‰€ä»¥ï¼Œä¸‹é¢æˆ‘å°±ç»“åˆä¸Šé¢è®²è§£çš„ä¸´æ—¶è¡¨çš„æ¦‚å¿µï¼Œè¯¦ç»†è®²è®²è¿™æ¡SQLçš„æ‰§è¡Œè¿‡ç¨‹ï¼Œè§ä¸‹å›¾ï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/3598cf4798b84fa0ad04348bc69db486~tplv-k3u1fbpfcp-watermark.image" alt="image-20210326002155314.png"></p><ol><li><p>åˆ›å»ºä¸´æ—¶è¡¨<code>temporary</code>ï¼Œè¡¨é‡Œæœ‰ä¸¤ä¸ªå­—æ®µ<code>viewed_user_age</code>å’Œ<code>count(*)</code>ï¼Œä¸»é”®æ˜¯<code>viewed_user_age</code>ï¼Œå¦‚ä¸Šå›¾ï¼Œå€’æ•°ç¬¬äºŒä¸ªæ¡†<code>temporary</code>è¡¨ç¤ºä¸´æ—¶è¡¨ï¼Œæ¡†ä¸­åŒ…å«ä¸¤ä¸ªå­—æ®µ<code>viewed_user_age</code>å’Œ<code>count(*)</code>ï¼Œæ¡†å†…å°±æ˜¯è¿™ä¸¤ä¸ªå­—æ®µå¯¹åº”çš„å€¼ï¼Œå…¶ä¸­<code>viewed_user_age</code>å°±æ˜¯è¿™å¼ ä¸´æ—¶è¡¨çš„ä¸»é”®</p></li><li><p>æ‰«æè¡¨è¾…åŠ©ç´¢å¼•æ ‘<code>idx_user_viewed_user</code>ï¼Œä¾æ¬¡å–å‡ºå¶å­èŠ‚ç‚¹ä¸Šçš„<code>id</code>å€¼ï¼Œå³ä»ç´¢å¼•æ ‘å¶å­èŠ‚ç‚¹ä¸­å–åˆ°è¡¨çš„ä¸»é”®idã€‚å¦‚ä¸Šå›¾ä¸­çš„<code>idx_user_viewed_user</code>æ¡†å°±æ˜¯ç´¢å¼•æ ‘ï¼Œæ¡†å³ä¾§çš„ç®­å¤´è¡¨ç¤ºå–åˆ°è¡¨çš„ä¸»é”®id</p></li><li><p>æ ¹æ®ä¸»é”®idåˆ°èšç°‡ç´¢å¼•<code>cluster_index</code>çš„å¶å­èŠ‚ç‚¹ä¸­æŸ¥æ‰¾è®°å½•ï¼Œå³æ‰«æ<code>cluster_index</code>å¶å­èŠ‚ç‚¹ï¼š</p><p>(1) å¾—åˆ°ä¸€æ¡è®°å½•ï¼Œç„¶åå–åˆ°è®°å½•ä¸­çš„<code>viewed_user_age</code>å­—æ®µå€¼ã€‚å¦‚ä¸Šå›¾ï¼Œ<code>cluster_index</code>æ¡†ï¼Œæ¡†ä¸­æœ€å³è¾¹çš„ä¸€åˆ—å°±æ˜¯<code>viewed_user_age</code>å­—æ®µçš„å€¼</p><p>(2) å¦‚æœä¸´æ—¶è¡¨ä¸­æ²¡æœ‰ä¸»é”®ä¸º<code>viewed_user_age</code>çš„è¡Œï¼Œå°±æ’å…¥ä¸€æ¡è®°å½• (<code>viewed_user_age</code>, 1)ã€‚å¦‚ä¸Šå›¾çš„<code>temporary</code>æ¡†ï¼Œå…¶å·¦ä¾§ç®­å¤´è¡¨ç¤ºå°†<code>cluster_index</code>æ¡†ä¸­çš„<code>viewed_user_age</code>å­—æ®µå€¼å†™å…¥<code>temporary</code>ä¸´æ—¶è¡¨</p><p>(3) å¦‚æœä¸´æ—¶è¡¨ä¸­æœ‰ä¸»é”®ä¸º<code>viewed_user_age</code>çš„è¡Œï¼Œå°±å°†<code>viewed_user_age</code>è¿™ä¸€è¡Œçš„<code>count(*)</code>å€¼åŠ  1ã€‚å¦‚ä¸Šå›¾çš„<code>temporary</code>æ¡†</p></li><li><p>éå†å®Œæˆåï¼Œå†æ ¹æ®å­—æ®µ<code>viewed_user_age</code>åœ¨<code>sort_buffer</code>ä¸­åšæ’åºï¼Œå¾—åˆ°ç»“æœé›†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚å¦‚ä¸Šå›¾ä¸­çš„æœ€å³è¾¹çš„ç®­å¤´ï¼Œè¡¨ç¤ºå°†<code>temporary</code>æ¡†ä¸­çš„<code>viewed_user_age</code>å’Œ<code>count(*)</code>çš„å€¼å†™å…¥<code>sort_buffer</code>ï¼Œç„¶åï¼Œåœ¨<code>sort_buffer</code>ä¸­æŒ‰<code>viewed_user_age</code>å­—æ®µè¿›è¡Œæ’åº</p></li></ol><blockquote><p>é€šè¿‡ã€Šå¯¼è¯»ã€‹ä¸­çš„SQLçš„æ‰§è¡Œè¿‡ç¨‹çš„è®²è§£ï¼Œæˆ‘ä»¬å‘ç°è¯¥è¿‡ç¨‹ç»å†äº†4ä¸ªéƒ¨åˆ†ï¼š<code>idx_user_viewed_user</code>ã€<code>cluster_index</code>ã€<code>temporary</code>å’Œ<code>sort_buffer</code>ï¼Œå¯¹æ¯”ä¸Šé¢<code>explain</code>çš„ç»“æœï¼Œå…¶ä¸­å‰2ä¸ªå°±å¯¹åº”ç»“æœä¸­çš„<code>Using where</code>ï¼Œ<code>temporary</code>å¯¹åº”çš„æ˜¯<code>Using temporary</code>ï¼Œ<code>sort_buffer</code>å¯¹åº”çš„æ˜¯<code>Using filesort</code>ã€‚</p></blockquote><h3 id="ä¼˜åŒ–æ–¹æ¡ˆ"><a href="#ä¼˜åŒ–æ–¹æ¡ˆ" class="headerlink" title="ä¼˜åŒ–æ–¹æ¡ˆ"></a>ä¼˜åŒ–æ–¹æ¡ˆ</h3><p>æ­¤æ—¶ï¼Œæˆ‘ä»¬æœ‰ä»€ä¹ˆåŠæ³•ä¼˜åŒ–è¿™æ¡SQLå‘¢ï¼Ÿ</p><blockquote><p>æ—¢ç„¶è¿™æ¡SQLæ‰§è¡Œéœ€è¦ç»å†4ä¸ªéƒ¨åˆ†ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä¸å¯ä»¥å»æ‰æœ€åä¸¤éƒ¨åˆ†å‘¢ï¼Œå³å»æ‰<code>temporary</code>å’Œ<code>sort_buffer</code>ï¼Ÿ</p></blockquote><p>ç­”æ¡ˆæ˜¯å¯ä»¥çš„ï¼Œæˆ‘ä»¬åªè¦ç»™SQLä¸­çš„è¡¨<code>t_user_view</code>æ·»åŠ å¦‚ä¸‹ç´¢å¼•ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> `t_user_view` <span class="hljs-keyword">ADD</span> INDEX `idx_user_age_sex` (`user_id`, `viewed_user_age`, `viewed_user_sex`);<br><br></code></pre></td></tr></table></figure><p>ä½ å¯ä»¥è‡ªå·±å°è¯•ä¸€ä¸‹å“¦ï¼ç”¨<code>explain</code>åº·åº·æœ‰ä»€ä¹ˆæ”¹å˜ï¼</p><h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>æœ¬ç« å›´ç»•ã€Šå¯¼è¯»ã€‹ä¸­çš„åˆ†ç»„ç»Ÿè®¡SQLï¼Œé€šè¿‡<code>explain</code>åˆ†æSQLçš„æ‰§è¡Œé˜¶æ®µï¼Œç»“åˆä¸´æ—¶è¡¨çš„ç»“æ„ï¼Œè¿›ä¸€æ­¥å‰–æäº†SQLçš„è¯¦ç»†æ‰§è¡Œè¿‡ç¨‹ï¼Œæœ€åï¼Œå¼•å‡ºä¼˜åŒ–æ–¹æ¡ˆï¼š<strong>æ–°å¢ç´¢å¼•ï¼Œé¿å…ä¸´æ—¶è¡¨å¯¹åˆ†ç»„å­—æ®µçš„ç»Ÿè®¡ï¼ŒåŠ<code>sort_buffer</code>å¯¹åˆ†ç»„å’Œç»Ÿè®¡å­—æ®µæ’åº</strong>ã€‚</p><p>å½“ç„¶ï¼Œå¦‚æœå®åœ¨æ— æ³•é¿å…ä½¿ç”¨ä¸´æ—¶è¡¨ï¼Œé‚£ä¹ˆï¼Œ<strong>å°½é‡è°ƒå¤§<code>tmp_table_size</code>ï¼Œé¿å…ä½¿ç”¨ç£ç›˜ä¸´æ—¶è¡¨ç»Ÿè®¡åˆ†ç»„å­—æ®µã€‚</strong></p><h3 id="æ€è€ƒé¢˜"><a href="#æ€è€ƒé¢˜" class="headerlink" title="æ€è€ƒé¢˜"></a>æ€è€ƒé¢˜</h3><p>ä¸ºä»€ä¹ˆæ–°å¢äº†ç´¢å¼•<code>idx_user_age_sex</code>å¯ä»¥é¿å…ä¸´æ—¶è¡¨å¯¹åˆ†ç»„å­—æ®µçš„ç»Ÿè®¡ï¼ŒåŠ<code>sort_buffer</code>å¯¹åˆ†ç»„å’Œç»Ÿè®¡å­—æ®µæ’åºï¼Ÿ</p><p>æç¤ºï¼šç»“åˆç´¢å¼•æŸ¥æ‰¾çš„åŸç†ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>mysql</tag>
      
      <tag>ä¼˜åŒ–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åœ¨é¡¹ç›®ä¸­å®ç°å¤šæ•°æ®æºåˆ‡æ¢</title>
    <link href="/blog/2021/04/24/%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%AE%9E%E7%8E%B0%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%BA%90%E5%88%87%E6%8D%A2/"/>
    <url>/blog/2021/04/24/%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%AE%9E%E7%8E%B0%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%BA%90%E5%88%87%E6%8D%A2/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ï¼‰åœºæ™¯"><a href="#ä¸€ï¼‰åœºæ™¯" class="headerlink" title="(ä¸€ï¼‰åœºæ™¯"></a>(ä¸€ï¼‰åœºæ™¯</h1><p>åœ¨å®é™…çš„åº”ç”¨åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°ä¸€ä¸ªç³»ç»Ÿè¦è°ƒç”¨å¤šä¸ªæ•°æ®æºçš„æƒ…å†µã€‚å¯èƒ½æ˜¯åŒä¸€ä¸ªmysqlçš„ä¸åŒåº“ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ä»ä¸åŒçš„mysqlä¸­è°ƒç”¨æ•°æ®è¿›è¡Œä½¿ç”¨ã€‚è¿™é‡Œæä¾›ä¸€ç§ååˆ†é«˜æ•ˆçš„å¤šæ•°æ®æºåˆ‡æ¢æ¡†æ¶â€”<strong>dynamicdatasource</strong></p><h1 id="ï¼ˆäºŒï¼‰ä»‹ç»ä¸€ä¸‹è¿™ä¸ªæ¡†æ¶"><a href="#ï¼ˆäºŒï¼‰ä»‹ç»ä¸€ä¸‹è¿™ä¸ªæ¡†æ¶" class="headerlink" title="ï¼ˆäºŒï¼‰ä»‹ç»ä¸€ä¸‹è¿™ä¸ªæ¡†æ¶"></a>ï¼ˆäºŒï¼‰ä»‹ç»ä¸€ä¸‹è¿™ä¸ªæ¡†æ¶</h1><p>dynamicdatasourceå…¶å®æ˜¯Mybatis-plusç”Ÿæ€åœˆä¸­çš„å…¶ä¸­ä¸€ä¸ªæ¡†æ¶ï¼Œæ¥è‡ªç äº‘çŸ¥åå¼€æºé¡¹ç›® Mybatis-Plus è¿è¥ç»„ç»‡ï¼Œè¿™ä¸ªç»„ç»‡è¿˜æœ‰ä¸ªå¥‡æ€ªçš„åå­—å«åšè‹ç±³è±†ã€‚è¿™æ˜¯ä¸ªæŒºæœ‰ä¼ å¥‡è‰²å½©çš„ç»„ç»‡ï¼Œå¤§å®¶æœ‰å…´è¶£å¯ä»¥äº†è§£ä¸€ä¸‹ã€‚</p><h1 id="ï¼ˆä¸‰ï¼‰å¼€å§‹ä½¿ç”¨"><a href="#ï¼ˆä¸‰ï¼‰å¼€å§‹ä½¿ç”¨" class="headerlink" title="ï¼ˆä¸‰ï¼‰å¼€å§‹ä½¿ç”¨"></a>ï¼ˆä¸‰ï¼‰å¼€å§‹ä½¿ç”¨</h1><h2 id="3-1-æ­å»ºé¡¹ç›®"><a href="#3-1-æ­å»ºé¡¹ç›®" class="headerlink" title="3.1 æ­å»ºé¡¹ç›®"></a>3.1 æ­å»ºé¡¹ç›®</h2><p>è¿™ä¸€æ­¥å°±ä¸éœ€è¦å¤šæäº†ï¼Œæ­å»ºä¸€ä¸ªSpringbooté¡¹ç›®å³å¯ï¼Œå¼•å…¥åŸºç¡€çš„webä¾èµ–ã€‚</p><h2 id="3-2-å¼•å…¥ä¾èµ–"><a href="#3-2-å¼•å…¥ä¾èµ–" class="headerlink" title="3.2 å¼•å…¥ä¾èµ–"></a>3.2 å¼•å…¥ä¾èµ–</h2><p>åŠ¨æ€æ•°æ®æºçš„æ ¸å¿ƒä¾èµ–æ˜¯ä¸‹é¢è¿™ä¸ªï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependency&gt;<br>    &lt;groupId&gt;com.baomidou&lt;/groupId&gt;<br>    &lt;artifactId&gt;dynamic-datasource-spring-boot-starter&lt;/artifactId&gt;<br>    &lt;version&gt;3.1.0&lt;/version&gt;<br>&lt;/dependency&gt;<br><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬è‡ªå·±å†å¼•å…¥JDBCä¸‰ä»¶å¥—</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependency&gt;<br>    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>    &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;mysql&lt;/groupId&gt;<br>    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;<br>    &lt;scope&gt;runtime&lt;/scope&gt;<br>&lt;/dependency&gt;<br>&lt;!-- https:<span class="hljs-comment">//mvnrepository.com/artifact/org.mybatis.spring.boot/mybatis-spring-boot-starter --&gt;</span><br>&lt;dependency&gt;<br>    &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;<br>    &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;<br>    &lt;version&gt;2.1.3&lt;/version&gt;<br>&lt;/dependency&gt;<br><br></code></pre></td></tr></table></figure><h2 id="3-3-é…ç½®æ–‡ä»¶ç¼–å†™"><a href="#3-3-é…ç½®æ–‡ä»¶ç¼–å†™" class="headerlink" title="3.3 é…ç½®æ–‡ä»¶ç¼–å†™"></a>3.3 é…ç½®æ–‡ä»¶ç¼–å†™</h2><p>åœ¨ä»¥å‰ä½¿ç”¨Mybatisçš„æ—¶å€™ï¼Œæˆ‘ä»¬åªèƒ½é…ç½®ä¸€ä¸ªæ•°æ®æºï¼Œç°åœ¨å¯ä»¥é€šè¿‡åŠ¨æ€æ•°æ®æºçš„æ–¹å¼é…ç½®å¤šä¸ªæ•°æ®æºã€‚</p><p>å…¶ä¸­primaryè¡¨ç¤ºé»˜è®¤çš„æ•°æ®æºï¼Œstrictè¡¨ç¤ºè®¾ç½®ä¸¥æ ¼æ¨¡å¼,é»˜è®¤falseä¸å¯åŠ¨. å¯åŠ¨ååœ¨æœªåŒ¹é…åˆ°æŒ‡å®šæ•°æ®æºæ—¶å€™ä¼šæŠ›å‡ºå¼‚å¸¸,ä¸å¯åŠ¨åˆ™ä½¿ç”¨é»˜è®¤æ•°æ®æºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java">spring:<br>  datasource:<br>    dynamic:<br>      primary: master<br>      strict: <span class="hljs-keyword">false</span><br>      datasource:<br>        master:<br>          url: jdbc:mysql:<span class="hljs-comment">//localhost:3306/student</span><br>          username: root<br>          password: <span class="hljs-number">123456</span><br>          driver-class-name: com.mysql.jdbc.Driver<br>        slave:<br>          url: jdbc:mysql:<span class="hljs-comment">//localhost:3306/books</span><br>          username: root<br>          password: <span class="hljs-number">123456</span><br>          driver-class-name: com.mysql.jdbc.Driver<br><br></code></pre></td></tr></table></figure><h2 id="3-4-ä»£ç ä¸­åˆ‡æ¢æ•°æ®æº"><a href="#3-4-ä»£ç ä¸­åˆ‡æ¢æ•°æ®æº" class="headerlink" title="3.4 ä»£ç ä¸­åˆ‡æ¢æ•°æ®æº"></a>3.4 ä»£ç ä¸­åˆ‡æ¢æ•°æ®æº</h2><p>é€šè¿‡ä¸€ä¸ªæ³¨è§£å°±å¯ä»¥è½»æ¾åˆ‡æ¢æ•°æ®æºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-meta">@DS(&quot;master&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestService</span> </span>&#123;<br>    <span class="hljs-meta">@Autowired(required = false)</span><br>    <span class="hljs-keyword">private</span> BookMapper bookMapper;<br>    <span class="hljs-meta">@Autowired(required = false)</span><br>    <span class="hljs-keyword">private</span> StudentMapper studentMapper;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getName</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span> studentMapper.getNameById(<span class="hljs-string">&quot;1&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@DS(&quot;slave&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getBookName</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span> bookMapper.getBookNameById(<span class="hljs-string">&quot;1&quot;</span>);<br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><p>é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥ç»™ä¸€ä¸ªæ–¹æ³•è®¾ç½®æ•°æ®æºï¼Œåœ¨å†…éƒ¨çš„æ–¹æ³•ä¸­ä¹Ÿå¯ä»¥é€šè¿‡DSæ³¨è§£åˆ‡æ¢æ•°æ®æºï¼Œä¸ç”¨æ‹…å¿ƒåµŒå¥—çš„é—®é¢˜ã€‚</p><h1 id="ï¼ˆå››ï¼‰å®Œæ•´é¡¹ç›®"><a href="#ï¼ˆå››ï¼‰å®Œæ•´é¡¹ç›®" class="headerlink" title="ï¼ˆå››ï¼‰å®Œæ•´é¡¹ç›®"></a>ï¼ˆå››ï¼‰å®Œæ•´é¡¹ç›®</h1><p>é¦–å…ˆæˆ‘å»ºäº†ä¸¤ä¸ªåº“ï¼Œä¸€ä¸ªå«studentã€å¦ä¸€ä¸ªå«books</p><p>studentåº“ä¸­æœ‰ä¸ªstudentè¡¨ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `student` (<br>  `id` <span class="hljs-type">int</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>  `name` <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `grade` <span class="hljs-type">int</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  <span class="hljs-keyword">PRIMARY</span> <span class="hljs-keyword">KEY</span> (`id`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8;<br><br></code></pre></td></tr></table></figure><p>booksåº“ä¸­æœ‰ä¸ªbookè¡¨ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `book` (<br>  `ID` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `BOOKISBN` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `BOOKNAME` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `AUTHOR` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `PRICE` <span class="hljs-keyword">double</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `TYPEID` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `PUBLISHER` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  <span class="hljs-keyword">PRIMARY</span> <span class="hljs-keyword">KEY</span> (`ID`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB  <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8;<br><br></code></pre></td></tr></table></figure><p>é¡¹ç›®ç»“æ„å¾ˆç®€å•ï¼š <img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/10af7580387444c48cba879449bc7475~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>é¦–å…ˆæ˜¯ä¸¤ä¸ªMapperæ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Mapper</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">BookMapper</span> </span>&#123;<br>    <span class="hljs-meta">@Select(&quot;select bookname from book where id=#&#123;id&#125;&quot;)</span><br>    <span class="hljs-function">String <span class="hljs-title">getBookNameById</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;id&quot;)</span> String id)</span></span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>StudentMapper ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Mapper</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">StudentMapper</span> </span>&#123;<br>    <span class="hljs-meta">@Select(&quot;select name from student where id=#&#123;id&#125;&quot;)</span><br>    <span class="hljs-function">String <span class="hljs-title">getNameById</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;id&quot;)</span> String id)</span></span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ç„¶åæ˜¯ä¸€ä¸ªservice</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-variable">@Service</span><br><span class="hljs-variable">@DS</span>(&quot;master&quot;)<br>public class TestService &#123;<br>    <span class="hljs-variable">@Autowired</span>(required <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>)<br>    private BookMapper bookMapper;<br>    <span class="hljs-variable">@Autowired</span>(required <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>)<br>    private StudentMapper studentMapper;<br>    public String getName()&#123;<br>        <span class="hljs-keyword">return</span> studentMapper.getNameById(&quot;1&quot;);<br>    &#125;<br>    <span class="hljs-variable">@DS</span>(&quot;slave&quot;)<br>    public String getBookName()&#123;<br>        <span class="hljs-keyword">return</span> bookMapper.getBookNameById(&quot;1&quot;);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>æœ€åcontrollerè°ƒç”¨ä¸€ä¸‹Service</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-variable">@RestController</span><br>public class IndexController &#123;<br>    <span class="hljs-variable">@Autowired</span><br>    private TestService testService;<br>    <span class="hljs-variable">@GetMapping</span>(&quot;index&quot;)<br>    public String index()&#123;<br>        String studentName <span class="hljs-operator">=</span> testService.getName();<br>        String bookName <span class="hljs-operator">=</span> testService.getBookName();<br>        <span class="hljs-keyword">return</span> studentName<span class="hljs-operator">+</span>bookName;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>å¯åŠ¨ç±»ä¸­æ‰«æä¸€ä¸‹Mapper</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-variable">@SpringBootApplication</span><br><span class="hljs-variable">@MapperScan</span>(&quot;com.javayz.mybatisplus.mapper&quot;)<br>public class MybatisplusApplication &#123;<br>    public static void main(String[] args) &#123;<br>        SpringApplication.run(MybatisplusApplication.class, args);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>è¿™æ ·ä¸€ä¸ªç®€å•çš„é¡¹ç›®å°±æ­å»ºå®Œæˆäº†ï¼Œè®¿é—®ä¸€ä¸‹/indexï¼Œå°±å¯ä»¥å‘ç°ä¸¤ä¸ªæ•°æ®æºä¸­çš„æ•°æ®éƒ½è¢«æå–å‡ºæ¥äº†ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>å¤šæ•°æ®</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java8ä¸­çš„Lambdaè¡¨è¾¾å¼</title>
    <link href="/blog/2021/04/17/Java8%E4%B8%AD%E7%9A%84Lambda%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
    <url>/blog/2021/04/17/Java8%E4%B8%AD%E7%9A%84Lambda%E8%A1%A8%E8%BE%BE%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>Lambdaè¡¨è¾¾å¼æ˜¯ä¸€ä¸ªå¯ä¼ é€’çš„ä»£ç å—ï¼Œå¯ä»¥åœ¨ä»¥åæ‰§è¡Œä¸€æ¬¡æˆ–å¤šæ¬¡ï¼›</p><p>ä¸‹é¢è´´ä¸ªå¯¹æ¯”ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Java8ä¹‹å‰ï¼šæ—§çš„å†™æ³•</span><br>Runnable runnable = <span class="hljs-keyword">new</span> Runnable() &#123;<br>  <span class="hljs-meta">@Override</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>    System.out.println(<span class="hljs-string">&quot;old run&quot;</span>);<br>  &#125;<br>&#125;;<br>Thread t = <span class="hljs-keyword">new</span> Thread(runnable);<br><br><span class="hljs-comment">// Java8ä¹‹åï¼šæ–°çš„å†™æ³•</span><br>Runnable runnable1 = ()-&gt;&#123;<br>  System.out.println(<span class="hljs-string">&quot;lambda run&quot;</span>);<br>&#125;;<br>Thread t1 = <span class="hljs-keyword">new</span> Thread(runnable1);<br><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæœ‰äº†lambdaï¼Œä»£ç å˜å¾—ç®€æ´å¤šäº†</p><p>ä½ å¯ä»¥æŠŠlambdaå½“ä½œä¸€ä¸ªè¯­æ³•ç³–</p><p>ä¸‹é¢è®©æˆ‘ä»¬ä¸€èµ·æ¥æ¢ç´¢lambdaçš„ç¾å¥½ä¸–ç•Œå§</p><h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h2><p>ä¸‹é¢åˆ—å‡ºæœ¬æ–‡çš„ç›®å½•</p><ul><li>lambdaçš„è¯­æ³•</li><li>ä¸ºå•¥å¼•å…¥lambda</li><li>ä»€ä¹ˆæ˜¯å‡½æ•°å¼æ¥å£</li><li>ä»€ä¹ˆæ˜¯è¡Œä¸ºå‚æ•°åŒ–</li><li>æ‰‹å†™ä¸€ä¸ªå‡½æ•°å¼æ¥å£</li><li>å¸¸ç”¨çš„å‡½æ•°å¼æ¥å£</li><li>ä»€ä¹ˆæ˜¯æ–¹æ³•å¼•ç”¨</li><li>ä»€ä¹ˆæ˜¯æ„é€ å¼•ç”¨</li><li>lambdaçš„ç»„åˆæ“ä½œ</li></ul><h2 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h2><h3 id="1-lambdaçš„è¯­æ³•"><a href="#1-lambdaçš„è¯­æ³•" class="headerlink" title="1. lambdaçš„è¯­æ³•"></a>1. lambdaçš„è¯­æ³•</h3><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/4af8cc96a8b940c78d041f470e4da014~tplv-k3u1fbpfcp-zoom-1.image" alt="lambdaè¯­æ³•"></p><p>ä¸‹é¢åˆ†åˆ«è¯´ä¸‹è¯­æ³•ä¸­çš„ä¸‰ä¸ªç»„æˆéƒ¨åˆ†</p><ul><li><p>å‚æ•°: </p><figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs clojure">( Dog dog )<br></code></pre></td></tr></table></figure><ul><li>å‚æ•°ç±»å‹å¯çœç•¥ï¼ˆå½“ç¼–è¯‘å™¨å¯ä»¥è‡ªåŠ¨æ¨å¯¼æ—¶ï¼‰ï¼Œæ¯”å¦‚<code>Comparator&lt;String&gt; comparatorTest = (a, b)-&gt;a.length()-b.length();</code>,å¯ä»¥æ¨å¯¼å‡ºa,béƒ½ä¸ºString</li><li>å½“å‚æ•°ç±»å‹å¯çœç•¥ï¼Œä¸”åªæœ‰ä¸€ä¸ªå‚æ•°æ—¶ï¼Œæ‹¬å¼§ä¹Ÿå¯ä»¥çœç•¥ï¼ˆä½†æ˜¯ä¸ªäººä¹ æƒ¯ä¿ç•™ï¼‰</li></ul></li><li><p>ç¬¦å·ï¼š <code>-&gt;</code></p></li><li><p>ä¸»ä½“ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">&#123; <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(&quot;javalover&quot;); &#125;<br></code></pre></td></tr></table></figure><ul><li>å¦‚æœæ˜¯ä¸€æ¡è¯­å¥ï¼Œåˆ™éœ€è¦åŠ å¤§æ‹¬å·å’Œåˆ†å·<code>&#123;;&#125;</code>ï¼ˆæ¯”å¦‚ä¸Šå›¾æ‰€ç¤ºï¼‰</li><li>å¦‚æœæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œåˆ™ç›´æ¥å†™ï¼Œå•¥ä¹Ÿä¸åŠ ï¼ˆæ¯”å¦‚<code>a.length()- b.length()</code>ï¼‰</li></ul></li></ul><h3 id="2-ä¸ºå•¥å¼•å…¥lambda"><a href="#2-ä¸ºå•¥å¼•å…¥lambda" class="headerlink" title="2. ä¸ºå•¥å¼•å…¥lambda"></a>2. ä¸ºå•¥å¼•å…¥lambda</h3><p>ä¸ºäº†ç®€åŒ–ä»£ç </p><p>å› ä¸ºJavaæ˜¯é¢å‘å¯¹è±¡è¯­è¨€ï¼Œæ‰€ä»¥åœ¨lambdaå‡ºç°ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ„é€ ä¸€ä¸ªå¯¹è±¡ï¼Œç„¶ååœ¨å¯¹è±¡çš„æ–¹æ³•ä¸­å®ç°å…·ä½“çš„å†…å®¹ï¼Œå†æŠŠæ„é€ çš„å¯¹è±¡ä¼ é€’ç»™æŸä¸ªå¯¹è±¡æˆ–æ–¹æ³•</p><p>ä½†æ˜¯æœ‰äº†lambdaä»¥åï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å°†ä»£ç å—ä¼ é€’ç»™å¯¹è±¡æˆ–æ–¹æ³•</p><p>ç°åœ¨å†å›å¤´çœ‹ä¸‹å¼€å¤´çš„ä¾‹å­</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/ca93fa395a2e4015a4b202e55ce7c357~tplv-k3u1fbpfcp-zoom-1.image" alt="lambdaå‡å°‘äº†æ¨¡æ¿ä»£ç "></p><p>å¯ä»¥çœ‹åˆ°ï¼Œç”¨äº†lambdaè¡¨è¾¾å¼åï¼Œå°‘äº†å¾ˆå¤šæ¨¡æ¿ä»£ç ï¼Œåªå‰©ä¸‹ä¸€ä¸ªä»£ç å—ï¼ˆæœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼‰</p><h3 id="3-ä»€ä¹ˆæ˜¯å‡½æ•°å¼æ¥å£"><a href="#3-ä»€ä¹ˆæ˜¯å‡½æ•°å¼æ¥å£" class="headerlink" title="3. ä»€ä¹ˆæ˜¯å‡½æ•°å¼æ¥å£"></a>3. ä»€ä¹ˆæ˜¯å‡½æ•°å¼æ¥å£</h3><p>å°±æ˜¯åªå®šä¹‰äº†ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„æ¥å£</p><ul><li>æ­£ä¾‹ï¼šæœ‰å¤šä¸ª<a href="https://mp.weixin.qq.com/s/NAO8W8YbnxWZpNEDh1xskQ">é»˜è®¤æ–¹æ³•</a>ï¼Œä½†æ˜¯å¦‚æœåªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œé‚£å®ƒå°±æ˜¯å‡½æ•°å¼æ¥å£ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@FunctionalInterface</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">FunctionInterfaceDemo</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">abstractFun</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">default</span> <span class="hljs-keyword">void</span> <span class="hljs-title">fun1</span><span class="hljs-params">()</span></span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;fun1&quot;</span>);    <br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">default</span> <span class="hljs-keyword">void</span> <span class="hljs-title">fun2</span><span class="hljs-params">()</span></span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;fun2&quot;</span>);<br>    &#125;   <br>&#125;<br><br></code></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œçš„æ³¨è§£@FunctionalInterfaceå¯ä»¥çœç•¥ï¼Œä½†æ˜¯å»ºè®®åŠ ä¸Šï¼Œå°±æ˜¯ä¸ºäº†å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œè¿™æ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼Œæ­¤æ—¶å¦‚æœè¯¥æ¥å£æœ‰å¤šä¸ªæŠ½è±¡æ–¹æ³•ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å°±ä¼šæŠ¥é”™</p></blockquote><ul><li>åä¾‹ï¼šæ¯”å¦‚A extends Bï¼ŒAå’ŒBå„æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œé‚£ä¹ˆAå°±ä¸æ˜¯å‡½æ•°å¼æ¥å£ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼ŒMultiple non-overriding abstract methods found in XXX</span><br><span class="hljs-meta">@FunctionalInterface</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">NoFunctionInterfaceDemo</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">FunctionInterfaceDemo</span></span>&#123;<br>  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">abstractFun2</span><span class="hljs-params">()</span></span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><blockquote><p>ä¸Šé¢çš„çˆ¶æ¥å£FunctionInterfaceDemoä¸­å·²ç»æœ‰äº†ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œæ­¤æ—¶NoFunctionInterfaceDemoåˆå®šä¹‰äº†ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œç»“æœç¼–è¯‘å™¨å°±æç¤ºäº†ï¼šå­˜åœ¨å¤šä¸ªæŠ½è±¡æ–¹æ³•</p></blockquote><p>åœ¨Java8ä¹‹å‰ï¼Œå…¶å®æˆ‘ä»¬å·²ç»æ¥è§¦è¿‡å‡½æ•°å¼æ¥å£</p><p>æ¯”å¦‚Runnable å’Œ Comparable</p><p>åªæ˜¯æ²¡æœ‰æ³¨è§£@FunctionalInterfaceã€‚</p><blockquote><p>é‚£è¿™ä¸ªå‡½æ•°å¼æ¥å£è¦æ€ä¹ˆç”¨å‘¢ï¼Ÿ</p></blockquote><p>é…åˆlambdaé£Ÿç”¨ï¼Œæ•ˆæœæœ€ä½³ï¼ˆå°±æ˜¯æŠŠlambdaä¼ é€’ç»™å‡½æ•°å¼æ¥å£ï¼‰ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">new</span> Thread(() -&gt; System.out.println(<span class="hljs-string">&quot;run&quot;</span>)).start();<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>å…¶ä¸­ç”¨åˆ°çš„å‡½æ•°å¼æ¥å£æ˜¯<code>Runnable</code></p><h3 id="4-ä»€ä¹ˆæ˜¯è¡Œä¸ºå‚æ•°åŒ–"><a href="#4-ä»€ä¹ˆæ˜¯è¡Œä¸ºå‚æ•°åŒ–" class="headerlink" title="4. ä»€ä¹ˆæ˜¯è¡Œä¸ºå‚æ•°åŒ–"></a>4. ä»€ä¹ˆæ˜¯è¡Œä¸ºå‚æ•°åŒ–</h3><p>å°±æ˜¯æŠŠ<strong>è¡Œä¸º</strong>å®šä¹‰æˆ<strong>å‚æ•°</strong>ï¼Œè¡Œä¸ºå°±æ˜¯<strong>å‡½æ•°å¼æ¥å£</strong></p><p>ç±»ä¼¼<a href="https://mp.weixin.qq.com/s/NgqWzRbrHmO9iTBAQM-7zw">æ³›å‹</a>ä¸­çš„ç±»å‹å‚æ•°åŒ–<code>&lt;T&gt;</code>ï¼Œç±»å‹å‚æ•°åŒ–æ˜¯æŠŠ<strong>ç±»å‹</strong>å®šä¹‰æˆ<strong>å‚æ•°</strong></p><p>è¡Œä¸ºå‚æ•°åŒ–ï¼Œé€šä¿—ç‚¹æ¥è¯´ï¼š</p><ul><li>å°±æ˜¯ç”¨<strong>å‡½æ•°å¼æ¥å£</strong>åš<strong>å½¢å‚</strong></li><li>ç„¶åä¼ å…¥æ¥å£çš„å„ç§å®ç°å†…å®¹ï¼ˆå³<strong>lambdaè¡¨è¾¾å¼</strong>ï¼‰ä½œä¸º<strong>å®å‚</strong></li><li>æœ€ååœ¨lambdaå†…<strong>å®ç°å„ç§è¡Œä¸º</strong>ï¼ˆå¥½åƒåˆå›åˆ°<a href="">å¤šæ€</a>çš„é‚£ä¸€èŠ‚äº†ï¼Ÿè¿™ä¹Ÿæ˜¯ä¸ºå•¥å¤šæ€æ˜¯Javaçš„ä¸‰å¤§ç‰¹æ€§çš„åŸå› ä¹‹ä¸€ï¼Œåº”ç”¨å¤ªå¹¿æ³›äº†ï¼‰</li></ul><p>è¿™æ ·æ¥çœ‹çš„è¯ï¼Œ<strong>è¡Œä¸ºå‚æ•°åŒ–</strong>å’Œè®¾è®¡æ¨¡å¼ä¸­çš„<strong>ç­–ç•¥æ¨¡å¼</strong>æœ‰ç‚¹åƒäº†ï¼ˆåé¢ç« èŠ‚ä¼šåˆ†åˆ«è®²å¸¸ç”¨çš„å‡ ç§è®¾è®¡æ¨¡å¼ï¼‰</p><p>ä¸‹é¢æˆ‘ä»¬æ‰‹å†™ä¸€ä¸ªå‡½æ•°å¼æ¥å£æ¥åŠ æ·±ç†è§£å§</p><h3 id="5-æ‰‹å†™ä¸€ä¸ªå‡½æ•°å¼æ¥å£"><a href="#5-æ‰‹å†™ä¸€ä¸ªå‡½æ•°å¼æ¥å£" class="headerlink" title="5. æ‰‹å†™ä¸€ä¸ªå‡½æ•°å¼æ¥å£"></a>5. æ‰‹å†™ä¸€ä¸ªå‡½æ•°å¼æ¥å£</h3><p>ä¸‹é¢æˆ‘ä»¬å¾ªåºæ¸è¿›ï¼Œå…ˆä»ç®€å•çš„éœ€æ±‚å¼€å§‹</p><ul><li>ç¬¬ä¸€æ­¥ï¼šæ¯”å¦‚æˆ‘ä»¬æƒ³è¦<strong>è¯»å–æŸä¸ªæ–‡ä»¶</strong>ï¼Œé‚£å¯ä»¥æœ‰å¦‚ä¸‹æ–¹æ³•ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">processFile</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>    <span class="hljs-comment">// Java7æ–°å¢çš„è¯­æ³•ï¼Œtry()&#123;&#125;ï¼Œå¯è‡ªåŠ¨å…³é—­èµ„æºï¼Œå‡å°‘äº†ä»£ç çš„è‡ƒè‚¿</span><br>    <span class="hljs-keyword">try</span>( BufferedReader bufferedReader = <br>        <span class="hljs-keyword">new</span> BufferedReader(<span class="hljs-keyword">new</span>  FileReader(<span class="hljs-string">&quot;D:\\JavaProject\\JavaBasicDemo\\test.txt&quot;</span>)))&#123;<br>        <span class="hljs-keyword">return</span> bufferedReader.readLine();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæ ¸å¿ƒçš„è¡Œä¸ºåŠ¨ä½œå°±æ˜¯ <code>return bufferedReader.readLine();</code>ï¼Œè¡¨ç¤ºè¯»å–ç¬¬ä¸€è¡Œçš„æ•°æ®å¹¶è¿”å›</p><p>é‚£å¦‚æœæˆ‘ä»¬æƒ³è¦è¯»å–ä¸¤è¡Œå‘¢ï¼Ÿä¸‰è¡Œï¼Ÿ</p><ul><li>ç¬¬äºŒæ­¥ï¼šè¿™æ—¶å°±éœ€è¦ç”¨åˆ°ä¸Šé¢çš„<strong>å‡½æ•°å¼æ¥å£</strong>äº†ï¼Œä¸‹é¢å°±æ˜¯æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„å‡½æ•°å¼æ¥å£</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@FunctionalInterface</span><br><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">FileReadInterface</span></span>&#123;<br>  <span class="hljs-comment">// è¿™é‡Œæ¥å—ä¸€ä¸ªBufferedReaderå¯¹è±¡ï¼Œè¿”å›ä¸€ä¸ªStringå¯¹è±¡</span><br>    <span class="hljs-function">String <span class="hljs-title">process</span><span class="hljs-params">(BufferedReader reader)</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œåªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•<code>process() </code>ï¼Œå®ƒå°±æ˜¯ç”¨æ¥å¤„ç†ç¬¬ä¸€æ­¥ä¸­çš„æ ¸å¿ƒåŠ¨ä½œï¼ˆè¯»å–æ–‡ä»¶å†…å®¹ï¼‰</p><p>è‡³äºæƒ³è¯»å–å¤šå°‘å†…å®¹ï¼Œé‚£å°±éœ€è¦æˆ‘ä»¬åœ¨lambdaè¡¨è¾¾å¼ä¸­å®šä¹‰äº†</p><ul><li>ç¬¬ä¸‰æ­¥ï¼šæ¥ä¸‹æ¥æˆ‘ä»¬å®šä¹‰å¤šä¸ª<strong>lambdaè¡¨è¾¾å¼</strong>ï¼Œç”¨æ¥<strong>ä¼ é€’</strong>ç»™<strong>å‡½æ•°å¼æ¥å£</strong>ï¼Œå…¶ä¸­æ¯ä¸ªlambdaè¡¨è¾¾å¼å°±ä»£è¡¨äº†ä¸€ç§ä¸åŒçš„è¡Œä¸ºï¼Œä»£ç å¦‚ä¸‹ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// è¯»å–ä¸€è¡Œ</span><br>FileReadInterface fileReadInterface = reader -&gt; reader.readLine();<br><span class="hljs-comment">// è¯»å–ä¸¤è¡Œ</span><br>FileReadInterface fileReadInterface2 = reader -&gt; reader.readLine() + reader.readLine();<br><br><br></code></pre></td></tr></table></figure><ul><li>ç¬¬å››æ­¥ï¼šæˆ‘ä»¬éœ€è¦ä¿®æ”¹ç¬¬ä¸€æ­¥çš„<code>processFile()</code>ï¼Œè®©å…¶æ¥å—ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼Œå¹¶è°ƒç”¨å…¶ä¸­çš„æŠ½è±¡æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å‚æ•°ä¸ºç¬¬äºŒæ­¥æˆ‘ä»¬è‡ªå·±æ‰‹å†™çš„å‡½æ•°å¼æ¥å£</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">processFile</span><span class="hljs-params">(FileReadInterface fileReadInterface)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        <span class="hljs-keyword">try</span>( BufferedReader bufferedReader =<br>                 <span class="hljs-keyword">new</span> BufferedReader(<span class="hljs-keyword">new</span> FileReader(<span class="hljs-string">&quot;./test.txt&quot;</span>)))&#123;<br><span class="hljs-comment">// è¿™é‡Œæˆ‘ä»¬ä¸å†è‡ªå·±å®šä¹‰è¡Œä¸ºï¼Œè€Œæ˜¯äº¤ç»™å‡½æ•°å¼æ¥å£çš„æŠ½è±¡æ–¹æ³•æ¥å¤„ç†ï¼Œç„¶åé€šè¿‡lambdaè¡¨è¾¾å¼çš„ä¼ å…¥æ¥å®ç°å¤šä¸ªè¡Œä¸º</span><br>          <span class="hljs-keyword">return</span> fileReadInterface.process(bufferedReader);<br>        &#125;<br>    &#125;<br><br></code></pre></td></tr></table></figure><ul><li>ç¬¬äº”æ­¥ï¼šæ‹¼æ¥åï¼Œå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileReaderDemo</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br><span class="hljs-comment">// ç¬¬ä¸‰æ­¥ï¼š </span><br>      <span class="hljs-comment">// lambdaè¡¨è¾¾å¼1 ä¼ ç»™ å‡½æ•°å¼æ¥å£ï¼šåªè¯»å–ä¸€è¡Œ</span><br>      FileReadInterface fileReadInterface = reader -&gt; reader.readLine();<br><span class="hljs-comment">// lambdaè¡¨è¾¾å¼2 ä¼ ç»™ å‡½æ•°å¼æ¥å£ï¼šåªè¯»å–ä¸¤è¡Œ</span><br>      FileReadInterface fileReadInterface2 = reader -&gt; reader.readLine() + reader.readLine();<br>      <span class="hljs-comment">// æœ€åä¸€æ­¥ï¼š ä¸åŒçš„å‡½æ•°å¼æ¥å£çš„å®ç°ï¼Œè¡¨ç°å‡ºä¸åŒçš„è¡Œä¸º</span><br>        String str1 = processFile(fileReadInterface);<br>        String str2 = processFile(fileReadInterface2);<br>        System.out.println(str1);<br>        System.out.println(str2);<br>    &#125;<br>  <span class="hljs-comment">// ç¬¬å››æ­¥ï¼š è¯»å–æ–‡ä»¶æ–¹æ³•ï¼Œæ¥å—å‡½æ•°å¼æ¥å£ä½œä¸ºå‚æ•°</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">processFile</span><span class="hljs-params">(FileReadInterface fileReadInterface)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        <span class="hljs-keyword">try</span>( BufferedReader bufferedReader =<br>                 <span class="hljs-keyword">new</span> BufferedReader(<span class="hljs-keyword">new</span> FileReader(<span class="hljs-string">&quot;./test.txt&quot;</span>)))&#123;<br><span class="hljs-comment">// è°ƒç”¨å‡½æ•°å¼æ¥å£ä¸­çš„æŠ½è±¡æ–¹æ³•æ¥å¤„ç†æ•°æ®</span><br>          <span class="hljs-keyword">return</span> fileReadInterface.process(bufferedReader);<br>        &#125;<br>    &#125;<br><span class="hljs-comment">// ç¬¬ä¸€æ­¥ï¼š</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">processFile</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        <span class="hljs-keyword">try</span>( BufferedReader bufferedReader =<br>                 <span class="hljs-keyword">new</span> BufferedReader(<span class="hljs-keyword">new</span> FileReader(<span class="hljs-string">&quot;./test.txt&quot;</span>)))&#123;<br>          <span class="hljs-keyword">return</span> bufferReader.readLine();<br>        &#125;<br>    &#125;<br><br><br>&#125;<br><br><span class="hljs-comment">// ç¬¬äºŒæ­¥ï¼š æˆ‘ä»¬æ‰‹å†™çš„å‡½æ•°å¼æ¥å£</span><br><span class="hljs-meta">@FunctionalInterface</span><br><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">FileReadInterface</span></span>&#123;<br>    <span class="hljs-function">String <span class="hljs-title">process</span><span class="hljs-params">(BufferedReader reader)</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>&#125;<br><br><br></code></pre></td></tr></table></figure><p>å…¶å®ä½ ä¼šå‘ç°ï¼Œæˆ‘ä»¬æ‰‹å†™çš„è¿™ä¸ªå‡½æ•°å¼æ¥å£ï¼Œå…¶å®å°±æ˜¯<code>Function&lt;T&gt;</code>å»é™¤æ³›å‹åŒ–åçš„æ¥å£ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@FunctionalInterface</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Function</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">R</span>&gt; </span>&#123;<br><span class="hljs-comment">// éƒ½æ˜¯æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œè¿”å›å¦ä¸€ä¸ªå‚æ•°</span><br>  <span class="hljs-function">R <span class="hljs-title">apply</span><span class="hljs-params">(T t)</span></span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ä¸‹é¢æˆ‘ä»¬åˆ—å‡ºJavaä¸­å¸¸ç”¨çš„ä¸€äº›å‡½æ•°å¼æ¥å£ï¼Œä½ ä¼šå‘ç°è‡ªå¸¦çš„å·²ç»å¤Ÿç”¨äº†ï¼ŒåŸºæœ¬ä¸ä¼šéœ€è¦æˆ‘ä»¬è‡ªå·±å»å†™</p><p>è¿™é‡Œçš„æ‰‹å†™åªæ˜¯ä¸ºäº†è‡ªå·±å®ç°ä¸€éï¼Œå¯ä»¥åŠ æ·±ç†è§£ç¨‹åº¦</p><h3 id="6-å¸¸ç”¨çš„å‡½æ•°å¼æ¥å£"><a href="#6-å¸¸ç”¨çš„å‡½æ•°å¼æ¥å£" class="headerlink" title="6. å¸¸ç”¨çš„å‡½æ•°å¼æ¥å£"></a>6. å¸¸ç”¨çš„å‡½æ•°å¼æ¥å£</h3><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/4fb3fca88fc74b7a9d97a549ba183037~tplv-k3u1fbpfcp-zoom-1.image" alt="å¸¸ç”¨çš„å‡½æ•°å¼æ¥å£"></p><h3 id="7-ä»€ä¹ˆæ˜¯æ–¹æ³•å¼•ç”¨"><a href="#7-ä»€ä¹ˆæ˜¯æ–¹æ³•å¼•ç”¨" class="headerlink" title="7. ä»€ä¹ˆæ˜¯æ–¹æ³•å¼•ç”¨"></a>7. ä»€ä¹ˆæ˜¯æ–¹æ³•å¼•ç”¨</h3><p>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªä¾‹å­</p><p>å‰é¢æˆ‘ä»¬å†™çš„lambdaè¡¨è¾¾å¼ï¼Œå…¶å®è¿˜å¯ä»¥ç®€åŒ–ï¼Œæ¯”å¦‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ç®€åŒ–å‰</span><br>Function&lt;Cat, Integer&gt; function = c-&gt;c.getAge();<br><span class="hljs-comment">// ç®€åŒ–å</span><br>Function&lt;Cat, Integer&gt; function2 = Cat::getAge;<br><br></code></pre></td></tr></table></figure><p>å…¶ä¸­ç®€åŒ–åçš„<code>Cat::getAge</code>ï¼Œæˆ‘ä»¬å°±å«åš<strong>æ–¹æ³•å¼•ç”¨</strong></p><p><strong>æ–¹æ³•å¼•ç”¨å°±æ˜¯å¼•ç”¨ç±»æˆ–å¯¹è±¡çš„æ–¹æ³•</strong>ï¼›</p><p>ä¸‹é¢æˆ‘ä»¬åˆ—å‡ºæ–¹æ³•å¼•ç”¨çš„ä¸‰ç§æƒ…å†µï¼š</p><ol><li>Object::instanceMethodï¼ˆå¯¹è±¡çš„å®ä¾‹æ–¹æ³•ï¼‰</li><li>Class::staticMethodï¼ˆç±»çš„é™æ€æ–¹æ³•ï¼‰</li><li>Class::instanceMethodï¼ˆç±»çš„å®ä¾‹æ–¹æ³•ï¼‰</li></ol><p>åƒæˆ‘ä»¬ä¸Šé¢ä¸¾çš„ä¾‹å­å°±æ˜¯ç¬¬ä¸‰ç§ï¼šç±»çš„å®ä¾‹æ–¹æ³•</p><p>ä¸‹é¢æˆ‘ä»¬ç”¨ä»£ç æ¼”ç¤ºä¸Šé¢çš„ä¸‰ç§æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ReferenceDemo</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-comment">// ç¬¬ä¸€ç§:å¼•ç”¨å¯¹è±¡çš„å®ä¾‹æ–¹æ³•</span><br>        Cat cat = <span class="hljs-keyword">new</span> Cat(<span class="hljs-number">1</span>);<br>        Function&lt;Cat, Integer&gt; methodRef1 = cat::getSum; <br>        <span class="hljs-comment">// ç¬¬äºŒç§:å¼•ç”¨ç±»çš„é™æ€æ–¹æ³•</span><br>        Supplier&lt;Integer&gt; methodRef2 = Cat::getAverageAge;<br>        <span class="hljs-comment">// ç¬¬ä¸‰ç§ï¼šå¼•ç”¨ç±»çš„å®ä¾‹æ–¹æ³•</span><br>        Function&lt;Cat, Integer&gt; methodRef3 = Cat::getAge;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Cat</span> </span>&#123;<br>    <span class="hljs-keyword">int</span> age;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Cat</span><span class="hljs-params">(<span class="hljs-keyword">int</span> age)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.age = age;<br>    &#125;<br><br>    <span class="hljs-comment">// è·å–çŒ«çš„å¹³å‡å¹´é¾„</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getAverageAge</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">15</span>;<br>    &#125;<br>    <span class="hljs-comment">// è·å–ä¸¤åªçŒ«çš„å¹´é¾„æ€»å’Œ</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getSum</span><span class="hljs-params">(Cat cat)</span></span>&#123;<br>        <span class="hljs-keyword">return</span> cat.getAge() + <span class="hljs-keyword">this</span>.getAge();<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getAge</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> age;<br>    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setAge</span><span class="hljs-params">(<span class="hljs-keyword">int</span> age)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.age = age;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><blockquote><p>ä¸ºå•¥è¦ç”¨è¿™ä¸ªæ–¹æ³•å¼•ç”¨å‘¢ï¼Ÿ</p></blockquote><p>æ–¹æ³•å¼•ç”¨å¥½æ¯”lambdaè¡¨è¾¾å¼çš„è¯­æ³•ç³–ï¼Œè¯­æ³•æ›´åŠ ç®€æ´ï¼Œæ¸…æ™°</p><p>ä¸€çœ‹å°±çŸ¥é“æ˜¯è°ƒç”¨å“ªä¸ªç±»æˆ–å¯¹è±¡çš„å“ªä¸ªæ–¹æ³•</p><h3 id="8-ä»€ä¹ˆæ˜¯æ„é€ å¼•ç”¨"><a href="#8-ä»€ä¹ˆæ˜¯æ„é€ å¼•ç”¨" class="headerlink" title="8. ä»€ä¹ˆæ˜¯æ„é€ å¼•ç”¨"></a>8. ä»€ä¹ˆæ˜¯æ„é€ å¼•ç”¨</h3><p>ä¸Šé¢ä»‹ç»äº†æ–¹æ³•å¼•ç”¨ï¼Œå°±æ˜¯ç›´æ¥å¼•ç”¨æŸä¸ªæ–¹æ³•</p><p>è¿™é‡Œçš„æ„é€ å¼•ç”¨åŒç†å¯å¾—ï¼Œå°±æ˜¯å¼•ç”¨æŸä¸ªç±»çš„æ„é€ æ–¹æ³•</p><p>æ„é€ å¼•ç”¨çš„è¡¨è¾¾å¼ä¸ºï¼š<code>Class::new</code>ï¼Œä»…æ­¤ä¸€ç§</p><p>å¦‚æœä½ æœ‰å¤šä¸ªæ„é€ å‡½æ•°ï¼Œé‚£ç¼–è¯‘å™¨ä¼šè‡ªå·±è¿›è¡Œæ¨æ–­å‚æ•°ï¼ˆä½ çœ‹çœ‹ï¼Œå¤šå¥½ï¼Œå¤šç®€æ´ï¼‰</p><p>æ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// è¿™é‡Œè°ƒç”¨ new Cat()</span><br>Supplier&lt;Cat&gt; constructRef1 = Cat::<span class="hljs-keyword">new</span>;<br><span class="hljs-comment">// è¿™é‡Œè°ƒç”¨ new Cat(Integer)</span><br>Function&lt;Integer, Cat&gt; constructRef2 = Cat::<span class="hljs-keyword">new</span>;<br><br></code></pre></td></tr></table></figure><h3 id="9-lambdaè¡¨è¾¾å¼ä¸­å¼•å…¥å¤–éƒ¨å˜é‡çš„é™åˆ¶"><a href="#9-lambdaè¡¨è¾¾å¼ä¸­å¼•å…¥å¤–éƒ¨å˜é‡çš„é™åˆ¶" class="headerlink" title="9. lambdaè¡¨è¾¾å¼ä¸­å¼•å…¥å¤–éƒ¨å˜é‡çš„é™åˆ¶"></a>9. lambdaè¡¨è¾¾å¼ä¸­å¼•å…¥å¤–éƒ¨å˜é‡çš„é™åˆ¶</h3><p>è¦æ±‚å¼•å…¥lambdaè¡¨è¾¾å¼ä¸­çš„å˜é‡ï¼Œå¿…é¡»æ˜¯æœ€ç»ˆå˜é‡ï¼Œå³è¯¥å˜é‡ä¸ä¼šå†è¢«ä¿®æ”¹</p><p>æ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>  String str = <span class="hljs-string">&quot;javalover.cc&quot;</span>;<br>  Runnable runnable = ()-&gt;&#123;<br>    str = <span class="hljs-string">&quot;1&quot;</span>;<span class="hljs-comment">// è¿™é‡Œä¼šæŠ¥é”™ï¼Œå› ä¸ºä¿®æ”¹äº†strå¼•ç”¨çš„æŒ‡å‘</span><br>    System.out.println(str);<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œlambdaè¡¨è¾¾å¼å¼•ç”¨äº†å¤–é¢çš„strå¼•ç”¨ï¼Œä½†æ˜¯åˆåœ¨è¡¨è¾¾å¼å†…éƒ¨åšäº†ä¿®æ”¹ï¼Œç»“æœå°±æŠ¥é”™äº†</p><blockquote><p>ä¸ºå•¥è¦æœ‰è¿™ä¸ªé™åˆ¶å‘¢ï¼Ÿ</p></blockquote><p>ä¸ºäº†çº¿ç¨‹å®‰å…¨ï¼Œå› ä¸ºlambdaè¡¨è¾¾å¼æœ‰ä¸€ä¸ªå¥½å¤„å°±æ˜¯åªåœ¨éœ€è¦çš„æ—¶å€™æ‰ä¼šæ‰§è¡Œï¼Œè€Œä¸æ˜¯è°ƒç”¨åç«‹é©¬æ‰§è¡Œ</p><p>è¿™æ ·å°±ä¼šå­˜åœ¨å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œçš„å¹¶å‘é—®é¢˜</p><p>æ‰€ä»¥Javaå°±ä»æ ¹æºä¸Šè§£å†³ï¼šä¸è®©å˜é‡è¢«ä¿®æ”¹ï¼Œéƒ½æ˜¯åªè¯»çš„</p><blockquote><p>é‚£ä½ å¯èƒ½å¥½å¥‡ï¼Œæˆ‘ä¸æŠŠstrçš„ä¿®æ”¹ä»£ç æ”¾åˆ°è¡¨è¾¾å¼å†…éƒ¨å¯ä»¥å—ï¼Ÿ</p></blockquote><p>ä¹Ÿä¸è¡Œï¼Œé“ç†æ˜¯ä¸€æ ·çš„ï¼Œåªè¦lambdaæœ‰ç”¨åˆ°è¿™ä¸ªå˜é‡ï¼Œé‚£è¿™ä¸ªå˜é‡ä¸ç®¡æ˜¯åœ¨å“ªé‡Œè¢«ä¿®æ”¹ï¼Œéƒ½æ˜¯ä¸å…è®¸çš„</p><p>ä¸ç„¶çš„è¯ï¼Œæˆ‘è¿™è¾¹å…ˆæ‰§è¡Œäº†ä¸€æ¬¡lambdaè¡¨è¾¾å¼ï¼Œç»“æœä½ å°±æ”¹äº†å˜é‡å€¼ï¼Œé‚£æˆ‘ç¬¬äºŒæ¬¡æ‰§è¡Œlambdaï¼Œä¸å°±ä¹±äº†å—</p><h3 id="10-lambdaçš„ç»„åˆæ“ä½œ"><a href="#10-lambdaçš„ç»„åˆæ“ä½œ" class="headerlink" title="10. lambdaçš„ç»„åˆæ“ä½œ"></a>10. lambdaçš„ç»„åˆæ“ä½œ</h3><p>æœ€åæ˜¯lambdaçš„å¿…æ€æŠ€ï¼š<strong>ç»„åˆæ“ä½œ</strong></p><p>åœ¨è¿™é‡Œå«ç»„åˆæˆ–è€…å¤åˆéƒ½å¯ä»¥</p><blockquote><p>æ¦‚è¿°ï¼šç»„åˆæ“ä½œå°±æ˜¯å…ˆç”¨ä¸€ä¸ªlambdaè¡¨è¾¾å¼ï¼Œç„¶åå†åœ¨åé¢ç»„åˆå¦ä¸€ä¸ªlambdaè¡¨è¾¾å¼ï¼Œç„¶åå†åœ¨åé¢ç»„åˆå¦å¦ä¸€ä¸ªlambdaè¡¨è¾¾å¼ï¼Œç„¶åã€‚ã€‚ã€‚æœ‰ç‚¹åƒæ˜¯é“¾å¼æ“ä½œ</p></blockquote><p>å­¦è¿‡JSçš„éƒ½çŸ¥é“Promiseï¼Œé‡Œé¢çš„é“¾å¼æ“ä½œå°±å’Œè¿™é‡Œçš„ç»„åˆæ“ä½œå¾ˆåƒ</p><p>ç”¨è¿‡Lombokçš„æœ‹å‹ï¼Œåº”è¯¥å¾ˆç†Ÿæ‚‰@Builderæ³¨è§£ï¼Œå…¶å®å°±æ˜¯æ„é€ è€…æ¨¡å¼</p><p>ä¸‹é¢æˆ‘ä»¬ç”¨ä»£ç æ¼”ç¤ºä¸‹ç»„åˆæ“ä½œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// é‡ç‚¹ä»£ç </span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ComposeDemo</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        List&lt;Dog&gt; list = Arrays.asList(<span class="hljs-keyword">new</span> Dog(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>), <span class="hljs-keyword">new</span> Dog(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>));<br>        <span class="hljs-comment">// 1. å…ˆæŒ‰å¹´é¾„æ’åºï¼ˆé»˜è®¤é€’å¢ï¼‰</span><br>      <span class="hljs-comment">// Dog::getAge, ä¸Šé¢ä»‹ç»çš„æ–¹æ³•å¼•ç”¨</span><br>      <span class="hljs-comment">// comparingInt, æ˜¯Comparatorçš„ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œè¿”å›Comparator&lt;T&gt;</span><br>      Comparator&lt;Dog&gt; comparableAge = Comparator.comparingInt(Dog::getAge);<br>        <span class="hljs-comment">// 2. å¦‚æœæœ‰ç›¸åŒçš„å¹´é¾„ï¼Œåˆ™å¹´é¾„ç›¸åŒçš„å†æŒ‰ä½“é‡æ’åºï¼ˆå¦‚æœå¹´é¾„å·²ç»æ¯”è¾ƒå‡ºå¤§å°ï¼Œåˆ™ä¸‹é¢çš„ä½“é‡å°±ä¸ä¼šå†å»æ¯”è¾ƒï¼‰</span><br>        Comparator&lt;Dog&gt; comparableWeight = Comparator.comparingInt(Dog::getWeight);;<br>        <span class="hljs-comment">// 3. è°ƒç”¨listå¯¹è±¡çš„sortæ–¹æ³•æ’åºï¼Œå‚æ•°æ˜¯Comparator&lt;? super Dog&gt;</span><br>        list.sort(comparableAge.thenComparing(comparableWeight));<br>        System.out.println(list);<br>    &#125;<br>&#125;<br><span class="hljs-comment">// éé‡ç‚¹ä»£ç </span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Dog</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> age;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> weight;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Dog</span><span class="hljs-params">(<span class="hljs-keyword">int</span> age, <span class="hljs-keyword">int</span> weight)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.age = age;<br>        <span class="hljs-keyword">this</span>.weight = weight;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getAge</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> age;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setAge</span><span class="hljs-params">(<span class="hljs-keyword">int</span> age)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.age = age;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getWeight</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> weight;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setWeight</span><span class="hljs-params">(<span class="hljs-keyword">int</span> weight)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.weight = weight;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Dog&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;age=&quot;</span> + age +<br>                <span class="hljs-string">&quot;, weight=&quot;</span> + weight +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>è¾“å‡ºï¼š<code>[Dog&#123;age=1, weight=1&#125;, Dog&#123;age=1, weight=2&#125;]</code></p><p>æ¯”è¾ƒçš„æµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/95d889dd6f084a11982c9e5986621e30~tplv-k3u1fbpfcp-zoom-1.image" alt="ç»„åˆæ“ä½œ"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol><li>lambdaçš„è¯­æ³•:  å‚æ•°+ç¬¦åˆ+è¡¨è¾¾å¼æˆ–è¯­å¥ï¼Œæ¯”å¦‚<code>(a,b)-&gt;&#123;System.out.println(&quot;javalover.cc&quot;);&#125;</code></li><li>å‡½æ•°å¼æ¥å£ï¼šåªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œæœ€å¥½åŠ @FunctionalInterfaceï¼Œè¿™æ ·ç¼–è¯‘å™¨å¯åŠæ—¶å‘ç°é”™è¯¯ï¼Œjavadocä¹Ÿè¯´æ˜è¿™æ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼ˆå¯è¯»æ€§ï¼‰</li><li>è¡Œä¸ºå‚æ•°åŒ–ï¼šå°±æ˜¯å‡½æ•°å¼æ¥å£ä½œä¸ºå‚æ•°ï¼Œç„¶åå†å°†lambdaè¡¨è¾¾å¼ä¼ ç»™å‡½æ•°å¼æ¥å£ï¼Œé€šè¿‡ä¸åŒçš„lambdaå†…å®¹å®ç°ä¸åŒçš„è¡Œä¸º</li><li>æ–¹æ³•å¼•ç”¨ï¼šlambdaçš„è¯­æ³•ç³–ï¼Œæ€»å…±æœ‰ä¸‰ç§:<ul><li>Object::instanceMethodï¼ˆå¯¹è±¡çš„å®ä¾‹æ–¹æ³•ï¼‰</li><li>Class::staticMethodï¼ˆç±»çš„é™æ€æ–¹æ³•ï¼‰</li><li>Class::instanceMethodï¼ˆç±»çš„å®ä¾‹æ–¹æ³•ï¼‰</li></ul></li><li>æ„é€ å¼•ç”¨ï¼šå°±ä¸€ç§ï¼Œç¼–è¯‘å™¨è‡ªå·±å¯åˆ¤æ–­æ˜¯å“ªä¸ªæ„é€ å‡½æ•°ï¼Œè¯­æ³•ä¸º<code>Class::new</code></li><li>åœ¨lambdaä¸­å¼•å…¥å¤–éƒ¨å˜é‡ï¼Œå¿…é¡»ä¿è¯è¿™ä¸ªå˜é‡æ˜¯æœ€ç»ˆå˜é‡ï¼Œå³ä¸å†è¢«ä¿®æ”¹</li><li>lambdaçš„ç»„åˆæ“ä½œï¼Œå°±æ˜¯é“¾å¼æ“ä½œï¼Œç»„åˆæ˜¯é€šè¿‡å‡½æ•°å¼æ¥å£çš„é™æ€æ–¹æ³•æ¥ç»„åˆï¼ˆé™æ€æ–¹æ³•ä¼šè¿”å›å¦ä¸€ä¸ªå‡½æ•°å¼æ¥å£çš„å¯¹è±¡ï¼‰</li></ol><p>æ¯”å¦‚<code>list.sort(comparableAge.thenComparing(comparableWeight));</code></p>]]></content>
    
    
    
    <tags>
      
      <tag>Java8</tag>
      
      <tag>Lambda</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Springå¥‡æŠ€æ·«å·§ä¹‹æ‰©å±•ç‚¹çš„åº”ç”¨</title>
    <link href="/blog/2021/04/10/Spring%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7%E4%B9%8B%E6%89%A9%E5%B1%95%E7%82%B9%E7%9A%84%E5%BA%94%E7%94%A8/"/>
    <url>/blog/2021/04/10/Spring%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7%E4%B9%8B%E6%89%A9%E5%B1%95%E7%82%B9%E7%9A%84%E5%BA%94%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<p><strong>é¦–å…ˆå…ˆä»‹ç»ä¸‹Beançš„ç”Ÿå‘½å‘¨æœŸã€</strong></p><p>æˆ‘ä»¬çŸ¥é“Beançš„ç”Ÿå‘½å‘¨æœŸåˆ†ä¸ºå‡ ä¸ªä¸»å¹²æµç¨‹</p><ul><li>Beanï¼ˆå•ä¾‹éæ‡’åŠ è½½ï¼‰çš„å®ä¾‹åŒ–é˜¶æ®µ</li><li>Beançš„å±æ€§æ³¨å…¥é˜¶æ®µ</li><li>Beançš„åˆå§‹åŒ–é˜¶æ®µ</li><li>Beançš„é”€æ¯é˜¶æ®µ</li></ul><p>ä¸‹é¢æ˜¯æ•´ä¸ªSpringå®¹å™¨çš„å¯åŠ¨æµç¨‹ï¼Œå¯ä»¥çœ‹åˆ°é™¤äº†ä¸Šè¿°å‡ ä¸ªä¸»å¹²æµç¨‹å¤–ï¼ŒSpringè¿˜æä¾›äº†å¾ˆå¤šæ‰©å±•ç‚¹</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/94786824dcf94545862fdd0dfa6d5407~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>ä¸‹é¢è¯¦ç»†ä»‹ç»ä¸‹Springçš„å¸¸è§çš„æ‰©å±•ç‚¹</p><h1 id="Springå¸¸è§æ‰©å±•ç‚¹"><a href="#Springå¸¸è§æ‰©å±•ç‚¹" class="headerlink" title="Springå¸¸è§æ‰©å±•ç‚¹"></a>Springå¸¸è§æ‰©å±•ç‚¹</h1><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/fc8a26e6e5334f5d92d36d9acdf65026~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p><strong>ã€ŒBeanFactoryPostProcessor#postProcessBeanFactoryã€</strong></p><p>æœ‰æ—¶å€™æ•´ä¸ªé¡¹ç›®å·¥ç¨‹ä¸­beançš„æ•°é‡æœ‰ä¸Šç™¾ä¸ªï¼Œè€Œå¤§éƒ¨åˆ†å•æµ‹ä¾èµ–éƒ½æ˜¯æ•´ä¸ªå·¥ç¨‹çš„xmlï¼Œå¯¼è‡´å•æµ‹æ‰§è¡Œæ—¶éœ€è¦å¾ˆé•¿æ—¶é—´ï¼ˆå¤§éƒ¨åˆ†æ—¶é—´è€—è´¹åœ¨xmlä¸­æ•°ç™¾ä¸ªå•ä¾‹éæ‡’åŠ è½½çš„beançš„å®ä¾‹åŒ–åŠåˆå§‹åŒ–è¿‡ç¨‹ï¼‰</p><p>è§£å†³æ–¹æ³•ï¼šåˆ©ç”¨Springæä¾›çš„æ‰©å±•ç‚¹å°†xmlä¸­çš„beanè®¾ç½®ä¸ºæ‡’åŠ è½½æ¨¡å¼ï¼Œçœå»äº†Beançš„å®ä¾‹åŒ–ä¸åˆå§‹åŒ–æ—¶é—´</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LazyBeanFactoryProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">BeanFactoryPostProcessor</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">postProcessBeanFactory</span><span class="hljs-params">(ConfigurableListableBeanFactory beanFactory)</span> <span class="hljs-keyword">throws</span> BeansException </span>&#123;<br>        DefaultListableBeanFactory fac = (DefaultListableBeanFactory) beanFactory;<br>        Map&lt;String, AbstractBeanDefinition&gt; map = (Map&lt;String, AbstractBeanDefinition&gt;) ReflectionTestUtils.getField(fac, <span class="hljs-string">&quot;beanDefinitionMap&quot;</span>);<br>        <span class="hljs-keyword">for</span> (Map.Entry&lt;String, AbstractBeanDefinition&gt; entry : map.entrySet()) &#123;<br>            <span class="hljs-comment">//è®¾ç½®ä¸ºæ‡’åŠ è½½</span><br>            entry.getValue().setLazyInit(<span class="hljs-keyword">true</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>ã€ŒInstantiationAwareBeanPostProcessor#postProcessPropertyValuesã€</strong></p><p>éå¸¸è§„çš„é…ç½®é¡¹æ¯”å¦‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;context:component-scan base-<span class="hljs-keyword">package</span>=<span class="hljs-string">&quot;com.zhou&quot;</span> /&gt;<br></code></pre></td></tr></table></figure><p>Springæä¾›äº†ä¸ä¹‹å¯¹åº”çš„ç‰¹æ®Šè§£æå™¨</p><p>æ­£æ˜¯é€šè¿‡è¿™äº›ç‰¹æ®Šçš„è§£æå™¨æ‰ä½¿å¾—å¯¹åº”çš„é…ç½®é¡¹èƒ½å¤Ÿç”Ÿæ•ˆ</p><p>è€Œé’ˆå¯¹è¿™ä¸ªç‰¹æ®Šé…ç½®çš„è§£æå™¨ä¸º ComponentScanBeanDefinitionParser</p><p>åœ¨è¿™ä¸ªè§£æå™¨çš„è§£ææ–¹æ³•ä¸­ï¼Œæ³¨å†Œäº†å¾ˆå¤šç‰¹æ®Šçš„Bean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> BeanDefinition <span class="hljs-title">parse</span><span class="hljs-params">(Element element, ParserContext parserContext)</span> </span>&#123;<br>  <span class="hljs-comment">//...</span><br>  registerComponents(parserContext.getReaderContext(), beanDefinitions, element);<br>    <span class="hljs-comment">//...</span><br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>&#125;<br>å¤åˆ¶ä»£ç <br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Set&lt;BeanDefinitionHolder&gt; <span class="hljs-title">registerAnnotationConfigProcessors</span><span class="hljs-params">(</span></span><br><span class="hljs-function"><span class="hljs-params">   BeanDefinitionRegistry registry, Object source)</span> </span>&#123;<br><br>  Set&lt;BeanDefinitionHolder&gt; beanDefs = <span class="hljs-keyword">new</span> LinkedHashSet&lt;BeanDefinitionHolder&gt;(<span class="hljs-number">4</span>);<br>  <span class="hljs-comment">//...</span><br>    <span class="hljs-comment">//@Autowire</span><br>  <span class="hljs-keyword">if</span> (!registry.containsBeanDefinition(AUTOWIRED_ANNOTATION_PROCESSOR_BEAN_NAME)) &#123;<br>   RootBeanDefinition def = <span class="hljs-keyword">new</span> RootBeanDefinition(AutowiredAnnotationBeanPostProcessor.class);<br>   def.setSource(source);<br>   beanDefs.add(registerPostProcessor(registry, def, AUTOWIRED_ANNOTATION_PROCESSOR_BEAN_NAME));<br>  &#125;<br><br>  <span class="hljs-comment">// Check for JSR-250 support, and if present add the CommonAnnotationBeanPostProcessor.</span><br>   <span class="hljs-comment">//@Resource</span><br>  <span class="hljs-keyword">if</span> (jsr250Present &amp;&amp; !registry.containsBeanDefinition(COMMON_ANNOTATION_PROCESSOR_BEAN_NAME)) &#123;<br>      <span class="hljs-comment">//ç‰¹æ®Šçš„Bean</span><br>   RootBeanDefinition def = <span class="hljs-keyword">new</span> RootBeanDefinition(CommonAnnotationBeanPostProcessor.class);<br>   def.setSource(source);<br>   beanDefs.add(registerPostProcessor(registry, def, COMMON_ANNOTATION_PROCESSOR_BEAN_NAME));<br>  &#125;<br>  <span class="hljs-comment">//...</span><br>  <span class="hljs-keyword">return</span> beanDefs;<br> &#125;<br></code></pre></td></tr></table></figure><p>ä»¥@Resourceä¸ºä¾‹ï¼Œçœ‹çœ‹è¿™ä¸ªç‰¹æ®Šçš„beanåšäº†ä»€ä¹ˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CommonAnnotationBeanPostProcessor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">InitDestroyAnnotationBeanPostProcessor</span></span><br><span class="hljs-class">  <span class="hljs-keyword">implements</span> <span class="hljs-title">InstantiationAwareBeanPostProcessor</span>, <span class="hljs-title">BeanFactoryAware</span>, <span class="hljs-title">Serializable</span> </span>&#123;<br>     <br>      <span class="hljs-function"><span class="hljs-keyword">public</span> PropertyValues <span class="hljs-title">postProcessPropertyValues</span><span class="hljs-params">(PropertyValues pvs, PropertyDescriptor[] pds, </span></span><br><span class="hljs-function"><span class="hljs-params">      Object bean, String beanName)</span> <span class="hljs-keyword">throws</span> BeansException </span>&#123;<br>          InjectionMetadata metadata = findResourceMetadata(beanName, bean.getClass());<br>          <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//å±æ€§æ³¨å…¥</span><br>            metadata.inject(bean, beanName, pvs);<br>          &#125;<br>          <span class="hljs-keyword">catch</span> (Throwable ex) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanCreationException(beanName, <span class="hljs-string">&quot;Injection of resource dependencies failed&quot;</span>, ex);<br>          &#125;<br>          <span class="hljs-keyword">return</span> pvs;<br>    &#125;<br>    <br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹åˆ°åœ¨postProcessPropertyValuesæ–¹æ³•ä¸­ï¼Œè¿›è¡Œäº†å±æ€§æ³¨å…¥</p><p><strong>ã€ŒinvokeAwareã€</strong></p><p>å®ç°BeanFactoryAwareæ¥å£çš„ç±»ï¼Œä¼šç”±å®¹å™¨æ‰§è¡ŒsetBeanFactoryæ–¹æ³•å°†å½“å‰çš„å®¹å™¨BeanFactoryæ³¨å…¥åˆ°ç±»ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BeanFactoryHolder</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">BeanFactoryAware</span></span>&#123;<br>   <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> BeanFactory beanFactory;<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setBeanFactory</span><span class="hljs-params">(BeanFactory beanFactory)</span> <span class="hljs-keyword">throws</span> BeansException </span>&#123;<br>        <span class="hljs-keyword">this</span>.beanFactory = beanFactory;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>ã€ŒBeanPostProcessor#postProcessBeforeInitializationã€</strong></p><p>å®ç°ApplicationContextAwareæ¥å£çš„ç±»ï¼Œä¼šç”±å®¹å™¨æ‰§è¡ŒsetApplicationContextæ–¹æ³•å°†å½“å‰çš„å®¹å™¨applicationContextæ³¨å…¥åˆ°ç±»ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApplicationContextAwareProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">BeanPostProcessor</span> </span>&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConfigurableApplicationContext applicationContext;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ApplicationContextAwareProcessor</span><span class="hljs-params">(ConfigurableApplicationContext applicationContext)</span> </span>&#123;<br>      <span class="hljs-keyword">this</span>.applicationContext = applicationContext;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">postProcessBeforeInitialization</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Object bean, String beanName)</span> <span class="hljs-keyword">throws</span> BeansException </span>&#123;<br>      <span class="hljs-comment">//...</span><br>      invokeAwareInterfaces(bean);<br>      <span class="hljs-keyword">return</span> bean;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">invokeAwareInterfaces</span><span class="hljs-params">(Object bean)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (bean <span class="hljs-keyword">instanceof</span> ApplicationContextAware) &#123;<br>          ((ApplicationContextAware) bean).setApplicationContext(<span class="hljs-keyword">this</span>.applicationContext);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹åˆ°æ˜¯åœ¨BeanPostProcessorçš„postProcessBeforeInitializationä¸­è¿›è¡Œäº†setApplicationContextæ–¹æ³•çš„è°ƒç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApplicationContextHolder</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ApplicationContextAware</span></span>&#123;<br>   <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ApplicationContext applicationContext;<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setApplicationContext</span><span class="hljs-params">(ApplicationContext applicationContext)</span> <span class="hljs-keyword">throws</span> BeansException </span>&#123;<br>        <span class="hljs-keyword">this</span>.applicationContext = applicationContext;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>ã€ŒafterPropertySet()å’Œinit-methodã€</strong></p><p>ç›®å‰å¾ˆå¤šJavaä¸­é—´ä»¶éƒ½æ˜¯åŸºæœ¬Spring Frameworkæ­å»ºçš„ï¼Œè€Œè¿™äº›ä¸­é—´ä»¶ç»å¸¸æŠŠå…¥å£æ”¾åˆ°afterPropertySetæˆ–è€…è‡ªå®šä¹‰çš„initä¸­</p><p><strong>ã€ŒBeanPostProcessor#postProcessAfterInitializationã€</strong></p><p>ç†Ÿæ‚‰aopçš„åŒå­¦åº”è¯¥çŸ¥é“ï¼Œaopåº•å±‚æ˜¯é€šè¿‡åŠ¨æ€ä»£ç†å®ç°çš„</p><p>å½“é…ç½®äº†<code>&lt;aop:aspectj-autoproxy/&gt;</code>æ—¶å€™ï¼Œé»˜è®¤å¼€å¯aopåŠŸèƒ½ï¼Œç›¸åº”åœ°è°ƒç”¨æ–¹éœ€è¦è¢«aopç»‡å…¥çš„å¯¹è±¡ä¹Ÿéœ€è¦æ›¿æ¢ä¸ºåŠ¨æ€ä»£ç†å¯¹è±¡</p><p>ä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰æ€è€ƒè¿‡åŠ¨æ€ä»£ç†æ˜¯å¦‚ä½•<strong>ã€Œåœ¨è°ƒç”¨æ–¹æ— æ„ŸçŸ¥æƒ…å†µä¸‹æ›¿æ¢åŸå§‹å¯¹è±¡ã€</strong>çš„ï¼Ÿ</p><blockquote><p>â</p><p>æ ¹æ®ä¸Šæ–‡çš„è®²è§£ï¼Œæˆ‘ä»¬çŸ¥é“ï¼š</p><p>â</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;aop:aspectj-autoproxy/&gt;<br></code></pre></td></tr></table></figure><p>Springä¹Ÿæä¾›äº†ç‰¹æ®Šçš„è§£æå™¨ï¼Œå’Œå…¶ä»–çš„è§£æå™¨ç±»ä¼¼ï¼Œåœ¨æ ¸å¿ƒçš„parseæ–¹æ³•ä¸­æ³¨å†Œäº†ç‰¹æ®Šçš„bean</p><p>è¿™é‡Œæ˜¯ä¸€ä¸ªBeanPostProcessorç±»å‹çš„bean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AspectJAutoProxyBeanDefinitionParser</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">BeanDefinitionParser</span> </span>&#123;<br> <span class="hljs-meta">@Override</span><br> <span class="hljs-function"><span class="hljs-keyword">public</span> BeanDefinition <span class="hljs-title">parse</span><span class="hljs-params">(Element element, ParserContext parserContext)</span> </span>&#123;<br>    <span class="hljs-comment">//æ³¨å†Œç‰¹æ®Šçš„bean</span><br>  AopNamespaceUtils.registerAspectJAnnotationAutoProxyCreatorIfNecessary(parserContext, element);<br>  extendBeanDefinition(element, parserContext);<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å°†äºå½“å‰beanå¯¹åº”çš„åŠ¨æ€ä»£ç†å¯¹è±¡è¿”å›å³å¯ï¼Œè¯¥è¿‡ç¨‹å¯¹è°ƒç”¨æ–¹å…¨éƒ¨é€æ˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AnnotationAwareAspectJAutoProxyCreator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AspectJAwareAdvisorAutoProxyCreator</span> </span>&#123;<br>  <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">postProcessAfterInitialization</span><span class="hljs-params">(Object bean, String beanName)</span> <span class="hljs-keyword">throws</span> BeansException </span>&#123;<br>        <span class="hljs-keyword">if</span> (bean != <span class="hljs-keyword">null</span>) &#123;<br>          Object cacheKey = getCacheKey(bean.getClass(), beanName);<br>          <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.earlyProxyReferences.containsKey(cacheKey)) &#123;<br>            <span class="hljs-comment">//å¦‚æœè¯¥ç±»éœ€è¦è¢«ä»£ç†ï¼Œè¿”å›åŠ¨æ€ä»£ç†å¯¹è±¡ï¼›åä¹‹ï¼Œè¿”å›åŸå¯¹è±¡</span><br>            <span class="hljs-keyword">return</span> wrapIfNecessary(bean, beanName, cacheKey);<br>          &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> bean;<br> &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ­£æ˜¯åˆ©ç”¨Springçš„è¿™ä¸ªæ‰©å±•ç‚¹å®ç°äº†åŠ¨æ€ä»£ç†å¯¹è±¡çš„æ›¿æ¢</p><p><strong>ã€Œdestroy()å’Œdestroy-methodã€</strong></p><p>beanç”Ÿå‘½å‘¨æœŸçš„æœ€åä¸€ä¸ªæ‰©å±•ç‚¹ï¼Œè¯¥æ–¹æ³•ç”¨äºæ‰§è¡Œä¸€äº›beané”€æ¯å‰çš„å‡†å¤‡å·¥ä½œï¼Œæ¯”å¦‚å°†å½“å‰beanæŒæœ‰çš„ä¸€äº›èµ„æºé‡Šæ”¾æ‰</p>]]></content>
    
    
    
    <tags>
      
      <tag>Spring</tag>
      
      <tag>åº”ç”¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å·¥ä½œå››å¹´ï¼Œåˆ†äº«50ä¸ªè®©ä½ ä»£ç æ›´å¥½çš„å°å»ºè®®</title>
    <link href="/blog/2021/04/04/%E5%88%86%E4%BA%AB50%E4%B8%AA%E8%AE%A9%E4%BD%A0%E4%BB%A3%E7%A0%81%E6%9B%B4%E5%A5%BD%E7%9A%84%E5%B0%8F%E5%BB%BA%E8%AE%AE/"/>
    <url>/blog/2021/04/04/%E5%88%86%E4%BA%AB50%E4%B8%AA%E8%AE%A9%E4%BD%A0%E4%BB%A3%E7%A0%81%E6%9B%B4%E5%A5%BD%E7%9A%84%E5%B0%8F%E5%BB%BA%E8%AE%AE/</url>
    
    <content type="html"><![CDATA[<h3 id="1-ä»…æ˜¯åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ—¶ï¼Œselect-count-æ¯”-select-å…·ä½“çš„åˆ—ï¼Œæ›´å¥½ã€‚"><a href="#1-ä»…æ˜¯åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ—¶ï¼Œselect-count-æ¯”-select-å…·ä½“çš„åˆ—ï¼Œæ›´å¥½ã€‚" class="headerlink" title="1. ä»…æ˜¯åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ—¶ï¼Œselect count æ¯” select å…·ä½“çš„åˆ—ï¼Œæ›´å¥½ã€‚"></a>1. ä»…æ˜¯åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ—¶ï¼Œselect count æ¯” select å…·ä½“çš„åˆ—ï¼Œæ›´å¥½ã€‚</h3><p>æˆ‘ä»¬ç»å¸¸é‡åˆ°ç±»ä¼¼çš„ä¸šåŠ¡åœºæ™¯ï¼Œå¦‚ï¼Œåˆ¤æ–­æŸä¸ªç”¨æˆ·<code>userId</code>æ˜¯å¦æ˜¯ä¼šå‘˜ã€‚</p><p><strong>ï¼ˆåä¾‹ï¼‰ï¼š</strong>  ä¸€äº›å°ä¼™ä¼´ä¼šè¿™æ ·å®ç°ï¼Œå…ˆæŸ¥ä»ç”¨æˆ·ä¿¡æ¯è¡¨æŸ¥å‡ºç”¨æˆ·è®°å½•ï¼Œç„¶åå†å»åˆ¤æ–­æ˜¯å¦æ˜¯ä¼šå‘˜:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs csharp">&lt;<span class="hljs-keyword">select</span> id=<span class="hljs-string">&quot;selectUserByUserId&quot;</span> resultMap=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;<br>     selct user_id , vip_flag <span class="hljs-keyword">from</span>  user_info <span class="hljs-keyword">where</span> user_id =<span class="hljs-meta">#&#123;userId&#125;;</span><br> &lt;/<span class="hljs-keyword">select</span>&gt;<br><br><span class="hljs-function">boolean <span class="hljs-title">isVip</span> (<span class="hljs-params">String userId</span>)</span>&#123;<br>  UserInfo userInfo = userInfoDAp.selectUserByUserId(userId);<br>  <span class="hljs-keyword">return</span> UserInfo!=<span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-string">&quot;Y&quot;</span>.<span class="hljs-keyword">equals</span>(userInfo.getVipFlag())<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p><strong>ï¼ˆæ­£ä¾‹ï¼‰ï¼š</strong> é’ˆå¯¹è¿™ç§ä¸šåŠ¡åœºæ™¯ï¼Œå…¶å®æ›´å¥½çš„å®ç°ï¼Œæ˜¯ç›´æ¥<code>select count</code>ä¸€ä¸‹ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">&lt;<span class="hljs-keyword">select</span> id=<span class="hljs-string">&quot;countVipUserByUserId&quot;</span> resultType=<span class="hljs-string">&quot;java.lang.Integer&quot;</span>&gt;<br>     selct <span class="hljs-built_in">count</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">from</span>  user_info <span class="hljs-keyword">where</span> user_id =#&#123;userId&#125; <span class="hljs-keyword">and</span> vip_flag =<span class="hljs-string">&#x27;Y&#x27;</span>;<br> &lt;/<span class="hljs-keyword">select</span>&gt;<br> <br> <span class="hljs-keyword">boolean</span> isVip (<span class="hljs-keyword">String</span> userId)&#123;<br>  int vipNum = userInfoDAp.countVipUserByUserId(userId);<br>  return vipNum&gt;0<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><h3 id="2-å¤æ‚çš„ifé€»è¾‘æ¡ä»¶ï¼Œå¯ä»¥è°ƒæ•´é¡ºåºï¼Œè®©ç¨‹åºæ›´é«˜æ•ˆ"><a href="#2-å¤æ‚çš„ifé€»è¾‘æ¡ä»¶ï¼Œå¯ä»¥è°ƒæ•´é¡ºåºï¼Œè®©ç¨‹åºæ›´é«˜æ•ˆ" class="headerlink" title="2. å¤æ‚çš„ifé€»è¾‘æ¡ä»¶ï¼Œå¯ä»¥è°ƒæ•´é¡ºåºï¼Œè®©ç¨‹åºæ›´é«˜æ•ˆ"></a>2. å¤æ‚çš„ifé€»è¾‘æ¡ä»¶ï¼Œå¯ä»¥è°ƒæ•´é¡ºåºï¼Œè®©ç¨‹åºæ›´é«˜æ•ˆ</h3><p>å‡è®¾ä¸šåŠ¡éœ€æ±‚æ˜¯è¿™æ ·ï¼šå¦‚æœç”¨æˆ·æ˜¯ä¼šå‘˜ï¼Œå¹¶ä¸”ç¬¬ä¸€æ¬¡ç™»é™†æ—¶ï¼Œéœ€è¦å‘ä¸€æ¡é€šçŸ¥çš„çŸ­ä¿¡ã€‚å‡å¦‚æ²¡æœ‰ç»è¿‡æ€è€ƒï¼Œä»£ç å¾ˆå¯èƒ½ç›´æ¥è¿™æ ·å†™äº†ã€‚</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-function"><span class="hljs-title">if</span>(<span class="hljs-variable">isUserVip</span> &amp;&amp; <span class="hljs-variable">isFirstLogin</span>)&#123;</span><br><span class="hljs-function">    <span class="hljs-title">sendMsgNotify</span>();</span><br><span class="hljs-function">&#125;</span><br><span class="hljs-function">å¤åˆ¶ä»£ç </span><br></code></pre></td></tr></table></figure><p>å‡è®¾æ€»å…±æœ‰5ä¸ªè¯·æ±‚è¿›æ¥ï¼ŒisUserVipé€šè¿‡çš„æœ‰3ä¸ªè¯·æ±‚ï¼ŒisFirstLoginé€šè¿‡çš„æœ‰1ä¸ªè¯·æ±‚ã€‚ é‚£ä¹ˆä»¥ä¸Šä»£ç ï¼ŒisUserVipæ‰§è¡Œçš„æ¬¡æ•°ä¸º5æ¬¡ï¼ŒisFirstLoginæ‰§è¡Œçš„æ¬¡æ•°ä¹Ÿæ˜¯3æ¬¡ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/b30c2899d10f4258bf1fc94a9ebf324c~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p><p>å¦‚æœè°ƒæ•´ä¸€ä¸‹isUserVipå’ŒisFirstLoginçš„é¡ºåºå‘¢ï¼Ÿ</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-function"><span class="hljs-title">if</span>(<span class="hljs-variable">isFirstLogin</span> &amp;&amp; <span class="hljs-variable">isUserVip</span> )&#123;</span><br><span class="hljs-function">    <span class="hljs-title">sendMsg</span>();</span><br><span class="hljs-function">&#125;</span><br><span class="hljs-function">å¤åˆ¶ä»£ç </span><br></code></pre></td></tr></table></figure><p>isFirstLoginæ‰§è¡Œçš„æ¬¡æ•°æ˜¯5æ¬¡ï¼ŒisUserVipæ‰§è¡Œçš„æ¬¡æ•°æ˜¯1æ¬¡ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/103a20c642e04ea899d74c4cb8187b28~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p><p>å¦‚æœä½ çš„isFirstLoginï¼Œåˆ¤æ–­é€»è¾‘åªæ˜¯select count ä¸€ä¸‹æ•°æ®åº“è¡¨ï¼ŒisUserVipä¹Ÿæ˜¯select count ä¸€ä¸‹æ•°æ®åº“è¡¨çš„è¯ï¼Œæ˜¾ç„¶ï¼ŒæŠŠisFirstLoginæ”¾åœ¨å‰é¢æ›´é«˜æ•ˆã€‚</p><h3 id="3-å†™æŸ¥è¯¢Sqlçš„æ—¶å€™ï¼ŒåªæŸ¥ä½ éœ€è¦ç”¨åˆ°çš„å­—æ®µï¼Œè¿˜æœ‰é€šç”¨çš„å­—æ®µï¼Œæ‹’ç»åæ‰‹çš„select"><a href="#3-å†™æŸ¥è¯¢Sqlçš„æ—¶å€™ï¼ŒåªæŸ¥ä½ éœ€è¦ç”¨åˆ°çš„å­—æ®µï¼Œè¿˜æœ‰é€šç”¨çš„å­—æ®µï¼Œæ‹’ç»åæ‰‹çš„select" class="headerlink" title="3. å†™æŸ¥è¯¢Sqlçš„æ—¶å€™ï¼ŒåªæŸ¥ä½ éœ€è¦ç”¨åˆ°çš„å­—æ®µï¼Œè¿˜æœ‰é€šç”¨çš„å­—æ®µï¼Œæ‹’ç»åæ‰‹çš„select *"></a>3. å†™æŸ¥è¯¢Sqlçš„æ—¶å€™ï¼ŒåªæŸ¥ä½ éœ€è¦ç”¨åˆ°çš„å­—æ®µï¼Œè¿˜æœ‰é€šç”¨çš„å­—æ®µï¼Œæ‹’ç»åæ‰‹çš„select *</h3><p><strong>åä¾‹ï¼š</strong></p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs axapta"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> user_info <span class="hljs-keyword">where</span> user_id =<span class="hljs-meta">#&#123;userId&#125;;</span><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p><strong>æ­£ä¾‹ï¼š</strong></p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript"> selct user_id , vip_flag <span class="hljs-keyword">from</span>  user_info <span class="hljs-keyword">where</span> user_id =<span class="hljs-comment">#&#123;userId&#125;;</span><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p><strong>ç†ç”±ï¼š</strong></p><ul><li>èŠ‚çœèµ„æºã€å‡å°‘ç½‘ç»œå¼€é”€ã€‚</li><li>å¯èƒ½ç”¨åˆ°è¦†ç›–ç´¢å¼•ï¼Œå‡å°‘å›è¡¨ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</li></ul><h3 id="4-ä¼˜åŒ–ä½ çš„ç¨‹åºï¼Œæ‹’ç»åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡"><a href="#4-ä¼˜åŒ–ä½ çš„ç¨‹åºï¼Œæ‹’ç»åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡" class="headerlink" title="4. ä¼˜åŒ–ä½ çš„ç¨‹åºï¼Œæ‹’ç»åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡"></a>4. ä¼˜åŒ–ä½ çš„ç¨‹åºï¼Œæ‹’ç»åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡</h3><p>å¦‚æœä½ çš„å˜é‡ï¼Œåé¢çš„é€»è¾‘åˆ¤æ–­ï¼Œä¸€å®šä¼šè¢«èµ‹å€¼ï¼›æˆ–è€…è¯´ï¼Œåªæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å˜é‡ï¼Œç›´æ¥åˆå§‹åŒ–å­—ç¬¦ä¸²å¸¸é‡å°±å¯ä»¥äº†ï¼Œæ²¡æœ‰å¿…è¦æ„£æ˜¯è¦new String().</p><p>åä¾‹ï¼š</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">String</span> s = <span class="hljs-keyword">new</span> <span class="hljs-keyword">String</span> (<span class="hljs-string">&quot;æ¬¢è¿å…³æ³¨å…¬ä¼—å·ï¼šæ¡ç”°èºçš„å°ç”·å­©&quot;</span>);<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>æ­£ä¾‹ï¼š</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs 1c">String s=  <span class="hljs-string">&quot;æ¬¢è¿å…³æ³¨å…¬ä¼—å·ï¼šæ¡ç”°èºçš„å°ç”·å­© â€;</span><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><h3 id="5-åˆå§‹åŒ–é›†åˆæ—¶ï¼ŒæŒ‡å®šå®¹é‡"><a href="#5-åˆå§‹åŒ–é›†åˆæ—¶ï¼ŒæŒ‡å®šå®¹é‡" class="headerlink" title="5. åˆå§‹åŒ–é›†åˆæ—¶ï¼ŒæŒ‡å®šå®¹é‡"></a>5. åˆå§‹åŒ–é›†åˆæ—¶ï¼ŒæŒ‡å®šå®¹é‡</h3><p>é˜¿é‡Œçš„å¼€å‘æ‰‹å†Œï¼Œä¹Ÿæ˜ç¡®æåˆ°è¿™ä¸ªç‚¹ï¼š </p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/image-20210404075408639.png" alt="image-20210404075408639"></p><p>å‡è®¾ä½ çš„mapè¦å­˜å‚¨çš„å…ƒç´ ä¸ªæ•°æ˜¯15ä¸ªå·¦å³ï¼Œæœ€ä¼˜å†™æ³•å¦‚ä¸‹</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs lasso"> <span class="hljs-comment">//initialCapacity = 15/0.75+1=21</span><br> <span class="hljs-built_in">Map</span> <span class="hljs-built_in">map</span> = <span class="hljs-literal">new</span> HashMap(<span class="hljs-number">21</span>);<br> åˆå› ä¸ºhashMapçš„å®¹é‡è·Ÿ<span class="hljs-number">2</span>çš„å¹‚æœ‰å…³ï¼Œæ‰€ä»¥å¯ä»¥å–<span class="hljs-number">32</span>çš„å®¹é‡<br> <span class="hljs-built_in">Map</span> <span class="hljs-built_in">map</span> = <span class="hljs-literal">new</span> HashMap(<span class="hljs-number">32</span>);<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><h3 id="6-catchäº†å¼‚å¸¸ï¼Œéœ€è¦æ‰“å°å‡ºå…·ä½“çš„exceptionï¼Œæ–¹ä¾¿æ›´å¥½å®šä½é—®é¢˜"><a href="#6-catchäº†å¼‚å¸¸ï¼Œéœ€è¦æ‰“å°å‡ºå…·ä½“çš„exceptionï¼Œæ–¹ä¾¿æ›´å¥½å®šä½é—®é¢˜" class="headerlink" title="6.catchäº†å¼‚å¸¸ï¼Œéœ€è¦æ‰“å°å‡ºå…·ä½“çš„exceptionï¼Œæ–¹ä¾¿æ›´å¥½å®šä½é—®é¢˜"></a>6.catchäº†å¼‚å¸¸ï¼Œéœ€è¦æ‰“å°å‡ºå…·ä½“çš„exceptionï¼Œæ–¹ä¾¿æ›´å¥½å®šä½é—®é¢˜</h3><p><strong>åä¾‹ï¼š</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">try</span>&#123;<br>  <span class="hljs-comment">// do something</span><br>&#125;<span class="hljs-keyword">catch</span>(Exception e)&#123;<br>  <span class="hljs-built_in">log</span>.info(<span class="hljs-string">&quot;æ¡ç”°èºçš„å°ç”·å­©ï¼Œä½ çš„ç¨‹åºæœ‰å¼‚å¸¸å•¦&quot;</span>);<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p><strong>æ­£ä¾‹ï¼š</strong></p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">try</span>&#123;<br>  <span class="hljs-comment">// do something</span><br>&#125;<span class="hljs-keyword">catch</span>(Exception e)&#123;<br>  <span class="hljs-built_in">log</span>.info(<span class="hljs-string">&quot;æ¡ç”°èºçš„å°ç”·å­©ï¼Œä½ çš„ç¨‹åºæœ‰å¼‚å¸¸å•¦ï¼š&quot;</span>,e); <span class="hljs-comment">//æŠŠexceptionæ‰“å°å‡ºæ¥</span><br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p><strong>ç†ç”±ï¼š</strong></p><ul><li>åä¾‹ä¸­ï¼Œå¹¶æ²¡æœ‰æŠŠexceptionå‡ºæ¥ï¼Œåˆ°æ—¶å€™æ’æŸ¥é—®é¢˜å°±ä¸å¥½æŸ¥äº†å•¦ï¼Œåˆ°åº•æ˜¯SQlå†™é”™çš„å¼‚å¸¸è¿˜æ˜¯IOå¼‚å¸¸ï¼Œè¿˜æ˜¯å…¶ä»–å‘¢ï¼Ÿæ‰€ä»¥åº”è¯¥æŠŠexceptionæ‰“å°åˆ°æ—¥å¿—ä¸­å“¦~</li></ul><h3 id="7-æ‰“å°æ—¥å¿—çš„æ—¶å€™ï¼Œå¯¹è±¡æ²¡æœ‰è¦†ç›–Objectçš„toStringçš„æ–¹æ³•ï¼Œç›´æ¥æŠŠç±»åæ‰“å°å‡ºæ¥äº†ã€‚"><a href="#7-æ‰“å°æ—¥å¿—çš„æ—¶å€™ï¼Œå¯¹è±¡æ²¡æœ‰è¦†ç›–Objectçš„toStringçš„æ–¹æ³•ï¼Œç›´æ¥æŠŠç±»åæ‰“å°å‡ºæ¥äº†ã€‚" class="headerlink" title="7. æ‰“å°æ—¥å¿—çš„æ—¶å€™ï¼Œå¯¹è±¡æ²¡æœ‰è¦†ç›–Objectçš„toStringçš„æ–¹æ³•ï¼Œç›´æ¥æŠŠç±»åæ‰“å°å‡ºæ¥äº†ã€‚"></a>7. æ‰“å°æ—¥å¿—çš„æ—¶å€™ï¼Œå¯¹è±¡æ²¡æœ‰è¦†ç›–Objectçš„toStringçš„æ–¹æ³•ï¼Œç›´æ¥æŠŠç±»åæ‰“å°å‡ºæ¥äº†ã€‚</h3><p>æˆ‘ä»¬åœ¨æ‰“å°æ—¥å¿—çš„æ—¶å€™ï¼Œç»å¸¸æƒ³çœ‹ä¸‹ä¸€ä¸ªè¯·æ±‚å‚æ•°å¯¹è±¡requestæ˜¯ä»€ä¹ˆã€‚äºæ˜¯å¾ˆå®¹æ˜“æœ‰ç±»ä¼¼ä»¥ä¸‹è¿™äº›ä»£ç ï¼š</p><figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs vbscript">publick <span class="hljs-built_in">Response</span> dealWithRequest(<span class="hljs-built_in">Request</span> <span class="hljs-built_in">request</span>)&#123;<br>   log.info(<span class="hljs-string">&quot;è¯·æ±‚å‚æ•°æ˜¯ï¼š&quot;</span>.<span class="hljs-built_in">request</span>.toString)<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>æ‰“å°ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs autoit">è¯·æ±‚å‚æ•°æ˜¯ï¼š<span class="hljs-keyword">local</span>.Request<span class="hljs-symbol">@49476842</span><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¿™æ˜¯å› ä¸ºå¯¹è±¡çš„toStringæ–¹æ³•ï¼Œé»˜è®¤çš„å®ç°æ˜¯â€œç±»å@æ•£åˆ—ç çš„æ— ç¬¦å·åå…­è¿›åˆ¶â€ã€‚æ‰€ä»¥ä½ çœ‹å§ï¼Œè¿™æ ·å­æ‰“å°æ—¥å¿—å°±æ²¡å•¥æ„æ€å•¦ï¼Œä½ éƒ½ä¸çŸ¥é“æ‰“å°çš„æ˜¯ä»€ä¹ˆå†…å®¹ã€‚</p><p>æ‰€ä»¥ä¸€èˆ¬å¯¹è±¡(å°¤å…¶ä½œä¸ºä¼ å‚çš„å¯¹è±¡ï¼‰ï¼Œ<strong>éƒ½è¦†ç›–é‡å†™toString()æ–¹æ³•</strong>ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Request</span> </span>&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">String</span> age;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">String</span> name;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">String</span> <span class="hljs-function"><span class="hljs-title">toString</span>(<span class="hljs-params"></span>)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Request&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;age=&#x27;&quot;</span> + age + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br>&#125;<br><br>publick Response <span class="hljs-function"><span class="hljs-title">dealWithRequest</span>(<span class="hljs-params">Request request</span>)</span>&#123;<br>   log.info(<span class="hljs-string">&quot;è¯·æ±‚å‚æ•°æ˜¯ï¼š&quot;</span>.request.toString)<br>&#125;<br><br><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>æ‰“å°ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">è¯·æ±‚å‚æ•°æ˜¯ï¼šRequest&#123;<span class="hljs-attribute">age</span>=<span class="hljs-string">&#x27;26&#x27;</span>, <span class="hljs-attribute">name</span>=<span class="hljs-string">&#x27;å…¬ä¼—å·ï¼šæ¡ç”°èºçš„å°ç”·å­©&#x27;</span>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><h3 id="8-ä¸€ä¸ªæ–¹æ³•ï¼Œæ‹’ç»è¿‡é•¿çš„å‚æ•°åˆ—è¡¨ã€‚"><a href="#8-ä¸€ä¸ªæ–¹æ³•ï¼Œæ‹’ç»è¿‡é•¿çš„å‚æ•°åˆ—è¡¨ã€‚" class="headerlink" title="8. ä¸€ä¸ªæ–¹æ³•ï¼Œæ‹’ç»è¿‡é•¿çš„å‚æ•°åˆ—è¡¨ã€‚"></a>8. ä¸€ä¸ªæ–¹æ³•ï¼Œæ‹’ç»è¿‡é•¿çš„å‚æ•°åˆ—è¡¨ã€‚</h3><p>å‡è®¾æœ‰è¿™ä¹ˆä¸€ä¸ªå…¬æœ‰æ–¹æ³•ï¼Œå½¢å‚æœ‰å››ä¸ªã€‚ã€‚ã€‚</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> getUserInfoï¼ˆ<span class="hljs-keyword">String</span> name,<span class="hljs-keyword">String</span> age,<span class="hljs-keyword">String</span> sex,<span class="hljs-keyword">String</span> mobile)&#123;<br>  <span class="hljs-comment">// do something ...</span><br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>å¦‚æœç°åœ¨éœ€è¦å¤šä¼ ä¸€ä¸ªversionå‚æ•°è¿›æ¥ï¼Œå¹¶ä¸”ä½ çš„å…¬æœ‰æ–¹æ³•æ˜¯ç±»ä¼¼dubboè¿™ç§å¯¹å¤–æä¾›çš„æ¥å£çš„è¯ï¼Œé‚£ä¹ˆä½ çš„æ¥å£æ˜¯ä¸æ˜¯éœ€è¦å…¼å®¹è€ç‰ˆæœ¬å•¦ï¼Ÿ</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> getUserInfoï¼ˆ<span class="hljs-keyword">String</span> name,<span class="hljs-keyword">String</span> age,<span class="hljs-keyword">String</span> sex,<span class="hljs-keyword">String</span> mobile)&#123;<br>  <span class="hljs-comment">// do something ...</span><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ–°æ¥å£è°ƒè¿™é‡Œ</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> getNewUserInfoï¼ˆ<span class="hljs-keyword">String</span> name,<span class="hljs-keyword">String</span> age,<span class="hljs-keyword">String</span> sex,<span class="hljs-keyword">String</span> mobileï¼Œ<span class="hljs-keyword">String</span> version)&#123;<br>  <span class="hljs-comment">// do something ...</span><br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>æ‰€ä»¥å‘¢ï¼Œä¸€èˆ¬ä¸€ä¸ªæ–¹æ³•çš„å‚æ•°ï¼Œä¸€èˆ¬ä¸å®œè¿‡é•¿ã€‚è¿‡é•¿çš„å‚æ•°åˆ—è¡¨ï¼Œä¸ä»…çœ‹èµ·æ¥ä¸ä¼˜é›…ï¼Œå¹¶ä¸”æ¥å£å‡çº§æ—¶ï¼Œå¯èƒ½è¿˜è¦è€ƒè™‘æ–°è€ç‰ˆæœ¬å…¼å®¹ã€‚å¦‚æœå‚æ•°å®åœ¨æ˜¯å¤šæ€ä¹ˆåŠå‘¢ï¼Ÿå¯ä»¥ç”¨ä¸ªDTOå¯¹è±¡åŒ…è£…ä¸€ä¸‹è¿™äº›å‚æ•°å‘¢~å¦‚ä¸‹ï¼š</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> getUserInfoï¼ˆUserInfoParamDTO userInfoParamDTO)&#123;<br>  <span class="hljs-comment">// do something ...</span><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserInfoParamDTO</span>&#123;</span><br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">String</span> name;<br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">String</span> age; <br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">String</span> sex;<br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">String</span> mobile;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>ç”¨ä¸ªDTOå¯¹è±¡åŒ…è£…ä¸€ä¸‹ï¼Œå³ä½¿åé¢æœ‰å‚æ•°å˜åŠ¨ï¼Œä¹Ÿå¯ä»¥ä¸ç”¨åŠ¨å¯¹å¤–æ¥å£äº†ï¼Œå¥½å¤„æ æ çš„ã€‚</p><h3 id="9-ä½¿ç”¨ç¼“å†²æµï¼Œå‡å°‘IOæ“ä½œ"><a href="#9-ä½¿ç”¨ç¼“å†²æµï¼Œå‡å°‘IOæ“ä½œ" class="headerlink" title="9. ä½¿ç”¨ç¼“å†²æµï¼Œå‡å°‘IOæ“ä½œ"></a>9. ä½¿ç”¨ç¼“å†²æµï¼Œå‡å°‘IOæ“ä½œ</h3><p><strong>åä¾‹ï¼š</strong></p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  å…¬ä¼—å·ï¼šæ¡ç”°èºçš„å°ç”·å­©</span><br><span class="hljs-comment"> *  @desc: å¤åˆ¶ä¸€å¼ å›¾ç‰‡æ–‡ä»¶</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainTest</span> &#123;</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">String</span>[] args)</span> throws FileNotFoundException </span>&#123;<br>        <span class="hljs-keyword">long</span> <span class="hljs-built_in">begin</span> = System.currentTimeMillis();<br>        <span class="hljs-keyword">try</span> (FileInputStream input = <span class="hljs-keyword">new</span> FileInputStream(<span class="hljs-string">&quot;C:/456.png&quot;</span>);<br>             FileOutputStream output = <span class="hljs-keyword">new</span> FileOutputStream(<span class="hljs-string">&quot;C:/789.png&quot;</span>)) &#123;<br>            <span class="hljs-keyword">byte</span>[] bytes = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">1024</span>];<br>            <span class="hljs-keyword">int</span> i;<br>            <span class="hljs-keyword">while</span> ((i = input.<span class="hljs-built_in">read</span>(bytes)) != <span class="hljs-number">-1</span>) &#123;<br>                output.<span class="hljs-built_in">write</span>(bytes,<span class="hljs-number">0</span>,i);<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            <span class="hljs-built_in">log</span>.error(<span class="hljs-string">&quot;å¤åˆ¶æ–‡ä»¶å‘ç”Ÿå¼‚å¸¸&quot;</span>,e);<br>        &#125;<br>        <span class="hljs-built_in">log</span>.info(<span class="hljs-string">&quot;å¸¸è§„æµè¯»å†™ï¼Œæ€»å…±è€—æ—¶msï¼š&quot;</span>+(System.currentTimeMillis() - <span class="hljs-built_in">begin</span>));<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css">å¸¸è§„æµè¯»å†™ï¼Œæ€»å…±è€—æ—¶<span class="hljs-selector-tag">ms</span><span class="hljs-selector-pseudo">:52</span><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>ä½¿ç”¨<code>FileInputStream</code>ã€<code>FileOutputStream</code>å®ç°æ–‡ä»¶è¯»å†™åŠŸèƒ½ï¼Œæ˜¯æ²¡æœ‰ä»€ä¹ˆé—®é¢˜çš„ã€‚ä½†æ˜¯å‘¢ï¼Œå¯ä»¥ä½¿ç”¨ç¼“å†²æµ<code>BufferedReader</code>ã€<code>BufferedWriter</code>ã€<code>BufferedInputStream</code>ã€<code>BufferedOutputStream</code>ç­‰ï¼Œå‡å°‘IOæ¬¡æ•°ï¼Œæé«˜è¯»å†™æ•ˆç‡ã€‚</p><blockquote><p>å¦‚æœæ˜¯ä¸å¸¦ç¼“å†²çš„æµï¼Œè¯»å–åˆ°ä¸€ä¸ªå­—èŠ‚æˆ–è€…å­—ç¬¦çš„ï¼Œå°±ä¼šç›´æ¥è¾“å‡ºæ•°æ®äº†ã€‚è€Œå¸¦ç¼“å†²çš„æµï¼Œè¯»å–åˆ°ä¸€ä¸ªå­—èŠ‚æˆ–è€…å­—ç¬¦æ—¶ï¼Œå…ˆä¸è¾“å‡ºï¼Œè€Œæ˜¯ç­‰è¾¾åˆ°ç¼“å†²åŒºçš„æœ€å¤§å®¹é‡ï¼Œæ‰ä¸€æ¬¡æ€§è¾“å‡ºã€‚</p></blockquote><p><strong>æ­£ä¾‹ï¼š</strong></p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  å…¬ä¼—å·ï¼šæ¡ç”°èºçš„å°ç”·å­©</span><br><span class="hljs-comment"> *  @desc: å¤åˆ¶ä¸€å¼ å›¾ç‰‡æ–‡ä»¶</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainTest</span> &#123;</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">String</span>[] args)</span> throws FileNotFoundException </span>&#123;<br>        <span class="hljs-keyword">long</span> <span class="hljs-built_in">begin</span> = System.currentTimeMillis();<br>        <span class="hljs-keyword">try</span> (BufferedInputStream bufferedInputStream = <span class="hljs-keyword">new</span> BufferedInputStream(<span class="hljs-keyword">new</span> FileInputStream(<span class="hljs-string">&quot;C:/456.png&quot;</span>));<br>        BufferedOutputStream  bufferedOutputStream = <span class="hljs-keyword">new</span> BufferedOutputStream(<span class="hljs-keyword">new</span> FileOutputStream(<span class="hljs-string">&quot;C:/789.png&quot;</span>))) &#123;<br>            <span class="hljs-keyword">byte</span>[] bytes = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">1024</span>];<br>            <span class="hljs-keyword">int</span> i;<br>            <span class="hljs-keyword">while</span> ((i = input.<span class="hljs-built_in">read</span>(bytes)) != <span class="hljs-number">-1</span>) &#123;<br>                output.<span class="hljs-built_in">write</span>(bytes,<span class="hljs-number">0</span>,i);<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            <span class="hljs-built_in">log</span>.error(<span class="hljs-string">&quot;å¤åˆ¶æ–‡ä»¶å‘ç”Ÿå¼‚å¸¸&quot;</span>,e);<br>        &#125;<br>        <span class="hljs-built_in">log</span>.info(<span class="hljs-string">&quot;æ€»å…±è€—æ—¶ms&quot;</span>+(System.currentTimeMillis() - <span class="hljs-built_in">begin</span>));<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css">ç¼“å†²æµè¯»å†™ï¼Œæ€»å…±è€—æ—¶<span class="hljs-selector-tag">ms</span><span class="hljs-selector-pseudo">:12</span><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><h3 id="10-ä¼˜åŒ–ä½ çš„ç¨‹åºé€»è¾‘ï¼Œæ¯”å¦‚å‰é¢å·²ç»æŸ¥åˆ°çš„æ•°æ®ï¼Œåœ¨åé¢çš„æ–¹æ³•ä¹Ÿç”¨åˆ°çš„è¯ï¼Œæ˜¯å¯ä»¥æŠŠå¾€ä¸‹ä¼ å‚çš„ï¼Œå‡å°‘æ–¹æ³•è°ƒç”¨-æŸ¥è¡¨"><a href="#10-ä¼˜åŒ–ä½ çš„ç¨‹åºé€»è¾‘ï¼Œæ¯”å¦‚å‰é¢å·²ç»æŸ¥åˆ°çš„æ•°æ®ï¼Œåœ¨åé¢çš„æ–¹æ³•ä¹Ÿç”¨åˆ°çš„è¯ï¼Œæ˜¯å¯ä»¥æŠŠå¾€ä¸‹ä¼ å‚çš„ï¼Œå‡å°‘æ–¹æ³•è°ƒç”¨-æŸ¥è¡¨" class="headerlink" title="10. ä¼˜åŒ–ä½ çš„ç¨‹åºé€»è¾‘ï¼Œæ¯”å¦‚å‰é¢å·²ç»æŸ¥åˆ°çš„æ•°æ®ï¼Œåœ¨åé¢çš„æ–¹æ³•ä¹Ÿç”¨åˆ°çš„è¯ï¼Œæ˜¯å¯ä»¥æŠŠå¾€ä¸‹ä¼ å‚çš„ï¼Œå‡å°‘æ–¹æ³•è°ƒç”¨/æŸ¥è¡¨"></a>10. ä¼˜åŒ–ä½ çš„ç¨‹åºé€»è¾‘ï¼Œæ¯”å¦‚å‰é¢å·²ç»æŸ¥åˆ°çš„æ•°æ®ï¼Œåœ¨åé¢çš„æ–¹æ³•ä¹Ÿç”¨åˆ°çš„è¯ï¼Œæ˜¯å¯ä»¥æŠŠå¾€ä¸‹ä¼ å‚çš„ï¼Œå‡å°‘æ–¹æ³•è°ƒç”¨/æŸ¥è¡¨</h3><p><strong>åä¾‹ï¼š</strong></p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">public Response deal<span class="hljs-constructor">Request(Request <span class="hljs-params">request</span>)</span>&#123;<br>    <br>    UserInfo userInfo = userInfoDao.select<span class="hljs-constructor">UserByUserId(<span class="hljs-params">request</span>.<span class="hljs-params">getUserId</span>)</span>;<br>     <span class="hljs-keyword">if</span>(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Objects</span>.</span></span>is<span class="hljs-constructor">Null(<span class="hljs-params">request</span>)</span>)&#123;<br>       return ;<br>     &#125;<br>   <br>    insert<span class="hljs-constructor">UserVip(<span class="hljs-params">request</span>.<span class="hljs-params">getUserId</span>)</span>;<br>   <br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> insertUserVipï¼ˆString userIdï¼‰&#123;<br>      <span class="hljs-comment">//åˆæŸ¥äº†ä¸€æ¬¡ </span><br>      UserInfo userInfo = userInfoDao.select<span class="hljs-constructor">UserByUserId(<span class="hljs-params">request</span>.<span class="hljs-params">getUserId</span>)</span>;<br>      <span class="hljs-comment">//æ’å…¥ç”¨æˆ·vipæµæ°´</span><br>      insert<span class="hljs-constructor">UserVipFlow(<span class="hljs-params">userInfo</span>)</span>;<br>      ....<br>&#125;<br><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>å¾ˆæ˜¾ç„¶ï¼Œä»¥ä¸Šç¨‹åºä»£ç ï¼Œå·²ç»æŸ¥åˆ° userInfoï¼Œç„¶ååˆæŠŠuserIdä¼ ä¸‹å»ï¼ŒåˆæŸ¥å¤šäº†ä¸€æ¬¡ã€‚ã€‚ã€‚å®é™…ä¸Šï¼Œå¯ä»¥æŠŠuserInfoä¼ ä¸‹å»çš„ï¼Œè¿™æ ·å¯ä»¥çœå»ä¸€æ¬¡æŸ¥è¡¨æ“ä½œï¼Œç¨‹åºæ›´é«˜æ•ˆã€‚</p><p><strong>æ­£ä¾‹ï¼š</strong></p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">public Response deal<span class="hljs-constructor">Request(Request <span class="hljs-params">request</span>)</span>&#123;<br>    <br>    UserInfo userInfo = userInfoDao.select<span class="hljs-constructor">UserByUserId(<span class="hljs-params">request</span>.<span class="hljs-params">getUserId</span>)</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Objects</span>.</span></span>is<span class="hljs-constructor">Null(<span class="hljs-params">request</span>)</span>)&#123;<br>       return ;<br>     &#125;<br>   <br>    insert<span class="hljs-constructor">UserVip(<span class="hljs-params">userInfo</span>)</span>;<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> insertUserVipï¼ˆUserInfo userInfoï¼‰&#123;<br>      <span class="hljs-comment">//æ’å…¥ç”¨æˆ·vipæµæ°´</span><br>      insert<span class="hljs-constructor">UserVipFlow(<span class="hljs-params">userInfo</span>)</span>;<br>      ....<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><h3 id="11-ä¸è¦ä¸ºäº†æ–¹ä¾¿ï¼Œç›´æ¥åœ¨ä»£ç ä¸­ä½¿ç”¨0-1ç­‰é­”æ³•å€¼ï¼Œåº”è¯¥è¦ç”¨enumæšä¸¾ä»£æ›¿ã€‚"><a href="#11-ä¸è¦ä¸ºäº†æ–¹ä¾¿ï¼Œç›´æ¥åœ¨ä»£ç ä¸­ä½¿ç”¨0-1ç­‰é­”æ³•å€¼ï¼Œåº”è¯¥è¦ç”¨enumæšä¸¾ä»£æ›¿ã€‚" class="headerlink" title="11. ä¸è¦ä¸ºäº†æ–¹ä¾¿ï¼Œç›´æ¥åœ¨ä»£ç ä¸­ä½¿ç”¨0,1ç­‰é­”æ³•å€¼ï¼Œåº”è¯¥è¦ç”¨enumæšä¸¾ä»£æ›¿ã€‚"></a>11. ä¸è¦ä¸ºäº†æ–¹ä¾¿ï¼Œç›´æ¥åœ¨ä»£ç ä¸­ä½¿ç”¨0,1ç­‰é­”æ³•å€¼ï¼Œåº”è¯¥è¦ç”¨enumæšä¸¾ä»£æ›¿ã€‚</h3><p><strong>åä¾‹ï¼š</strong></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;0&quot;</span>.equals(userInfo.getVipFlag))&#123;<br>    <span class="hljs-regexp">//</span>éä¼šå‘˜ï¼Œæç¤ºå»å¼€é€šä¼šå‘˜<br>    tipOpenVip(userInfo);<br>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;1&quot;</span>.equals(userInfo.getVipFlag))&#123;<br>    <span class="hljs-regexp">//</span>ä¼šå‘˜ï¼ŒåŠ å‹‹ç« è¿”å›<br>    addMedalï¼ˆuserInfoï¼‰;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p><strong>æ­£ä¾‹ï¼š</strong></p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-keyword">if</span>(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">UserVipEnum</span>.</span><span class="hljs-module"><span class="hljs-identifier">NOT_VIP</span>.</span></span>getCode.equals(userInfo.getVipFlag))&#123;<br>    <span class="hljs-comment">//éä¼šå‘˜ï¼Œæç¤ºå»å¼€é€šä¼šå‘˜</span><br>    tip<span class="hljs-constructor">OpenVip(<span class="hljs-params">userInfo</span>)</span>;<br>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">UserVipEnum</span>.</span><span class="hljs-module"><span class="hljs-identifier">VIP</span>.</span></span>getCode.equals(userInfo.getVipFlag))&#123;<br>    <span class="hljs-comment">//ä¼šå‘˜ï¼ŒåŠ å‹‹ç« è¿”å›</span><br>    addMedalï¼ˆuserInfoï¼‰;<br>&#125;<br><br>public enum UserVipEnum &#123;<br><br>    <span class="hljs-constructor">VIP(<span class="hljs-string">&quot;1&quot;</span>,<span class="hljs-string">&quot;ä¼šå‘˜&quot;</span>)</span>,<br>    <span class="hljs-constructor">NOT_VIP(<span class="hljs-string">&quot;0&quot;</span>,<span class="hljs-string">&quot;éä¼šå‘˜&quot;</span>)</span>,:;<br><br>    <span class="hljs-keyword">private</span> String code; <br>    <span class="hljs-keyword">private</span> String desc;<br><br>    <span class="hljs-constructor">UserVipEnum(String <span class="hljs-params">code</span>, String <span class="hljs-params">desc</span>)</span> &#123;<br>        this.code = code;<br>        this.desc = desc;<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>å†™ä»£ç çš„æ—¶å€™ï¼Œä¸è¦ä¸€æ—¶å…´èµ·ï¼Œå°±ç›´æ¥ä½¿ç”¨é­”æ³•å€¼å“ˆã€‚ä½¿ç”¨é­”æ³•å€¼ï¼Œç»´æŠ¤ä»£ç èµ·æ¥å¾ˆéš¾å—çš„ã€‚</p><h3 id="12-å½“æˆå‘˜å˜é‡å€¼ä¸ä¼šæ”¹å˜æ—¶ï¼Œä¼˜å…ˆå®šä¹‰ä¸ºé™æ€å¸¸é‡"><a href="#12-å½“æˆå‘˜å˜é‡å€¼ä¸ä¼šæ”¹å˜æ—¶ï¼Œä¼˜å…ˆå®šä¹‰ä¸ºé™æ€å¸¸é‡" class="headerlink" title="12. å½“æˆå‘˜å˜é‡å€¼ä¸ä¼šæ”¹å˜æ—¶ï¼Œä¼˜å…ˆå®šä¹‰ä¸ºé™æ€å¸¸é‡"></a>12. å½“æˆå‘˜å˜é‡å€¼ä¸ä¼šæ”¹å˜æ—¶ï¼Œä¼˜å…ˆå®šä¹‰ä¸ºé™æ€å¸¸é‡</h3><p><strong>åä¾‹ï¼š</strong></p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-symbol">Task</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> long timeout = <span class="hljs-number">10</span>L;<br>    ...<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p><strong>æ­£ä¾‹ï¼š</strong></p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Task</span> &#123;</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> TIMEOUT = <span class="hljs-number">10L</span>;<br>    ...<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><blockquote><p>å› ä¸ºå¦‚æœå®šä¹‰ä¸ºstaticï¼Œå³ç±»é™æ€å¸¸é‡ï¼Œåœ¨æ¯ä¸ªå®ä¾‹å¯¹è±¡ä¸­ï¼Œå®ƒåªæœ‰ä¸€ä»½å‰¯æœ¬ã€‚å¦‚æœæ˜¯æˆå‘˜å˜é‡ï¼Œæ¯ä¸ªå®ä¾‹å¯¹è±¡ä¸­ï¼Œéƒ½å„æœ‰ä¸€ä»½å‰¯æœ¬ã€‚æ˜¾ç„¶ï¼Œå¦‚æœè¿™ä¸ªå˜é‡ä¸ä¼šå˜çš„è¯ï¼Œå®šä¹‰ä¸ºé™æ€å¸¸é‡æ›´å¥½ä¸€äº›ã€‚</p></blockquote><h3 id="13-æ³¨æ„æ£€éªŒç©ºæŒ‡é’ˆï¼Œä¸è¦è½»æ˜“ç›¸ä¿¡ä¸šåŠ¡ï¼Œè¯´æ­£å¸¸é€»è¾‘æŸä¸ªå‚æ•°ä¸å¯èƒ½ä¸ºç©ºã€‚"><a href="#13-æ³¨æ„æ£€éªŒç©ºæŒ‡é’ˆï¼Œä¸è¦è½»æ˜“ç›¸ä¿¡ä¸šåŠ¡ï¼Œè¯´æ­£å¸¸é€»è¾‘æŸä¸ªå‚æ•°ä¸å¯èƒ½ä¸ºç©ºã€‚" class="headerlink" title="13. æ³¨æ„æ£€éªŒç©ºæŒ‡é’ˆï¼Œä¸è¦è½»æ˜“ç›¸ä¿¡ä¸šåŠ¡ï¼Œè¯´æ­£å¸¸é€»è¾‘æŸä¸ªå‚æ•°ä¸å¯èƒ½ä¸ºç©ºã€‚"></a>13. æ³¨æ„æ£€éªŒç©ºæŒ‡é’ˆï¼Œä¸è¦è½»æ˜“ç›¸ä¿¡ä¸šåŠ¡ï¼Œè¯´æ­£å¸¸é€»è¾‘æŸä¸ªå‚æ•°ä¸å¯èƒ½ä¸ºç©ºã€‚</h3><p>NullPointerException åœ¨æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­éå¸¸å¸¸è§ï¼Œæˆ‘ä»¬ä»£ç å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¸€å®šè¦å¯¹ç©ºæŒ‡é’ˆä¿æŒçµæ•çš„å—…è§‰ã€‚</p><p>ä¸»è¦æœ‰è¿™å‡ ç±»ç©ºæŒ‡é’ˆé—®é¢˜ï¼š</p><ul><li>åŒ…è£…ç±»å‹çš„ç©ºæŒ‡é’ˆé—®é¢˜</li><li>çº§è”è°ƒç”¨çš„ç©ºæŒ‡é’ˆé—®é¢˜</li><li>Equalsæ–¹æ³•å·¦è¾¹çš„ç©ºæŒ‡é’ˆé—®é¢˜</li><li>ConcurrentHashMap ç±»ä¼¼å®¹å™¨ä¸æ”¯æŒ k-vä¸º nullã€‚</li><li>é›†åˆï¼Œæ•°ç»„ç›´æ¥è·å–å…ƒç´ </li><li>å¯¹è±¡ç›´æ¥è·å–å±æ€§</li></ul><p><strong>åä¾‹ï¼š</strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NullPointTest</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-function"><span class="hljs-title">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>)</span> &#123;<br>        <span class="hljs-built_in">String</span> s = <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">if</span> (s.equals(<span class="hljs-string">&quot;666&quot;</span>)) &#123; <span class="hljs-comment">//så¯èƒ½ä¸ºç©ºï¼Œä¼šå¯¼è‡´ç©ºæŒ‡é’ˆé—®é¢˜</span><br>            System.out.println(<span class="hljs-string">&quot;å…¬ä¼—å·ï¼šæ¡ç”°èºçš„å°ç”·å­©ï¼Œå¹²è´§æ»¡æ»¡&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><h3 id="14ï¼Œæ•è·åˆ°çš„å¼‚å¸¸ï¼Œä¸èƒ½å¿½ç•¥å®ƒï¼Œè‡³å°‘æ‰“ç‚¹æ—¥å¿—ã€‚"><a href="#14ï¼Œæ•è·åˆ°çš„å¼‚å¸¸ï¼Œä¸èƒ½å¿½ç•¥å®ƒï¼Œè‡³å°‘æ‰“ç‚¹æ—¥å¿—ã€‚" class="headerlink" title="14ï¼Œæ•è·åˆ°çš„å¼‚å¸¸ï¼Œä¸èƒ½å¿½ç•¥å®ƒï¼Œè‡³å°‘æ‰“ç‚¹æ—¥å¿—ã€‚"></a>14ï¼Œæ•è·åˆ°çš„å¼‚å¸¸ï¼Œä¸èƒ½å¿½ç•¥å®ƒï¼Œè‡³å°‘æ‰“ç‚¹æ—¥å¿—ã€‚</h3><p><strong>åä¾‹ï¼š</strong></p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testIgnoreException</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>    <span class="hljs-keyword">try</span> &#123;       <br>        <span class="hljs-comment">// æäº‹æƒ…</span><br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;    <br>        <span class="hljs-comment">//æ•è·äº†å¼‚å¸¸ï¼Œå•¥äº‹æƒ…ä¸åšï¼Œæ—¥å¿—ä¹Ÿä¸æ‰“ï¼Ÿï¼Ÿ</span><br>    &#125;<br>&#125;<br><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p><strong>æ­£ä¾‹ï¼š</strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-function"><span class="hljs-title">testIgnoreException</span>(<span class="hljs-params"></span>)</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">// æäº‹æƒ…</span><br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;     <br>        log.error(<span class="hljs-string">&quot;å¼‚å¸¸äº†ï¼Œè”ç³»å¼€å‘å°å“¥å“¥çœ‹çœ‹å“ˆ&quot;</span>,e); <br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><h3 id="15-é‡‡ç”¨Lambdaè¡¨è¾¾å¼æ›¿æ¢å†…éƒ¨åŒ¿åç±»ï¼Œä½¿ä»£ç æ›´ä¼˜é›…"><a href="#15-é‡‡ç”¨Lambdaè¡¨è¾¾å¼æ›¿æ¢å†…éƒ¨åŒ¿åç±»ï¼Œä½¿ä»£ç æ›´ä¼˜é›…" class="headerlink" title="15. é‡‡ç”¨Lambdaè¡¨è¾¾å¼æ›¿æ¢å†…éƒ¨åŒ¿åç±»ï¼Œä½¿ä»£ç æ›´ä¼˜é›…"></a>15. é‡‡ç”¨Lambdaè¡¨è¾¾å¼æ›¿æ¢å†…éƒ¨åŒ¿åç±»ï¼Œä½¿ä»£ç æ›´ä¼˜é›…</h3><p>JDK8å‡ºç°äº†æ–°ç‰¹æ€§-Lambdaè¡¨è¾¾å¼ã€‚Lambdaè¡¨è¾¾å¼ä¸ä»…æ¯”åŒ¿åå†…éƒ¨ç±»æ›´åŠ ä¼˜é›…ï¼Œå¹¶ä¸”åœ¨å¤§å¤šæ•°è™šæ‹Ÿæœºä¸­ï¼Œéƒ½æ˜¯é‡‡ç”¨invokeDynamicæŒ‡ä»¤å®ç°ï¼Œç›¸å¯¹äºåŒ¿åå†…éƒ¨ç±»ï¼Œæ•ˆç‡ä¹Ÿæ›´é«˜</p><p><strong>åä¾‹ï¼š</strong></p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs aspectj">  <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sortUserInfoList</span><span class="hljs-params">(List&lt;UserInfo&gt; userInfoList)</span></span>&#123;<br>      userInfoList.sort(<span class="hljs-keyword">new</span> Comparator&lt;UserInfo&gt;() &#123;<br>          <span class="hljs-meta">@Override</span><br>          <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">compare</span><span class="hljs-params">(UserInfo user1, UserInfo user2)</span> </span>&#123;<br>              Long userId1 = user1.getUserId();<br>              Long userId2 = user2.getUserId();<br>              <span class="hljs-function"><span class="hljs-keyword">return</span> userId1.<span class="hljs-title">compareTo</span><span class="hljs-params">(userId2)</span></span>;<br>          &#125;&#125;);<br>      &#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p><strong>æ­£ä¾‹ï¼š</strong></p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs livescript">   public <span class="hljs-literal">void</span> sortUserInfoList(List&lt;UserInfo&gt; userInfoList)&#123;<br>       userInfoList.sort<span class="hljs-function"><span class="hljs-params">((user1, user2) -&gt; &#123;</span></span><br><span class="hljs-function"><span class="hljs-params">           Long userId1 = user1.getUserId();</span></span><br><span class="hljs-function"><span class="hljs-params">           Long userId2 = user2.getUserId();</span></span><br><span class="hljs-function"><span class="hljs-params">           <span class="hljs-keyword">return</span> userId1.compareTo(userId2);</span></span><br><span class="hljs-function"><span class="hljs-params">       &#125;)</span>;</span><br><span class="hljs-function">   &#125;</span><br><span class="hljs-function">å¤åˆ¶ä»£ç </span><br></code></pre></td></tr></table></figure><h3 id="16-é€šçŸ¥ç±»ï¼ˆå¦‚å‘é‚®ä»¶ï¼Œæœ‰çŸ­ä¿¡ï¼‰çš„ä»£ç ï¼Œå»ºè®®å¼‚æ­¥å¤„ç†ã€‚"><a href="#16-é€šçŸ¥ç±»ï¼ˆå¦‚å‘é‚®ä»¶ï¼Œæœ‰çŸ­ä¿¡ï¼‰çš„ä»£ç ï¼Œå»ºè®®å¼‚æ­¥å¤„ç†ã€‚" class="headerlink" title="16. é€šçŸ¥ç±»ï¼ˆå¦‚å‘é‚®ä»¶ï¼Œæœ‰çŸ­ä¿¡ï¼‰çš„ä»£ç ï¼Œå»ºè®®å¼‚æ­¥å¤„ç†ã€‚"></a>16. é€šçŸ¥ç±»ï¼ˆå¦‚å‘é‚®ä»¶ï¼Œæœ‰çŸ­ä¿¡ï¼‰çš„ä»£ç ï¼Œå»ºè®®å¼‚æ­¥å¤„ç†ã€‚</h3><p>å‡è®¾ä¸šåŠ¡æµç¨‹è¿™æ ·ï¼šéœ€è¦åœ¨ç”¨æˆ·ç™»é™†æ—¶ï¼Œæ·»åŠ ä¸ªçŸ­ä¿¡é€šçŸ¥å®ƒçš„ç²‰ä¸ã€‚ å¾ˆå®¹æ˜“æƒ³åˆ°çš„å®ç°æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/image-20210404075450152.png" alt="image-20210404075450152"></p><p>å‡è®¾æä¾›sendMsgNotifyæœåŠ¡çš„ç³»ç»ŸæŒ‚äº†ï¼Œæˆ–è€…è°ƒç”¨sendMsgNotifyå¤±è´¥äº†ï¼Œé‚£ä¹ˆç”¨æˆ·ç™»é™†å°±å¤±è´¥äº†ã€‚ã€‚ã€‚ ä¸€ä¸ªé€šçŸ¥åŠŸèƒ½å¯¼è‡´äº†ç™»é™†ä¸»æµç¨‹ä¸å¯ç”¨ï¼Œæ˜æ˜¾çš„æ¡äº†èŠéº»ä¸¢è¥¿ç“œã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰é±¼é±¼ç†ŠæŒå…¼å¾—çš„æ–¹æ³•å‘¢ï¼Ÿæœ‰çš„ï¼Œç»™å‘çŸ­ä¿¡æ¥å£æ•è·å¼‚å¸¸å¤„ç†ï¼Œæˆ–è€…å¦å¼€çº¿ç¨‹å¼‚æ­¥å¤„ç†ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/image-20210404075509515.png" alt="image-20210404075509515"></p><p>å› æ­¤ï¼Œæ·»åŠ é€šçŸ¥ç±»ç­‰ä¸æ˜¯éä¸»è¦ï¼Œå¯é™çº§çš„æ¥å£æ—¶ï¼Œåº”è¯¥é™ä¸‹å¿ƒæ¥è€ƒè™‘æ˜¯å¦ä¼šå½±å“ä¸»è¦æµç¨‹ï¼Œæ€è€ƒæ€ä¹ˆå¤„ç†æœ€å¥½ã€‚</p><h3 id="17-å¤„ç†Javaæ—¥æœŸæ—¶ï¼Œå½“å¿ƒYYYYæ ¼å¼è®¾ç½®çš„é—®é¢˜ã€‚"><a href="#17-å¤„ç†Javaæ—¥æœŸæ—¶ï¼Œå½“å¿ƒYYYYæ ¼å¼è®¾ç½®çš„é—®é¢˜ã€‚" class="headerlink" title="17. å¤„ç†Javaæ—¥æœŸæ—¶ï¼Œå½“å¿ƒYYYYæ ¼å¼è®¾ç½®çš„é—®é¢˜ã€‚"></a>17. å¤„ç†Javaæ—¥æœŸæ—¶ï¼Œå½“å¿ƒYYYYæ ¼å¼è®¾ç½®çš„é—®é¢˜ã€‚</h3><p>æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å¤„ç†æ—¥æœŸã€‚æˆ‘ä»¬è¦å½“æ—¶æ—¥æœŸæ ¼å¼åŒ–çš„æ—¶å€™ï¼Œå¹´ä»½æ˜¯å¤§å†™<code>YYYY</code>çš„å‘ã€‚</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">Calendar calendar = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Calendar</span>.</span></span>get<span class="hljs-constructor">Instance()</span>;<br>calendar.set(<span class="hljs-number">2019</span>, Calendar.DECEMBER, <span class="hljs-number">31</span>);<br><br>Date testDate = calendar.get<span class="hljs-constructor">Time()</span>;<br><br>SimpleDateFormat dtf = <span class="hljs-keyword">new</span> <span class="hljs-constructor">SimpleDateFormat(<span class="hljs-string">&quot;YYYY-MM-dd&quot;</span>)</span>;<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;2019-12-31 è½¬ YYYY-MM-dd æ ¼å¼å &quot;</span> + dtf.format(testDate));<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs subunit">2019<span class="hljs-string">-12</span><span class="hljs-string">-31</span> è½¬ YYYY-MM-dd æ ¼å¼å 2020<span class="hljs-string">-12</span><span class="hljs-string">-31</span><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><blockquote><p>ä¸ºä»€ä¹ˆæ˜æ˜æ˜¯2019å¹´12æœˆ31å·ï¼Œå°±è½¬äº†ä¸€ä¸‹æ ¼å¼ï¼Œå°±å˜æˆäº†2020å¹´12æœˆ31å·äº†ï¼Ÿå› ä¸ºYYYYæ˜¯åŸºäºå‘¨æ¥è®¡ç®—å¹´çš„ï¼Œå®ƒæŒ‡å‘å½“å¤©æ‰€åœ¨å‘¨å±äºçš„å¹´ä»½ï¼Œä¸€å‘¨ä»å‘¨æ—¥å¼€å§‹ç®—èµ·ï¼Œå‘¨å…­ç»“æŸï¼Œåªè¦æœ¬å‘¨è·¨å¹´ï¼Œé‚£ä¹ˆè¿™ä¸€å‘¨å°±ç®—ä¸‹ä¸€å¹´çš„äº†ã€‚æ­£ç¡®å§¿åŠ¿æ˜¯ä½¿ç”¨yyyyæ ¼å¼ã€‚</p></blockquote><p><img src="/Users/cuixiaoyan/Library/Application%20Support/typora-user-images/image-20210404075903220.png" alt="image-20210404075903220"></p><h3 id="18-å¦‚æœä¸€ä¸ªç±»ç¡®å®šä¸ä¼šè¢«ç»§æ‰¿ï¼Œä¸ä¼šæ‹¿æ¥æAOPéªšæ“ä½œï¼Œå¯ä»¥æŒ‡å®šfinalä¿®é¥°ç¬¦ï¼Œå¦‚ç”¨finalä¿®é¥°ä¸€ä¸ªå·¥å…·ç±»ã€‚"><a href="#18-å¦‚æœä¸€ä¸ªç±»ç¡®å®šä¸ä¼šè¢«ç»§æ‰¿ï¼Œä¸ä¼šæ‹¿æ¥æAOPéªšæ“ä½œï¼Œå¯ä»¥æŒ‡å®šfinalä¿®é¥°ç¬¦ï¼Œå¦‚ç”¨finalä¿®é¥°ä¸€ä¸ªå·¥å…·ç±»ã€‚" class="headerlink" title="18. å¦‚æœä¸€ä¸ªç±»ç¡®å®šä¸ä¼šè¢«ç»§æ‰¿ï¼Œä¸ä¼šæ‹¿æ¥æAOPéªšæ“ä½œï¼Œå¯ä»¥æŒ‡å®šfinalä¿®é¥°ç¬¦ï¼Œå¦‚ç”¨finalä¿®é¥°ä¸€ä¸ªå·¥å…·ç±»ã€‚"></a>18. å¦‚æœä¸€ä¸ªç±»ç¡®å®šä¸ä¼šè¢«ç»§æ‰¿ï¼Œä¸ä¼šæ‹¿æ¥æAOPéªšæ“ä½œï¼Œå¯ä»¥æŒ‡å®šfinalä¿®é¥°ç¬¦ï¼Œå¦‚ç”¨finalä¿®é¥°ä¸€ä¸ªå·¥å…·ç±»ã€‚</h3><p><strong>æ­£ä¾‹ï¼š</strong></p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Tools</span> &#123;</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testFinal</span><span class="hljs-params">()</span></span>&#123;<br>        System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">&quot;å·¥å…·ç±»æ–¹æ³•&quot;</span>);<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>ä¸€ä¸ªç±»æŒ‡å®šäº†finalä¿®é¥°ç¬¦ï¼Œå®ƒä¸ä¼šè¢«ç»§æ‰¿äº†ï¼Œå¹¶ä¸”å…¶æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯finalçš„äº†ã€‚Javaç¼–è¯‘å™¨ä¼šæ‰¾æœºä¼šå†…è”æ‰€æœ‰çš„finalæ–¹æ³•ï¼Œæå‡äº†Javaè¿è¡Œæ•ˆç‡ã€‚</p><h3 id="19-staticé™æ€å˜é‡ä¸è¦ä¾èµ–springå®ä¾‹åŒ–å˜é‡ï¼Œå¯èƒ½ä¼šå¯¼è‡´åˆå§‹åŒ–å‡ºé”™"><a href="#19-staticé™æ€å˜é‡ä¸è¦ä¾èµ–springå®ä¾‹åŒ–å˜é‡ï¼Œå¯èƒ½ä¼šå¯¼è‡´åˆå§‹åŒ–å‡ºé”™" class="headerlink" title="19. staticé™æ€å˜é‡ä¸è¦ä¾èµ–springå®ä¾‹åŒ–å˜é‡ï¼Œå¯èƒ½ä¼šå¯¼è‡´åˆå§‹åŒ–å‡ºé”™"></a>19. staticé™æ€å˜é‡ä¸è¦ä¾èµ–springå®ä¾‹åŒ–å˜é‡ï¼Œå¯èƒ½ä¼šå¯¼è‡´åˆå§‹åŒ–å‡ºé”™</h3><p>ä¹‹å‰çœ‹åˆ°é¡¹ç›®æœ‰ç±»ä¼¼çš„ä»£ç ã€‚é™æ€å˜é‡ä¾èµ–äºspringå®¹å™¨çš„beanã€‚</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"> <span class="hljs-keyword">private</span> static SmsService smsService = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">SpringContextUtils</span>.</span></span>get<span class="hljs-constructor">Bean(SmsService.<span class="hljs-params">class</span>)</span>;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¿™ä¸ªé™æ€çš„smsServiceæœ‰å¯èƒ½è·å–ä¸åˆ°çš„ï¼Œå› ä¸ºç±»åŠ è½½é¡ºåºä¸æ˜¯ç¡®å®šçš„ï¼Œè€Œä»¥ä¸Šçš„ä»£ç ï¼Œé™æ€çš„smsServiceåˆå§‹åŒ–å¼ºåˆ¶ä¾èµ–springå®¹å™¨çš„å®ä¾‹äº†ã€‚æ­£ç¡®çš„å†™æ³•å¯ä»¥è¿™æ ·ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"> <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SmsService  smsService =<span class="hljs-literal">null</span>;<br> <br> <span class="hljs-comment">//ä½¿ç”¨åˆ°çš„æ—¶å€™é‡‡å–è·å–</span><br> <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SmsService <span class="hljs-function"><span class="hljs-title">getSmsService</span>(<span class="hljs-params"></span>)</span>&#123;<br>   <span class="hljs-keyword">if</span>(smsService==<span class="hljs-literal">null</span>)&#123;<br>      smsService = SpringContextUtils.getBean(SmsService.class);<br>   &#125;<br>   <span class="hljs-keyword">return</span> smsService;<br> &#125;<br><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><h3 id="20-ä¸ç±»æˆå‘˜å˜é‡æ— å…³çš„æ–¹æ³•ï¼Œåº”å½“å£°æ˜æˆé™æ€æ–¹æ³•"><a href="#20-ä¸ç±»æˆå‘˜å˜é‡æ— å…³çš„æ–¹æ³•ï¼Œåº”å½“å£°æ˜æˆé™æ€æ–¹æ³•" class="headerlink" title="20. ä¸ç±»æˆå‘˜å˜é‡æ— å…³çš„æ–¹æ³•ï¼Œåº”å½“å£°æ˜æˆé™æ€æ–¹æ³•"></a>20. ä¸ç±»æˆå‘˜å˜é‡æ— å…³çš„æ–¹æ³•ï¼Œåº”å½“å£°æ˜æˆé™æ€æ–¹æ³•</h3><p>æœ‰äº›æ–¹æ³•ï¼Œä¸å®ä¾‹æˆå‘˜å˜é‡æ— å…³ï¼Œå°±å¯ä»¥å£°æ˜ä¸ºé™æ€æ–¹æ³•ã€‚è¿™ä¸€ç‚¹ï¼Œå·¥å…·ç±»ç”¨å¾—å¾ˆå¤šã€‚<strong>åä¾‹å¦‚ä¸‹</strong>ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * BigDecimalçš„å·¥å…·ç±»</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BigDecimalUtils</span> </span>&#123;<br> <br>    <span class="hljs-keyword">public</span>  BigDecimal <span class="hljs-function"><span class="hljs-title">ifNullSetZERO</span>(<span class="hljs-params">BigDecimal <span class="hljs-keyword">in</span></span>)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">in</span> != <span class="hljs-literal">null</span> ï¼Ÿ <span class="hljs-keyword">in</span> : BigDecimal.ZERO;<br>    &#125;<br> <br>    <span class="hljs-keyword">public</span> BigDecimal <span class="hljs-function"><span class="hljs-title">sum</span>(<span class="hljs-params">BigDecimal ...<span class="hljs-keyword">in</span></span>)</span>&#123;<br>        BigDecimal result = BigDecimal.ZERO;<br>        <span class="hljs-keyword">for</span> (int i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">in</span>.length; i++)&#123;<br>            result = result.add(ifNullSetZERO(<span class="hljs-keyword">in</span>[i]));<br>        &#125;<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>å› ä¸ºBigDecimalUtilså·¥å…·ç±»çš„æ–¹æ³•éƒ½æ²¡æœ‰staticä¿®é¥°ï¼Œæ‰€ä»¥ï¼Œä½ è¦ä½¿ç”¨çš„æ—¶å€™ï¼Œæ¯æ¬¡éƒ½è¦newä¸€ä¸‹å•¦,é‚£ä¸å°±è€—èµ„æºå»<strong>åå¤åˆ›å»ºå¯¹è±¡</strong>äº†å˜›ï¼ï¼</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">BigDecimalUtils </span><span class="hljs-keyword">bigDecimalUtils </span>= new <span class="hljs-keyword">BigDecimalUtilsï¼ˆï¼‰;</span><br><span class="hljs-keyword">bigDecimalUtils.sum(a,b);</span><br><span class="hljs-keyword">å¤åˆ¶ä»£ç </span><br></code></pre></td></tr></table></figure><p>æ‰€ä»¥å¯ä»¥å£°æ˜æˆé™æ€å˜é‡ï¼Œä½¿ç”¨çš„æ—¶å€™ï¼Œç›´æ¥<code>ç±»å.æ–¹æ³•</code>è°ƒç”¨å³å¯ï¼Œæ­£ä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * BigDecimalçš„å·¥å…·ç±»</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BigDecimalUtils</span> </span>&#123;<br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span>  BigDecimal <span class="hljs-function"><span class="hljs-title">ifNullSetZERO</span>(<span class="hljs-params">BigDecimal <span class="hljs-keyword">in</span></span>)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">in</span> != <span class="hljs-literal">null</span> ï¼Ÿ <span class="hljs-keyword">in</span> : BigDecimal.ZERO;<br>    &#125;<br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> BigDecimal <span class="hljs-function"><span class="hljs-title">sum</span>(<span class="hljs-params">BigDecimal ...<span class="hljs-keyword">in</span></span>)</span>&#123;<br>        BigDecimal result = BigDecimal.ZERO;<br>        <span class="hljs-keyword">for</span> (int i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">in</span>.length; i++)&#123;<br>            result = result.add(ifNullSetZERO(<span class="hljs-keyword">in</span>[i]));<br>        &#125;<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><h3 id="21-ä¸è¦ç”¨ä¸€ä¸ªExceptionæ•æ‰æ‰€æœ‰å¯èƒ½çš„å¼‚å¸¸ã€‚"><a href="#21-ä¸è¦ç”¨ä¸€ä¸ªExceptionæ•æ‰æ‰€æœ‰å¯èƒ½çš„å¼‚å¸¸ã€‚" class="headerlink" title="21. ä¸è¦ç”¨ä¸€ä¸ªExceptionæ•æ‰æ‰€æœ‰å¯èƒ½çš„å¼‚å¸¸ã€‚"></a>21. ä¸è¦ç”¨ä¸€ä¸ªExceptionæ•æ‰æ‰€æœ‰å¯èƒ½çš„å¼‚å¸¸ã€‚</h3><p><strong>åä¾‹:</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> test()&#123;<br>    <span class="hljs-keyword">try</span>&#123;<br>        <span class="hljs-comment">//â€¦æŠ›å‡º IOException çš„ä»£ç è°ƒç”¨</span><br>        <span class="hljs-comment">//â€¦æŠ›å‡º SQLException çš„ä»£ç è°ƒç”¨</span><br>    &#125;<span class="hljs-keyword">catch</span>(<span class="hljs-built_in">Exception</span> e)&#123;<br>        <span class="hljs-comment">//ç”¨åŸºç±» Exception æ•æ‰çš„æ‰€æœ‰å¯èƒ½çš„å¼‚å¸¸ï¼Œå¦‚æœå¤šä¸ªå±‚æ¬¡éƒ½è¿™æ ·æ•æ‰ï¼Œä¼šä¸¢å¤±åŸå§‹å¼‚å¸¸çš„æœ‰æ•ˆä¿¡æ¯å“¦</span><br>        log.info(â€œ<span class="hljs-built_in">Exception</span> in test,<span class="hljs-built_in">exception</span>:&#123;&#125;â€, e);<br>    &#125;<br>&#125;<br><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p><strong>æ­£ä¾‹ï¼š</strong></p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">test</span>()&#123;<br>    <span class="hljs-selector-tag">try</span>&#123;<br>        <span class="hljs-comment">//â€¦æŠ›å‡º IOException çš„ä»£ç è°ƒç”¨</span><br>        <span class="hljs-comment">//â€¦æŠ›å‡º SQLException çš„ä»£ç è°ƒç”¨</span><br>    &#125;<span class="hljs-selector-tag">catch</span>(IOException e)&#123;<br>        <span class="hljs-comment">//ä»…ä»…æ•æ‰ IOException</span><br>        <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.info</span>(â€œIOException in test,<span class="hljs-attribute">exception</span>:&#123;&#125;â€, e);<br>    &#125;<span class="hljs-selector-tag">catch</span>(SQLException e)&#123;<br>        <span class="hljs-comment">//ä»…ä»…æ•æ‰ SQLException</span><br>        <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.info</span>(â€œSQLException in test,<span class="hljs-attribute">exception</span>:&#123;&#125;â€, e);<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><h3 id="22-å‡½æ•°ä¸è¦è¿‡åº¦å°è£…ï¼Œè¨€ç®€æ„èµ…å³å¯ã€‚"><a href="#22-å‡½æ•°ä¸è¦è¿‡åº¦å°è£…ï¼Œè¨€ç®€æ„èµ…å³å¯ã€‚" class="headerlink" title="22. å‡½æ•°ä¸è¦è¿‡åº¦å°è£…ï¼Œè¨€ç®€æ„èµ…å³å¯ã€‚"></a>22. å‡½æ•°ä¸è¦è¿‡åº¦å°è£…ï¼Œè¨€ç®€æ„èµ…å³å¯ã€‚</h3><p><strong>åä¾‹ï¼š</strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// å‡½æ•°å°è£…</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">boolean</span> <span class="hljs-function"><span class="hljs-title">isUserVip</span>(<span class="hljs-params"><span class="hljs-built_in">Boolean</span> isVip</span>)</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Boolean</span>.TRUE.equals(isVip);<br>&#125;<br><br><span class="hljs-comment">// ä½¿ç”¨ä»£ç </span><br><span class="hljs-built_in">boolean</span> isVip = isVip(user.getUserVip());<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p><strong>æ­£ä¾‹ï¼š</strong></p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs lasso"><span class="hljs-built_in">boolean</span> isVip = <span class="hljs-built_in">Boolean</span>.<span class="hljs-literal">TRUE</span>.<span class="hljs-keyword">equals</span>(user.getUserVip());<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>å‡½æ•°ä¸è¦è¿‡åº¦å°è£…ï¼ŒæŠŠæ„æ€è¡¨è¾¾æ¸…æ¥šå³å¯ã€‚å¹¶ä¸”ï¼Œæ–¹æ³•è°ƒç”¨ä¼šå¼•èµ·å…¥æ ˆå’Œå‡ºæ ˆï¼Œå¯¼è‡´æ¶ˆè€—æ›´å¤šçš„CPUå’Œå†…å­˜ï¼Œè¿‡åº¦å°è£…ï¼Œä¼šæŸè€—æ€§èƒ½çš„ï¼</p><h3 id="23-å¦‚æœå˜é‡çš„åˆå€¼ä¸€å®šä¼šè¢«è¦†ç›–ï¼Œå°±æ²¡æœ‰å¿…è¦ç»™å˜é‡èµ‹åˆå€¼ã€‚"><a href="#23-å¦‚æœå˜é‡çš„åˆå€¼ä¸€å®šä¼šè¢«è¦†ç›–ï¼Œå°±æ²¡æœ‰å¿…è¦ç»™å˜é‡èµ‹åˆå€¼ã€‚" class="headerlink" title="23. å¦‚æœå˜é‡çš„åˆå€¼ä¸€å®šä¼šè¢«è¦†ç›–ï¼Œå°±æ²¡æœ‰å¿…è¦ç»™å˜é‡èµ‹åˆå€¼ã€‚"></a>23. å¦‚æœå˜é‡çš„åˆå€¼ä¸€å®šä¼šè¢«è¦†ç›–ï¼Œå°±æ²¡æœ‰å¿…è¦ç»™å˜é‡èµ‹åˆå€¼ã€‚</h3><p><strong>åä¾‹:</strong></p><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs pf">List<span class="hljs-variable">&lt;UserInfo&gt;</span> <span class="hljs-keyword">user</span>List = new ArrayList<span class="hljs-variable">&lt;&gt;</span>();<br>if (isAll) &#123;<br>    <span class="hljs-keyword">user</span>List = <span class="hljs-keyword">user</span>InfoDAO.queryAll();<br>&#125; else &#123;<br>    <span class="hljs-keyword">user</span>List = <span class="hljs-keyword">user</span>InfoDAO.queryActive();<br>&#125;<br><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p><strong>æ­£ä¾‹ï¼š</strong></p><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs pf">List<span class="hljs-variable">&lt;UserInfo&gt;</span> <span class="hljs-keyword">user</span>List ;<br>if (isAll) &#123;<br>    <span class="hljs-keyword">user</span>List = <span class="hljs-keyword">user</span>InfoDAO.queryAll();<br>&#125; else &#123;<br>    <span class="hljs-keyword">user</span>List = <span class="hljs-keyword">user</span>InfoDAO.queryActive();<br>&#125;<br><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><h3 id="24-é‡‘é¢æ•°å€¼è®¡ç®—è¦ä½¿ç”¨BigDecimal"><a href="#24-é‡‘é¢æ•°å€¼è®¡ç®—è¦ä½¿ç”¨BigDecimal" class="headerlink" title="24.é‡‘é¢æ•°å€¼è®¡ç®—è¦ä½¿ç”¨BigDecimal"></a>24.é‡‘é¢æ•°å€¼è®¡ç®—è¦ä½¿ç”¨BigDecimal</h3><p>çœ‹ä¸‹è¿™ä¸ªæµ®ç‚¹æ•°è®¡ç®—çš„ä¾‹å­å§ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> DoubleTest &#123;<br>    <span class="hljs-built_in">public</span> static <span class="hljs-type">void</span> main(String[] args) &#123;<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(<span class="hljs-number">0.1</span>+<span class="hljs-number">0.2</span>);<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(<span class="hljs-number">1.0</span><span class="hljs-number">-0.8</span>);<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(<span class="hljs-number">4.015</span>*<span class="hljs-number">100</span>);<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(<span class="hljs-number">123.3</span>/<span class="hljs-number">100</span>);<br><br>        <span class="hljs-type">double</span> amount1 = <span class="hljs-number">3.15</span>;<br>        <span class="hljs-type">double</span> amount2 = <span class="hljs-number">2.10</span>;<br>        <span class="hljs-keyword">if</span> (amount1 - amount2 == <span class="hljs-number">1.05</span>)&#123;<br>            <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(&quot;OK&quot;);<br>        &#125;<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plain">0.30000000000000004<br>0.19999999999999996<br>401.49999999999994<br>1.2329999999999999<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><blockquote><p>å› ä¸ºè®¡ç®—æœºæ˜¯ä»¥äºŒè¿›åˆ¶å­˜å‚¨æ•°å€¼çš„ï¼Œå¯¹äºæµ®ç‚¹æ•°ä¹Ÿæ˜¯ã€‚å¯¹äºè®¡ç®—æœºè€Œè¨€ï¼Œ0.1æ— æ³•ç²¾ç¡®è¡¨è¾¾ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæµ®ç‚¹æ•°ä¼šå¯¼è‡´ç²¾ç¡®åº¦ç¼ºå¤±çš„ã€‚å› æ­¤ï¼Œé‡‘é¢è®¡ç®—ï¼Œä¸€èˆ¬éƒ½æ˜¯ç”¨BigDecimal ç±»å‹</p></blockquote><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-keyword">new</span> <span class="hljs-constructor">BigDecimal(0.1)</span>.add(<span class="hljs-keyword">new</span> <span class="hljs-constructor">BigDecimal(0.2)</span>));<br><span class="hljs-comment">//output:</span><br><span class="hljs-number">0.3000000000000000166533453693773481063544750213623046875</span><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>å…¶å®ï¼Œä½¿ç”¨ BigDecimal è¡¨ç¤ºå’Œè®¡ç®—æµ®ç‚¹æ•°ï¼Œå¿…é¡»ä½¿ç”¨å­—ç¬¦ä¸²çš„æ„é€ æ–¹æ³•æ¥åˆå§‹åŒ– BigDecimalï¼Œå¹¶ä¸”ï¼Œè¿˜è¦å…³æ³¨BigDecimalçš„å‡ ä½å°æ•°ç‚¹ï¼Œå®ƒæœ‰å…«ç§èˆå…¥æ¨¡å¼ç­‰</p><h3 id="25-æ³¨æ„Arrays-asListçš„å‡ ä¸ªå‘"><a href="#25-æ³¨æ„Arrays-asListçš„å‡ ä¸ªå‘" class="headerlink" title="25.  æ³¨æ„Arrays.asListçš„å‡ ä¸ªå‘"></a>25.  æ³¨æ„Arrays.asListçš„å‡ ä¸ªå‘</h3><ul><li><strong>åŸºæœ¬ç±»å‹ä¸èƒ½ä½œä¸º Arrays.asListæ–¹æ³•çš„å‚æ•°ï¼Œå¦åˆ™ä¼šè¢«å½“åšä¸€ä¸ªå‚æ•°ã€‚</strong></li></ul><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ArrayAsListTest</span> &#123;</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">String</span>[] args)</span> </span>&#123;<br>        <span class="hljs-keyword">int</span>[] <span class="hljs-built_in">array</span> = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;;<br>        List <span class="hljs-built_in">list</span> = Arrays.asList(<span class="hljs-built_in">array</span>);<br>        System.out.<span class="hljs-built_in">println</span>(<span class="hljs-built_in">list</span>.<span class="hljs-built_in">size</span>());<br>    &#125;<br>&#125;<br><span class="hljs-comment">//è¿è¡Œç»“æœ</span><br><span class="hljs-number">1</span><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><ul><li><strong>Arrays.asList è¿”å›çš„ List ä¸æ”¯æŒå¢åˆ æ“ä½œã€‚</strong></li></ul><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">public <span class="hljs-keyword">class</span> ArrayAsListTest &#123;<br>    public static void main(String<span class="hljs-literal">[]</span> args) &#123;<br>        String<span class="hljs-literal">[]</span> <span class="hljs-built_in">array</span> = &#123;<span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-string">&quot;2&quot;</span>, <span class="hljs-string">&quot;3&quot;</span>&#125;;<br>        List <span class="hljs-built_in">list</span> = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Arrays</span>.</span></span><span class="hljs-keyword">as</span><span class="hljs-constructor">List(<span class="hljs-params">array</span>)</span>;<br>        <span class="hljs-built_in">list</span>.add(<span class="hljs-string">&quot;5&quot;</span>);<br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-built_in">list</span>.size<span class="hljs-literal">()</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// è¿è¡Œç»“æœ</span><br>Exception <span class="hljs-keyword">in</span> thread <span class="hljs-string">&quot;main&quot;</span> java.lang.UnsupportedOperationException<br>at java.util.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">AbstractList</span>.</span></span>add(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">AbstractList</span>.</span></span>java:<span class="hljs-number">148</span>)<br>at java.util.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">AbstractList</span>.</span></span>add(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">AbstractList</span>.</span></span>java:<span class="hljs-number">108</span>)<br>at <span class="hljs-keyword">object</span>.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ArrayAsListTest</span>.</span></span>main(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ArrayAsListTest</span>.</span></span>java:<span class="hljs-number">11</span>)<br><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>Arrays.asList è¿”å›çš„ List å¹¶ä¸æ˜¯æˆ‘ä»¬æœŸæœ›çš„ java.util.ArrayListï¼Œè€Œæ˜¯ Arrays çš„å†…éƒ¨ç±»ArrayListã€‚å†…éƒ¨ç±»çš„ArrayListæ²¡æœ‰å®ç°addæ–¹æ³•ï¼Œè€Œæ˜¯çˆ¶ç±»çš„addæ–¹æ³•çš„å®ç°ï¼Œæ˜¯ä¼šæŠ›å‡ºå¼‚å¸¸çš„å‘¢ã€‚</p><ul><li><strong>ä½¿ç”¨Arrays.asLisçš„æ—¶å€™ï¼Œå¯¹åŸå§‹æ•°ç»„çš„ä¿®æ”¹ä¼šå½±å“åˆ°æˆ‘ä»¬è·å¾—çš„é‚£ä¸ªList</strong></li></ul><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">public <span class="hljs-keyword">class</span> ArrayAsListTest &#123;<br>    public static void main(String<span class="hljs-literal">[]</span> args) &#123;<br>        String<span class="hljs-literal">[]</span> arr = &#123;<span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-string">&quot;2&quot;</span>, <span class="hljs-string">&quot;3&quot;</span>&#125;;<br>        List <span class="hljs-built_in">list</span> = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Arrays</span>.</span></span><span class="hljs-keyword">as</span><span class="hljs-constructor">List(<span class="hljs-params">arr</span>)</span>;<br>        arr<span class="hljs-literal">[<span class="hljs-number">1</span>]</span> = <span class="hljs-string">&quot;4&quot;</span>;<br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;åŸå§‹æ•°ç»„&quot;</span>+<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Arrays</span>.</span></span><span class="hljs-keyword">to</span><span class="hljs-constructor">String(<span class="hljs-params">arr</span>)</span>);<br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;listæ•°ç»„&quot;</span> + <span class="hljs-built_in">list</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//è¿è¡Œç»“æœ</span><br>åŸå§‹æ•°ç»„<span class="hljs-literal">[<span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>]</span><br><span class="hljs-built_in">list</span>æ•°ç»„<span class="hljs-literal">[<span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>]</span><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><h3 id="26ï¼ŒåŠæ—¶å…³é—­IOèµ„æºæµ"><a href="#26ï¼ŒåŠæ—¶å…³é—­IOèµ„æºæµ" class="headerlink" title="26ï¼ŒåŠæ—¶å…³é—­IOèµ„æºæµ"></a>26ï¼ŒåŠæ—¶å…³é—­IOèµ„æºæµ</h3><p>åº”è¯¥å¤§å®¶éƒ½æœ‰è¿‡è¿™æ ·çš„ç»å†ï¼Œwindowsç³»ç»Ÿæ¡Œé¢å¦‚æœæ‰“å¼€å¤ªå¤šæ–‡ä»¶æˆ–è€…ç³»ç»Ÿè½¯ä»¶ï¼Œå°±ä¼šè§‰å¾—ç”µè„‘å¾ˆå¡ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬linuxæœåŠ¡å™¨ä¹Ÿä¸€æ ·ï¼Œå¹³æ—¶æ“ä½œæ–‡ä»¶ï¼Œæˆ–è€…æ•°æ®åº“è¿æ¥ï¼ŒIOèµ„æºæµå¦‚æœæ²¡å…³é—­ï¼Œé‚£ä¹ˆè¿™ä¸ªIOèµ„æºå°±ä¼šè¢«å®ƒå ç€ï¼Œè¿™æ ·åˆ«äººå°±æ²¡æœ‰åŠæ³•ç”¨äº†ï¼Œè¿™å°±é€ æˆèµ„æºæµªè´¹ã€‚</p><p>æ‰€ä»¥ä½¿ç”¨å®ŒIOæµï¼Œè®°å¾—å…³é—­å“ˆã€‚å¯ä»¥ä½¿ç”¨try-with-resourceå…³é—­çš„ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * å…³æ³¨å…¬ä¼—å·ï¼Œæ¡ç”°èºçš„å°ç”·å­©</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">try</span> (FileInputStream inputStream = <span class="hljs-keyword">new</span> <span class="hljs-function"><span class="hljs-title">FileInputStream</span>(<span class="hljs-params"><span class="hljs-keyword">new</span> File(<span class="hljs-string">&quot;jay.txt&quot;</span>)</span>)</span> &#123;<br>    <span class="hljs-comment">// use resources   </span><br>&#125; <span class="hljs-keyword">catch</span> (FileNotFoundException e) &#123;<br>    log.error(e);<br>&#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>    log.error(e);<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><h3 id="27-å°½é‡ä½¿ç”¨å‡½æ•°å†…çš„åŸºæœ¬ç±»å‹ä¸´æ—¶å˜é‡"><a href="#27-å°½é‡ä½¿ç”¨å‡½æ•°å†…çš„åŸºæœ¬ç±»å‹ä¸´æ—¶å˜é‡" class="headerlink" title="27. å°½é‡ä½¿ç”¨å‡½æ•°å†…çš„åŸºæœ¬ç±»å‹ä¸´æ—¶å˜é‡"></a>27. å°½é‡ä½¿ç”¨å‡½æ•°å†…çš„åŸºæœ¬ç±»å‹ä¸´æ—¶å˜é‡</h3><blockquote><ul><li>åœ¨æ–¹æ³•å‡½æ•°å†…ï¼ŒåŸºæœ¬ç±»å‹å‚æ•°ä»¥åŠä¸´æ—¶å˜é‡ï¼Œéƒ½æ˜¯ä¿å­˜åœ¨æ ˆä¸­çš„ï¼Œè®¿é—®é€Ÿåº¦æ¯”è¾ƒå¿«ã€‚</li><li>å¯¹è±¡ç±»å‹çš„å‚æ•°å’Œä¸´æ—¶å˜é‡çš„å¼•ç”¨éƒ½ä¿å­˜åœ¨æ ˆä¸­ï¼Œå†…å®¹éƒ½ä¿å­˜åœ¨å †ä¸­ï¼Œè®¿é—®é€Ÿåº¦è¾ƒæ…¢ã€‚</li><li>åœ¨ç±»ä¸­ï¼Œä»»ä½•ç±»å‹çš„æˆå‘˜å˜é‡éƒ½ä¿å­˜åœ¨å †ï¼ˆHeapï¼‰ä¸­ï¼Œè®¿é—®é€Ÿåº¦è¾ƒæ…¢ã€‚</li></ul></blockquote><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs axapta"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AccumulatorUtil</span> </span>&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">double</span> result = <span class="hljs-number">0.0</span>D;<br>    <span class="hljs-comment">//åä¾‹</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> addAllOne( <span class="hljs-built_in">double</span>[] values) &#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-built_in">double</span> value : values) &#123;<br>            result += value;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">//æ­£ä¾‹ï¼Œå…ˆåœ¨æ–¹æ³•å†…å£°æ˜ä¸€ä¸ªå±€éƒ¨ä¸´æ—¶å˜é‡ï¼Œç´¯åŠ å®Œåï¼Œå†èµ‹å€¼ç»™æ–¹æ³•å¤–çš„æˆå‘˜å˜é‡</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> addAll1Two(<span class="hljs-built_in">double</span>[] values) &#123;<br>        <span class="hljs-built_in">double</span> <span class="hljs-keyword">sum</span> = <span class="hljs-number">0.0</span>D;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-built_in">double</span> value : values) &#123;<br>            <span class="hljs-keyword">sum</span> += value;<br>        &#125;<br>        result += <span class="hljs-keyword">sum</span>;<br>    &#125;<br>&#125;<br><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><h3 id="28-å¦‚æœæ•°æ®åº“ä¸€æ¬¡æŸ¥è¯¢çš„æ•°é‡è¿‡å¤šï¼Œå»ºè®®åˆ†é¡µå¤„ç†ã€‚"><a href="#28-å¦‚æœæ•°æ®åº“ä¸€æ¬¡æŸ¥è¯¢çš„æ•°é‡è¿‡å¤šï¼Œå»ºè®®åˆ†é¡µå¤„ç†ã€‚" class="headerlink" title="28. å¦‚æœæ•°æ®åº“ä¸€æ¬¡æŸ¥è¯¢çš„æ•°é‡è¿‡å¤šï¼Œå»ºè®®åˆ†é¡µå¤„ç†ã€‚"></a>28. å¦‚æœæ•°æ®åº“ä¸€æ¬¡æŸ¥è¯¢çš„æ•°é‡è¿‡å¤šï¼Œå»ºè®®åˆ†é¡µå¤„ç†ã€‚</h3><p>å¦‚æœä½ çš„Sqlä¸€æ¬¡æ€§æŸ¥å‡ºæ¥çš„æ•°æ®é‡æ¯”è¾ƒå¤šï¼Œå»ºè®®åˆ†é¡µå¤„ç†ã€‚</p><p><strong>åä¾‹ï¼š</strong></p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> user_id,name,age <span class="hljs-keyword">from</span> user_info ;<br><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p><strong>æ­£ä¾‹ï¼š</strong></p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> user_id,name,age <span class="hljs-keyword">from</span> user_info <span class="hljs-keyword">limit</span> #&#123;<span class="hljs-keyword">offset</span>&#125;,#&#123;pageSize&#125;;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>å¦‚æœåç§»é‡ç‰¹åˆ«å¤§çš„æ—¶å€™ï¼ŒæŸ¥è¯¢æ•ˆç‡å°±å˜å¾—ä½ä¸‹ã€‚å¯ä»¥è¿™æ¥ç§æ–¹å¼ä¼˜åŒ–ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">//æ–¹æ¡ˆä¸€ ï¼šè¿”å›ä¸Šæ¬¡æŸ¥è¯¢çš„æœ€å¤§è®°å½•(åç§»é‡)<br><span class="hljs-keyword">select</span> idï¼Œ<span class="hljs-type">name</span> <span class="hljs-keyword">from</span> user_info <span class="hljs-keyword">where</span> id&gt;<span class="hljs-number">10000</span> <span class="hljs-keyword">limit</span> #&#123;pageSize&#125;.<br><br>//æ–¹æ¡ˆäºŒï¼š<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> + ç´¢å¼•<br><span class="hljs-keyword">select</span> idï¼Œ<span class="hljs-type">name</span> <span class="hljs-keyword">from</span> user_info <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> id  <span class="hljs-keyword">limit</span> #&#123;<span class="hljs-keyword">offset</span>&#125;,#&#123;pageSize&#125;<br><br>//æ–¹æ¡ˆä¸‰ï¼šåœ¨ä¸šåŠ¡å…è®¸çš„æƒ…å†µä¸‹é™åˆ¶é¡µæ•°ï¼š<br><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><h3 id="29-å°½é‡å‡å°‘å¯¹å˜é‡çš„é‡å¤è®¡ç®—"><a href="#29-å°½é‡å‡å°‘å¯¹å˜é‡çš„é‡å¤è®¡ç®—" class="headerlink" title="29. å°½é‡å‡å°‘å¯¹å˜é‡çš„é‡å¤è®¡ç®—"></a>29. å°½é‡å‡å°‘å¯¹å˜é‡çš„é‡å¤è®¡ç®—</h3><p>ä¸€èˆ¬æˆ‘ä»¬å†™ä»£ç çš„æ—¶å€™ï¼Œä¼šä»¥ä»¥ä¸‹çš„æ–¹å¼å®ç°éå†ï¼š</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">list</span>.<span class="hljs-built_in">size</span>; i++)&#123;<br><br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>å¦‚æœlistæ•°æ®é‡æ¯”è¾ƒå°é‚£è¿˜å¥½ã€‚å¦‚æœlistæ¯”è¾ƒå¤§æ—¶ï¼Œå¯ä»¥ä¼˜åŒ–æˆè¿™æ ·ï¼š</p><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>, <span class="hljs-type">int</span> <span class="hljs-built_in">length</span> = list.size; i &lt; <span class="hljs-built_in">length</span>; i++)&#123;<br><br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>ç†ç”±ï¼š</p><ul><li>å¯¹æ–¹æ³•çš„è°ƒç”¨ï¼Œå³ä½¿æ˜¯åªæœ‰ä¸€ä¸ªè¯­å¥ï¼Œä¹Ÿæ˜¯æœ‰æœ‰æ¶ˆè€—çš„ï¼Œæ¯”å¦‚åˆ›å»ºæ ˆå¸§ã€‚å¦‚æœlistæ¯”è¾ƒå¤§æ—¶ï¼Œå¤šæ¬¡è°ƒç”¨list.sizeä¹Ÿæ˜¯ä¼šæœ‰èµ„æºæ¶ˆè€—çš„ã€‚</li></ul><h3 id="30-ä¿®æ”¹å¯¹å¤–è€æ¥å£çš„æ—¶å€™ï¼Œæ€è€ƒæ¥å£çš„å…¼å®¹æ€§ã€‚"><a href="#30-ä¿®æ”¹å¯¹å¤–è€æ¥å£çš„æ—¶å€™ï¼Œæ€è€ƒæ¥å£çš„å…¼å®¹æ€§ã€‚" class="headerlink" title="30. ä¿®æ”¹å¯¹å¤–è€æ¥å£çš„æ—¶å€™ï¼Œæ€è€ƒæ¥å£çš„å…¼å®¹æ€§ã€‚"></a>30. ä¿®æ”¹å¯¹å¤–è€æ¥å£çš„æ—¶å€™ï¼Œæ€è€ƒæ¥å£çš„å…¼å®¹æ€§ã€‚</h3><p>å¾ˆå¤šbugéƒ½æ˜¯å› ä¸ºä¿®æ”¹äº†å¯¹å¤–è€æ¥å£ï¼Œä½†æ˜¯å´ä¸åšå…¼å®¹å¯¼è‡´çš„ã€‚å…³é”®è¿™ä¸ªé—®é¢˜å¤šæ•°æ˜¯æ¯”è¾ƒä¸¥é‡çš„ï¼Œå¯èƒ½ç›´æ¥å¯¼è‡´ç³»ç»Ÿå‘ç‰ˆå¤±è´¥çš„ã€‚æ–°æ‰‹ç¨‹åºå‘˜å¾ˆå®¹æ˜“å°±çŠ¯è¿™ä¸ªé”™è¯¯äº†å“¦~</p><p>æ‰€ä»¥ï¼Œå¦‚æœä½ çš„éœ€æ±‚æ˜¯åœ¨åŸæ¥æ¥å£ä¸Šä¿®æ”¹ï¼Œï¼Œå°¤å…¶è¿™ä¸ªæ¥å£æ˜¯å¯¹å¤–æä¾›æœåŠ¡çš„è¯ï¼Œä¸€å®šè¦è€ƒè™‘æ¥å£å…¼å®¹ã€‚ä¸¾ä¸ªä¾‹å­å§ï¼Œæ¯”å¦‚dubboæ¥å£ï¼ŒåŸæœ¬æ˜¯åªæ¥æ”¶Aï¼ŒBå‚æ•°ï¼Œç°åœ¨ä½ åŠ äº†ä¸€ä¸ªå‚æ•°Cï¼Œå°±å¯ä»¥è€ƒè™‘è¿™æ ·å¤„ç†ã€‚</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-comment">//è€æ¥å£</span><br>void old<span class="hljs-constructor">Service(A,B)</span>;&#123;<br>  <span class="hljs-comment">//å…¼å®¹æ–°æ¥å£ï¼Œä¼ ä¸ªnullä»£æ›¿C</span><br>  <span class="hljs-keyword">new</span><span class="hljs-constructor">Service(A,B,<span class="hljs-params">null</span>)</span>;<br>&#125;<br><br><span class="hljs-comment">//æ–°æ¥å£ï¼Œæš‚æ—¶ä¸èƒ½åˆ æ‰è€æ¥å£ï¼Œéœ€è¦åšå…¼å®¹ã€‚</span><br>void <span class="hljs-keyword">new</span><span class="hljs-constructor">Service(A,B,C)</span>;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><h3 id="31-ä»£ç é‡‡å–æªæ–½é¿å…è¿è¡Œæ—¶é”™è¯¯ï¼ˆå¦‚æ•°ç»„è¾¹ç•Œæº¢å‡ºï¼Œè¢«é›¶é™¤ç­‰ï¼‰"><a href="#31-ä»£ç é‡‡å–æªæ–½é¿å…è¿è¡Œæ—¶é”™è¯¯ï¼ˆå¦‚æ•°ç»„è¾¹ç•Œæº¢å‡ºï¼Œè¢«é›¶é™¤ç­‰ï¼‰" class="headerlink" title="31 ä»£ç é‡‡å–æªæ–½é¿å…è¿è¡Œæ—¶é”™è¯¯ï¼ˆå¦‚æ•°ç»„è¾¹ç•Œæº¢å‡ºï¼Œè¢«é›¶é™¤ç­‰ï¼‰"></a>31 ä»£ç é‡‡å–æªæ–½é¿å…è¿è¡Œæ—¶é”™è¯¯ï¼ˆå¦‚æ•°ç»„è¾¹ç•Œæº¢å‡ºï¼Œè¢«é›¶é™¤ç­‰ï¼‰</h3><p>æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬éœ€è¦é‡‡å–æªæ–½è§„é¿æ•°ç»„è¾¹ç•Œæº¢å‡ºï¼Œè¢«é›¶æ•´é™¤ï¼Œç©ºæŒ‡é’ˆç­‰è¿è¡Œæ—¶é”™è¯¯ã€‚</p><p>ç±»ä¼¼ä»£ç æ¯”è¾ƒå¸¸è§:</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">String</span> name = <span class="hljs-built_in">list</span>.<span class="hljs-built_in">get</span>(<span class="hljs-number">1</span>).getName(); <span class="hljs-comment">//listå¯èƒ½è¶Šç•Œï¼Œå› ä¸ºä¸ä¸€å®šæœ‰2ä¸ªå…ƒç´ å“ˆ</span><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼Œåº”è¯¥é‡‡å–æªæ–½ï¼Œé¢„é˜²ä¸€ä¸‹æ•°ç»„è¾¹ç•Œæº¢å‡ºï¼Œ<strong>æ­£ä¾‹ï¼š</strong></p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-keyword">if</span>(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">CollectionsUtil</span>.</span></span>is<span class="hljs-constructor">NotEmpty(<span class="hljs-params">list</span>)</span>&amp;&amp; <span class="hljs-built_in">list</span>.size<span class="hljs-literal">()</span>&gt;<span class="hljs-number">1</span>)&#123;<br>  String name = <span class="hljs-built_in">list</span>.get(<span class="hljs-number">1</span>).get<span class="hljs-constructor">Name()</span>; <br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><h3 id="32-æ³¨æ„-ArrayList-toArray-å¼ºè½¬çš„å‘"><a href="#32-æ³¨æ„-ArrayList-toArray-å¼ºè½¬çš„å‘" class="headerlink" title="32. æ³¨æ„ ArrayList.toArray() å¼ºè½¬çš„å‘"></a>32. æ³¨æ„ ArrayList.toArray() å¼ºè½¬çš„å‘</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ArrayListTest</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-function"><span class="hljs-title">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>)</span> &#123;<br>        List&lt;<span class="hljs-built_in">String</span>&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;<span class="hljs-built_in">String</span>&gt;(<span class="hljs-number">1</span>);<br>        list.add(<span class="hljs-string">&quot;å…¬ä¼—å·ï¼šæ¡ç”°èºçš„å°ç”·å­©&quot;</span>);<br>        <span class="hljs-built_in">String</span>[] array21 = (<span class="hljs-built_in">String</span>[])list.toArray();<span class="hljs-comment">//ç±»å‹è½¬æ¢å¼‚å¸¸</span><br>    &#125;<br>&#125;<br><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>å› ä¸ºè¿”å›çš„æ˜¯Objectç±»å‹ï¼ŒObjectç±»å‹æ•°ç»„å¼ºè½¬Stringæ•°ç»„ï¼Œä¼šå‘ç”ŸClassCastExceptionã€‚è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œä½¿ç”¨toArray()é‡è½½æ–¹æ³•toArray(T[] a)</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">String</span>[] array1 = <span class="hljs-built_in">list</span>.toArray(<span class="hljs-keyword">new</span> <span class="hljs-keyword">String</span>[<span class="hljs-number">0</span>]);<span class="hljs-comment">//å¯ä»¥æ­£å¸¸è¿è¡Œ</span><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><h3 id="33-å°½é‡ä¸åœ¨å¾ªç¯é‡Œè¿œç¨‹è°ƒç”¨ã€æˆ–è€…æ•°æ®åº“æ“ä½œï¼Œä¼˜å…ˆè€ƒè™‘æ‰¹é‡è¿›è¡Œã€‚"><a href="#33-å°½é‡ä¸åœ¨å¾ªç¯é‡Œè¿œç¨‹è°ƒç”¨ã€æˆ–è€…æ•°æ®åº“æ“ä½œï¼Œä¼˜å…ˆè€ƒè™‘æ‰¹é‡è¿›è¡Œã€‚" class="headerlink" title="33. å°½é‡ä¸åœ¨å¾ªç¯é‡Œè¿œç¨‹è°ƒç”¨ã€æˆ–è€…æ•°æ®åº“æ“ä½œï¼Œä¼˜å…ˆè€ƒè™‘æ‰¹é‡è¿›è¡Œã€‚"></a>33. å°½é‡ä¸åœ¨å¾ªç¯é‡Œè¿œç¨‹è°ƒç”¨ã€æˆ–è€…æ•°æ®åº“æ“ä½œï¼Œä¼˜å…ˆè€ƒè™‘æ‰¹é‡è¿›è¡Œã€‚</h3><p>ç¨‹æ“ä½œæˆ–è€…æ•°æ®åº“æ“ä½œéƒ½æ˜¯æ¯”è¾ƒè€—ç½‘ç»œã€IOèµ„æºçš„ï¼Œæ‰€ä»¥å°½é‡ä¸åœ¨å¾ªç¯é‡Œè¿œç¨‹è°ƒç”¨ã€ä¸åœ¨å¾ªç¯é‡Œæ“ä½œæ•°æ®åº“ï¼Œèƒ½æ‰¹é‡ä¸€æ¬¡æ€§æŸ¥å›æ¥å°½é‡ä¸è¦å¾ªç¯å¤šæ¬¡å»æŸ¥ã€‚ï¼ˆä½†æ˜¯å‘¢ï¼Œä¹Ÿä¸è¦ä¸€æ¬¡æ€§æŸ¥å¤ªå¤šæ•°æ®å“ˆï¼Œè¦åˆ†æ‰¹500ä¸€æ¬¡é…±ç´«ï¼‰</p><p><strong>æ­£ä¾‹ï¼š</strong></p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">remote<span class="hljs-constructor">BatchQuery(<span class="hljs-params">param</span>)</span>;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p><strong>åä¾‹ï¼š</strong></p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-function"><span class="hljs-title">for</span>(<span class="hljs-variable">int</span> <span class="hljs-variable">i</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">i</span>&lt;<span class="hljs-variable">n</span>;<span class="hljs-variable">i</span>++)&#123;</span><br><span class="hljs-function">  <span class="hljs-title">remoteSingleQuery</span>(<span class="hljs-variable">param</span>)</span><br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><h3 id="34-å†™å®Œä»£ç ï¼Œè„‘æ´ä¸€ä¸‹å¤šçº¿ç¨‹æ‰§è¡Œä¼šæ€æ ·ï¼Œæ³¨æ„å¹¶å‘ä¸€è‡´æ€§é—®é¢˜"><a href="#34-å†™å®Œä»£ç ï¼Œè„‘æ´ä¸€ä¸‹å¤šçº¿ç¨‹æ‰§è¡Œä¼šæ€æ ·ï¼Œæ³¨æ„å¹¶å‘ä¸€è‡´æ€§é—®é¢˜" class="headerlink" title="34. å†™å®Œä»£ç ï¼Œè„‘æ´ä¸€ä¸‹å¤šçº¿ç¨‹æ‰§è¡Œä¼šæ€æ ·ï¼Œæ³¨æ„å¹¶å‘ä¸€è‡´æ€§é—®é¢˜"></a>34. å†™å®Œä»£ç ï¼Œè„‘æ´ä¸€ä¸‹å¤šçº¿ç¨‹æ‰§è¡Œä¼šæ€æ ·ï¼Œæ³¨æ„å¹¶å‘ä¸€è‡´æ€§é—®é¢˜</h3><p>æˆ‘ä»¬ç»å¸¸è§çš„ä¸€äº›ä¸šåŠ¡åœºæ™¯ï¼Œå°±æ˜¯å…ˆæŸ¥ä¸‹æœ‰æ²¡æœ‰è®°å½•ï¼Œå†è¿›è¡Œå¯¹åº”çš„æ“ä½œï¼ˆæ¯”å¦‚ä¿®æ”¹ï¼‰ã€‚ä½†æ˜¯å‘¢ï¼Œ(æŸ¥è¯¢+ä¿®æ”¹)åˆåœ¨ä¸€èµ·ä¸æ˜¯åŸå­æ“ä½œå“¦ï¼Œè„‘æ´ä¸‹å¤šçº¿ç¨‹ï¼Œå°±ä¼šå‘ç°æœ‰é—®é¢˜äº†ï¼Œ</p><p><strong>åä¾‹ï¼š</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">if</span>(<span class="hljs-function"><span class="hljs-title">isAvailable</span>(<span class="hljs-params">ticketId</span>)</span>&#123;  <span class="hljs-comment">//éåŸå­æ“ä½œ</span><br>    <span class="hljs-number">1</span>ã€ç»™ç°é‡‘å¢åŠ æ“ä½œ<br>    <span class="hljs-number">2</span>ã€deleteTicketById(ticketId)<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;æ²¡æœ‰å¯ç”¨ç°é‡‘åˆ¸&quot;</span>;<br>&#125;<br><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>ä¸ºäº†æ›´å®¹æ˜“ç†è§£å®ƒï¼Œçœ‹è¿™ä¸ªæµç¨‹å›¾å§ï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/image-20210404075941431.png" alt="image-20210404075941431"></p><ul><li>1.çº¿ç¨‹AåŠ ç°é‡‘</li><li>2.çº¿ç¨‹BåŠ ç°é‡‘</li><li>3.çº¿ç¨‹Aåˆ é™¤ç¥¨æ ‡å¿—</li><li>4.çº¿ç¨‹Båˆ é™¤ç¥¨æ ‡å¿—</li></ul><p>æ˜¾ç„¶è¿™æ ·å­˜åœ¨å¹¶å‘é—®é¢˜ï¼Œæ­£ä¾‹åº”è¯¥åˆ©ç”¨æ•°æ®åº“åˆ é™¤æ“ä½œçš„åŸå­æ€§ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">if</span><span class="hljs-params">(deleteAvailableTicketById(ticketId)</span></span> == <span class="hljs-number">1</span>)&#123;<span class="hljs-comment">//åŸå­æ“ä½œ</span><br>    <span class="hljs-number">1</span>ã€ç»™ç°é‡‘å¢åŠ æ“ä½œ<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    return â€œæ²¡æœ‰å¯ç”¨ç°é‡‘åˆ¸â€<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><h3 id="35-å¤šçº¿ç¨‹å¼‚æ­¥ä¼˜å…ˆè€ƒè™‘æ°å½“çš„çº¿ç¨‹æ± ï¼Œè€Œä¸æ˜¯new-thread-åŒæ—¶è€ƒè™‘çº¿ç¨‹æ± æ˜¯å¦éš”ç¦»"><a href="#35-å¤šçº¿ç¨‹å¼‚æ­¥ä¼˜å…ˆè€ƒè™‘æ°å½“çš„çº¿ç¨‹æ± ï¼Œè€Œä¸æ˜¯new-thread-åŒæ—¶è€ƒè™‘çº¿ç¨‹æ± æ˜¯å¦éš”ç¦»" class="headerlink" title="35 å¤šçº¿ç¨‹å¼‚æ­¥ä¼˜å…ˆè€ƒè™‘æ°å½“çš„çº¿ç¨‹æ± ï¼Œè€Œä¸æ˜¯new thread,åŒæ—¶è€ƒè™‘çº¿ç¨‹æ± æ˜¯å¦éš”ç¦»"></a>35 å¤šçº¿ç¨‹å¼‚æ­¥ä¼˜å…ˆè€ƒè™‘æ°å½“çš„çº¿ç¨‹æ± ï¼Œè€Œä¸æ˜¯new thread,åŒæ—¶è€ƒè™‘çº¿ç¨‹æ± æ˜¯å¦éš”ç¦»</h3><p>ä¸ºä»€ä¹ˆä¼˜å…ˆä½¿ç”¨çº¿ç¨‹æ± ï¼Ÿä½¿ç”¨çº¿ç¨‹æ± æœ‰è¿™å‡ ç‚¹å¥½å¤„å‘€</p><ul><li>å®ƒå¸®æˆ‘ä»¬ç®¡ç†çº¿ç¨‹ï¼Œé¿å…å¢åŠ åˆ›å»ºçº¿ç¨‹å’Œé”€æ¯çº¿ç¨‹çš„èµ„æºæŸè€—ã€‚</li><li>æé«˜å“åº”é€Ÿåº¦ã€‚</li><li>é‡å¤åˆ©ç”¨ã€‚</li></ul><p>åŒæ—¶å‘¢ï¼Œå°½é‡ä¸è¦æ‰€æœ‰ä¸šåŠ¡éƒ½å…±ç”¨ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œéœ€è¦è€ƒè™‘çº¿ç¨‹æ± éš”ç¦»ã€‚å°±æ˜¯ä¸åŒçš„å…³é”®ä¸šåŠ¡ï¼Œåˆ†é…ä¸åŒçš„çº¿ç¨‹æ± ï¼Œç„¶åçº¿ç¨‹æ± å‚æ•°ä¹Ÿè¦è€ƒè™‘æ°å½“å“ˆã€‚ä¹‹å‰å†™è¿‡å‡ ç¯‡çº¿ç¨‹æ± çš„ï¼Œè§‰å¾—è¿˜ä¸é”™ï¼Œæœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥çœ‹ä¸€ä¸‹å“ˆ</p><h3 id="36-ä¼˜åŒ–ç¨‹åºç»“æ„ï¼Œå°½é‡å‡å°‘æ–¹æ³•çš„é‡å¤è°ƒç”¨"><a href="#36-ä¼˜åŒ–ç¨‹åºç»“æ„ï¼Œå°½é‡å‡å°‘æ–¹æ³•çš„é‡å¤è°ƒç”¨" class="headerlink" title="36. ä¼˜åŒ–ç¨‹åºç»“æ„ï¼Œå°½é‡å‡å°‘æ–¹æ³•çš„é‡å¤è°ƒç”¨"></a>36. ä¼˜åŒ–ç¨‹åºç»“æ„ï¼Œå°½é‡å‡å°‘æ–¹æ³•çš„é‡å¤è°ƒç”¨</h3><p><strong>åä¾‹ï¼š</strong></p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs arduino">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">listDetail</span><span class="hljs-params">(List&lt;UserInfo&gt; userInfoList)</span> </span>&#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; userInfoList.<span class="hljs-built_in">size</span>(); i++) &#123;<br>            <span class="hljs-comment">//é‡å¤è°ƒç”¨userList.size()æ–¹æ³•äº†</span><br>        &#125;<br>    &#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p><strong>æ­£ä¾‹ï¼š</strong></p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs arduino"> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">listDetail</span><span class="hljs-params">(List&lt;UserInfo&gt; userInfoList)</span> </span>&#123;<br>        <span class="hljs-keyword">int</span> length = userInfoList.<span class="hljs-built_in">size</span>();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; length; i++) &#123;<br>            <span class="hljs-comment">//å‡å°‘è°ƒç”¨userList.size()æ–¹æ³•ï¼Œåªåœ¨lengthå˜é‡è°ƒäº†ä¸€æ¬¡ã€‚</span><br>        &#125;<br>    &#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><h3 id="37ï¼Œç›´æ¥å¤§æ–‡ä»¶æˆ–è€…ä¸€æ¬¡æ€§ä»æ•°æ®åº“è¯»å–å¤ªå¤šæ•°æ®åˆ°å†…å­˜ï¼Œå¯èƒ½å¯¼è‡´OOMé—®é¢˜"><a href="#37ï¼Œç›´æ¥å¤§æ–‡ä»¶æˆ–è€…ä¸€æ¬¡æ€§ä»æ•°æ®åº“è¯»å–å¤ªå¤šæ•°æ®åˆ°å†…å­˜ï¼Œå¯èƒ½å¯¼è‡´OOMé—®é¢˜" class="headerlink" title="37ï¼Œç›´æ¥å¤§æ–‡ä»¶æˆ–è€…ä¸€æ¬¡æ€§ä»æ•°æ®åº“è¯»å–å¤ªå¤šæ•°æ®åˆ°å†…å­˜ï¼Œå¯èƒ½å¯¼è‡´OOMé—®é¢˜"></a>37ï¼Œç›´æ¥å¤§æ–‡ä»¶æˆ–è€…ä¸€æ¬¡æ€§ä»æ•°æ®åº“è¯»å–å¤ªå¤šæ•°æ®åˆ°å†…å­˜ï¼Œå¯èƒ½å¯¼è‡´OOMé—®é¢˜</h3><p>å¦‚æœä¸€æ¬¡æ€§æŠŠå¤§æ–‡ä»¶æˆ–è€…æ•°æ®åº“å¤ªå¤šæ•°æ®è¾¾åˆ°å†…å­˜ï¼Œæ˜¯ä¼šå¯¼è‡´OOMçš„ã€‚æ‰€ä»¥ï¼Œä¸ºä»€ä¹ˆæŸ¥è¯¢DBæ•°æ®åº“ï¼Œä¸€èˆ¬éƒ½å»ºè®®åˆ†æ‰¹ã€‚</p><p>è¯»å–æ–‡ä»¶çš„è¯ï¼Œä¸€èˆ¬æ–‡ä»¶ä¸ä¼šå¤ªå¤§ï¼Œæ‰ä½¿ç”¨Files.readAllLines()ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºå®ƒæ˜¯ç›´æ¥æŠŠæ–‡ä»¶éƒ½è¯»åˆ°å†…å­˜çš„ï¼Œé¢„ä¼°ä¸‹ä¸ä¼šOOMæ‰ä½¿ç”¨è¿™ä¸ªå§ï¼Œå¯ä»¥çœ‹ä¸‹å®ƒçš„æºç ï¼š</p><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs processing"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;<span class="hljs-keyword">String</span>&gt; readAllLines(Path path, Charset cs) <span class="hljs-keyword">throws</span> IOException &#123;<br>    <span class="hljs-keyword">try</span> (<span class="hljs-keyword">BufferedReader</span> reader = newBufferedReader(path, cs)) &#123;<br>        List&lt;<span class="hljs-keyword">String</span>&gt; result = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (;;) &#123;<br>            <span class="hljs-keyword">String</span> <span class="hljs-built_in">line</span> = reader.readLine();<br>            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">line</span> == <span class="hljs-keyword">null</span>)<br>                <span class="hljs-keyword">break</span>;<br>            result.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">line</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>å¦‚æœæ˜¯å¤ªå¤§çš„æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨Files.line()æŒ‰éœ€è¯»å–ï¼Œå½“æ—¶è¯»å–æ–‡ä»¶è¿™äº›ï¼Œä¸€èˆ¬æ˜¯ä½¿ç”¨å®Œéœ€è¦å…³é—­èµ„æºæµçš„å“ˆã€‚</p><h3 id="38-è°ƒç”¨ç¬¬ä¸‰æ–¹æ¥å£ï¼Œéœ€è¦è€ƒè™‘å¼‚å¸¸å¤„ç†ï¼Œå®‰å…¨æ€§ï¼Œè¶…æ—¶é‡è¯•è¿™å‡ ä¸ªç‚¹ã€‚"><a href="#38-è°ƒç”¨ç¬¬ä¸‰æ–¹æ¥å£ï¼Œéœ€è¦è€ƒè™‘å¼‚å¸¸å¤„ç†ï¼Œå®‰å…¨æ€§ï¼Œè¶…æ—¶é‡è¯•è¿™å‡ ä¸ªç‚¹ã€‚" class="headerlink" title="38. è°ƒç”¨ç¬¬ä¸‰æ–¹æ¥å£ï¼Œéœ€è¦è€ƒè™‘å¼‚å¸¸å¤„ç†ï¼Œå®‰å…¨æ€§ï¼Œè¶…æ—¶é‡è¯•è¿™å‡ ä¸ªç‚¹ã€‚"></a>38. è°ƒç”¨ç¬¬ä¸‰æ–¹æ¥å£ï¼Œéœ€è¦è€ƒè™‘å¼‚å¸¸å¤„ç†ï¼Œå®‰å…¨æ€§ï¼Œè¶…æ—¶é‡è¯•è¿™å‡ ä¸ªç‚¹ã€‚</h3><p>æ—¥å¸¸å¼€å‘ä¸­ï¼Œç»å¸¸éœ€è¦è°ƒç”¨ç¬¬ä¸‰æ–¹æœåŠ¡ï¼Œæˆ–è€…åˆ†å¸ƒå¼è¿œç¨‹æœåŠ¡çš„çš„è¯ï¼Œéœ€è¦è€ƒè™‘ï¼š</p><ul><li>å¼‚å¸¸å¤„ç†ï¼ˆæ¯”å¦‚ï¼Œä½ è°ƒåˆ«äººçš„æ¥å£ï¼Œå¦‚æœå¼‚å¸¸äº†ï¼Œæ€ä¹ˆå¤„ç†ï¼Œæ˜¯é‡è¯•è¿˜æ˜¯å½“åšå¤±è´¥ï¼‰</li><li>è¶…æ—¶ï¼ˆæ²¡æ³•é¢„ä¼°å¯¹æ–¹æ¥å£ä¸€èˆ¬å¤šä¹…è¿”å›ï¼Œä¸€èˆ¬è®¾ç½®ä¸ªè¶…æ—¶æ–­å¼€æ—¶é—´ï¼Œä»¥ä¿æŠ¤ä½ çš„æ¥å£ï¼‰</li><li>é‡è¯•æ¬¡æ•°ï¼ˆä½ çš„æ¥å£è°ƒå¤±è´¥ï¼Œéœ€ä¸éœ€è¦é‡è¯•ï¼Œéœ€è¦ç«™åœ¨ä¸šåŠ¡ä¸Šè§’åº¦æ€è€ƒè¿™ä¸ªé—®é¢˜ï¼‰</li></ul><blockquote><p>ç®€å•ä¸€ä¸ªä¾‹å­ï¼Œä½ ä¸€ä¸ªhttpè¯·æ±‚è°ƒåˆ«äººçš„æœåŠ¡ï¼Œéœ€è¦è€ƒè™‘è®¾ç½®connect-timeï¼Œå’Œretryæ¬¡æ•°ã€‚</p></blockquote><h3 id="39-ä¸è¦ä½¿ç”¨å¾ªç¯æ‹·è´é›†åˆï¼Œå°½é‡ä½¿ç”¨JDKæä¾›çš„æ–¹æ³•æ‹·è´é›†åˆ"><a href="#39-ä¸è¦ä½¿ç”¨å¾ªç¯æ‹·è´é›†åˆï¼Œå°½é‡ä½¿ç”¨JDKæä¾›çš„æ–¹æ³•æ‹·è´é›†åˆ" class="headerlink" title="39 ä¸è¦ä½¿ç”¨å¾ªç¯æ‹·è´é›†åˆï¼Œå°½é‡ä½¿ç”¨JDKæä¾›çš„æ–¹æ³•æ‹·è´é›†åˆ"></a>39 ä¸è¦ä½¿ç”¨å¾ªç¯æ‹·è´é›†åˆï¼Œå°½é‡ä½¿ç”¨JDKæä¾›çš„æ–¹æ³•æ‹·è´é›†åˆ</h3><blockquote><ul><li>JDKæä¾›åŸç”ŸAPIæ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥æŒ‡å®šé›†åˆçš„å®¹é‡ï¼Œé¿å…å¤šæ¬¡æ‰©å®¹æŸè€—æ€§èƒ½ã€‚</li><li>è¿™äº›æ–¹æ³•çš„åº•å±‚è°ƒç”¨System.arraycopyæ–¹æ³•å®ç°ï¼Œè¿›è¡Œæ•°æ®çš„æ‰¹é‡æ‹·è´æ•ˆç‡æ›´é«˜ã€‚</li></ul></blockquote><p><strong>åä¾‹ï¼š</strong></p><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs pf">public List<span class="hljs-variable">&lt;UserInfo&gt;</span> copyMergeList(List<span class="hljs-variable">&lt;UserInfo&gt;</span> user1List, List<span class="hljs-variable">&lt;UserInfo&gt;</span> user2List) &#123;<br>     List<span class="hljs-variable">&lt;UserInfo&gt;</span> <span class="hljs-keyword">user</span>List = new ArrayList<span class="hljs-variable">&lt;&gt;</span>(user1List.size() + user2List.size());<br>     <span class="hljs-keyword">for</span> (UserInfo <span class="hljs-keyword">user</span> : user1List) &#123;<br>         <span class="hljs-keyword">user</span>List.add(<span class="hljs-keyword">user</span>);<br>     &#125;<br>     <span class="hljs-keyword">for</span> (UserInfo <span class="hljs-keyword">user</span> : user2List) &#123;<br>         <span class="hljs-keyword">user</span>List.add(<span class="hljs-keyword">user</span>);<br>     &#125;<br><br>     return user1List;<br> &#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p><strong>æ­£ä¾‹ï¼š</strong></p><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs pf">public List<span class="hljs-variable">&lt;UserInfo&gt;</span> copyMergeList(List<span class="hljs-variable">&lt;UserInfo&gt;</span> user1List, List<span class="hljs-variable">&lt;UserInfo&gt;</span> user2List) &#123;<br>     List<span class="hljs-variable">&lt;UserInfo&gt;</span> <span class="hljs-keyword">user</span>List = new ArrayList<span class="hljs-variable">&lt;&gt;</span>(user1List.size() + user2List.size());<br>     <span class="hljs-keyword">user</span>List.addAll(user1List);<br>     <span class="hljs-keyword">user</span>List.addAll(user2List);<br>     return user1List;<br> &#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><h3 id="40-å¯¹äºå¤æ‚çš„ä»£ç é€»è¾‘ï¼Œæ·»åŠ æ¸…æ¥šçš„æ³¨é‡Š"><a href="#40-å¯¹äºå¤æ‚çš„ä»£ç é€»è¾‘ï¼Œæ·»åŠ æ¸…æ¥šçš„æ³¨é‡Š" class="headerlink" title="40. å¯¹äºå¤æ‚çš„ä»£ç é€»è¾‘ï¼Œæ·»åŠ æ¸…æ¥šçš„æ³¨é‡Š"></a>40. å¯¹äºå¤æ‚çš„ä»£ç é€»è¾‘ï¼Œæ·»åŠ æ¸…æ¥šçš„æ³¨é‡Š</h3><p>å†™ä»£ç çš„æ—¶å€™ï¼Œæ˜¯æ²¡æœ‰å¿…è¦å†™å¤ªå¤šçš„æ³¨é‡Šçš„ï¼Œå¥½çš„æ–¹æ³•å˜é‡å‘½åå°±æ˜¯æœ€å¥½çš„æ³¨é‡Šã€‚ä½†æ˜¯ï¼Œå¦‚æœæ˜¯ä¸šåŠ¡é€»è¾‘å¾ˆå¤æ‚çš„ä»£ç ï¼ŒçœŸçš„éå¸¸æœ‰å¿…è¦å†™æ¸…æ¥šæ³¨é‡Šã€‚æ¸…æ¥šçš„æ³¨é‡Šï¼Œæ›´æœ‰åˆ©äºåé¢çš„ç»´æŠ¤ã€‚</p><h3 id="41-å¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œè€ƒè™‘çº¿æ€§å®‰å…¨é—®é¢˜"><a href="#41-å¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œè€ƒè™‘çº¿æ€§å®‰å…¨é—®é¢˜" class="headerlink" title="41. å¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œè€ƒè™‘çº¿æ€§å®‰å…¨é—®é¢˜"></a>41. å¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œè€ƒè™‘çº¿æ€§å®‰å…¨é—®é¢˜</h3><p>åœ¨é«˜å¹¶å‘æƒ…å†µä¸‹ï¼ŒHashMapå¯èƒ½ä¼šå‡ºç°æ­»å¾ªç¯ã€‚å› ä¸ºå®ƒæ˜¯éçº¿æ€§å®‰å…¨çš„ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ConcurrentHashMapã€‚ æ‰€ä»¥è¿™ä¸ªä¹Ÿå°½é‡å…»æˆä¹ æƒ¯ï¼Œä¸è¦ä¸Šæ¥åæ‰‹å°±æ˜¯ä¸€ä¸ªnew HashMap();</p><ul><li>Hashmapã€Arraylistã€LinkedListã€TreeMapç­‰éƒ½æ˜¯çº¿æ€§ä¸å®‰å…¨çš„ï¼›</li><li>Vectorã€Hashtableã€ConcurrentHashMapç­‰éƒ½æ˜¯çº¿æ€§å®‰å…¨çš„</li></ul><h3 id="42-ä½¿ç”¨springäº‹åŠ¡åŠŸèƒ½æ—¶ï¼Œæ³¨æ„è¿™å‡ ä¸ªäº‹åŠ¡æœªç”Ÿæ•ˆçš„å‘"><a href="#42-ä½¿ç”¨springäº‹åŠ¡åŠŸèƒ½æ—¶ï¼Œæ³¨æ„è¿™å‡ ä¸ªäº‹åŠ¡æœªç”Ÿæ•ˆçš„å‘" class="headerlink" title="42. ä½¿ç”¨springäº‹åŠ¡åŠŸèƒ½æ—¶ï¼Œæ³¨æ„è¿™å‡ ä¸ªäº‹åŠ¡æœªç”Ÿæ•ˆçš„å‘"></a>42. ä½¿ç”¨springäº‹åŠ¡åŠŸèƒ½æ—¶ï¼Œæ³¨æ„è¿™å‡ ä¸ªäº‹åŠ¡æœªç”Ÿæ•ˆçš„å‘</h3><p>æ—¥å¸¸ä¸šåŠ¡å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸è·Ÿäº‹åŠ¡æ‰“äº¤é“ï¼Œäº‹åŠ¡å¤±æ•ˆä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªåœºæ™¯ï¼š</p><ul><li>åº•å±‚æ•°æ®åº“å¼•æ“ä¸æ”¯æŒäº‹åŠ¡</li><li>åœ¨épublicä¿®é¥°çš„æ–¹æ³•ä½¿ç”¨</li><li>rollbackForå±æ€§è®¾ç½®é”™è¯¯</li><li>æœ¬ç±»æ–¹æ³•ç›´æ¥è°ƒç”¨</li><li>å¼‚å¸¸è¢«tryâ€¦catchåƒäº†ï¼Œå¯¼è‡´äº‹åŠ¡å¤±æ•ˆã€‚</li></ul><p><strong>åä¾‹ï¼š</strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TransactionTest</span></span>&#123;<br>  <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-function"><span class="hljs-title">A</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-comment">//æ’å…¥ä¸€æ¡æ•°æ®</span><br>    <span class="hljs-comment">//è°ƒç”¨æ–¹æ³•B (æœ¬åœ°çš„ç±»è°ƒç”¨ï¼Œäº‹åŠ¡å¤±æ•ˆäº†)</span><br>    B();<br>  &#125;<br>  <br>  <span class="hljs-meta">@Transactional</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-function"><span class="hljs-title">B</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-comment">//æ’å…¥æ•°æ®</span><br>  &#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p><strong>æ³¨è§£çš„äº‹åŠ¡æ–¹æ³•ç»™æœ¬ç±»æ–¹æ³•ç›´æ¥è°ƒç”¨ï¼Œäº‹åŠ¡å¤±æ•ˆ</strong></p><h3 id="43-ä½¿ç”¨Executorså£°æ˜çº¿ç¨‹æ± ï¼ŒnewFixedThreadPoolçš„OOMé—®é¢˜"><a href="#43-ä½¿ç”¨Executorså£°æ˜çº¿ç¨‹æ± ï¼ŒnewFixedThreadPoolçš„OOMé—®é¢˜" class="headerlink" title="43. ä½¿ç”¨Executorså£°æ˜çº¿ç¨‹æ± ï¼ŒnewFixedThreadPoolçš„OOMé—®é¢˜"></a>43. ä½¿ç”¨Executorså£°æ˜çº¿ç¨‹æ± ï¼ŒnewFixedThreadPoolçš„OOMé—®é¢˜</h3><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"> ExecutorService executor = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Executors</span>.</span></span><span class="hljs-keyword">new</span><span class="hljs-constructor">FixedThreadPool(10)</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; Integer.MAX_VALUE; i++) &#123;<br>            executor.execute(<span class="hljs-literal">()</span> -&gt; &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Thread</span>.</span></span>sleep(<span class="hljs-number">10000</span>);<br>                &#125; catch (InterruptedException e) &#123;<br>                    <span class="hljs-comment">//do nothing</span><br>                &#125;<br>            &#125;);<br>        &#125;<br><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>IDEæŒ‡å®šJVMå‚æ•°ï¼š-Xmx8m -Xms8m :</p><p><img src="/Users/cuixiaoyan/Library/Application%20Support/typora-user-images/image-20210404080311614.png" alt="image-20210404080311614"></p><p>è¿è¡Œç»“æœï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/image-20210404080325825.png" alt="image-20210404080325825"></p><p>æˆ‘ä»¬çœ‹ä¸‹æºç ï¼Œå…¶å®newFixedThreadPoolä½¿ç”¨çš„æ˜¯æ— ç•Œé˜Ÿåˆ—ï¼</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ExecutorService <span class="hljs-keyword">new</span><span class="hljs-type">FixedThreadPool</span>(int nThreads) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-type">ThreadPoolExecutor</span>(nThreads, nThreads,<br>                                  <span class="hljs-number">0</span>L, TimeUnit.MILLISECONDS,<br>                                  <span class="hljs-keyword">new</span> <span class="hljs-type">LinkedBlockingQueue</span>&lt;Runnable&gt;());<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LinkedBlockingQueue</span>&lt;<span class="hljs-title">E</span>&gt; <span class="hljs-keyword"><span class="hljs-keyword">extends</span> <span class="hljs-type">AbstractQueue</span></span>&lt;<span class="hljs-title">E</span>&gt;</span><br><span class="hljs-class">        <span class="hljs-keyword"><span class="hljs-keyword">implements</span> <span class="hljs-type">BlockingQueue</span></span>&lt;<span class="hljs-title">E</span>&gt;, <span class="hljs-title">java</span>.<span class="hljs-title">io</span>.<span class="hljs-title">Serializable</span> </span>&#123;<br>    ...<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Creates a &#123;@code LinkedBlockingQueue&#125; with a capacity of</span><br><span class="hljs-comment">     * &#123;@link Integer#MAX_VALUE&#125;.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> LinkedBlockingQueue() &#123;<br>        <span class="hljs-built_in">this</span>(Integer.MAX_VALUE);<br>    &#125;<br>...<br>&#125;<br><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><blockquote><p>newFixedThreadPoolçº¿ç¨‹æ± çš„æ ¸å¿ƒçº¿ç¨‹æ•°æ˜¯å›ºå®šçš„ï¼Œå®ƒä½¿ç”¨äº†è¿‘ä¹äºæ— ç•Œçš„LinkedBlockingQueueé˜»å¡é˜Ÿåˆ—ã€‚å½“æ ¸å¿ƒçº¿ç¨‹ç”¨å®Œåï¼Œä»»åŠ¡ä¼šå…¥é˜Ÿåˆ°é˜»å¡é˜Ÿåˆ—ï¼Œå¦‚æœä»»åŠ¡æ‰§è¡Œçš„æ—¶é—´æ¯”è¾ƒé•¿ï¼Œæ²¡æœ‰é‡Šæ”¾ï¼Œä¼šå¯¼è‡´è¶Šæ¥è¶Šå¤šçš„ä»»åŠ¡å †ç§¯åˆ°é˜»å¡é˜Ÿåˆ—ï¼Œæœ€åå¯¼è‡´æœºå™¨çš„å†…å­˜ä½¿ç”¨ä¸åœçš„é£™å‡ï¼Œé€ æˆJVM OOMã€‚</p></blockquote><h3 id="44-catchä½å¼‚å¸¸åï¼Œå°½é‡ä¸è¦ä½¿ç”¨e-printStackTrace-è€Œæ˜¯ä½¿ç”¨logæ‰“å°ã€‚"><a href="#44-catchä½å¼‚å¸¸åï¼Œå°½é‡ä¸è¦ä½¿ç”¨e-printStackTrace-è€Œæ˜¯ä½¿ç”¨logæ‰“å°ã€‚" class="headerlink" title="44. catchä½å¼‚å¸¸åï¼Œå°½é‡ä¸è¦ä½¿ç”¨e.printStackTrace(),è€Œæ˜¯ä½¿ç”¨logæ‰“å°ã€‚"></a>44. catchä½å¼‚å¸¸åï¼Œå°½é‡ä¸è¦ä½¿ç”¨e.printStackTrace(),è€Œæ˜¯ä½¿ç”¨logæ‰“å°ã€‚</h3><p><strong>åä¾‹ï¼š</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">try</span>&#123;<br>  <span class="hljs-comment">// do what you want  </span><br>&#125;<span class="hljs-keyword">catch</span>(Exception e)&#123;<br>  e.printStackTrace();<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p><strong>æ­£ä¾‹ï¼š</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">try</span>&#123;<br>  <span class="hljs-comment">// do what you want  </span><br>&#125;<span class="hljs-keyword">catch</span>(Exception e)&#123;<br>  <span class="hljs-built_in">log</span>.info(<span class="hljs-string">&quot;ä½ çš„ç¨‹åºæœ‰å¼‚å¸¸å•¦&quot;</span>,e);<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><h3 id="45-æ¥å£éœ€è¦è€ƒè™‘å¹‚ç­‰æ€§"><a href="#45-æ¥å£éœ€è¦è€ƒè™‘å¹‚ç­‰æ€§" class="headerlink" title="45. æ¥å£éœ€è¦è€ƒè™‘å¹‚ç­‰æ€§"></a>45. æ¥å£éœ€è¦è€ƒè™‘å¹‚ç­‰æ€§</h3><p>æ¥å£æ˜¯éœ€è¦è€ƒè™‘å¹‚ç­‰æ€§çš„ï¼Œå°¤å…¶æŠ¢çº¢åŒ…ã€è½¬è´¦è¿™äº›é‡è¦æ¥å£ã€‚æœ€ç›´è§‚çš„ä¸šåŠ¡åœºæ™¯ï¼Œå°±æ˜¯ç”¨æˆ·è¿ç€ç‚¹ä¸¤æ¬¡ï¼Œä½ çš„æ¥å£æœ‰æ²¡æœ‰holdä½ã€‚</p><p>ä¸€èˆ¬å¹‚ç­‰æŠ€æœ¯æ–¹æ¡ˆæœ‰è¿™å‡ ç§:</p><ul><li>æŸ¥è¯¢æ“ä½œ</li><li>å”¯ä¸€ç´¢å¼•</li><li>tokenæœºåˆ¶ï¼Œé˜²æ­¢é‡å¤æäº¤</li><li>æ•°æ®åº“çš„delete/updateæ“ä½œ</li><li>ä¹è§‚é”</li><li>æ‚²è§‚é”</li><li>Redisã€zookeeper åˆ†å¸ƒå¼é”ï¼ˆä»¥å‰æŠ¢çº¢åŒ…éœ€æ±‚ï¼Œç”¨äº†Redisåˆ†å¸ƒå¼é”ï¼‰</li><li>çŠ¶æ€æœºå¹‚ç­‰</li></ul><h3 id="46-å¯¹äºè¡Œæ•°æ¯”è¾ƒå¤šçš„å‡½æ•°ï¼Œå»ºè®®åˆ’åˆ†å°å‡½æ•°ï¼Œå¢å¼ºå¯è¯»æ€§ã€‚"><a href="#46-å¯¹äºè¡Œæ•°æ¯”è¾ƒå¤šçš„å‡½æ•°ï¼Œå»ºè®®åˆ’åˆ†å°å‡½æ•°ï¼Œå¢å¼ºå¯è¯»æ€§ã€‚" class="headerlink" title="46. å¯¹äºè¡Œæ•°æ¯”è¾ƒå¤šçš„å‡½æ•°ï¼Œå»ºè®®åˆ’åˆ†å°å‡½æ•°ï¼Œå¢å¼ºå¯è¯»æ€§ã€‚"></a>46. å¯¹äºè¡Œæ•°æ¯”è¾ƒå¤šçš„å‡½æ•°ï¼Œå»ºè®®åˆ’åˆ†å°å‡½æ•°ï¼Œå¢å¼ºå¯è¯»æ€§ã€‚</h3><p><strong>åä¾‹ï¼š</strong></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> Test &#123;<br>    private String <span class="hljs-type">name</span>;<br>    private Vector&lt;<span class="hljs-keyword">Order</span>&gt; orders = <span class="hljs-built_in">new</span> Vector&lt;<span class="hljs-keyword">Order</span>&gt;();<br><br>    <span class="hljs-built_in">public</span> <span class="hljs-type">void</span> printOwing() &#123;<br>        //print banner<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(&quot;****************&quot;);<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(&quot;*****customer Owes *****&quot;);<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(&quot;****************&quot;);<br><br>        //calculate totalAmount<br>        Enumeration env = orders.elements();<br>        <span class="hljs-type">double</span> totalAmount = <span class="hljs-number">0.0</span>;<br>        <span class="hljs-keyword">while</span> (env.hasMoreElements()) &#123;<br>            <span class="hljs-keyword">Order</span> <span class="hljs-keyword">order</span> = (<span class="hljs-keyword">Order</span>) env.nextElement();<br>            totalAmount += <span class="hljs-keyword">order</span>.getAmout();<br>        &#125;<br><br>        //print details<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(&quot;name:&quot; + <span class="hljs-type">name</span>);<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(&quot;amount:&quot; + totalAmount);<br>    &#125;<br>&#125;<br><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p><strong>æ­£ä¾‹ï¼š</strong></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> Test &#123;<br>    private String <span class="hljs-type">name</span>;<br>    private Vector&lt;<span class="hljs-keyword">Order</span>&gt; orders = <span class="hljs-built_in">new</span> Vector&lt;<span class="hljs-keyword">Order</span>&gt;();<br><br>    <span class="hljs-built_in">public</span> <span class="hljs-type">void</span> printOwing() &#123;<br><br>        //print banner<br>        printBanner();<br>        //calculate totalAmount<br>        <span class="hljs-type">double</span> totalAmount = getTotalAmount();<br>        //print details<br>        printDetail(totalAmount);<br>    &#125;<br><br>    <span class="hljs-type">void</span> printBanner()&#123;<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(&quot;****************&quot;);<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(&quot;*****customer Owes *****&quot;);<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(&quot;****************&quot;);<br>    &#125;<br><br>    <span class="hljs-type">double</span> getTotalAmount()&#123;<br>        Enumeration env = orders.elements();<br>        <span class="hljs-type">double</span> totalAmount = <span class="hljs-number">0.0</span>;<br>        <span class="hljs-keyword">while</span> (env.hasMoreElements()) &#123;<br>            <span class="hljs-keyword">Order</span> <span class="hljs-keyword">order</span> = (<span class="hljs-keyword">Order</span>) env.nextElement();<br>            totalAmount += <span class="hljs-keyword">order</span>.getAmout();<br>        &#125;<br>        <span class="hljs-keyword">return</span> totalAmount;<br>    &#125;<br><br>    <span class="hljs-type">void</span> printDetail(<span class="hljs-type">double</span> totalAmount)&#123;<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(&quot;name:&quot; + <span class="hljs-type">name</span>);<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(&quot;amount:&quot; + totalAmount);<br>    &#125;<br>    <br>&#125;<br><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>ä¸€ä¸ªè¿‡äºå†—é•¿çš„å‡½æ•°æˆ–è€…ä¸€æ®µéœ€è¦æ³¨é‡Šæ‰èƒ½è®©äººç†è§£ç”¨é€”çš„ä»£ç ï¼Œå¯ä»¥è€ƒè™‘æŠŠå®ƒåˆ‡åˆ†æˆä¸€ä¸ªåŠŸèƒ½æ˜ç¡®çš„å‡½æ•°å•å…ƒï¼Œå¹¶å®šä¹‰æ¸…æ™°ç®€çŸ­çš„å‡½æ•°åï¼Œè¿™æ ·ä¼šè®©ä»£ç å˜å¾—æ›´åŠ ä¼˜é›…ã€‚</p><h3 id="47-ä½ çš„å…³é”®ä¸šåŠ¡ä»£ç ï¼Œä¸€èˆ¬å»ºè®®æç‚¹æ—¥å¿—ä¿é©¾æŠ¤èˆªã€‚"><a href="#47-ä½ çš„å…³é”®ä¸šåŠ¡ä»£ç ï¼Œä¸€èˆ¬å»ºè®®æç‚¹æ—¥å¿—ä¿é©¾æŠ¤èˆªã€‚" class="headerlink" title="47. ä½ çš„å…³é”®ä¸šåŠ¡ä»£ç ï¼Œä¸€èˆ¬å»ºè®®æç‚¹æ—¥å¿—ä¿é©¾æŠ¤èˆªã€‚"></a>47. ä½ çš„å…³é”®ä¸šåŠ¡ä»£ç ï¼Œä¸€èˆ¬å»ºè®®æç‚¹æ—¥å¿—ä¿é©¾æŠ¤èˆªã€‚</h3><p>å…³é”®ä¸šåŠ¡ä»£ç æ— è®ºèº«å¤„ä½•åœ°ï¼Œéƒ½åº”è¯¥æœ‰è¶³å¤Ÿçš„æ—¥å¿—ä¿é©¾æŠ¤èˆªã€‚</p><blockquote><p>æ¯”å¦‚ï¼šä½ å®ç°è½¬è´¦ä¸šåŠ¡ï¼Œè½¬ä¸ªå‡ ç™¾ä¸‡ï¼Œç„¶åè½¬å¤±è´¥äº†ï¼Œæ¥ç€å®¢æˆ·æŠ•è¯‰ï¼Œç„¶åä½ è¿˜æ²¡æœ‰æ‰“å°åˆ°æ—¥å¿—ï¼Œæƒ³æƒ³é‚£ç§æ°´æ·±ç«çƒ­çš„å›°å¢ƒä¸‹ï¼Œä½ å´æ¯«æ— åŠæ³•ã€‚ã€‚ã€‚</p></blockquote><p>é‚£ä¹ˆï¼Œä½ çš„è½¬è´¦ä¸šåŠ¡éƒ½éœ€è¦é‚£äº›æ—¥å¿—ä¿¡æ¯å‘¢ï¼Ÿè‡³å°‘ï¼Œæ–¹æ³•è°ƒç”¨å‰ï¼Œå…¥å‚éœ€è¦æ‰“å°éœ€è¦å§ï¼Œæ¥å£è°ƒç”¨åï¼Œéœ€è¦æ•è·ä¸€ä¸‹å¼‚å¸¸å§ï¼ŒåŒæ—¶æ‰“å°å¼‚å¸¸ç›¸å…³æ—¥å¿—å§ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">transfer</span><span class="hljs-params">(TransferDTO transferDTO)</span></span>&#123;<br>    <span class="hljs-built_in">log</span>.info(<span class="hljs-string">&quot;invoke tranfer begin&quot;</span>);<br>    <span class="hljs-comment">//æ‰“å°å…¥å‚</span><br>    <span class="hljs-built_in">log</span>.info(<span class="hljs-string">&quot;invoke tranfer,paramters:&#123;&#125;&quot;</span>,transferDTO);<br>    <span class="hljs-keyword">try</span> &#123;<br>      res=  transferService.<span class="hljs-built_in">transfer</span>(transferDTO);<br>    &#125;<span class="hljs-keyword">catch</span>(Exception e)&#123;<br>     <span class="hljs-built_in">log</span>.error(<span class="hljs-string">&quot;transfer fail,cifno:&#123;&#125;ï¼Œaccountï¼š&#123;&#125;&quot;</span>,transferDTO.getCifnoï¼ˆï¼‰ï¼Œ<br>     transferDTO.getaccountï¼ˆï¼‰)<br>     <span class="hljs-built_in">log</span>.error(<span class="hljs-string">&quot;transfer fail,exception:&#123;&#125;&quot;</span>,e);<br>    &#125;<br>    <span class="hljs-built_in">log</span>.info(<span class="hljs-string">&quot;invoke tranfer end&quot;</span>);<br>    &#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>é™¤äº†æ‰“å°è¶³å¤Ÿçš„æ—¥å¿—ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ³¨æ„ä¸€ç‚¹æ˜¯ï¼Œæ—¥å¿—çº§åˆ«åˆ«æ··æ·†ä½¿ç”¨ï¼Œåˆ«æœ¬è¯¥æ‰“å°infoçš„æ—¥å¿—ï¼Œä½ å´æ‰“å°æˆerrorçº§åˆ«ï¼Œå‘Šè­¦åŠå¤œä¸‰æ›´å‚¬ä½ èµ·æ¥æ’æŸ¥é—®é¢˜å°±ä¸å¥½äº†ã€‚</p><h3 id="48-æŸäº›å¯å˜å› ç´ ï¼Œå¦‚çº¢åŒ…çš®è‚¤ç­‰ç­‰ï¼Œåšæˆé…ç½®åŒ–æ˜¯å¦ä¼šæ›´å¥½å‘¢ã€‚"><a href="#48-æŸäº›å¯å˜å› ç´ ï¼Œå¦‚çº¢åŒ…çš®è‚¤ç­‰ç­‰ï¼Œåšæˆé…ç½®åŒ–æ˜¯å¦ä¼šæ›´å¥½å‘¢ã€‚" class="headerlink" title="48. æŸäº›å¯å˜å› ç´ ï¼Œå¦‚çº¢åŒ…çš®è‚¤ç­‰ç­‰ï¼Œåšæˆé…ç½®åŒ–æ˜¯å¦ä¼šæ›´å¥½å‘¢ã€‚"></a>48. æŸäº›å¯å˜å› ç´ ï¼Œå¦‚çº¢åŒ…çš®è‚¤ç­‰ç­‰ï¼Œåšæˆé…ç½®åŒ–æ˜¯å¦ä¼šæ›´å¥½å‘¢ã€‚</h3><p>å‡å¦‚äº§å“æäº†ä¸ªçº¢åŒ…éœ€æ±‚ï¼Œåœ£è¯èŠ‚çš„æ—¶å€™ï¼Œçº¢åŒ…çš®è‚¤ä¸ºåœ£è¯èŠ‚ç›¸å…³çš„ï¼Œæ˜¥èŠ‚çš„æ—¶å€™ï¼Œçº¢åŒ…çš®è‚¤ç­‰ã€‚</p><p>åä¾‹:</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs gauss"><span class="hljs-keyword">if</span>(duringChristmas)&#123;<br>   img = redPacketChristmasSkin;<br>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(duringSpringFestival)&#123;<br>   img =  redSpringFestivalSkin;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>å¦‚æœåˆ°äº†å…ƒå®µèŠ‚çš„æ—¶å€™ï¼Œè¿è¥å°å§å§çªç„¶åˆæœ‰æƒ³æ³•ï¼Œçº¢åŒ…çš®è‚¤æ¢æˆç¯ç¬¼ç›¸å…³çš„ï¼Œè¿™æ—¶å€™ï¼Œæ˜¯ä¸æ˜¯è¦å»ä¿®æ”¹ä»£ç äº†ï¼Œé‡æ–°å‘å¸ƒäº†ï¼Ÿä»ä¸€å¼€å§‹ï¼Œå®ç°ä¸€å¼ çº¢åŒ…çš®è‚¤çš„é…ç½®è¡¨ï¼Œå°†çº¢åŒ…çš®è‚¤åšæˆé…ç½®åŒ–å‘¢ï¼Ÿæ›´æ¢çº¢åŒ…çš®è‚¤ï¼Œåªéœ€ä¿®æ”¹ä¸€ä¸‹è¡¨æ•°æ®å°±å¥½äº†ã€‚</p><h3 id="49ï¼Œ-ç›´æ¥è¿­ä»£éœ€è¦ä½¿ç”¨çš„é›†åˆ-æ— é¡»åœ¨é¢å¤–æ“ä½œ"><a href="#49ï¼Œ-ç›´æ¥è¿­ä»£éœ€è¦ä½¿ç”¨çš„é›†åˆ-æ— é¡»åœ¨é¢å¤–æ“ä½œ" class="headerlink" title="49ï¼Œ.ç›´æ¥è¿­ä»£éœ€è¦ä½¿ç”¨çš„é›†åˆ,æ— é¡»åœ¨é¢å¤–æ“ä½œ"></a>49ï¼Œ.ç›´æ¥è¿­ä»£éœ€è¦ä½¿ç”¨çš„é›†åˆ,æ— é¡»åœ¨é¢å¤–æ“ä½œ</h3><p>ç›´æ¥è¿­ä»£éœ€è¦ä½¿ç”¨çš„é›†åˆï¼Œæ— éœ€é€šè¿‡å…¶å®ƒæ“ä½œè·å–æ•°æ®ï¼Œæ¯”è¾ƒå…¸å‹å°±æ˜¯Mapçš„è¿­ä»£éå†ï¼š</p><p><strong>åä¾‹ï¼š</strong></p><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pf">Map<span class="hljs-variable">&lt;Long, UserDO&gt;</span> <span class="hljs-keyword">user</span>Map = ...;<br><span class="hljs-keyword">for</span> (Long <span class="hljs-keyword">user</span>Id : <span class="hljs-keyword">user</span>Map.keySet()) &#123;<br>    UserDO <span class="hljs-keyword">user</span> = <span class="hljs-keyword">user</span>Map.get(<span class="hljs-keyword">user</span>Id);<br>    ...<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p><strong>æ­£ä¾‹ï¼š</strong></p><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs pf">Map<span class="hljs-variable">&lt;Long, UserDO&gt;</span> <span class="hljs-keyword">user</span>Map = ...;<br><span class="hljs-keyword">for</span> (Map.Entry<span class="hljs-variable">&lt;Long, UserDO&gt;</span> <span class="hljs-keyword">user</span>Entry : <span class="hljs-keyword">user</span>Map.entrySet()) &#123;<br>    Long <span class="hljs-keyword">user</span>Id = <span class="hljs-keyword">user</span>Entry.getKey();<br>    UserDO <span class="hljs-keyword">user</span> = <span class="hljs-keyword">user</span>Entry.getValue();<br>    ...<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><h3 id="50-ç­–ç•¥æ¨¡å¼-å·¥å‚æ–¹æ³•ä¼˜åŒ–å†—ä½™çš„if-else"><a href="#50-ç­–ç•¥æ¨¡å¼-å·¥å‚æ–¹æ³•ä¼˜åŒ–å†—ä½™çš„if-else" class="headerlink" title="50. ç­–ç•¥æ¨¡å¼+å·¥å‚æ–¹æ³•ä¼˜åŒ–å†—ä½™çš„if else"></a>50. ç­–ç•¥æ¨¡å¼+å·¥å‚æ–¹æ³•ä¼˜åŒ–å†—ä½™çš„if else</h3><p>åä¾‹ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs csharp">    String medalType = <span class="hljs-string">&quot;guest&quot;</span>;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;guest&quot;</span>.<span class="hljs-keyword">equals</span>(medalType)) &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;å˜‰å®¾å‹‹ç« &quot;</span>);<br>     &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;vip&quot;</span>.<span class="hljs-keyword">equals</span>(medalType)) &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;ä¼šå‘˜å‹‹ç« &quot;</span>);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;guard&quot;</span>.<span class="hljs-keyword">equals</span>(medalType)) &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;å±•ç¤ºå®ˆæŠ¤å‹‹ç« &quot;</span>);<br>    &#125;<br>    ...<br><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>é¦–å…ˆï¼Œæˆ‘ä»¬æŠŠæ¯ä¸ªæ¡ä»¶é€»è¾‘ä»£ç å—ï¼ŒæŠ½è±¡æˆä¸€ä¸ªå…¬å…±çš„æ¥å£ï¼Œæˆ‘ä»¬æ ¹æ®æ¯ä¸ªé€»è¾‘æ¡ä»¶ï¼Œå®šä¹‰ç›¸å¯¹åº”çš„ç­–ç•¥å®ç°ç±»ï¼Œå¯å¾—ä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å‹‹ç« æ¥å£</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">IMedalService</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">showMedal</span><span class="hljs-params">()</span></span>;<br>&#125;<br><br><span class="hljs-comment">//å®ˆæŠ¤å‹‹ç« ç­–ç•¥å®ç°ç±»</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GuardMedalServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">IMedalService</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">showMedal</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;å±•ç¤ºå®ˆæŠ¤å‹‹ç« &quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-comment">//å˜‰å®¾å‹‹ç« ç­–ç•¥å®ç°ç±»</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GuestMedalServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">IMedalService</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">showMedal</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;å˜‰å®¾å‹‹ç« &quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-comment">//VIPå‹‹ç« ç­–ç•¥å®ç°ç±»</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VipMedalServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">IMedalService</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">showMedal</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;ä¼šå‘˜å‹‹ç« &quot;</span>);<br>    &#125;<br>&#125;<br><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†å®šä¹‰ç­–ç•¥å·¥å‚ç±»ï¼Œç”¨æ¥ç®¡ç†è¿™äº›å‹‹ç« å®ç°ç­–ç•¥ç±»ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-comment">//å‹‹ç« æœåŠ¡å·¥äº§ç±»</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MedalServicesFactory</span> &#123;</span><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&lt;<span class="hljs-keyword">String</span>, IMedalService&gt; <span class="hljs-built_in">map</span> = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br>    <span class="hljs-keyword">static</span> &#123;<br>        <span class="hljs-built_in">map</span>.<span class="hljs-built_in">put</span>(<span class="hljs-string">&quot;guard&quot;</span>, <span class="hljs-keyword">new</span> GuardMedalServiceImpl());<br>        <span class="hljs-built_in">map</span>.<span class="hljs-built_in">put</span>(<span class="hljs-string">&quot;vip&quot;</span>, <span class="hljs-keyword">new</span> VipMedalServiceImpl());<br>        <span class="hljs-built_in">map</span>.<span class="hljs-built_in">put</span>(<span class="hljs-string">&quot;guest&quot;</span>, <span class="hljs-keyword">new</span> GuestMedalServiceImpl());<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> IMedalService <span class="hljs-title">getMedalService</span><span class="hljs-params">(<span class="hljs-keyword">String</span> medalType)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">map</span>.<span class="hljs-built_in">get</span>(medalType);<br>    &#125;<br>&#125;<br><br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>ä¼˜åŒ–åï¼Œæ­£ä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript">ublic <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-function"><span class="hljs-title">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>)</span> &#123;<br>        <span class="hljs-built_in">String</span> medalType = <span class="hljs-string">&quot;guest&quot;</span>;<br>        IMedalService medalService = MedalServicesFactory.getMedalService(medalType);<br>        medalService.showMedal();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>æŠ€å·§</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç­–ç•¥æ¨¡å¼</title>
    <link href="/blog/2021/03/28/%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/"/>
    <url>/blog/2021/03/28/%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<h3 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h3><p>è¿™é‡Œè™šæ‹Ÿä¸€ä¸ªä¸šåŠ¡éœ€æ±‚ï¼Œè®©å¤§å®¶å®¹æ˜“ç†è§£ã€‚å‡è®¾æœ‰ä¸€ä¸ªè®¢å•ç³»ç»Ÿï¼Œé‡Œé¢çš„ä¸€ä¸ªåŠŸèƒ½æ˜¯æ ¹æ®è®¢å•çš„ä¸åŒç±»å‹ä½œå‡ºä¸åŒçš„å¤„ç†ã€‚</p><p>è®¢å•å®ä½“ï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/dd35d29f4a5c41b5bd8b03679bfcc0bf~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>serviceæ¥å£ï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/6ff1cd688d7c42d0a739a0bfacad449f~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><h4 id="ä¼ ç»Ÿå®ç°"><a href="#ä¼ ç»Ÿå®ç°" class="headerlink" title="ä¼ ç»Ÿå®ç°"></a>ä¼ ç»Ÿå®ç°</h4><p>æ ¹æ®è®¢å•ç±»å‹å†™ä¸€å †çš„if elseï¼š</p><p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p><h4 id="ç­–ç•¥æ¨¡å¼å®ç°"><a href="#ç­–ç•¥æ¨¡å¼å®ç°" class="headerlink" title="ç­–ç•¥æ¨¡å¼å®ç°"></a>ç­–ç•¥æ¨¡å¼å®ç°</h4><p>åˆ©ç”¨ç­–ç•¥æ¨¡å¼ï¼Œåªéœ€è¦ä¸¤è¡Œå³å¯å®ç°ä¸šåŠ¡é€»è¾‘ï¼š</p><p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p><p>å¯ä»¥çœ‹åˆ°ä¸Šé¢çš„æ–¹æ³•ä¸­æ³¨å…¥äº†HandlerContextï¼Œè¿™æ˜¯ä¸€ä¸ªå¤„ç†å™¨ä¸Šä¸‹æ–‡ï¼Œç”¨æ¥ä¿å­˜ä¸åŒçš„ä¸šåŠ¡å¤„ç†å™¨ï¼Œå…·ä½“åœ¨ä¸‹æ–‡ä¼šè®²è§£ã€‚æˆ‘ä»¬ä»ä¸­è·å–ä¸€ä¸ªæŠ½è±¡çš„å¤„ç†å™¨AbstractHandlerï¼Œè°ƒç”¨å…¶æ–¹æ³•å®ç°ä¸šåŠ¡é€»è¾‘ã€‚</p><p>ç°åœ¨å¯ä»¥äº†è§£åˆ°ï¼Œæˆ‘ä»¬ä¸»è¦çš„ä¸šåŠ¡é€»è¾‘æ˜¯åœ¨å¤„ç†å™¨ä¸­å®ç°çš„ï¼Œå› æ­¤æœ‰å¤šå°‘ä¸ªè®¢å•ç±»å‹ï¼Œå°±å¯¹åº”æœ‰å¤šå°‘ä¸ªå¤„ç†å™¨ã€‚ä»¥åéœ€æ±‚å˜åŒ–ï¼Œå¢åŠ äº†è®¢å•ç±»å‹ï¼Œåªéœ€è¦æ·»åŠ ç›¸åº”çš„å¤„ç†å™¨å°±å¯ä»¥ï¼Œä¸Šè¿°OrderServiceV2Implå®Œå…¨ä¸éœ€æ”¹åŠ¨ã€‚</p><p>æˆ‘ä»¬å…ˆçœ‹çœ‹ä¸šåŠ¡å¤„ç†å™¨çš„å†™æ³•ï¼š</p><p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p><p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/e0f051a781254871b99822b8201a934e~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>é¦–å…ˆæ¯ä¸ªå¤„ç†å™¨éƒ½å¿…é¡»æ·»åŠ åˆ°springå®¹å™¨ä¸­ï¼Œå› æ­¤éœ€è¦åŠ ä¸Š@Componentæ³¨è§£ï¼Œå…¶æ¬¡éœ€è¦åŠ ä¸Šä¸€ä¸ªè‡ªå®šä¹‰æ³¨è§£@HandlerTypeï¼Œç”¨äºæ ‡è¯†è¯¥å¤„ç†å™¨å¯¹åº”å“ªä¸ªè®¢å•ç±»å‹ï¼Œæœ€åå°±æ˜¯ç»§æ‰¿AbstractHandlerï¼Œå®ç°è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ã€‚</p><p>è‡ªå®šä¹‰æ³¨è§£ @HandlerTypeï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/8032c90d458e48ec8af53cd379df9e97~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>æŠ½è±¡å¤„ç†å™¨ AbstractHandlerï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/886e68e0466645b6a474a675c29cc872~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>è‡ªå®šä¹‰æ³¨è§£å’ŒæŠ½è±¡å¤„ç†å™¨éƒ½å¾ˆç®€å•ï¼Œé‚£ä¹ˆå¦‚ä½•å°†å¤„ç†å™¨æ³¨å†Œåˆ°springå®¹å™¨ä¸­å‘¢ï¼Ÿ</p><p><strong>å…·ä½“æ€è·¯æ˜¯ï¼š</strong></p><p>1ã€æ‰«ææŒ‡å®šåŒ…ä¸­æ ‡æœ‰@HandlerTypeçš„ç±»ï¼›</p><p>2ã€å°†æ³¨è§£ä¸­çš„ç±»å‹å€¼ä½œä¸ºkeyï¼Œå¯¹åº”çš„ç±»ä½œä¸ºvalueï¼Œä¿å­˜åœ¨Mapä¸­ï¼›</p><p>3ã€ä»¥ä¸Šé¢çš„mapä½œä¸ºæ„é€ å‡½æ•°å‚æ•°ï¼Œåˆå§‹åŒ–HandlerContextï¼Œå°†å…¶æ³¨å†Œåˆ°springå®¹å™¨ä¸­ï¼›</p><p>æˆ‘ä»¬å°†æ ¸å¿ƒçš„åŠŸèƒ½å°è£…åœ¨HandlerProcessorç±»ä¸­ï¼Œå®Œæˆä¸Šé¢çš„åŠŸèƒ½ã€‚</p><p>HandlerProcessorï¼š</p><p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p><h3 id="ClassScannerï¼šæ‰«æå·¥å…·ç±»æºç "><a href="#ClassScannerï¼šæ‰«æå·¥å…·ç±»æºç " class="headerlink" title="ClassScannerï¼šæ‰«æå·¥å…·ç±»æºç "></a>ClassScannerï¼šæ‰«æå·¥å…·ç±»æºç </h3><p>HandlerProcessoréœ€è¦å®ç°BeanFactoryPostProcessorï¼Œåœ¨springå¤„ç†beanå‰ï¼Œå°†è‡ªå®šä¹‰çš„beanæ³¨å†Œåˆ°å®¹å™¨ä¸­ã€‚</p><p>æ ¸å¿ƒå·¥ä½œå·²ç»å®Œæˆï¼Œç°åœ¨çœ‹çœ‹HandlerContextå¦‚ä½•è·å–å¯¹åº”çš„å¤„ç†å™¨ï¼š</p><p>HandlerContextï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/2ca36049758a4e3cb87d2ce13c45f5f9~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>BeanToolï¼šè·å–beanå·¥å…·ç±»</p><p><code>#getInstance</code> æ–¹æ³•æ ¹æ®ç±»å‹è·å–å¯¹åº”çš„classï¼Œç„¶åæ ¹æ®classç±»å‹è·å–æ³¨å†Œåˆ°springä¸­çš„beanã€‚</p><p>æœ€åè¯·æ³¨æ„ä¸€ç‚¹ï¼ŒHandlerProcessorå’ŒBeanToolå¿…é¡»èƒ½è¢«æ‰«æåˆ°ï¼Œæˆ–è€…é€šè¿‡@Beançš„æ–¹å¼æ˜¾å¼çš„æ³¨å†Œï¼Œæ‰èƒ½åœ¨é¡¹ç›®å¯åŠ¨æ—¶å‘æŒ¥ä½œç”¨ã€‚</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>åˆ©ç”¨ç­–ç•¥æ¨¡å¼å¯ä»¥ç®€åŒ–ç¹æ‚çš„if elseä»£ç ï¼Œæ–¹ä¾¿ç»´æŠ¤ï¼Œè€Œåˆ©ç”¨è‡ªå®šä¹‰æ³¨è§£å’Œè‡ªæ³¨å†Œçš„æ–¹å¼ï¼Œå¯ä»¥æ–¹ä¾¿åº”å¯¹éœ€æ±‚çš„å˜æ›´ã€‚æœ¬æ–‡åªæ˜¯æä¾›ä¸€ä¸ªå¤§è‡´çš„æ€è·¯ï¼Œè¿˜æœ‰å¾ˆå¤šç»†èŠ‚å¯ä»¥çµæ´»å˜åŒ–ï¼Œä¾‹å¦‚ä½¿ç”¨æšä¸¾ç±»å‹ã€æˆ–è€…é™æ€å¸¸é‡ï¼Œä½œä¸ºè®¢å•çš„ç±»å‹ï¼Œç›¸ä¿¡ä½ èƒ½æƒ³åˆ°æ›´å¤šæ›´å¥½çš„æ–¹æ³•ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>ç­–ç•¥æ¨¡å¼</tag>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é€šä¿—è®²è§£åˆ†å¸ƒå¼é”</title>
    <link href="/blog/2021/03/26/%E9%80%9A%E4%BF%97%E8%AE%B2%E8%A7%A3%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/"/>
    <url>/blog/2021/03/26/%E9%80%9A%E4%BF%97%E8%AE%B2%E8%A7%A3%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/</url>
    
    <content type="html"><![CDATA[<p>é¦–å…ˆï¼Œåˆ†å¸ƒå¼é”å’Œæˆ‘ä»¬å¹³å¸¸è®²åˆ°çš„é”åŸç†åŸºæœ¬ä¸€æ ·ï¼Œç›®çš„å°±æ˜¯ç¡®ä¿åœ¨å¤šä¸ªçº¿ç¨‹å¹¶å‘æ—¶ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨åŒä¸€åˆ»æ“ä½œè¿™ä¸ªä¸šåŠ¡æˆ–è€…è¯´æ–¹æ³•ã€å˜é‡ã€‚</p><p>åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ª jvm æˆ–è€…è¯´åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“å»å¤„ç†æ§åˆ¶ï¼Œåœ¨ jdk java.util å¹¶å‘åŒ…ä¸­å·²ç»ä¸ºæˆ‘ä»¬æä¾›äº†è¿™äº›æ–¹æ³•å»åŠ é”ï¼Œæ¯”å¦‚ synchronized å…³é”®å­—æˆ–è€… Lock é”ï¼Œéƒ½å¯ä»¥å¤„ç†ã€‚</p><p>ä½†æ˜¯æˆ‘ä»¬ç°åœ¨çš„åº”ç”¨ç¨‹åºå¦‚æœåªéƒ¨ç½²ä¸€å°æœåŠ¡å™¨ï¼Œé‚£å¹¶å‘é‡æ˜¯å¾ˆå·®çš„ï¼Œå¦‚æœåŒæ—¶æœ‰ä¸Šä¸‡çš„è¯·æ±‚ï¼Œå¾ˆæœ‰å¯èƒ½é€ æˆæœåŠ¡å™¨å‹åŠ›è¿‡å¤§è€Œç˜«ç—ªã€‚æƒ³æƒ³åŒåä¸€å’Œå¤§å¹´ä¸‰åæ™šä¸Šåç‚¹ï¼Œç“œåˆ†æ”¯ä»˜å®çº¢åŒ…ç­‰ä¸šåŠ¡åœºæ™¯ï¼Œè‡ªç„¶éœ€è¦ç”¨åˆ°å¤šå°æœåŠ¡å™¨å»åŒæ—¶å¤„ç†è¿™äº›ä¸šåŠ¡ï¼Œè¿™äº›æœåŠ¡å¯èƒ½ä¼šæœ‰ä¸Šç™¾å°åŒæ—¶å¤„ç†ã€‚</p><p>ä½†æ˜¯æˆ‘ä»¬æƒ³ä¸€æƒ³ï¼Œå¦‚æœæœ‰ 100 å°æœåŠ¡å™¨è¦å¤„ç†åˆ†çº¢åŒ…çš„ä¸šåŠ¡ï¼Œç°åœ¨å‡è®¾æœ‰ 1 äº¿çš„çº¢åŒ…ï¼Œ1 åƒä¸‡ä¸ªäººåˆ†ï¼Œé‡‘é¢éšæœºï¼Œé‚£ä¹ˆè¿™ä¸ªä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œæ˜¯ä¸æ˜¯å¿…é¡»ç¡®ä¿è¿™ 1 åƒä¸‡ä¸ªäººæœ€ååˆ†çš„çº¢åŒ…é‡‘é¢æ€»å’Œç­‰äº 1 äº¿ï¼Ÿ</p><p>å¦‚æœå¤„ç†ä¸å¥½æ¯äººåˆ†åˆ° 100 ä¸‡ï¼Œé‚£é©¬äº‘çˆ¸çˆ¸ä¼°è®¡å¤§å¹´åˆä¸€ï¼Œå°±å¾—å®£å¸ƒç ´äº§äº†</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/c7867412524a41bfa8f8ad3ff471f99a~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><h3 id="ä¸€ã€å¸¸è§„é”ä¼šé€ æˆä»€ä¹ˆæƒ…å†µï¼Ÿ"><a href="#ä¸€ã€å¸¸è§„é”ä¼šé€ æˆä»€ä¹ˆæƒ…å†µï¼Ÿ" class="headerlink" title="ä¸€ã€å¸¸è§„é”ä¼šé€ æˆä»€ä¹ˆæƒ…å†µï¼Ÿ"></a>ä¸€ã€å¸¸è§„é”ä¼šé€ æˆä»€ä¹ˆæƒ…å†µï¼Ÿ</h3><p>é¦–å…ˆè¯´ä¸€ä¸‹æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦æé›†ç¾¤ã€‚</p><p>ç®€å•ç†è§£å°±æ˜¯ï¼Œéœ€æ±‚é‡ï¼ˆè¯·æ±‚å¹¶å‘é‡ï¼‰å˜å¤§äº†ï¼Œä¸€ä¸ªå·¥äººå¤„ç†èƒ½åŠ›æœ‰é™ï¼Œé‚£å°±å¤šæ‹›ä¸€äº›å·¥äººæ¥ä¸€èµ·å¤„ç†ã€‚</p><p>å‡è®¾ 1 åƒä¸‡ä¸ªè¯·æ±‚å¹³å‡åˆ†é…åˆ° 100 å°æœåŠ¡å™¨ä¸Šï¼Œæ¯ä¸ªæœåŠ¡å™¨æ¥æ”¶ 10w çš„è¯·æ±‚ã€‚è¿™ 10w ä¸ªè¯·æ±‚å¹¶ä¸æ˜¯åœ¨åŒä¸€ç§’ä¸­æ¥çš„ï¼Œå¯èƒ½æ˜¯åœ¨ 1,2 ä¸ªå°æ—¶å†…ï¼Œå¯ä»¥è”æƒ³ä¸‹æˆ‘ä»¬ä¸‰åæ™šä¸Šå¼€çº¢åŒ…ï¼Œç­‰åˆ° 10ï¼š20 å¼€å§‹ï¼Œæœ‰çš„äººç«‹é©¬å¼€äº†ï¼Œæœ‰çš„äººç­‰åˆ° 12 ç‚¹æ‰æƒ³èµ·æ¥ã€‚</p><p>é‚£è¿™æ ·çš„è¯ï¼Œå¹³å‡åˆ°æ¯ä¸€ç§’ä¸Šçš„è¯·æ±‚ä¹Ÿå°±ä¸åˆ° 1 åƒä¸ªï¼Œè¿™ç§å‹åŠ›ä¸€èˆ¬çš„æœåŠ¡å™¨è¿˜æ˜¯å¯ä»¥æ‰¿å—çš„ã€‚</p><ul><li>ç¬¬ä¸€ä¸ªç”¨æˆ·æ¥åˆ†ï¼Œè¯·æ±‚åˆ°æ¥åï¼Œéœ€è¦åœ¨ 1 äº¿é‡Œé¢ç»™ä»–åˆ†ä¸€éƒ¨åˆ†é’±ï¼Œé‡‘é¢éšæœºï¼Œå‡è®¾ç¬¬ä¸€ä¸ªäººåˆ†åˆ°äº† 100ï¼Œé‚£å°±è¦åœ¨è¿™ 1 äº¿ä¸­å‡å» 100 å—ï¼Œå‰©ä¸‹ 99999900 å—~</li><li>ç¬¬äºŒä¸ªç”¨æˆ·å†æ¥åˆ†ï¼Œé‡‘é¢éšæœºï¼Œè¿™æ¬¡åˆ† 200 å—ï¼Œé‚£å°±éœ€è¦åœ¨å‰©ä¸‹çš„ 99999900 å—ä¸­å†å‡å» 200 å—ï¼Œå‰©ä¸‹ 99999700 å—ã€‚</li><li>ç­‰åˆ°ç¬¬ 10w ä¸ªç”¨æˆ·æ¥ï¼Œä¸€çœ‹è¿˜æœ‰ 1000wï¼Œé‚£è¿™ 1000w å…¨æˆä»–çš„äº†ã€‚</li></ul><p>ç­‰äºæ˜¯åœ¨æ¯ä¸ªæœåŠ¡å™¨ä¸­å»åˆ† 1 äº¿ï¼Œä¹Ÿå°±æ˜¯ 10w ä¸ªç”¨æˆ·åˆ†äº†ä¸€ä¸ªäº¿ï¼Œæœ€åæ€»è®¡æœ‰ 100 ä¸ªæœåŠ¡å™¨ï¼Œè¦åˆ† 100 äº¿ã€‚</p><p>å¦‚æœçœŸè¿™æ ·äº†ï¼Œè™½è¯´é©¬äº‘çˆ¸çˆ¸ä¸ä¼šç ´äº§ï¼ˆæ®æœ€æ–°ç»Ÿè®¡é©¬äº‘æœ‰ 2300 äº¿äººæ°‘å¸ï¼‰ï¼Œé‚£åˆ†çº¢åŒ…çš„å¼€å‘é¡¹ç›®ç»„ï¼Œä»¥åŠäº§å“ç»ç†ï¼Œå¯ä»¥ GG äº†~</p><p>ç®€åŒ–ç»“æ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/9b9bc469743c480aa3985bb95baa0ddf~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><h3 id="äºŒã€åˆ†å¸ƒå¼é”æ€ä¹ˆå»å¤„ç†ï¼Ÿ"><a href="#äºŒã€åˆ†å¸ƒå¼é”æ€ä¹ˆå»å¤„ç†ï¼Ÿ" class="headerlink" title="äºŒã€åˆ†å¸ƒå¼é”æ€ä¹ˆå»å¤„ç†ï¼Ÿ"></a>äºŒã€åˆ†å¸ƒå¼é”æ€ä¹ˆå»å¤„ç†ï¼Ÿ</h3><p>é‚£ä¹ˆä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè®© 1000 ä¸‡ç”¨æˆ·åªåˆ† 1 äº¿ï¼Œè€Œä¸æ˜¯ 100 äº¿ï¼Œè¿™ä¸ªæ—¶å€™åˆ†å¸ƒå¼é”å°±æ´¾ä¸Šç”¨å¤„äº†ã€‚</p><p>åˆ†å¸ƒå¼é”å¯ä»¥æŠŠæ•´ä¸ªé›†ç¾¤å°±å½“ä½œæ˜¯ä¸€ä¸ªåº”ç”¨ä¸€æ ·å»å¤„ç†ï¼Œé‚£ä¹ˆä¹Ÿå°±éœ€è¦è¿™ä¸ªé”ç‹¬ç«‹äºæ¯ä¸€ä¸ªæœåŠ¡ä¹‹å¤–ï¼Œè€Œä¸æ˜¯åœ¨æœåŠ¡é‡Œé¢ã€‚</p><p>å‡è®¾ç¬¬ä¸€ä¸ªæœåŠ¡å™¨æ¥æ”¶åˆ°ç”¨æˆ· 1 çš„è¯·æ±‚åï¼Œä¸èƒ½åªåœ¨è‡ªå·±çš„åº”ç”¨ä¸­å»åˆ¤æ–­è¿˜æœ‰å¤šå°‘é’±å¯ä»¥åˆ†äº†ï¼Œè€Œéœ€è¦å»å¤–éƒ¨è¯·æ±‚ä¸“é—¨è´Ÿè´£ç®¡ç†è¿™ 1 äº¿çº¢åŒ…çš„äººï¼ˆæœåŠ¡ï¼‰ï¼Œé—®ä»–ï¼šå“ï¼Œæˆ‘è¿™é‡Œè¦åˆ† 100 å—ï¼Œç»™æˆ‘ 100ã€‚</p><p>ç®¡ç†çº¢åŒ…çš„å¦¹å­ï¼ˆæœåŠ¡ï¼‰ä¸€çœ‹ï¼Œè¿˜æœ‰ 1 ä¸ªäº¿ï¼Œé‚£å¥½ï¼Œç»™ä½  100 å—ï¼Œç„¶åå‰©ä¸‹ 99999900 å—ã€‚</p><p>ç¬¬äºŒä¸ªè¯·æ±‚åˆ°æ¥åï¼Œè¢«æœåŠ¡å™¨ 2 è·å–ï¼Œç»§ç»­å»è¯¢é—®ï¼Œç®¡ç†çº¢åŒ…çš„å¦¹å­ï¼Œæˆ‘è¿™è¾¹è¦åˆ† 10 å—ï¼Œç®¡ç†çº¢åŒ…çš„å¦¹å­å…ˆæŸ¥äº†ä¸‹è¿˜æœ‰ 99999900ï¼Œé‚£å°±è¯´ï¼šå¥½ï¼Œç»™ä½  10 å—ã€‚é‚£å°±å‰©ä¸‹ 99999890 å—ã€‚</p><p>ç­‰åˆ°ç¬¬ 1000w ä¸ªè¯·æ±‚åˆ°æ¥åï¼ŒæœåŠ¡å™¨ 100 æ‹¿åˆ°è¯·æ±‚ï¼Œç»§ç»­å»è¯¢é—®ï¼Œç®¡ç†çº¢åŒ…çš„å¦¹å­ï¼Œæˆ‘è¦ 100ï¼Œå¦¹å­ç¿»äº†ç¿»ç™½çœ¼ï¼Œå¯¹ä½ è¯´ï¼Œå°±å‰© 1 å—äº†ï¼Œçˆ±è¦ä¸è¦ï¼Œé‚£è¿™ä¸ªæ—¶å€™å°±åªèƒ½ç»™ä½  1 å—äº†ï¼ˆ1 å—ä¹Ÿæ˜¯é’±å•Šï¼Œä¹°æ ¹è¾£æ¡è¿˜æ˜¯å¯ä»¥çš„ï¼‰ã€‚</p><p>è¿™äº›è¯·æ±‚ç¼–å· 1,2 ä¸ä»£è¡¨æ‰§è¡Œçš„å…ˆåé¡ºåºï¼Œæ­£å¼çš„åœºæ™¯ä¸‹ï¼Œåº”è¯¥æ˜¯ 100 å°æœåŠ¡å™¨æ¯ä¸ªæœåŠ¡å™¨æŒæœ‰ä¸€ä¸ªè¯·æ±‚å»è®¿é—®è´Ÿè´£ç®¡ç†çº¢åŒ…çš„å¦¹å­ï¼ˆæœåŠ¡ï¼‰ï¼Œé‚£åœ¨ç®¡çº¢åŒ…çš„å¦¹å­é‚£é‡ŒåŒæ—¶ä¼šæ¥æ”¶åˆ° 100 ä¸ªè¯·æ±‚ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦åœ¨è´Ÿè´£çº¢åŒ…çš„å¦¹å­é‚£é‡ŒåŠ ä¸ªé”å°±å¯ä»¥äº†ï¼ˆæŠ›ç»£çƒï¼‰ï¼Œä½ ä»¬ 100 ä¸ªæœåŠ¡å™¨è°æ‹¿åˆ°é”ï¼ˆæŠ¢åˆ°ç»£çƒï¼‰ï¼Œè°å°±è¿›æ¥å’Œæˆ‘è°ˆï¼Œæˆ‘ç»™ä½ åˆ†ï¼Œå…¶ä»–äººå°±ç­‰ç€å»å§ã€‚</p><p>ç»è¿‡ä¸Šé¢çš„åˆ†å¸ƒå¼é”çš„å¤„ç†åï¼Œé©¬äº‘çˆ¸çˆ¸ç»ˆäºæ”¾å¿ƒäº†ï¼Œå†³å®šç»™çº¢åŒ…å›¢é˜Ÿæ¯äººåŠ ä¸€ä¸ªé¸¡è…¿ã€‚</p><p>ç®€åŒ–çš„ç»“æ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/ded345e3baf24d21a402418bc78ac2c0~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><h3 id="ä¸‰ã€åˆ†å¸ƒå¼é”çš„å®ç°æœ‰å“ªäº›ï¼Ÿ"><a href="#ä¸‰ã€åˆ†å¸ƒå¼é”çš„å®ç°æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="ä¸‰ã€åˆ†å¸ƒå¼é”çš„å®ç°æœ‰å“ªäº›ï¼Ÿ"></a>ä¸‰ã€åˆ†å¸ƒå¼é”çš„å®ç°æœ‰å“ªäº›ï¼Ÿ</h3><p>è¯´åˆ°åˆ†å¸ƒå¼é”çš„å®ç°ï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šçš„ï¼Œæœ‰æ•°æ®åº“æ–¹å¼çš„ï¼Œæœ‰ Redis åˆ†å¸ƒå¼é”ï¼Œæœ‰ Zookeeper åˆ†å¸ƒå¼é”ç­‰ç­‰ã€‚</p><p>æˆ‘ä»¬å¦‚æœé‡‡ç”¨ Redis ä½œä¸ºåˆ†å¸ƒå¼é”ï¼Œé‚£ä¹ˆä¸Šå›¾ä¸­è´Ÿ â€œè´£çº¢åŒ…çš„å¦¹å­ï¼ˆæœåŠ¡ï¼‰â€ï¼Œå°±å¯ä»¥æ›¿æ¢æˆ Redisï¼Œè¯·è‡ªè¡Œè„‘è¡¥ã€‚</p><p><strong>1ã€ä¸ºä»€ä¹ˆ Redis å¯ä»¥å®ç°åˆ†å¸ƒå¼é”ï¼Ÿ</strong></p><p>é¦–å…ˆ Redis æ˜¯å•çº¿ç¨‹çš„ï¼Œè¿™é‡Œçš„å•çº¿ç¨‹æŒ‡çš„æ˜¯ç½‘ç»œè¯·æ±‚æ¨¡å—ä½¿ç”¨äº†ä¸€ä¸ªçº¿ç¨‹ï¼ˆæ‰€ä»¥ä¸éœ€è€ƒè™‘å¹¶å‘å®‰å…¨æ€§ï¼‰ï¼Œå³ä¸€ä¸ªçº¿ç¨‹å¤„ç†æ‰€æœ‰ç½‘ç»œè¯·æ±‚ï¼Œå…¶ä»–æ¨¡å—ä»ç”¨äº†å¤šä¸ªçº¿ç¨‹ã€‚</p><p>åœ¨å®é™…çš„æ“ä½œä¸­è¿‡ç¨‹å¤§è‡´æ˜¯è¿™æ ·å­çš„ï¼š</p><p>æœåŠ¡å™¨ 1 è¦å»è®¿é—®å‘çº¢åŒ…çš„å¦¹å­ï¼Œä¹Ÿå°±æ˜¯ Redisï¼Œé‚£ä¹ˆä»–ä¼šåœ¨ Redis ä¸­é€šè¿‡ â€œsetnx key valueâ€ æ“ä½œè®¾ç½®ä¸€ä¸ª key è¿›å»ï¼Œvalue æ˜¯å•¥ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯è¦æœ‰ä¸€ä¸ª keyï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªæ ‡è®°ï¼Œè€Œä¸”è¿™ä¸ª key ä½ çˆ±å«å•¥å«å•¥ï¼Œåªè¦æ‰€æœ‰çš„æœåŠ¡å™¨è®¾ç½®çš„ key ç›¸åŒå°±å¯ä»¥ã€‚</p><p>å‡è®¾æˆ‘ä»¬è®¾ç½®ä¸€ä¸ªï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/ba01791955c4422d8d83124405591598~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¼šè¿”å›ä¸€ä¸ª 1ï¼Œé‚£å°±ä»£è¡¨äº†æˆåŠŸã€‚</p><p>å¦‚æœå†æ¥ä¸€ä¸ªè¯·æ±‚å»è®¾ç½®åŒæ ·çš„ keyï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/32b815d1f0f94cd9a563bd678a3dabc5~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>è¿™ä¸ªæ—¶å€™ä¼šè¿”å› 0ï¼Œé‚£å°±ä»£è¡¨å¤±è´¥äº†ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¿™ä¸ªæ“ä½œå»åˆ¤æ–­æ˜¯ä¸æ˜¯å½“å‰å¯ä»¥æ‹¿åˆ°é”ï¼Œæˆ–è€…è¯´å¯ä»¥å»è®¿é—® â€œè´Ÿè´£å‘çº¢åŒ…çš„å¦¹å­â€ï¼Œå¦‚æœè¿”å› 1ï¼Œé‚£æˆ‘å°±å¼€å§‹å»æ‰§è¡Œåé¢çš„é€»è¾‘ï¼Œå¦‚æœè¿”å› 0ï¼Œé‚£å°±è¯´æ˜å·²ç»è¢«äººå ç”¨äº†ï¼Œæˆ‘å°±è¦ç»§ç»­ç­‰å¾…ã€‚</p><p>å½“æœåŠ¡å™¨ 1 æ‹¿åˆ°é”ä¹‹åï¼Œè¿›è¡Œäº†ä¸šåŠ¡å¤„ç†ï¼Œå®Œæˆåï¼Œè¿˜éœ€è¦é‡Šæ”¾é”ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p>åˆ é™¤æˆåŠŸè¿”å› 1ï¼Œé‚£ä¹ˆå…¶ä»–çš„æœåŠ¡å™¨å°±å¯ä»¥ç»§ç»­é‡å¤ä¸Šé¢çš„æ­¥éª¤å»è®¾ç½®è¿™ä¸ª keyï¼Œä»¥è¾¾åˆ°è·å–é”çš„ç›®çš„ã€‚</p><p>å½“ç„¶ä»¥ä¸Šçš„æ“ä½œæ˜¯åœ¨ Redis å®¢æˆ·ç«¯ç›´æ¥è¿›è¡Œçš„ï¼Œé€šè¿‡ç¨‹åºè°ƒç”¨çš„è¯ï¼Œè‚¯å®šå°±ä¸èƒ½è¿™ä¹ˆå†™ï¼Œæ¯”å¦‚ java å°±éœ€è¦é€šè¿‡ jedis å»è°ƒç”¨ï¼Œä½†æ˜¯æ•´ä¸ªå¤„ç†é€»è¾‘åŸºæœ¬éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p><p>é€šè¿‡ä¸Šé¢çš„æ–¹å¼ï¼Œæˆ‘ä»¬å¥½åƒæ˜¯è§£å†³äº†åˆ†å¸ƒå¼é”çš„é—®é¢˜ï¼Œä½†æ˜¯æƒ³æƒ³è¿˜æœ‰æ²¡æœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ</p><p>å¯¹ï¼Œé—®é¢˜è¿˜æ˜¯æœ‰çš„ï¼Œå¯èƒ½ä¼šæœ‰æ­»é”çš„é—®é¢˜å‘ç”Ÿï¼Œæ¯”å¦‚æœåŠ¡å™¨ 1 è®¾ç½®å®Œä¹‹åï¼Œè·å–äº†é”ä¹‹åï¼Œå¿½ç„¶å‘ç”Ÿäº†å®•æœºã€‚</p><p>é‚£åç»­çš„åˆ é™¤ key æ“ä½œå°±æ²¡æ³•æ‰§è¡Œï¼Œè¿™ä¸ª key ä¼šä¸€ç›´åœ¨ Redis ä¸­å­˜åœ¨ï¼Œå…¶ä»–æœåŠ¡å™¨æ¯æ¬¡å»æ£€æŸ¥ï¼Œéƒ½ä¼šè¿”å› 0ï¼Œä»–ä»¬éƒ½ä¼šè®¤ä¸ºæœ‰äººåœ¨ä½¿ç”¨é”ï¼Œæˆ‘éœ€è¦ç­‰ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªæ­»é”çš„é—®é¢˜ï¼Œæˆ‘ä»¬å°±éœ€è¦ç»™ key è®¾ç½®æœ‰æ•ˆæœŸäº†ã€‚</p><p>è®¾ç½®çš„æ–¹å¼æœ‰ 2 ç§ï¼š</p><ul><li>ç¬¬ä¸€ç§å°±æ˜¯åœ¨ set å®Œ key ä¹‹åï¼Œç›´æ¥è®¾ç½® key çš„æœ‰æ•ˆæœŸ â€œexpire key timeoutâ€ ï¼Œä¸º key è®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸º secondï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´é”ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œé¿å…æ­»é”ã€‚</li></ul><p>è¿™ç§æ–¹å¼ç›¸å½“äºï¼ŒæŠŠé”æŒæœ‰çš„æœ‰æ•ˆæœŸï¼Œäº¤ç»™äº† Redis å»æ§åˆ¶ã€‚å¦‚æœæ—¶é—´åˆ°äº†ï¼Œä½ è¿˜æ²¡æœ‰ç»™æˆ‘åˆ é™¤ keyï¼Œé‚£ Redis å°±ç›´æ¥ç»™ä½ åˆ äº†ï¼Œå…¶ä»–æœåŠ¡å™¨å°±å¯ä»¥ç»§ç»­å» setnx è·å–é”ã€‚</p><ul><li>ç¬¬äºŒç§æ–¹å¼ï¼Œå°±æ˜¯æŠŠåˆ é™¤ key æƒåˆ©äº¤ç»™å…¶ä»–çš„æœåŠ¡å™¨ï¼Œé‚£è¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”¨åˆ° value å€¼äº†ï¼Œæ¯”å¦‚æœåŠ¡å™¨ 1ï¼Œè®¾ç½®äº† value ä¹Ÿå°±æ˜¯ timeout ä¸ºå½“å‰æ—¶é—´ + 1 ç§’ ï¼Œè¿™ä¸ªæ—¶å€™æœåŠ¡å™¨ 2 é€šè¿‡ get å‘ç°æ—¶é—´å·²ç»è¶…è¿‡ç³»ç»Ÿå½“å‰æ—¶é—´äº†ï¼Œé‚£å°±è¯´æ˜æœåŠ¡å™¨ 1 æ²¡æœ‰é‡Šæ”¾é”ï¼ŒæœåŠ¡å™¨ 1 å¯èƒ½å‡ºé—®é¢˜äº†ï¼ŒæœåŠ¡å™¨ 2 å°±å¼€å§‹æ‰§è¡Œåˆ é™¤ key æ“ä½œï¼Œå¹¶ä¸”ç»§ç»­æ‰§è¡Œ setnx æ“ä½œã€‚</li></ul><p>ä½†æ˜¯è¿™å—æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œä¹Ÿå°±æ˜¯ä¸å…‰ä½ æœåŠ¡å™¨ 2 å¯èƒ½ä¼šå‘ç°æœåŠ¡å™¨ 1 è¶…æ—¶äº†ï¼ŒæœåŠ¡å™¨ 3 ä¹Ÿå¯èƒ½ä¼šå‘ç°ï¼Œå¦‚æœåˆšå¥½æœåŠ¡å™¨ 2 setnx æ“ä½œå®Œæˆï¼ŒæœåŠ¡å™¨ 3 å°±æ¥ç€åˆ é™¤ï¼Œæ˜¯ä¸æ˜¯æœåŠ¡å™¨ 3 ä¹Ÿå¯ä»¥ setnx æˆåŠŸäº†ï¼Ÿ</p><p>é‚£å°±ç­‰äºæ˜¯æœåŠ¡å™¨ 2 å’ŒæœåŠ¡å™¨ 3 éƒ½æ‹¿åˆ°é”äº†ï¼Œé‚£å°±é—®é¢˜å¤§äº†ã€‚è¿™ä¸ªæ—¶å€™æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>è¿™ä¸ªæ—¶å€™éœ€è¦ç”¨åˆ° â€œGETSET  key valueâ€ å‘½ä»¤äº†ã€‚è¿™ä¸ªå‘½ä»¤çš„æ„æ€å°±æ˜¯è·å–å½“å‰ key çš„å€¼ï¼Œå¹¶ä¸”è®¾ç½®æ–°çš„å€¼ã€‚</p><p>å‡è®¾æœåŠ¡å™¨ 2 å‘ç° key è¿‡æœŸäº†ï¼Œå¼€å§‹è°ƒç”¨ getset å‘½ä»¤ï¼Œç„¶åç”¨è·å–çš„æ—¶é—´åˆ¤æ–­æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè·å–çš„æ—¶é—´ä»ç„¶æ˜¯è¿‡æœŸçš„ï¼Œé‚£å°±è¯´æ˜æ‹¿åˆ°é”äº†ã€‚</p><p>å¦‚æœæ²¡æœ‰ï¼Œåˆ™è¯´æ˜åœ¨æœåŠ¡ 2 æ‰§è¡Œ getset ä¹‹å‰ï¼ŒæœåŠ¡å™¨ 3 å¯èƒ½ä¹Ÿå‘ç°é”è¿‡æœŸäº†ï¼Œå¹¶ä¸”åœ¨æœåŠ¡å™¨ 2 ä¹‹å‰æ‰§è¡Œäº† getset æ“ä½œï¼Œé‡æ–°è®¾ç½®äº†è¿‡æœŸæ—¶é—´ã€‚</p><p>é‚£ä¹ˆæœåŠ¡å™¨ 2 å°±éœ€è¦æ”¾å¼ƒåç»­çš„æ“ä½œï¼Œç»§ç»­ç­‰å¾…æœåŠ¡å™¨ 3 é‡Šæ”¾é”æˆ–è€…å»ç›‘æµ‹ key çš„æœ‰æ•ˆæœŸæ˜¯å¦è¿‡æœŸã€‚</p><p>è¿™å—å…¶å®æœ‰ä¸€ä¸ªå°é—®é¢˜æ˜¯ï¼ŒæœåŠ¡å™¨ 3 å·²ç»ä¿®æ”¹äº†æœ‰æ•ˆæœŸï¼Œæ‹¿åˆ°é”ä¹‹åï¼ŒæœåŠ¡å™¨ 2 ä¹Ÿä¿®æ”¹äº†æœ‰æ•ˆæœŸï¼Œä½†æ˜¯æ²¡èƒ½æ‹¿åˆ°é”ï¼Œä½†æ˜¯è¿™ä¸ªæœ‰æ•ˆæœŸçš„æ—¶é—´å·²ç»è¢«åœ¨æœåŠ¡å™¨ 3 çš„åŸºç¡€ä¸Šæœ‰å¢åŠ ä¸€äº›ï¼Œä½†æ˜¯è¿™ç§å½±å“å…¶å®è¿˜æ˜¯å¾ˆå°çš„ï¼Œå‡ ä¹å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚</p><p><strong>2ã€ä¸ºä»€ä¹ˆ Zookeeper å¯å®ç°åˆ†å¸ƒå¼é”ï¼Ÿ</strong></p><p>ç™¾åº¦ç™¾ç§‘æ˜¯è¿™ä¹ˆä»‹ç»çš„ï¼šZooKeeper æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ï¼Œå¼€æ”¾æºç çš„åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºåè°ƒæœåŠ¡ï¼Œæ˜¯ Google çš„ Chubby ä¸€ä¸ªå¼€æºçš„å®ç°ï¼Œæ˜¯ Hadoop å’Œ Hbase çš„é‡è¦ç»„ä»¶ã€‚</p><p>é‚£å¯¹äºæˆ‘ä»¬åˆæ¬¡è®¤è¯†çš„äººï¼Œå¯ä»¥ç†è§£æˆ ZooKeeper å°±åƒæ˜¯æˆ‘ä»¬çš„ç”µè„‘æ–‡ä»¶ç³»ç»Ÿï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ d ç›˜ä¸­åˆ›å»ºæ–‡ä»¶å¤¹ aï¼Œå¹¶ä¸”å¯ä»¥ç»§ç»­åœ¨æ–‡ä»¶å¤¹ a ä¸­åˆ›å»ºæ–‡ä»¶å¤¹ a1ï¼Œa2ã€‚</p><p>é‚£æˆ‘ä»¬çš„æ–‡ä»¶ç³»ç»Ÿæœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿé‚£å°±æ˜¯åŒä¸€ä¸ªç›®å½•ä¸‹æ–‡ä»¶åç§°ä¸èƒ½é‡å¤ï¼ŒåŒæ · ZooKeeper ä¹Ÿæ˜¯è¿™æ ·çš„ã€‚</p><p>åœ¨ ZooKeeper æ‰€æœ‰çš„èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯æ–‡ä»¶å¤¹ç§°ä½œ Znodeï¼Œè€Œä¸”è¿™ä¸ª Znode èŠ‚ç‚¹æ˜¯å¯ä»¥å­˜å‚¨æ•°æ®çš„ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ â€œcreate /zkjjj niceâ€ æ¥åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¿™ä¸ªå‘½ä»¤å°±è¡¨ç¤ºï¼Œåœ¨è·Ÿç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª zkjjj çš„èŠ‚ç‚¹ï¼Œå€¼æ˜¯ niceã€‚åŒæ ·è¿™é‡Œçš„å€¼ï¼Œå’Œæˆ‘åœ¨å‰é¢è¯´çš„ Redis ä¸­çš„ä¸€æ ·ï¼Œæ²¡ä»€ä¹ˆæ„ä¹‰ï¼Œä½ éšä¾¿ç»™ã€‚</p><p>å¦å¤– ZooKeeper å¯ä»¥åˆ›å»º 4 ç§ç±»å‹çš„èŠ‚ç‚¹ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ul><li>æŒä¹…æ€§èŠ‚ç‚¹</li><li>æŒä¹…æ€§é¡ºåºèŠ‚ç‚¹</li><li>ä¸´æ—¶æ€§èŠ‚ç‚¹</li><li>ä¸´æ—¶æ€§é¡ºåºèŠ‚ç‚¹</li></ul><p>é¦–å…ˆè¯´ä¸‹æŒä¹…æ€§èŠ‚ç‚¹å’Œä¸´æ—¶æ€§èŠ‚ç‚¹çš„åŒºåˆ«ï¼š</p><ul><li>æŒä¹…æ€§èŠ‚ç‚¹è¡¨ç¤ºåªè¦ä½ åˆ›å»ºäº†è¿™ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¸ç®¡ä½  ZooKeeper çš„å®¢æˆ·ç«¯æ˜¯å¦æ–­å¼€è¿æ¥ï¼ŒZooKeeper çš„æœåŠ¡ç«¯éƒ½ä¼šè®°å½•è¿™ä¸ªèŠ‚ç‚¹ï¼›</li><li>ä¸´æ—¶æ€§èŠ‚ç‚¹åˆšå¥½ç›¸åï¼Œä¸€æ—¦ä½  ZooKeeper å®¢æˆ·ç«¯æ–­å¼€äº†è¿æ¥ï¼Œé‚£ ZooKeeper æœåŠ¡ç«¯å°±ä¸å†ä¿å­˜è¿™ä¸ªèŠ‚ç‚¹ï¼›</li><li>é¡ºä¾¿ä¹Ÿè¯´ä¸‹é¡ºåºæ€§èŠ‚ç‚¹ï¼Œé¡ºåºæ€§èŠ‚ç‚¹æ˜¯æŒ‡ï¼Œåœ¨åˆ›å»ºèŠ‚ç‚¹çš„æ—¶å€™ï¼ŒZooKeeper ä¼šè‡ªåŠ¨ç»™èŠ‚ç‚¹ç¼–å·æ¯”å¦‚ 0000001ï¼Œ0000002 è¿™ç§çš„ã€‚</li></ul><p>Zookeeper æœ‰ä¸€ä¸ªç›‘å¬æœºåˆ¶ï¼Œå®¢æˆ·ç«¯æ³¨å†Œç›‘å¬å®ƒå…³å¿ƒçš„ç›®å½•èŠ‚ç‚¹ï¼Œå½“ç›®å½•èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–ï¼ˆæ•°æ®æ”¹å˜ã€è¢«åˆ é™¤ã€å­ç›®å½•èŠ‚ç‚¹å¢åŠ åˆ é™¤ï¼‰ç­‰ï¼ŒZookeeper ä¼šé€šçŸ¥å®¢æˆ·ç«¯ã€‚</p><h3 id="å››ã€åœ¨-Zookeeper-ä¸­å¦‚ä½•åŠ é”ï¼Ÿ"><a href="#å››ã€åœ¨-Zookeeper-ä¸­å¦‚ä½•åŠ é”ï¼Ÿ" class="headerlink" title="å››ã€åœ¨ Zookeeper ä¸­å¦‚ä½•åŠ é”ï¼Ÿ"></a>å››ã€åœ¨ Zookeeper ä¸­å¦‚ä½•åŠ é”ï¼Ÿ</h3><p>ä¸‹é¢æˆ‘ä»¬ç»§ç»­ç»“åˆæˆ‘ä»¬ä¸Šé¢çš„åˆ†çº¢åŒ…åœºæ™¯ï¼Œæè¿°ä¸‹åœ¨ Zookeeper ä¸­å¦‚ä½•åŠ é”ã€‚</p><p>å‡è®¾æœåŠ¡å™¨ 1ï¼Œåˆ›å»ºäº†ä¸€ä¸ªèŠ‚ç‚¹ /zkjjjï¼ŒæˆåŠŸäº†ï¼Œé‚£æœåŠ¡å™¨ 1 å°±è·å–äº†é”ï¼ŒæœåŠ¡å™¨ 2 å†å»åˆ›å»ºç›¸åŒçš„é”ï¼Œå°±ä¼šå¤±è´¥ï¼Œè¿™ä¸ªæ—¶å€™å°±åªèƒ½ç›‘å¬è¿™ä¸ªèŠ‚ç‚¹çš„å˜åŒ–ã€‚</p><p>ç­‰åˆ°æœåŠ¡å™¨ 1 å¤„ç†å®Œä¸šåŠ¡ï¼Œåˆ é™¤äº†èŠ‚ç‚¹åï¼Œä»–å°±ä¼šå¾—åˆ°é€šçŸ¥ï¼Œç„¶åå»åˆ›å»ºåŒæ ·çš„èŠ‚ç‚¹ï¼Œè·å–é”å¤„ç†ä¸šåŠ¡ï¼Œå†åˆ é™¤èŠ‚ç‚¹ï¼Œåç»­çš„ 100 å°æœåŠ¡å™¨ä¸ä¹‹ç±»ä¼¼ã€‚</p><p>æ³¨æ„è¿™é‡Œçš„ 100 å°æœåŠ¡å™¨å¹¶ä¸æ˜¯æŒ¨ä¸ªå»æ‰§è¡Œä¸Šé¢çš„åˆ›å»ºèŠ‚ç‚¹çš„æ“ä½œï¼Œè€Œæ˜¯å¹¶å‘çš„ï¼Œå½“æœåŠ¡å™¨ 1 åˆ›å»ºæˆåŠŸï¼Œé‚£ä¹ˆå‰©ä¸‹çš„ 99 ä¸ªå°±éƒ½ä¼šæ³¨å†Œç›‘å¬è¿™ä¸ªèŠ‚ç‚¹ï¼Œç­‰é€šçŸ¥ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p><p>ä½†æ˜¯å¤§å®¶æœ‰æ²¡æœ‰æ³¨æ„åˆ°ï¼Œè¿™é‡Œè¿˜æ˜¯æœ‰é—®é¢˜çš„ï¼Œè¿˜æ˜¯ä¼šæœ‰æ­»é”çš„æƒ…å†µå­˜åœ¨ï¼Œå¯¹ä¸å¯¹ï¼Ÿ</p><p>å½“æœåŠ¡å™¨ 1 åˆ›å»ºäº†èŠ‚ç‚¹åæŒ‚äº†ï¼Œæ²¡èƒ½åˆ é™¤ï¼Œé‚£å…¶ä»– 99 å°æœåŠ¡å™¨å°±ä¼šä¸€ç›´ç­‰é€šçŸ¥ï¼Œé‚£å°±å®Œè›‹äº†ã€‚ã€‚ã€‚</p><p>è¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”¨åˆ°ä¸´æ—¶æ€§èŠ‚ç‚¹äº†ï¼Œæˆ‘ä»¬å‰é¢è¯´è¿‡äº†ï¼Œä¸´æ—¶æ€§èŠ‚ç‚¹çš„ç‰¹ç‚¹æ˜¯å®¢æˆ·ç«¯ä¸€æ—¦æ–­å¼€ï¼Œå°±ä¼šä¸¢å¤±ï¼Œä¹Ÿå°±æ˜¯å½“æœåŠ¡å™¨ 1 åˆ›å»ºäº†èŠ‚ç‚¹åï¼Œå¦‚æœæŒ‚äº†ï¼Œé‚£è¿™ä¸ªèŠ‚ç‚¹ä¼šè‡ªåŠ¨è¢«åˆ é™¤ï¼Œè¿™æ ·åç»­çš„å…¶ä»–æœåŠ¡å™¨ï¼Œå°±å¯ä»¥ç»§ç»­å»åˆ›å»ºèŠ‚ç‚¹ï¼Œè·å–é”äº†ã€‚</p><p>ä½†æ˜¯æˆ‘ä»¬å¯èƒ½è¿˜éœ€è¦æ³¨æ„åˆ°ä¸€ç‚¹ï¼Œå°±æ˜¯æƒŠç¾¤æ•ˆåº”ï¼šä¸¾ä¸€ä¸ªå¾ˆç®€å•çš„ä¾‹å­ï¼Œå½“ä½ å¾€ä¸€ç¾¤é¸½å­ä¸­é—´æ‰”ä¸€å—é£Ÿç‰©ï¼Œè™½ç„¶æœ€ç»ˆåªæœ‰ä¸€ä¸ªé¸½å­æŠ¢åˆ°é£Ÿç‰©ï¼Œä½†æ‰€æœ‰é¸½å­éƒ½ä¼šè¢«æƒŠåŠ¨æ¥äº‰å¤ºï¼Œæ²¡æœ‰æŠ¢åˆ°â€¦</p><p>å°±æ˜¯å½“æœåŠ¡å™¨ 1 èŠ‚ç‚¹æœ‰å˜åŒ–ï¼Œä¼šé€šçŸ¥å…¶ä½™çš„ 99 ä¸ªæœåŠ¡å™¨ï¼Œä½†æ˜¯æœ€ç»ˆåªæœ‰ 1 ä¸ªæœåŠ¡å™¨ä¼šåˆ›å»ºæˆåŠŸï¼Œè¿™æ · 98 è¿˜æ˜¯éœ€è¦ç­‰å¾…ç›‘å¬ï¼Œé‚£ä¹ˆä¸ºäº†å¤„ç†è¿™ç§æƒ…å†µï¼Œå°±éœ€è¦ç”¨åˆ°ä¸´æ—¶é¡ºåºæ€§èŠ‚ç‚¹ã€‚å¤§è‡´æ„æ€å°±æ˜¯ï¼Œä¹‹å‰æ˜¯æ‰€æœ‰ 99 ä¸ªæœåŠ¡å™¨éƒ½ç›‘å¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç°åœ¨å°±æ˜¯æ¯ä¸€ä¸ªæœåŠ¡å™¨ç›‘å¬è‡ªå·±å‰é¢çš„ä¸€ä¸ªèŠ‚ç‚¹ã€‚</p><p>å‡è®¾ 100 ä¸ªæœåŠ¡å™¨åŒæ—¶å‘æ¥è¯·æ±‚ï¼Œè¿™ä¸ªæ—¶å€™ä¼šåœ¨ / zkjjj èŠ‚ç‚¹ä¸‹åˆ›å»º 100 ä¸ªä¸´æ—¶é¡ºåºæ€§èŠ‚ç‚¹<code>/zkjjj/000000001</code>ï¼Œ<code>/zkjjj/000000002</code>ï¼Œä¸€ç›´åˆ°<code>/zkjjj/000000100</code>ï¼Œè¿™ä¸ªç¼–å·å°±ç­‰äºæ˜¯å·²ç»ç»™ä»–ä»¬è®¾ç½®äº†è·å–é”çš„å…ˆåé¡ºåºäº†ã€‚</p><p>å½“ 001 èŠ‚ç‚¹å¤„ç†å®Œæ¯•ï¼Œåˆ é™¤èŠ‚ç‚¹åï¼Œ002 æ”¶åˆ°é€šçŸ¥ï¼Œå»è·å–é”ï¼Œå¼€å§‹æ‰§è¡Œï¼Œæ‰§è¡Œå®Œæ¯•ï¼Œåˆ é™¤èŠ‚ç‚¹ï¼Œé€šçŸ¥ 003~ ä»¥æ­¤ç±»æ¨</p>]]></content>
    
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>åˆ†å¸ƒå¼é”</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ¥å£è°ƒç”¨å¤±è´¥çš„é€€é¿ç­–ç•¥</title>
    <link href="/blog/2021/03/25/%E6%8E%A5%E5%8F%A3%E8%B0%83%E7%94%A8%E5%A4%B1%E8%B4%A5%E7%9A%84%E9%80%80%E9%81%BF%E7%AD%96%E7%95%A5/"/>
    <url>/blog/2021/03/25/%E6%8E%A5%E5%8F%A3%E8%B0%83%E7%94%A8%E5%A4%B1%E8%B4%A5%E7%9A%84%E9%80%80%E9%81%BF%E7%AD%96%E7%95%A5/</url>
    
    <content type="html"><![CDATA[<h2 id="é€€é¿ç­–ç•¥ç®€ä»‹"><a href="#é€€é¿ç­–ç•¥ç®€ä»‹" class="headerlink" title="é€€é¿ç­–ç•¥ç®€ä»‹"></a>é€€é¿ç­–ç•¥ç®€ä»‹</h2><p>åœ¨å¼€å‘è¿‡ç¨‹ä¸­æˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°è°ƒç”¨æ¥å£å¤±è´¥çš„æƒ…å†µã€‚é‡åˆ°è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬æœ‰æ—¶å€™éœ€è¦é‡è¯•æœºåˆ¶ï¼Œå¸¸ç”¨çš„é‡è¯•ï¼ˆé€€é¿ï¼‰ç­–ç•¥æœ‰ï¼š</p><ol><li>å›ºå®šçš„æ—¶é—´é—´éš”é‡è¯•ä¸€æ¬¡ï¼Œæœ€å¤šé‡è¯•Næ¬¡ï¼šæ¯”å¦‚æˆ‘ç°åœ¨ä¸€ä¸ªæ¥å£è°ƒç”¨å¤±è´¥äº†ï¼Œä¸æ˜¯ç«‹é©¬è¿”å›å¤±è´¥ï¼Œè€Œæ˜¯holdä½çº¿ç¨‹ï¼Œæ¯éš”2ç§’é‡æ–°è°ƒä¸‹æ¥å£ï¼Œæœ€å¤šè°ƒ5æ¬¡ï¼Œåªè¦å…¶ä¸­ä¸€æ¬¡æˆåŠŸäº†å°±ç›´æ¥è¿”å›ã€‚å¦‚æœ5æ¬¡éƒ½æ²¡æˆåŠŸï¼Œæ¥å£è¿”å›å¤±è´¥ã€‚</li><li>æŒ‡æ•°æ—¶é—´é—´éš”å°è¯•ç­–ç•¥ï¼šå’Œä¸Šé¢ç­–ç•¥ä¸€æ ·ï¼Œæ¥å£è°ƒç”¨å¤±è´¥åä¹Ÿä¸æ˜¯ç›´æ¥è¿”å›ï¼Œä½†æ˜¯é‡è¯•çš„æ—¶é—´é—´éš”å‘ˆæŒ‡æ•°å¢åŠ ã€‚æ¯”å¦‚ç¬¬ä¸€æ¬¡æ—¶é—´é—´éš”æ˜¯2sï¼Œç¬¬äºŒæ¬¡æ¬¡4sï¼Œä¾æ¬¡å¢åŠ ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥è®¾ç½®æœ€å¤§çš„å°è¯•æ¬¡æ•°å’Œæœ€å¤§çš„å°è¯•æ—¶é—´ã€‚</li></ol><h3 id="Springä¸­çš„é€€é¿ç­–ç•¥å·¥å…·ç±»"><a href="#Springä¸­çš„é€€é¿ç­–ç•¥å·¥å…·ç±»" class="headerlink" title="Springä¸­çš„é€€é¿ç­–ç•¥å·¥å…·ç±»"></a>Springä¸­çš„é€€é¿ç­–ç•¥å·¥å…·ç±»</h3><h4 id="FixedBackOff"><a href="#FixedBackOff" class="headerlink" title="FixedBackOff"></a>FixedBackOff</h4><p>FixedBackOffæ˜¯Springè‡ªå¸¦çš„æ”¯æŒå›ºå®šæ—¶é—´é€€é¿ç­–ç•¥çš„å·¥å…·ç±»ã€‚è¿™ä¸ªç±»ä½¿ç”¨èµ·æ¥éå¸¸ç®€å•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">long</span> interval = <span class="hljs-number">1000</span>;   <span class="hljs-comment">//é‡è¯•é—´éš”    1sé‡è¯•ä¸€æ¬¡</span><br><span class="hljs-keyword">long</span> maxAttempts = <span class="hljs-number">10</span>;  <span class="hljs-comment">//æœ€å¤§é‡è¯•æ¬¡æ•° æœ€å¤šé‡è¯•10æ¬¡</span><br>BackOff backOff = <span class="hljs-keyword">new</span> FixedBackOff(interval, maxAttempts);<br>BackOffExecution execution = backOff.start();<br> <br><span class="hljs-keyword">while</span>(<span class="hljs-keyword">true</span>)&#123;<br>    <span class="hljs-keyword">long</span> value = execution.nextBackOff();<br>    <span class="hljs-keyword">if</span>(value == BackOffExecution.STOP)&#123;<br>        <span class="hljs-keyword">break</span>;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-comment">//åœ¨è¿™é‡Œå†™ä½ çš„é‡è¯•é€»è¾‘</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ExponentialBackOff"><a href="#ExponentialBackOff" class="headerlink" title="ExponentialBackOff"></a>ExponentialBackOff</h4><p>ExponentialBackOffæ˜¯æ”¯æŒå°è¯•é—´éš”å‘ˆæŒ‡æ•°å¢åŠ çš„å·¥å…·ç±»ï¼Œä½¿ç”¨æ–¹å¼å’Œä¸Šé¢ç±»ä¼¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">long</span> initialInterval = <span class="hljs-number">100</span>;           <span class="hljs-comment">//åˆå§‹é—´éš”</span><br><span class="hljs-keyword">double</span> multiplier = <span class="hljs-number">2.0</span>;              <span class="hljs-comment">//é€’å¢å€æ•°</span><br><span class="hljs-keyword">long</span> maxInterval = <span class="hljs-number">5</span> * <span class="hljs-number">1000L</span>;         <span class="hljs-comment">//æœ€å¤§é—´éš”</span><br><span class="hljs-keyword">long</span> maxElapsedTime = <span class="hljs-number">50</span> * <span class="hljs-number">1000L</span>;     <span class="hljs-comment">//ç´¯è®¡æœ€å¤§çš„æ—¶é—´é—´éš”</span><br> <br>ExponentialBackOff backOff = <span class="hljs-keyword">new</span> ExponentialBackOff(initialInterval, multiplier);<br>backOff.setMaxInterval(maxInterval);<br>backOff.setMaxElapsedTime(maxElapsedTime);<br> <br>BackOffExecution execution = backOff.start();<br> <br><span class="hljs-keyword">while</span>(<span class="hljs-keyword">true</span>)&#123;<br>    <span class="hljs-keyword">long</span> value = execution.nextBackOff();<br>    <span class="hljs-keyword">if</span>(value == BackOffExecution.STOP)&#123;<br>        <span class="hljs-keyword">break</span>;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-comment">//åœ¨è¿™é‡Œå†™ä½ çš„é‡è¯•é€»è¾‘</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="è‡ªå®šä¹‰é€€é¿ç­–ç•¥"><a href="#è‡ªå®šä¹‰é€€é¿ç­–ç•¥" class="headerlink" title="è‡ªå®šä¹‰é€€é¿ç­–ç•¥"></a>è‡ªå®šä¹‰é€€é¿ç­–ç•¥</h4><p>å¦‚æœä½ æƒ³è¦å®ç°è‡ªå·±çš„é€€é¿ç­–ç•¥ï¼Œä¹Ÿéå¸¸ç®€å•ã€‚å‚è€ƒä¸Šé¢ä¸¤ä¸ªç±»ä¸­å¯¹äºBackOffExecutionæ¥å£çš„å®ç°ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>æ¥å£è°ƒç”¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pythonåˆ©ç”¨randomç”Ÿæˆä¸€ä¸ªåˆ—è¡¨å†…çš„éšæœºæ•°</title>
    <link href="/blog/2021/03/25/Python%E5%88%A9%E7%94%A8random%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AA%E5%88%97%E8%A1%A8%E5%86%85%E7%9A%84%E9%9A%8F%E6%9C%BA%E6%95%B0/"/>
    <url>/blog/2021/03/25/Python%E5%88%A9%E7%94%A8random%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AA%E5%88%97%E8%A1%A8%E5%86%85%E7%9A%84%E9%9A%8F%E6%9C%BA%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<p>é¦–å…ˆ,éœ€è¦å¯¼å…¥randomæ¨¡å—:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> random<br></code></pre></td></tr></table></figure><p>éšæœºå–1-33ä¹‹é—´çš„1ä¸ªéšæœºæ•°ï¼Œå¯èƒ½é‡å¤:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">random.choice(<span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">34</span>))<br></code></pre></td></tr></table></figure><p>printå¾—åˆ°ä¸€ç³»åˆ—éšæœºæ•°,æ‰§è¡Œä¸€æ¬¡å¾—åˆ°ä¸€ä¸ªéšæœºæ•°:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">print(random.choice(<span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">34</span>)))<br></code></pre></td></tr></table></figure><p>éšæœºå–1-33ä¹‹é—´çš„6ä¸ªéšæœºæ•°ï¼Œå¯èƒ½é‡å¤:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">random.choices(<span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">34</span>),k=<span class="hljs-number">6</span>,weights=<span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">34</span>))<br></code></pre></td></tr></table></figure><p>å…¶æƒé‡å€¼è¡¨ç¤ºè¯¥æ•°æˆ–è¯¥èŒƒå›´å†…çš„æ•°è¾“å‡ºæ¦‚ç‡å¤§,è¾“å‡ºç»“æœä¸ºåˆ—è¡¨ éšæœºå–1-33ä¹‹é—´çš„6ä¸ªéšæœºæ•°ï¼Œä¸é‡å¤:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">random.sample(<span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">34</span>),<span class="hljs-number">6</span>)<br></code></pre></td></tr></table></figure><p>å¾—åˆ°ä¸€ä¸ªæ— åºåˆ—è¡¨</p><p>random.uniform(a,b) ç”Ÿæˆä¸€ä¸ªæŒ‡å®šèŒƒå›´å†…çš„éšæœºç¬¦ç‚¹æ•°ï¼Œä¸¤ä¸ªå‚æ•°å…¶ä¸­ä¸€ä¸ªæ˜¯ä¸Šé™ï¼Œä¸€ä¸ªæ˜¯ä¸‹é™</p><p>random.randint(a,b) ç”Ÿæˆä¸€ä¸ªæŒ‡å®šèŒƒå›´å†…çš„æ•´æ•°ã€‚å…¶ä¸­å‚æ•°aæ˜¯ä¸‹é™ï¼Œå‚æ•°bæ˜¯ä¸Šé™ PS:python éšæœºé€‰å–åˆ—è¡¨ä¸­çš„å…ƒç´ </p><p>ä½¿ç”¨randomæ¨¡å—ä¸­çš„sampleå‡½æ•° åŠŸèƒ½ï¼š</p><p>random.sample(seq, k)å®ç°ä»åºåˆ—æˆ–é›†åˆseqä¸­éšæœºé€‰å–kä¸ªç‹¬ç«‹çš„çš„å…ƒç´ </p><p>å‚æ•°ï¼š</p><p>seqï¼šå…ƒç»„ã€åˆ—è¡¨æˆ–å­—ç¬¦ä¸²</p><p>kï¼šé€‰å–å…ƒç´ ä¸ªæ•°</p><p>å®ä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">In [<span class="hljs-number">1</span>]: <span class="hljs-keyword">import</span> random<br>In [<span class="hljs-number">2</span>]: f = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>]<br>In [<span class="hljs-number">3</span>]: f<br>Out[<span class="hljs-number">3</span>]: [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>]<br>In [<span class="hljs-number">4</span>]: random.sample(f, <span class="hljs-number">5</span>)<br>Out[<span class="hljs-number">4</span>]: [<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">9</span>, <span class="hljs-number">4</span>]<br> <br></code></pre></td></tr></table></figure><p>ä½¿ç”¨randomæ¨¡å—ä¸­çš„choiceå‡½æ•° åŠŸèƒ½ï¼š</p><p>random.choice(seq)å®ç°ä»åºåˆ—æˆ–é›†åˆseqä¸­éšæœºé€‰å–ä¸€ä¸ªå…ƒç´ </p><p>å‚æ•°ï¼š</p><p>seqï¼šå…ƒç»„ã€åˆ—è¡¨æˆ–å­—ç¬¦ä¸²</p><p>å®ä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">In [<span class="hljs-number">1</span>]: <span class="hljs-keyword">import</span> random<br>In [<span class="hljs-number">2</span>]: f = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>]<br>In [<span class="hljs-number">3</span>]: f<br>Out[<span class="hljs-number">3</span>]: [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>]<br>In [<span class="hljs-number">4</span>]: random.choice(f)<br>Out[<span class="hljs-number">4</span>]: <span class="hljs-number">2</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Python</tag>
      
      <tag>random</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaä½¿ç”¨zxingç”ŸæˆäºŒç»´ç (å¸¦æœ‰logo)</title>
    <link href="/blog/2021/03/25/Java%E4%BD%BF%E7%94%A8zxing%E7%94%9F%E6%88%90%E4%BA%8C%E7%BB%B4%E7%A0%81(%E5%B8%A6%E6%9C%89logo)/"/>
    <url>/blog/2021/03/25/Java%E4%BD%BF%E7%94%A8zxing%E7%94%9F%E6%88%90%E4%BA%8C%E7%BB%B4%E7%A0%81(%E5%B8%A6%E6%9C%89logo)/</url>
    
    <content type="html"><![CDATA[<h2 id="é¦–å…ˆè¦æ·»åŠ zxingä¾èµ–"><a href="#é¦–å…ˆè¦æ·»åŠ zxingä¾èµ–" class="headerlink" title="é¦–å…ˆè¦æ·»åŠ zxingä¾èµ–"></a>é¦–å…ˆè¦æ·»åŠ zxingä¾èµ–</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;!-- äºŒç»´ç ç”Ÿæˆä¾èµ– --&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;com.google.zxing&lt;/groupId&gt;<br>    &lt;artifactId&gt;core&lt;/artifactId&gt;<br>    &lt;version&gt;3.4.0&lt;/version&gt;<br>&lt;/dependency&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;com.google.zxing&lt;/groupId&gt;<br>    &lt;artifactId&gt;javase&lt;/artifactId&gt;<br>    &lt;version&gt;3.4.0&lt;/version&gt;<br>&lt;/dependency&gt;<br> <br></code></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xqd;<br> <br> <br><span class="hljs-keyword">import</span> com.google.zxing.BarcodeFormat;<br><span class="hljs-keyword">import</span> com.google.zxing.EncodeHintType;<br><span class="hljs-keyword">import</span> com.google.zxing.MultiFormatWriter;<br><span class="hljs-keyword">import</span> com.google.zxing.client.j2se.MatrixToImageWriter;<br><span class="hljs-keyword">import</span> com.google.zxing.common.BitMatrix;<br><span class="hljs-keyword">import</span> com.google.zxing.qrcode.decoder.ErrorCorrectionLevel;<br> <br><span class="hljs-keyword">import</span> javax.imageio.ImageIO;<br><span class="hljs-keyword">import</span> java.awt.*;<br><span class="hljs-keyword">import</span> java.awt.image.BufferedImage;<br><span class="hljs-keyword">import</span> java.io.File;<br><span class="hljs-keyword">import</span> java.nio.file.Path;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br> <br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@ClassName</span>: QRCodeUtil</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Description</span>: äºŒç»´ç ç”Ÿæˆ</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Authror</span>: XQD</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Date</span>: 2020/1/16 10:34</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QRCode</span> </span>&#123;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br> <br>        <span class="hljs-comment">// å®šä¹‰äºŒç»´ç çš„å‚æ•°</span><br>        <span class="hljs-keyword">int</span> width = <span class="hljs-number">300</span>; <span class="hljs-comment">// å›¾ç‰‡å®½åº¦</span><br>        <span class="hljs-keyword">int</span> height = <span class="hljs-number">300</span>; <span class="hljs-comment">// å›¾ç‰‡é«˜åº¦</span><br>        String format = <span class="hljs-string">&quot;jpg&quot;</span>; <span class="hljs-comment">// å›¾ç‰‡æ ¼å¼  å¦‚æœæ˜¯pngç±»å‹ï¼Œlogoå›¾å˜æˆé»‘ç™½çš„ï¼Œ</span><br>        String content = <span class="hljs-string">&quot;https://blog.csdn.net/weixin_44467567/article/details/103876746&quot;</span>;<span class="hljs-comment">// äºŒç»´ç å†…å®¹</span><br> <br>        <span class="hljs-comment">// 1.å®šä¹‰HashMap hints</span><br>        HashMap hints = <span class="hljs-keyword">new</span> HashMap();<br>        <span class="hljs-comment">// 2.hintsè°ƒç”¨putå‡½æ•°è®¾ç½®å­—ç¬¦é›†ã€é—´è·ä»¥åŠçº é”™åº¦ä¸ºM</span><br>        hints.put(EncodeHintType.CHARACTER_SET, <span class="hljs-string">&quot;utf-8&quot;</span>);<br>        hints.put(EncodeHintType.ERROR_CORRECTION, ErrorCorrectionLevel.M);<span class="hljs-comment">//çº é”™ç­‰çº§ã€Lï¼ŒMï¼ŒQï¼ŒHã€‘</span><br>        hints.put(EncodeHintType.MARGIN, <span class="hljs-number">2</span>);<br>        <span class="hljs-comment">// ç”ŸæˆäºŒç»´ç </span><br>        <span class="hljs-keyword">try</span> &#123;<br>            MultiFormatWriter multiFormatWriter = <span class="hljs-keyword">new</span> MultiFormatWriter();<br>            <span class="hljs-comment">// 3.æœ€åç”¨MultiformatWriterå‡½æ•°ç±»è°ƒç”¨echoedå‡½æ•°å¹¶è¿”å›ä¸€ä¸ªå€¼ ç„¶åå†™å…¥æ–‡ä»¶</span><br>            BitMatrix bitMatrix = multiFormatWriter.encode(content, BarcodeFormat.QR_CODE, width, height, hints);<br>            <span class="hljs-comment">// è¿™é‡Œè·¯å¾„åé¢çš„img.pngä¸å¯çœç•¥ï¼Œå‰é¢æ˜¯è‡ªå·±é€‰å–ç”Ÿæˆçš„å›¾ç‰‡åœ°å€</span><br>            Path file = <span class="hljs-keyword">new</span> File(<span class="hljs-string">&quot;F:/ç”Ÿæˆçš„äºŒç»´ç /img.png&quot;</span>).toPath();<br>            MatrixToImageWriter.writeToPath(bitMatrix, format, file);<br>            <span class="hljs-comment">//*************æ·»åŠ logo*****************</span><br>            <span class="hljs-comment">//è¯»å–äºŒç»´ç å›¾ç‰‡</span><br>            BufferedImage bufferedImage = ImageIO.read(<span class="hljs-keyword">new</span> File(file.toString()));<br>            <span class="hljs-comment">//è·å–ç”»ç¬”</span><br>            Graphics2D graphics = bufferedImage.createGraphics();<br>            <span class="hljs-comment">//è¯»å–logoå›¾ç‰‡</span><br>            BufferedImage logo = ImageIO.read(<span class="hljs-keyword">new</span> File(<span class="hljs-string">&quot;D:/å›¾ç‰‡/Saved Pictures/å¤´åƒ/å¾®ä¿¡å›¾ç‰‡_20200109163054.jpg&quot;</span>));<br>            <span class="hljs-comment">//è®¾ç½®äºŒç»´ç å¤§å°ï¼Œå¤ªå¤§äº†ä¼šè¦†ç›–äºŒç»´ç ï¼Œæ­¤å¤„ä¸º20%</span><br>            <span class="hljs-keyword">int</span> logoWidth = logo.getWidth() &gt; bufferedImage.getWidth()*<span class="hljs-number">2</span> /<span class="hljs-number">10</span> ? (bufferedImage.getWidth()*<span class="hljs-number">2</span> /<span class="hljs-number">10</span>) : logo.getWidth();<br>            <span class="hljs-keyword">int</span> logoHeight = logo.getHeight() &gt; bufferedImage.getHeight()*<span class="hljs-number">2</span> /<span class="hljs-number">10</span> ? (bufferedImage.getHeight()*<span class="hljs-number">2</span> /<span class="hljs-number">10</span>) : logo.getHeight();<br>            <span class="hljs-comment">//è®¾ç½®logoå›¾ç‰‡æ”¾ç½®çš„ä½ç½®ï¼Œä¸­å¿ƒ</span><br>            <span class="hljs-keyword">int</span> x = (bufferedImage.getWidth() - logoWidth) / <span class="hljs-number">2</span>;<br>            <span class="hljs-keyword">int</span> y = (bufferedImage.getHeight() - logoHeight) / <span class="hljs-number">2</span>;<br>            <span class="hljs-comment">//å¼€å§‹åˆå¹¶å¹¶ç»˜åˆ¶å›¾ç‰‡</span><br>            graphics.drawImage(logo,x,y,logoWidth,logoHeight,<span class="hljs-keyword">null</span>);<br>            graphics.drawRoundRect(x,y,logoWidth,logoHeight,<span class="hljs-number">15</span>,<span class="hljs-number">15</span>);<br>            <span class="hljs-comment">//logobè¾¹æ¡†å¤§å°</span><br>            graphics.setStroke(<span class="hljs-keyword">new</span> BasicStroke(<span class="hljs-number">2</span>));<br>            <span class="hljs-comment">//logoè¾¹æ¡†é¢œè‰²</span><br>            graphics.setColor(Color.WHITE);<br>            graphics.drawRect(x,y,logoWidth,logoHeight);<br>            graphics.dispose();<br>            logo.flush();<br>            bufferedImage.flush();<br>            ImageIO.write(bufferedImage, format ,<span class="hljs-keyword">new</span> File(<span class="hljs-string">&quot;F:/ç”Ÿæˆçš„äºŒç»´ç /img2.png&quot;</span>));<br> <br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-comment">// TODO Auto-generated catch block</span><br>            e.printStackTrace();<br>        &#125;<br> <br>    &#125;<br> <br> <br>&#125;<br> <br></code></pre></td></tr></table></figure><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/small-20210325200119868.png" alt="202001171536554"></p>]]></content>
    
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>zxing</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>javaä¸­poiå¯¼å‡ºæ¨¡æ¿ä¸‹æ‹‰æ¡†å®ç°äºŒçº§è”åŠ¨</title>
    <link href="/blog/2021/03/25/java%E4%B8%ADpoi%E5%AF%BC%E5%87%BA%E6%A8%A1%E6%9D%BF%E4%B8%8B%E6%8B%89%E6%A1%86%E5%AE%9E%E7%8E%B0%E4%BA%8C%E7%BA%A7%E8%81%94%E5%8A%A8/"/>
    <url>/blog/2021/03/25/java%E4%B8%ADpoi%E5%AF%BC%E5%87%BA%E6%A8%A1%E6%9D%BF%E4%B8%8B%E6%8B%89%E6%A1%86%E5%AE%9E%E7%8E%B0%E4%BA%8C%E7%BA%A7%E8%81%94%E5%8A%A8/</url>
    
    <content type="html"><![CDATA[<p>ä»£ç å®ç°å¦‚ä¸‹ï¼š éœ€è¦åŠ å…¥çš„jaråŒ…:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependency&gt;<br>   &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;<br>   &lt;artifactId&gt;poi&lt;/artifactId&gt;<br>   &lt;version&gt;3.14&lt;/version&gt;<br>&lt;/dependency&gt;<br>&lt;dependency&gt;<br>   &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;<br>   &lt;artifactId&gt;poi-ooxml&lt;/artifactId&gt;<br>   &lt;version&gt;3.14&lt;/version&gt;<br>&lt;/dependency&gt;<br> <br></code></pre></td></tr></table></figure><p>äºŒçº§è”åŠ¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br></pre></td><td class="code"><pre><code class="hljs java"> <br><span class="hljs-keyword">package</span> com.test;<br> <br><span class="hljs-keyword">import</span> java.io.FileOutputStream;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><span class="hljs-keyword">import</span> org.apache.poi.ss.usermodel.Cell;<br><span class="hljs-keyword">import</span> org.apache.poi.ss.usermodel.DataValidation;<br><span class="hljs-keyword">import</span> org.apache.poi.ss.usermodel.DataValidationConstraint;<br><span class="hljs-keyword">import</span> org.apache.poi.ss.usermodel.Name;<br><span class="hljs-keyword">import</span> org.apache.poi.ss.usermodel.Row;<br><span class="hljs-keyword">import</span> org.apache.poi.ss.usermodel.Sheet;<br><span class="hljs-keyword">import</span> org.apache.poi.ss.usermodel.Workbook;<br><span class="hljs-keyword">import</span> org.apache.poi.ss.util.CellRangeAddressList;<br><span class="hljs-keyword">import</span> org.apache.poi.util.IOUtils;<br><span class="hljs-keyword">import</span> org.apache.poi.xssf.usermodel.XSSFDataValidation;<br><span class="hljs-keyword">import</span> org.apache.poi.xssf.usermodel.XSSFDataValidationConstraint;<br><span class="hljs-keyword">import</span> org.apache.poi.xssf.usermodel.XSSFDataValidationHelper;<br><span class="hljs-keyword">import</span> org.apache.poi.xssf.usermodel.XSSFSheet;<br><span class="hljs-keyword">import</span> org.apache.poi.xssf.usermodel.XSSFWorkbook;<br> <br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TwoExport</span> </span>&#123;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Cascade();<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Cascade</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªexcel</span><br>        <span class="hljs-meta">@SuppressWarnings(&quot;resource&quot;)</span><br>        Workbook workbook = <span class="hljs-keyword">new</span> XSSFWorkbook();<br> <br>        <span class="hljs-comment">// åˆ›å»ºéœ€è¦ç”¨æˆ·å¡«å†™çš„sheet</span><br>        XSSFSheet sheet = (XSSFSheet) workbook.createSheet(<span class="hljs-string">&quot;çœå¸‚å¿&quot;</span>);<br>        Row row0 = sheet.createRow(<span class="hljs-number">0</span>);<br>        row0.createCell(<span class="hljs-number">5</span>).setCellValue(<span class="hljs-string">&quot;æ¸ é“ç±»å‹&quot;</span>);<br>        row0.createCell(<span class="hljs-number">6</span>).setCellValue(<span class="hljs-string">&quot;æ¸ é“æ¥æº&quot;</span>);<br> <br>        <span class="hljs-comment">//å¾—åˆ°ç¬¬ä¸€çº§çœåç§°ï¼Œæ”¾åœ¨åˆ—è¡¨é‡Œ</span><br>        String[] provinceArr = &#123;<span class="hljs-string">&quot;çº¿ä¸Š&quot;</span>,<span class="hljs-string">&quot;çº¿ä¸‹&quot;</span>&#125;;<br>        <span class="hljs-comment">//ä¾æ¬¡åˆ—å‡ºå„çœçš„å¸‚ã€å„å¸‚çš„å¿</span><br>        String[] cityJiangSu = &#123;<span class="hljs-string">&quot;æ‹›æ ‡ç½‘ç«™&quot;</span>,<span class="hljs-string">&quot;è¥é”€è‡ªåŠ¨åŒ–ACRM&quot;</span>,<span class="hljs-string">&quot;é—¨æˆ·ç½‘ç»œåª’ä½“&quot;</span>,<span class="hljs-string">&quot;ç§»åŠ¨ç¤¾äº¤åª’ä½“&quot;</span>,<span class="hljs-string">&quot;ç§»åŠ¨ç¤¾äº¤åª’ä½“&quot;</span>,<span class="hljs-string">&quot;æœç´¢å¼•æ“&quot;</span>,<span class="hljs-string">&quot;å¹³é¢åª’ä½“&quot;</span>,<span class="hljs-string">&quot;æˆ·å¤–åª’ä½“&quot;</span>,<span class="hljs-string">&quot;å…¶ä»–&quot;</span>&#125;;<br>        String[] cityAnHui = &#123;<span class="hljs-string">&quot;è¡Œä¸šåšè§ˆä¼š&quot;</span>,<span class="hljs-string">&quot;è¡Œä¸šå³°ä¼š/è®ºå›/æ²™é¾™&quot;</span>,<span class="hljs-string">&quot;äº§ä¸šçº§å¸‚åœºæ´»åŠ¨&quot;</span>,<span class="hljs-string">&quot;å¤§åŒº/å…¬è·¯æ¸¯å¸‚åœºæ´»åŠ¨&quot;</span>,<span class="hljs-string">&quot;æœ¬éƒ¨é—¨å¸‚åœºæ´»åŠ¨&quot;</span>,<span class="hljs-string">&quot;å­˜é‡å®¢æˆ·ä¸Šä¸‹æ¸¸&quot;</span>,<span class="hljs-string">&quot;æ”¿åºœå…³ç³»ç½‘ç»œ&quot;</span>,<span class="hljs-string">&quot;ä¸ªäººå…³ç³»ç½‘ç»œ&quot;</span>,<span class="hljs-string">&quot;ä¼ åŒ–ç”Ÿæ€ä¸šåŠ¡&quot;</span>,<span class="hljs-string">&quot;å…¶ä»–&quot;</span>&#125;;<br>        <span class="hljs-comment">//å°†æœ‰å­åŒºåŸŸçš„çˆ¶åŒºåŸŸæ”¾åˆ°ä¸€ä¸ªæ•°ç»„ä¸­</span><br>        String[] areaFatherNameArr =&#123;<span class="hljs-string">&quot;çº¿ä¸Š&quot;</span>,<span class="hljs-string">&quot;çº¿ä¸‹&quot;</span>&#125;;<br>        Map&lt;String,String[]&gt; areaMap = <span class="hljs-keyword">new</span> HashMap&lt;String, String[]&gt;();<br>        areaMap.put(<span class="hljs-string">&quot;çº¿ä¸Š&quot;</span>, cityJiangSu);<br>        areaMap.put(<span class="hljs-string">&quot;çº¿ä¸‹&quot;</span>,cityAnHui);<br> <br>        <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªä¸“é—¨ç”¨æ¥å­˜æ”¾åœ°åŒºä¿¡æ¯çš„éšè—sheeté¡µ</span><br>        <span class="hljs-comment">//å› æ­¤ä¹Ÿä¸èƒ½åœ¨ç°å®é¡µä¹‹å‰åˆ›å»ºï¼Œå¦åˆ™æ— æ³•éšè—ã€‚</span><br>        Sheet hideSheet = workbook.createSheet(<span class="hljs-string">&quot;area&quot;</span>);<br>        <span class="hljs-comment">//è¿™ä¸€è¡Œä½œç”¨æ˜¯å°†æ­¤sheetéšè—ï¼ŒåŠŸèƒ½æœªå®Œæˆæ—¶æ³¨é‡Šæ­¤è¡Œ,å¯ä»¥æŸ¥çœ‹éšè—sheetä¸­ä¿¡æ¯æ˜¯å¦æ­£ç¡®</span><br>        workbook.setSheetHidden(workbook.getSheetIndex(hideSheet), <span class="hljs-keyword">true</span>);<br> <br>        <span class="hljs-keyword">int</span> rowId = <span class="hljs-number">0</span>;<br>        <span class="hljs-comment">// è®¾ç½®ç¬¬ä¸€è¡Œï¼Œå­˜çœçš„ä¿¡æ¯</span><br>        Row provinceRow = hideSheet.createRow(rowId++);<br>        provinceRow.createCell(<span class="hljs-number">0</span>).setCellValue(<span class="hljs-string">&quot;æ¸ é“&quot;</span>);<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; provinceArr.length; i ++)&#123;<br>            Cell provinceCell = provinceRow.createCell(i + <span class="hljs-number">1</span>);<br>            provinceCell.setCellValue(provinceArr[i]);<br>        &#125;<br>        <span class="hljs-comment">// å°†å…·ä½“çš„æ•°æ®å†™å…¥åˆ°æ¯ä¸€è¡Œä¸­ï¼Œè¡Œå¼€å¤´ä¸ºçˆ¶çº§åŒºåŸŸï¼Œåé¢æ˜¯å­åŒºåŸŸã€‚</span><br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;i &lt; areaFatherNameArr.length;i++)&#123;<br>            String key = areaFatherNameArr[i];<br>            String[] son = areaMap.get(key);<br>            Row row1 = hideSheet.createRow(rowId++);<br>            row1.createCell(<span class="hljs-number">0</span>).setCellValue(key);<br>            <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; son.length; j ++)&#123;<br>                Cell cell0 = row1.createCell(j + <span class="hljs-number">1</span>);<br>                cell0.setCellValue(son[j]);<br>            &#125;<br> <br>            <span class="hljs-comment">// æ·»åŠ åç§°ç®¡ç†å™¨</span><br>            String range = getRange(<span class="hljs-number">1</span>, rowId, son.length);<br>            Name name = workbook.createName();<br>            <span class="hljs-comment">//keyä¸å¯é‡å¤</span><br>            name.setNameName(key);<br>            String formula = <span class="hljs-string">&quot;area!&quot;</span> + range;<br>            name.setRefersToFormula(formula);<br>        &#125;<br> <br>        XSSFDataValidationHelper dvHelper = <span class="hljs-keyword">new</span> XSSFDataValidationHelper((XSSFSheet)sheet);<br>        <span class="hljs-comment">// çœè§„åˆ™</span><br>        DataValidationConstraint provConstraint = dvHelper.createExplicitListConstraint(provinceArr);<br>        <span class="hljs-comment">// å››ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ï¼šèµ·å§‹è¡Œã€ç»ˆæ­¢è¡Œã€èµ·å§‹åˆ—ã€ç»ˆæ­¢åˆ—</span><br>        CellRangeAddressList provRangeAddressList = <span class="hljs-keyword">new</span> CellRangeAddressList(<span class="hljs-number">2</span>, <span class="hljs-number">202</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>);<br>        DataValidation provinceDataValidation = dvHelper.createValidation(provConstraint, provRangeAddressList);<br>        <span class="hljs-comment">//éªŒè¯</span><br>        provinceDataValidation.createErrorBox(<span class="hljs-string">&quot;error&quot;</span>, <span class="hljs-string">&quot;è¯·é€‰æ‹©æ­£ç¡®çš„æ¸ é“&quot;</span>);<br>        provinceDataValidation.setShowErrorBox(<span class="hljs-keyword">true</span>);<br>        provinceDataValidation.setSuppressDropDownArrow(<span class="hljs-keyword">true</span>);<br>        sheet.addValidationData(provinceDataValidation);<br> <br>        <span class="hljs-comment">//å¯¹å‰20è¡Œè®¾ç½®æœ‰æ•ˆæ€§</span><br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">3</span>;i &lt; <span class="hljs-number">204</span>;i++)&#123;<br>            setDataValidation(<span class="hljs-string">&quot;F&quot;</span> ,sheet,i,<span class="hljs-number">7</span>);<br>        &#125;<br>        FileOutputStream os = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            os = <span class="hljs-keyword">new</span> FileOutputStream(<span class="hljs-string">&quot;D:/test02.xlsx&quot;</span>);<br>            workbook.write(os);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            IOUtils.closeQuietly(os);<br>        &#125;<br>    &#125;<br> <br> <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è®¾ç½®æœ‰æ•ˆæ€§</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> offset ä¸»å½±å“å•å…ƒæ ¼æ‰€åœ¨åˆ—ï¼Œå³æ­¤å•å…ƒæ ¼ç”±å“ªä¸ªå•å…ƒæ ¼å½±å“è”åŠ¨</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> sheet</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> rowNum è¡Œæ•°</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> colNum åˆ—æ•°</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setDataValidation</span><span class="hljs-params">(String offset,XSSFSheet sheet, <span class="hljs-keyword">int</span> rowNum,<span class="hljs-keyword">int</span> colNum)</span> </span>&#123;<br>        XSSFDataValidationHelper dvHelper = <span class="hljs-keyword">new</span> XSSFDataValidationHelper(sheet);<br>        DataValidation data_validation_list;<br>        data_validation_list = getDataValidationByFormula(<br>                <span class="hljs-string">&quot;INDIRECT($&quot;</span> + offset + (rowNum) + <span class="hljs-string">&quot;)&quot;</span>, rowNum, colNum,dvHelper);<br>        sheet.addValidationData(data_validation_list);<br>    &#125;<br> <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åŠ è½½ä¸‹æ‹‰åˆ—è¡¨å†…å®¹</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> formulaString</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> naturalRowIndex</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> naturalColumnIndex</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> dvHelper</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span>  DataValidation <span class="hljs-title">getDataValidationByFormula</span><span class="hljs-params">(</span></span><br><span class="hljs-function"><span class="hljs-params">            String formulaString, <span class="hljs-keyword">int</span> naturalRowIndex, <span class="hljs-keyword">int</span> naturalColumnIndex,XSSFDataValidationHelper dvHelper)</span> </span>&#123;<br>        <span class="hljs-comment">// åŠ è½½ä¸‹æ‹‰åˆ—è¡¨å†…å®¹</span><br>        <span class="hljs-comment">// ä¸¾ä¾‹ï¼šè‹¥formulaString = &quot;INDIRECT($A$2)&quot; è¡¨ç¤ºè§„åˆ™æ•°æ®ä¼šä»åç§°ç®¡ç†å™¨ä¸­è·å–keyä¸å•å…ƒæ ¼ A2 å€¼ç›¸åŒçš„æ•°æ®ï¼Œ</span><br>        <span class="hljs-comment">//å¦‚æœA2æ˜¯æ±Ÿè‹çœï¼Œé‚£ä¹ˆæ­¤å¤„å°±æ˜¯æ±Ÿè‹çœä¸‹çš„å¸‚ä¿¡æ¯ã€‚</span><br>        XSSFDataValidationConstraint dvConstraint = (XSSFDataValidationConstraint) dvHelper.createFormulaListConstraint(formulaString);<br>        <span class="hljs-comment">// è®¾ç½®æ•°æ®æœ‰æ•ˆæ€§åŠ è½½åœ¨å“ªä¸ªå•å…ƒæ ¼ä¸Šã€‚</span><br>        <span class="hljs-comment">// å››ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ï¼šèµ·å§‹è¡Œã€ç»ˆæ­¢è¡Œã€èµ·å§‹åˆ—ã€ç»ˆæ­¢åˆ—</span><br>        <span class="hljs-keyword">int</span> firstRow = naturalRowIndex -<span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">int</span> lastRow = naturalRowIndex - <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">int</span> firstCol = naturalColumnIndex - <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">int</span> lastCol = naturalColumnIndex - <span class="hljs-number">1</span>;<br>        CellRangeAddressList regions = <span class="hljs-keyword">new</span> CellRangeAddressList(firstRow,<br>                lastRow, firstCol, lastCol);<br>        <span class="hljs-comment">// æ•°æ®æœ‰æ•ˆæ€§å¯¹è±¡</span><br>        <span class="hljs-comment">// ç»‘å®š</span><br>        XSSFDataValidation data_validation_list = (XSSFDataValidation) dvHelper.createValidation(dvConstraint, regions);<br>        data_validation_list.setEmptyCellAllowed(<span class="hljs-keyword">false</span>);<br>        <span class="hljs-keyword">if</span> (data_validation_list <span class="hljs-keyword">instanceof</span> XSSFDataValidation) &#123;<br>            data_validation_list.setSuppressDropDownArrow(<span class="hljs-keyword">true</span>);<br>            data_validation_list.setShowErrorBox(<span class="hljs-keyword">true</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            data_validation_list.setSuppressDropDownArrow(<span class="hljs-keyword">false</span>);<br>        &#125;<br>        <span class="hljs-comment">// è®¾ç½®è¾“å…¥ä¿¡æ¯æç¤ºä¿¡æ¯</span><br>        data_validation_list.createPromptBox(<span class="hljs-string">&quot;ä¸‹æ‹‰é€‰æ‹©æç¤º&quot;</span>, <span class="hljs-string">&quot;è¯·ä½¿ç”¨ä¸‹æ‹‰æ–¹å¼é€‰æ‹©åˆé€‚çš„å€¼ï¼&quot;</span>);<br>        <span class="hljs-comment">// è®¾ç½®è¾“å…¥é”™è¯¯æç¤ºä¿¡æ¯</span><br>        <span class="hljs-comment">//data_validation_list.createErrorBox(&quot;é€‰æ‹©é”™è¯¯æç¤º&quot;, &quot;ä½ è¾“å…¥çš„å€¼æœªåœ¨å¤‡é€‰åˆ—è¡¨ä¸­ï¼Œè¯·ä¸‹æ‹‰é€‰æ‹©åˆé€‚çš„å€¼ï¼&quot;);</span><br>        <span class="hljs-keyword">return</span> data_validation_list;<br>    &#125;<br> <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     *  è®¡ç®—formula</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> offset åç§»é‡ï¼Œå¦‚æœç»™0ï¼Œè¡¨ç¤ºä»Aåˆ—å¼€å§‹ï¼Œ1ï¼Œå°±æ˜¯ä»Båˆ—</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> rowId ç¬¬å‡ è¡Œ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> colCount ä¸€å…±å¤šå°‘åˆ—</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> å¦‚æœç»™å…¥å‚ 1,1,10. è¡¨ç¤ºä»B1-K1ã€‚æœ€ç»ˆè¿”å› $B$1:$K$1</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">getRange</span><span class="hljs-params">(<span class="hljs-keyword">int</span> offset, <span class="hljs-keyword">int</span> rowId, <span class="hljs-keyword">int</span> colCount)</span> </span>&#123;<br>        <span class="hljs-keyword">char</span> start = (<span class="hljs-keyword">char</span>)(<span class="hljs-string">&#x27;A&#x27;</span> + offset);<br>        <span class="hljs-keyword">if</span> (colCount &lt;= <span class="hljs-number">25</span>) &#123;<br>            <span class="hljs-keyword">char</span> end = (<span class="hljs-keyword">char</span>)(start + colCount - <span class="hljs-number">1</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;$&quot;</span> + start + <span class="hljs-string">&quot;$&quot;</span> + rowId + <span class="hljs-string">&quot;:$&quot;</span> + end + <span class="hljs-string">&quot;$&quot;</span> + rowId;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">char</span> endPrefix = <span class="hljs-string">&#x27;A&#x27;</span>;<br>            <span class="hljs-keyword">char</span> endSuffix = <span class="hljs-string">&#x27;A&#x27;</span>;<br>            <span class="hljs-keyword">if</span> ((colCount - <span class="hljs-number">25</span>) / <span class="hljs-number">26</span> == <span class="hljs-number">0</span> || colCount == <span class="hljs-number">51</span>) &#123;<span class="hljs-comment">// 26-51ä¹‹é—´ï¼ŒåŒ…æ‹¬è¾¹ç•Œï¼ˆä»…ä¸¤æ¬¡å­—æ¯è¡¨è®¡ç®—ï¼‰</span><br>                <span class="hljs-keyword">if</span> ((colCount - <span class="hljs-number">25</span>) % <span class="hljs-number">26</span> == <span class="hljs-number">0</span>) &#123;<span class="hljs-comment">// è¾¹ç•Œå€¼</span><br>                    endSuffix = (<span class="hljs-keyword">char</span>)(<span class="hljs-string">&#x27;A&#x27;</span> + <span class="hljs-number">25</span>);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    endSuffix = (<span class="hljs-keyword">char</span>)(<span class="hljs-string">&#x27;A&#x27;</span> + (colCount - <span class="hljs-number">25</span>) % <span class="hljs-number">26</span> - <span class="hljs-number">1</span>);<br>                &#125;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-comment">// 51ä»¥ä¸Š</span><br>                <span class="hljs-keyword">if</span> ((colCount - <span class="hljs-number">25</span>) % <span class="hljs-number">26</span> == <span class="hljs-number">0</span>) &#123;<br>                    endSuffix = (<span class="hljs-keyword">char</span>)(<span class="hljs-string">&#x27;A&#x27;</span> + <span class="hljs-number">25</span>);<br>                    endPrefix = (<span class="hljs-keyword">char</span>)(endPrefix + (colCount - <span class="hljs-number">25</span>) / <span class="hljs-number">26</span> - <span class="hljs-number">1</span>);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    endSuffix = (<span class="hljs-keyword">char</span>)(<span class="hljs-string">&#x27;A&#x27;</span> + (colCount - <span class="hljs-number">25</span>) % <span class="hljs-number">26</span> - <span class="hljs-number">1</span>);<br>                    endPrefix = (<span class="hljs-keyword">char</span>)(endPrefix + (colCount - <span class="hljs-number">25</span>) / <span class="hljs-number">26</span>);<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;$&quot;</span> + start + <span class="hljs-string">&quot;$&quot;</span> + rowId + <span class="hljs-string">&quot;:$&quot;</span> + endPrefix + endSuffix + <span class="hljs-string">&quot;$&quot;</span> + rowId;<br>        &#125;<br>    &#125;<br>&#125;<br> <br></code></pre></td></tr></table></figure><p>æ•ˆæœå¦‚ä¸‹ï¼š<img src="https://cuixiaoyande.oss-cn-shanghai.aliyuncs.com/2020011711222348_1579401982569.png?x-oss-process=style/small" alt="2020011711222348">ä¸‰çº§è”åŠ¨ï¼š ä»£ç å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.test;<br><span class="hljs-keyword">import</span> java.io.FileOutputStream;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br> <br><span class="hljs-keyword">import</span> org.apache.poi.ss.usermodel.Cell;<br><span class="hljs-keyword">import</span> org.apache.poi.ss.usermodel.DataValidation;<br><span class="hljs-keyword">import</span> org.apache.poi.ss.usermodel.DataValidationConstraint;<br><span class="hljs-keyword">import</span> org.apache.poi.ss.usermodel.Name;<br><span class="hljs-keyword">import</span> org.apache.poi.ss.usermodel.Row;<br><span class="hljs-keyword">import</span> org.apache.poi.ss.usermodel.Sheet;<br><span class="hljs-keyword">import</span> org.apache.poi.ss.usermodel.Workbook;<br><span class="hljs-keyword">import</span> org.apache.poi.ss.util.CellRangeAddressList;<br><span class="hljs-keyword">import</span> org.apache.poi.util.IOUtils;<br><span class="hljs-keyword">import</span> org.apache.poi.xssf.usermodel.XSSFDataValidation;<br><span class="hljs-keyword">import</span> org.apache.poi.xssf.usermodel.XSSFDataValidationConstraint;<br><span class="hljs-keyword">import</span> org.apache.poi.xssf.usermodel.XSSFDataValidationHelper;<br><span class="hljs-keyword">import</span> org.apache.poi.xssf.usermodel.XSSFSheet;<br><span class="hljs-keyword">import</span> org.apache.poi.xssf.usermodel.XSSFWorkbook;<br> <br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Export</span> </span>&#123;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Cascade();<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Cascade</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªexcel</span><br>        <span class="hljs-meta">@SuppressWarnings(&quot;resource&quot;)</span><br>        Workbook book = <span class="hljs-keyword">new</span> XSSFWorkbook();<br> <br>        <span class="hljs-comment">// åˆ›å»ºéœ€è¦ç”¨æˆ·å¡«å†™çš„sheet</span><br>        XSSFSheet sheetPro = (XSSFSheet) book.createSheet(<span class="hljs-string">&quot;çœå¸‚å¿&quot;</span>);<br>        Row row0 = sheetPro.createRow(<span class="hljs-number">0</span>);<br>        row0.createCell(<span class="hljs-number">0</span>).setCellValue(<span class="hljs-string">&quot;çœ&quot;</span>);<br>        row0.createCell(<span class="hljs-number">1</span>).setCellValue(<span class="hljs-string">&quot;å¸‚&quot;</span>);<br>        row0.createCell(<span class="hljs-number">2</span>).setCellValue(<span class="hljs-string">&quot;åŒº&quot;</span>);<br> <br>        <span class="hljs-comment">//å¾—åˆ°ç¬¬ä¸€çº§çœåç§°ï¼Œæ”¾åœ¨åˆ—è¡¨é‡Œ</span><br>        String[] provinceArr = &#123;<span class="hljs-string">&quot;æ±Ÿè‹çœ&quot;</span>,<span class="hljs-string">&quot;å®‰å¾½çœ&quot;</span>&#125;;<br>        <span class="hljs-comment">//ä¾æ¬¡åˆ—å‡ºå„çœçš„å¸‚ã€å„å¸‚çš„å¿</span><br>        String[] cityJiangSu = &#123;<span class="hljs-string">&quot;å—äº¬å¸‚&quot;</span>,<span class="hljs-string">&quot;è‹å·å¸‚&quot;</span>,<span class="hljs-string">&quot;ç›åŸå¸‚&quot;</span>&#125;;<br>        String[] cityAnHui = &#123;<span class="hljs-string">&quot;åˆè‚¥å¸‚&quot;</span>,<span class="hljs-string">&quot;å®‰åº†å¸‚&quot;</span>&#125;;<br>        String[] countyNanjing = &#123;<span class="hljs-string">&quot;å…­åˆå¿&quot;</span>,<span class="hljs-string">&quot;æ±Ÿå®å¿&quot;</span>&#125;;<br>        String[] countySuzhou = &#123;<span class="hljs-string">&quot;å§‘è‹åŒº&quot;</span>,<span class="hljs-string">&quot;å›­åŒº&quot;</span>&#125;;<br>        String[] countyYancheng = &#123;<span class="hljs-string">&quot;å“æ°´å¿&quot;</span>,<span class="hljs-string">&quot;å°„é˜³å¿&quot;</span>&#125;;<br>        String[] countyLiuhe = &#123;<span class="hljs-string">&quot;ç‘¶æµ·åŒº&quot;</span>,<span class="hljs-string">&quot;åºé˜³åŒº&quot;</span>&#125;;<br>        String[] countyAnQing = &#123;<span class="hljs-string">&quot;è¿æ±ŸåŒº&quot;</span>,<span class="hljs-string">&quot;å¤§è§‚åŒº&quot;</span>&#125;;<br>        <span class="hljs-comment">//å°†æœ‰å­åŒºåŸŸçš„çˆ¶åŒºåŸŸæ”¾åˆ°ä¸€ä¸ªæ•°ç»„ä¸­</span><br>        String[] areaFatherNameArr =&#123;<span class="hljs-string">&quot;æ±Ÿè‹çœ&quot;</span>,<span class="hljs-string">&quot;å®‰å¾½çœ&quot;</span>,<span class="hljs-string">&quot;å—äº¬å¸‚&quot;</span>,<span class="hljs-string">&quot;è‹å·å¸‚&quot;</span>,<span class="hljs-string">&quot;ç›åŸå¸‚&quot;</span>,<span class="hljs-string">&quot;åˆè‚¥å¸‚&quot;</span>,<span class="hljs-string">&quot;å®‰åº†å¸‚&quot;</span>&#125;;<br>        Map&lt;String,String[]&gt; areaMap = <span class="hljs-keyword">new</span> HashMap&lt;String, String[]&gt;();<br>        areaMap.put(<span class="hljs-string">&quot;æ±Ÿè‹çœ&quot;</span>, cityJiangSu);<br>        areaMap.put(<span class="hljs-string">&quot;å®‰å¾½çœ&quot;</span>,cityAnHui);<br>        areaMap.put(<span class="hljs-string">&quot;å—äº¬å¸‚&quot;</span>,countyNanjing);<br>        areaMap.put(<span class="hljs-string">&quot;è‹å·å¸‚&quot;</span>, countySuzhou);<br>        areaMap.put(<span class="hljs-string">&quot;ç›åŸå¸‚&quot;</span>,countyYancheng);<br>        areaMap.put(<span class="hljs-string">&quot;åˆè‚¥å¸‚&quot;</span>,countyYancheng);<br>        areaMap.put(<span class="hljs-string">&quot;åˆè‚¥å¸‚&quot;</span>, countyLiuhe);<br>        areaMap.put(<span class="hljs-string">&quot;å®‰åº†å¸‚&quot;</span>,countyAnQing);<br> <br>        <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªä¸“é—¨ç”¨æ¥å­˜æ”¾åœ°åŒºä¿¡æ¯çš„éšè—sheeté¡µ</span><br>        <span class="hljs-comment">//å› æ­¤ä¹Ÿä¸èƒ½åœ¨ç°å®é¡µä¹‹å‰åˆ›å»ºï¼Œå¦åˆ™æ— æ³•éšè—ã€‚</span><br>        Sheet hideSheet = book.createSheet(<span class="hljs-string">&quot;area&quot;</span>);<br>        <span class="hljs-comment">//è¿™ä¸€è¡Œä½œç”¨æ˜¯å°†æ­¤sheetéšè—ï¼ŒåŠŸèƒ½æœªå®Œæˆæ—¶æ³¨é‡Šæ­¤è¡Œ,å¯ä»¥æŸ¥çœ‹éšè—sheetä¸­ä¿¡æ¯æ˜¯å¦æ­£ç¡®</span><br>        <span class="hljs-comment">//book.setSheetHidden(book.getSheetIndex(hideSheet), true);</span><br> <br>        <span class="hljs-keyword">int</span> rowId = <span class="hljs-number">0</span>;<br>        <span class="hljs-comment">// è®¾ç½®ç¬¬ä¸€è¡Œï¼Œå­˜çœçš„ä¿¡æ¯</span><br>        Row provinceRow = hideSheet.createRow(rowId++);<br>        provinceRow.createCell(<span class="hljs-number">0</span>).setCellValue(<span class="hljs-string">&quot;çœåˆ—è¡¨&quot;</span>);<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; provinceArr.length; i ++)&#123;<br>            Cell provinceCell = provinceRow.createCell(i + <span class="hljs-number">1</span>);<br>            provinceCell.setCellValue(provinceArr[i]);<br>        &#125;<br>        <span class="hljs-comment">// å°†å…·ä½“çš„æ•°æ®å†™å…¥åˆ°æ¯ä¸€è¡Œä¸­ï¼Œè¡Œå¼€å¤´ä¸ºçˆ¶çº§åŒºåŸŸï¼Œåé¢æ˜¯å­åŒºåŸŸã€‚</span><br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;i &lt; areaFatherNameArr.length;i++)&#123;<br>            String key = areaFatherNameArr[i];<br>            String[] son = areaMap.get(key);<br>            Row row = hideSheet.createRow(rowId++);<br>            row.createCell(<span class="hljs-number">0</span>).setCellValue(key);<br>            <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; son.length; j ++)&#123;<br>                Cell cell = row.createCell(j + <span class="hljs-number">1</span>);<br>                cell.setCellValue(son[j]);<br>            &#125;<br> <br>            <span class="hljs-comment">// æ·»åŠ åç§°ç®¡ç†å™¨</span><br>            String range = getRange(<span class="hljs-number">1</span>, rowId, son.length);<br>            Name name = book.createName();<br>            <span class="hljs-comment">//keyä¸å¯é‡å¤</span><br>            name.setNameName(key);<br>            String formula = <span class="hljs-string">&quot;area!&quot;</span> + range;<br>            name.setRefersToFormula(formula);<br>        &#125;<br> <br>        XSSFDataValidationHelper dvHelper = <span class="hljs-keyword">new</span> XSSFDataValidationHelper((XSSFSheet)sheetPro);<br>        <span class="hljs-comment">// çœè§„åˆ™</span><br>        DataValidationConstraint provConstraint = dvHelper.createExplicitListConstraint(provinceArr);<br>        <span class="hljs-comment">// å››ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ï¼šèµ·å§‹è¡Œã€ç»ˆæ­¢è¡Œã€èµ·å§‹åˆ—ã€ç»ˆæ­¢åˆ—</span><br>        CellRangeAddressList provRangeAddressList = <span class="hljs-keyword">new</span> CellRangeAddressList(<span class="hljs-number">1</span>, <span class="hljs-number">20</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>        DataValidation provinceDataValidation = dvHelper.createValidation(provConstraint, provRangeAddressList);<br>        <span class="hljs-comment">//éªŒè¯</span><br>        provinceDataValidation.createErrorBox(<span class="hljs-string">&quot;error&quot;</span>, <span class="hljs-string">&quot;è¯·é€‰æ‹©æ­£ç¡®çš„çœä»½&quot;</span>);<br>        provinceDataValidation.setShowErrorBox(<span class="hljs-keyword">true</span>);<br>        provinceDataValidation.setSuppressDropDownArrow(<span class="hljs-keyword">true</span>);<br>        sheetPro.addValidationData(provinceDataValidation);<br> <br>        <span class="hljs-comment">//å¯¹å‰20è¡Œè®¾ç½®æœ‰æ•ˆæ€§</span><br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">2</span>;i &lt; <span class="hljs-number">20</span>;i++)&#123;<br>            setDataValidation(<span class="hljs-string">&quot;A&quot;</span> ,sheetPro,i,<span class="hljs-number">2</span>);<br>            setDataValidation(<span class="hljs-string">&quot;B&quot;</span> ,sheetPro,i,<span class="hljs-number">3</span>);<br>        &#125;<br>        FileOutputStream os = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            os = <span class="hljs-keyword">new</span> FileOutputStream(<span class="hljs-string">&quot;D:/test01.xlsx&quot;</span>);<br>            book.write(os);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            IOUtils.closeQuietly(os);<br>        &#125;<br>    &#125;<br> <br> <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è®¾ç½®æœ‰æ•ˆæ€§</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> offset ä¸»å½±å“å•å…ƒæ ¼æ‰€åœ¨åˆ—ï¼Œå³æ­¤å•å…ƒæ ¼ç”±å“ªä¸ªå•å…ƒæ ¼å½±å“è”åŠ¨</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> sheet</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> rowNum è¡Œæ•°</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> colNum åˆ—æ•°</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setDataValidation</span><span class="hljs-params">(String offset,XSSFSheet sheet, <span class="hljs-keyword">int</span> rowNum,<span class="hljs-keyword">int</span> colNum)</span> </span>&#123;<br>        XSSFDataValidationHelper dvHelper = <span class="hljs-keyword">new</span> XSSFDataValidationHelper(sheet);<br>        DataValidation data_validation_list;<br>        data_validation_list = getDataValidationByFormula(<br>                <span class="hljs-string">&quot;INDIRECT($&quot;</span> + offset + (rowNum) + <span class="hljs-string">&quot;)&quot;</span>, rowNum, colNum,dvHelper);<br>        sheet.addValidationData(data_validation_list);<br>    &#125;<br> <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åŠ è½½ä¸‹æ‹‰åˆ—è¡¨å†…å®¹</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> formulaString</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> naturalRowIndex</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> naturalColumnIndex</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> dvHelper</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span>  DataValidation <span class="hljs-title">getDataValidationByFormula</span><span class="hljs-params">(</span></span><br><span class="hljs-function"><span class="hljs-params">            String formulaString, <span class="hljs-keyword">int</span> naturalRowIndex, <span class="hljs-keyword">int</span> naturalColumnIndex,XSSFDataValidationHelper dvHelper)</span> </span>&#123;<br>        <span class="hljs-comment">// åŠ è½½ä¸‹æ‹‰åˆ—è¡¨å†…å®¹</span><br>        <span class="hljs-comment">// ä¸¾ä¾‹ï¼šè‹¥formulaString = &quot;INDIRECT($A$2)&quot; è¡¨ç¤ºè§„åˆ™æ•°æ®ä¼šä»åç§°ç®¡ç†å™¨ä¸­è·å–keyä¸å•å…ƒæ ¼ A2 å€¼ç›¸åŒçš„æ•°æ®ï¼Œ</span><br>        <span class="hljs-comment">//å¦‚æœA2æ˜¯æ±Ÿè‹çœï¼Œé‚£ä¹ˆæ­¤å¤„å°±æ˜¯æ±Ÿè‹çœä¸‹çš„å¸‚ä¿¡æ¯ã€‚</span><br>        XSSFDataValidationConstraint dvConstraint = (XSSFDataValidationConstraint) dvHelper.createFormulaListConstraint(formulaString);<br>        <span class="hljs-comment">// è®¾ç½®æ•°æ®æœ‰æ•ˆæ€§åŠ è½½åœ¨å“ªä¸ªå•å…ƒæ ¼ä¸Šã€‚</span><br>        <span class="hljs-comment">// å››ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ï¼šèµ·å§‹è¡Œã€ç»ˆæ­¢è¡Œã€èµ·å§‹åˆ—ã€ç»ˆæ­¢åˆ—</span><br>        <span class="hljs-keyword">int</span> firstRow = naturalRowIndex -<span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">int</span> lastRow = naturalRowIndex - <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">int</span> firstCol = naturalColumnIndex - <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">int</span> lastCol = naturalColumnIndex - <span class="hljs-number">1</span>;<br>        CellRangeAddressList regions = <span class="hljs-keyword">new</span> CellRangeAddressList(firstRow,<br>                lastRow, firstCol, lastCol);<br>        <span class="hljs-comment">// æ•°æ®æœ‰æ•ˆæ€§å¯¹è±¡</span><br>        <span class="hljs-comment">// ç»‘å®š</span><br>        XSSFDataValidation data_validation_list = (XSSFDataValidation) dvHelper.createValidation(dvConstraint, regions);<br>        data_validation_list.setEmptyCellAllowed(<span class="hljs-keyword">false</span>);<br>        <span class="hljs-keyword">if</span> (data_validation_list <span class="hljs-keyword">instanceof</span> XSSFDataValidation) &#123;<br>            data_validation_list.setSuppressDropDownArrow(<span class="hljs-keyword">true</span>);<br>            data_validation_list.setShowErrorBox(<span class="hljs-keyword">true</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            data_validation_list.setSuppressDropDownArrow(<span class="hljs-keyword">false</span>);<br>        &#125;<br>        <span class="hljs-comment">// è®¾ç½®è¾“å…¥ä¿¡æ¯æç¤ºä¿¡æ¯</span><br>        data_validation_list.createPromptBox(<span class="hljs-string">&quot;ä¸‹æ‹‰é€‰æ‹©æç¤º&quot;</span>, <span class="hljs-string">&quot;è¯·ä½¿ç”¨ä¸‹æ‹‰æ–¹å¼é€‰æ‹©åˆé€‚çš„å€¼ï¼&quot;</span>);<br>        <span class="hljs-comment">// è®¾ç½®è¾“å…¥é”™è¯¯æç¤ºä¿¡æ¯</span><br>        <span class="hljs-comment">//data_validation_list.createErrorBox(&quot;é€‰æ‹©é”™è¯¯æç¤º&quot;, &quot;ä½ è¾“å…¥çš„å€¼æœªåœ¨å¤‡é€‰åˆ—è¡¨ä¸­ï¼Œè¯·ä¸‹æ‹‰é€‰æ‹©åˆé€‚çš„å€¼ï¼&quot;);</span><br>        <span class="hljs-keyword">return</span> data_validation_list;<br>    &#125;<br> <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     *  è®¡ç®—formula</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> offset åç§»é‡ï¼Œå¦‚æœç»™0ï¼Œè¡¨ç¤ºä»Aåˆ—å¼€å§‹ï¼Œ1ï¼Œå°±æ˜¯ä»Båˆ—</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> rowId ç¬¬å‡ è¡Œ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> colCount ä¸€å…±å¤šå°‘åˆ—</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> å¦‚æœç»™å…¥å‚ 1,1,10. è¡¨ç¤ºä»B1-K1ã€‚æœ€ç»ˆè¿”å› $B$1:$K$1</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">getRange</span><span class="hljs-params">(<span class="hljs-keyword">int</span> offset, <span class="hljs-keyword">int</span> rowId, <span class="hljs-keyword">int</span> colCount)</span> </span>&#123;<br>        <span class="hljs-keyword">char</span> start = (<span class="hljs-keyword">char</span>)(<span class="hljs-string">&#x27;A&#x27;</span> + offset);<br>        <span class="hljs-keyword">if</span> (colCount &lt;= <span class="hljs-number">25</span>) &#123;<br>            <span class="hljs-keyword">char</span> end = (<span class="hljs-keyword">char</span>)(start + colCount - <span class="hljs-number">1</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;$&quot;</span> + start + <span class="hljs-string">&quot;$&quot;</span> + rowId + <span class="hljs-string">&quot;:$&quot;</span> + end + <span class="hljs-string">&quot;$&quot;</span> + rowId;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">char</span> endPrefix = <span class="hljs-string">&#x27;A&#x27;</span>;<br>            <span class="hljs-keyword">char</span> endSuffix = <span class="hljs-string">&#x27;A&#x27;</span>;<br>            <span class="hljs-keyword">if</span> ((colCount - <span class="hljs-number">25</span>) / <span class="hljs-number">26</span> == <span class="hljs-number">0</span> || colCount == <span class="hljs-number">51</span>) &#123;<span class="hljs-comment">// 26-51ä¹‹é—´ï¼ŒåŒ…æ‹¬è¾¹ç•Œï¼ˆä»…ä¸¤æ¬¡å­—æ¯è¡¨è®¡ç®—ï¼‰</span><br>                <span class="hljs-keyword">if</span> ((colCount - <span class="hljs-number">25</span>) % <span class="hljs-number">26</span> == <span class="hljs-number">0</span>) &#123;<span class="hljs-comment">// è¾¹ç•Œå€¼</span><br>                    endSuffix = (<span class="hljs-keyword">char</span>)(<span class="hljs-string">&#x27;A&#x27;</span> + <span class="hljs-number">25</span>);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    endSuffix = (<span class="hljs-keyword">char</span>)(<span class="hljs-string">&#x27;A&#x27;</span> + (colCount - <span class="hljs-number">25</span>) % <span class="hljs-number">26</span> - <span class="hljs-number">1</span>);<br>                &#125;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-comment">// 51ä»¥ä¸Š</span><br>                <span class="hljs-keyword">if</span> ((colCount - <span class="hljs-number">25</span>) % <span class="hljs-number">26</span> == <span class="hljs-number">0</span>) &#123;<br>                    endSuffix = (<span class="hljs-keyword">char</span>)(<span class="hljs-string">&#x27;A&#x27;</span> + <span class="hljs-number">25</span>);<br>                    endPrefix = (<span class="hljs-keyword">char</span>)(endPrefix + (colCount - <span class="hljs-number">25</span>) / <span class="hljs-number">26</span> - <span class="hljs-number">1</span>);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    endSuffix = (<span class="hljs-keyword">char</span>)(<span class="hljs-string">&#x27;A&#x27;</span> + (colCount - <span class="hljs-number">25</span>) % <span class="hljs-number">26</span> - <span class="hljs-number">1</span>);<br>                    endPrefix = (<span class="hljs-keyword">char</span>)(endPrefix + (colCount - <span class="hljs-number">25</span>) / <span class="hljs-number">26</span>);<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;$&quot;</span> + start + <span class="hljs-string">&quot;$&quot;</span> + rowI<br>            d + <span class="hljs-string">&quot;:$&quot;</span> + endPrefix + endSuffix + <span class="hljs-string">&quot;$&quot;</span> + rowId;<br>        &#125;<br>    &#125;<br> <br>&#125;<br> <br></code></pre></td></tr></table></figure><p>æ•ˆæœå›¾å¦‚ä¸‹:<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/small-20210325195718801.png" alt="20200117132617484"></p>]]></content>
    
    
    
    <tags>
      
      <tag>poi</tag>
      
      <tag>äºŒçº§è”åŠ¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Iteratorè¿­ä»£å™¨è§£å†³ä¸ºä½•ç¦æ­¢åœ¨foreachå†…å¢åˆ </title>
    <link href="/blog/2021/03/25/Iterator%E8%BF%AD%E4%BB%A3%E5%99%A8%E8%A7%A3%E5%86%B3%E4%B8%BA%E4%BD%95%E7%A6%81%E6%AD%A2%E5%9C%A8foreach%E5%86%85%E5%A2%9E%E5%88%A0/"/>
    <url>/blog/2021/03/25/Iterator%E8%BF%AD%E4%BB%A3%E5%99%A8%E8%A7%A3%E5%86%B3%E4%B8%BA%E4%BD%95%E7%A6%81%E6%AD%A2%E5%9C%A8foreach%E5%86%85%E5%A2%9E%E5%88%A0/</url>
    
    <content type="html"><![CDATA[<p>è¿­ä»£å™¨çš„åº”ç”¨åœºæ™¯ï¼š</p><p>1ã€å¯¹é›†åˆè¿›è¡Œå¢åŠ åˆ é™¤ï¼Œç¦æ­¢ä½¿ç”¨foreachï¼Œå¾ªç¯çš„åŠ¨æ€æ“ä½œ 2ã€å€’åºéå† 3ã€éå†å¾ªç¯</p><p>æ­¥å…¥æ­£é¢˜ï¼šä¸ºä½•ç¦æ­¢åœ¨foreachå†…è¿›è¡Œå¢åˆ ï¼Ÿ</p><p>å…ˆçœ‹ä¸€ä¸‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *         æ­£ä¾‹ï¼š</span><br><span class="hljs-comment"> *         Iterator&lt;String&gt; iterator = list.iterator();</span><br><span class="hljs-comment"> *         while (iterator.hasNext()) &#123;</span><br><span class="hljs-comment"> *             String item = iterator.next();</span><br><span class="hljs-comment"> *             if (åˆ é™¤å…ƒç´ çš„æ¡ä»¶) &#123;</span><br><span class="hljs-comment"> *                 iterator.remove();</span><br><span class="hljs-comment"> *             &#125;</span><br><span class="hljs-comment"> *         &#125;</span><br><span class="hljs-comment"> *         åä¾‹ï¼š</span><br><span class="hljs-comment"> *         List&lt;String&gt; list = new ArrayList&lt;String&gt;();</span><br><span class="hljs-comment"> *         list.add(&quot;1&quot;);</span><br><span class="hljs-comment"> *         list.add(&quot;2&quot;);</span><br><span class="hljs-comment"> *         for (String item : list) &#123;</span><br><span class="hljs-comment"> *             if (&quot;1&quot;.equals(item)) &#123;</span><br><span class="hljs-comment"> *                 list.remove(item);</span><br><span class="hljs-comment"> *             &#125;</span><br><span class="hljs-comment"> *         &#125;</span><br><span class="hljs-comment"> */</span><br> <br> <br></code></pre></td></tr></table></figure><p>è¿™æ®µä»£ç æ˜¯ï¼Œåœ¨é˜¿é‡Œçš„å¼€å‘æ‰‹å†Œä¸­çš„ä¸€æ®µä»£ç ã€‚</p><p>æˆ‘ä»¬å…ˆçœ‹ä¸‹é¢åœºæ™¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"> <br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * åœºæ™¯ä¸€ï¼šå¯¹é›†åˆè¿›è¡Œåˆ é™¤ï¼Œå¢åŠ ã€forå¾ªç¯</span><br><span class="hljs-comment"> * é”™è¯¯ï¼šè¿™é‡Œä¼šæŠ¥å‡ºæ•°æ®è¶Šç•Œå¼‚å¸¸ï¼Œ</span><br><span class="hljs-comment"> * å› ä¸ºï¼šremoveæ‰ä¸€ä¸ªå…ƒç´ åï¼Œæ•´ä¸ªé•¿åº¦å‘ç”Ÿå˜åŒ–ï¼Œæ‰€ä»¥å‘ç”Ÿå¼‚å¸¸</span><br><span class="hljs-comment"> * æ”¹è¿›ï¼šé‡‡ç”¨forList.size()åŠ¨æ€</span><br><span class="hljs-comment"> */</span><br>List&lt;String&gt; forList = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>forList.add(<span class="hljs-string">&quot;a&quot;</span>);<br>forList.add(<span class="hljs-string">&quot;b&quot;</span>);<br>forList.add(<span class="hljs-string">&quot;c&quot;</span>);<br><span class="hljs-keyword">int</span> length = forList.size();<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; length; i++) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;a&quot;</span>.equals(forList.get(i))) &#123;<br>        forList.remove(i);<br>    &#125;<br>&#125;<br>System.out.println(forList);<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * äº§ç”Ÿæ–°é—®é¢˜ï¼š</span><br><span class="hljs-comment"> * é”™è¯¯ï¼šè¿è¡Œä¾¿ä¼šå‘ç°ï¼šå°†bç§»é™¤ä¸å®Œæ•´ï¼Œ</span><br><span class="hljs-comment"> * å› ä¸ºï¼šåˆ é™¤åæ•´ä¸ªæ¸¸æ ‡å‘ä¸‹ï¼Œæ•°ç»„å‘ä¸Šï¼Œåˆšå¥½ç©ºå‡º1ä¸ªä½ç½®ï¼Œ</span><br><span class="hljs-comment"> * ç´§æ¥ç€çš„ç¬¬äºŒä½æ²¡æœ‰è¿›è¡Œæ¯”å¯¹ï¼Œæ‰€ä»¥äº§ç”Ÿé—®é¢˜</span><br><span class="hljs-comment"> * è§£å†³ï¼šæ•°æ®é•¿åº¦å‡ä¸€ä¸æ¸¸æ ‡ä¿æŒç»Ÿä¸€</span><br><span class="hljs-comment"> */</span><br>List&lt;String&gt; forList1 = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>forList1.add(<span class="hljs-string">&quot;a&quot;</span>);<br>forList1.add(<span class="hljs-string">&quot;b&quot;</span>);<br>forList1.add(<span class="hljs-string">&quot;b&quot;</span>);<br>forList1.add(<span class="hljs-string">&quot;c&quot;</span>);<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; forList1.size(); i++) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;b&quot;</span>.equals(forList1.get(i))) &#123;<br>        forList1.remove(i);<br>        i--;<br>    &#125;<br>&#125;<br>System.out.println(forList1);<br> <br> <br></code></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šä¸ªåœºæ™¯ï¼ŒçŸ¥é“åœ¨forå¾ªç¯å†…ï¼Œä¸ºå•¥ä¸å»ºè®®ç”¨remove/add</p><p>åœ¨foreachå¾ªç¯å†…ï¼Œå†æ¥ç€çœ‹ä¸‹é¢è¿™ä¸ªåœºæ™¯ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs java"> <br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * åœºæ™¯äºŒï¼š</span><br><span class="hljs-comment"> * foreachå¾ªç¯ï¼Œçš„remove/addæ“ä½œ</span><br><span class="hljs-comment"> */</span><br>List&lt;String&gt; forEach = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>forEach.add(<span class="hljs-string">&quot;a&quot;</span>);<br>forEach.add(<span class="hljs-string">&quot;b&quot;</span>);<br>forEach.add(<span class="hljs-string">&quot;c&quot;</span>);<br><span class="hljs-keyword">for</span> (String each : forEach) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;a&quot;</span>.equals(each)) &#123;<br>        forEach.remove(each);<br>    &#125;<br>&#125;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * äº§ç”Ÿçš„å¼‚å¸¸ï¼š</span><br><span class="hljs-comment"> *   Exception in thread &quot;main&quot; java.util.ConcurrentModificationException</span><br><span class="hljs-comment"> *     at java.util.ArrayList$Itr.checkForComodification(ArrayList.java:909)</span><br><span class="hljs-comment"> *     at java.util.ArrayList$Itr.next(ArrayList.java:859)</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æºç ï¼šItrå®ç°äº†Iteratoræ¥å£ï¼ˆåˆ å‡éƒ¨åˆ†ï¼‰</span><br><span class="hljs-comment"> *  private class Itr implements Iterator&lt;E&gt; &#123;</span><br><span class="hljs-comment"> *         <span class="hljs-doctag">@Override</span></span><br><span class="hljs-comment"> *         <span class="hljs-doctag">@SuppressWarnings</span>(&quot;unchecked&quot;)</span><br><span class="hljs-comment"> *         public void forEachRemaining(Consumer&lt;? super E&gt; consumer) &#123;</span><br><span class="hljs-comment"> *             Objects.requireNonNull(consumer);</span><br><span class="hljs-comment"> *             final int size = ArrayList.this.size;</span><br><span class="hljs-comment"> *             int i = cursor;</span><br><span class="hljs-comment"> *             if (i &gt;= size) &#123;</span><br><span class="hljs-comment"> *                 return;</span><br><span class="hljs-comment"> *             &#125;</span><br><span class="hljs-comment"> *             final Object[] elementData = ArrayList.this.elementData;</span><br><span class="hljs-comment"> *             if (i &gt;= elementData.length) &#123;</span><br><span class="hljs-comment"> *                 throw new ConcurrentModificationException();</span><br><span class="hljs-comment"> *             &#125;</span><br><span class="hljs-comment"> *             while (i != size &amp;&amp; modCount == expectedModCount) &#123;</span><br><span class="hljs-comment"> *                 consumer.accept((E) elementData[i++]);</span><br><span class="hljs-comment"> *             &#125;</span><br><span class="hljs-comment"> *             // update once at end of iteration to reduce heap write traffic</span><br><span class="hljs-comment"> *             cursor = i;</span><br><span class="hljs-comment"> *             lastRet = i - 1;</span><br><span class="hljs-comment"> *             checkForComodification();</span><br><span class="hljs-comment"> *         &#125;</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> *          å¦‚æœæœ‰æ›´æ”¹åˆ™æŠ›å‡ºConcurrentModificationExceptionå¼‚å¸¸ï¼Œ</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> *         final void checkForComodification() &#123;</span><br><span class="hljs-comment"> *         ä¹‹å‰çš„ç‰ˆæœ¬ä¸ç­‰äºï¼Œå½“å‰çš„ç‰ˆæœ¬ï¼Œåˆ¤æ–­ä¸ºæ•°æ®æ›´æ–°äº†ã€‚</span><br><span class="hljs-comment"> *         é‚£ä¹ˆï¼Ÿä¸ºä»€ä¹ˆäº§ç”Ÿè¿™æ ·çš„åˆ¤æ–­å‘¢ï¼Œå› ä¸ºä½ åˆ é™¤åå˜ä¸ºæ–°æ•°ç»„ï¼Œæ¥ä¸åŠ</span><br><span class="hljs-comment"> * æ›´æ–°ç‰ˆæœ¬ï¼Œjvmä¸çŸ¥é“ä½ å½“å‰æ•°æ®çŠ¶æ€ï¼Œæ˜¯å¦å˜åŒ–ï¼Œæ— æ³•å†è¿›è¡Œéå†</span><br><span class="hljs-comment"> *             if (modCount != expectedModCount)</span><br><span class="hljs-comment"> *                 throw new ConcurrentModificationException();</span><br><span class="hljs-comment"> *         &#125;</span><br><span class="hljs-comment"> *     &#125;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ”¹è¿›ï¼š</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br>List&lt;String&gt; forEachIterator = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>forEachIterator.add(<span class="hljs-string">&quot;a&quot;</span>);<br>forEachIterator.add(<span class="hljs-string">&quot;b&quot;</span>);<br>forEachIterator.add(<span class="hljs-string">&quot;c&quot;</span>);<br>java.util.Iterator&lt;String&gt; iterator = forEachIterator.iterator();<br><span class="hljs-keyword">while</span> (iterator.hasNext()) &#123;<br>    String next = iterator.next();<br>    <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;a&quot;</span>.equals(next)) &#123;<br>        iterator.remove();<br>    &#125;<br>&#125;<br> <br></code></pre></td></tr></table></figure><p>è¿™é‡Œï¼šforeachå®ç°çš„å°±æ˜¯è¿­ä»£å™¨ã€‚</p><p>è¡¥å……ï¼šå€’åºå¾ªç¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">      * åœºæ™¯ä¸‰ï¼š</span><br><span class="hljs-comment">      * åº”ç”¨ï¼šå€’åºéå†</span><br><span class="hljs-comment">      */</span><br>     List&lt;String&gt; forEachIteratorDown = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>     forEachIteratorDown.add(<span class="hljs-string">&quot;a&quot;</span>);<br>     forEachIteratorDown.add(<span class="hljs-string">&quot;b&quot;</span>);<br>     forEachIteratorDown.add(<span class="hljs-string">&quot;c&quot;</span>);<br>     ListIterator&lt;String&gt; item = forEachIteratorDown.listIterator();<br>     <span class="hljs-comment">//è¿™é‡Œéœ€è¦å…ˆå°†æŒ‡é’ˆç§»å‘æœ€åä¸€ä½ï¼Œå†è¿›è¡Œå€’å™</span><br>     <span class="hljs-keyword">while</span> (item.hasNext()) &#123;<br>         item.next();<br>     &#125;<br>     <span class="hljs-keyword">while</span> (item.hasPrevious()) &#123;<br>         String previous = item.previous();<br>         System.out.println(previous);<br>     &#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Iterator</tag>
      
      <tag>foreach</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æœç´¢ä¸€ä¸ªå­—ç¬¦æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªå­—ç¬¦</title>
    <link href="/blog/2021/03/24/%E6%90%9C%E7%B4%A2%E4%B8%80%E4%B8%AA%E5%AD%97%E7%AC%A6%E6%95%B0%E7%BB%84%E4%B8%AD%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E6%9F%90%E4%B8%AA%E5%AD%97%E7%AC%A6/"/>
    <url>/blog/2021/03/24/%E6%90%9C%E7%B4%A2%E4%B8%80%E4%B8%AA%E5%AD%97%E7%AC%A6%E6%95%B0%E7%BB%84%E4%B8%AD%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E6%9F%90%E4%B8%AA%E5%AD%97%E7%AC%A6/</url>
    
    <content type="html"><![CDATA[<p>è¯·åœ¨ä¸€ä¸ªç±»ä¸­ç¼–å†™ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æœç´¢ä¸€ä¸ªå­—ç¬¦æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªå­—ç¬¦ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™è¿”å›è¿™ä¸ªå­—ç¬¦åœ¨å­—ç¬¦æ•°ç»„ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼ˆåºå·ä»0å¼€å§‹è®¡ç®—ï¼‰ï¼Œå¦åˆ™ï¼Œè¿”å›-1ã€‚è¦æœç´¢çš„å­—ç¬¦æ•°ç»„å’Œå­—ç¬¦éƒ½ä»¥å‚æ•°å½¢å¼ä¼ é€’ä¼ é€’ç»™è¯¥æ–¹æ³•ï¼Œå¦‚æœä¼ å…¥çš„æ•°ç»„ä¸ºnullï¼Œåº”æŠ›å‡ºIllegalArgumentExceptionå¼‚å¸¸ã€‚åœ¨ç±»çš„mainæ–¹æ³•ä¸­ä»¥å„ç§å¯èƒ½å‡ºç°çš„æƒ…å†µæµ‹è¯•éªŒè¯è¯¥æ–¹æ³•ç¼–å†™å¾—æ˜¯å¦æ­£ç¡®ï¼Œä¾‹å¦‚ï¼Œå­—ç¬¦ä¸å­˜åœ¨ï¼Œå­—ç¬¦å­˜åœ¨ï¼Œä¼ å…¥çš„æ•°ç»„ä¸ºnullç­‰ã€‚</p><p>1.åˆ›å»ºä¸€ä¸ªå­—ç¬¦æ•°ç»„ã€‚ 2.æœç´¢è¯¥å­—ç¬¦æ˜¯å¦å­˜åœ¨å­—ç¬¦æ•°ç»„ä¸­ï¼Œç¼–å†™æœç´¢æ–¹æ³•ã€‚ 3.åˆ¤æ–­å­—ç¬¦æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨è¯¥å­—ç¬¦</p><p>1.valueOfï¼šæ–¹æ³•ç”¨äºè¿”å›ç»™å®šå‚æ•°çš„åŸç”Ÿ Number å¯¹è±¡å€¼ã€‚ å¦‚ï¼šchar[] str = { â€˜aâ€™, â€˜bâ€™, â€˜câ€™, â€˜aâ€™ }; String s = String.valueOf(str); // sçš„å€¼æ˜¯ abca 2.indexOfï¼šè¿”å›æŒ‡å®šå­—ç¬¦åœ¨å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€æ¬¡å‡ºç°å¤„çš„ç´¢å¼•ï¼Œå¦‚æœæ­¤å­—ç¬¦ä¸²ä¸­æ²¡æœ‰è¿™æ ·çš„å­—ç¬¦ï¼Œåˆ™è¿”å› -1ã€‚ å¦‚ï¼šs.indexOf(â€œbâ€); // è¡¨ç¤ºï¼šå¦‚æœå­—ç¬¦æ•°ç»„ä¸­å­˜åœ¨bï¼Œåˆ™è¿”å›ç¬¬ä¸€æ¬¡å‡ºç°bçš„ä¸‹æ ‡ç´¢å¼•ï¼Œå¦‚æœæ²¡æœ‰bï¼Œåˆ™è¿”å›-1</p><h2 id="æ–¹å¼ä¸€"><a href="#æ–¹å¼ä¸€" class="headerlink" title="æ–¹å¼ä¸€"></a>æ–¹å¼ä¸€</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.eleven.csdn0110;<br> <br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 1.è¯·åœ¨ä¸€ä¸ªç±»ä¸­ç¼–å†™ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æœç´¢ä¸€ä¸ªå­—ç¬¦æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªå­—ç¬¦ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™è¿”å›è¿™ä¸ªå­—ç¬¦åœ¨å­—ç¬¦æ•°ç»„ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼ˆåºå·ä»0å¼€å§‹è®¡ç®—ï¼‰ï¼Œå¦åˆ™ï¼Œè¿”å›-1ã€‚</span><br><span class="hljs-comment"> * 2.è¦æœç´¢çš„å­—ç¬¦æ•°ç»„å’Œå­—ç¬¦éƒ½ä»¥å‚æ•°å½¢å¼ä¼ é€’ä¼ é€’ç»™è¯¥æ–¹æ³•ï¼Œå¦‚æœä¼ å…¥çš„æ•°ç»„ä¸ºnullï¼Œåº”æŠ›å‡ºIllegalArgumentExceptionå¼‚å¸¸ã€‚</span><br><span class="hljs-comment"> * 3.åœ¨ç±»çš„mainæ–¹æ³•ä¸­ä»¥å„ç§å¯èƒ½å‡ºç°çš„æƒ…å†µæµ‹è¯•éªŒè¯è¯¥æ–¹æ³•ç¼–å†™å¾—æ˜¯å¦æ­£ç¡®ï¼Œä¾‹å¦‚ï¼Œå­—ç¬¦ä¸å­˜åœ¨ï¼Œå­—ç¬¦å­˜åœ¨ï¼Œä¼ å…¥çš„æ•°ç»„ä¸ºnullç­‰ã€‚</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> sywangu</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OneDay</span> </span>&#123;<br> <br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br><span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªå­—ç¬¦æ•°ç»„</span><br><span class="hljs-keyword">char</span>[] str = &#123; <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;-&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span> &#125;;<br><span class="hljs-comment">// æœç´¢è¯¥å­—ç¬¦æ˜¯å¦å­˜åœ¨å­—ç¬¦æ•°ç»„ä¸­</span><br><span class="hljs-keyword">int</span> index = search(str,<span class="hljs-string">&#x27;-&#x27;</span>);<br><span class="hljs-comment">// åˆ¤æ–­å­—ç¬¦æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨è¯¥å­—ç¬¦</span><br><span class="hljs-keyword">if</span> (index == -<span class="hljs-number">1</span>) &#123;<span class="hljs-comment">// indexä¸º-1æ—¶ï¼Œè¡¨ç¤ºå­—ç¬¦ä¸å­˜åœ¨</span><br>System.out.println(<span class="hljs-string">&quot;è¯¥å­—ç¬¦ä¸å­˜åœ¨&quot;</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>System.out.println(<span class="hljs-string">&quot;å­—ç¬¦åœ¨å­—ç¬¦æ•°ç»„ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®&quot;</span> + index);<br>&#125;<br>&#125;<br> <br><span class="hljs-comment">// searchæ–¹æ³•</span><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">search</span><span class="hljs-params">(<span class="hljs-keyword">char</span>[] aStr, <span class="hljs-keyword">char</span> aIndex)</span> </span>&#123;<br><span class="hljs-keyword">int</span> index = -<span class="hljs-number">1</span>;<span class="hljs-comment">// å°†indexçš„å€¼åˆå§‹åŒ–ä¸º-1</span><br><span class="hljs-keyword">if</span> (aStr == <span class="hljs-keyword">null</span>) &#123;<span class="hljs-comment">// å¦‚æœstrå€¼ä¸ºnullï¼Œåˆ™æŠ›å‡ºéæ³•æ•°æ®å¼‚å¸¸</span><br><span class="hljs-keyword">new</span> IllegalArgumentException().printStackTrace();<span class="hljs-comment">// IllegalArgumentExceptionéæ³•æ•°æ®å¼‚å¸¸</span><br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; aStr.length; i++) &#123;<br><span class="hljs-keyword">if</span> (aIndex == aStr[i]) &#123;<span class="hljs-comment">// å¦‚æœå­—ç¬¦æ•°ç»„é‡Œé¢çš„å­—ç¬¦å’Œè¦æœç´¢çš„å­—ç¬¦ä¸€è‡´</span><br>index = i;<span class="hljs-comment">// å°±å°†içš„å€¼èµ‹å€¼ç»™index</span><br><span class="hljs-keyword">break</span>;<span class="hljs-comment">// æ»¡è¶³æ¡ä»¶ï¼Œé€€å‡ºå¾ªç¯</span><br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> index;<span class="hljs-comment">// æ‰“å°indexçš„å€¼</span><br>&#125;<br>&#125;<br> <br></code></pre></td></tr></table></figure><h2 id="æ–¹å¼äºŒ"><a href="#æ–¹å¼äºŒ" class="headerlink" title="æ–¹å¼äºŒ"></a>æ–¹å¼äºŒ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.eleven.test;<br> <br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 1.è¯·åœ¨ä¸€ä¸ªç±»ä¸­ç¼–å†™ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æœç´¢ä¸€ä¸ªå­—ç¬¦æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªå­—ç¬¦ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™è¿”å›è¿™ä¸ªå­—ç¬¦åœ¨å­—ç¬¦æ•°ç»„ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼ˆåºå·ä»0å¼€å§‹è®¡ç®—ï¼‰ï¼Œå¦åˆ™ï¼Œè¿”å›-1ã€‚</span><br><span class="hljs-comment"> * 2.è¦æœç´¢çš„å­—ç¬¦æ•°ç»„å’Œå­—ç¬¦éƒ½ä»¥å‚æ•°å½¢å¼ä¼ é€’ä¼ é€’ç»™è¯¥æ–¹æ³•ï¼Œå¦‚æœä¼ å…¥çš„æ•°ç»„ä¸ºnullï¼Œåº”æŠ›å‡ºIllegalArgumentExceptionå¼‚å¸¸ã€‚</span><br><span class="hljs-comment"> * 3.åœ¨ç±»çš„mainæ–¹æ³•ä¸­ä»¥å„ç§å¯èƒ½å‡ºç°çš„æƒ…å†µæµ‹è¯•éªŒè¯è¯¥æ–¹æ³•ç¼–å†™å¾—æ˜¯å¦æ­£ç¡®ï¼Œä¾‹å¦‚ï¼Œå­—ç¬¦ä¸å­˜åœ¨ï¼Œå­—ç¬¦å­˜åœ¨ï¼Œä¼ å…¥çš„æ•°ç»„ä¸ºnullç­‰ã€‚</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> sywangu</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OneDemoTest</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br><span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªå­—ç¬¦æ•°ç»„</span><br><span class="hljs-keyword">char</span>[] str = &#123; <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span> &#125;;<br><span class="hljs-comment">// // å¦‚æœstrå€¼ä¸ºnullï¼Œåˆ™æŠ›å‡ºéæ³•æ•°æ®å¼‚å¸¸</span><br><span class="hljs-keyword">if</span> (str == <span class="hljs-keyword">null</span>)<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException();<br><span class="hljs-comment">// valueOf() æ–¹æ³•ç”¨äºè¿”å›ç»™å®šå‚æ•°çš„åŸç”Ÿ Number å¯¹è±¡å€¼</span><br>String s = String.valueOf(str); <span class="hljs-comment">// sçš„å€¼æ˜¯ abca</span><br><span class="hljs-comment">// indexOf():è¿”å›æŒ‡å®šå­—ç¬¦åœ¨å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€æ¬¡å‡ºç°å¤„çš„ç´¢å¼•ï¼Œå¦‚æœæ­¤å­—ç¬¦ä¸²ä¸­æ²¡æœ‰è¿™æ ·çš„å­—ç¬¦ï¼Œåˆ™è¿”å› -1ã€‚</span><br>System.out.println(s.indexOf(<span class="hljs-string">&quot;b&quot;</span>));<br>&#125;<br>&#125;<br> <br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>å­—ç¬¦æ•°ç»„</tag>
      
      <tag>åŒ…å«</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaä¸­ä½¿ç”¨å›¾ç‰‡éªŒè¯ç </title>
    <link href="/blog/2021/03/24/Java%E4%B8%AD%E4%BD%BF%E7%94%A8%E5%9B%BE%E7%89%87%E9%AA%8C%E8%AF%81%E7%A0%81/"/>
    <url>/blog/2021/03/24/Java%E4%B8%AD%E4%BD%BF%E7%94%A8%E5%9B%BE%E7%89%87%E9%AA%8C%E8%AF%81%E7%A0%81/</url>
    
    <content type="html"><![CDATA[<h2 id="ç¬¬ä¸€ç§æ–¹å¼"><a href="#ç¬¬ä¸€ç§æ–¹å¼" class="headerlink" title="ç¬¬ä¸€ç§æ–¹å¼"></a>ç¬¬ä¸€ç§æ–¹å¼</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@WebServlet(&quot;/BufferImage&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BufferImage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> WIDTH = <span class="hljs-number">120</span>;<span class="hljs-comment">//ç”Ÿæˆå›¾ç‰‡çš„å®½åº¦</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> HEIGHT = <span class="hljs-number">30</span>;<span class="hljs-comment">//ç”Ÿæˆå›¾ç‰‡çš„é«˜åº¦</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> WORDS_NUMBER = <span class="hljs-number">4</span>;<span class="hljs-comment">//éªŒè¯ç ä¸­å­—ç¬¦çš„ä¸ªæ•°</span><br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        <span class="hljs-comment">// TODO Auto-generated method stub</span><br>        <span class="hljs-keyword">this</span>.doPost(req, resp);<br>    &#125;<br> <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doPost</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>    <br>    req.setCharacterEncoding(<span class="hljs-string">&quot;utf-8&quot;</span>);<br>resp.setContentType(<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>);<br><br>    <span class="hljs-comment">// TODO Auto-generated method stub</span><br>        String createTypeFlag = req.getParameter(<span class="hljs-string">&quot;createTypeFlag&quot;</span>);<span class="hljs-comment">//æ¥æ”¶å®¢æˆ·ç«¯ä¼ é€’çš„createTypeFlagæ ‡è¯†</span><br>        <span class="hljs-comment">//åœ¨å†…å­˜ä¸­åˆ›å»ºä¸€å¼ å›¾ç‰‡</span><br>        BufferedImage bi = <span class="hljs-keyword">new</span> BufferedImage(WIDTH,HEIGHT,BufferedImage.TYPE_3BYTE_BGR);<br>        <span class="hljs-comment">//å¾—åˆ°å›¾ç‰‡</span><br>        Graphics g = bi.getGraphics();<br>        <span class="hljs-comment">//è®¾ç½®å›¾ç‰‡çš„èƒŒæ™¯è‰²</span><br>        setBackGround(g);<br>        <span class="hljs-comment">//è®¾ç½®å›¾ç‰‡çš„è¾¹æ¡†</span><br>        setBorder(g);<br>        <span class="hljs-comment">//åœ¨å›¾ç‰‡ä¸Šç”»å¹²æ‰°çº¿</span><br>        drawRandomLine(g);<br>        <span class="hljs-comment">//åœ¨å›¾ç‰‡ä¸Šæ”¾ä¸Šéšæœºå­—ç¬¦</span><br>        String randomString = <span class="hljs-keyword">this</span>.drawRandomNum((Graphics2D)g, createTypeFlag);<br>        System.out.println(randomString);<br>        <span class="hljs-comment">//å°†éšæœºæ•°å­˜åœ¨sessionä¸­</span><br>        req.getSession().setAttribute(<span class="hljs-string">&quot;checkcode&quot;</span>, randomString);<br>        <br>        <span class="hljs-comment">//è®¾ç½®å“åº”å¤´é€šçŸ¥æµè§ˆå™¨ä»¥å›¾ç‰‡çš„å½¢å¼æ‰“å¼€</span><br>        resp.setContentType(<span class="hljs-string">&quot;image/jpeg&quot;</span>);<br>        <br>        <span class="hljs-comment">//è®¾ç½®å“åº”å¤´æ§åˆ¶æµè§ˆå™¨ä¸è¦ç¼“å­˜</span><br>        resp.setDateHeader(<span class="hljs-string">&quot;expries&quot;</span>, -<span class="hljs-number">1</span>);<br>        resp.setHeader(<span class="hljs-string">&quot;Cache-Control&quot;</span>, <span class="hljs-string">&quot;no-cache&quot;</span>);<br>        resp.setHeader(<span class="hljs-string">&quot;Pragma&quot;</span>, <span class="hljs-string">&quot;no-cache&quot;</span>);<br>        <br>        <span class="hljs-comment">//å°†å›¾ç‰‡ä¼ ç»™æµè§ˆå™¨</span><br>        ImageIO.write(bi, <span class="hljs-string">&quot;jpg&quot;</span>, resp.getOutputStream());<br>    &#125;<br>    <br>    <span class="hljs-comment">//è®¾ç½®å›¾ç‰‡èƒŒæ™¯è‰²</span><br>    <span class="hljs-comment">//@param g</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setBackGround</span><span class="hljs-params">(Graphics g)</span> </span>&#123;<br>        <span class="hljs-comment">//è®¾ç½®é¢œè‰²</span><br>        g.setColor(Color.WHITE);<br>        <span class="hljs-comment">//å¡«å……åŒºåŸŸ</span><br>        g.fillRect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, WIDTH, HEIGHT);<br>    &#125;<br>    <br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">     * è®¾ç½®å›¾ç‰‡çš„è¾¹æ¡†</span><br><span class="hljs-comment">     * @param g</span><br><span class="hljs-comment">     * */</span><br>    <br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setBorder</span><span class="hljs-params">(Graphics g)</span> </span>&#123;<br>        <span class="hljs-comment">//è®¾ç½®è¾¹æ¡†é¢œè‰²</span><br>        g.setColor(Color.BLUE);<br>        <span class="hljs-comment">//è¾¹æ¡†åŒºåŸŸ</span><br>        g.drawRect(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, WIDTH - <span class="hljs-number">2</span>, HEIGHT -<span class="hljs-number">2</span>);<br>    &#125;<br>    <br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">     * åœ¨å›¾ç‰‡ä¸Šç”»éšæœºçº¿æ¡ </span><br><span class="hljs-comment">     * @param g</span><br><span class="hljs-comment">     * */</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">drawRandomLine</span><span class="hljs-params">(Graphics g)</span> </span>&#123;<br>        <span class="hljs-comment">//è®¾ç½®é¢œè‰²</span><br>        g.setColor(Color.GREEN);<br>        <span class="hljs-comment">//è®¾ç½®çº¿æ¡ä¸ªæ•°å¹¶ç”»çº¿</span><br>        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span> ; i &lt; <span class="hljs-number">7</span> ; i++ ) &#123;<br>            <span class="hljs-keyword">int</span> x1 = <span class="hljs-keyword">new</span> Random().nextInt(WIDTH);<br>            <span class="hljs-keyword">int</span> y1 = <span class="hljs-keyword">new</span> Random().nextInt(HEIGHT);<br>            <span class="hljs-keyword">int</span> x2 = <span class="hljs-keyword">new</span> Random().nextInt(WIDTH);<br>            <span class="hljs-keyword">int</span> y2 = <span class="hljs-keyword">new</span> Random().nextInt(HEIGHT);<br>            g.drawLine(x1, y1, x2, y2);<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">     * åœ¨å›¾ç‰‡ä¸Šç”»éšæœºå­—ç¬¦</span><br><span class="hljs-comment">     * @param g</span><br><span class="hljs-comment">     * @param createTypeFlag</span><br><span class="hljs-comment">     * @return String</span><br><span class="hljs-comment">     * */</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">drawRandomNum</span><span class="hljs-params">(Graphics g,String createTypeFlag)</span> </span>&#123;<br>        <span class="hljs-comment">//è®¾ç½®é¢œè‰²</span><br>        g.setColor(Color.BLUE);<br>        g.setFont(<span class="hljs-keyword">new</span> Font(<span class="hljs-string">&quot;å®‹ä½“&quot;</span>,Font.BOLD,<span class="hljs-number">20</span>));<br>        <br>        <span class="hljs-comment">//æ•°å­—å­—æ¯çš„ç»„åˆ</span><br>        String baseNumLetter = <span class="hljs-string">&quot;0123456789ABCDEFGHJKLMNOPQRSTUVWXYZ&quot;</span>;<br>        String baseNum = <span class="hljs-string">&quot;0123456789&quot;</span>;<br>        String baseLetter = <span class="hljs-string">&quot;ABCDEFGHJKLMNOPQRSTUVWXYZ&quot;</span>;<br>        <span class="hljs-keyword">if</span> ( createTypeFlag != <span class="hljs-keyword">null</span>  &amp;&amp; createTypeFlag.length() &gt; <span class="hljs-number">0</span> ) &#123;<br>            <span class="hljs-keyword">if</span>( createTypeFlag.equals(<span class="hljs-string">&quot;nl&quot;</span>) ) &#123;<br>                <span class="hljs-comment">//æˆªå–æ•°å­—å’Œå­—æ¯çš„ç»„åˆ</span><br>                <span class="hljs-keyword">return</span> createRandomChar((Graphics2D) g,baseNumLetter);<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( createTypeFlag.equals(<span class="hljs-string">&quot;n&quot;</span>) ) &#123;<br>                <span class="hljs-comment">//æˆªå–æ•°å­—çš„ç»„åˆ</span><br>                <span class="hljs-keyword">return</span> createRandomChar((Graphics2D) g,baseNum);<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( createTypeFlag.equals(<span class="hljs-string">&quot;l&quot;</span>) ) &#123;<br>                <span class="hljs-comment">//æˆªå–å­—æ¯çš„ç»„åˆ</span><br>                <span class="hljs-keyword">return</span> createRandomChar((Graphics2D) g,baseLetter);<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">//æˆªå–æ•°å­—å’Œå­—æ¯çš„ç»„åˆ</span><br>            <span class="hljs-keyword">return</span> createRandomChar((Graphics2D) g,baseNumLetter);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>    &#125;<br>    <br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">     * åˆ›å»ºéšæœºå­—ç¬¦</span><br><span class="hljs-comment">     * @param g</span><br><span class="hljs-comment">     * @param baseChar</span><br><span class="hljs-comment">     * @return String</span><br><span class="hljs-comment">     * */</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">createRandomChar</span><span class="hljs-params">(Graphics2D g , String baseChar)</span> </span>&#123;<br>        StringBuffer b = <span class="hljs-keyword">new</span> StringBuffer();<br>        <span class="hljs-keyword">int</span> x = <span class="hljs-number">5</span>;<br>        String ch = <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span> ; i &lt; WORDS_NUMBER ; i++ ) &#123;<br>            <span class="hljs-comment">//è®¾ç½®å­—ä½“çš„æ—‹è½¬è§’åº¦</span><br>            <span class="hljs-keyword">int</span> degree = <span class="hljs-keyword">new</span> Random().nextInt() % <span class="hljs-number">30</span>;<br>            ch = baseChar.charAt(<span class="hljs-keyword">new</span> Random().nextInt(baseChar.length())) + <span class="hljs-string">&quot;&quot;</span>;<br>            b.append(ch);<br>            <br>            <span class="hljs-comment">//æ­£å‘è§’åº¦</span><br>            g.rotate(degree  * Math.PI / <span class="hljs-number">180</span> , x,<span class="hljs-number">20</span>);<br>            g.drawString(ch, x, <span class="hljs-number">20</span>);<br>            <span class="hljs-comment">//åå‘è§’åº¦</span><br>            g.rotate(-degree  * Math.PI / <span class="hljs-number">180</span> , x,<span class="hljs-number">20</span>);<br>            x+=<span class="hljs-number">30</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> b.toString();<br>    &#125;<br>&#125;<br> <br></code></pre></td></tr></table></figure><h3 id="åç«¯"><a href="#åç«¯" class="headerlink" title="åç«¯"></a>åç«¯</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">   <span class="hljs-meta">@RequestMapping(value=&quot;/userLogin.do&quot;)</span><br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">userLogin</span><span class="hljs-params">(String code,HttpSession session)</span></span>&#123;<br>String cht=(String)session.getAttribute(<span class="hljs-string">&quot;checkcode&quot;</span>);<br><span class="hljs-keyword">if</span>(code.equalsIgnoreCase(cht))&#123;<br>System.out.println(<span class="hljs-string">&quot;éªŒè¯ç æ­£ç¡®&quot;</span>);<br>&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="å‰ç«¯"><a href="#å‰ç«¯" class="headerlink" title="å‰ç«¯"></a>å‰ç«¯</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;form&gt;<br>&lt;img src=<span class="hljs-string">&quot;BufferImage&quot;</span> Î¿nclick=<span class="hljs-string">&quot;this.src=&#x27;BufferImage?&#x27;+new Date().getTime()&quot;</span>&gt;çœ‹ä¸æ¸…æ¢ä¸€å¼ &lt;br&gt;&lt;br&gt;<br>éªŒè¯ç ï¼š &lt;input type=<span class="hljs-string">&quot;text&quot;</span> id=<span class="hljs-string">&quot;verify&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;input-medium&quot;</span> placeholder=<span class="hljs-string">&quot;éªŒè¯ç &quot;</span>&gt;<br>&lt;input type=<span class="hljs-string">&quot;submit&quot;</span> value=<span class="hljs-string">&quot;æäº¤&quot;</span>&gt;<br>&lt;/form&gt;<br> <br></code></pre></td></tr></table></figure><h2 id="ç¬¬äºŒç§æ–¹å¼ï¼ˆSpring-Bootæ¡†æ¶ä½¿ç”¨ï¼‰"><a href="#ç¬¬äºŒç§æ–¹å¼ï¼ˆSpring-Bootæ¡†æ¶ä½¿ç”¨ï¼‰" class="headerlink" title="ç¬¬äºŒç§æ–¹å¼ï¼ˆSpring Bootæ¡†æ¶ä½¿ç”¨ï¼‰"></a>ç¬¬äºŒç§æ–¹å¼ï¼ˆSpring Bootæ¡†æ¶ä½¿ç”¨ï¼‰</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.zhiyou.util;<br> <br> <br><span class="hljs-keyword">import</span> javax.imageio.ImageIO;<br><span class="hljs-keyword">import</span> java.awt.*;<br><span class="hljs-keyword">import</span> java.awt.image.BufferedImage;<br><span class="hljs-keyword">import</span> java.io.FileOutputStream;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.OutputStream;<br><span class="hljs-keyword">import</span> java.util.Random;<br> <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BufferImage</span> </span>&#123;<br> <br>    <span class="hljs-comment">// éªŒè¯ç å­—ç¬¦é›†</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">char</span>[] chars = &#123;<br>            <span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>, <span class="hljs-string">&#x27;4&#x27;</span>, <span class="hljs-string">&#x27;5&#x27;</span>, <span class="hljs-string">&#x27;6&#x27;</span>, <span class="hljs-string">&#x27;7&#x27;</span>, <span class="hljs-string">&#x27;8&#x27;</span>, <span class="hljs-string">&#x27;9&#x27;</span>,<br>            <span class="hljs-string">&#x27;A&#x27;</span>, <span class="hljs-string">&#x27;B&#x27;</span>, <span class="hljs-string">&#x27;C&#x27;</span>, <span class="hljs-string">&#x27;D&#x27;</span>, <span class="hljs-string">&#x27;E&#x27;</span>, <span class="hljs-string">&#x27;F&#x27;</span>, <span class="hljs-string">&#x27;G&#x27;</span>, <span class="hljs-string">&#x27;H&#x27;</span>, <span class="hljs-string">&#x27;I&#x27;</span>, <span class="hljs-string">&#x27;J&#x27;</span>, <span class="hljs-string">&#x27;K&#x27;</span>, <span class="hljs-string">&#x27;L&#x27;</span>, <span class="hljs-string">&#x27;M&#x27;</span>, <span class="hljs-string">&#x27;N&#x27;</span>,<br>            <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;P&#x27;</span>, <span class="hljs-string">&#x27;Q&#x27;</span>, <span class="hljs-string">&#x27;R&#x27;</span>, <span class="hljs-string">&#x27;S&#x27;</span>, <span class="hljs-string">&#x27;T&#x27;</span>, <span class="hljs-string">&#x27;U&#x27;</span>, <span class="hljs-string">&#x27;V&#x27;</span>, <span class="hljs-string">&#x27;W&#x27;</span>, <span class="hljs-string">&#x27;X&#x27;</span>, <span class="hljs-string">&#x27;Y&#x27;</span>, <span class="hljs-string">&#x27;Z&#x27;</span>&#125;;<br>    <span class="hljs-comment">// å­—ç¬¦æ•°é‡</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> SIZE = <span class="hljs-number">4</span>;<br>    <span class="hljs-comment">// å¹²æ‰°çº¿æ•°é‡</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> LINES = <span class="hljs-number">8</span>;<br>    <span class="hljs-comment">// å®½åº¦</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> WIDTH = <span class="hljs-number">100</span>;<br>    <span class="hljs-comment">// é«˜åº¦</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> HEIGHT = <span class="hljs-number">32</span>;<br>    <span class="hljs-comment">// å­—ä½“å¤§å°</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> FONT_SIZE = <span class="hljs-number">25</span>;<br> <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç”ŸæˆéšæœºéªŒè¯ç åŠå›¾ç‰‡</span><br><span class="hljs-comment">     * æ•°ç»„ä¸­[éªŒè¯ç ï¼Œå›¾ç‰‡]</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object[] createImage() &#123;<br>        StringBuffer sb = <span class="hljs-keyword">new</span> StringBuffer();<br>        <span class="hljs-comment">// 1.åˆ›å»ºç©ºç™½å›¾ç‰‡</span><br>        BufferedImage image = <span class="hljs-keyword">new</span> BufferedImage(<br>                WIDTH, HEIGHT, BufferedImage.TYPE_INT_RGB);<br>        <span class="hljs-comment">// 2.è·å–å›¾ç‰‡ç”»ç¬”</span><br>        Graphics graphic = image.getGraphics();<br>        <span class="hljs-comment">// 3.è®¾ç½®ç”»ç¬”é¢œè‰²</span><br>        graphic.setColor(<span class="hljs-keyword">new</span> Color(<span class="hljs-number">216</span>, <span class="hljs-number">172</span>, <span class="hljs-number">203</span>, <span class="hljs-number">241</span>));<br>        <span class="hljs-comment">// 4.ç»˜åˆ¶çŸ©å½¢èƒŒæ™¯</span><br>        graphic.fillRect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, WIDTH, HEIGHT);<br> <br>        <span class="hljs-comment">// 5.ç”»éšæœºå­—ç¬¦</span><br>        Random ran = <span class="hljs-keyword">new</span> Random();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt;SIZE; i++) &#123;<br>            <span class="hljs-comment">// å–éšæœºå­—ç¬¦ç´¢å¼•</span><br>            <span class="hljs-keyword">int</span> n = ran.nextInt(chars.length);<br>            <span class="hljs-comment">// è®¾ç½®éšæœºé¢œè‰²</span><br>            graphic.setColor(getRandomColor());<br>            <span class="hljs-comment">// è®¾ç½®å­—ä½“å¤§å°</span><br>            graphic.setFont(<span class="hljs-keyword">new</span> Font(<br>                    <span class="hljs-keyword">null</span>, Font.BOLD + Font.ITALIC, FONT_SIZE));<br>            <span class="hljs-comment">// ç”»å­—ç¬¦</span><br>            graphic.drawString(<br>                    chars[n] + <span class="hljs-string">&quot;&quot;</span>, i * WIDTH / SIZE, HEIGHT/<span class="hljs-number">2</span>+HEIGHT/<span class="hljs-number">8</span>);<br>            <span class="hljs-comment">// è®°å½•å­—ç¬¦</span><br>            sb.append(chars[n]);<br>        &#125;<br>        <span class="hljs-comment">// 6.ç”»å¹²æ‰°çº¿</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; LINES; i++) &#123;<br> <br>            graphic.setColor(getRandomColor());<br>            <span class="hljs-comment">// éšæœºç”»çº¿</span><br>            graphic.drawLine(ran.nextInt(WIDTH), ran.nextInt(HEIGHT),<br>                    ran.nextInt(WIDTH), ran.nextInt(HEIGHT));<br>        &#125;<br>        <span class="hljs-comment">// 7.è¿”å›éªŒè¯ç å’Œå›¾ç‰‡</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Object[]&#123;sb.toString(), image&#125;;<br>    &#125;<br> <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * éšæœºå–è‰²</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Color <span class="hljs-title">getRandomColor</span><span class="hljs-params">()</span> </span>&#123;<br>        Random ran = <span class="hljs-keyword">new</span> Random();<br>        Color color = <span class="hljs-keyword">new</span> Color(ran.nextInt(<span class="hljs-number">256</span>),<br>                ran.nextInt(<span class="hljs-number">256</span>), ran.nextInt(<span class="hljs-number">256</span>));<br>        <span class="hljs-keyword">return</span> color;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        Object[] objs = createImage();<br>        BufferedImage image = (BufferedImage) objs[<span class="hljs-number">1</span>];<br>        OutputStream os = <span class="hljs-keyword">new</span> FileOutputStream(<span class="hljs-string">&quot;src/main/resources/static/picture/eb1ccd3d99794795bc99553b0b762e73.gif&quot;</span>);<br>        ImageIO.write(image, <span class="hljs-string">&quot;png&quot;</span>, os);<br>        os.close();<br>    &#125;<br> <br>&#125;<br> <br> <br></code></pre></td></tr></table></figure><h2 id="åå°controller"><a href="#åå°controller" class="headerlink" title="åå°controller"></a>åå°controller</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/* **********************************å›¾ç‰‡éªŒè¯ç ************************************* */</span><br><span class="hljs-meta">@RequestMapping(value = &quot;/BufferImage&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">createImg</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse res)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br><span class="hljs-comment">//1.ç”Ÿæˆéšæœºçš„éªŒè¯ç åŠå›¾ç‰‡</span><br>Object[] objs = BufferImage.createImage();<br><span class="hljs-comment">//2.å°†éªŒè¯ç å­˜å…¥session</span><br>String imgcode = (String) objs[<span class="hljs-number">0</span>];<br>HttpSession session = req.getSession();<br>session.setAttribute(<span class="hljs-string">&quot;checkcode&quot;</span>, imgcode);<br><span class="hljs-comment">//3.å°†å›¾ç‰‡è¾“å‡ºç»™æµè§ˆå™¨</span><br>BufferedImage img = (BufferedImage) objs[<span class="hljs-number">1</span>];<br>res.setContentType(<span class="hljs-string">&quot;image/png&quot;</span>);<br><span class="hljs-comment">//æœåŠ¡å™¨è‡ªåŠ¨åˆ›å»ºè¾“å‡ºæµï¼Œç›®æ ‡æŒ‡å‘æµè§ˆå™¨</span><br>OutputStream os = res.getOutputStream();<br>ImageIO.write(img, <span class="hljs-string">&quot;png&quot;</span>, os);<br>os.close();<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>å›¾ç‰‡éªŒè¯ç </tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>javaå¸¸ç”¨å·¥å…·ç±»</title>
    <link href="/blog/2021/03/24/java%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E7%B1%BB1/"/>
    <url>/blog/2021/03/24/java%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E7%B1%BB1/</url>
    
    <content type="html"><![CDATA[<h2 id="ç»Ÿè®¡æ®µè½ä¸­å‡ºç°æŸä¸€ä¸ªè¯çš„æ¬¡æ•°"><a href="#ç»Ÿè®¡æ®µè½ä¸­å‡ºç°æŸä¸€ä¸ªè¯çš„æ¬¡æ•°" class="headerlink" title="ç»Ÿè®¡æ®µè½ä¸­å‡ºç°æŸä¸€ä¸ªè¯çš„æ¬¡æ•°"></a>ç»Ÿè®¡æ®µè½ä¸­å‡ºç°æŸä¸€ä¸ªè¯çš„æ¬¡æ•°</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">wordCount</span><span class="hljs-params">()</span></span>&#123;<br>    Scanner scanner = <span class="hljs-keyword">new</span> Scanner(System.in);<br>    <span class="hljs-keyword">int</span> count = <span class="hljs-number">0</span>,index = <span class="hljs-number">0</span>;<br>    System.out.println(<span class="hljs-string">&quot;è¯·è¾“å…¥å¥å­ï¼š&quot;</span>);<br>    String s = scanner.nextLine();<br>    System.out.println(<span class="hljs-string">&quot;è¯·è¾“å…¥è¦æŸ¥è¯¢çš„è¯ï¼š&quot;</span>);<br>    String card = scanner.next();<br>    <span class="hljs-keyword">while</span> ((index = s.indexOf(card,index)) != -<span class="hljs-number">1</span>)&#123;<br>        index = index + card.length();<br>        count++;<br>    &#125;<br>    System.out.println(card + <span class="hljs-string">&quot;åœ¨å¥å­ä¸­å‡ºç°äº†&quot;</span>+ count + <span class="hljs-string">&quot;æ¬¡&quot;</span>);<br>&#125;<br> <br></code></pre></td></tr></table></figure><h2 id="ä¸€ä¸ªéšæœºå­—ç¬¦ä¸²ï¼Œåˆ¤æ–­æœ‰å¤šå°‘å­—æ¯æœ‰å¤šå°‘æ•°å­—"><a href="#ä¸€ä¸ªéšæœºå­—ç¬¦ä¸²ï¼Œåˆ¤æ–­æœ‰å¤šå°‘å­—æ¯æœ‰å¤šå°‘æ•°å­—" class="headerlink" title="ä¸€ä¸ªéšæœºå­—ç¬¦ä¸²ï¼Œåˆ¤æ–­æœ‰å¤šå°‘å­—æ¯æœ‰å¤šå°‘æ•°å­—"></a>ä¸€ä¸ªéšæœºå­—ç¬¦ä¸²ï¼Œåˆ¤æ–­æœ‰å¤šå°‘å­—æ¯æœ‰å¤šå°‘æ•°å­—</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">letterAndnum</span><span class="hljs-params">()</span></span>&#123;<br>    Scanner scanner = <span class="hljs-keyword">new</span> Scanner(System.in);<br>    System.out.println(<span class="hljs-string">&quot;è¯·è¾“å…¥éšæœºå­—ç¬¦ä¸²ï¼š&quot;</span>);<br>    String s = scanner.nextLine();<br>    <span class="hljs-keyword">int</span> length = s.length();<br>    <span class="hljs-keyword">int</span> num = <span class="hljs-number">0</span>,let = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; length; i++)&#123;<br>        <span class="hljs-keyword">if</span> (Character.isDigit(s.charAt(i)))&#123;<br>            num++;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (Character.isLetter(s.charAt(i)))&#123;<br>            let++;<br>        &#125;<br>    &#125;<br>    System.out.println(<span class="hljs-string">&quot;æ•°å­—ï¼š&quot;</span>+num+<span class="hljs-string">&quot;   å­—æ¯ï¼š&quot;</span>+let);<br>&#125;<br> <br></code></pre></td></tr></table></figure><h2 id="æ ¹æ®ç‰¹å®šæ—¥æœŸæ ¼å¼æ‹†åˆ†æ—¥æœŸ"><a href="#æ ¹æ®ç‰¹å®šæ—¥æœŸæ ¼å¼æ‹†åˆ†æ—¥æœŸ" class="headerlink" title="æ ¹æ®ç‰¹å®šæ—¥æœŸæ ¼å¼æ‹†åˆ†æ—¥æœŸ"></a>æ ¹æ®ç‰¹å®šæ—¥æœŸæ ¼å¼æ‹†åˆ†æ—¥æœŸ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å¦‚ï¼šè¯·è¾“å…¥ä¸€ä¸ªæ—¥æœŸï¼ˆæ ¼å¼å¦‚ï¼š**æœˆ**æ—¥****å¹´ï¼‰ç»è¿‡å¤„ç†å¾—åˆ°ï¼š ****å¹´**æœˆ**æ—¥</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">splitDate</span><span class="hljs-params">()</span></span>&#123;<br>    Scanner scanner = <span class="hljs-keyword">new</span> Scanner(System.in);<br>    System.out.println(<span class="hljs-string">&quot;è¯·è¾“å…¥æ—¥æœŸï¼šï¼ˆæ ¼å¼å¦‚ï¼š**æœˆ**æ—¥****å¹´ï¼‰&quot;</span>);<br>    String s = scanner.nextLine();<br>    <span class="hljs-keyword">int</span> i = s.indexOf(<span class="hljs-string">&quot;æ—¥&quot;</span>);<br>    String substring = s.substring(i + <span class="hljs-number">1</span>);<br>    String substring1 = s.substring(<span class="hljs-number">0</span>, i + <span class="hljs-number">1</span>);<br>    System.out.println(substring + substring1);<br>&#125;<br> <br></code></pre></td></tr></table></figure><h2 id="æ•æ„Ÿè¯è¿‡æ»¤ç¨‹åº"><a href="#æ•æ„Ÿè¯è¿‡æ»¤ç¨‹åº" class="headerlink" title="æ•æ„Ÿè¯è¿‡æ»¤ç¨‹åº"></a>æ•æ„Ÿè¯è¿‡æ»¤ç¨‹åº</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">fitterWords</span><span class="hljs-params">()</span></span>&#123;<br>    Scanner scanner = <span class="hljs-keyword">new</span> Scanner(System.in);<br>    System.out.println(<span class="hljs-string">&quot;è¯·è¾“å…¥èŠå¤©å†…å®¹ï¼š&quot;</span>);<br>    String str = scanner.nextLine();<br>    String ch[] = &#123;<span class="hljs-string">&quot;è‰²æƒ…&quot;</span>,<span class="hljs-string">&quot;çˆ†ç‚¸&quot;</span>,<span class="hljs-string">&quot;ææ€–&quot;</span>,<span class="hljs-string">&quot;å†›ç«&quot;</span>&#125;;<br>    <span class="hljs-keyword">for</span> (String s:ch) &#123;<br>        str = str.replaceAll(s,<span class="hljs-string">&quot;*&quot;</span>);<br>    &#125;<br>    System.out.println(<span class="hljs-string">&quot;èŠå¤©å†…å®¹ï¼š&quot;</span>+str);<br>&#125;<br> <br></code></pre></td></tr></table></figure><h2 id="è®¡ç®—æŸå¹´ã€æŸæœˆã€æŸæ—¥å’ŒæŸå¹´ã€æŸæœˆã€æŸæ—¥ä¹‹é—´çš„å¤©æ•°é—´éš”å’Œå‘¨æ•°"><a href="#è®¡ç®—æŸå¹´ã€æŸæœˆã€æŸæ—¥å’ŒæŸå¹´ã€æŸæœˆã€æŸæ—¥ä¹‹é—´çš„å¤©æ•°é—´éš”å’Œå‘¨æ•°" class="headerlink" title="è®¡ç®—æŸå¹´ã€æŸæœˆã€æŸæ—¥å’ŒæŸå¹´ã€æŸæœˆã€æŸæ—¥ä¹‹é—´çš„å¤©æ•°é—´éš”å’Œå‘¨æ•°"></a>è®¡ç®—æŸå¹´ã€æŸæœˆã€æŸæ—¥å’ŒæŸå¹´ã€æŸæœˆã€æŸæ—¥ä¹‹é—´çš„å¤©æ•°é—´éš”å’Œå‘¨æ•°</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">leadTime</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> ParseException </span>&#123;<br>    Scanner scanner = <span class="hljs-keyword">new</span> Scanner(System.in);<br>    System.out.println(<span class="hljs-string">&quot;è¯·è¾“å…¥ç¬¬ä¸€ä¸ªæ—¥æœŸï¼š&quot;</span>);<br>    String str = scanner.nextLine();<br>    System.out.println(<span class="hljs-string">&quot;è¯·è¾“å…¥ç¬¬äºŒä¸ªæ—¥æœŸï¼š&quot;</span>);<br>    String str2 = scanner.nextLine();<br>    SimpleDateFormat dateFormat = <span class="hljs-keyword">new</span> SimpleDateFormat(<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>);<br>    Date parse = dateFormat.parse(str);<br>    Date parse1 = dateFormat.parse(str2);<br>    <span class="hljs-keyword">long</span> a = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span> (parse.after(parse1))&#123;<br>        a = parse.getTime() - parse1.getTime();<br>    &#125;<span class="hljs-keyword">else</span> &#123;<br>        a = parse1.getTime() - parse.getTime();<br>    &#125;<br>    <span class="hljs-keyword">long</span> oneDay = <span class="hljs-number">1000</span>*<span class="hljs-number">60</span>*<span class="hljs-number">60</span>*<span class="hljs-number">24</span>;<br>    <span class="hljs-keyword">long</span> day = a/oneDay;<br>    <span class="hljs-keyword">long</span> week = day/<span class="hljs-number">7</span>;<br>    System.out.println(<span class="hljs-string">&quot;ç›¸éš”ï¼š&quot;</span>+day+<span class="hljs-string">&quot; å¤©&quot;</span>);<br>    System.out.println(<span class="hljs-string">&quot;ç›¸éš”ï¼š&quot;</span>+week+<span class="hljs-string">&quot; å‘¨&quot;</span>);<br>&#125;<br> <br></code></pre></td></tr></table></figure><h2 id="è®¾å®šä¸€ä¸ªæœ‰å¤§å°å†™å­—æ¯çš„å­—ç¬¦ä¸²ï¼Œå…ˆå°†å­—ç¬¦ä¸²çš„å¤§å†™å­—ç¬¦è¾“å‡ºï¼Œå†å°†å­—ç¬¦ä¸²ä¸­çš„å°å†™å­—ç¬¦è¾“å‡º"><a href="#è®¾å®šä¸€ä¸ªæœ‰å¤§å°å†™å­—æ¯çš„å­—ç¬¦ä¸²ï¼Œå…ˆå°†å­—ç¬¦ä¸²çš„å¤§å†™å­—ç¬¦è¾“å‡ºï¼Œå†å°†å­—ç¬¦ä¸²ä¸­çš„å°å†™å­—ç¬¦è¾“å‡º" class="headerlink" title="è®¾å®šä¸€ä¸ªæœ‰å¤§å°å†™å­—æ¯çš„å­—ç¬¦ä¸²ï¼Œå…ˆå°†å­—ç¬¦ä¸²çš„å¤§å†™å­—ç¬¦è¾“å‡ºï¼Œå†å°†å­—ç¬¦ä¸²ä¸­çš„å°å†™å­—ç¬¦è¾“å‡º"></a>è®¾å®šä¸€ä¸ªæœ‰å¤§å°å†™å­—æ¯çš„å­—ç¬¦ä¸²ï¼Œå…ˆå°†å­—ç¬¦ä¸²çš„å¤§å†™å­—ç¬¦è¾“å‡ºï¼Œå†å°†å­—ç¬¦ä¸²ä¸­çš„å°å†™å­—ç¬¦è¾“å‡º</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">letterUpperLower</span><span class="hljs-params">()</span></span>&#123;<br>    Scanner scanner = <span class="hljs-keyword">new</span> Scanner(System.in);<br>    System.out.println(<span class="hljs-string">&quot;è¯·è¾“å…¥å­—ç¬¦ä¸²ï¼š&quot;</span>);<br>    String str = scanner.nextLine();<br>    <span class="hljs-keyword">char</span>[] chars = str.toCharArray();<br>    System.out.println(<span class="hljs-string">&quot;å¤§å†™å­—æ¯ä¸ºï¼š&quot;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">char</span> a:chars) &#123;<br>        <span class="hljs-keyword">if</span> (Character.isUpperCase(a))&#123;<br>            System.out.println(a);<br>        &#125;<br>    &#125;<br>    System.out.println(<span class="hljs-string">&quot;å°å†™å­—æ¯ä¸ºï¼š&quot;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">char</span> a:chars) &#123;<br>        <span class="hljs-keyword">if</span> (Character.isLowerCase(a))&#123;<br>            System.out.println(a);<br>        &#125;<br>    &#125;<br>&#125;<br> <br></code></pre></td></tr></table></figure><h2 id="è®¡ç®—å¹¶è¾“å‡º21ä¸–çºªçš„é—°å¹´ï¼Œç¨‹åºçš„æ‰§è¡Œæ—¶é—´"><a href="#è®¡ç®—å¹¶è¾“å‡º21ä¸–çºªçš„é—°å¹´ï¼Œç¨‹åºçš„æ‰§è¡Œæ—¶é—´" class="headerlink" title="è®¡ç®—å¹¶è¾“å‡º21ä¸–çºªçš„é—°å¹´ï¼Œç¨‹åºçš„æ‰§è¡Œæ—¶é—´"></a>è®¡ç®—å¹¶è¾“å‡º21ä¸–çºªçš„é—°å¹´ï¼Œç¨‹åºçš„æ‰§è¡Œæ—¶é—´</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">leapYeay21</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">long</span> start = System.currentTimeMillis();<br>    GregorianCalendar calendar = <span class="hljs-keyword">new</span> GregorianCalendar();<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">2000</span>;i&lt;<span class="hljs-number">2100</span>;i++)&#123;<br>        <span class="hljs-keyword">if</span> (calendar.isLeapYear(i))&#123;<br>            System.out.println(i + <span class="hljs-string">&quot;æ˜¯é—°å¹´&quot;</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">long</span> end = System.currentTimeMillis();<br>    System.out.println(<span class="hljs-string">&quot;ç¨‹åºçš„æ‰§è¡Œæ—¶é—´ä¸ºï¼š&quot;</span>+(end - start)+<span class="hljs-string">&quot;æ¯«ç§’&quot;</span>);<br>&#125;<br> <br></code></pre></td></tr></table></figure><h2 id="å½“ä»¥yyyy-MM-ddæ ¼å¼è¾“å…¥ä¸€ä¸ªæ—¥æœŸæ—¶ï¼Œè¾“å‡ºå…¶è¯¥å¹´æ˜¯å¦ä¸ºé—°å¹´ï¼Œè¯¥æœˆæœ‰å‡ å¤©ï¼Œè¯¥æ—¥æ˜¯æ˜ŸæœŸå‡ "><a href="#å½“ä»¥yyyy-MM-ddæ ¼å¼è¾“å…¥ä¸€ä¸ªæ—¥æœŸæ—¶ï¼Œè¾“å‡ºå…¶è¯¥å¹´æ˜¯å¦ä¸ºé—°å¹´ï¼Œè¯¥æœˆæœ‰å‡ å¤©ï¼Œè¯¥æ—¥æ˜¯æ˜ŸæœŸå‡ " class="headerlink" title="å½“ä»¥yyyy-MM-ddæ ¼å¼è¾“å…¥ä¸€ä¸ªæ—¥æœŸæ—¶ï¼Œè¾“å‡ºå…¶è¯¥å¹´æ˜¯å¦ä¸ºé—°å¹´ï¼Œè¯¥æœˆæœ‰å‡ å¤©ï¼Œè¯¥æ—¥æ˜¯æ˜ŸæœŸå‡ "></a>å½“ä»¥yyyy-MM-ddæ ¼å¼è¾“å…¥ä¸€ä¸ªæ—¥æœŸæ—¶ï¼Œè¾“å‡ºå…¶è¯¥å¹´æ˜¯å¦ä¸ºé—°å¹´ï¼Œè¯¥æœˆæœ‰å‡ å¤©ï¼Œè¯¥æ—¥æ˜¯æ˜ŸæœŸå‡ </h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">isLeapYeay</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> ParseException </span>&#123;<br>    Scanner scanner = <span class="hljs-keyword">new</span> Scanner(System.in);<br>    System.out.println(<span class="hljs-string">&quot;è¯·è¾“å…¥æ—¥æœŸï¼š(æ ¼å¼ï¼šyyyy-MM-dd)&quot;</span>);<br>    String str = scanner.nextLine();<br>    SimpleDateFormat dateFormat = <span class="hljs-keyword">new</span> SimpleDateFormat(<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>);<br>    Date parse = dateFormat.parse(str);<br>    Calendar instance = Calendar.getInstance();<br>    instance.setTime(parse);<br>    <span class="hljs-keyword">int</span> year = instance.get(Calendar.YEAR);<br>    <span class="hljs-keyword">int</span> month = instance.get(Calendar.MONTH)+<span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">int</span> week = instance.get(Calendar.DAY_OF_WEEK)-<span class="hljs-number">1</span>;<br>    GregorianCalendar calendar = <span class="hljs-keyword">new</span> GregorianCalendar();<br>    <span class="hljs-keyword">if</span> (calendar.isLeapYear(year))&#123;<br>        System.out.println(year + <span class="hljs-string">&quot;æ˜¯é—°å¹´&quot;</span>);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        System.out.println(year + <span class="hljs-string">&quot;æ˜¯å¹³å¹´&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">int</span> max = instance.getActualMaximum(Calendar.DAY_OF_MONTH);<br>    String s = week == <span class="hljs-number">0</span>?<span class="hljs-string">&quot;å‘¨æ—¥&quot;</span>:<span class="hljs-string">&quot;å‘¨&quot;</span>+week;<br>    System.out.println(month + <span class="hljs-string">&quot;æœˆæœ‰&quot;</span> + max + <span class="hljs-string">&quot;æ—¥ï¼Œè¯¥æ—¥æ˜¯&quot;</span> + s);<br>&#125;<br> <br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>å·¥å…·ç±»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>jspå®ç°è½®æ’­å›¾</title>
    <link href="/blog/2021/03/24/jsp%E5%AE%9E%E7%8E%B0%E8%BD%AE%E6%92%AD%E5%9B%BE/"/>
    <url>/blog/2021/03/24/jsp%E5%AE%9E%E7%8E%B0%E8%BD%AE%E6%92%AD%E5%9B%BE/</url>
    
    <content type="html"><![CDATA[<p><strong>èƒŒæ™¯</strong> æ”¯æŒieè€ç‰ˆæœ¬æ²¡åŠæ³•ä½¿ç”¨æ¯”è¾ƒæ–°çš„æ¡†æ¶,åªèƒ½ä½¿ç”¨åŸå§‹jså®ç°ã€‚ <a href="https://cuixiaoyande.oss-cn-shanghai.aliyuncs.com/shufflingFigure.gif">æ¼”ç¤ºåœ°å€</a> å®ç°åŠŸèƒ½å¦‚ä¸‹:</p><ol><li>é¼ æ ‡æ”¾åœ¨å›¾ä¸Šæš‚åœã€‚</li><li>ç‚¹å‡»ä¸‹é¢åœ†ç‚¹åˆ‡æ¢å›¾ç‰‡ã€‚</li><li>ç‚¹å‡»å·¦å³ç®­å¤´åˆ‡æ¢ã€‚</li><li>è‡ªåŠ¨è¿›è¡Œè½®æ’­ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;%@ page language=<span class="hljs-string">&quot;java&quot;</span> <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.util.*&quot;</span> contentType=<span class="hljs-string">&quot;text/html; charset=UTF-8&quot;</span> pageEncoding=<span class="hljs-string">&quot;UTF-8&quot;</span> %&gt;<br>&lt;%<span class="hljs-meta">@include</span> file=<span class="hljs-string">&quot;/context/mytags.jsp&quot;</span> %&gt;<br>&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>    &lt;title&gt;å•†å“ä¿¡æ¯æŸ¥çœ‹&lt;/title&gt;<br>    &lt;style&gt;<br>        .ui-button &#123;<br>            display: inline-block;<br>            padding: 2px 2px;<br>            margin-bottom: <span class="hljs-number">0</span>;<br>            font-size: 8px;<br>            font-weight: normal;<br>            line-height: <span class="hljs-number">1.42857143</span>;<br>            text-align: center;<br>            white-space: nowrap;<br>            vertical-align: middle;<br>            -ms-touch-action: manipulation;<br>            touch-action: manipulation;<br>            cursor: pointer;<br>            -webkit-user-select: none;<br>            -moz-user-select: none;<br>            -ms-user-select: none;<br>            user-select: none;<br>            background-image: none;<br>            border: 1px solid transparent;<br>            border-radius: 4px;<br>        &#125;<br> <br>        body &#123;<br>            overflow: scroll;<br>        &#125;<br> <br>        <span class="hljs-comment">/* è½®æ’­å›¾æ ·å¼è¡¨ */</span><br> <br>        #content #carousel_wrap &#123;<br>            position: relative;<br>            margin: <span class="hljs-number">0</span> auto;<br>            width: <span class="hljs-number">100</span>%; <span class="hljs-comment">/* è½®æ’­å›¾å®½åº¦ */</span><br>            overflow: hidden;<br>        &#125;<br> <br>        #content #carousel_wrap #carousel_images &#123;<br>            position: absolute;<br>            border: <span class="hljs-number">0</span>;<br>            outline: none;<br>            white-space: nowrap; <span class="hljs-comment">/* å°†å›¾ç‰‡ä¸€è¡Œæ’åˆ— */</span><br>            width: <span class="hljs-number">100</span>%;<br>            font-size: <span class="hljs-number">0</span>; <span class="hljs-comment">/* æ¸…é™¤white-spaceé—´éš™ */</span><br>            margin: 0px;<br>        &#125;<br> <br>        #content #carousel_wrap #carousel_images img &#123;<br>            width: <span class="hljs-number">100</span>%;<br>        &#125;<br> <br>        #content #carousel_wrap .arrow &#123;<br>            position: absolute;<br>            font-weight: bold;<br>            font-size: 50px;<br>            color: lightgray;<br>            top: <span class="hljs-number">50</span>%;<br>            transform: translateY(-<span class="hljs-number">50</span>%);<br>            cursor: pointer;<br>            transition-property: opacity;<br>            transition-duration: <span class="hljs-number">0.</span>5s;<br>        &#125;<br> <br>        #content #carousel_wrap .arrow:hover &#123;<br>            opacity: <span class="hljs-number">0.5</span>;<br>        &#125;<br> <br>        #content #carousel_wrap .left-arrow &#123;<br>            left: 20px;<br>        &#125;<br> <br>        #content #carousel_wrap .right-arrow &#123;<br>            right: 20px;<br>        &#125;<br> <br>        #content #carousel_wrap #dots &#123;<br>            position: absolute;<br>            bottom: 20px;<br>            left: <span class="hljs-number">50</span>%;<br>            transform: translateX(-<span class="hljs-number">50</span>%)<br>        &#125;<br> <br>        #content #carousel_wrap .dot &#123;<br>            background-color: white;<br>            display: inline-block;<br>            width: 10px;<br>            height: 10px;<br>            border-radius: <span class="hljs-number">50</span>%;<br>            margin: 4px;<br>            opacity: <span class="hljs-number">0.2</span>;<br>            cursor: pointer;<br>        &#125;<br> <br>        #content #carousel_wrap .active &#123;<br>            opacity: <span class="hljs-number">1</span>;<br>        &#125;<br> <br>        .transition &#123;<br>            transition-property: left;<br>            transition-duration: 1s;<br>        &#125;<br> <br>        <span class="hljs-comment">/* END è½®æ’­å›¾æ ·å¼è¡¨ */</span><br> <br> <br>    &lt;/style&gt;<br> <br><span class="hljs-comment">/* è¿™é‡Œå¼•å…¥è‡ªå·±jqueryå°±è¡Œ */</span><br>    &lt;t:base type=&quot;jquery,easyui,tools,DatePicker&quot;&gt;&lt;/t:base&gt;<br>    &lt;script type=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;<br>        $(document).ready(function () &#123;<br>            $(<span class="hljs-string">&#x27;#tt&#x27;</span>).tabs(&#123;<br>                onSelect: function (title) &#123;<br>                    $(<span class="hljs-string">&#x27;#tt .panel-body&#x27;</span>).css(<span class="hljs-string">&#x27;width&#x27;</span>, <span class="hljs-string">&#x27;auto&#x27;</span>);<br>                &#125;<br>            &#125;);<br>            $(<span class="hljs-string">&quot;.tabs-wrap&quot;</span>).css(<span class="hljs-string">&#x27;width&#x27;</span>, <span class="hljs-string">&#x27;100%&#x27;</span>);<br>        &#125;);<br>    &lt;/script&gt;<br> <br> <br> <br> <br>&lt;/head&gt;<br> <br>&lt;body&gt;<br> <br>&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br> <br>&lt;head&gt;<br>    &lt;meta charset=<span class="hljs-string">&quot;utf-8&quot;</span>/&gt;<br>    &lt;title&gt;Lifeblog.com&lt;/title&gt;<br>    &lt;script type=&quot;text/javascript&quot; src=&quot;js/friends.js&quot;&gt;&lt;/script&gt;<br>    &lt;link rel=<span class="hljs-string">&quot;stylesheet&quot;</span> type=<span class="hljs-string">&quot;text/css&quot;</span> href=<span class="hljs-string">&quot;css/friends.css&quot;</span>/&gt;<br>&lt;/head&gt;<br> <br>&lt;body&gt;<br> <br> <br>&lt;!-- è½®æ’­å›¾ --&gt;<br>&lt;div id=<span class="hljs-string">&quot;content&quot;</span>&gt;<br>    &lt;div id=<span class="hljs-string">&quot;carousel_wrap&quot;</span>&gt;<br>        &lt;div id=<span class="hljs-string">&quot;carousel_images&quot;</span>&gt;<br>            &lt;!-- å‰ååˆ†åˆ«åŠ ä¸Šä¸€å¼ å›¾ç‰‡ï¼Œæ–¹ä¾¿æ— ç¼è¿‡æ¸¡æ˜¾ç¤ºã€‚å¯ä»¥ä½¿ç”¨JS DOMå¢åŠ èŠ‚ç‚¹æ“ä½œçœå»è¯¥æ­¥éª¤ --&gt;<br>            &lt;img src=<span class="hljs-string">&quot; &quot;</span> width=<span class="hljs-string">&#x27;675&#x27;</span> height=<span class="hljs-string">&#x27;380&#x27;</span> id=<span class="hljs-string">&quot;first&quot;</span>&gt;<br>            &lt;img src=<span class="hljs-string">&quot; &quot;</span> width=<span class="hljs-string">&#x27;675&#x27;</span> height=<span class="hljs-string">&#x27;380&#x27;</span> id=<span class="hljs-string">&quot;worst&quot;</span>&gt;<br>        &lt;/div&gt;<br>        &lt;span class=&quot;arrow left-arrow&quot;&gt;&amp;lt;&lt;/span&gt;<br>        &lt;span class=&quot;arrow right-arrow&quot;&gt;&amp;gt;&lt;/span&gt;<br>        &lt;div id=<span class="hljs-string">&quot;dots&quot;</span>&gt;<br>            &lt;!-- ä½¿ç”¨å°ç‚¹æ ‡è®°å®é™…å¤šå°‘å¼ å›¾ç‰‡ï¼Œè¦æ·»åŠ å›¾ç‰‡æ—¶éœ€è¦ä¿®æ”¹carousel_imageså’Œæ­¤å¤„ --&gt;<br>            &lt;span class=&quot;dot active&quot;&gt;&lt;/span&gt;<br>            &lt;%--&lt;span class=&quot;dot&quot;&gt;&lt;/span&gt;--%&gt;<br>            &lt;%--&lt;span class=&quot;dot&quot;&gt;&lt;/span&gt;--%&gt;<br> <br>        &lt;/div&gt;<br>    &lt;/div&gt;<br> <br>&lt;/div&gt;<br>&lt;!-- END è½®æ’­å›¾ --&gt;<br> <br> <br>&lt;/body&gt;<br>&lt;/html&gt;<br> <br>&lt;script&gt;<br>    window.onload = function () &#123;<br><span class="hljs-comment">//åŠ¨æ€ä»åå°è·å–å›¾ç‰‡</span><br>        <span class="hljs-keyword">var</span> url = <span class="hljs-string">&#x27;lpaArticlesController.do?getFiles&#x27;</span>;<br>        url += <span class="hljs-string">&#x27;&amp;id=&#x27;</span> + <span class="hljs-string">&#x27;$&#123;id&#125;&#x27;</span>;<br>        $.ajax(&#123;<br>            url: url,<br>            type: <span class="hljs-string">&#x27;post&#x27;</span>,<br>            cache: <span class="hljs-keyword">false</span>,<br>            success: function (data) &#123;<br>                <span class="hljs-keyword">var</span> d = $.parseJSON(data);<br>                console.log(d.obj);<br>                <span class="hljs-keyword">if</span> (d.obj.length &gt; <span class="hljs-number">1</span>) &#123;<br>                    <span class="hljs-comment">//å¢åŠ å›¾ç‰‡</span><br>                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; d.obj.length; i++) &#123;<br>                        $(<span class="hljs-string">&quot;#carousel_images&quot;</span>).append(<span class="hljs-string">&quot;&lt;img width=&#x27;675&#x27; height=&#x27;380&#x27; src=&quot;</span> + d.obj[i].path + <span class="hljs-string">&quot; &gt;&quot;</span>);<br>                        <span class="hljs-keyword">if</span> (i == <span class="hljs-number">0</span>) &#123;<br>                            $(<span class="hljs-string">&quot;#first&quot;</span>).attr(<span class="hljs-string">&quot;src&quot;</span>, d.obj[<span class="hljs-number">0</span>].path);<br>                        &#125; <span class="hljs-keyword">else</span> &#123;<br>                            $(<span class="hljs-string">&quot;#worst&quot;</span>).attr(<span class="hljs-string">&quot;src&quot;</span>, d.obj[d.obj.length - <span class="hljs-number">1</span>].path);<br>                        &#125;<br>                    &#125;<br>                    <span class="hljs-comment">//å¢åŠ å°åœ†ç‚¹</span><br>                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; d.obj.length - <span class="hljs-number">1</span>; i++) &#123;<br>                        $(<span class="hljs-string">&quot;#dots&quot;</span>).append(<span class="hljs-string">&quot;&lt;span class=&#x27;dot&#x27;&gt;&lt;/span&gt;&quot;</span>);<br>                    &#125;<br>                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (d.obj.length == <span class="hljs-number">1</span>) &#123;<br>                    <span class="hljs-comment">//å¦‚æœåªæœ‰ä¸€å¼ å›¾ç‰‡ ä¸éœ€è¦åŠ åœ†ç‚¹</span><br>                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; d.obj.length; i++) &#123;<br>                        $(<span class="hljs-string">&quot;#first&quot;</span>).attr(<span class="hljs-string">&quot;src&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);<br>                        $(<span class="hljs-string">&quot;#worst&quot;</span>).attr(<span class="hljs-string">&quot;src&quot;</span>, d.obj[<span class="hljs-number">0</span>].path);<br>                        $(<span class="hljs-string">&quot;#carousel_images&quot;</span>).append(<span class="hljs-string">&quot;&lt;img width=&#x27;675&#x27; height=&#x27;380&#x27; src=&quot;</span> + d.obj[i].path + <span class="hljs-string">&quot; &gt;&quot;</span>);<br>                    &#125;<br> <br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-comment">//æ²¡æœ‰å›¾ç‰‡çš„æ—¶å€™ å»ºè®®æ”¾ä¸€å¼ ç©ºç™½å›¾</span><br>                    $(<span class="hljs-string">&quot;#first&quot;</span>).attr(<span class="hljs-string">&quot;src&quot;</span>, <span class="hljs-string">&quot;webpage/main/img/noPictures.jpg&quot;</span>);<br>                    $(<span class="hljs-string">&quot;#worst&quot;</span>).attr(<span class="hljs-string">&quot;src&quot;</span>, <span class="hljs-string">&quot;webpage/main/img/noPictures.jpg&quot;</span>);<br>                    $(<span class="hljs-string">&quot;#carousel_images&quot;</span>).append(<span class="hljs-string">&quot;&lt;img width=&#x27;675&#x27; height=&#x27;380&#x27; src=&#x27;webpage/main/img/noPictures.jpg&#x27; &gt;&quot;</span>);<br> <br>                &#125;<br> <br> <br>                <span class="hljs-keyword">var</span> carouImg = document.getElementById(<span class="hljs-string">&quot;carousel_images&quot;</span>);<br>                <span class="hljs-keyword">var</span> carouWrap = document.getElementById(<span class="hljs-string">&quot;carousel_wrap&quot;</span>);<br>                <span class="hljs-keyword">var</span> img = carouImg.getElementsByTagName(<span class="hljs-string">&quot;img&quot;</span>)[<span class="hljs-number">0</span>];<br>                <span class="hljs-keyword">var</span> leftArrow = document.getElementsByClassName(<span class="hljs-string">&quot;left-arrow&quot;</span>)[<span class="hljs-number">0</span>];<br>                <span class="hljs-keyword">var</span> rightArrow = document.getElementsByClassName(<span class="hljs-string">&quot;right-arrow&quot;</span>)[<span class="hljs-number">0</span>];<br>                <span class="hljs-keyword">var</span> oBtn = document.getElementsByClassName(<span class="hljs-string">&quot;dot&quot;</span>);<br>                <span class="hljs-keyword">var</span> index = <span class="hljs-number">0</span>;<br>                <span class="hljs-comment">//è®¾ç½®å›¾ç‰‡ä¸‹é¢å°ç‚¹ä¸ªæ•°</span><br>                <span class="hljs-keyword">var</span> index_length = d.obj.length;<br>                <span class="hljs-comment">// var index_length = oBtn.length;</span><br> <br>                <span class="hljs-comment">// ç»™å›¾ç‰‡æ·»åŠ è¿‡æ¸¡æ•ˆæœ</span><br>                carouImg.classList.add(<span class="hljs-string">&quot;transition&quot;</span>);<br> <br>                <span class="hljs-comment">// åŠ¨æ€è·å–ç»å¯¹å®šä½è½®æ’­å›¾çš„é«˜åº¦ï¼Œè®¾ç½®carousel_wrapçš„é«˜åº¦ï¼Œå®½åº¦ä¸ºæ•´ä¸ªmainå®½åº¦</span><br>                <span class="hljs-comment">// å¦‚æœmystyle.cssä¸­ä½¿ç”¨overflow:auto-&gt;å«æœ‰æ»šåŠ¨æ¡å®½åº¦; æ•…ä½¿ç”¨overflow:scroll</span><br>                carouImg.style.left = -img.clientWidth + <span class="hljs-string">&quot;px&quot;</span>;<br>                carouWrap.style.height = img.offsetHeight + <span class="hljs-string">&quot;px&quot;</span>;<br> <br>                <span class="hljs-comment">// ç›‘å¬bodyå¤§å°å˜åŒ–ï¼Œä¿®æ”¹è½®æ’­å›¾çš„å›¾ç‰‡ä½ç½®å’Œé«˜åº¦</span><br>                document.body.onresize = function () &#123;<br>                    carouImg.style.left = -img.clientWidth + <span class="hljs-string">&quot;px&quot;</span>;<br>                    carouWrap.style.height = img.offsetHeight + <span class="hljs-string">&quot;px&quot;</span>;<br>                &#125;<br> <br>                <span class="hljs-comment">// ç‚¹å‡»å³ç®­å¤´</span><br>                rightArrow.onclick = function () &#123;<br>                    next_pic();<br>                    showCurrentDot(index);<br>                &#125;<br> <br>                <span class="hljs-comment">// ç‚¹å‡»å·¦ç®­å¤´</span><br>                leftArrow.onclick = function () &#123;<br>                    pre_pic();<br>                    showCurrentDot(index);<br>                &#125;<br> <br>                <span class="hljs-comment">// ç‚¹å‡»å°ç‚¹</span><br>                <span class="hljs-keyword">for</span> (let i = <span class="hljs-number">0</span>; i &lt; oBtn.length; ++i) &#123;<br>                    oBtn[i].onclick = function () &#123;<br>                        <span class="hljs-keyword">var</span> newLeft = (-img.clientWidth) * (i + <span class="hljs-number">1</span>);<br>                        carouImg.style.left = newLeft + <span class="hljs-string">&#x27;px&#x27;</span>;<br>                        console.log(i);<br>                        showCurrentDot(i);<br> <br> <br>                        <span class="hljs-keyword">var</span> left = parseInt(carouImg.style.left);<br>                        <span class="hljs-keyword">var</span> newLeft;<br> <br>                        <span class="hljs-comment">// å¦‚æœæ²¡æœ‰ä¸´ç•Œåˆ¤æ–­ï¼Œå½“å›¾ç‰‡ä½äºâ€œæ›¿è¡¥å›¾ç‰‡â€æ—¶ï¼Œç‚¹å‡»æç¤ºç‚¹ä¼šæœ‰é”™ä¹±è¿‡æ¸¡</span><br>                        <span class="hljs-keyword">if</span> (left &lt;= (-img.clientWidth) * (index_length + <span class="hljs-number">1</span>)) &#123;<br>                            <span class="hljs-comment">// ä¸´ç•Œæƒ…å†µåˆ¤æ–­</span><br>                            carouImg.classList.remove(<span class="hljs-string">&quot;transition&quot;</span>);<br>                            newLeft = -img.clientWidth * <span class="hljs-number">1</span>;<br>                            carouImg.style.left = newLeft + <span class="hljs-string">&#x27;px&#x27;</span>;<br>                        &#125;<br>                        <span class="hljs-keyword">if</span> (left &gt;= -<span class="hljs-number">10</span>) &#123;<br>                            <span class="hljs-comment">// ä¸´ç•Œæƒ…å†µåˆ¤æ–­</span><br>                            carouImg.classList.remove(<span class="hljs-string">&quot;transition&quot;</span>);<br>                            newLeft = -img.clientWidth * index_length;<br>                            carouImg.style.left = newLeft + <span class="hljs-string">&#x27;px&#x27;</span>;<br>                        &#125;<br> <br>                        newLeft = (-img.clientWidth) * (i + <span class="hljs-number">1</span>);<br>                        carouImg.style.left = newLeft + <span class="hljs-string">&#x27;px&#x27;</span>;<br>                        <span class="hljs-comment">// æ³¨æ„clickäº‹ä»¶çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œè¦åœ¨ä¿®æ”¹å®Œleftåæ·»åŠ transitionç±»</span><br>                        carouImg.classList.add(<span class="hljs-string">&quot;transition&quot;</span>);<br>                        index = i;<br>                        showCurrentDot(i);<br> <br>                    &#125;<br>                &#125;<br> <br>                <span class="hljs-comment">// ä¸‹ä¸€å¼ å›¾ç‰‡</span><br>                <span class="hljs-function">function <span class="hljs-title">next_pic</span><span class="hljs-params">()</span> </span>&#123;<br>                    <span class="hljs-keyword">var</span> left = parseInt(carouImg.style.left);<br>                    <span class="hljs-keyword">if</span> (left &lt;= (-img.clientWidth) * (index_length + <span class="hljs-number">1</span>)) &#123;<br>                        <span class="hljs-comment">// ä¸´ç•Œæƒ…å†µåˆ¤æ–­</span><br>                        carouImg.classList.remove(<span class="hljs-string">&quot;transition&quot;</span>);<br>                        <span class="hljs-keyword">var</span> newLeft = -img.clientWidth * <span class="hljs-number">1</span>;<br>                        carouImg.style.left = newLeft + <span class="hljs-string">&#x27;px&#x27;</span>;<br>                        newLeft = -img.clientWidth * <span class="hljs-number">2</span>;<br>                        carouImg.classList.add(<span class="hljs-string">&quot;transition&quot;</span>);<br>                        index = <span class="hljs-number">1</span>;<br>                    &#125;<br>                    <span class="hljs-keyword">else</span> &#123;<br>                        <span class="hljs-comment">// ä¸€èˆ¬æƒ…å†µ</span><br>                        <span class="hljs-keyword">var</span> newLeft = parseInt(carouImg.style.left) - img.clientWidth;<br>                        (index == (index_length - <span class="hljs-number">1</span>)) ? index = <span class="hljs-number">0</span> : index += <span class="hljs-number">1</span>;<br>                    &#125;<br>                    carouImg.style.left = newLeft + <span class="hljs-string">&#x27;px&#x27;</span>; <span class="hljs-comment">// ä¸è¦å¿˜è®°æ·»åŠ &#x27;px&#x27;</span><br>                &#125;<br> <br>                <span class="hljs-comment">// ä¸Šä¸€å¼ å›¾ç‰‡</span><br>                <span class="hljs-function">function <span class="hljs-title">pre_pic</span><span class="hljs-params">()</span> </span>&#123;<br>                    <span class="hljs-keyword">var</span> left = parseInt(carouImg.style.left);<br>                    <span class="hljs-keyword">if</span> (left &gt;= -<span class="hljs-number">10</span>) &#123;<br>                        <span class="hljs-comment">// ä¸´ç•Œæƒ…å†µåˆ¤æ–­</span><br>                        carouImg.classList.remove(<span class="hljs-string">&quot;transition&quot;</span>);<br>                        <span class="hljs-keyword">var</span> newLeft = -img.clientWidth * index_length;<br>                        carouImg.style.left = newLeft + <span class="hljs-string">&#x27;px&#x27;</span>;<br>                        newLeft = -img.clientWidth * (index_length - <span class="hljs-number">1</span>);<br>                        carouImg.classList.add(<span class="hljs-string">&quot;transition&quot;</span>);<br>                        index = index_length - <span class="hljs-number">2</span>;<br>                    &#125;<br>                    <span class="hljs-keyword">else</span> &#123;<br>                        <span class="hljs-comment">// ä¸€èˆ¬æƒ…å†µ</span><br>                        <span class="hljs-keyword">var</span> newLeft = parseInt(carouImg.style.left) + img.clientWidth;<br>                        (index == <span class="hljs-number">0</span>) ? index = (index_length - <span class="hljs-number">1</span>) : index -= <span class="hljs-number">1</span>;<br>                    &#125;<br>                    carouImg.style.left = newLeft + <span class="hljs-string">&#x27;px&#x27;</span>;<br>                &#125;<br> <br>                <span class="hljs-function">function <span class="hljs-title">showCurrentDot</span><span class="hljs-params">(index)</span> </span>&#123;<br>                    <span class="hljs-keyword">for</span> (let i = <span class="hljs-number">0</span>; i &lt; oBtn.length; ++i) &#123;<br>                        (i == index) ? oBtn[i].classList.add(<span class="hljs-string">&quot;active&quot;</span>) : oBtn[i].classList.remove(<span class="hljs-string">&quot;active&quot;</span>);<br>                    &#125;<br>                &#125;<br> <br>                <span class="hljs-comment">// è®¾ç½®è½®æ’­å®šæ—¶å™¨ 3ç§’</span><br>                <span class="hljs-keyword">var</span> timer = setInterval(function () &#123;<br>                    next_pic();<br>                    showCurrentDot(index);<br>                &#125;, <span class="hljs-number">3000</span>);<br> <br>                carouWrap.onmouseover = function () &#123;<br>                    clearInterval(timer);<br>                &#125;<br> <br>                carouWrap.onmouseout = function () &#123;<br>                    timer = setInterval(function () &#123;<br>                        next_pic();<br>                        showCurrentDot(index);<br>                    &#125;, <span class="hljs-number">3000</span>);<br>                &#125;<br> <br>            &#125;<br>        &#125;);<br> <br>    &#125;<br> <br>&lt;/script&gt;<br> <br>&lt;/body&gt;<br> <br> <br> <br> <br> <br> <br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>jsp</tag>
      
      <tag>è½®æ’­å›¾</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>forEachåœ¨é›†åˆä¸­çš„ä½¿ç”¨</title>
    <link href="/blog/2021/03/24/forEach%E5%9C%A8%E9%9B%86%E5%90%88%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <url>/blog/2021/03/24/forEach%E5%9C%A8%E9%9B%86%E5%90%88%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="è¿­ä»£é›†åˆ"><a href="#è¿­ä»£é›†åˆ" class="headerlink" title="è¿­ä»£é›†åˆ"></a>è¿­ä»£é›†åˆ</h2><p>ä»»ä½•ç±»å‹Collectionçš„å¯è¿­ä»£ - åˆ—è¡¨ï¼Œé›†åˆï¼Œé˜Ÿåˆ— ç­‰éƒ½å…·æœ‰ä½¿ç”¨forEachçš„ç›¸åŒè¯­æ³•ã€‚</p><p>å› æ­¤ï¼Œæ­£å¦‚æˆ‘ä»¬å·²ç»çœ‹åˆ°çš„ï¼Œè¿­ä»£åˆ—è¡¨çš„å…ƒç´ ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;String&gt; names = Arrays.asList(<span class="hljs-string">&quot;Larry&quot;</span>, <span class="hljs-string">&quot;Steve&quot;</span>, <span class="hljs-string">&quot;James&quot;</span>);<br> <br>names.forEach(System.out::println);<br></code></pre></td></tr></table></figure><p>åŒæ ·å¯¹äºä¸€ç»„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">Set&lt;String&gt; uniqueNames = <span class="hljs-keyword">new</span> HashSet&lt;&gt;(Arrays.asList(<span class="hljs-string">&quot;Larry&quot;</span>, <span class="hljs-string">&quot;Steve&quot;</span>, <span class="hljs-string">&quot;James&quot;</span>));<br> <br>uniqueNames.forEach(System.out::println);<br></code></pre></td></tr></table></figure><p>æˆ–è€…è®©æˆ‘ä»¬è¯´ä¸€ä¸ªé˜Ÿåˆ—ä¹Ÿæ˜¯ä¸€ä¸ªé›†åˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">Queue&lt;String&gt; namesQueue = <span class="hljs-keyword">new</span> ArrayDeque&lt;&gt;(Arrays.asList(<span class="hljs-string">&quot;Larry&quot;</span>, <span class="hljs-string">&quot;Steve&quot;</span>, <span class="hljs-string">&quot;James&quot;</span>));<br> <br>namesQueue.forEach(System.out::println);<br></code></pre></td></tr></table></figure><p>è¿­ä»£Map - ä½¿ç”¨Mapçš„forEach Mapæ²¡æœ‰å®ç°Iterableæ¥å£ï¼Œä½†å®ƒæä¾›äº†è‡ªå·±çš„forEach å˜ä½“ï¼Œå®ƒæ¥å—BiConsumerã€‚*</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">Map&lt;Integer, String&gt; namesMap = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br>namesMap.put(<span class="hljs-number">1</span>, <span class="hljs-string">&quot;Larry&quot;</span>);<br>namesMap.put(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;Steve&quot;</span>);<br>namesMap.put(<span class="hljs-number">3</span>, <span class="hljs-string">&quot;James&quot;</span>);<br>namesMap.forEach((key, value) -&gt; System.out.println(key + <span class="hljs-string">&quot; &quot;</span> + value));<br></code></pre></td></tr></table></figure><p>è¿­ä»£ä¸€ä¸ªMap - é€šè¿‡è¿­ä»£entrySet</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">namesMap.entrySet().forEach(entry -&gt; System.out.println(entry.getKey() + <span class="hljs-string">&quot; &quot;</span> + entry.getValue()));<br> <br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>forEach</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/blog/2021/03/24/jsp%E5%AE%9E%E7%8E%B0%E8%BD%AE%E6%92%AD%E5%9B%BE1/"/>
    <url>/blog/2021/03/24/jsp%E5%AE%9E%E7%8E%B0%E8%BD%AE%E6%92%AD%E5%9B%BE1/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Java8ä¸­å¼•å…¥çš„forEach</title>
    <link href="/blog/2021/03/23/Java8%E4%B8%AD%E5%BC%95%E5%85%A5%E7%9A%84forEach/"/>
    <url>/blog/2021/03/23/Java8%E4%B8%AD%E5%BC%95%E5%85%A5%E7%9A%84forEach/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>åœ¨Java 8ä¸­å¼•å…¥çš„forEachå¾ªç¯ä¸ºç¨‹åºå‘˜æä¾›äº†ä¸€ç§æ–°çš„ï¼Œç®€æ´è€Œæœ‰è¶£çš„è¿­ä»£é›†åˆçš„æ–¹å¼ã€‚</p><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•å°†forEachä¸é›†åˆä¸€èµ·ä½¿ç”¨ï¼Œå®ƒé‡‡ç”¨ä½•ç§å‚æ•°ä»¥åŠæ­¤å¾ªç¯ä¸å¢å¼ºçš„forå¾ªç¯çš„ä¸åŒä¹‹å¤„ã€‚</p><h2 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Collection</span>&lt;<span class="hljs-title">E</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">Iterable</span>&lt;<span class="hljs-title">E</span>&gt;</span><br><span class="hljs-class"> </span><br><span class="hljs-class"></span><br></code></pre></td></tr></table></figure><p>Collection æ¥å£å®ç°äº† Iterable æ¥å£ï¼Œè€Œ Iterable æ¥å£åœ¨ Java 8å¼€å§‹å…·æœ‰ä¸€ä¸ªæ–°çš„ APIï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">forEach</span><span class="hljs-params">(Consumer&lt;? <span class="hljs-keyword">super</span> T&gt; action)</span><span class="hljs-comment">//å¯¹ Iterableçš„æ¯ä¸ªå…ƒç´ æ‰§è¡Œç»™å®šçš„æ“ä½œï¼Œç›´åˆ°æ‰€æœ‰å…ƒç´ éƒ½è¢«å¤„ç†æˆ–åŠ¨ä½œå¼•å‘å¼‚å¸¸ã€‚</span></span><br><span class="hljs-function"> </span><br><span class="hljs-function"></span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨forEachï¼Œæˆ‘ä»¬å¯ä»¥è¿­ä»£ä¸€ä¸ªé›†åˆå¹¶å¯¹æ¯ä¸ªå…ƒç´ æ‰§è¡Œç»™å®šçš„æ“ä½œï¼Œå°±åƒä»»ä½•å…¶ä»–è¿­ä»£å™¨ä¸€æ ·ã€‚</p><p>ä¾‹å¦‚ï¼Œè¿­ä»£å’Œæ‰“å°å­—ç¬¦ä¸²é›†åˆçš„forå¾ªç¯ç‰ˆæœ¬ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">for</span> (String name : names) &#123;<br>    System.out.println(name);<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨forEachå†™è¿™ä¸ª ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">names.forEach(name -&gt; &#123;<br>    System.out.println(name);<br>&#125;);<br></code></pre></td></tr></table></figure><h2 id="åŒ¿åç±»"><a href="#åŒ¿åç±»" class="headerlink" title="åŒ¿åç±»"></a>åŒ¿åç±»</h2><p>æˆ‘ä»¬ä½¿ç”¨ forEachè¿­ä»£é›†åˆå¹¶å¯¹æ¯ä¸ªå…ƒç´ æ‰§è¡Œç‰¹å®šæ“ä½œã€‚è¦æ‰§è¡Œçš„æ“ä½œåŒ…å«åœ¨å®ç°Consumeræ¥å£çš„ç±»ä¸­ï¼Œå¹¶ä½œä¸ºå‚æ•°ä¼ é€’ç»™forEach ã€‚</p><p>æ‰€è¿°æ¶ˆè´¹è€…æ¥å£æ˜¯ä¸€ä¸ªåŠŸèƒ½æ¥å£(å…·æœ‰å•ä¸ªæŠ½è±¡æ–¹æ³•çš„æ¥å£ï¼‰ã€‚å®ƒæ¥å—è¾“å…¥å¹¶ä¸”ä¸è¿”å›ä»»ä½•ç»“æœã€‚</p><p>Consumer æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@FunctionalInterface</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Consumer</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">accept</span><span class="hljs-params">(T t)</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»»ä½•å®ç°ï¼Œä¾‹å¦‚ï¼Œåªæ˜¯æ‰“å°å­—ç¬¦ä¸²çš„æ¶ˆè´¹è€…ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">Consumer&lt;String&gt; printConsumer = <span class="hljs-keyword">new</span> Consumer&lt;String&gt;() &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">accept</span><span class="hljs-params">(String name)</span> </span>&#123;<br>        System.out.println(name);<br>    &#125;;<br>&#125;;<br></code></pre></td></tr></table></figure><p>å¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™forEachï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">names.forEach(printConsumer);<br> <br></code></pre></td></tr></table></figure><p>ä½†è¿™ä¸æ˜¯é€šè¿‡æ¶ˆè´¹è€…å’Œä½¿ç”¨forEach API åˆ›å»ºæ“ä½œçš„å”¯ä¸€æ–¹æ³•ã€‚è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬å°†ä½¿ç”¨forEachæ–¹æ³•çš„å¦å¤–2ç§æœ€æµè¡Œçš„æ–¹å¼ï¼š</p><h2 id="Lambdaè¡¨è¾¾å¼"><a href="#Lambdaè¡¨è¾¾å¼" class="headerlink" title="Lambdaè¡¨è¾¾å¼"></a>Lambdaè¡¨è¾¾å¼</h2><p>Java 8åŠŸèƒ½æ¥å£çš„ä¸»è¦ä¼˜ç‚¹æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Lambdaè¡¨è¾¾å¼æ¥å®ä¾‹åŒ–å®ƒä»¬ï¼Œå¹¶é¿å…ä½¿ç”¨åºå¤§çš„åŒ¿åç±»å®ç°ã€‚</p><p>ç”±äº Consumer æ¥å£å±äºå‡½æ•°å¼æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å½¢å¼åœ¨Lambdaä¸­è¡¨è¾¾å®ƒï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">(argument) -&gt; &#123; body &#125;<br>name -&gt; System.out.println(name)<br>names.forEach(name -&gt; System.out.println(name));<br></code></pre></td></tr></table></figure><p>æ–¹æ³•å‚è€ƒ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ–¹æ³•å¼•ç”¨è¯­æ³•è€Œä¸æ˜¯æ™®é€šçš„Lambdaè¯­æ³•ï¼Œå…¶ä¸­å·²å­˜åœ¨ä¸€ä¸ªæ–¹æ³•æ¥å¯¹ç±»æ‰§è¡Œæ“ä½œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">names.forEach(System.out::println);<br> <br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Java8</tag>
      
      <tag>forEach</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>javaç”ŸæˆäºŒç»´ç </title>
    <link href="/blog/2021/03/23/java%E7%94%9F%E6%88%90%E4%BA%8C%E7%BB%B4%E7%A0%81/"/>
    <url>/blog/2021/03/23/java%E7%94%9F%E6%88%90%E4%BA%8C%E7%BB%B4%E7%A0%81/</url>
    
    <content type="html"><![CDATA[<p>ä½¿ç”¨å¼€æºçš„ä¸€ç»´/äºŒç»´ç å›¾å½¢å¤„ç†åº“zxing <a href="https://github.com/zxing/zxing">GayHubåœ°å€</a></p><h2 id="å¼•å…¥ä¾èµ–"><a href="#å¼•å…¥ä¾èµ–" class="headerlink" title="å¼•å…¥ä¾èµ–"></a>å¼•å…¥ä¾èµ–</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;!-- https:<span class="hljs-comment">//mvnrepository.com/artifact/com.google.zxing/core --&gt;</span><br>&lt;dependency&gt;<br>    &lt;groupId&gt;com.google.zxing&lt;/groupId&gt;<br>    &lt;artifactId&gt;core&lt;/artifactId&gt;<br>    &lt;version&gt;3.3.0&lt;/version&gt;<br>&lt;/dependency&gt;<br>&lt;!-- https:<span class="hljs-comment">//mvnrepository.com/artifact/com.google.zxing/javase --&gt;</span><br>&lt;dependency&gt;<br>    &lt;groupId&gt;com.google.zxing&lt;/groupId&gt;<br>    &lt;artifactId&gt;javase&lt;/artifactId&gt;<br>    &lt;version&gt;3.3.0&lt;/version&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure><h2 id="å°è£…å·¥å…·ç±»"><a href="#å°è£…å·¥å…·ç±»" class="headerlink" title="å°è£…å·¥å…·ç±»"></a>å°è£…å·¥å…·ç±»</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.app.utils;<br> <br><span class="hljs-keyword">import</span> java.awt.Color;<br><span class="hljs-keyword">import</span> java.awt.Graphics2D;<br><span class="hljs-keyword">import</span> java.awt.image.BufferedImage;<br><span class="hljs-keyword">import</span> java.io.File;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br> <br><span class="hljs-keyword">import</span> javax.imageio.ImageIO;<br><span class="hljs-keyword">import</span> com.google.zxing.BarcodeFormat;<br><span class="hljs-keyword">import</span> com.google.zxing.EncodeHintType;<br><span class="hljs-keyword">import</span> com.google.zxing.MultiFormatWriter;<br><span class="hljs-keyword">import</span> com.google.zxing.client.j2se.MatrixToImageConfig;<br><span class="hljs-keyword">import</span> com.google.zxing.client.j2se.MatrixToImageWriter;<br><span class="hljs-keyword">import</span> com.google.zxing.common.BitMatrix;<br><span class="hljs-keyword">import</span> com.google.zxing.qrcode.decoder.ErrorCorrectionLevel;<br> <br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@title</span> ç”ŸæˆäºŒç»´ç å·¥å…·ç±»</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> zch</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@discribtion</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Date</span> 2020å¹´1æœˆ3æ—¥ ä¸‹åˆ4:26:05</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@vision</span> V1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QRCodeUtil</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> width = <span class="hljs-number">200</span>; <span class="hljs-comment">// å›¾åƒå®½åº¦</span><br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> height = <span class="hljs-number">200</span>; <span class="hljs-comment">// å›¾åƒé«˜åº¦</span><br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> ON_COLOR = <span class="hljs-number">0xFF000001</span>;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> OFF_COLOR = <span class="hljs-number">0xFFFFFFFF</span>;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@title</span> ç”ŸæˆäºŒç»´ç å›¾ç‰‡</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@discribtion</span></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@author</span> zch</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@Date</span> 2020å¹´1æœˆ3æ—¥ ä¸‹åˆ3:27:21</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> width äºŒç»´ç å®½åº¦ï¼Œé»˜è®¤ä¸º200</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> height äºŒç»´ç é«˜åº¦ï¼Œé»˜è®¤ä¸º200</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> content äºŒç»´ç å†…å®¹ï¼Œå¿…å¡«</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> logoPath logoå›¾ç‰‡è·¯å¾„ï¼Œè‹¥ä¸ºç©ºåˆ™ç”Ÿæˆä¸å¸¦logoçš„äºŒç»´ç </span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> imgPath ç”ŸæˆäºŒç»´ç æ–‡ä»¶å¤¹è·¯å¾„</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> imgName ç”ŸæˆäºŒç»´ç å›¾ç‰‡åç§°ï¼Œå¿…å¡«</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> suffix ç”ŸæˆäºŒç»´ç å›¾ç‰‡åç¼€ç±»å‹ï¼Œä¾‹å¦‚ï¼šgifï¼Œå¿…å¡«</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@vision</span> V1.0</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">generateQRImage</span><span class="hljs-params">(Integer width, Integer height, String content, String logoPath, String imgPath, String imgName, String suffix)</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span> (content == <span class="hljs-keyword">null</span> || imgName == <span class="hljs-keyword">null</span> || suffix == <span class="hljs-keyword">null</span>)<br>        &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br>        <span class="hljs-keyword">try</span><br>        &#123;<br>            width = width == <span class="hljs-keyword">null</span> ? QRCodeUtil.width : width;<br>            height = height == <span class="hljs-keyword">null</span> ? QRCodeUtil.height : height;<br>            <span class="hljs-keyword">if</span> (logoPath != <span class="hljs-keyword">null</span> &amp;&amp; !<span class="hljs-string">&quot;&quot;</span>.equals(logoPath.trim()))<br>            &#123;<br>                QREncode(width, height, content, logoPath, imgPath, imgName, suffix);<br>            &#125;<br>            <span class="hljs-keyword">else</span><br>            &#123;<br>                QREncode(width, height, content, imgPath, imgName, suffix);<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>        &#125;<br>        <span class="hljs-keyword">catch</span> (Exception e)<br>        &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@title</span> ç”ŸæˆäºŒç»´ç </span><br><span class="hljs-comment">     * <span class="hljs-doctag">@discribtion</span></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@author</span> zch</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@Date</span> 2020å¹´1æœˆ3æ—¥ ä¸‹åˆ3:27:21</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@vision</span> V1.0</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">QREncode</span><span class="hljs-params">(<span class="hljs-keyword">int</span> width, <span class="hljs-keyword">int</span> height, String content, String imgPath, String imgName, String suffix)</span></span><br><span class="hljs-function">        <span class="hljs-keyword">throws</span> Exception</span><br><span class="hljs-function">    </span>&#123;<br>        File filePath = <span class="hljs-keyword">new</span> File(imgPath);<br>        <span class="hljs-keyword">if</span> (!filePath.exists())<br>        &#123;<br>            filePath.mkdirs();<br>        &#125;<br>        File imageFile = <span class="hljs-keyword">new</span> File(imgPath, imgName);<br>        Map&lt;EncodeHintType, Object&gt; hints = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br>        <span class="hljs-comment">// å†…å®¹ç¼–ç æ ¼å¼</span><br>        hints.put(EncodeHintType.CHARACTER_SET, <span class="hljs-string">&quot;UTF-8&quot;</span>);<br>        <span class="hljs-comment">// æŒ‡å®šçº é”™ç­‰çº§</span><br>        hints.put(EncodeHintType.ERROR_CORRECTION, ErrorCorrectionLevel.H);<br>        <span class="hljs-comment">// è®¾ç½®äºŒç»´ç è¾¹çš„ç©ºåº¦ï¼Œéè´Ÿæ•°</span><br>        hints.put(EncodeHintType.MARGIN, <span class="hljs-number">1</span>);<br>        BitMatrix bitMatrix = <span class="hljs-keyword">new</span> MultiFormatWriter().encode(content, BarcodeFormat.QR_CODE, width, height, hints);<br>        MatrixToImageWriter.writeToPath(bitMatrix, suffix, imageFile.toPath());<span class="hljs-comment">// è¾“å‡ºåŸå›¾ç‰‡</span><br>    &#125;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@title</span> ç”Ÿæˆå¸¦logoçš„äºŒç»´ç </span><br><span class="hljs-comment">     * <span class="hljs-doctag">@discribtion</span></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@author</span> zch</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@Date</span> 2020å¹´1æœˆ3æ—¥ ä¸‹åˆ3:27:21</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@vision</span> V1.0</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">QREncode</span><span class="hljs-params">(<span class="hljs-keyword">int</span> width, <span class="hljs-keyword">int</span> height, String content, String logoPath, String imgPath, String imgName, String suffix)</span></span><br><span class="hljs-function">        <span class="hljs-keyword">throws</span> Exception</span><br><span class="hljs-function">    </span>&#123;<br>        File filePath = <span class="hljs-keyword">new</span> File(imgPath);<br>        <span class="hljs-keyword">if</span> (!filePath.exists())<br>        &#123;<br>            filePath.mkdirs();<br>        &#125;<br>        File imageFile = <span class="hljs-keyword">new</span> File(imgPath, imgName);<br>        Map&lt;EncodeHintType, Object&gt; hints = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br>        <span class="hljs-comment">// å†…å®¹ç¼–ç æ ¼å¼</span><br>        hints.put(EncodeHintType.CHARACTER_SET, <span class="hljs-string">&quot;UTF-8&quot;</span>);<br>        <span class="hljs-comment">// æŒ‡å®šçº é”™ç­‰çº§</span><br>        hints.put(EncodeHintType.ERROR_CORRECTION, ErrorCorrectionLevel.H);<br>        <span class="hljs-comment">// è®¾ç½®äºŒç»´ç è¾¹çš„ç©ºåº¦ï¼Œéè´Ÿæ•°</span><br>        hints.put(EncodeHintType.MARGIN, <span class="hljs-number">1</span>);<br>        BitMatrix bitMatrix = <span class="hljs-keyword">new</span> MultiFormatWriter().encode(content, BarcodeFormat.QR_CODE, width, height, hints);<br>        MatrixToImageConfig matrixToImageConfig = <span class="hljs-keyword">new</span> MatrixToImageConfig(ON_COLOR, OFF_COLOR);<br>        BufferedImage bufferedImage = LogoMatrix(MatrixToImageWriter.toBufferedImage(bitMatrix, matrixToImageConfig), <span class="hljs-keyword">new</span> File(logoPath));<br>        ImageIO.write(bufferedImage, suffix, imageFile);<span class="hljs-comment">// è¾“å‡ºå¸¦logoå›¾ç‰‡</span><br>    &#125;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@title</span> äºŒç»´ç å›¾ç‰‡æ·»åŠ logo</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@discribtion</span>  </span><br><span class="hljs-comment">     * <span class="hljs-doctag">@author</span> zch</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@Date</span> 2020å¹´1æœˆ3æ—¥ ä¸‹åˆ3:27:21</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> matrixImage æºäºŒç»´ç å›¾ç‰‡</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> logoFile logoå›¾ç‰‡</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@vision</span> V1.0</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> BufferedImage <span class="hljs-title">LogoMatrix</span><span class="hljs-params">(BufferedImage matrixImage, File logoFile)</span></span><br><span class="hljs-function">        <span class="hljs-keyword">throws</span> IOException</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-comment">// è¯»å–äºŒç»´ç å›¾ç‰‡ï¼Œå¹¶æ„å»ºç»˜å›¾å¯¹è±¡</span><br>        Graphics2D gs = matrixImage.createGraphics();<br>        <span class="hljs-keyword">int</span> matrixWidth = matrixImage.getWidth();<br>        <span class="hljs-keyword">int</span> matrixHeigh = matrixImage.getHeight();<br>        <span class="hljs-keyword">int</span> ratioWidth = matrixWidth * <span class="hljs-number">2</span> / <span class="hljs-number">10</span>;<br>        <span class="hljs-keyword">int</span> ratioHeight = matrixHeigh * <span class="hljs-number">2</span> / <span class="hljs-number">10</span>;<br>        <span class="hljs-comment">// è¯»å–Logoå›¾ç‰‡</span><br>        BufferedImage logo = ImageIO.read(logoFile);<br>        <span class="hljs-keyword">int</span> logoWidth = logo.getWidth(<span class="hljs-keyword">null</span>) &gt; ratioWidth ? ratioWidth : logo.getWidth(<span class="hljs-keyword">null</span>);<br>        <span class="hljs-keyword">int</span> logoHeight = logo.getHeight(<span class="hljs-keyword">null</span>) &gt; ratioHeight ? ratioHeight : logo.getHeight(<span class="hljs-keyword">null</span>);<br>        <span class="hljs-keyword">int</span> x = (matrixWidth - logoWidth) / <span class="hljs-number">2</span>;<br>        <span class="hljs-keyword">int</span> y = (matrixHeigh - logoHeight) / <span class="hljs-number">2</span>;<br>        <br>        <span class="hljs-comment">// ç»˜åˆ¶</span><br>        gs.drawImage(logo, x, y, logoWidth, logoHeight, <span class="hljs-keyword">null</span>);<br>        gs.setColor(Color.BLACK);<br>        gs.setBackground(Color.WHITE);<br> <br>        gs.dispose();<br>        matrixImage.flush();<br>        <span class="hljs-keyword">return</span> matrixImage;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æµ‹è¯•ç”ŸæˆäºŒç»´ç "><a href="#æµ‹è¯•ç”ŸæˆäºŒç»´ç " class="headerlink" title="æµ‹è¯•ç”ŸæˆäºŒç»´ç "></a>æµ‹è¯•ç”ŸæˆäºŒç»´ç </h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">QRCodeUtil.generateQRImage(<span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>, <span class="hljs-string">&quot;https://blog.csdn.net/qq_34928194&quot;</span>, <span class="hljs-keyword">null</span>, <span class="hljs-string">&quot;E:/&quot;</span>, <span class="hljs-string">&quot;test.gif&quot;</span>, <span class="hljs-string">&quot;gif&quot;</span>);<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>äºŒç»´ç </tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Lamdaè¡¨è¾¾å¼ä½œç”¨åŸŸ(Lambda Scopes)</title>
    <link href="/blog/2021/03/23/Lamda%E8%A1%A8%E8%BE%BE%E5%BC%8F%E4%BD%9C%E7%94%A8%E5%9F%9F/"/>
    <url>/blog/2021/03/23/Lamda%E8%A1%A8%E8%BE%BE%E5%BC%8F%E4%BD%9C%E7%94%A8%E5%9F%9F/</url>
    
    <content type="html"><![CDATA[<h2 id="è®¿é—®å±€éƒ¨å˜é‡"><a href="#è®¿é—®å±€éƒ¨å˜é‡" class="headerlink" title="è®¿é—®å±€éƒ¨å˜é‡"></a>è®¿é—®å±€éƒ¨å˜é‡</h2><p>æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨ lambda è¡¨è¾¾å¼ä¸­è®¿é—®å¤–éƒ¨çš„å±€éƒ¨å˜é‡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> num = <span class="hljs-number">1</span>;<br>Converter&lt;Integer, String&gt; stringConverter =<br>        (from) -&gt; String.valueOf(from + num);<br> <br>stringConverter.convert(<span class="hljs-number">2</span>);     <span class="hljs-comment">// 3</span><br></code></pre></td></tr></table></figure><p>ä½†æ˜¯å’ŒåŒ¿åå¯¹è±¡ä¸åŒçš„æ˜¯ï¼Œè¿™é‡Œçš„å˜é‡numå¯ä»¥ä¸ç”¨å£°æ˜ä¸ºfinalï¼Œè¯¥ä»£ç åŒæ ·æ­£ç¡®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">int</span> num = <span class="hljs-number">1</span>;<br>Converter&lt;Integer, String&gt; stringConverter =<br>        (from) -&gt; String.valueOf(from + num);<br> <br>stringConverter.convert(<span class="hljs-number">2</span>);     <span class="hljs-comment">// 3</span><br></code></pre></td></tr></table></figure><p>ä¸è¿‡è¿™é‡Œçš„ num å¿…é¡»ä¸å¯è¢«åé¢çš„ä»£ç ä¿®æ”¹ï¼ˆå³éšæ€§çš„å…·æœ‰finalçš„è¯­ä¹‰ï¼‰ï¼Œä¾‹å¦‚ä¸‹é¢çš„å°±æ— æ³•ç¼–è¯‘ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">int</span> num = <span class="hljs-number">1</span>;<br>Converter&lt;Integer, String&gt; stringConverter =<br>        (from) -&gt; String.valueOf(from + num);<br>num = <span class="hljs-number">3</span>;<span class="hljs-comment">//åœ¨lambdaè¡¨è¾¾å¼ä¸­è¯•å›¾ä¿®æ”¹numåŒæ ·æ˜¯ä¸å…è®¸çš„ã€‚</span><br></code></pre></td></tr></table></figure><h2 id="è®¿é—®å­—æ®µå’Œé™æ€å˜é‡"><a href="#è®¿é—®å­—æ®µå’Œé™æ€å˜é‡" class="headerlink" title="è®¿é—®å­—æ®µå’Œé™æ€å˜é‡"></a>è®¿é—®å­—æ®µå’Œé™æ€å˜é‡</h2><p>ä¸å±€éƒ¨å˜é‡ç›¸æ¯”ï¼Œæˆ‘ä»¬å¯¹lambdaè¡¨è¾¾å¼ä¸­çš„å®ä¾‹å­—æ®µå’Œé™æ€å˜é‡éƒ½æœ‰è¯»å†™è®¿é—®æƒé™ã€‚ è¯¥è¡Œä¸ºå’ŒåŒ¿åå¯¹è±¡æ˜¯ä¸€è‡´çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Lambda4</span> </span>&#123;<br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> outerStaticNum;<br>    <span class="hljs-keyword">int</span> outerNum;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testScopes</span><span class="hljs-params">()</span> </span>&#123;<br>        Converter&lt;Integer, String&gt; stringConverter1 = (from) -&gt; &#123;<br>            outerNum = <span class="hljs-number">23</span>;<br>            <span class="hljs-keyword">return</span> String.valueOf(from);<br>        &#125;;<br> <br>        Converter&lt;Integer, String&gt; stringConverter2 = (from) -&gt; &#123;<br>            outerStaticNum = <span class="hljs-number">72</span>;<br>            <span class="hljs-keyword">return</span> String.valueOf(from);<br>        &#125;;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="è®¿é—®é»˜è®¤æ¥å£æ–¹æ³•"><a href="#è®¿é—®é»˜è®¤æ¥å£æ–¹æ³•" class="headerlink" title="è®¿é—®é»˜è®¤æ¥å£æ–¹æ³•"></a>è®¿é—®é»˜è®¤æ¥å£æ–¹æ³•</h2><p>è¿˜è®°å¾—ç¬¬ä¸€èŠ‚ä¸­çš„ formula ç¤ºä¾‹å—ï¼Ÿ Formula æ¥å£å®šä¹‰äº†ä¸€ä¸ªé»˜è®¤æ–¹æ³•sqrtï¼Œå¯ä»¥ä»åŒ…å«åŒ¿åå¯¹è±¡çš„æ¯ä¸ª formula å®ä¾‹è®¿é—®è¯¥æ–¹æ³•ã€‚ è¿™ä¸é€‚ç”¨äºlambdaè¡¨è¾¾å¼ã€‚</p><p>æ— æ³•ä» lambda è¡¨è¾¾å¼ä¸­è®¿é—®é»˜è®¤æ–¹æ³•,æ•…ä»¥ä¸‹ä»£ç æ— æ³•ç¼–è¯‘ï¼š</p><p>Formula formula = (a) -&gt; sqrt(a * 100);</p><h2 id="å†…ç½®å‡½æ•°å¼æ¥å£-Built-in-Functional-Interfaces"><a href="#å†…ç½®å‡½æ•°å¼æ¥å£-Built-in-Functional-Interfaces" class="headerlink" title="å†…ç½®å‡½æ•°å¼æ¥å£(Built-in Functional Interfaces)"></a>å†…ç½®å‡½æ•°å¼æ¥å£(Built-in Functional Interfaces)</h2><p>JDK 1.8 APIåŒ…å«è®¸å¤šå†…ç½®å‡½æ•°å¼æ¥å£ã€‚ å…¶ä¸­ä¸€äº›å€Ÿå£åœ¨è€ç‰ˆæœ¬çš„ Java ä¸­æ˜¯æ¯”è¾ƒå¸¸è§çš„æ¯”å¦‚ï¼š Comparator æˆ–Runnableï¼Œè¿™äº›æ¥å£éƒ½å¢åŠ äº†@FunctionalInterfaceæ³¨è§£ä»¥ä¾¿èƒ½ç”¨åœ¨ lambda è¡¨è¾¾å¼ä¸Šã€‚</p><p>ä½†æ˜¯ Java 8 API åŒæ ·è¿˜æä¾›äº†å¾ˆå¤šå…¨æ–°çš„å‡½æ•°å¼æ¥å£æ¥è®©ä½ çš„ç¼–ç¨‹å·¥ä½œæ›´åŠ æ–¹ä¾¿ï¼Œæœ‰ä¸€äº›æ¥å£æ˜¯æ¥è‡ª Google Guava åº“é‡Œçš„ï¼Œå³ä¾¿ä½ å¯¹è¿™äº›å¾ˆç†Ÿæ‚‰äº†ï¼Œè¿˜æ˜¯æœ‰å¿…è¦çœ‹çœ‹è¿™äº›æ˜¯å¦‚ä½•æ‰©å±•åˆ°lambdaä¸Šä½¿ç”¨çš„ã€‚</p><h3 id="Predicates"><a href="#Predicates" class="headerlink" title="Predicates"></a>Predicates</h3><p>Predicate æ¥å£æ˜¯åªæœ‰ä¸€ä¸ªå‚æ•°çš„è¿”å›å¸ƒå°”ç±»å‹å€¼çš„ æ–­è¨€å‹ æ¥å£ã€‚è¯¥æ¥å£åŒ…å«å¤šç§é»˜è®¤æ–¹æ³•æ¥å°† Predicate ç»„åˆæˆå…¶ä»–å¤æ‚çš„é€»è¾‘ï¼ˆæ¯”å¦‚ï¼šä¸ï¼Œæˆ–ï¼Œéï¼‰ï¼š</p><p>è¯‘è€…æ³¨ï¼š Predicate æ¥å£æºç å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> java.util.function;<br><span class="hljs-keyword">import</span> java.util.Objects;<br> <br><span class="hljs-meta">@FunctionalInterface</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Predicate</span>&lt;<span class="hljs-title">T</span>&gt; </span>&#123;<br> <br>    <span class="hljs-comment">// è¯¥æ–¹æ³•æ˜¯æ¥å—ä¸€ä¸ªä¼ å…¥ç±»å‹,è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼.æ­¤æ–¹æ³•åº”ç”¨äºåˆ¤æ–­.</span><br>    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">test</span><span class="hljs-params">(T t)</span></span>;<br> <br>    <span class="hljs-comment">//andæ–¹æ³•ä¸å…³ç³»å‹è¿ç®—ç¬¦&quot;&amp;&amp;&quot;ç›¸ä¼¼ï¼Œä¸¤è¾¹éƒ½æˆç«‹æ‰è¿”å›true</span><br>    <span class="hljs-function"><span class="hljs-keyword">default</span> Predicate&lt;T&gt; <span class="hljs-title">and</span><span class="hljs-params">(Predicate&lt;? <span class="hljs-keyword">super</span> T&gt; other)</span> </span>&#123;<br>        Objects.requireNonNull(other);<br>        <span class="hljs-keyword">return</span> (t) -&gt; test(t) &amp;&amp; other.test(t);<br>    &#125;<br>    <span class="hljs-comment">// ä¸å…³ç³»è¿ç®—ç¬¦&quot;!&quot;ç›¸ä¼¼ï¼Œå¯¹åˆ¤æ–­è¿›è¡Œå–å</span><br>    <span class="hljs-function"><span class="hljs-keyword">default</span> Predicate&lt;T&gt; <span class="hljs-title">negate</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> (t) -&gt; !test(t);<br>    &#125;<br>    <span class="hljs-comment">//oræ–¹æ³•ä¸å…³ç³»å‹è¿ç®—ç¬¦&quot;||&quot;ç›¸ä¼¼ï¼Œä¸¤è¾¹åªè¦æœ‰ä¸€ä¸ªæˆç«‹å°±è¿”å›true</span><br>    <span class="hljs-function"><span class="hljs-keyword">default</span> Predicate&lt;T&gt; <span class="hljs-title">or</span><span class="hljs-params">(Predicate&lt;? <span class="hljs-keyword">super</span> T&gt; other)</span> </span>&#123;<br>        Objects.requireNonNull(other);<br>        <span class="hljs-keyword">return</span> (t) -&gt; test(t) || other.test(t);<br>    &#125;<br>   <span class="hljs-comment">// è¯¥æ–¹æ³•æ¥æ”¶ä¸€ä¸ªObjectå¯¹è±¡,è¿”å›ä¸€ä¸ªPredicateç±»å‹.æ­¤æ–¹æ³•ç”¨äºåˆ¤æ–­ç¬¬ä¸€ä¸ªtestçš„æ–¹æ³•ä¸ç¬¬äºŒä¸ªtestæ–¹æ³•ç›¸åŒ(equal).</span><br>    <span class="hljs-keyword">static</span> &lt;T&gt; <span class="hljs-function">Predicate&lt;T&gt; <span class="hljs-title">isEqual</span><span class="hljs-params">(Object targetRef)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> (<span class="hljs-keyword">null</span> == targetRef)<br>                ? Objects::isNull<br>                : object -&gt; targetRef.equals(object);<br>    &#125;<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">Predicate&lt;String&gt; predicate = (s) -&gt; s.length() &gt; <span class="hljs-number">0</span>;<br> <br>predicate.test(<span class="hljs-string">&quot;foo&quot;</span>);              <span class="hljs-comment">// true</span><br>predicate.negate().test(<span class="hljs-string">&quot;foo&quot;</span>);     <span class="hljs-comment">// false</span><br> <br>Predicate&lt;Boolean&gt; nonNull = Objects::nonNull;<br>Predicate&lt;Boolean&gt; isNull = Objects::isNull;<br> <br>Predicate&lt;String&gt; isEmpty = String::isEmpty;<br>Predicate&lt;String&gt; isNotEmpty = isEmpty.negate();<br></code></pre></td></tr></table></figure><h2 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h2><p>Function æ¥å£æ¥å—ä¸€ä¸ªå‚æ•°å¹¶ç”Ÿæˆç»“æœã€‚é»˜è®¤æ–¹æ³•å¯ç”¨äºå°†å¤šä¸ªå‡½æ•°é“¾æ¥åœ¨ä¸€èµ·ï¼ˆcompose, andThenï¼‰ï¼š</p><p>è¯‘è€…æ³¨ï¼š Function æ¥å£æºç å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> java.util.function;<br> <br><span class="hljs-keyword">import</span> java.util.Objects;<br> <br><span class="hljs-meta">@FunctionalInterface</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Function</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">R</span>&gt; </span>&#123;<br> <br>    <span class="hljs-comment">//å°†Functionå¯¹è±¡åº”ç”¨åˆ°è¾“å…¥çš„å‚æ•°ä¸Šï¼Œç„¶åè¿”å›è®¡ç®—ç»“æœã€‚</span><br>    <span class="hljs-function">R <span class="hljs-title">apply</span><span class="hljs-params">(T t)</span></span>;<br>    <span class="hljs-comment">//å°†ä¸¤ä¸ªFunctionæ•´åˆï¼Œå¹¶è¿”å›ä¸€ä¸ªèƒ½å¤Ÿæ‰§è¡Œä¸¤ä¸ªFunctionå¯¹è±¡åŠŸèƒ½çš„Functionå¯¹è±¡ã€‚</span><br>    <span class="hljs-keyword">default</span> &lt;V&gt; <span class="hljs-function">Function&lt;V, R&gt; <span class="hljs-title">compose</span><span class="hljs-params">(Function&lt;? <span class="hljs-keyword">super</span> V, ? extends T&gt; before)</span> </span>&#123;<br>        Objects.requireNonNull(before);<br>        <span class="hljs-keyword">return</span> (V v) -&gt; apply(before.apply(v));<br>    &#125;<br>    <span class="hljs-comment">// </span><br>    <span class="hljs-keyword">default</span> &lt;V&gt; <span class="hljs-function">Function&lt;T, V&gt; <span class="hljs-title">andThen</span><span class="hljs-params">(Function&lt;? <span class="hljs-keyword">super</span> R, ? extends V&gt; after)</span> </span>&#123;<br>        Objects.requireNonNull(after);<br>        <span class="hljs-keyword">return</span> (T t) -&gt; after.apply(apply(t));<br>    &#125;<br> <br>    <span class="hljs-keyword">static</span> &lt;T&gt; <span class="hljs-function">Function&lt;T, T&gt; <span class="hljs-title">identity</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> t -&gt; t;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Lamda</tag>
      
      <tag>ä½œç”¨åŸŸ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å‡½æ•°å¼æ¥å£(Functional Interfaces)</title>
    <link href="/blog/2021/03/23/%E5%87%BD%E6%95%B0%E5%BC%8F%E6%8E%A5%E5%8F%A3/"/>
    <url>/blog/2021/03/23/%E5%87%BD%E6%95%B0%E5%BC%8F%E6%8E%A5%E5%8F%A3/</url>
    
    <content type="html"><![CDATA[<p>Java è¯­è¨€è®¾è®¡è€…ä»¬æŠ•å…¥äº†å¤§é‡ç²¾åŠ›æ¥æ€è€ƒå¦‚ä½•ä½¿ç°æœ‰çš„å‡½æ•°å‹å¥½åœ°æ”¯æŒLambdaã€‚æœ€ç»ˆé‡‡å–çš„æ–¹æ³•æ˜¯ï¼šå¢åŠ å‡½æ•°å¼æ¥å£çš„æ¦‚å¿µã€‚â€œå‡½æ•°å¼æ¥å£â€æ˜¯æŒ‡ä»…ä»…åªåŒ…å«ä¸€ä¸ªæŠ½è±¡æ–¹æ³•,ä½†æ˜¯å¯ä»¥æœ‰å¤šä¸ªéæŠ½è±¡æ–¹æ³•(ä¹Ÿå°±æ˜¯ä¸Šé¢æåˆ°çš„é»˜è®¤æ–¹æ³•)çš„æ¥å£ã€‚ åƒè¿™æ ·çš„æ¥å£ï¼Œå¯ä»¥è¢«éšå¼è½¬æ¢ä¸ºlambdaè¡¨è¾¾å¼ã€‚java.lang.Runnable ä¸ java.util.concurrent.Callable æ˜¯å‡½æ•°å¼æ¥å£æœ€å…¸å‹çš„ä¸¤ä¸ªä¾‹å­ã€‚Java 8å¢åŠ äº†ä¸€ç§ç‰¹æ®Šçš„æ³¨è§£@FunctionalInterface,ä½†æ˜¯è¿™ä¸ªæ³¨è§£é€šå¸¸ä¸æ˜¯å¿…é¡»çš„(æŸäº›æƒ…å†µå»ºè®®ä½¿ç”¨)ï¼Œåªè¦æ¥å£åªåŒ…å«ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œè™šæ‹Ÿæœºä¼šè‡ªåŠ¨åˆ¤æ–­è¯¥æ¥å£ä¸ºå‡½æ•°å¼æ¥å£ã€‚ä¸€èˆ¬å»ºè®®åœ¨æ¥å£ä¸Šä½¿ç”¨@FunctionalInterface æ³¨è§£è¿›è¡Œå£°æ˜ï¼Œè¿™æ ·çš„è¯ï¼Œç¼–è¯‘å™¨å¦‚æœå‘ç°ä½ æ ‡æ³¨äº†è¿™ä¸ªæ³¨è§£çš„æ¥å£æœ‰å¤šäºä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„æ—¶å€™ä¼šæŠ¥é”™çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º<img src="https://cuixiaoyande.oss-cn-shanghai.aliyuncs.com/@FunctionalInterface_1577755902803.png?x-oss-process=style/small" alt="@FunctionalInterface">ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@FunctionalInterface</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Converter</span>&lt;<span class="hljs-title">F</span>, <span class="hljs-title">T</span>&gt; </span>&#123;<br>  <span class="hljs-function">T <span class="hljs-title">convert</span><span class="hljs-params">(F from)</span></span>;<br>&#125;<br> <br>  <span class="hljs-comment">// TODO å°†æ•°å­—å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´æ•°ç±»å‹</span><br>    Converter&lt;String, Integer&gt; converter = (from) -&gt; Integer.valueOf(from);<br>    Integer converted = converter.convert(<span class="hljs-string">&quot;123&quot;</span>);<br>    System.out.println(converted.getClass()); <span class="hljs-comment">//class java.lang.Integer</span><br></code></pre></td></tr></table></figure><h3 id="æ–¹æ³•å’Œæ„é€ å‡½æ•°å¼•ç”¨-Method-and-Constructor-References"><a href="#æ–¹æ³•å’Œæ„é€ å‡½æ•°å¼•ç”¨-Method-and-Constructor-References" class="headerlink" title="æ–¹æ³•å’Œæ„é€ å‡½æ•°å¼•ç”¨(Method and Constructor References)"></a>æ–¹æ³•å’Œæ„é€ å‡½æ•°å¼•ç”¨(Method and Constructor References)</h3><p>å‰ä¸€èŠ‚ä¸­çš„ä»£ç è¿˜å¯ä»¥é€šè¿‡é™æ€æ–¹æ³•å¼•ç”¨æ¥è¡¨ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">Converter&lt;String, Integer&gt; converter = Integer::valueOf;<br>   Integer converted = converter.convert(<span class="hljs-string">&quot;123&quot;</span>);<br>   System.out.println(converted.getClass());   <span class="hljs-comment">//class java.lang.Integer</span><br></code></pre></td></tr></table></figure><p>Java 8å…è®¸æ‚¨é€šè¿‡::å…³é”®å­—ä¼ é€’æ–¹æ³•æˆ–æ„é€ å‡½æ•°çš„å¼•ç”¨ã€‚ ä¸Šé¢çš„ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•å¼•ç”¨é™æ€æ–¹æ³•ã€‚ ä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥å¼•ç”¨å¯¹è±¡æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Something</span> </span>&#123;<br>    <span class="hljs-function">String <span class="hljs-title">startsWith</span><span class="hljs-params">(String s)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> String.valueOf(s.charAt(<span class="hljs-number">0</span>));<br>    &#125;<br>&#125;<br> <br>Something something = <span class="hljs-keyword">new</span> Something();<br>Converter&lt;String, String&gt; converter = something::startsWith;<br>String converted = converter.convert(<span class="hljs-string">&quot;Java&quot;</span>);<br>System.out.println(converted);    <span class="hljs-comment">// &quot;J&quot;</span><br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥çœ‹çœ‹æ„é€ å‡½æ•°æ˜¯å¦‚ä½•ä½¿ç”¨::å…³é”®å­—æ¥å¼•ç”¨çš„ï¼Œé¦–å…ˆæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªåŒ…å«å¤šä¸ªæ„é€ å‡½æ•°çš„ç®€å•ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> </span>&#123;<br>    String firstName;<br>    String lastName;<br> <br>    Person() &#123;&#125;<br> <br>    Person(String firstName, String lastName) &#123;<br>        <span class="hljs-keyword">this</span>.firstName = firstName;<br>        <span class="hljs-keyword">this</span>.lastName = lastName;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬æŒ‡å®šä¸€ä¸ªç”¨æ¥åˆ›å»ºPersonå¯¹è±¡çš„å¯¹è±¡å·¥å‚æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PersonFactory</span>&lt;<span class="hljs-title">P</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Person</span>&gt; </span>&#123;<br>    <span class="hljs-function">P <span class="hljs-title">create</span><span class="hljs-params">(String firstName, String lastName)</span></span>;<br>&#125;<br> <br></code></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨æ„é€ å‡½æ•°å¼•ç”¨æ¥å°†ä»–ä»¬å…³è”èµ·æ¥ï¼Œè€Œä¸æ˜¯æ‰‹åŠ¨å®ç°ä¸€ä¸ªå®Œæ•´çš„å·¥å‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">PersonFactory&lt;Person&gt; personFactory = Person::<span class="hljs-keyword">new</span>;<br>Person person = personFactory.create(<span class="hljs-string">&quot;Peter&quot;</span>, <span class="hljs-string">&quot;Parker&quot;</span>);<br> <br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ Person::new æ¥è·å–Personç±»æ„é€ å‡½æ•°çš„å¼•ç”¨ï¼ŒJavaç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æ ¹æ®PersonFactory.createæ–¹æ³•çš„å‚æ•°ç±»å‹æ¥é€‰æ‹©åˆé€‚çš„æ„é€ å‡½æ•°ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>å‡½æ•°å¼æ¥å£</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java8Tutorial</title>
    <link href="/blog/2021/03/23/Java8Tutorial/"/>
    <url>/blog/2021/03/23/Java8Tutorial/</url>
    
    <content type="html"><![CDATA[<p>æ¥å£çš„é»˜è®¤æ–¹æ³•(Default Methods for Interfaces) Java 8ä½¿æˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡ä½¿ç”¨ default å…³é”®å­—å‘æ¥å£æ·»åŠ éæŠ½è±¡æ–¹æ³•å®ç°ã€‚ æ­¤åŠŸèƒ½ä¹Ÿç§°ä¸ºè™šæ‹Ÿæ‰©å±•æ–¹æ³•ã€‚</p><p>ç¬¬ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Formula</span></span>&#123;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">calculate</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a)</span></span>;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">default</span> <span class="hljs-keyword">double</span> <span class="hljs-title">sqrt</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> Math.sqrt(a);<br>    &#125;<br> <br>&#125;<br></code></pre></td></tr></table></figure><p>Formula æ¥å£ä¸­é™¤äº†æŠ½è±¡æ–¹æ³•è®¡ç®—æ¥å£å…¬å¼è¿˜å®šä¹‰äº†é»˜è®¤æ–¹æ³• sqrtã€‚ å®ç°è¯¥æ¥å£çš„ç±»åªéœ€è¦å®ç°æŠ½è±¡æ–¹æ³• calculateã€‚ é»˜è®¤æ–¹æ³•sqrt å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡æ¥å£åˆ›å»ºå¯¹è±¡ï¼Œç„¶åå®ç°æ¥å£ä¸­çš„é»˜è®¤æ–¹æ³•å°±å¯ä»¥äº†ï¼Œæˆ‘ä»¬é€šè¿‡ä»£ç æ¼”ç¤ºä¸€ä¸‹è¿™ç§æ–¹å¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> </span>&#123;<br> <br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>    <span class="hljs-comment">// TODO é€šè¿‡åŒ¿åå†…éƒ¨ç±»æ–¹å¼è®¿é—®æ¥å£</span><br>    Formula formula = <span class="hljs-keyword">new</span> Formula() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">calculate</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a)</span> </span>&#123;<br>            <span class="hljs-keyword">return</span> sqrt(a * <span class="hljs-number">100</span>);<br>        &#125;<br>    &#125;;<br> <br>    System.out.println(formula.calculate(<span class="hljs-number">100</span>));     <span class="hljs-comment">// 100.0</span><br>    System.out.println(formula.sqrt(<span class="hljs-number">16</span>));           <span class="hljs-comment">// 4.0</span><br> <br>  &#125;<br> <br>&#125;<br></code></pre></td></tr></table></figure><p>formula æ˜¯ä½œä¸ºåŒ¿åå¯¹è±¡å®ç°çš„ã€‚è¯¥ä»£ç éå¸¸å®¹æ˜“ç†è§£ï¼Œ6è¡Œä»£ç å®ç°äº†è®¡ç®— sqrt(a * 100)ã€‚åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šçœ‹åˆ°åœ¨ Java 8 ä¸­å®ç°å•ä¸ªæ–¹æ³•å¯¹è±¡æœ‰ä¸€ç§æ›´å¥½æ›´æ–¹ä¾¿çš„æ–¹æ³•ã€‚</p><p>è¯‘è€…æ³¨ï¼š ä¸ç®¡æ˜¯æŠ½è±¡ç±»è¿˜æ˜¯æ¥å£ï¼Œéƒ½å¯ä»¥é€šè¿‡åŒ¿åå†…éƒ¨ç±»çš„æ–¹å¼è®¿é—®ã€‚ä¸èƒ½é€šè¿‡æŠ½è±¡ç±»æˆ–è€…æ¥å£ç›´æ¥åˆ›å»ºå¯¹è±¡ã€‚å¯¹äºä¸Šé¢é€šè¿‡åŒ¿åå†…éƒ¨ç±»æ–¹å¼è®¿é—®æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ç†è§£ï¼šä¸€ä¸ªå†…éƒ¨ç±»å®ç°äº†æ¥å£é‡Œçš„æŠ½è±¡æ–¹æ³•å¹¶ä¸”è¿”å›ä¸€ä¸ªå†…éƒ¨ç±»å¯¹è±¡ï¼Œä¹‹åæˆ‘ä»¬è®©æ¥å£çš„å¼•ç”¨æ¥æŒ‡å‘è¿™ä¸ªå¯¹è±¡ã€‚</p><h2 id="Lambdaè¡¨è¾¾å¼-Lambda-expressions"><a href="#Lambdaè¡¨è¾¾å¼-Lambda-expressions" class="headerlink" title="Lambdaè¡¨è¾¾å¼(Lambda expressions)"></a>Lambdaè¡¨è¾¾å¼(Lambda expressions)</h2><p>é¦–å…ˆçœ‹çœ‹åœ¨è€ç‰ˆæœ¬çš„Javaä¸­æ˜¯å¦‚ä½•æ’åˆ—å­—ç¬¦ä¸²çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;String&gt; names = Arrays.asList(<span class="hljs-string">&quot;peter&quot;</span>, <span class="hljs-string">&quot;anna&quot;</span>, <span class="hljs-string">&quot;mike&quot;</span>, <span class="hljs-string">&quot;xenia&quot;</span>);<br> <br>Collections.sort(names, <span class="hljs-keyword">new</span> Comparator&lt;String&gt;() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">compare</span><span class="hljs-params">(String a, String b)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> b.compareTo(a);<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><p>åªéœ€è¦ç»™é™æ€æ–¹æ³•Collections.sort ä¼ å…¥ä¸€ä¸ª List å¯¹è±¡ä»¥åŠä¸€ä¸ªæ¯”è¾ƒå™¨æ¥æŒ‰æŒ‡å®šé¡ºåºæ’åˆ—ã€‚é€šå¸¸åšæ³•éƒ½æ˜¯åˆ›å»ºä¸€ä¸ªåŒ¿åçš„æ¯”è¾ƒå™¨å¯¹è±¡ç„¶åå°†å…¶ä¼ é€’ç»™ sort æ–¹æ³•ã€‚</p><p>åœ¨Java 8 ä¸­ä½ å°±æ²¡å¿…è¦ä½¿ç”¨è¿™ç§ä¼ ç»Ÿçš„åŒ¿åå¯¹è±¡çš„æ–¹å¼äº†ï¼ŒJava 8æä¾›äº†æ›´ç®€æ´çš„è¯­æ³•ï¼Œlambdaè¡¨è¾¾å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">Collections.sort(names, (String a, String b) -&gt; &#123;<br>    <span class="hljs-keyword">return</span> b.compareTo(a);<br>&#125;);<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºï¼Œä»£ç å˜å¾—æ›´æ®µä¸”æ›´å…·æœ‰å¯è¯»æ€§ï¼Œä½†æ˜¯å®é™…ä¸Šè¿˜å¯ä»¥å†™å¾—æ›´çŸ­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">Collections.sort(names, (String a, String b) -&gt; b.compareTo(a));<br> <br></code></pre></td></tr></table></figure><p>å¯¹äºå‡½æ•°ä½“åªæœ‰ä¸€è¡Œä»£ç çš„ï¼Œä½ å¯ä»¥å»æ‰å¤§æ‹¬å·{}ä»¥åŠreturnå…³é”®å­—ï¼Œä½†æ˜¯ä½ è¿˜å¯ä»¥å†™å¾—æ›´çŸ­ç‚¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">names.sort((a, b) -&gt; b.compareTo(a));<br> <br></code></pre></td></tr></table></figure><p>List ç±»æœ¬èº«å°±æœ‰ä¸€ä¸ª sort æ–¹æ³•ã€‚å¹¶ä¸”Javaç¼–è¯‘å™¨å¯ä»¥è‡ªåŠ¨æ¨å¯¼å‡ºå‚æ•°ç±»å‹ï¼Œæ‰€ä»¥ä½ å¯ä»¥ä¸ç”¨å†å†™ä¸€æ¬¡ç±»å‹ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹lambdaè¡¨è¾¾å¼è¿˜æœ‰ä»€ä¹ˆå…¶ä»–ç”¨æ³•ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>Tutorial</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/blog/2021/03/23/java%E7%94%9F%E6%88%90%E4%BA%8C%E7%BB%B4%E7%A0%811/"/>
    <url>/blog/2021/03/23/java%E7%94%9F%E6%88%90%E4%BA%8C%E7%BB%B4%E7%A0%811/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>NIO (New I/O)</title>
    <link href="/blog/2021/03/21/NIO%20(New%20I:O)/"/>
    <url>/blog/2021/03/21/NIO%20(New%20I:O)/</url>
    
    <content type="html"><![CDATA[<h2 id="NIO-ç®€ä»‹"><a href="#NIO-ç®€ä»‹" class="headerlink" title="NIO ç®€ä»‹"></a>NIO ç®€ä»‹</h2><p>NIOæ˜¯ä¸€ç§åŒæ­¥éé˜»å¡çš„I/Oæ¨¡å‹ï¼Œåœ¨Java 1.4 ä¸­å¼•å…¥äº† NIO æ¡†æ¶ï¼Œå¯¹åº” java.nio åŒ…ï¼Œæä¾›äº† Channel , Selectorï¼ŒBufferç­‰æŠ½è±¡ã€‚</p><p>NIOä¸­çš„Nå¯ä»¥ç†è§£ä¸ºNon-blockingï¼Œä¸å•çº¯æ˜¯Newã€‚å®ƒæ”¯æŒé¢å‘ç¼“å†²çš„ï¼ŒåŸºäºé€šé“çš„I/Oæ“ä½œæ–¹æ³•ã€‚ NIOæä¾›äº†ä¸ä¼ ç»ŸBIOæ¨¡å‹ä¸­çš„ Socket å’Œ ServerSocket ç›¸å¯¹åº”çš„ SocketChannel å’Œ ServerSocketChannel ä¸¤ç§ä¸åŒçš„å¥—æ¥å­—é€šé“å®ç°,ä¸¤ç§é€šé“éƒ½æ”¯æŒé˜»å¡å’Œéé˜»å¡ä¸¤ç§æ¨¡å¼ã€‚é˜»å¡æ¨¡å¼ä½¿ç”¨å°±åƒä¼ ç»Ÿä¸­çš„æ”¯æŒä¸€æ ·ï¼Œæ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯æ€§èƒ½å’Œå¯é æ€§éƒ½ä¸å¥½ï¼›éé˜»å¡æ¨¡å¼æ­£å¥½ä¸ä¹‹ç›¸åã€‚å¯¹äºä½è´Ÿè½½ã€ä½å¹¶å‘çš„åº”ç”¨ç¨‹åºï¼Œå¯ä»¥ä½¿ç”¨åŒæ­¥é˜»å¡I/Oæ¥æå‡å¼€å‘é€Ÿç‡å’Œæ›´å¥½çš„ç»´æŠ¤æ€§ï¼›å¯¹äºé«˜è´Ÿè½½ã€é«˜å¹¶å‘çš„ï¼ˆç½‘ç»œï¼‰åº”ç”¨ï¼Œåº”ä½¿ç”¨ NIO çš„éé˜»å¡æ¨¡å¼æ¥å¼€å‘ã€‚</p><h2 id="NIOçš„ç‰¹æ€§-NIOä¸IOåŒºåˆ«"><a href="#NIOçš„ç‰¹æ€§-NIOä¸IOåŒºåˆ«" class="headerlink" title="NIOçš„ç‰¹æ€§/NIOä¸IOåŒºåˆ«"></a>NIOçš„ç‰¹æ€§/NIOä¸IOåŒºåˆ«</h2><p>å¦‚æœæ˜¯åœ¨é¢è¯•ä¸­å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘è§‰å¾—é¦–å…ˆè‚¯å®šè¦ä» NIO æµæ˜¯éé˜»å¡ IO è€Œ IO æµæ˜¯é˜»å¡ IO è¯´èµ·ã€‚ç„¶åï¼Œå¯ä»¥ä» NIO çš„3ä¸ªæ ¸å¿ƒç»„ä»¶/ç‰¹æ€§ä¸º NIO å¸¦æ¥çš„ä¸€äº›æ”¹è¿›æ¥åˆ†æã€‚å¦‚æœï¼Œä½ æŠŠè¿™äº›éƒ½å›ç­”ä¸Šäº†æˆ‘è§‰å¾—ä½ å¯¹äº NIO å°±æœ‰äº†æ›´ä¸ºæ·±å…¥ä¸€ç‚¹çš„è®¤è¯†ï¼Œé¢è¯•å®˜é—®åˆ°ä½ è¿™ä¸ªé—®é¢˜ï¼Œä½ ä¹Ÿèƒ½å¾ˆè½»æ¾çš„å›ç­”ä¸Šæ¥äº†ã€‚</p><p>Non-blocking IOï¼ˆéé˜»å¡IOï¼‰</p><h2 id="IOæµæ˜¯é˜»å¡çš„ï¼ŒNIOæµæ˜¯ä¸é˜»å¡çš„ã€‚"><a href="#IOæµæ˜¯é˜»å¡çš„ï¼ŒNIOæµæ˜¯ä¸é˜»å¡çš„ã€‚" class="headerlink" title="IOæµæ˜¯é˜»å¡çš„ï¼ŒNIOæµæ˜¯ä¸é˜»å¡çš„ã€‚"></a>IOæµæ˜¯é˜»å¡çš„ï¼ŒNIOæµæ˜¯ä¸é˜»å¡çš„ã€‚</h2><p>Java NIOä½¿æˆ‘ä»¬å¯ä»¥è¿›è¡Œéé˜»å¡IOæ“ä½œã€‚æ¯”å¦‚è¯´ï¼Œå•çº¿ç¨‹ä¸­ä»é€šé“è¯»å–æ•°æ®åˆ°bufferï¼ŒåŒæ—¶å¯ä»¥ç»§ç»­åšåˆ«çš„äº‹æƒ…ï¼Œå½“æ•°æ®è¯»å–åˆ°bufferä¸­åï¼Œçº¿ç¨‹å†ç»§ç»­å¤„ç†æ•°æ®ã€‚å†™æ•°æ®ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚å¦å¤–ï¼Œéé˜»å¡å†™ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä¸€ä¸ªçº¿ç¨‹è¯·æ±‚å†™å…¥ä¸€äº›æ•°æ®åˆ°æŸé€šé“ï¼Œä½†ä¸éœ€è¦ç­‰å¾…å®ƒå®Œå…¨å†™å…¥ï¼Œè¿™ä¸ªçº¿ç¨‹åŒæ—¶å¯ä»¥å»åšåˆ«çš„äº‹æƒ…ã€‚</p><p>Java IOçš„å„ç§æµæ˜¯é˜»å¡çš„ã€‚è¿™æ„å‘³ç€ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ read() æˆ– write() æ—¶ï¼Œè¯¥çº¿ç¨‹è¢«é˜»å¡ï¼Œç›´åˆ°æœ‰ä¸€äº›æ•°æ®è¢«è¯»å–ï¼Œæˆ–æ•°æ®å®Œå…¨å†™å…¥ã€‚è¯¥çº¿ç¨‹åœ¨æ­¤æœŸé—´ä¸èƒ½å†å¹²ä»»ä½•äº‹æƒ…äº†</p><h2 id="Buffer-ç¼“å†²åŒº"><a href="#Buffer-ç¼“å†²åŒº" class="headerlink" title="Buffer(ç¼“å†²åŒº)"></a>Buffer(ç¼“å†²åŒº)</h2><p>IO é¢å‘æµ(Stream oriented)ï¼Œè€Œ NIO é¢å‘ç¼“å†²åŒº(Buffer oriented)ã€‚ Bufferæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒåŒ…å«ä¸€äº›è¦å†™å…¥æˆ–è€…è¦è¯»å‡ºçš„æ•°æ®ã€‚åœ¨NIOç±»åº“ä¸­åŠ å…¥Bufferå¯¹è±¡ï¼Œä½“ç°äº†æ–°åº“ä¸åŸI/Oçš„ä¸€ä¸ªé‡è¦åŒºåˆ«ã€‚åœ¨é¢å‘æµçš„I/Oä¸­Â·å¯ä»¥å°†æ•°æ®ç›´æ¥å†™å…¥æˆ–è€…å°†æ•°æ®ç›´æ¥è¯»åˆ° Stream å¯¹è±¡ä¸­ã€‚è™½ç„¶ Stream ä¸­ä¹Ÿæœ‰ Buffer å¼€å¤´çš„æ‰©å±•ç±»ï¼Œä½†åªæ˜¯æµçš„åŒ…è£…ç±»ï¼Œè¿˜æ˜¯ä»æµè¯»åˆ°ç¼“å†²åŒºï¼Œè€Œ NIO å´æ˜¯ç›´æ¥è¯»åˆ° Buffer ä¸­è¿›è¡Œæ“ä½œã€‚</p><p>åœ¨NIOåä¸­ï¼Œæ‰€æœ‰æ•°æ®éƒ½æ˜¯ç”¨ç¼“å†²åŒºå¤„ç†çš„ã€‚åœ¨è¯»å–æ•°æ®æ—¶ï¼Œå®ƒæ˜¯ç›´æ¥è¯»åˆ°ç¼“å†²åŒºä¸­çš„; åœ¨å†™å…¥æ•°æ®æ—¶ï¼Œå†™å…¥åˆ°ç¼“å†²åŒºä¸­ã€‚ä»»ä½•æ—¶å€™è®¿é—®NIOä¸­çš„æ•°æ®ï¼Œéƒ½æ˜¯é€šè¿‡ç¼“å†²åŒºè¿›è¡Œæ“ä½œã€‚</p><p>æœ€å¸¸ç”¨çš„ç¼“å†²åŒºæ˜¯ ByteBuffer,ä¸€ä¸ª ByteBuffer æä¾›äº†ä¸€ç»„åŠŸèƒ½ç”¨äºæ“ä½œ byte æ•°ç»„ã€‚é™¤äº†ByteBuffer,è¿˜æœ‰å…¶ä»–çš„ä¸€äº›ç¼“å†²åŒºï¼Œäº‹å®ä¸Šï¼Œæ¯ä¸€ç§JavaåŸºæœ¬ç±»å‹ï¼ˆé™¤äº†Booleanç±»å‹ï¼‰éƒ½å¯¹åº”æœ‰ä¸€ç§ç¼“å†²åŒºã€‚</p><h2 id="Channel-é€šé“"><a href="#Channel-é€šé“" class="headerlink" title="Channel (é€šé“)"></a>Channel (é€šé“)</h2><p>NIO é€šè¿‡Channelï¼ˆé€šé“ï¼‰ è¿›è¡Œè¯»å†™ã€‚</p><p>é€šé“æ˜¯åŒå‘çš„ï¼Œå¯è¯»ä¹Ÿå¯å†™ï¼Œè€Œæµçš„è¯»å†™æ˜¯å•å‘çš„ã€‚æ— è®ºè¯»å†™ï¼Œé€šé“åªèƒ½å’ŒBufferäº¤äº’ã€‚å› ä¸º Bufferï¼Œé€šé“å¯ä»¥å¼‚æ­¥åœ°è¯»å†™ã€‚</p><h2 id="Selector-é€‰æ‹©å™¨"><a href="#Selector-é€‰æ‹©å™¨" class="headerlink" title="Selector (é€‰æ‹©å™¨)"></a>Selector (é€‰æ‹©å™¨)</h2><p>NIOæœ‰é€‰æ‹©å™¨ï¼Œè€ŒIOæ²¡æœ‰ã€‚</p><p>é€‰æ‹©å™¨ç”¨äºä½¿ç”¨å•ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ªé€šé“ã€‚å› æ­¤ï¼Œå®ƒéœ€è¦è¾ƒå°‘çš„çº¿ç¨‹æ¥å¤„ç†è¿™äº›é€šé“ã€‚çº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢å¯¹äºæ“ä½œç³»ç»Ÿæ¥è¯´æ˜¯æ˜‚è´µçš„ã€‚ å› æ­¤ï¼Œä¸ºäº†æé«˜ç³»ç»Ÿæ•ˆç‡é€‰æ‹©å™¨æ˜¯æœ‰ç”¨çš„ã€‚<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/small-20210321161058525.png" alt="Slector"></p><h2 id="NIO-è¯»æ•°æ®å’Œå†™æ•°æ®æ–¹å¼"><a href="#NIO-è¯»æ•°æ®å’Œå†™æ•°æ®æ–¹å¼" class="headerlink" title="NIO è¯»æ•°æ®å’Œå†™æ•°æ®æ–¹å¼"></a>NIO è¯»æ•°æ®å’Œå†™æ•°æ®æ–¹å¼</h2><p>é€šå¸¸æ¥è¯´NIOä¸­çš„æ‰€æœ‰IOéƒ½æ˜¯ä» Channelï¼ˆé€šé“ï¼‰ å¼€å§‹çš„ã€‚</p><p>ä»é€šé“è¿›è¡Œæ•°æ®è¯»å– ï¼šåˆ›å»ºä¸€ä¸ªç¼“å†²åŒºï¼Œç„¶åè¯·æ±‚é€šé“è¯»å–æ•°æ®ã€‚ ä»é€šé“è¿›è¡Œæ•°æ®å†™å…¥ ï¼šåˆ›å»ºä¸€ä¸ªç¼“å†²åŒºï¼Œå¡«å……æ•°æ®ï¼Œå¹¶è¦æ±‚é€šé“å†™å…¥æ•°æ®ã€‚ æ•°æ®è¯»å–å’Œå†™å…¥æ“ä½œå›¾ç¤ºï¼š<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/small-20210321161058675.png" alt="NIOè¯»å†™æ•°æ®çš„æ–¹å¼"></p><h2 id="NIOæ ¸å¿ƒç»„ä»¶ç®€å•ä»‹ç»"><a href="#NIOæ ¸å¿ƒç»„ä»¶ç®€å•ä»‹ç»" class="headerlink" title="NIOæ ¸å¿ƒç»„ä»¶ç®€å•ä»‹ç»"></a>NIOæ ¸å¿ƒç»„ä»¶ç®€å•ä»‹ç»</h2><p>NIO åŒ…å«ä¸‹é¢å‡ ä¸ªæ ¸å¿ƒçš„ç»„ä»¶ï¼š</p><p>Channel(é€šé“) Buffer(ç¼“å†²åŒº) Selector(é€‰æ‹©å™¨) æ•´ä¸ªNIOä½“ç³»åŒ…å«çš„ç±»è¿œè¿œä¸æ­¢è¿™ä¸‰ä¸ªï¼Œåªèƒ½è¯´è¿™ä¸‰ä¸ªæ˜¯NIOä½“ç³»çš„â€œæ ¸å¿ƒAPIâ€ã€‚æˆ‘ä»¬ä¸Šé¢å·²ç»å¯¹è¿™ä¸‰ä¸ªæ¦‚å¿µè¿›è¡Œäº†åŸºæœ¬çš„é˜è¿°ï¼Œè¿™é‡Œå°±ä¸å¤šåšè§£é‡Šäº†ã€‚</p><h2 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h2><p>ä»£ç ç¤ºä¾‹å‡ºè‡ªé—ªç”µä¾ çš„åšå®¢ï¼ŒåŸåœ°å€å¦‚ä¸‹ï¼š</p><p><a href="https://www.jianshu.com/p/a4e03835921a">https://www.jianshu.com/p/a4e03835921a</a></p><p>å®¢æˆ·ç«¯ IOClient.java çš„ä»£ç ä¸å˜ï¼Œæˆ‘ä»¬å¯¹æœåŠ¡ç«¯ä½¿ç”¨ NIO è¿›è¡Œæ”¹é€ ã€‚ä»¥ä¸‹ä»£ç è¾ƒå¤šè€Œä¸”é€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œå¤§å®¶çœ‹çœ‹å°±å¥½ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> é—ªç”µä¾ </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> 2019å¹´2æœˆ21æ—¥</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Description</span>: NIO æ”¹é€ åçš„æœåŠ¡ç«¯</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NIOServer</span> </span>&#123;<br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>    <span class="hljs-comment">// 1. serverSelectorè´Ÿè´£è½®è¯¢æ˜¯å¦æœ‰æ–°çš„è¿æ¥ï¼ŒæœåŠ¡ç«¯ç›‘æµ‹åˆ°æ–°çš„è¿æ¥ä¹‹åï¼Œä¸å†åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œ</span><br>    <span class="hljs-comment">// è€Œæ˜¯ç›´æ¥å°†æ–°è¿æ¥ç»‘å®šåˆ°clientSelectorä¸Šï¼Œè¿™æ ·å°±ä¸ç”¨ IO æ¨¡å‹ä¸­ 1w ä¸ª while å¾ªç¯åœ¨æ­»ç­‰</span><br>    Selector serverSelector = Selector.open();<br>    <span class="hljs-comment">// 2. clientSelectorè´Ÿè´£è½®è¯¢è¿æ¥æ˜¯å¦æœ‰æ•°æ®å¯è¯»</span><br>    Selector clientSelector = Selector.open();<br> <br>    <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;<br>      <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">// å¯¹åº”IOç¼–ç¨‹ä¸­æœåŠ¡ç«¯å¯åŠ¨</span><br>        ServerSocketChannel listenerChannel = ServerSocketChannel.open();<br>        listenerChannel.socket().bind(<span class="hljs-keyword">new</span> InetSocketAddress(<span class="hljs-number">3333</span>));<br>        listenerChannel.configureBlocking(<span class="hljs-keyword">false</span>);<br>        listenerChannel.register(serverSelector, SelectionKey.OP_ACCEPT);<br> <br>        <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;<br>          <span class="hljs-comment">// ç›‘æµ‹æ˜¯å¦æœ‰æ–°çš„è¿æ¥ï¼Œè¿™é‡Œçš„1æŒ‡çš„æ˜¯é˜»å¡çš„æ—¶é—´ä¸º 1ms</span><br>          <span class="hljs-keyword">if</span> (serverSelector.select(<span class="hljs-number">1</span>) &gt; <span class="hljs-number">0</span>) &#123;<br>            Set&lt;SelectionKey&gt; set = serverSelector.selectedKeys();<br>            Iterator&lt;SelectionKey&gt; keyIterator = set.iterator();<br> <br>            <span class="hljs-keyword">while</span> (keyIterator.hasNext()) &#123;<br>              SelectionKey key = keyIterator.next();<br> <br>              <span class="hljs-keyword">if</span> (key.isAcceptable()) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                  <span class="hljs-comment">// (1) æ¯æ¥ä¸€ä¸ªæ–°è¿æ¥ï¼Œä¸éœ€è¦åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œè€Œæ˜¯ç›´æ¥æ³¨å†Œåˆ°clientSelector</span><br>                  SocketChannel clientChannel = ((ServerSocketChannel) key.channel()).accept();<br>                  clientChannel.configureBlocking(<span class="hljs-keyword">false</span>);<br>                  clientChannel.register(clientSelector, SelectionKey.OP_READ);<br>                &#125; <span class="hljs-keyword">finally</span> &#123;<br>                  keyIterator.remove();<br>                &#125;<br>              &#125;<br> <br>            &#125;<br>          &#125;<br>        &#125;<br>      &#125; <span class="hljs-keyword">catch</span> (IOException ignored) &#123;<br>      &#125;<br>    &#125;).start();<br>    <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;<br>      <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;<br>          <span class="hljs-comment">// (2) æ‰¹é‡è½®è¯¢æ˜¯å¦æœ‰å“ªäº›è¿æ¥æœ‰æ•°æ®å¯è¯»ï¼Œè¿™é‡Œçš„1æŒ‡çš„æ˜¯é˜»å¡çš„æ—¶é—´ä¸º 1ms</span><br>          <span class="hljs-keyword">if</span> (clientSelector.select(<span class="hljs-number">1</span>) &gt; <span class="hljs-number">0</span>) &#123;<br>            Set&lt;SelectionKey&gt; set = clientSelector.selectedKeys();<br>            Iterator&lt;SelectionKey&gt; keyIterator = set.iterator();<br> <br>            <span class="hljs-keyword">while</span> (keyIterator.hasNext()) &#123;<br>              SelectionKey key = keyIterator.next();<br> <br>              <span class="hljs-keyword">if</span> (key.isReadable()) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                  SocketChannel clientChannel = (SocketChannel) key.channel();<br>                  ByteBuffer byteBuffer = ByteBuffer.allocate(<span class="hljs-number">1024</span>);<br>                  <span class="hljs-comment">// (3) é¢å‘ Buffer</span><br>                  clientChannel.read(byteBuffer);<br>                  byteBuffer.flip();<br>                  System.out.println(<br>                      Charset.defaultCharset().newDecoder().decode(byteBuffer).toString());<br>                &#125; <span class="hljs-keyword">finally</span> &#123;<br>                  keyIterator.remove();<br>                  key.interestOps(SelectionKey.OP_READ);<br>                &#125;<br>              &#125;<br> <br>            &#125;<br>          &#125;<br>        &#125;<br>      &#125; <span class="hljs-keyword">catch</span> (IOException ignored) &#123;<br>      &#125;<br>    &#125;).start();<br> <br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆå¤§å®¶éƒ½ä¸æ„¿æ„ç”¨ JDK åŸç”Ÿ NIO è¿›è¡Œå¼€å‘å‘¢ï¼Ÿä»ä¸Šé¢çš„ä»£ç ä¸­å¤§å®¶éƒ½å¯ä»¥çœ‹å‡ºæ¥ï¼Œæ˜¯çœŸçš„éš¾ç”¨ï¼é™¤äº†ç¼–ç¨‹å¤æ‚ã€ç¼–ç¨‹æ¨¡å‹éš¾ä¹‹å¤–ï¼Œå®ƒè¿˜æœ‰ä»¥ä¸‹è®©äººè¯Ÿç—…çš„é—®é¢˜ï¼š</p><p>JDK çš„ NIO åº•å±‚ç”± epoll å®ç°ï¼Œè¯¥å®ç°é¥±å—è¯Ÿç—…çš„ç©ºè½®è¯¢ bug ä¼šå¯¼è‡´ cpu é£™å‡ 100% é¡¹ç›®åºå¤§ä¹‹åï¼Œè‡ªè¡Œå®ç°çš„ NIO å¾ˆå®¹æ˜“å‡ºç°å„ç±» bugï¼Œç»´æŠ¤æˆæœ¬è¾ƒé«˜ï¼Œä¸Šé¢è¿™ä¸€å¨ä»£ç æˆ‘éƒ½ä¸èƒ½ä¿è¯æ²¡æœ‰ bug Netty çš„å‡ºç°å¾ˆå¤§ç¨‹åº¦ä¸Šæ”¹å–„äº† JDK åŸç”Ÿ NIO æ‰€å­˜åœ¨çš„ä¸€äº›è®©äººéš¾ä»¥å¿å—çš„é—®é¢˜ã€‚</p><h2 id="AIO-Asynchronous-I-O"><a href="#AIO-Asynchronous-I-O" class="headerlink" title="AIO (Asynchronous I/O)"></a>AIO (Asynchronous I/O)</h2><p>AIO ä¹Ÿå°±æ˜¯ NIO 2ã€‚åœ¨ Java 7 ä¸­å¼•å…¥äº† NIO çš„æ”¹è¿›ç‰ˆ NIO 2,å®ƒæ˜¯å¼‚æ­¥éé˜»å¡çš„IOæ¨¡å‹ã€‚å¼‚æ­¥ IO æ˜¯åŸºäºäº‹ä»¶å’Œå›è°ƒæœºåˆ¶å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯åº”ç”¨æ“ä½œä¹‹åä¼šç›´æ¥è¿”å›ï¼Œä¸ä¼šå µå¡åœ¨é‚£é‡Œï¼Œå½“åå°å¤„ç†å®Œæˆï¼Œæ“ä½œç³»ç»Ÿä¼šé€šçŸ¥ç›¸åº”çš„çº¿ç¨‹è¿›è¡Œåç»­çš„æ“ä½œã€‚</p><p>AIO æ˜¯å¼‚æ­¥IOçš„ç¼©å†™ï¼Œè™½ç„¶ NIO åœ¨ç½‘ç»œæ“ä½œä¸­ï¼Œæä¾›äº†éé˜»å¡çš„æ–¹æ³•ï¼Œä½†æ˜¯ NIO çš„ IO è¡Œä¸ºè¿˜æ˜¯åŒæ­¥çš„ã€‚å¯¹äº NIO æ¥è¯´ï¼Œæˆ‘ä»¬çš„ä¸šåŠ¡çº¿ç¨‹æ˜¯åœ¨ IO æ“ä½œå‡†å¤‡å¥½æ—¶ï¼Œå¾—åˆ°é€šçŸ¥ï¼Œæ¥ç€å°±ç”±è¿™ä¸ªçº¿ç¨‹è‡ªè¡Œè¿›è¡Œ IO æ“ä½œï¼ŒIOæ“ä½œæœ¬èº«æ˜¯åŒæ­¥çš„ã€‚</p><p><a href="https://bk.cuixiaoyan.xyz/archives/ni#nio-%E7%AE%80%E4%BB%8B">NIO ç®€ä»‹</a><a href="https://bk.cuixiaoyan.xyz/archives/ni#nio%E7%9A%84%E7%89%B9%E6%80%A7nio%E4%B8%8Eio%E5%8C%BA%E5%88%AB">NIOçš„ç‰¹æ€§/NIOä¸IOåŒºåˆ«</a><a href="https://bk.cuixiaoyan.xyz/archives/ni#io%E6%B5%81%E6%98%AF%E9%98%BB%E5%A1%9E%E7%9A%84nio%E6%B5%81%E6%98%AF%E4%B8%8D%E9%98%BB%E5%A1%9E%E7%9A%84">IOæµæ˜¯é˜»å¡çš„ï¼ŒNIOæµæ˜¯ä¸é˜»å¡çš„ã€‚</a><a href="https://bk.cuixiaoyan.xyz/archives/ni#buffer%E7%BC%93%E5%86%B2%E5%8C%BA">Buffer(ç¼“å†²åŒº)</a><a href="https://bk.cuixiaoyan.xyz/archives/ni#channel-%E9%80%9A%E9%81%93">Channel (é€šé“)</a><a href="https://bk.cuixiaoyan.xyz/archives/ni#selector-%E9%80%89%E6%8B%A9%E5%99%A8">Selector (é€‰æ‹©å™¨)</a><a href="https://bk.cuixiaoyan.xyz/archives/ni#nio-%E8%AF%BB%E6%95%B0%E6%8D%AE%E5%92%8C%E5%86%99%E6%95%B0%E6%8D%AE%E6%96%B9%E5%BC%8F">NIO è¯»æ•°æ®å’Œå†™æ•°æ®æ–¹å¼</a><a href="https://bk.cuixiaoyan.xyz/archives/ni#nio%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D">NIOæ ¸å¿ƒç»„ä»¶ç®€å•ä»‹ç»</a><a href="https://bk.cuixiaoyan.xyz/archives/ni#%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B">ä»£ç ç¤ºä¾‹</a><a href="https://bk.cuixiaoyan.xyz/archives/ni#aio-asynchronous-io">AIO (Asynchronous I/O)</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>BIO,NIO,AIOæ€»ç»“</title>
    <link href="/blog/2021/03/21/BIO,NIO,AIO%E6%80%BB%E7%BB%93/"/>
    <url>/blog/2021/03/21/BIO,NIO,AIO%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<p>Java ä¸­çš„ BIOã€NIOå’Œ AIO ç†è§£ä¸ºæ˜¯ Java è¯­è¨€å¯¹æ“ä½œç³»ç»Ÿçš„å„ç§ IO æ¨¡å‹çš„å°è£…ã€‚ç¨‹åºå‘˜åœ¨ä½¿ç”¨è¿™äº› API çš„æ—¶å€™ï¼Œä¸éœ€è¦å…³å¿ƒæ“ä½œç³»ç»Ÿå±‚é¢çš„çŸ¥è¯†ï¼Œä¹Ÿä¸éœ€è¦æ ¹æ®ä¸åŒæ“ä½œç³»ç»Ÿç¼–å†™ä¸åŒçš„ä»£ç ã€‚åªéœ€è¦ä½¿ç”¨Javaçš„APIå°±å¯ä»¥äº†ã€‚</p><p>åœ¨è®² BIO,NIO,AIO ä¹‹å‰å…ˆæ¥å›é¡¾ä¸€ä¸‹è¿™æ ·å‡ ä¸ªæ¦‚å¿µï¼šåŒæ­¥ä¸å¼‚æ­¥ï¼Œé˜»å¡ä¸éé˜»å¡ã€‚ åŒæ­¥ä¸å¼‚æ­¥</p><ul><li>åŒæ­¥ï¼š åŒæ­¥å°±æ˜¯å‘èµ·ä¸€ä¸ªè°ƒç”¨åï¼Œè¢«è°ƒç”¨è€…æœªå¤„ç†å®Œè¯·æ±‚ä¹‹å‰ï¼Œè°ƒç”¨ä¸è¿”å›ã€‚</li><li>å¼‚æ­¥ï¼š å¼‚æ­¥å°±æ˜¯å‘èµ·ä¸€ä¸ªè°ƒç”¨åï¼Œç«‹åˆ»å¾—åˆ°è¢«è°ƒç”¨è€…çš„å›åº”è¡¨ç¤ºå·²æ¥æ”¶åˆ°è¯·æ±‚ï¼Œä½†æ˜¯è¢«è°ƒç”¨è€…å¹¶æ²¡æœ‰è¿”å›ç»“æœï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥å¤„ç†å…¶ä»–çš„è¯·æ±‚ï¼Œè¢«è°ƒç”¨è€…é€šå¸¸ä¾é äº‹ä»¶ï¼Œå›è°ƒç­‰æœºåˆ¶æ¥é€šçŸ¥è°ƒç”¨è€…å…¶è¿”å›ç»“æœã€‚ åŒæ­¥å’Œå¼‚æ­¥çš„åŒºåˆ«æœ€å¤§åœ¨äºå¼‚æ­¥çš„è¯è°ƒç”¨è€…ä¸éœ€è¦ç­‰å¾…å¤„ç†ç»“æœï¼Œè¢«è°ƒç”¨è€…ä¼šé€šè¿‡å›è°ƒç­‰æœºåˆ¶æ¥é€šçŸ¥è°ƒç”¨è€…å…¶è¿”å›ç»“æœã€‚</li></ul><p>é˜»å¡å’Œéé˜»å¡</p><ul><li>é˜»å¡ï¼š é˜»å¡å°±æ˜¯å‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œè°ƒç”¨è€…ä¸€ç›´ç­‰å¾…è¯·æ±‚ç»“æœè¿”å›ï¼Œä¹Ÿå°±æ˜¯å½“å‰çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ï¼Œæ— æ³•ä»äº‹å…¶ä»–ä»»åŠ¡ï¼Œåªæœ‰å½“æ¡ä»¶å°±ç»ªæ‰èƒ½ç»§ç»­ã€‚</li><li>éé˜»å¡ï¼š éé˜»å¡å°±æ˜¯å‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œè°ƒç”¨è€…ä¸ç”¨ä¸€ç›´ç­‰ç€ç»“æœè¿”å›ï¼Œå¯ä»¥å…ˆå»å¹²å…¶ä»–äº‹æƒ…ã€‚ ä¸¾ä¸ªç”Ÿæ´»ä¸­ç®€å•çš„ä¾‹å­ï¼Œä½ å¦ˆå¦ˆè®©ä½ çƒ§æ°´ï¼Œå°æ—¶å€™ä½ æ¯”è¾ƒç¬¨å•Šï¼Œåœ¨é‚£é‡Œå‚»ç­‰ç€æ°´å¼€ï¼ˆåŒæ­¥é˜»å¡ï¼‰ã€‚ç­‰ä½ ç¨å¾®å†é•¿å¤§ä¸€ç‚¹ï¼Œä½ çŸ¥é“æ¯æ¬¡çƒ§æ°´çš„ç©ºéš™å¯ä»¥å»å¹²ç‚¹å…¶ä»–äº‹ï¼Œç„¶ååªéœ€è¦æ—¶ä¸æ—¶æ¥çœ‹çœ‹æ°´å¼€äº†æ²¡æœ‰ï¼ˆåŒæ­¥éé˜»å¡ï¼‰ã€‚åæ¥ï¼Œä½ ä»¬å®¶ç”¨ä¸Šäº†æ°´å¼€äº†ä¼šå‘å‡ºå£°éŸ³çš„å£¶ï¼Œè¿™æ ·ä½ å°±åªéœ€è¦å¬åˆ°å“å£°åå°±çŸ¥é“æ°´å¼€äº†ï¼Œåœ¨è¿™æœŸé—´ä½ å¯ä»¥éšä¾¿å¹²è‡ªå·±çš„äº‹æƒ…ï¼Œä½ éœ€è¦å»å€’æ°´äº†ï¼ˆå¼‚æ­¥éé˜»å¡ï¼‰ã€‚</li></ul><h2 id="BIO-Blocking-I-O"><a href="#BIO-Blocking-I-O" class="headerlink" title="BIO (Blocking I/O)"></a>BIO (Blocking I/O)</h2><p>åŒæ­¥é˜»å¡I/Oæ¨¡å¼ï¼Œæ•°æ®çš„è¯»å–å†™å…¥å¿…é¡»é˜»å¡åœ¨ä¸€ä¸ªçº¿ç¨‹å†…ç­‰å¾…å…¶å®Œæˆã€‚</p><h3 id="ä¼ ç»Ÿ-BIO"><a href="#ä¼ ç»Ÿ-BIO" class="headerlink" title="ä¼ ç»Ÿ BIO"></a>ä¼ ç»Ÿ BIO</h3><p>BIOé€šä¿¡ï¼ˆä¸€è¯·æ±‚ä¸€åº”ç­”ï¼‰æ¨¡å‹å›¾å¦‚ä¸‹(å›¾æºç½‘ç»œï¼ŒåŸå‡ºå¤„ä¸æ˜)ï¼š<img src="https://cuixiaoyande.oss-cn-shanghai.aliyuncs.com/2_1577323312632.png?x-oss-process=style/small" alt="2">é‡‡ç”¨ BIO é€šä¿¡æ¨¡å‹ çš„æœåŠ¡ç«¯ï¼Œé€šå¸¸ç”±ä¸€ä¸ªç‹¬ç«‹çš„ Acceptor çº¿ç¨‹è´Ÿè´£ç›‘å¬å®¢æˆ·ç«¯çš„è¿æ¥ã€‚æˆ‘ä»¬ä¸€èˆ¬é€šè¿‡åœ¨while(true) å¾ªç¯ä¸­æœåŠ¡ç«¯ä¼šè°ƒç”¨ accept() æ–¹æ³•ç­‰å¾…æ¥æ”¶å®¢æˆ·ç«¯çš„è¿æ¥çš„æ–¹å¼ç›‘å¬è¯·æ±‚ï¼Œè¯·æ±‚ä¸€æ—¦æ¥æ”¶åˆ°ä¸€ä¸ªè¿æ¥è¯·æ±‚ï¼Œå°±å¯ä»¥å»ºç«‹é€šä¿¡å¥—æ¥å­—åœ¨è¿™ä¸ªé€šä¿¡å¥—æ¥å­—ä¸Šè¿›è¡Œè¯»å†™æ“ä½œï¼Œæ­¤æ—¶ä¸èƒ½å†æ¥æ”¶å…¶ä»–å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚ï¼Œåªèƒ½ç­‰å¾…åŒå½“å‰è¿æ¥çš„å®¢æˆ·ç«¯çš„æ“ä½œæ‰§è¡Œå®Œæˆï¼Œ ä¸è¿‡å¯ä»¥é€šè¿‡å¤šçº¿ç¨‹æ¥æ”¯æŒå¤šä¸ªå®¢æˆ·ç«¯çš„è¿æ¥ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚</p><p>å¦‚æœè¦è®© BIO é€šä¿¡æ¨¡å‹ èƒ½å¤ŸåŒæ—¶å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯è¯·æ±‚ï¼Œå°±å¿…é¡»ä½¿ç”¨å¤šçº¿ç¨‹ï¼ˆä¸»è¦åŸå› æ˜¯socket.accept()ã€socket.read()ã€socket.write() æ¶‰åŠçš„ä¸‰ä¸ªä¸»è¦å‡½æ•°éƒ½æ˜¯åŒæ­¥é˜»å¡çš„ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒåœ¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚ä¹‹åä¸ºæ¯ä¸ªå®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹è¿›è¡Œé“¾è·¯å¤„ç†ï¼Œå¤„ç†å®Œæˆä¹‹åï¼Œé€šè¿‡è¾“å‡ºæµè¿”å›åº”ç­”ç»™å®¢æˆ·ç«¯ï¼Œçº¿ç¨‹é”€æ¯ã€‚è¿™å°±æ˜¯å…¸å‹çš„ ä¸€è¯·æ±‚ä¸€åº”ç­”é€šä¿¡æ¨¡å‹ ã€‚æˆ‘ä»¬å¯ä»¥è®¾æƒ³ä¸€ä¸‹å¦‚æœè¿™ä¸ªè¿æ¥ä¸åšä»»ä½•äº‹æƒ…çš„è¯å°±ä¼šé€ æˆä¸å¿…è¦çš„çº¿ç¨‹å¼€é”€ï¼Œä¸è¿‡å¯ä»¥é€šè¿‡ çº¿ç¨‹æ± æœºåˆ¶ æ”¹å–„ï¼Œçº¿ç¨‹æ± è¿˜å¯ä»¥è®©çº¿ç¨‹çš„åˆ›å»ºå’Œå›æ”¶æˆæœ¬ç›¸å¯¹è¾ƒä½ã€‚ä½¿ç”¨FixedThreadPool å¯ä»¥æœ‰æ•ˆçš„æ§åˆ¶äº†çº¿ç¨‹çš„æœ€å¤§æ•°é‡ï¼Œä¿è¯äº†ç³»ç»Ÿæœ‰é™çš„èµ„æºçš„æ§åˆ¶ï¼Œå®ç°äº†N(å®¢æˆ·ç«¯è¯·æ±‚æ•°é‡):M(å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚çš„çº¿ç¨‹æ•°é‡)çš„ä¼ªå¼‚æ­¥I/Oæ¨¡å‹ï¼ˆN å¯ä»¥è¿œè¿œå¤§äº Mï¼‰ï¼Œä¸‹é¢ä¸€èŠ‚â€ä¼ªå¼‚æ­¥ BIOâ€ä¸­ä¼šè¯¦ç»†ä»‹ç»åˆ°ã€‚</p><p>æˆ‘ä»¬å†è®¾æƒ³ä¸€ä¸‹å½“å®¢æˆ·ç«¯å¹¶å‘è®¿é—®é‡å¢åŠ åè¿™ç§æ¨¡å‹ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p><p>åœ¨ Java è™šæ‹Ÿæœºä¸­ï¼Œçº¿ç¨‹æ˜¯å®è´µçš„èµ„æºï¼Œçº¿ç¨‹çš„åˆ›å»ºå’Œé”€æ¯æˆæœ¬å¾ˆé«˜ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œçº¿ç¨‹çš„åˆ‡æ¢æˆæœ¬ä¹Ÿæ˜¯å¾ˆé«˜çš„ã€‚å°¤å…¶åœ¨ Linux è¿™æ ·çš„æ“ä½œç³»ç»Ÿä¸­ï¼Œçº¿ç¨‹æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œåˆ›å»ºå’Œé”€æ¯çº¿ç¨‹éƒ½æ˜¯é‡é‡çº§çš„ç³»ç»Ÿå‡½æ•°ã€‚å¦‚æœå¹¶å‘è®¿é—®é‡å¢åŠ ä¼šå¯¼è‡´çº¿ç¨‹æ•°æ€¥å‰§è†¨èƒ€å¯èƒ½ä¼šå¯¼è‡´çº¿ç¨‹å †æ ˆæº¢å‡ºã€åˆ›å»ºæ–°çº¿ç¨‹å¤±è´¥ç­‰é—®é¢˜ï¼Œæœ€ç»ˆå¯¼è‡´è¿›ç¨‹å®•æœºæˆ–è€…åƒµæ­»ï¼Œä¸èƒ½å¯¹å¤–æä¾›æœåŠ¡ã€‚</p><h3 id="ä¼ªå¼‚æ­¥-IO"><a href="#ä¼ªå¼‚æ­¥-IO" class="headerlink" title="ä¼ªå¼‚æ­¥ IO"></a>ä¼ªå¼‚æ­¥ IO</h3><p>ä¸ºäº†è§£å†³åŒæ­¥é˜»å¡I/Oé¢ä¸´çš„ä¸€ä¸ªé“¾è·¯éœ€è¦ä¸€ä¸ªçº¿ç¨‹å¤„ç†çš„é—®é¢˜ï¼Œåæ¥æœ‰äººå¯¹å®ƒçš„çº¿ç¨‹æ¨¡å‹è¿›è¡Œäº†ä¼˜åŒ–ä¸€ä¸€ä¸€åç«¯é€šè¿‡ä¸€ä¸ªçº¿ç¨‹æ± æ¥å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚æ¥å…¥ï¼Œå½¢æˆå®¢æˆ·ç«¯ä¸ªæ•°Mï¼šçº¿ç¨‹æ± æœ€å¤§çº¿ç¨‹æ•°Nçš„æ¯”ä¾‹å…³ç³»ï¼Œå…¶ä¸­Må¯ä»¥è¿œè¿œå¤§äºN.é€šè¿‡çº¿ç¨‹æ± å¯ä»¥çµæ´»åœ°è°ƒé…çº¿ç¨‹èµ„æºï¼Œè®¾ç½®çº¿ç¨‹çš„æœ€å¤§å€¼ï¼Œé˜²æ­¢ç”±äºæµ·é‡å¹¶å‘æ¥å…¥å¯¼è‡´çº¿ç¨‹è€—å°½ã€‚</p><p>ä¼ªå¼‚æ­¥IOæ¨¡å‹å›¾(å›¾æºç½‘ç»œï¼ŒåŸå‡ºå¤„ä¸æ˜)ï¼š<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/small-20210321160958899.png" alt="3">é‡‡ç”¨çº¿ç¨‹æ± å’Œä»»åŠ¡é˜Ÿåˆ—å¯ä»¥å®ç°ä¸€ç§å«åšä¼ªå¼‚æ­¥çš„ I/O é€šä¿¡æ¡†æ¶ï¼Œå®ƒçš„æ¨¡å‹å›¾å¦‚ä¸Šå›¾æ‰€ç¤ºã€‚å½“æœ‰æ–°çš„å®¢æˆ·ç«¯æ¥å…¥æ—¶ï¼Œå°†å®¢æˆ·ç«¯çš„ Socket å°è£…æˆä¸€ä¸ªTaskï¼ˆè¯¥ä»»åŠ¡å®ç°java.lang.Runnableæ¥å£ï¼‰æŠ•é€’åˆ°åç«¯çš„çº¿ç¨‹æ± ä¸­è¿›è¡Œå¤„ç†ï¼ŒJDK çš„çº¿ç¨‹æ± ç»´æŠ¤ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—å’Œ N ä¸ªæ´»è·ƒçº¿ç¨‹ï¼Œå¯¹æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡è¿›è¡Œå¤„ç†ã€‚ç”±äºçº¿ç¨‹æ± å¯ä»¥è®¾ç½®æ¶ˆæ¯é˜Ÿåˆ—çš„å¤§å°å’Œæœ€å¤§çº¿ç¨‹æ•°ï¼Œå› æ­¤ï¼Œå®ƒçš„èµ„æºå ç”¨æ˜¯å¯æ§çš„ï¼Œæ— è®ºå¤šå°‘ä¸ªå®¢æˆ·ç«¯å¹¶å‘è®¿é—®ï¼Œéƒ½ä¸ä¼šå¯¼è‡´èµ„æºçš„è€—å°½å’Œå®•æœºã€‚</p><p>ä¼ªå¼‚æ­¥I/Oé€šä¿¡æ¡†æ¶é‡‡ç”¨äº†çº¿ç¨‹æ± å®ç°ï¼Œå› æ­¤é¿å…äº†ä¸ºæ¯ä¸ªè¯·æ±‚éƒ½åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çº¿ç¨‹é€ æˆçš„çº¿ç¨‹èµ„æºè€—å°½é—®é¢˜ã€‚ä¸è¿‡å› ä¸ºå®ƒçš„åº•å±‚ä»ç„¶æ˜¯åŒæ­¥é˜»å¡çš„BIOæ¨¡å‹ï¼Œå› æ­¤æ— æ³•ä»æ ¹æœ¬ä¸Šè§£å†³é—®é¢˜ã€‚</p><h2 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h2><p>ä¸‹é¢ä»£ç ä¸­æ¼”ç¤ºäº†BIOé€šä¿¡ï¼ˆä¸€è¯·æ±‚ä¸€åº”ç­”ï¼‰æ¨¡å‹ã€‚æˆ‘ä»¬ä¼šåœ¨å®¢æˆ·ç«¯åˆ›å»ºå¤šä¸ªçº¿ç¨‹ä¾æ¬¡è¿æ¥æœåŠ¡ç«¯å¹¶å‘å…¶å‘é€â€å½“å‰æ—¶é—´+:hello worldâ€ï¼ŒæœåŠ¡ç«¯ä¼šä¸ºæ¯ä¸ªå®¢æˆ·ç«¯çº¿ç¨‹åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†ã€‚ä»£ç ç¤ºä¾‹å‡ºè‡ªé—ªç”µä¾ çš„åšå®¢ï¼ŒåŸåœ°å€å¦‚ä¸‹ï¼š</p><p><a href="https://www.jianshu.com/p/a4e03835921a">https://www.jianshu.com/p/a4e03835921a</a> å®¢æˆ·ç«¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> é—ªç”µä¾ </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> 2018å¹´10æœˆ14æ—¥</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Description</span>:å®¢æˆ·ç«¯</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IOClient</span> </span>&#123;<br> <br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>    <span class="hljs-comment">// TODO åˆ›å»ºå¤šä¸ªçº¿ç¨‹ï¼Œæ¨¡æ‹Ÿå¤šä¸ªå®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯</span><br>    <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;<br>      <span class="hljs-keyword">try</span> &#123;<br>        Socket socket = <span class="hljs-keyword">new</span> Socket(<span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-number">3333</span>);<br>        <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;<br>          <span class="hljs-keyword">try</span> &#123;<br>            socket.getOutputStream().write((<span class="hljs-keyword">new</span> Date() + <span class="hljs-string">&quot;: hello world&quot;</span>).getBytes());<br>            Thread.sleep(<span class="hljs-number">2000</span>);<br>          &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>          &#125;<br>        &#125;<br>      &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>      &#125;<br>    &#125;).start();<br> <br>  &#125;<br> <br>&#125;<br></code></pre></td></tr></table></figure><p>æœåŠ¡ç«¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> é—ªç”µä¾ </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> 2018å¹´10æœˆ14æ—¥</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Description</span>: æœåŠ¡ç«¯</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IOServer</span> </span>&#123;<br> <br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>    <span class="hljs-comment">// TODO æœåŠ¡ç«¯å¤„ç†å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚</span><br>    ServerSocket serverSocket = <span class="hljs-keyword">new</span> ServerSocket(<span class="hljs-number">3333</span>);<br> <br>    <span class="hljs-comment">// æ¥æ”¶åˆ°å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚ä¹‹åä¸ºæ¯ä¸ªå®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹è¿›è¡Œé“¾è·¯å¤„ç†</span><br>    <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;<br>      <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>          <span class="hljs-comment">// é˜»å¡æ–¹æ³•è·å–æ–°çš„è¿æ¥</span><br>          Socket socket = serverSocket.accept();<br> <br>          <span class="hljs-comment">// æ¯ä¸€ä¸ªæ–°çš„è¿æ¥éƒ½åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œè´Ÿè´£è¯»å–æ•°æ®</span><br>          <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>              <span class="hljs-keyword">int</span> len;<br>              <span class="hljs-keyword">byte</span>[] data = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">1024</span>];<br>              InputStream inputStream = socket.getInputStream();<br>              <span class="hljs-comment">// æŒ‰å­—èŠ‚æµæ–¹å¼è¯»å–æ•°æ®</span><br>              <span class="hljs-keyword">while</span> ((len = inputStream.read(data)) != -<span class="hljs-number">1</span>) &#123;<br>                System.out.println(<span class="hljs-keyword">new</span> String(data, <span class="hljs-number">0</span>, len));<br>              &#125;<br>            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            &#125;<br>          &#125;).start();<br> <br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>        &#125;<br> <br>      &#125;<br>    &#125;).start();<br> <br>  &#125;<br> <br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åœ¨æ´»åŠ¨è¿æ¥æ•°ä¸æ˜¯ç‰¹åˆ«é«˜ï¼ˆå°äºå•æœº1000ï¼‰çš„æƒ…å†µä¸‹ï¼Œè¿™ç§æ¨¡å‹æ˜¯æ¯”è¾ƒä¸é”™çš„ï¼Œå¯ä»¥è®©æ¯ä¸€ä¸ªè¿æ¥ä¸“æ³¨äºè‡ªå·±çš„ I/O å¹¶ä¸”ç¼–ç¨‹æ¨¡å‹ç®€å•ï¼Œä¹Ÿä¸ç”¨è¿‡å¤šè€ƒè™‘ç³»ç»Ÿçš„è¿‡è½½ã€é™æµç­‰é—®é¢˜ã€‚çº¿ç¨‹æ± æœ¬èº«å°±æ˜¯ä¸€ä¸ªå¤©ç„¶çš„æ¼æ–—ï¼Œå¯ä»¥ç¼“å†²ä¸€äº›ç³»ç»Ÿå¤„ç†ä¸äº†çš„è¿æ¥æˆ–è¯·æ±‚ã€‚ä½†æ˜¯ï¼Œå½“é¢å¯¹åä¸‡ç”šè‡³ç™¾ä¸‡çº§è¿æ¥çš„æ—¶å€™ï¼Œä¼ ç»Ÿçš„ BIO æ¨¡å‹æ˜¯æ— èƒ½ä¸ºåŠ›çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ›´é«˜æ•ˆçš„ I/O å¤„ç†æ¨¡å‹æ¥åº”å¯¹æ›´é«˜çš„å¹¶å‘é‡ã€‚</p><p><a href="https://bk.cuixiaoyan.xyz/archives/BIO#bio-blocking-io">BIO (Blocking I/O)</a><a href="https://bk.cuixiaoyan.xyz/archives/BIO#%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B">ä»£ç ç¤ºä¾‹</a><a href="https://bk.cuixiaoyan.xyz/archives/BIO#%E6%80%BB%E7%BB%93">æ€»ç»“</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ä¹è§‚é”çš„ç¼ºç‚¹</title>
    <link href="/blog/2021/03/21/%E4%B9%90%E8%A7%82%E9%94%81%E7%9A%84%E7%BC%BA%E7%82%B9/"/>
    <url>/blog/2021/03/21/%E4%B9%90%E8%A7%82%E9%94%81%E7%9A%84%E7%BC%BA%E7%82%B9/</url>
    
    <content type="html"><![CDATA[<h2 id="ABA-é—®é¢˜"><a href="#ABA-é—®é¢˜" class="headerlink" title="ABA é—®é¢˜"></a>ABA é—®é¢˜</h2><p>å¦‚æœä¸€ä¸ªå˜é‡Våˆæ¬¡è¯»å–çš„æ—¶å€™æ˜¯Aå€¼ï¼Œå¹¶ä¸”åœ¨å‡†å¤‡èµ‹å€¼çš„æ—¶å€™æ£€æŸ¥åˆ°å®ƒä»ç„¶æ˜¯Aå€¼ï¼Œé‚£æˆ‘ä»¬å°±èƒ½è¯´æ˜å®ƒçš„å€¼æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹è¿‡äº†å—ï¼Ÿå¾ˆæ˜æ˜¾æ˜¯ä¸èƒ½çš„ï¼Œå› ä¸ºåœ¨è¿™æ®µæ—¶é—´å®ƒçš„å€¼å¯èƒ½è¢«æ”¹ä¸ºå…¶ä»–å€¼ï¼Œç„¶ååˆæ”¹å›Aï¼Œé‚£CASæ“ä½œå°±ä¼šè¯¯è®¤ä¸ºå®ƒä»æ¥æ²¡æœ‰è¢«ä¿®æ”¹è¿‡ã€‚è¿™ä¸ªé—®é¢˜è¢«ç§°ä¸ºCASæ“ä½œçš„ â€œABAâ€é—®é¢˜ã€‚</p><p>JDK 1.5 ä»¥åçš„ AtomicStampedReference ç±»å°±æä¾›äº†æ­¤ç§èƒ½åŠ›ï¼Œå…¶ä¸­çš„ compareAndSet æ–¹æ³•å°±æ˜¯é¦–å…ˆæ£€æŸ¥å½“å‰å¼•ç”¨æ˜¯å¦ç­‰äºé¢„æœŸå¼•ç”¨ï¼Œå¹¶ä¸”å½“å‰æ ‡å¿—æ˜¯å¦ç­‰äºé¢„æœŸæ ‡å¿—ï¼Œå¦‚æœå…¨éƒ¨ç›¸ç­‰ï¼Œåˆ™ä»¥åŸå­æ–¹å¼å°†è¯¥å¼•ç”¨å’Œè¯¥æ ‡å¿—çš„å€¼è®¾ç½®ä¸ºç»™å®šçš„æ›´æ–°å€¼ã€‚</p><h2 id="å¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§"><a href="#å¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§" class="headerlink" title="å¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§"></a>å¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§</h2><p>è‡ªæ—‹CASï¼ˆä¹Ÿå°±æ˜¯ä¸æˆåŠŸå°±ä¸€ç›´å¾ªç¯æ‰§è¡Œç›´åˆ°æˆåŠŸï¼‰å¦‚æœé•¿æ—¶é—´ä¸æˆåŠŸï¼Œä¼šç»™CPUå¸¦æ¥éå¸¸å¤§çš„æ‰§è¡Œå¼€é”€ã€‚ å¦‚æœJVMèƒ½æ”¯æŒå¤„ç†å™¨æä¾›çš„pauseæŒ‡ä»¤é‚£ä¹ˆæ•ˆç‡ä¼šæœ‰ä¸€å®šçš„æå‡ï¼ŒpauseæŒ‡ä»¤æœ‰ä¸¤ä¸ªä½œç”¨ï¼Œç¬¬ä¸€å®ƒå¯ä»¥å»¶è¿Ÿæµæ°´çº¿æ‰§è¡ŒæŒ‡ä»¤ï¼ˆde-pipelineï¼‰,ä½¿CPUä¸ä¼šæ¶ˆè€—è¿‡å¤šçš„æ‰§è¡Œèµ„æºï¼Œå»¶è¿Ÿçš„æ—¶é—´å–å†³äºå…·ä½“å®ç°çš„ç‰ˆæœ¬ï¼Œåœ¨ä¸€äº›å¤„ç†å™¨ä¸Šå»¶è¿Ÿæ—¶é—´æ˜¯é›¶ã€‚ç¬¬äºŒå®ƒå¯ä»¥é¿å…åœ¨é€€å‡ºå¾ªç¯çš„æ—¶å€™å› å†…å­˜é¡ºåºå†²çªï¼ˆmemory order violationï¼‰è€Œå¼•èµ·CPUæµæ°´çº¿è¢«æ¸…ç©ºï¼ˆCPU pipeline flushï¼‰ï¼Œä»è€Œæé«˜CPUçš„æ‰§è¡Œæ•ˆç‡ã€‚</p><h2 id="åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œ"><a href="#åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œ" class="headerlink" title="åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œ"></a>åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œ</h2><p>CAS åªå¯¹å•ä¸ªå…±äº«å˜é‡æœ‰æ•ˆï¼Œå½“æ“ä½œæ¶‰åŠè·¨å¤šä¸ªå…±äº«å˜é‡æ—¶ CAS æ— æ•ˆã€‚ä½†æ˜¯ä» JDK 1.5å¼€å§‹ï¼Œæä¾›äº†AtomicReferenceç±»æ¥ä¿è¯å¼•ç”¨å¯¹è±¡ä¹‹é—´çš„åŸå­æ€§ï¼Œä½ å¯ä»¥æŠŠå¤šä¸ªå˜é‡æ”¾åœ¨ä¸€ä¸ªå¯¹è±¡é‡Œæ¥è¿›è¡Œ CAS æ“ä½œ.æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨é”æˆ–è€…åˆ©ç”¨AtomicReferenceç±»æŠŠå¤šä¸ªå…±äº«å˜é‡åˆå¹¶æˆä¸€ä¸ªå…±äº«å˜é‡æ¥æ“ä½œã€‚</p><h2 id="CASä¸synchronizedçš„ä½¿ç”¨æƒ…æ™¯"><a href="#CASä¸synchronizedçš„ä½¿ç”¨æƒ…æ™¯" class="headerlink" title="CASä¸synchronizedçš„ä½¿ç”¨æƒ…æ™¯"></a>CASä¸synchronizedçš„ä½¿ç”¨æƒ…æ™¯</h2><p>ç®€å•çš„æ¥è¯´CASé€‚ç”¨äºå†™æ¯”è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼ˆå¤šè¯»åœºæ™¯ï¼Œå†²çªä¸€èˆ¬è¾ƒå°‘ï¼‰ï¼Œsynchronizedé€‚ç”¨äºå†™æ¯”è¾ƒå¤šçš„æƒ…å†µä¸‹ï¼ˆå¤šå†™åœºæ™¯ï¼Œå†²çªä¸€èˆ¬è¾ƒå¤šï¼‰</p><ol><li>å¯¹äºèµ„æºç«äº‰è¾ƒå°‘ï¼ˆçº¿ç¨‹å†²çªè¾ƒè½»ï¼‰çš„æƒ…å†µï¼Œä½¿ç”¨synchronizedåŒæ­¥é”è¿›è¡Œçº¿ç¨‹é˜»å¡å’Œå”¤é†’åˆ‡æ¢ä»¥åŠç”¨æˆ·æ€å†…æ ¸æ€é—´çš„åˆ‡æ¢æ“ä½œé¢å¤–æµªè´¹æ¶ˆè€—cpuèµ„æºï¼›è€ŒCASåŸºäºç¡¬ä»¶å®ç°ï¼Œä¸éœ€è¦è¿›å…¥å†…æ ¸ï¼Œä¸éœ€è¦åˆ‡æ¢çº¿ç¨‹ï¼Œæ“ä½œè‡ªæ—‹å‡ ç‡è¾ƒå°‘ï¼Œå› æ­¤å¯ä»¥è·å¾—æ›´é«˜çš„æ€§èƒ½ã€‚</li><li>å¯¹äºèµ„æºç«äº‰ä¸¥é‡ï¼ˆçº¿ç¨‹å†²çªä¸¥é‡ï¼‰çš„æƒ…å†µï¼ŒCASè‡ªæ—‹çš„æ¦‚ç‡ä¼šæ¯”è¾ƒå¤§ï¼Œä»è€Œæµªè´¹æ›´å¤šçš„CPUèµ„æºï¼Œæ•ˆç‡ä½äºsynchronizedã€‚ è¡¥å……ï¼š Javaå¹¶å‘ç¼–ç¨‹è¿™ä¸ªé¢†åŸŸä¸­synchronizedå…³é”®å­—ä¸€ç›´éƒ½æ˜¯å…ƒè€çº§çš„è§’è‰²ï¼Œå¾ˆä¹…ä¹‹å‰å¾ˆå¤šäººéƒ½ä¼šç§°å®ƒä¸º â€œé‡é‡çº§é”â€ ã€‚ä½†æ˜¯ï¼Œåœ¨JavaSE 1.6ä¹‹åè¿›è¡Œäº†ä¸»è¦åŒ…æ‹¬ä¸ºäº†å‡å°‘è·å¾—é”å’Œé‡Šæ”¾é”å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—è€Œå¼•å…¥çš„ åå‘é” å’Œ è½»é‡çº§é” ä»¥åŠå…¶å®ƒå„ç§ä¼˜åŒ–ä¹‹åå˜å¾—åœ¨æŸäº›æƒ…å†µä¸‹å¹¶ä¸æ˜¯é‚£ä¹ˆé‡äº†ã€‚synchronizedçš„åº•å±‚å®ç°ä¸»è¦ä¾é  Lock-Free çš„é˜Ÿåˆ—ï¼ŒåŸºæœ¬æ€è·¯æ˜¯ è‡ªæ—‹åé˜»å¡ï¼Œç«äº‰åˆ‡æ¢åç»§ç»­ç«äº‰é”ï¼Œç¨å¾®ç‰ºç‰²äº†å…¬å¹³æ€§ï¼Œä½†è·å¾—äº†é«˜ååé‡ã€‚åœ¨çº¿ç¨‹å†²çªè¾ƒå°‘çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥è·å¾—å’ŒCASç±»ä¼¼çš„æ€§èƒ½ï¼›è€Œçº¿ç¨‹å†²çªä¸¥é‡çš„æƒ…å†µä¸‹ï¼Œæ€§èƒ½è¿œé«˜äºCASã€‚</li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>ä¹è§‚é”</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½•è°“æ‚²è§‚é”ä¸ä¹è§‚é”</title>
    <link href="/blog/2021/03/21/%E4%BD%95%E8%B0%93%E6%82%B2%E8%A7%82%E9%94%81%E4%B8%8E%E4%B9%90%E8%A7%82%E9%94%81/"/>
    <url>/blog/2021/03/21/%E4%BD%95%E8%B0%93%E6%82%B2%E8%A7%82%E9%94%81%E4%B8%8E%E4%B9%90%E8%A7%82%E9%94%81/</url>
    
    <content type="html"><![CDATA[<p>ä¹è§‚é”å¯¹åº”äºç”Ÿæ´»ä¸­ä¹è§‚çš„äººæ€»æ˜¯æƒ³ç€äº‹æƒ…å¾€å¥½çš„æ–¹å‘å‘å±•ï¼Œæ‚²è§‚é”å¯¹åº”äºç”Ÿæ´»ä¸­æ‚²è§‚çš„äººæ€»æ˜¯æƒ³ç€äº‹æƒ…å¾€åçš„æ–¹å‘å‘å±•ã€‚è¿™ä¸¤ç§äººå„æœ‰ä¼˜ç¼ºç‚¹ï¼Œä¸èƒ½ä¸ä»¥åœºæ™¯è€Œå®šè¯´ä¸€ç§äººå¥½äºå¦å¤–ä¸€ç§äººã€‚</p><h2 id="æ‚²è§‚é”"><a href="#æ‚²è§‚é”" class="headerlink" title="æ‚²è§‚é”"></a>æ‚²è§‚é”</h2><p>æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼šé˜»å¡ç›´åˆ°å®ƒæ‹¿åˆ°é”ï¼ˆå…±äº«èµ„æºæ¯æ¬¡åªç»™ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œå…¶å®ƒçº¿ç¨‹é˜»å¡ï¼Œç”¨å®Œåå†æŠŠèµ„æºè½¬è®©ç»™å…¶å®ƒçº¿ç¨‹ï¼‰ã€‚ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“é‡Œè¾¹å°±ç”¨åˆ°äº†å¾ˆå¤šè¿™ç§é”æœºåˆ¶ï¼Œæ¯”å¦‚è¡Œé”ï¼Œè¡¨é”ç­‰ï¼Œè¯»é”ï¼Œå†™é”ç­‰ï¼Œéƒ½æ˜¯åœ¨åšæ“ä½œä¹‹å‰å…ˆä¸Šé”ã€‚Javaä¸­synchronizedå’ŒReentrantLockç­‰ç‹¬å é”å°±æ˜¯æ‚²è§‚é”æ€æƒ³çš„å®ç°ã€‚</p><h2 id="ä¹è§‚é”"><a href="#ä¹è§‚é”" class="headerlink" title="ä¹è§‚é”"></a>ä¹è§‚é”</h2><p>æ€»æ˜¯å‡è®¾æœ€å¥½çš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å·æœºåˆ¶å’ŒCASç®—æ³•å®ç°ã€‚ä¹è§‚é”é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œè¿™æ ·å¯ä»¥æé«˜ååé‡ï¼Œåƒæ•°æ®åº“æä¾›çš„ç±»ä¼¼äºwrite_conditionæœºåˆ¶ï¼Œå…¶å®éƒ½æ˜¯æä¾›çš„ä¹è§‚é”ã€‚åœ¨Javaä¸­java.util.concurrent.atomicåŒ…ä¸‹é¢çš„åŸå­å˜é‡ç±»å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é”çš„ä¸€ç§å®ç°æ–¹å¼CASå®ç°çš„ã€‚</p><h2 id="ä¸¤ç§é”çš„ä½¿ç”¨åœºæ™¯"><a href="#ä¸¤ç§é”çš„ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä¸¤ç§é”çš„ä½¿ç”¨åœºæ™¯"></a>ä¸¤ç§é”çš„ä½¿ç”¨åœºæ™¯</h2><p>ä»ä¸Šé¢å¯¹ä¸¤ç§é”çš„ä»‹ç»ï¼Œæˆ‘ä»¬çŸ¥é“ä¸¤ç§é”å„æœ‰ä¼˜ç¼ºç‚¹ï¼Œä¸å¯è®¤ä¸ºä¸€ç§å¥½äºå¦ä¸€ç§ï¼Œåƒä¹è§‚é”é€‚ç”¨äºå†™æ¯”è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼ˆå¤šè¯»åœºæ™¯ï¼‰ï¼Œå³å†²çªçœŸçš„å¾ˆå°‘å‘ç”Ÿçš„æ—¶å€™ï¼Œè¿™æ ·å¯ä»¥çœå»äº†é”çš„å¼€é”€ï¼ŒåŠ å¤§äº†ç³»ç»Ÿçš„æ•´ä¸ªååé‡ã€‚ä½†å¦‚æœæ˜¯å¤šå†™çš„æƒ…å†µï¼Œä¸€èˆ¬ä¼šç»å¸¸äº§ç”Ÿå†²çªï¼Œè¿™å°±ä¼šå¯¼è‡´ä¸Šå±‚åº”ç”¨ä¼šä¸æ–­çš„è¿›è¡Œretryï¼Œè¿™æ ·åå€’æ˜¯é™ä½äº†æ€§èƒ½ï¼Œæ‰€ä»¥ä¸€èˆ¬å¤šå†™çš„åœºæ™¯ä¸‹ç”¨æ‚²è§‚é”å°±æ¯”è¾ƒåˆé€‚ã€‚</p><p>ä¹è§‚é”å¸¸è§çš„ä¸¤ç§å®ç°æ–¹å¼ ä¹è§‚é”ä¸€èˆ¬ä¼šä½¿ç”¨ç‰ˆæœ¬å·æœºåˆ¶æˆ–CASç®—æ³•å®ç°ã€‚</p><h3 id="ç‰ˆæœ¬å·æœºåˆ¶"><a href="#ç‰ˆæœ¬å·æœºåˆ¶" class="headerlink" title="ç‰ˆæœ¬å·æœºåˆ¶"></a>ç‰ˆæœ¬å·æœºåˆ¶</h3><p>ä¸€èˆ¬æ˜¯åœ¨æ•°æ®è¡¨ä¸­åŠ ä¸Šä¸€ä¸ªæ•°æ®ç‰ˆæœ¬å·versionå­—æ®µï¼Œè¡¨ç¤ºæ•°æ®è¢«ä¿®æ”¹çš„æ¬¡æ•°ï¼Œå½“æ•°æ®è¢«ä¿®æ”¹æ—¶ï¼Œversionå€¼ä¼šåŠ ä¸€ã€‚å½“çº¿ç¨‹Aè¦æ›´æ–°æ•°æ®å€¼æ—¶ï¼Œåœ¨è¯»å–æ•°æ®çš„åŒæ—¶ä¹Ÿä¼šè¯»å–versionå€¼ï¼Œåœ¨æäº¤æ›´æ–°æ—¶ï¼Œè‹¥åˆšæ‰è¯»å–åˆ°çš„versionå€¼ä¸ºå½“å‰æ•°æ®åº“ä¸­çš„versionå€¼ç›¸ç­‰æ—¶æ‰æ›´æ–°ï¼Œå¦åˆ™é‡è¯•æ›´æ–°æ“ä½œï¼Œç›´åˆ°æ›´æ–°æˆåŠŸã€‚</p><p>ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š å‡è®¾æ•°æ®åº“ä¸­å¸æˆ·ä¿¡æ¯è¡¨ä¸­æœ‰ä¸€ä¸ª version å­—æ®µï¼Œå½“å‰å€¼ä¸º 1 ï¼›è€Œå½“å‰å¸æˆ·ä½™é¢å­—æ®µï¼ˆ balance ï¼‰ä¸º $100 ã€‚</p><ol><li>æ“ä½œå‘˜ A æ­¤æ—¶å°†å…¶è¯»å‡ºï¼ˆ version=1 ï¼‰ï¼Œå¹¶ä»å…¶å¸æˆ·ä½™é¢ä¸­æ‰£é™¤ 50ï¼ˆ50ï¼ˆ100-$50 ï¼‰ã€‚</li><li>åœ¨æ“ä½œå‘˜ A æ“ä½œçš„è¿‡ç¨‹ä¸­ï¼Œæ“ä½œå‘˜B ä¹Ÿè¯»å…¥æ­¤ç”¨æˆ·ä¿¡æ¯ï¼ˆ version=1 ï¼‰ï¼Œå¹¶ä»å…¶å¸æˆ·ä½™é¢ä¸­æ‰£é™¤ 20 ï¼ˆ20ï¼ˆ100-$20 ï¼‰ã€‚</li><li>æ“ä½œå‘˜ A å®Œæˆäº†ä¿®æ”¹å·¥ä½œï¼Œå°†æ•°æ®ç‰ˆæœ¬å·åŠ ä¸€ï¼ˆ version=2 ï¼‰ï¼Œè¿åŒå¸æˆ·æ‰£é™¤åä½™é¢ï¼ˆ balance=$50 ï¼‰ï¼Œæäº¤è‡³æ•°æ®åº“æ›´æ–°ï¼Œæ­¤æ—¶ç”±äºæäº¤æ•°æ®ç‰ˆæœ¬å¤§äºæ•°æ®åº“è®°å½•å½“å‰ç‰ˆæœ¬ï¼Œæ•°æ®è¢«æ›´æ–°ï¼Œæ•°æ®åº“è®°å½• version æ›´æ–°ä¸º 2 ã€‚</li><li>æ“ä½œå‘˜ B å®Œæˆäº†æ“ä½œï¼Œä¹Ÿå°†ç‰ˆæœ¬å·åŠ ä¸€ï¼ˆ version=2 ï¼‰è¯•å›¾å‘æ•°æ®åº“æäº¤æ•°æ®ï¼ˆ balance=$80 ï¼‰ï¼Œä½†æ­¤æ—¶æ¯”å¯¹æ•°æ®åº“è®°å½•ç‰ˆæœ¬æ—¶å‘ç°ï¼Œæ“ä½œå‘˜ B æäº¤çš„æ•°æ®ç‰ˆæœ¬å·ä¸º 2 ï¼Œæ•°æ®åº“è®°å½•å½“å‰ç‰ˆæœ¬ä¹Ÿä¸º 2 ï¼Œä¸æ»¡è¶³ â€œ æäº¤ç‰ˆæœ¬å¿…é¡»å¤§äºè®°å½•å½“å‰ç‰ˆæœ¬æ‰èƒ½æ‰§è¡Œæ›´æ–° â€œ çš„ä¹è§‚é”ç­–ç•¥ï¼Œå› æ­¤ï¼Œæ“ä½œå‘˜ B çš„æäº¤è¢«é©³å›ã€‚ è¿™æ ·ï¼Œå°±é¿å…äº†æ“ä½œå‘˜ B ç”¨åŸºäº version=1 çš„æ—§æ•°æ®ä¿®æ”¹çš„ç»“æœè¦†ç›–æ“ä½œå‘˜A çš„æ“ä½œç»“æœçš„å¯èƒ½ã€‚</li></ol><h3 id="CASç®—æ³•"><a href="#CASç®—æ³•" class="headerlink" title="CASç®—æ³•"></a>CASç®—æ³•</h3><p>å³compare and swapï¼ˆæ¯”è¾ƒä¸äº¤æ¢ï¼‰ï¼Œæ˜¯ä¸€ç§æœ‰åçš„æ— é”ç®—æ³•ã€‚æ— é”ç¼–ç¨‹ï¼Œå³ä¸ä½¿ç”¨é”çš„æƒ…å†µä¸‹å®ç°å¤šçº¿ç¨‹ä¹‹é—´çš„å˜é‡åŒæ­¥ï¼Œä¹Ÿå°±æ˜¯åœ¨æ²¡æœ‰çº¿ç¨‹è¢«é˜»å¡çš„æƒ…å†µä¸‹å®ç°å˜é‡çš„åŒæ­¥ï¼Œæ‰€ä»¥ä¹Ÿå«éé˜»å¡åŒæ­¥ï¼ˆNon-blocking Synchronizationï¼‰ã€‚CASç®—æ³•æ¶‰åŠåˆ°ä¸‰ä¸ªæ“ä½œæ•°</p><p>éœ€è¦è¯»å†™çš„å†…å­˜å€¼ V è¿›è¡Œæ¯”è¾ƒçš„å€¼ A æ‹Ÿå†™å…¥çš„æ–°å€¼ B å½“ä¸”ä»…å½“ V çš„å€¼ç­‰äº Aæ—¶ï¼ŒCASé€šè¿‡åŸå­æ–¹å¼ç”¨æ–°å€¼Bæ¥æ›´æ–°Vçš„å€¼ï¼Œå¦åˆ™ä¸ä¼šæ‰§è¡Œä»»ä½•æ“ä½œï¼ˆæ¯”è¾ƒå’Œæ›¿æ¢æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼‰ã€‚ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ä¸€ä¸ªè‡ªæ—‹æ“ä½œï¼Œå³ä¸æ–­çš„é‡è¯•ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>ä¹è§‚é”</tag>
      
      <tag>æ‚²è§‚é”</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å‡ ç§å¸¸è§çš„çº¿ç¨‹æ± è¯¦è§£</title>
    <link href="/blog/2021/03/21/%E5%87%A0%E7%A7%8D%E5%B8%B8%E8%A7%81%E7%9A%84%E7%BA%BF%E7%A8%8B%E6%B1%A0%E8%AF%A6%E8%A7%A3/"/>
    <url>/blog/2021/03/21/%E5%87%A0%E7%A7%8D%E5%B8%B8%E8%A7%81%E7%9A%84%E7%BA%BF%E7%A8%8B%E6%B1%A0%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h2 id="FixedThreadPool"><a href="#FixedThreadPool" class="headerlink" title="FixedThreadPool"></a>FixedThreadPool</h2><p>FixedThreadPool è¢«ç§°ä¸ºå¯é‡ç”¨å›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± ã€‚é€šè¿‡ Executors ç±»ä¸­çš„ç›¸å…³æºä»£ç æ¥çœ‹ä¸€ä¸‹ç›¸å…³å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * åˆ›å»ºä¸€ä¸ªå¯é‡ç”¨å›ºå®šæ•°é‡çº¿ç¨‹çš„çº¿ç¨‹æ± </span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ExecutorService <span class="hljs-title">newFixedThreadPool</span><span class="hljs-params">(<span class="hljs-keyword">int</span> nThreads, ThreadFactory threadFactory)</span> </span>&#123;<br>       <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ThreadPoolExecutor(nThreads, nThreads,<br>                                     <span class="hljs-number">0L</span>, TimeUnit.MILLISECONDS,<br>                                     <span class="hljs-keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;(),<br>                                     threadFactory);<br>   &#125;<br></code></pre></td></tr></table></figure><p>å¦å¤–è¿˜æœ‰ä¸€ä¸ª FixedThreadPool çš„å®ç°æ–¹æ³•ï¼Œå’Œä¸Šé¢çš„ç±»ä¼¼ï¼Œæ‰€ä»¥è¿™é‡Œä¸å¤šåšé˜è¿°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ExecutorService <span class="hljs-title">newFixedThreadPool</span><span class="hljs-params">(<span class="hljs-keyword">int</span> nThreads)</span> </span>&#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ThreadPoolExecutor(nThreads, nThreads,<br>                                    <span class="hljs-number">0L</span>, TimeUnit.MILLISECONDS,<br>                                    <span class="hljs-keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;());<br>  &#125;<br></code></pre></td></tr></table></figure><p>ä»ä¸Šé¢æºä»£ç å¯ä»¥çœ‹å‡ºæ–°åˆ›å»ºçš„ FixedThreadPool çš„ corePoolSize å’Œ maximumPoolSize éƒ½è¢«è®¾ç½®ä¸º nThreadsï¼Œè¿™ä¸ª nThreads å‚æ•°æ˜¯æˆ‘ä»¬ä½¿ç”¨çš„æ—¶å€™è‡ªå·±ä¼ é€’çš„ã€‚</p><h2 id="æ‰§è¡Œä»»åŠ¡è¿‡ç¨‹ä»‹ç»"><a href="#æ‰§è¡Œä»»åŠ¡è¿‡ç¨‹ä»‹ç»" class="headerlink" title="æ‰§è¡Œä»»åŠ¡è¿‡ç¨‹ä»‹ç»"></a>æ‰§è¡Œä»»åŠ¡è¿‡ç¨‹ä»‹ç»</h2><p>FixedThreadPool çš„ execute() æ–¹æ³•è¿è¡Œç¤ºæ„å›¾ï¼ˆè¯¥å›¾ç‰‡æ¥æºï¼šã€ŠJava å¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹ï¼‰ï¼š<img src="https://cuixiaoyande.oss-cn-shanghai.aliyuncs.com/aHR0cDovL215LWJsb2ctdG8tdXNlLm9zcy1jbi1iZWlqaW5nLmFsaXl1bmNzLmNvbS8xOC00LTE2LzcxMzc1OTYzLmpwZw_1577067898214.jpeg?x-oss-process=style/small" alt="aHR0cDovL215LWJsb2ctdG8tdXNlLm9zcy1jbi1iZWlqaW5nLmFsaXl1bmNzLmNvbS8xOC00LTE2LzcxMzc1OTYzLmpwZw"></p><p>ä¸Šå›¾è¯´æ˜ï¼š</p><ol><li>å¦‚æœå½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°å°äº corePoolSizeï¼Œ å¦‚æœå†æ¥æ–°ä»»åŠ¡çš„è¯ï¼Œå°±åˆ›å»ºæ–°çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼›</li><li>å½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°ç­‰äº corePoolSize åï¼Œ å¦‚æœå†æ¥æ–°ä»»åŠ¡çš„è¯ï¼Œä¼šå°†ä»»åŠ¡åŠ å…¥ LinkedBlockingQueueï¼›</li><li>çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ‰§è¡Œå®Œ æ‰‹å¤´çš„ä»»åŠ¡åï¼Œä¼šåœ¨å¾ªç¯ä¸­åå¤ä» LinkedBlockingQueue ä¸­è·å–ä»»åŠ¡æ¥æ‰§è¡Œï¼›</li></ol><h2 id="ä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨FixedThreadPool"><a href="#ä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨FixedThreadPool" class="headerlink" title="ä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨FixedThreadPool"></a>ä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨FixedThreadPool</h2><p>FixedThreadPool ä½¿ç”¨æ— ç•Œé˜Ÿåˆ— LinkedBlockingQueueï¼ˆé˜Ÿåˆ—çš„å®¹é‡ä¸º Intger.MAX_VALUEï¼‰ä½œä¸ºçº¿ç¨‹æ± çš„å·¥ä½œé˜Ÿåˆ—ä¼šå¯¹çº¿ç¨‹æ± å¸¦æ¥å¦‚ä¸‹å½±å“ ï¼š</p><ol><li>å½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°è¾¾åˆ° corePoolSize åï¼Œæ–°ä»»åŠ¡å°†åœ¨æ— ç•Œé˜Ÿåˆ—ä¸­ç­‰å¾…ï¼Œå› æ­¤çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ä¸ä¼šè¶…è¿‡ corePoolSizeï¼›</li><li>ç”±äºä½¿ç”¨æ— ç•Œé˜Ÿåˆ—æ—¶ maximumPoolSize å°†æ˜¯ä¸€ä¸ªæ— æ•ˆå‚æ•°ï¼Œå› ä¸ºä¸å¯èƒ½å­˜åœ¨ä»»åŠ¡é˜Ÿåˆ—æ»¡çš„æƒ…å†µã€‚æ‰€ä»¥ï¼Œé€šè¿‡åˆ›å»º FixedThreadPoolçš„æºç å¯ä»¥çœ‹å‡ºåˆ›å»ºçš„ FixedThreadPool çš„ corePoolSize å’Œ maximumPoolSize è¢«è®¾ç½®ä¸ºåŒä¸€ä¸ªå€¼ã€‚</li><li>ç”±äº 1 å’Œ 2ï¼Œä½¿ç”¨æ— ç•Œé˜Ÿåˆ—æ—¶ keepAliveTime å°†æ˜¯ä¸€ä¸ªæ— æ•ˆå‚æ•°ï¼›</li><li>è¿è¡Œä¸­çš„ FixedThreadPoolï¼ˆæœªæ‰§è¡Œ shutdown()æˆ– shutdownNow()ï¼‰ä¸ä¼šæ‹’ç»ä»»åŠ¡ï¼Œåœ¨ä»»åŠ¡æ¯”è¾ƒå¤šçš„æ—¶å€™ä¼šå¯¼è‡´ OOMï¼ˆå†…å­˜æº¢å‡ºï¼‰ã€‚</li></ol><p><a href="https://bk.cuixiaoyan.xyz/archives/breakDown#fixedthreadpool">FixedThreadPool</a><a href="https://bk.cuixiaoyan.xyz/archives/breakDown#%E6%89%A7%E8%A1%8C%E4%BB%BB%E5%8A%A1%E8%BF%87%E7%A8%8B%E4%BB%8B%E7%BB%8D">æ‰§è¡Œä»»åŠ¡è¿‡ç¨‹ä»‹ç»</a><a href="https://bk.cuixiaoyan.xyz/archives/breakDown#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E6%8E%A8%E8%8D%90%E4%BD%BF%E7%94%A8fixedthreadpool">ä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨FixedThreadPool</a></p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/cuplogo-sm.png" alt="img">SupportShare</p>]]></content>
    
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>çº¿ç¨‹æ± </tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>çº¿ç¨‹æ± å‡ ä¸ªå¸¸è§çš„å¯¹æ¯”</title>
    <link href="/blog/2021/03/19/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%87%A0%E4%B8%AA%E5%B8%B8%E8%A7%81%E7%9A%84%E5%AF%B9%E6%AF%94/"/>
    <url>/blog/2021/03/19/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%87%A0%E4%B8%AA%E5%B8%B8%E8%A7%81%E7%9A%84%E5%AF%B9%E6%AF%94/</url>
    
    <content type="html"><![CDATA[<h2 id="Runnable-vs-Callable"><a href="#Runnable-vs-Callable" class="headerlink" title="Runnable vs Callable"></a>Runnable vs Callable</h2><p>Runnableè‡ª Java 1.0 ä»¥æ¥ä¸€ç›´å­˜åœ¨ï¼Œä½†Callableä»…åœ¨ Java 1.5 ä¸­å¼•å…¥,ç›®çš„å°±æ˜¯ä¸ºäº†æ¥å¤„ç†Runnableä¸æ”¯æŒçš„ç”¨ä¾‹ã€‚Runnable æ¥å£ä¸ä¼šè¿”å›ç»“æœæˆ–æŠ›å‡ºæ£€æŸ¥å¼‚å¸¸ï¼Œä½†æ˜¯Callable æ¥å£å¯ä»¥ã€‚æ‰€ä»¥ï¼Œå¦‚æœä»»åŠ¡ä¸éœ€è¦è¿”å›ç»“æœæˆ–æŠ›å‡ºå¼‚å¸¸æ¨èä½¿ç”¨ Runnable æ¥å£ï¼Œè¿™æ ·ä»£ç çœ‹èµ·æ¥ä¼šæ›´åŠ ç®€æ´ã€‚</p><p>å·¥å…·ç±» Executors å¯ä»¥å®ç° Runnable å¯¹è±¡å’Œ Callable å¯¹è±¡ä¹‹é—´çš„ç›¸äº’è½¬æ¢ã€‚ï¼ˆExecutors.callableï¼ˆRunnable taskï¼‰æˆ– Executors.callableï¼ˆRunnable taskï¼ŒObject resuleï¼‰ï¼‰ã€‚</p><p>Runnable.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@FunctionalInterface</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Runnable</span> </span>&#123;<br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * è¢«çº¿ç¨‹æ‰§è¡Œï¼Œæ²¡æœ‰è¿”å›å€¼ä¹Ÿæ— æ³•æŠ›å‡ºå¼‚å¸¸</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>Callable.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@FunctionalInterface</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Callable</span>&lt;<span class="hljs-title">V</span>&gt; </span>&#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è®¡ç®—ç»“æœï¼Œæˆ–åœ¨æ— æ³•è¿™æ ·åšæ—¶æŠ›å‡ºå¼‚å¸¸ã€‚</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> è®¡ç®—å¾—å‡ºçš„ç»“æœ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> å¦‚æœæ— æ³•è®¡ç®—ç»“æœï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function">V <span class="hljs-title">call</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="execute-vs-submit"><a href="#execute-vs-submit" class="headerlink" title="execute() vs submit()"></a>execute() vs submit()</h2><ol><li>execute()æ–¹æ³•ç”¨äºæäº¤ä¸éœ€è¦è¿”å›å€¼çš„ä»»åŠ¡ï¼Œæ‰€ä»¥æ— æ³•åˆ¤æ–­ä»»åŠ¡æ˜¯å¦è¢«çº¿ç¨‹æ± æ‰§è¡ŒæˆåŠŸä¸å¦ï¼›</li><li>submit()æ–¹æ³•ç”¨äºæäº¤éœ€è¦è¿”å›å€¼çš„ä»»åŠ¡ã€‚çº¿ç¨‹æ± ä¼šè¿”å›ä¸€ä¸ª Future ç±»å‹çš„å¯¹è±¡ï¼Œé€šè¿‡è¿™ä¸ª Future å¯¹è±¡å¯ä»¥åˆ¤æ–­ä»»åŠ¡æ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ Future çš„ get()æ–¹æ³•æ¥è·å–è¿”å›å€¼ï¼Œget()æ–¹æ³•ä¼šé˜»å¡å½“å‰çº¿ç¨‹ç›´åˆ°ä»»åŠ¡å®Œæˆï¼Œè€Œä½¿ç”¨ getï¼ˆlong timeoutï¼ŒTimeUnit unitï¼‰æ–¹æ³•åˆ™ä¼šé˜»å¡å½“å‰çº¿ç¨‹ä¸€æ®µæ—¶é—´åç«‹å³è¿”å›ï¼Œè¿™æ—¶å€™æœ‰å¯èƒ½ä»»åŠ¡æ²¡æœ‰æ‰§è¡Œå®Œã€‚ æˆ‘ä»¬ä»¥AbstractExecutorServiceæ¥å£ä¸­çš„ä¸€ä¸ª submit æ–¹æ³•ä¸ºä¾‹å­æ¥çœ‹çœ‹æºä»£ç ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Future&lt;?&gt; submit(Runnable task) &#123;<br>       <span class="hljs-keyword">if</span> (task == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NullPointerException();<br>       RunnableFuture&lt;Void&gt; ftask = newTaskFor(task, <span class="hljs-keyword">null</span>);<br>       execute(ftask);<br>       <span class="hljs-keyword">return</span> ftask;<br>   &#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢æ–¹æ³•è°ƒç”¨çš„ newTaskFor æ–¹æ³•è¿”å›äº†ä¸€ä¸ª FutureTask å¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> &lt;T&gt; <span class="hljs-function">RunnableFuture&lt;T&gt; <span class="hljs-title">newTaskFor</span><span class="hljs-params">(Runnable runnable, T value)</span> </span>&#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FutureTask&lt;T&gt;(runnable, value);<br>  &#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å†æ¥çœ‹çœ‹execute()æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">execute</span><span class="hljs-params">(Runnable command)</span> </span>&#123;<br>     ...<br>   &#125;<br></code></pre></td></tr></table></figure><h2 id="shutdown-VSshutdownNow"><a href="#shutdown-VSshutdownNow" class="headerlink" title="shutdown()VSshutdownNow()"></a>shutdown()VSshutdownNow()</h2><ol><li>shutdownï¼ˆï¼‰ :å…³é—­çº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ± çš„çŠ¶æ€å˜ä¸º SHUTDOWNã€‚çº¿ç¨‹æ± ä¸å†æ¥å—æ–°ä»»åŠ¡äº†ï¼Œä½†æ˜¯é˜Ÿåˆ—é‡Œçš„ä»»åŠ¡å¾—æ‰§è¡Œå®Œæ¯•ã€‚</li><li>shutdownNowï¼ˆï¼‰ :å…³é—­çº¿ç¨‹æ± ï¼Œçº¿ç¨‹çš„çŠ¶æ€å˜ä¸º STOPã€‚çº¿ç¨‹æ± ä¼šç»ˆæ­¢å½“å‰æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡ï¼Œå¹¶åœæ­¢å¤„ç†æ’é˜Ÿçš„ä»»åŠ¡å¹¶è¿”å›æ­£åœ¨ç­‰å¾…æ‰§è¡Œçš„ Listã€‚</li></ol><h2 id="isTerminated-VS-isShutdown"><a href="#isTerminated-VS-isShutdown" class="headerlink" title="isTerminated() VS isShutdown()"></a>isTerminated() VS isShutdown()</h2><ol><li>isShutDown å½“è°ƒç”¨ shutdown() æ–¹æ³•åè¿”å›ä¸º trueã€‚</li><li>isTerminated å½“è°ƒç”¨ shutdown() æ–¹æ³•åï¼Œå¹¶ä¸”æ‰€æœ‰æäº¤çš„ä»»åŠ¡å®Œæˆåè¿”å›ä¸º true</li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>çº¿ç¨‹æ± </tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ThreadPoolExecutorä½¿ç”¨ç¤ºä¾‹</title>
    <link href="/blog/2021/03/19/ThreadPoolExecutor%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B/"/>
    <url>/blog/2021/03/19/ThreadPoolExecutor%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B/</url>
    
    <content type="html"><![CDATA[<p>æˆ‘ä»¬ä¸Šé¢è®²è§£äº† Executoræ¡†æ¶ä»¥åŠ ThreadPoolExecutor ç±»ï¼Œä¸‹é¢è®©æˆ‘ä»¬å®æˆ˜ä¸€ä¸‹ï¼Œæ¥é€šè¿‡å†™ä¸€ä¸ª ThreadPoolExecutor çš„å° Demo æ¥å›é¡¾ä¸Šé¢çš„å†…å®¹ã€‚</p><h2 id="ç¤ºä¾‹ä»£ç -Runnable-ThreadPoolExecutor"><a href="#ç¤ºä¾‹ä»£ç -Runnable-ThreadPoolExecutor" class="headerlink" title="ç¤ºä¾‹ä»£ç :Runnable+ThreadPoolExecutor"></a>ç¤ºä¾‹ä»£ç :Runnable+ThreadPoolExecutor</h2><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ª Runnable æ¥å£çš„å®ç°ç±»ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥æ˜¯ Callable æ¥å£ï¼Œæˆ‘ä»¬ä¸Šé¢ä¹Ÿè¯´äº†ä¸¤è€…çš„åŒºåˆ«ã€‚ï¼‰</p><p>MyRunnable.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.Date;<br> <br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è¿™æ˜¯ä¸€ä¸ªç®€å•çš„Runnableç±»ï¼Œéœ€è¦å¤§çº¦5ç§’é’Ÿæ¥æ‰§è¡Œå…¶ä»»åŠ¡ã€‚</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> shuang.kou</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyRunnable</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Runnable</span> </span>&#123;<br> <br>    <span class="hljs-keyword">private</span> String command;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MyRunnable</span><span class="hljs-params">(String s)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.command = s;<br>    &#125;<br> <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot; Start. Time = &quot;</span> + <span class="hljs-keyword">new</span> Date());<br>        processCommand();<br>        System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot; End. Time = &quot;</span> + <span class="hljs-keyword">new</span> Date());<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">processCommand</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Thread.sleep(<span class="hljs-number">5000</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br> <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.command;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç¼–å†™æµ‹è¯•ç¨‹åºï¼Œæˆ‘ä»¬è¿™é‡Œä»¥é˜¿é‡Œå·´å·´æ¨èçš„ä½¿ç”¨ ThreadPoolExecutor æ„é€ å‡½æ•°è‡ªå®šä¹‰å‚æ•°çš„æ–¹å¼æ¥åˆ›å»ºçº¿ç¨‹æ± ã€‚</p><p>ThreadPoolExecutorDemo.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.concurrent.ArrayBlockingQueue;<br><span class="hljs-keyword">import</span> java.util.concurrent.ThreadPoolExecutor;<br><span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;<br> <br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThreadPoolExecutorDemo</span> </span>&#123;<br> <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> CORE_POOL_SIZE = <span class="hljs-number">5</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> MAX_POOL_SIZE = <span class="hljs-number">10</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> QUEUE_CAPACITY = <span class="hljs-number">100</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Long KEEP_ALIVE_TIME = <span class="hljs-number">1L</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br> <br>        <span class="hljs-comment">//ä½¿ç”¨é˜¿é‡Œå·´å·´æ¨èçš„åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹å¼</span><br>        <span class="hljs-comment">//é€šè¿‡ThreadPoolExecutoræ„é€ å‡½æ•°è‡ªå®šä¹‰å‚æ•°åˆ›å»º</span><br>        ThreadPoolExecutor executor = <span class="hljs-keyword">new</span> ThreadPoolExecutor(<br>                CORE_POOL_SIZE,<br>                MAX_POOL_SIZE,<br>                KEEP_ALIVE_TIME,<br>                TimeUnit.SECONDS,<br>                <span class="hljs-keyword">new</span> ArrayBlockingQueue&lt;&gt;(QUEUE_CAPACITY),<br>                <span class="hljs-keyword">new</span> ThreadPoolExecutor.CallerRunsPolicy());<br> <br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>            <span class="hljs-comment">//åˆ›å»ºWorkerThreadå¯¹è±¡ï¼ˆWorkerThreadç±»å®ç°äº†Runnable æ¥å£ï¼‰</span><br>            Runnable worker = <span class="hljs-keyword">new</span> MyRunnable(<span class="hljs-string">&quot;&quot;</span> + i);<br>            <span class="hljs-comment">//æ‰§è¡ŒRunnable</span><br>            executor.execute(worker);<br>        &#125;<br>        <span class="hljs-comment">//ç»ˆæ­¢çº¿ç¨‹æ± </span><br>        executor.shutdown();<br>        <span class="hljs-keyword">while</span> (!executor.isTerminated()) &#123;<br>        &#125;<br>        System.out.println(<span class="hljs-string">&quot;Finished all threads&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä¸Šé¢çš„ä»£ç æŒ‡å®šäº†ï¼š</p><ol><li>corePoolSize: æ ¸å¿ƒçº¿ç¨‹æ•°ä¸º 5ã€‚</li><li>maximumPoolSize ï¼šæœ€å¤§çº¿ç¨‹æ•° 10</li><li>keepAliveTime : ç­‰å¾…æ—¶é—´ä¸º 1Lã€‚</li><li>unit: ç­‰å¾…æ—¶é—´çš„å•ä½ä¸º TimeUnit.SECONDSã€‚</li><li>workQueueï¼šä»»åŠ¡é˜Ÿåˆ—ä¸º ArrayBlockingQueueï¼Œå¹¶ä¸”å®¹é‡ä¸º 100;</li><li>handler:é¥±å’Œç­–ç•¥ä¸º CallerRunsPolicyã€‚ Outputï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java">pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">2</span> Start. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">44</span> CST <span class="hljs-number">2019</span><br>pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">5</span> Start. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">44</span> CST <span class="hljs-number">2019</span><br>pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">4</span> Start. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">44</span> CST <span class="hljs-number">2019</span><br>pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">1</span> Start. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">44</span> CST <span class="hljs-number">2019</span><br>pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">3</span> Start. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">44</span> CST <span class="hljs-number">2019</span><br>pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">5</span> End. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">49</span> CST <span class="hljs-number">2019</span><br>pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">3</span> End. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">49</span> CST <span class="hljs-number">2019</span><br>pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">2</span> End. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">49</span> CST <span class="hljs-number">2019</span><br>pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">4</span> End. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">49</span> CST <span class="hljs-number">2019</span><br>pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">1</span> End. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">49</span> CST <span class="hljs-number">2019</span><br>pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">2</span> Start. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">49</span> CST <span class="hljs-number">2019</span><br>pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">1</span> Start. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">49</span> CST <span class="hljs-number">2019</span><br>pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">4</span> Start. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">49</span> CST <span class="hljs-number">2019</span><br>pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">3</span> Start. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">49</span> CST <span class="hljs-number">2019</span><br>pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">5</span> Start. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">49</span> CST <span class="hljs-number">2019</span><br>pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">2</span> End. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">54</span> CST <span class="hljs-number">2019</span><br>pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">3</span> End. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">54</span> CST <span class="hljs-number">2019</span><br>pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">4</span> End. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">54</span> CST <span class="hljs-number">2019</span><br>pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">5</span> End. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">54</span> CST <span class="hljs-number">2019</span><br>pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">1</span> End. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">54</span> CST <span class="hljs-number">2019</span><br></code></pre></td></tr></table></figure><h2 id="çº¿ç¨‹æ± åŸç†åˆ†æ"><a href="#çº¿ç¨‹æ± åŸç†åˆ†æ" class="headerlink" title="çº¿ç¨‹æ± åŸç†åˆ†æ"></a>çº¿ç¨‹æ± åŸç†åˆ†æ</h2><p>æˆ‘ä»¬é€šè¿‡ä»£ç è¾“å‡ºç»“æœå¯ä»¥çœ‹å‡ºï¼šçº¿ç¨‹æ± æ¯æ¬¡ä¼šåŒæ—¶æ‰§è¡Œ 5 ä¸ªä»»åŠ¡ï¼Œè¿™ 5 ä¸ªä»»åŠ¡æ‰§è¡Œå®Œä¹‹åï¼Œå‰©ä½™çš„ 5 ä¸ªä»»åŠ¡æ‰ä¼šè¢«æ‰§è¡Œã€‚ å¤§å®¶å¯ä»¥å…ˆé€šè¿‡ä¸Šé¢è®²è§£çš„å†…å®¹ï¼Œåˆ†æä¸€ä¸‹åˆ°åº•æ˜¯å’‹å›äº‹ï¼Ÿï¼ˆè‡ªå·±ç‹¬ç«‹æ€è€ƒä¸€ä¼šï¼‰</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬å°±åˆ†æä¸Šé¢çš„è¾“å‡ºå†…å®¹æ¥ç®€å•åˆ†æä¸€ä¸‹çº¿ç¨‹æ± åŸç†ã€‚</p><p>ä¸ºäº†ææ‡‚çº¿ç¨‹æ± çš„åŸç†ï¼Œæˆ‘ä»¬éœ€è¦é¦–å…ˆåˆ†æä¸€ä¸‹ executeæ–¹æ³•ã€‚åœ¨ 5.1 èŠ‚ä¸­çš„ Demo ä¸­æˆ‘ä»¬ä½¿ç”¨ executor.execute(worker)æ¥æäº¤ä¸€ä¸ªä»»åŠ¡åˆ°çº¿ç¨‹æ± ä¸­å»ï¼Œè¿™ä¸ªæ–¹æ³•éå¸¸é‡è¦ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„æºç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å­˜æ”¾çº¿ç¨‹æ± çš„è¿è¡ŒçŠ¶æ€ (runState) å’Œçº¿ç¨‹æ± å†…æœ‰æ•ˆçº¿ç¨‹çš„æ•°é‡ (workerCount)</span><br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AtomicInteger ctl = <span class="hljs-keyword">new</span> AtomicInteger(ctlOf(RUNNING, <span class="hljs-number">0</span>));<br><br>   <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">workerCountOf</span><span class="hljs-params">(<span class="hljs-keyword">int</span> c)</span> </span>&#123;<br>       <span class="hljs-keyword">return</span> c &amp; CAPACITY;<br>   &#125;<br><br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> BlockingQueue&lt;Runnable&gt; workQueue;<br><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">execute</span><span class="hljs-params">(Runnable command)</span> </span>&#123;<br>       <span class="hljs-comment">// å¦‚æœä»»åŠ¡ä¸ºnullï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</span><br>       <span class="hljs-keyword">if</span> (command == <span class="hljs-keyword">null</span>)<br>           <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NullPointerException();<br>       <span class="hljs-comment">// ctl ä¸­ä¿å­˜çš„çº¿ç¨‹æ± å½“å‰çš„ä¸€äº›çŠ¶æ€ä¿¡æ¯</span><br>       <span class="hljs-keyword">int</span> c = ctl.get();<br><br>       <span class="hljs-comment">//  ä¸‹é¢ä¼šæ¶‰åŠåˆ° 3 æ­¥ æ“ä½œ</span><br>       <span class="hljs-comment">// 1.é¦–å…ˆåˆ¤æ–­å½“å‰çº¿ç¨‹æ± ä¸­ä¹‹è¡Œçš„ä»»åŠ¡æ•°é‡æ˜¯å¦å°äº corePoolSize</span><br>       <span class="hljs-comment">// å¦‚æœå°äºçš„è¯ï¼Œé€šè¿‡addWorker(command, true)æ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œå¹¶å°†ä»»åŠ¡(command)æ·»åŠ åˆ°è¯¥çº¿ç¨‹ä¸­ï¼›ç„¶åï¼Œå¯åŠ¨è¯¥çº¿ç¨‹ä»è€Œæ‰§è¡Œä»»åŠ¡ã€‚</span><br>       <span class="hljs-keyword">if</span> (workerCountOf(c) &lt; corePoolSize) &#123;<br>           <span class="hljs-keyword">if</span> (addWorker(command, <span class="hljs-keyword">true</span>))<br>               <span class="hljs-keyword">return</span>;<br>           c = ctl.get();<br>       &#125;<br>       <span class="hljs-comment">// 2.å¦‚æœå½“å‰ä¹‹è¡Œçš„ä»»åŠ¡æ•°é‡å¤§äºç­‰äº corePoolSize çš„æ—¶å€™å°±ä¼šèµ°åˆ°è¿™é‡Œ</span><br>       <span class="hljs-comment">// é€šè¿‡ isRunning æ–¹æ³•åˆ¤æ–­çº¿ç¨‹æ± çŠ¶æ€ï¼Œçº¿ç¨‹æ± å¤„äº RUNNING çŠ¶æ€æ‰ä¼šè¢«å¹¶ä¸”é˜Ÿåˆ—å¯ä»¥åŠ å…¥ä»»åŠ¡ï¼Œè¯¥ä»»åŠ¡æ‰ä¼šè¢«åŠ å…¥è¿›å»</span><br>       <span class="hljs-keyword">if</span> (isRunning(c) &amp;&amp; workQueue.offer(command)) &#123;<br>           <span class="hljs-keyword">int</span> recheck = ctl.get();<br>           <span class="hljs-comment">// å†æ¬¡è·å–çº¿ç¨‹æ± çŠ¶æ€ï¼Œå¦‚æœçº¿ç¨‹æ± çŠ¶æ€ä¸æ˜¯ RUNNING çŠ¶æ€å°±éœ€è¦ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­ç§»é™¤ä»»åŠ¡ï¼Œå¹¶å°è¯•åˆ¤æ–­çº¿ç¨‹æ˜¯å¦å…¨éƒ¨æ‰§è¡Œå®Œæ¯•ã€‚åŒæ—¶æ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚</span><br>           <span class="hljs-keyword">if</span> (!isRunning(recheck) &amp;&amp; remove(command))<br>               reject(command);<br>               <span class="hljs-comment">// å¦‚æœå½“å‰çº¿ç¨‹æ± ä¸ºç©ºå°±æ–°åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¹¶æ‰§è¡Œã€‚</span><br>           <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (workerCountOf(recheck) == <span class="hljs-number">0</span>)<br>               addWorker(<span class="hljs-keyword">null</span>, <span class="hljs-keyword">false</span>);<br>       &#125;<br>       <span class="hljs-comment">//3. é€šè¿‡addWorker(command, false)æ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œå¹¶å°†ä»»åŠ¡(command)æ·»åŠ åˆ°è¯¥çº¿ç¨‹ä¸­ï¼›ç„¶åï¼Œå¯åŠ¨è¯¥çº¿ç¨‹ä»è€Œæ‰§è¡Œä»»åŠ¡ã€‚</span><br>       <span class="hljs-comment">//å¦‚æœaddWorker(command, false)æ‰§è¡Œå¤±è´¥ï¼Œåˆ™é€šè¿‡reject()æ‰§è¡Œç›¸åº”çš„æ‹’ç»ç­–ç•¥çš„å†…å®¹ã€‚</span><br>       <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!addWorker(command, <span class="hljs-keyword">false</span>))<br>           reject(command);<br>   &#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>ThreadPoolExecutor</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ThreadPoolExecutorç±»ç®€å•ä»‹ç»</title>
    <link href="/blog/2021/03/19/ThreadPoolExecutor%E7%B1%BB%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D/"/>
    <url>/blog/2021/03/19/ThreadPoolExecutor%E7%B1%BB%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D/</url>
    
    <content type="html"><![CDATA[<p>çº¿ç¨‹æ± å®ç°ç±» ThreadPoolExecutor æ˜¯ Executor æ¡†æ¶æœ€æ ¸å¿ƒçš„ç±»ã€‚</p><h2 id="ThreadPoolExecutor-ç±»åˆ†æ"><a href="#ThreadPoolExecutor-ç±»åˆ†æ" class="headerlink" title="ThreadPoolExecutor ç±»åˆ†æ"></a>ThreadPoolExecutor ç±»åˆ†æ</h2><p>ThreadPoolExecutor ç±»ä¸­æä¾›çš„å››ä¸ªæ„é€ æ–¹æ³•ã€‚æˆ‘ä»¬æ¥çœ‹æœ€é•¿çš„é‚£ä¸ªï¼Œå…¶ä½™ä¸‰ä¸ªéƒ½æ˜¯åœ¨è¿™ä¸ªæ„é€ æ–¹æ³•çš„åŸºç¡€ä¸Šäº§ç”Ÿï¼ˆå…¶ä»–å‡ ä¸ªæ„é€ æ–¹æ³•è¯´ç™½ç‚¹éƒ½æ˜¯ç»™å®šæŸäº›é»˜è®¤å‚æ•°çš„æ„é€ æ–¹æ³•æ¯”å¦‚é»˜è®¤åˆ¶å®šæ‹’ç»ç­–ç•¥æ˜¯ä»€ä¹ˆï¼‰ï¼Œè¿™é‡Œå°±ä¸è´´ä»£ç è®²äº†ï¼Œæ¯”è¾ƒç®€å•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç”¨ç»™å®šçš„åˆå§‹å‚æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„ThreadPoolExecutorã€‚</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ThreadPoolExecutor</span><span class="hljs-params">(<span class="hljs-keyword">int</span> corePoolSize,//çº¿ç¨‹æ± çš„æ ¸å¿ƒçº¿ç¨‹æ•°é‡</span></span><br><span class="hljs-function"><span class="hljs-params">                              <span class="hljs-keyword">int</span> maximumPoolSize,//çº¿ç¨‹æ± çš„æœ€å¤§çº¿ç¨‹æ•°</span></span><br><span class="hljs-function"><span class="hljs-params">                              <span class="hljs-keyword">long</span> keepAliveTime,//å½“çº¿ç¨‹æ•°å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°æ—¶ï¼Œå¤šä½™çš„ç©ºé—²çº¿ç¨‹å­˜æ´»çš„æœ€é•¿æ—¶é—´</span></span><br><span class="hljs-function"><span class="hljs-params">                              TimeUnit unit,//æ—¶é—´å•ä½</span></span><br><span class="hljs-function"><span class="hljs-params">                              BlockingQueue&lt;Runnable&gt; workQueue,//ä»»åŠ¡é˜Ÿåˆ—ï¼Œç”¨æ¥å‚¨å­˜ç­‰å¾…æ‰§è¡Œä»»åŠ¡çš„é˜Ÿåˆ—</span></span><br><span class="hljs-function"><span class="hljs-params">                              ThreadFactory threadFactory,//çº¿ç¨‹å·¥å‚ï¼Œç”¨æ¥åˆ›å»ºçº¿ç¨‹ï¼Œä¸€èˆ¬é»˜è®¤å³å¯</span></span><br><span class="hljs-function"><span class="hljs-params">                              RejectedExecutionHandler handler//æ‹’ç»ç­–ç•¥ï¼Œå½“æäº¤çš„ä»»åŠ¡è¿‡å¤šè€Œä¸èƒ½åŠæ—¶å¤„ç†æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å®šåˆ¶ç­–ç•¥æ¥å¤„ç†ä»»åŠ¡</span></span><br><span class="hljs-function"><span class="hljs-params">                               )</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (corePoolSize &lt; <span class="hljs-number">0</span> ||<br>            maximumPoolSize &lt;= <span class="hljs-number">0</span> ||<br>            maximumPoolSize &lt; corePoolSize ||<br>            keepAliveTime &lt; <span class="hljs-number">0</span>)<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException();<br>        <span class="hljs-keyword">if</span> (workQueue == <span class="hljs-keyword">null</span> || threadFactory == <span class="hljs-keyword">null</span> || handler == <span class="hljs-keyword">null</span>)<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NullPointerException();<br>        <span class="hljs-keyword">this</span>.corePoolSize = corePoolSize;<br>        <span class="hljs-keyword">this</span>.maximumPoolSize = maximumPoolSize;<br>        <span class="hljs-keyword">this</span>.workQueue = workQueue;<br>        <span class="hljs-keyword">this</span>.keepAliveTime = unit.toNanos(keepAliveTime);<br>        <span class="hljs-keyword">this</span>.threadFactory = threadFactory;<br>        <span class="hljs-keyword">this</span>.handler = handler;<br>    &#125;<br></code></pre></td></tr></table></figure><p>ä¸‹é¢è¿™äº›å¯¹åˆ›å»º éå¸¸é‡è¦ï¼Œåœ¨åé¢ä½¿ç”¨çº¿ç¨‹æ± çš„è¿‡ç¨‹ä¸­ä½ ä¸€å®šä¼šç”¨åˆ°ï¼æ‰€ä»¥ï¼ŒåŠ¡å¿…æ‹¿ç€å°æœ¬æœ¬è®°æ¸…æ¥šã€‚</p><p>ThreadPoolExecutor 3 ä¸ªæœ€é‡è¦çš„å‚æ•°ï¼š</p><ol><li>corePoolSize : æ ¸å¿ƒçº¿ç¨‹æ•°çº¿ç¨‹æ•°å®šä¹‰äº†æœ€å°å¯ä»¥åŒæ—¶è¿è¡Œçš„çº¿ç¨‹æ•°é‡ã€‚</li><li>maximumPoolSize : å½“é˜Ÿåˆ—ä¸­å­˜æ”¾çš„ä»»åŠ¡è¾¾åˆ°é˜Ÿåˆ—å®¹é‡çš„æ—¶å€™ï¼Œå½“å‰å¯ä»¥åŒæ—¶è¿è¡Œçš„çº¿ç¨‹æ•°é‡å˜ä¸ºæœ€å¤§çº¿ç¨‹æ•°ã€‚</li><li>workQueue: å½“æ–°ä»»åŠ¡æ¥çš„æ—¶å€™ä¼šå…ˆåˆ¤æ–­å½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°é‡æ˜¯å¦è¾¾åˆ°æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå¦‚æœè¾¾åˆ°çš„è¯ï¼Œä¿¡ä»»å°±ä¼šè¢«å­˜æ”¾åœ¨é˜Ÿåˆ—ä¸­ã€‚ ThreadPoolExecutorå…¶ä»–å¸¸è§å‚æ•°:</li><li>keepAliveTime:å½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å¤§äº corePoolSize çš„æ—¶å€™ï¼Œå¦‚æœè¿™æ—¶æ²¡æœ‰æ–°çš„ä»»åŠ¡æäº¤ï¼Œæ ¸å¿ƒçº¿ç¨‹å¤–çš„çº¿ç¨‹ä¸ä¼šç«‹å³é”€æ¯ï¼Œè€Œæ˜¯ä¼šç­‰å¾…ï¼Œç›´åˆ°ç­‰å¾…çš„æ—¶é—´è¶…è¿‡äº† keepAliveTimeæ‰ä¼šè¢«å›æ”¶é”€æ¯ï¼›</li><li>unit : keepAliveTime å‚æ•°çš„æ—¶é—´å•ä½ã€‚</li><li>threadFactory :executor åˆ›å»ºæ–°çº¿ç¨‹çš„æ—¶å€™ä¼šç”¨åˆ°ã€‚</li><li>handler :é¥±å’Œç­–ç•¥ã€‚å…³äºé¥±å’Œç­–ç•¥ä¸‹é¢å•ç‹¬ä»‹ç»ä¸€ä¸‹ã€‚ ä¸‹é¢è¿™å¼ å›¾å¯ä»¥åŠ æ·±ä½ å¯¹çº¿ç¨‹æ± ä¸­å„ä¸ªå‚æ•°çš„ç›¸äº’å…³ç³»çš„ç†è§£ï¼ˆå›¾ç‰‡æ¥æºï¼šã€ŠJavaæ€§èƒ½è°ƒä¼˜å®æˆ˜ã€‹ï¼‰ï¼š<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/small-20210319201705168.jpeg" alt="çº¿ç¨‹æ± å„ä¸ªå‚æ•°çš„å…³ç³»">ThreadPoolExecutor é¥±å’Œç­–ç•¥å®šä¹‰:</li></ol><p>å¦‚æœå½“å‰åŒæ—¶è¿è¡Œçš„çº¿ç¨‹æ•°é‡è¾¾åˆ°æœ€å¤§çº¿ç¨‹æ•°é‡å¹¶ä¸”é˜Ÿåˆ—ä¹Ÿå·²ç»è¢«æ”¾æ»¡äº†ä»»æ—¶ï¼ŒThreadPoolTaskExecutor å®šä¹‰ä¸€äº›ç­–ç•¥:</p><ol><li>ThreadPoolExecutor.AbortPolicyï¼šæŠ›å‡º RejectedExecutionExceptionæ¥æ‹’ç»æ–°ä»»åŠ¡çš„å¤„ç†ã€‚</li><li>ThreadPoolExecutor.CallerRunsPolicyï¼šè°ƒç”¨æ‰§è¡Œè‡ªå·±çš„çº¿ç¨‹è¿è¡Œä»»åŠ¡ã€‚æ‚¨ä¸ä¼šä»»åŠ¡è¯·æ±‚ã€‚ä½†æ˜¯è¿™ç§ç­–ç•¥ä¼šé™ä½å¯¹äºæ–°ä»»åŠ¡æäº¤é€Ÿåº¦ï¼Œå½±å“ç¨‹åºçš„æ•´ä½“æ€§èƒ½ã€‚å¦å¤–ï¼Œè¿™ä¸ªç­–ç•¥å–œæ¬¢å¢åŠ é˜Ÿåˆ—å®¹é‡ã€‚å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºå¯ä»¥æ‰¿å—æ­¤å»¶è¿Ÿå¹¶ä¸”ä½ ä¸èƒ½ä»»åŠ¡ä¸¢å¼ƒä»»ä½•ä¸€ä¸ªä»»åŠ¡è¯·æ±‚çš„è¯ï¼Œä½ å¯ä»¥é€‰æ‹©è¿™ä¸ªç­–ç•¥ã€‚</li><li>ThreadPoolExecutor.DiscardPolicyï¼š ä¸å¤„ç†æ–°ä»»åŠ¡ï¼Œç›´æ¥ä¸¢å¼ƒæ‰ã€‚</li><li>ThreadPoolExecutor.DiscardOldestPolicyï¼š æ­¤ç­–ç•¥å°†ä¸¢å¼ƒæœ€æ—©çš„æœªå¤„ç†çš„ä»»åŠ¡è¯·æ±‚ã€‚ ä¸¾ä¸ªä¾‹å­ï¼š</li></ol><p>Spring é€šè¿‡ ThreadPoolTaskExecutor æˆ–è€…æˆ‘ä»¬ç›´æ¥é€šè¿‡ ThreadPoolExecutor çš„æ„é€ å‡½æ•°åˆ›å»ºçº¿ç¨‹æ± çš„æ—¶å€™ï¼Œå½“æˆ‘ä»¬ä¸æŒ‡å®š RejectedExecutionHandler é¥±å’Œç­–ç•¥çš„è¯æ¥é…ç½®çº¿ç¨‹æ± çš„æ—¶å€™é»˜è®¤ä½¿ç”¨çš„æ˜¯ ThreadPoolExecutor.AbortPolicyã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒThreadPoolExecutor å°†æŠ›å‡º RejectedExecutionException æ¥æ‹’ç»æ–°æ¥çš„ä»»åŠ¡ ï¼Œè¿™ä»£è¡¨ä½ å°†ä¸¢å¤±å¯¹è¿™ä¸ªä»»åŠ¡çš„å¤„ç†ã€‚ å¯¹äºå¯ä¼¸ç¼©çš„åº”ç”¨ç¨‹åºï¼Œå»ºè®®ä½¿ç”¨ ThreadPoolExecutor.CallerRunsPolicyã€‚å½“æœ€å¤§æ± è¢«å¡«æ»¡æ—¶ï¼Œæ­¤ç­–ç•¥ä¸ºæˆ‘ä»¬æä¾›å¯ä¼¸ç¼©é˜Ÿåˆ—ã€‚ï¼ˆè¿™ä¸ªç›´æ¥æŸ¥çœ‹ ThreadPoolExecutor çš„æ„é€ å‡½æ•°æºç å°±å¯ä»¥çœ‹å‡ºï¼Œæ¯”è¾ƒç®€å•çš„åŸå› ï¼Œè¿™é‡Œå°±ä¸è´´ä»£ç äº†ã€‚ï¼‰</p><h2 id="æ¨èä½¿ç”¨-ThreadPoolExecutor-æ„é€ å‡½æ•°åˆ›å»ºçº¿ç¨‹æ± "><a href="#æ¨èä½¿ç”¨-ThreadPoolExecutor-æ„é€ å‡½æ•°åˆ›å»ºçº¿ç¨‹æ± " class="headerlink" title="æ¨èä½¿ç”¨ ThreadPoolExecutor æ„é€ å‡½æ•°åˆ›å»ºçº¿ç¨‹æ± "></a>æ¨èä½¿ç”¨ ThreadPoolExecutor æ„é€ å‡½æ•°åˆ›å»ºçº¿ç¨‹æ± </h2><p>åœ¨ã€Šé˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œã€‹â€œå¹¶å‘å¤„ç†â€è¿™ä¸€ç« èŠ‚ï¼Œæ˜ç¡®æŒ‡å‡ºçº¿ç¨‹èµ„æºå¿…é¡»é€šè¿‡çº¿ç¨‹æ± æä¾›ï¼Œä¸å…è®¸åœ¨åº”ç”¨ä¸­è‡ªè¡Œæ˜¾ç¤ºåˆ›å»ºçº¿ç¨‹ã€‚</p><p>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>ä½¿ç”¨çº¿ç¨‹æ± çš„å¥½å¤„æ˜¯å‡å°‘åœ¨åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ä¸Šæ‰€æ¶ˆè€—çš„æ—¶é—´ä»¥åŠç³»ç»Ÿèµ„æºå¼€é”€ï¼Œè§£å†³èµ„æºä¸è¶³çš„é—®é¢˜ã€‚å¦‚æœä¸ä½¿ç”¨çº¿ç¨‹æ± ï¼Œæœ‰å¯èƒ½ä¼šé€ æˆç³»ç»Ÿåˆ›å»ºå¤§é‡åŒç±»çº¿ç¨‹è€Œå¯¼è‡´æ¶ˆè€—å®Œå†…å­˜æˆ–è€…â€œè¿‡åº¦åˆ‡æ¢â€çš„é—®é¢˜ã€‚</p><p>å¦å¤–ã€Šé˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œã€‹ä¸­å¼ºåˆ¶çº¿ç¨‹æ± ä¸å…è®¸ä½¿ç”¨ Executors å»åˆ›å»ºï¼Œè€Œæ˜¯é€šè¿‡ ThreadPoolExecutor æ„é€ å‡½æ•°çš„æ–¹å¼ï¼Œè¿™æ ·çš„å¤„ç†æ–¹å¼è®©å†™çš„åŒå­¦æ›´åŠ æ˜ç¡®çº¿ç¨‹æ± çš„è¿è¡Œè§„åˆ™ï¼Œè§„é¿èµ„æºè€—å°½çš„é£é™©</p><p>Executors è¿”å›çº¿ç¨‹æ± å¯¹è±¡çš„å¼Šç«¯å¦‚ä¸‹ï¼š</p><p>FixedThreadPool å’Œ SingleThreadExecutor ï¼š å…è®¸è¯·æ±‚çš„é˜Ÿåˆ—é•¿åº¦ä¸º Integer.MAX_VALUE,å¯èƒ½å †ç§¯å¤§é‡çš„è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´ OOMã€‚ CachedThreadPool å’Œ ScheduledThreadPool ï¼š å…è®¸åˆ›å»ºçš„çº¿ç¨‹æ•°é‡ä¸º Integer.MAX_VALUE ï¼Œå¯èƒ½ä¼šåˆ›å»ºå¤§é‡çº¿ç¨‹ï¼Œä»è€Œå¯¼è‡´ OOMã€‚ æ–¹å¼ä¸€ï¼šé€šè¿‡ThreadPoolExecutoræ„é€ å‡½æ•°å®ç°ï¼ˆæ¨èï¼‰<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/small-20210319201705255.jpeg" alt="aHR0cDovL215LWJsb2ctdG8tdXNlLm9zcy1jbi1iZWlqaW5nLmFsaXl1bmNzLmNvbS8xOC00LTE2LzE3ODU4MjMwLmpwZw"></p><p>æ–¹å¼äºŒï¼šé€šè¿‡ Executor æ¡†æ¶çš„å·¥å…·ç±» Executors æ¥å®ç° æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸‰ç§ç±»å‹çš„ ThreadPoolExecutorï¼š</p><p>FixedThreadPool SingleThreadExecutor CachedThreadPool å¯¹åº” Executors å·¥å…·ç±»ä¸­çš„æ–¹æ³•å¦‚å›¾æ‰€ç¤ºï¼š<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/small-20210319201705406.jpeg" alt="aHR0cDovL215LWJsb2ctdG8tdXNlLm9zcy1jbi1iZWlqaW5nLmFsaXl1bmNzLmNvbS8xOC00LTE2LzEzMjk2OTAxLmpwZw"></p>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>ThreadPoolExecutor</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨çº¿ç¨‹æ± çš„å¥½å¤„</title>
    <link href="/blog/2021/03/19/%E4%BD%BF%E7%94%A8%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E5%A5%BD%E5%A4%84/"/>
    <url>/blog/2021/03/19/%E4%BD%BF%E7%94%A8%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E5%A5%BD%E5%A4%84/</url>
    
    <content type="html"><![CDATA[<p>æ± åŒ–æŠ€æœ¯ç›¸æ¯”å¤§å®¶å·²ç»å±¡è§ä¸é²œäº†ï¼Œçº¿ç¨‹æ± ã€æ•°æ®åº“è¿æ¥æ± ã€Http è¿æ¥æ± ç­‰ç­‰éƒ½æ˜¯å¯¹è¿™ä¸ªæ€æƒ³çš„åº”ç”¨ã€‚æ± åŒ–æŠ€æœ¯çš„æ€æƒ³ä¸»è¦æ˜¯ä¸ºäº†å‡å°‘æ¯æ¬¡è·å–èµ„æºçš„æ¶ˆè€—ï¼Œæé«˜å¯¹èµ„æºçš„åˆ©ç”¨ç‡ã€‚ çº¿ç¨‹æ± æä¾›äº†ä¸€ç§é™åˆ¶å’Œç®¡ç†èµ„æºï¼ˆåŒ…æ‹¬æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼‰ã€‚ æ¯ä¸ªçº¿ç¨‹æ± è¿˜ç»´æŠ¤ä¸€äº›åŸºæœ¬ç»Ÿè®¡ä¿¡æ¯ï¼Œä¾‹å¦‚å·²å®Œæˆä»»åŠ¡çš„æ•°é‡ã€‚</p><p>è¿™é‡Œå€Ÿç”¨ã€ŠJava å¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹æåˆ°çš„æ¥è¯´ä¸€ä¸‹ä½¿ç”¨çº¿ç¨‹æ± çš„å¥½å¤„ï¼š</p><ol><li>é™ä½èµ„æºæ¶ˆè€—ã€‚é€šè¿‡é‡å¤åˆ©ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹é™ä½çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯é€ æˆçš„æ¶ˆè€—ã€‚</li><li>æé«˜å“åº”é€Ÿåº¦ã€‚å½“ä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œä»»åŠ¡å¯ä»¥ä¸éœ€è¦çš„ç­‰åˆ°çº¿ç¨‹åˆ›å»ºå°±èƒ½ç«‹å³æ‰§è¡Œã€‚</li><li>æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§ã€‚çº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºï¼Œå¦‚æœæ— é™åˆ¶çš„åˆ›å»ºï¼Œä¸ä»…ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œè¿˜ä¼šé™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥è¿›è¡Œç»Ÿä¸€çš„åˆ†é…ï¼Œè°ƒä¼˜å’Œç›‘æ§ã€‚</li></ol><h2 id="Executor-æ¡†æ¶"><a href="#Executor-æ¡†æ¶" class="headerlink" title="Executor æ¡†æ¶"></a>Executor æ¡†æ¶</h2><p>Executor æ¡†æ¶æ˜¯ Java5 ä¹‹åå¼•è¿›çš„ï¼Œåœ¨ Java 5 ä¹‹åï¼Œé€šè¿‡ Executor æ¥å¯åŠ¨çº¿ç¨‹æ¯”ä½¿ç”¨ Thread çš„ start æ–¹æ³•æ›´å¥½ï¼Œé™¤äº†æ›´æ˜“ç®¡ç†ï¼Œæ•ˆç‡æ›´å¥½ï¼ˆç”¨çº¿ç¨‹æ± å®ç°ï¼ŒèŠ‚çº¦å¼€é”€ï¼‰å¤–ï¼Œè¿˜æœ‰å…³é”®çš„ä¸€ç‚¹ï¼šæœ‰åŠ©äºé¿å… this é€ƒé€¸é—®é¢˜ã€‚</p><p>è¡¥å……ï¼šthis é€ƒé€¸æ˜¯æŒ‡åœ¨æ„é€ å‡½æ•°è¿”å›ä¹‹å‰å…¶ä»–çº¿ç¨‹å°±æŒæœ‰è¯¥å¯¹è±¡çš„å¼•ç”¨. è°ƒç”¨å°šæœªæ„é€ å®Œå…¨çš„å¯¹è±¡çš„æ–¹æ³•å¯èƒ½å¼•å‘ä»¤äººç–‘æƒ‘çš„é”™è¯¯ã€‚</p><p>Executor æ¡†æ¶ä¸ä»…åŒ…æ‹¬äº†çº¿ç¨‹æ± çš„ç®¡ç†ï¼Œè¿˜æä¾›äº†çº¿ç¨‹å·¥å‚ã€é˜Ÿåˆ—ä»¥åŠæ‹’ç»ç­–ç•¥ç­‰ï¼ŒExecutor æ¡†æ¶è®©å¹¶å‘ç¼–ç¨‹å˜å¾—æ›´åŠ ç®€å•ã€‚</p><h3 id="Executor-æ¡†æ¶ç»“æ„-ä¸»è¦ç”±ä¸‰å¤§éƒ¨åˆ†ç»„æˆ"><a href="#Executor-æ¡†æ¶ç»“æ„-ä¸»è¦ç”±ä¸‰å¤§éƒ¨åˆ†ç»„æˆ" class="headerlink" title="Executor æ¡†æ¶ç»“æ„(ä¸»è¦ç”±ä¸‰å¤§éƒ¨åˆ†ç»„æˆ)"></a>Executor æ¡†æ¶ç»“æ„(ä¸»è¦ç”±ä¸‰å¤§éƒ¨åˆ†ç»„æˆ)</h3><ol><li>ä»»åŠ¡(Runnable /Callable) æ‰§è¡Œä»»åŠ¡éœ€è¦å®ç°çš„ Runnable æ¥å£ æˆ– Callableæ¥å£ã€‚Runnable æ¥å£æˆ– Callable æ¥å£ å®ç°ç±»éƒ½å¯ä»¥è¢« ThreadPoolExecutor æˆ– ScheduledThreadPoolExecutor æ‰§è¡Œã€‚</li><li>ä»»åŠ¡çš„æ‰§è¡Œ(Executor) å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒåŒ…æ‹¬ä»»åŠ¡æ‰§è¡Œæœºåˆ¶çš„æ ¸å¿ƒæ¥å£ Executor ï¼Œä»¥åŠç»§æ‰¿è‡ª Executor æ¥å£çš„ ExecutorService æ¥å£ã€‚ThreadPoolExecutor å’Œ ScheduledThreadPoolExecutor è¿™ä¸¤ä¸ªå…³é”®ç±»å®ç°äº† ExecutorService æ¥å£ã€‚</li></ol><p>è¿™é‡Œæäº†å¾ˆå¤šåº•å±‚çš„ç±»å…³ç³»ï¼Œä½†æ˜¯ï¼Œå®é™…ä¸Šæˆ‘ä»¬éœ€è¦æ›´å¤šå…³æ³¨çš„æ˜¯ ThreadPoolExecutor è¿™ä¸ªç±»ï¼Œè¿™ä¸ªç±»åœ¨æˆ‘ä»¬å®é™…ä½¿ç”¨çº¿ç¨‹æ± çš„è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨é¢‘ç‡è¿˜æ˜¯éå¸¸é«˜çš„ã€‚</p><p>æ³¨æ„ï¼š é€šè¿‡æŸ¥çœ‹ ScheduledThreadPoolExecutor æºä»£ç æˆ‘ä»¬å‘ç° ScheduledThreadPoolExecutor å®é™…ä¸Šæ˜¯ç»§æ‰¿äº† ThreadPoolExecutor å¹¶å®ç°äº† ScheduledExecutorService ï¼Œè€Œ ScheduledExecutorService åˆå®ç°äº† ExecutorServiceï¼Œæ­£å¦‚æˆ‘ä»¬ä¸‹é¢ç»™å‡ºçš„ç±»å…³ç³»å›¾æ˜¾ç¤ºçš„ä¸€æ ·ã€‚</p><p>ThreadPoolExecutor ç±»æè¿°:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//AbstractExecutorServiceå®ç°äº†ExecutorServiceæ¥å£</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThreadPoolExecutor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractExecutorService</span></span><br><span class="hljs-class"></span><br></code></pre></td></tr></table></figure><p>ScheduledThreadPoolExecutor ç±»æè¿°:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//ScheduledExecutorServiceå®ç°äº†ExecutorServiceæ¥å£</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ScheduledThreadPoolExecutor</span></span><br><span class="hljs-class">        <span class="hljs-keyword">extends</span> <span class="hljs-title">ThreadPoolExecutor</span></span><br><span class="hljs-class">        <span class="hljs-keyword">implements</span> <span class="hljs-title">ScheduledExecutorService</span></span><br><span class="hljs-class"></span><br></code></pre></td></tr></table></figure><p><img src="https://cuixiaoyande.oss-cn-shanghai.aliyuncs.com/%E4%BB%BB%E5%8A%A1%E7%9A%84%E6%89%A7%E8%A1%8C%E7%9B%B8%E5%85%B3%E6%8E%A5%E5%8F%A3_1576546630498.png?x-oss-process=style/small" alt="ä»»åŠ¡çš„æ‰§è¡Œç›¸å…³æ¥å£">3) å¼‚æ­¥è®¡ç®—çš„ç»“æœ(Future) Future æ¥å£ä»¥åŠ Future æ¥å£çš„å®ç°ç±» FutureTask ç±»éƒ½å¯ä»¥ä»£è¡¨å¼‚æ­¥è®¡ç®—çš„ç»“æœã€‚</p><p>å½“æˆ‘ä»¬æŠŠ Runnableæ¥å£ æˆ– Callable æ¥å£ çš„å®ç°ç±»æäº¤ç»™ ThreadPoolExecutor æˆ– ScheduledThreadPoolExecutor æ‰§è¡Œã€‚ï¼ˆè°ƒç”¨ submit() æ–¹æ³•æ—¶ä¼šè¿”å›ä¸€ä¸ª FutureTask å¯¹è±¡ï¼‰</p><h3 id="Executor-æ¡†æ¶çš„ä½¿ç”¨ç¤ºæ„å›¾"><a href="#Executor-æ¡†æ¶çš„ä½¿ç”¨ç¤ºæ„å›¾" class="headerlink" title="Executor æ¡†æ¶çš„ä½¿ç”¨ç¤ºæ„å›¾"></a>Executor æ¡†æ¶çš„ä½¿ç”¨ç¤ºæ„å›¾</h3><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/small-20210319201441640.png" alt="aHR0cDovL215LWJsb2ctdG8tdXNlLm9zcy1jbi1iZWlqaW5nLmFsaXl1bmNzLmNvbS8xOC01LTMwLzg0ODIzMzMwLmpwZw"></p><ol><li>ä¸»çº¿ç¨‹é¦–å…ˆè¦åˆ›å»ºå®ç° Runnable æˆ–è€… Callable æ¥å£çš„ä»»åŠ¡å¯¹è±¡ã€‚</li><li>æŠŠåˆ›å»ºå®Œæˆçš„å®ç° Runnable/Callableæ¥å£çš„ å¯¹è±¡ç›´æ¥äº¤ç»™ ExecutorService æ‰§è¡Œ: ExecutorService.executeï¼ˆRunnable commandï¼‰ï¼‰æˆ–è€…ä¹Ÿå¯ä»¥æŠŠ Runnable å¯¹è±¡æˆ–Callable å¯¹è±¡æäº¤ç»™ ExecutorService æ‰§è¡Œï¼ˆExecutorService.submitï¼ˆRunnable taskï¼‰æˆ– ExecutorService.submitï¼ˆCallable taskï¼‰ï¼‰ã€‚</li><li>å¦‚æœæ‰§è¡Œ ExecutorService.submitï¼ˆâ€¦ï¼‰ï¼ŒExecutorService å°†è¿”å›ä¸€ä¸ªå®ç°Futureæ¥å£çš„å¯¹è±¡ï¼ˆæˆ‘ä»¬åˆšåˆšä¹Ÿæåˆ°è¿‡äº†æ‰§è¡Œ execute()æ–¹æ³•å’Œ submit()æ–¹æ³•çš„åŒºåˆ«ï¼Œsubmit()ä¼šè¿”å›ä¸€ä¸ª FutureTask å¯¹è±¡ï¼‰ã€‚ç”±äº FutureTask å®ç°äº† Runnableï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ›å»º FutureTaskï¼Œç„¶åç›´æ¥äº¤ç»™ ExecutorService æ‰§è¡Œã€‚</li><li>æœ€åï¼Œä¸»çº¿ç¨‹å¯ä»¥æ‰§è¡Œ FutureTask.get()æ–¹æ³•æ¥ç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œæˆã€‚ä¸»çº¿ç¨‹ä¹Ÿå¯ä»¥æ‰§è¡Œ FutureTask.cancelï¼ˆboolean mayInterruptIfRunningï¼‰æ¥å–æ¶ˆæ­¤ä»»åŠ¡çš„æ‰§è¡Œã€‚</li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>çº¿ç¨‹æ± </tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>çº¿ç¨‹æ± åŸç†åˆ†æ</title>
    <link href="/blog/2021/03/19/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/"/>
    <url>/blog/2021/03/19/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<p>æˆ‘ä»¬é€šè¿‡ä»£ç è¾“å‡ºç»“æœå¯ä»¥çœ‹å‡ºï¼šçº¿ç¨‹æ± æ¯æ¬¡ä¼šåŒæ—¶æ‰§è¡Œ 5 ä¸ªä»»åŠ¡ï¼Œè¿™ 5 ä¸ªä»»åŠ¡æ‰§è¡Œå®Œä¹‹åï¼Œå‰©ä½™çš„ 5 ä¸ªä»»åŠ¡æ‰ä¼šè¢«æ‰§è¡Œã€‚ å¤§å®¶å¯ä»¥å…ˆé€šè¿‡ä¸Šé¢è®²è§£çš„å†…å®¹ï¼Œåˆ†æä¸€ä¸‹åˆ°åº•æ˜¯å’‹å›äº‹ï¼Ÿï¼ˆè‡ªå·±ç‹¬ç«‹æ€è€ƒä¸€ä¼šï¼‰</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬å°±åˆ†æä¸Šé¢çš„è¾“å‡ºå†…å®¹æ¥ç®€å•åˆ†æä¸€ä¸‹çº¿ç¨‹æ± åŸç†ã€‚</p><p>ä¸ºäº†ææ‡‚çº¿ç¨‹æ± çš„åŸç†ï¼Œæˆ‘ä»¬éœ€è¦é¦–å…ˆåˆ†æä¸€ä¸‹ executeæ–¹æ³•ã€‚åœ¨ 4.6 èŠ‚ä¸­çš„ Demo ä¸­æˆ‘ä»¬ä½¿ç”¨ executor.execute(worker)æ¥æäº¤ä¸€ä¸ªä»»åŠ¡åˆ°çº¿ç¨‹æ± ä¸­å»ï¼Œè¿™ä¸ªæ–¹æ³•éå¸¸é‡è¦ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„æºç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å­˜æ”¾çº¿ç¨‹æ± çš„è¿è¡ŒçŠ¶æ€ (runState) å’Œçº¿ç¨‹æ± å†…æœ‰æ•ˆçº¿ç¨‹çš„æ•°é‡ (workerCount)</span><br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AtomicInteger ctl = <span class="hljs-keyword">new</span> AtomicInteger(ctlOf(RUNNING, <span class="hljs-number">0</span>));<br> <br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">workerCountOf</span><span class="hljs-params">(<span class="hljs-keyword">int</span> c)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> c &amp; CAPACITY;<br>    &#125;<br> <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> BlockingQueue&lt;Runnable&gt; workQueue;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">execute</span><span class="hljs-params">(Runnable command)</span> </span>&#123;<br>        <span class="hljs-comment">// å¦‚æœä»»åŠ¡ä¸ºnullï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</span><br>        <span class="hljs-keyword">if</span> (command == <span class="hljs-keyword">null</span>)<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NullPointerException();<br>        <span class="hljs-comment">// ctl ä¸­ä¿å­˜çš„çº¿ç¨‹æ± å½“å‰çš„ä¸€äº›çŠ¶æ€ä¿¡æ¯</span><br>        <span class="hljs-keyword">int</span> c = ctl.get();<br> <br>        <span class="hljs-comment">//  ä¸‹é¢ä¼šæ¶‰åŠåˆ° 3 æ­¥ æ“ä½œ</span><br>        <span class="hljs-comment">// 1.é¦–å…ˆåˆ¤æ–­å½“å‰çº¿ç¨‹æ± ä¸­ä¹‹è¡Œçš„ä»»åŠ¡æ•°é‡æ˜¯å¦å°äº corePoolSize</span><br>        <span class="hljs-comment">// å¦‚æœå°äºçš„è¯ï¼Œé€šè¿‡addWorker(command, true)æ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œå¹¶å°†ä»»åŠ¡(command)æ·»åŠ åˆ°è¯¥çº¿ç¨‹ä¸­ï¼›ç„¶åï¼Œå¯åŠ¨è¯¥çº¿ç¨‹ä»è€Œæ‰§è¡Œä»»åŠ¡ã€‚</span><br>        <span class="hljs-keyword">if</span> (workerCountOf(c) &lt; corePoolSize) &#123;<br>            <span class="hljs-keyword">if</span> (addWorker(command, <span class="hljs-keyword">true</span>))<br>                <span class="hljs-keyword">return</span>;<br>            c = ctl.get();<br>        &#125;<br>        <span class="hljs-comment">// 2.å¦‚æœå½“å‰ä¹‹è¡Œçš„ä»»åŠ¡æ•°é‡å¤§äºç­‰äº corePoolSize çš„æ—¶å€™å°±ä¼šèµ°åˆ°è¿™é‡Œ</span><br>        <span class="hljs-comment">// é€šè¿‡ isRunning æ–¹æ³•åˆ¤æ–­çº¿ç¨‹æ± çŠ¶æ€ï¼Œçº¿ç¨‹æ± å¤„äº RUNNING çŠ¶æ€æ‰ä¼šè¢«å¹¶ä¸”é˜Ÿåˆ—å¯ä»¥åŠ å…¥ä»»åŠ¡ï¼Œè¯¥ä»»åŠ¡æ‰ä¼šè¢«åŠ å…¥è¿›å»</span><br>        <span class="hljs-keyword">if</span> (isRunning(c) &amp;&amp; workQueue.offer(command)) &#123;<br>            <span class="hljs-keyword">int</span> recheck = ctl.get();<br>            <span class="hljs-comment">// å†æ¬¡è·å–çº¿ç¨‹æ± çŠ¶æ€ï¼Œå¦‚æœçº¿ç¨‹æ± çŠ¶æ€ä¸æ˜¯ RUNNING çŠ¶æ€å°±éœ€è¦ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­ç§»é™¤ä»»åŠ¡ï¼Œå¹¶å°è¯•åˆ¤æ–­çº¿ç¨‹æ˜¯å¦å…¨éƒ¨æ‰§è¡Œå®Œæ¯•ã€‚åŒæ—¶æ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚</span><br>            <span class="hljs-keyword">if</span> (!isRunning(recheck) &amp;&amp; remove(command))<br>                reject(command);<br>                <span class="hljs-comment">// å¦‚æœå½“å‰çº¿ç¨‹æ± ä¸ºç©ºå°±æ–°åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¹¶æ‰§è¡Œã€‚</span><br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (workerCountOf(recheck) == <span class="hljs-number">0</span>)<br>                addWorker(<span class="hljs-keyword">null</span>, <span class="hljs-keyword">false</span>);<br>        &#125;<br>        <span class="hljs-comment">//3. é€šè¿‡addWorker(command, false)æ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œå¹¶å°†ä»»åŠ¡(command)æ·»åŠ åˆ°è¯¥çº¿ç¨‹ä¸­ï¼›ç„¶åï¼Œå¯åŠ¨è¯¥çº¿ç¨‹ä»è€Œæ‰§è¡Œä»»åŠ¡ã€‚</span><br>        <span class="hljs-comment">//å¦‚æœaddWorker(command, false)æ‰§è¡Œå¤±è´¥ï¼Œåˆ™é€šè¿‡reject()æ‰§è¡Œç›¸åº”çš„æ‹’ç»ç­–ç•¥çš„å†…å®¹ã€‚</span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!addWorker(command, <span class="hljs-keyword">false</span>))<br>            reject(command);<br>    &#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡ä¸‹å›¾å¯ä»¥æ›´å¥½çš„å¯¹ä¸Šé¢è¿™ 3 æ­¥åšä¸€ä¸ªå±•ç¤ºï¼Œä¸‹å›¾<img src="https://cuixiaoyande.oss-cn-shanghai.aliyuncs.com/%E5%9B%BE%E8%A7%A3%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86_1576459366999.png?x-oss-process=style/small" alt="å›¾è§£çº¿ç¨‹æ± å®ç°åŸç†">æˆ‘ä»¬åœ¨ä»£ç ä¸­æ¨¡æ‹Ÿäº† 10 ä¸ªä»»åŠ¡ï¼Œæˆ‘ä»¬é…ç½®çš„æ ¸å¿ƒçº¿ç¨‹æ•°ä¸º 5 ã€ç­‰å¾…é˜Ÿåˆ—å®¹é‡ä¸º 100 ï¼Œæ‰€ä»¥æ¯æ¬¡åªå¯èƒ½å­˜åœ¨ 5 ä¸ªä»»åŠ¡åŒæ—¶æ‰§è¡Œï¼Œå‰©ä¸‹çš„ 5 ä¸ªä»»åŠ¡ä¼šè¢«æ”¾åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­å»ã€‚å½“å‰çš„ 5 ä¸ªä»»åŠ¡ä¹‹è¡Œå®Œæˆåï¼Œæ‰ä¼šä¹‹è¡Œå‰©ä¸‹çš„ 5 ä¸ªä»»åŠ¡ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>çº¿ç¨‹æ± </tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¦‚ä½•åˆ›å»ºçº¿ç¨‹æ± </title>
    <link href="/blog/2021/03/18/%E5%A6%82%E4%BD%95%E5%88%9B%E5%BB%BA%E7%BA%BF%E7%A8%8B%E6%B1%A0/"/>
    <url>/blog/2021/03/18/%E5%A6%82%E4%BD%95%E5%88%9B%E5%BB%BA%E7%BA%BF%E7%A8%8B%E6%B1%A0/</url>
    
    <content type="html"><![CDATA[<p><strong>ã€Šé˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œã€‹</strong>ä¸­å¼ºåˆ¶çº¿ç¨‹æ± ä¸å…è®¸ä½¿ç”¨ Executors å»åˆ›å»ºï¼Œè€Œæ˜¯é€šè¿‡ ThreadPoolExecutor çš„æ–¹å¼ï¼Œè¿™æ ·çš„å¤„ç†æ–¹å¼è®©å†™çš„åŒå­¦æ›´åŠ æ˜ç¡®çº¿ç¨‹æ± çš„è¿è¡Œè§„åˆ™ï¼Œè§„é¿èµ„æºè€—å°½çš„é£é™©</p><p>Executors è¿”å›çº¿ç¨‹æ± å¯¹è±¡çš„å¼Šç«¯å¦‚ä¸‹ï¼š</p><p>FixedThreadPool å’Œ SingleThreadExecutor ï¼š å…è®¸è¯·æ±‚çš„é˜Ÿåˆ—é•¿åº¦ä¸º Integer.MAX_VALUE ï¼Œå¯èƒ½å †ç§¯å¤§é‡çš„è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´OOMã€‚ CachedThreadPool å’Œ ScheduledThreadPool ï¼š å…è®¸åˆ›å»ºçš„çº¿ç¨‹æ•°é‡ä¸º Integer.MAX_VALUE ï¼Œå¯èƒ½ä¼šåˆ›å»ºå¤§é‡çº¿ç¨‹ï¼Œä»è€Œå¯¼è‡´OOMã€‚</p><h3 id="æ–¹å¼ä¸€ï¼šé€šè¿‡æ„é€ æ–¹æ³•å®ç°"><a href="#æ–¹å¼ä¸€ï¼šé€šè¿‡æ„é€ æ–¹æ³•å®ç°" class="headerlink" title="æ–¹å¼ä¸€ï¼šé€šè¿‡æ„é€ æ–¹æ³•å®ç°"></a>æ–¹å¼ä¸€ï¼šé€šè¿‡æ„é€ æ–¹æ³•å®ç°</h3><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/small-20210318200323238.jpeg" alt="ThreadPoolExecutoræ„é€ æ–¹æ³•"></p><h3 id="æ–¹å¼äºŒï¼šé€šè¿‡Executor-æ¡†æ¶çš„å·¥å…·ç±»Executorsæ¥å®ç°-æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸‰ç§ç±»å‹çš„ThreadPoolExecutorï¼š"><a href="#æ–¹å¼äºŒï¼šé€šè¿‡Executor-æ¡†æ¶çš„å·¥å…·ç±»Executorsæ¥å®ç°-æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸‰ç§ç±»å‹çš„ThreadPoolExecutorï¼š" class="headerlink" title="æ–¹å¼äºŒï¼šé€šè¿‡Executor æ¡†æ¶çš„å·¥å…·ç±»Executorsæ¥å®ç° æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸‰ç§ç±»å‹çš„ThreadPoolExecutorï¼š"></a>æ–¹å¼äºŒï¼šé€šè¿‡Executor æ¡†æ¶çš„å·¥å…·ç±»Executorsæ¥å®ç° æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸‰ç§ç±»å‹çš„ThreadPoolExecutorï¼š</h3><p>FixedThreadPool ï¼š è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªå›ºå®šçº¿ç¨‹æ•°é‡çš„çº¿ç¨‹æ± ã€‚è¯¥çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å§‹ç»ˆä¸å˜ã€‚å½“æœ‰ä¸€ä¸ªæ–°çš„ä»»åŠ¡æäº¤æ—¶ï¼Œçº¿ç¨‹æ± ä¸­è‹¥æœ‰ç©ºé—²çº¿ç¨‹ï¼Œåˆ™ç«‹å³æ‰§è¡Œã€‚è‹¥æ²¡æœ‰ï¼Œåˆ™æ–°çš„ä»»åŠ¡ä¼šè¢«æš‚å­˜åœ¨ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œå¾…æœ‰çº¿ç¨‹ç©ºé—²æ—¶ï¼Œä¾¿å¤„ç†åœ¨ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚ SingleThreadExecutorï¼š æ–¹æ³•è¿”å›ä¸€ä¸ªåªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ã€‚è‹¥å¤šä½™ä¸€ä¸ªä»»åŠ¡è¢«æäº¤åˆ°è¯¥çº¿ç¨‹æ± ï¼Œä»»åŠ¡ä¼šè¢«ä¿å­˜åœ¨ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œå¾…çº¿ç¨‹ç©ºé—²ï¼ŒæŒ‰å…ˆå…¥å…ˆå‡ºçš„é¡ºåºæ‰§è¡Œé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚ CachedThreadPoolï¼š è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªå¯æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´çº¿ç¨‹æ•°é‡çš„çº¿ç¨‹æ± ã€‚çº¿ç¨‹æ± çš„çº¿ç¨‹æ•°é‡ä¸ç¡®å®šï¼Œä½†è‹¥æœ‰ç©ºé—²çº¿ç¨‹å¯ä»¥å¤ç”¨ï¼Œåˆ™ä¼šä¼˜å…ˆä½¿ç”¨å¯å¤ç”¨çš„çº¿ç¨‹ã€‚è‹¥æ‰€æœ‰çº¿ç¨‹å‡åœ¨å·¥ä½œï¼Œåˆæœ‰æ–°çš„ä»»åŠ¡æäº¤ï¼Œåˆ™ä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹å¤„ç†ä»»åŠ¡ã€‚æ‰€æœ‰çº¿ç¨‹åœ¨å½“å‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œå°†è¿”å›çº¿ç¨‹æ± è¿›è¡Œå¤ç”¨ã€‚ å¯¹åº”Executorså·¥å…·ç±»ä¸­çš„æ–¹æ³•å¦‚å›¾æ‰€ç¤ºï¼š<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/small-20210318200323344.jpeg" alt="Executoræ¡†æ¶çš„å·¥å…·ç±»"></p><h3 id="ThreadPoolExecutor-ç±»åˆ†æ"><a href="#ThreadPoolExecutor-ç±»åˆ†æ" class="headerlink" title="ThreadPoolExecutor ç±»åˆ†æ"></a>ThreadPoolExecutor ç±»åˆ†æ</h3><p>ThreadPoolExecutor ç±»ä¸­æä¾›çš„å››ä¸ªæ„é€ æ–¹æ³•ã€‚æˆ‘ä»¬æ¥çœ‹æœ€é•¿çš„é‚£ä¸ªï¼Œå…¶ä½™ä¸‰ä¸ªéƒ½æ˜¯åœ¨è¿™ä¸ªæ„é€ æ–¹æ³•çš„åŸºç¡€ä¸Šäº§ç”Ÿï¼ˆå…¶ä»–å‡ ä¸ªæ„é€ æ–¹æ³•è¯´ç™½ç‚¹éƒ½æ˜¯ç»™å®šæŸäº›é»˜è®¤å‚æ•°çš„æ„é€ æ–¹æ³•æ¯”å¦‚é»˜è®¤åˆ¶å®šæ‹’ç»ç­–ç•¥æ˜¯ä»€ä¹ˆï¼‰ï¼Œè¿™é‡Œå°±ä¸è´´ä»£ç è®²äº†ï¼Œæ¯”è¾ƒç®€å•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç”¨ç»™å®šçš„åˆå§‹å‚æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„ThreadPoolExecutorã€‚</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ThreadPoolExecutor</span><span class="hljs-params">(<span class="hljs-keyword">int</span> corePoolSize,</span></span><br><span class="hljs-function"><span class="hljs-params">                              <span class="hljs-keyword">int</span> maximumPoolSize,</span></span><br><span class="hljs-function"><span class="hljs-params">                              <span class="hljs-keyword">long</span> keepAliveTime,</span></span><br><span class="hljs-function"><span class="hljs-params">                              TimeUnit unit,</span></span><br><span class="hljs-function"><span class="hljs-params">                              BlockingQueue&lt;Runnable&gt; workQueue,</span></span><br><span class="hljs-function"><span class="hljs-params">                              ThreadFactory threadFactory,</span></span><br><span class="hljs-function"><span class="hljs-params">                              RejectedExecutionHandler handler)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (corePoolSize &lt; <span class="hljs-number">0</span> ||<br>            maximumPoolSize &lt;= <span class="hljs-number">0</span> ||<br>            maximumPoolSize &lt; corePoolSize ||<br>            keepAliveTime &lt; <span class="hljs-number">0</span>)<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException();<br>        <span class="hljs-keyword">if</span> (workQueue == <span class="hljs-keyword">null</span> || threadFactory == <span class="hljs-keyword">null</span> || handler == <span class="hljs-keyword">null</span>)<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NullPointerException();<br>        <span class="hljs-keyword">this</span>.corePoolSize = corePoolSize;<br>        <span class="hljs-keyword">this</span>.maximumPoolSize = maximumPoolSize;<br>        <span class="hljs-keyword">this</span>.workQueue = workQueue;<br>        <span class="hljs-keyword">this</span>.keepAliveTime = unit.toNanos(keepAliveTime);<br>        <span class="hljs-keyword">this</span>.threadFactory = threadFactory;<br>        <span class="hljs-keyword">this</span>.handler = handler;<br>    &#125;<br></code></pre></td></tr></table></figure><h3 id="ThreadPoolExecutoræ„é€ å‡½æ•°é‡è¦å‚æ•°åˆ†æ"><a href="#ThreadPoolExecutoræ„é€ å‡½æ•°é‡è¦å‚æ•°åˆ†æ" class="headerlink" title="ThreadPoolExecutoræ„é€ å‡½æ•°é‡è¦å‚æ•°åˆ†æ"></a>ThreadPoolExecutoræ„é€ å‡½æ•°é‡è¦å‚æ•°åˆ†æ</h3><p>ThreadPoolExecutor 3 ä¸ªæœ€é‡è¦çš„å‚æ•°ï¼š</p><ol><li>corePoolSize : æ ¸å¿ƒçº¿ç¨‹æ•°çº¿ç¨‹æ•°å®šä¹‰äº†æœ€å°å¯ä»¥åŒæ—¶è¿è¡Œçš„çº¿ç¨‹æ•°é‡ã€‚</li><li>maximumPoolSize : å½“é˜Ÿåˆ—ä¸­å­˜æ”¾çš„ä»»åŠ¡è¾¾åˆ°é˜Ÿåˆ—å®¹é‡çš„æ—¶å€™ï¼Œå½“å‰å¯ä»¥åŒæ—¶è¿è¡Œçš„çº¿ç¨‹æ•°é‡å˜ä¸ºæœ€å¤§çº¿ç¨‹æ•°ã€‚</li><li>workQueue: å½“æ–°ä»»åŠ¡æ¥çš„æ—¶å€™ä¼šå…ˆåˆ¤æ–­å½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°é‡æ˜¯å¦è¾¾åˆ°æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå¦‚æœè¾¾åˆ°çš„è¯ï¼Œä¿¡ä»»å°±ä¼šè¢«å­˜æ”¾åœ¨é˜Ÿåˆ—ä¸­ã€‚ ThreadPoolExecutorå…¶ä»–å¸¸è§å‚æ•°:</li><li>keepAliveTime:å½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å¤§äº corePoolSize çš„æ—¶å€™ï¼Œå¦‚æœè¿™æ—¶æ²¡æœ‰æ–°çš„ä»»åŠ¡æäº¤ï¼Œæ ¸å¿ƒçº¿ç¨‹å¤–çš„çº¿ç¨‹ä¸ä¼šç«‹å³é”€æ¯ï¼Œè€Œæ˜¯ä¼šç­‰å¾…ï¼Œç›´åˆ°ç­‰å¾…çš„æ—¶é—´è¶…è¿‡äº† keepAliveTimeæ‰ä¼šè¢«å›æ”¶é”€æ¯ï¼›</li><li>unit : keepAliveTime å‚æ•°çš„æ—¶é—´å•ä½ã€‚</li><li>threadFactory :executor åˆ›å»ºæ–°çº¿ç¨‹çš„æ—¶å€™ä¼šç”¨åˆ°ã€‚</li><li>handler :é¥±å’Œç­–ç•¥ã€‚å…³äºé¥±å’Œç­–ç•¥ä¸‹é¢å•ç‹¬ä»‹ç»ä¸€ä¸‹ã€‚</li></ol><h3 id="ThreadPoolExecutor-é¥±å’Œç­–ç•¥"><a href="#ThreadPoolExecutor-é¥±å’Œç­–ç•¥" class="headerlink" title="ThreadPoolExecutor é¥±å’Œç­–ç•¥"></a>ThreadPoolExecutor é¥±å’Œç­–ç•¥</h3><p>ThreadPoolExecutor é¥±å’Œç­–ç•¥å®šä¹‰:</p><p>å¦‚æœå½“å‰åŒæ—¶è¿è¡Œçš„çº¿ç¨‹æ•°é‡è¾¾åˆ°æœ€å¤§çº¿ç¨‹æ•°é‡å¹¶ä¸”é˜Ÿåˆ—ä¹Ÿå·²ç»è¢«æ”¾æ»¡äº†ä»»æ—¶ï¼ŒThreadPoolTaskExecutor å®šä¹‰ä¸€äº›ç­–ç•¥:</p><ol><li>ThreadPoolExecutor.AbortPolicyï¼šæŠ›å‡º RejectedExecutionExceptionæ¥æ‹’ç»æ–°ä»»åŠ¡çš„å¤„ç†ã€‚</li><li>ThreadPoolExecutor.CallerRunsPolicyï¼šè°ƒç”¨æ‰§è¡Œè‡ªå·±çš„çº¿ç¨‹è¿è¡Œä»»åŠ¡ã€‚æ‚¨ä¸ä¼šä»»åŠ¡è¯·æ±‚ã€‚ä½†æ˜¯è¿™ç§ç­–ç•¥ä¼šé™ä½å¯¹äºæ–°ä»»åŠ¡æäº¤é€Ÿåº¦ï¼Œå½±å“ç¨‹åºçš„æ•´ä½“æ€§èƒ½ã€‚å¦å¤–ï¼Œè¿™ä¸ªç­–ç•¥å–œæ¬¢å¢åŠ é˜Ÿåˆ—å®¹é‡ã€‚å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºå¯ä»¥æ‰¿å—æ­¤å»¶è¿Ÿå¹¶ä¸”ä½ ä¸èƒ½ä»»åŠ¡ä¸¢å¼ƒä»»ä½•ä¸€ä¸ªä»»åŠ¡è¯·æ±‚çš„è¯ï¼Œä½ å¯ä»¥é€‰æ‹©è¿™ä¸ªç­–ç•¥ã€‚</li><li>ThreadPoolExecutor.DiscardPolicyï¼š ä¸å¤„ç†æ–°ä»»åŠ¡ï¼Œç›´æ¥ä¸¢å¼ƒæ‰ã€‚</li><li>ThreadPoolExecutor.DiscardOldestPolicyï¼š æ­¤ç­–ç•¥å°†ä¸¢å¼ƒæœ€æ—©çš„æœªå¤„ç†çš„ä»»åŠ¡è¯·æ±‚ã€‚ ä¸¾ä¸ªä¾‹å­ï¼š Spring é€šè¿‡ ThreadPoolTaskExecutor æˆ–è€…æˆ‘ä»¬ç›´æ¥é€šè¿‡ ThreadPoolExecutor çš„æ„é€ å‡½æ•°åˆ›å»ºçº¿ç¨‹æ± çš„æ—¶å€™ï¼Œå½“æˆ‘ä»¬ä¸æŒ‡å®š RejectedExecutionHandler é¥±å’Œç­–ç•¥çš„è¯æ¥é…ç½®çº¿ç¨‹æ± çš„æ—¶å€™é»˜è®¤ä½¿ç”¨çš„æ˜¯ ThreadPoolExecutor.AbortPolicyã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒThreadPoolExecutor å°†æŠ›å‡º RejectedExecutionException æ¥æ‹’ç»æ–°æ¥çš„ä»»åŠ¡ ï¼Œè¿™ä»£è¡¨ä½ å°†ä¸¢å¤±å¯¹è¿™ä¸ªä»»åŠ¡çš„å¤„ç†ã€‚ å¯¹äºå¯ä¼¸ç¼©çš„åº”ç”¨ç¨‹åºï¼Œå»ºè®®ä½¿ç”¨ ThreadPoolExecutor.CallerRunsPolicyã€‚å½“æœ€å¤§æ± è¢«å¡«æ»¡æ—¶ï¼Œæ­¤ç­–ç•¥ä¸ºæˆ‘ä»¬æä¾›å¯ä¼¸ç¼©é˜Ÿåˆ—ã€‚ï¼ˆè¿™ä¸ªç›´æ¥æŸ¥çœ‹ ThreadPoolExecutor çš„æ„é€ å‡½æ•°æºç å°±å¯ä»¥çœ‹å‡ºï¼Œæ¯”è¾ƒç®€å•çš„åŸå› ï¼Œè¿™é‡Œå°±ä¸è´´ä»£ç äº†ï¼‰</li></ol><h3 id="ä¸€ä¸ªç®€å•çš„çº¿ç¨‹æ± Demo-Runnable-ThreadPoolExecutor"><a href="#ä¸€ä¸ªç®€å•çš„çº¿ç¨‹æ± Demo-Runnable-ThreadPoolExecutor" class="headerlink" title="ä¸€ä¸ªç®€å•çš„çº¿ç¨‹æ± Demo:Runnable+ThreadPoolExecutor"></a>ä¸€ä¸ªç®€å•çš„çº¿ç¨‹æ± Demo:Runnable+ThreadPoolExecutor</h3><p>ä¸ºäº†è®©å¤§å®¶æ›´æ¸…æ¥šä¸Šé¢çš„é¢è¯•é¢˜ä¸­çš„ä¸€äº›æ¦‚å¿µï¼Œæˆ‘å†™äº†ä¸€ä¸ªç®€å•çš„çº¿ç¨‹æ±  Demoã€‚</p><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ª Runnable æ¥å£çš„å®ç°ç±»ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥æ˜¯ Callable æ¥å£ï¼Œæˆ‘ä»¬ä¸Šé¢ä¹Ÿè¯´äº†ä¸¤è€…çš„åŒºåˆ«ã€‚ï¼‰</p><p>MyRunnable.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.Date;<br> <br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è¿™æ˜¯ä¸€ä¸ªç®€å•çš„Runnableç±»ï¼Œéœ€è¦å¤§çº¦5ç§’é’Ÿæ¥æ‰§è¡Œå…¶ä»»åŠ¡ã€‚</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> shuang.kou</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyRunnable</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Runnable</span> </span>&#123;<br> <br>    <span class="hljs-keyword">private</span> String command;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MyRunnable</span><span class="hljs-params">(String s)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.command = s;<br>    &#125;<br> <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot; Start. Time = &quot;</span> + <span class="hljs-keyword">new</span> Date());<br>        processCommand();<br>        System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot; End. Time = &quot;</span> + <span class="hljs-keyword">new</span> Date());<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">processCommand</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Thread.sleep(<span class="hljs-number">5000</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br> <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.command;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç¼–å†™æµ‹è¯•ç¨‹åºï¼Œæˆ‘ä»¬è¿™é‡Œä»¥é˜¿é‡Œå·´å·´æ¨èçš„ä½¿ç”¨ ThreadPoolExecutor æ„é€ å‡½æ•°è‡ªå®šä¹‰å‚æ•°çš„æ–¹å¼æ¥åˆ›å»ºçº¿ç¨‹æ± ã€‚</p><p>ThreadPoolExecutorDemo.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.concurrent.ArrayBlockingQueue;<br><span class="hljs-keyword">import</span> java.util.concurrent.ThreadPoolExecutor;<br><span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;<br> <br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThreadPoolExecutorDemo</span> </span>&#123;<br> <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> CORE_POOL_SIZE = <span class="hljs-number">5</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> MAX_POOL_SIZE = <span class="hljs-number">10</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> QUEUE_CAPACITY = <span class="hljs-number">100</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Long KEEP_ALIVE_TIME = <span class="hljs-number">1L</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br> <br>        <span class="hljs-comment">//ä½¿ç”¨é˜¿é‡Œå·´å·´æ¨èçš„åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹å¼</span><br>        <span class="hljs-comment">//é€šè¿‡ThreadPoolExecutoræ„é€ å‡½æ•°è‡ªå®šä¹‰å‚æ•°åˆ›å»º</span><br>        ThreadPoolExecutor executor = <span class="hljs-keyword">new</span> ThreadPoolExecutor(<br>                CORE_POOL_SIZE,<br>                MAX_POOL_SIZE,<br>                KEEP_ALIVE_TIME,<br>                TimeUnit.SECONDS,<br>                <span class="hljs-keyword">new</span> ArrayBlockingQueue&lt;&gt;(QUEUE_CAPACITY),<br>                <span class="hljs-keyword">new</span> ThreadPoolExecutor.CallerRunsPolicy());<br> <br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>            <span class="hljs-comment">//åˆ›å»ºWorkerThreadå¯¹è±¡ï¼ˆWorkerThreadç±»å®ç°äº†Runnable æ¥å£ï¼‰</span><br>            Runnable worker = <span class="hljs-keyword">new</span> MyRunnable(<span class="hljs-string">&quot;&quot;</span> + i);<br>            <span class="hljs-comment">//æ‰§è¡ŒRunnable</span><br>            executor.execute(worker);<br>        &#125;<br>        <span class="hljs-comment">//ç»ˆæ­¢çº¿ç¨‹æ± </span><br>        executor.shutdown();<br>        <span class="hljs-keyword">while</span> (!executor.isTerminated()) &#123;<br>        &#125;<br>        System.out.println(<span class="hljs-string">&quot;Finished all threads&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä¸Šé¢çš„ä»£ç æŒ‡å®šäº†ï¼š</p><ol><li>corePoolSize: æ ¸å¿ƒçº¿ç¨‹æ•°ä¸º 5ã€‚</li><li>maximumPoolSize ï¼šæœ€å¤§çº¿ç¨‹æ•° 10</li><li>keepAliveTime : ç­‰å¾…æ—¶é—´ä¸º 1Lã€‚</li><li>unit: ç­‰å¾…æ—¶é—´çš„å•ä½ä¸º TimeUnit.SECONDSã€‚</li><li>workQueueï¼šä»»åŠ¡é˜Ÿåˆ—ä¸º ArrayBlockingQueueï¼Œå¹¶ä¸”å®¹é‡ä¸º 100;</li><li>handler:é¥±å’Œç­–ç•¥ä¸º CallerRunsPolicyã€‚ Outputï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java">pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">2</span> Start. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">44</span> CST <span class="hljs-number">2019</span><br>pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">5</span> Start. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">44</span> CST <span class="hljs-number">2019</span><br>pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">4</span> Start. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">44</span> CST <span class="hljs-number">2019</span><br>pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">1</span> Start. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">44</span> CST <span class="hljs-number">2019</span><br>pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">3</span> Start. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">44</span> CST <span class="hljs-number">2019</span><br>pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">5</span> End. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">49</span> CST <span class="hljs-number">2019</span><br>pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">3</span> End. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">49</span> CST <span class="hljs-number">2019</span><br>pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">2</span> End. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">49</span> CST <span class="hljs-number">2019</span><br>pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">4</span> End. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">49</span> CST <span class="hljs-number">2019</span><br>pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">1</span> End. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">49</span> CST <span class="hljs-number">2019</span><br>pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">2</span> Start. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">49</span> CST <span class="hljs-number">2019</span><br>pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">1</span> Start. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">49</span> CST <span class="hljs-number">2019</span><br>pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">4</span> Start. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">49</span> CST <span class="hljs-number">2019</span><br>pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">3</span> Start. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">49</span> CST <span class="hljs-number">2019</span><br>pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">5</span> Start. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">49</span> CST <span class="hljs-number">2019</span><br>pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">2</span> End. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">54</span> CST <span class="hljs-number">2019</span><br>pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">3</span> End. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">54</span> CST <span class="hljs-number">2019</span><br>pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">4</span> End. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">54</span> CST <span class="hljs-number">2019</span><br>pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">5</span> End. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">54</span> CST <span class="hljs-number">2019</span><br>pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">1</span> End. Time = Tue Nov <span class="hljs-number">12</span> <span class="hljs-number">20</span>:<span class="hljs-number">59</span>:<span class="hljs-number">54</span> CST <span class="hljs-number">2019</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>çº¿ç¨‹æ± </tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸ºä»€ä¹ˆè¦ç”¨çº¿ç¨‹æ± </title>
    <link href="/blog/2021/03/18/%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E7%94%A8%E7%BA%BF%E7%A8%8B%E6%B1%A0/"/>
    <url>/blog/2021/03/18/%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E7%94%A8%E7%BA%BF%E7%A8%8B%E6%B1%A0/</url>
    
    <content type="html"><![CDATA[<p><strong>æ± åŒ–æŠ€æœ¯ç›¸æ¯”å¤§å®¶å·²ç»å±¡è§ä¸é²œäº†ï¼Œçº¿ç¨‹æ± ã€æ•°æ®åº“è¿æ¥æ± ã€Http è¿æ¥æ± ç­‰ç­‰éƒ½æ˜¯å¯¹è¿™ä¸ªæ€æƒ³çš„åº”ç”¨ã€‚æ± åŒ–æŠ€æœ¯çš„æ€æƒ³ä¸»è¦æ˜¯ä¸ºäº†å‡å°‘æ¯æ¬¡è·å–èµ„æºçš„æ¶ˆè€—ï¼Œæé«˜å¯¹èµ„æºçš„åˆ©ç”¨ç‡ã€‚</strong> çº¿ç¨‹æ± æä¾›äº†ä¸€ç§é™åˆ¶å’Œç®¡ç†èµ„æºï¼ˆåŒ…æ‹¬æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼‰ã€‚ æ¯ä¸ªçº¿ç¨‹æ± è¿˜ç»´æŠ¤ä¸€äº›åŸºæœ¬ç»Ÿè®¡ä¿¡æ¯ï¼Œä¾‹å¦‚å·²å®Œæˆä»»åŠ¡çš„æ•°é‡ã€‚</p><p>è¿™é‡Œå€Ÿç”¨ã€ŠJava å¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹æåˆ°çš„æ¥è¯´ä¸€ä¸‹ä½¿ç”¨çº¿ç¨‹æ± çš„å¥½å¤„ï¼š</p><ol><li>é™ä½èµ„æºæ¶ˆè€—ã€‚é€šè¿‡é‡å¤åˆ©ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹é™ä½çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯é€ æˆçš„æ¶ˆè€—ã€‚</li><li>æé«˜å“åº”é€Ÿåº¦ã€‚å½“ä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œä»»åŠ¡å¯ä»¥ä¸éœ€è¦çš„ç­‰åˆ°çº¿ç¨‹åˆ›å»ºå°±èƒ½ç«‹å³æ‰§è¡Œã€‚</li><li>æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§ã€‚çº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºï¼Œå¦‚æœæ— é™åˆ¶çš„åˆ›å»ºï¼Œä¸ä»…ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œè¿˜ä¼šé™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥è¿›è¡Œç»Ÿä¸€çš„åˆ†é…ï¼Œè°ƒä¼˜å’Œç›‘æ§ã€‚</li></ol><h2 id="å®ç°Runnableæ¥å£å’ŒCallableæ¥å£çš„åŒºåˆ«"><a href="#å®ç°Runnableæ¥å£å’ŒCallableæ¥å£çš„åŒºåˆ«" class="headerlink" title="å®ç°Runnableæ¥å£å’ŒCallableæ¥å£çš„åŒºåˆ«"></a>å®ç°Runnableæ¥å£å’ŒCallableæ¥å£çš„åŒºåˆ«</h2><p>Runnableè‡ªJava 1.0ä»¥æ¥ä¸€ç›´å­˜åœ¨ï¼Œä½†Callableä»…åœ¨Java 1.5ä¸­å¼•å…¥,ç›®çš„å°±æ˜¯ä¸ºäº†æ¥å¤„ç†Runnableä¸æ”¯æŒçš„ç”¨ä¾‹ã€‚Runnable æ¥å£ä¸ä¼šè¿”å›ç»“æœæˆ–æŠ›å‡ºæ£€æŸ¥å¼‚å¸¸ï¼Œä½†æ˜¯Callable æ¥å£å¯ä»¥ã€‚æ‰€ä»¥ï¼Œå¦‚æœä»»åŠ¡ä¸éœ€è¦è¿”å›ç»“æœæˆ–æŠ›å‡ºå¼‚å¸¸æ¨èä½¿ç”¨ Runnable æ¥å£ï¼Œè¿™æ ·ä»£ç çœ‹èµ·æ¥ä¼šæ›´åŠ ç®€æ´ã€‚</p><p>å·¥å…·ç±» Executors å¯ä»¥å®ç° Runnable å¯¹è±¡å’Œ Callable å¯¹è±¡ä¹‹é—´çš„ç›¸äº’è½¬æ¢ã€‚ï¼ˆExecutors.callableï¼ˆRunnable taskï¼‰æˆ– Executors.callableï¼ˆRunnable taskï¼ŒObject resuleï¼‰ï¼‰ã€‚</p><p>Runnable.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@FunctionalInterface</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Runnable</span> </span>&#123;<br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * è¢«çº¿ç¨‹æ‰§è¡Œï¼Œæ²¡æœ‰è¿”å›å€¼ä¹Ÿæ— æ³•æŠ›å‡ºå¼‚å¸¸</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>Callable.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@FunctionalInterface</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Callable</span>&lt;<span class="hljs-title">V</span>&gt; </span>&#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è®¡ç®—ç»“æœï¼Œæˆ–åœ¨æ— æ³•è¿™æ ·åšæ—¶æŠ›å‡ºå¼‚å¸¸ã€‚</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> è®¡ç®—å¾—å‡ºçš„ç»“æœ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> å¦‚æœæ— æ³•è®¡ç®—ç»“æœï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function">V <span class="hljs-title">call</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æ‰§è¡Œexecute-æ–¹æ³•å’Œsubmit-æ–¹æ³•çš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ"><a href="#æ‰§è¡Œexecute-æ–¹æ³•å’Œsubmit-æ–¹æ³•çš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ" class="headerlink" title="æ‰§è¡Œexecute()æ–¹æ³•å’Œsubmit()æ–¹æ³•çš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ"></a>æ‰§è¡Œexecute()æ–¹æ³•å’Œsubmit()æ–¹æ³•çš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</h2><ol><li>execute()æ–¹æ³•ç”¨äºæäº¤ä¸éœ€è¦è¿”å›å€¼çš„ä»»åŠ¡ï¼Œæ‰€ä»¥æ— æ³•åˆ¤æ–­ä»»åŠ¡æ˜¯å¦è¢«çº¿ç¨‹æ± æ‰§è¡ŒæˆåŠŸä¸å¦ï¼›</li><li>submit()æ–¹æ³•ç”¨äºæäº¤éœ€è¦è¿”å›å€¼çš„ä»»åŠ¡ã€‚çº¿ç¨‹æ± ä¼šè¿”å›ä¸€ä¸ª Future ç±»å‹çš„å¯¹è±¡ï¼Œé€šè¿‡è¿™ä¸ª Future å¯¹è±¡å¯ä»¥åˆ¤æ–­ä»»åŠ¡æ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ Future çš„ get()æ–¹æ³•æ¥è·å–è¿”å›å€¼ï¼Œget()æ–¹æ³•ä¼šé˜»å¡å½“å‰çº¿ç¨‹ç›´åˆ°ä»»åŠ¡å®Œæˆï¼Œè€Œä½¿ç”¨ getï¼ˆlong timeoutï¼ŒTimeUnit unitï¼‰æ–¹æ³•åˆ™ä¼šé˜»å¡å½“å‰çº¿ç¨‹ä¸€æ®µæ—¶é—´åç«‹å³è¿”å›ï¼Œè¿™æ—¶å€™æœ‰å¯èƒ½ä»»åŠ¡æ²¡æœ‰æ‰§è¡Œå®Œã€‚ æˆ‘ä»¬ä»¥AbstractExecutorServiceæ¥å£ä¸­çš„ä¸€ä¸ª submit æ–¹æ³•ä¸ºä¾‹å­æ¥çœ‹çœ‹æºä»£ç ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Future&lt;?&gt; submit(Runnable task) &#123;<br>        <span class="hljs-keyword">if</span> (task == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NullPointerException();<br>        RunnableFuture&lt;Void&gt; ftask = newTaskFor(task, <span class="hljs-keyword">null</span>);<br>        execute(ftask);<br>        <span class="hljs-keyword">return</span> ftask;<br>    &#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢æ–¹æ³•è°ƒç”¨çš„ newTaskFor æ–¹æ³•è¿”å›äº†ä¸€ä¸ª FutureTask å¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> &lt;T&gt; <span class="hljs-function">RunnableFuture&lt;T&gt; <span class="hljs-title">newTaskFor</span><span class="hljs-params">(Runnable runnable, T value)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FutureTask&lt;T&gt;(runnable, value);<br>    &#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å†æ¥çœ‹çœ‹execute()æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">execute</span><span class="hljs-params">(Runnable command)</span> </span>&#123;<br>     ...<br>   &#125;<br></code></pre></td></tr></table></figure><p><a href="https://bk.cuixiaoyan.xyz/archives/newTaskFor#%E5%AE%9E%E7%8E%B0runnable%E6%8E%A5%E5%8F%A3%E5%92%8Ccallable%E6%8E%A5%E5%8F%A3%E7%9A%84%E5%8C%BA%E5%88%AB">å®ç°Runnableæ¥å£å’ŒCallableæ¥å£çš„åŒºåˆ«</a><a href="https://bk.cuixiaoyan.xyz/archives/newTaskFor#%E6%89%A7%E8%A1%8Cexecute%E6%96%B9%E6%B3%95%E5%92%8Csubmit%E6%96%B9%E6%B3%95%E7%9A%84%E5%8C%BA%E5%88%AB%E6%98%AF%E4%BB%80%E4%B9%88%E5%91%A2">æ‰§è¡Œexecute()æ–¹æ³•å’Œsubmit()æ–¹æ³•çš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>çº¿ç¨‹æ± </tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ThreadLocal</title>
    <link href="/blog/2021/03/18/ThreadLocal/"/>
    <url>/blog/2021/03/18/ThreadLocal/</url>
    
    <content type="html"><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åˆ›å»ºçš„å˜é‡æ˜¯å¯ä»¥è¢«ä»»ä½•ä¸€ä¸ªçº¿ç¨‹è®¿é—®å¹¶ä¿®æ”¹çš„ã€‚å¦‚æœæƒ³å®ç°æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ä¸“å±æœ¬åœ°å˜é‡è¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿ JDKä¸­æä¾›çš„ThreadLocalç±»æ­£æ˜¯ä¸ºäº†è§£å†³è¿™æ ·çš„é—®é¢˜ã€‚ ThreadLocalç±»ä¸»è¦è§£å†³çš„å°±æ˜¯è®©æ¯ä¸ªçº¿ç¨‹ç»‘å®šè‡ªå·±çš„å€¼ï¼Œå¯ä»¥å°†ThreadLocalç±»å½¢è±¡çš„æ¯”å–»æˆå­˜æ”¾æ•°æ®çš„ç›’å­ï¼Œç›’å­ä¸­å¯ä»¥å­˜å‚¨æ¯ä¸ªçº¿ç¨‹çš„ç§æœ‰æ•°æ®ã€‚</p><p>å¦‚æœä½ åˆ›å»ºäº†ä¸€ä¸ªThreadLocalå˜é‡ï¼Œé‚£ä¹ˆè®¿é—®è¿™ä¸ªå˜é‡çš„æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰è¿™ä¸ªå˜é‡çš„æœ¬åœ°å‰¯æœ¬ï¼Œè¿™ä¹Ÿæ˜¯ThreadLocalå˜é‡åçš„ç”±æ¥ã€‚ä»–ä»¬å¯ä»¥ä½¿ç”¨ getï¼ˆï¼‰ å’Œ setï¼ˆï¼‰ æ–¹æ³•æ¥è·å–é»˜è®¤å€¼æˆ–å°†å…¶å€¼æ›´æ”¹ä¸ºå½“å‰çº¿ç¨‹æ‰€å­˜çš„å‰¯æœ¬çš„å€¼ï¼Œä»è€Œé¿å…äº†çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p><p>å†ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><p>æ¯”å¦‚æœ‰ä¸¤ä¸ªäººå»å®å±‹æ”¶é›†å®ç‰©ï¼Œè¿™ä¸¤ä¸ªå…±ç”¨ä¸€ä¸ªè¢‹å­çš„è¯è‚¯å®šä¼šäº§ç”Ÿäº‰æ‰§ï¼Œä½†æ˜¯ç»™ä»–ä»¬ä¸¤ä¸ªäººæ¯ä¸ªäººåˆ†é…ä¸€ä¸ªè¢‹å­çš„è¯å°±ä¸ä¼šå‡ºç°è¿™æ ·çš„é—®é¢˜ã€‚å¦‚æœæŠŠè¿™ä¸¤ä¸ªäººæ¯”ä½œçº¿ç¨‹çš„è¯ï¼Œé‚£ä¹ˆThreadLocalå°±æ˜¯ç”¨æ¥é¿å…è¿™ä¸¤ä¸ªçº¿ç¨‹ç«äº‰çš„ã€‚</p><h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h2><p>ç›¸ä¿¡çœ‹äº†ä¸Šé¢çš„è§£é‡Šï¼Œå¤§å®¶å·²ç»ææ‡‚ ThreadLocal ç±»æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.text.SimpleDateFormat;<br><span class="hljs-keyword">import</span> java.util.Random;<br> <br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThreadLocalExample</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Runnable</span></span>&#123;<br> <br>     <span class="hljs-comment">// SimpleDateFormat ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥æ¯ä¸ªçº¿ç¨‹éƒ½è¦æœ‰è‡ªå·±ç‹¬ç«‹çš„å‰¯æœ¬</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ThreadLocal&lt;SimpleDateFormat&gt; formatter = ThreadLocal.withInitial(() -&gt; <span class="hljs-keyword">new</span> SimpleDateFormat(<span class="hljs-string">&quot;yyyyMMdd HHmm&quot;</span>));<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;<br>        ThreadLocalExample obj = <span class="hljs-keyword">new</span> ThreadLocalExample();<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span> ; i&lt;<span class="hljs-number">10</span>; i++)&#123;<br>            Thread t = <span class="hljs-keyword">new</span> Thread(obj, <span class="hljs-string">&quot;&quot;</span>+i);<br>            Thread.sleep(<span class="hljs-keyword">new</span> Random().nextInt(<span class="hljs-number">1000</span>));<br>            t.start();<br>        &#125;<br>    &#125;<br> <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;Thread Name= &quot;</span>+Thread.currentThread().getName()+<span class="hljs-string">&quot; default Formatter = &quot;</span>+formatter.get().toPattern());<br>        <span class="hljs-keyword">try</span> &#123;<br>            Thread.sleep(<span class="hljs-keyword">new</span> Random().nextInt(<span class="hljs-number">1000</span>));<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-comment">//formatter pattern is changed here by thread, but it won&#x27;t reflect to other threads</span><br>        formatter.set(<span class="hljs-keyword">new</span> SimpleDateFormat());<br> <br>        System.out.println(<span class="hljs-string">&quot;Thread Name= &quot;</span>+Thread.currentThread().getName()+<span class="hljs-string">&quot; formatter = &quot;</span>+formatter.get().toPattern());<br>    &#125;<br> <br>&#125;<br></code></pre></td></tr></table></figure><p>Output:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java">Thread Name= <span class="hljs-number">0</span> <span class="hljs-keyword">default</span> Formatter = yyyyMMdd HHmm<br>Thread Name= <span class="hljs-number">0</span> formatter = yy-M-d ah:mm<br>Thread Name= <span class="hljs-number">1</span> <span class="hljs-keyword">default</span> Formatter = yyyyMMdd HHmm<br>Thread Name= <span class="hljs-number">2</span> <span class="hljs-keyword">default</span> Formatter = yyyyMMdd HHmm<br>Thread Name= <span class="hljs-number">1</span> formatter = yy-M-d ah:mm<br>Thread Name= <span class="hljs-number">3</span> <span class="hljs-keyword">default</span> Formatter = yyyyMMdd HHmm<br>Thread Name= <span class="hljs-number">2</span> formatter = yy-M-d ah:mm<br>Thread Name= <span class="hljs-number">4</span> <span class="hljs-keyword">default</span> Formatter = yyyyMMdd HHmm<br>Thread Name= <span class="hljs-number">3</span> formatter = yy-M-d ah:mm<br>Thread Name= <span class="hljs-number">4</span> formatter = yy-M-d ah:mm<br>Thread Name= <span class="hljs-number">5</span> <span class="hljs-keyword">default</span> Formatter = yyyyMMdd HHmm<br>Thread Name= <span class="hljs-number">5</span> formatter = yy-M-d ah:mm<br>Thread Name= <span class="hljs-number">6</span> <span class="hljs-keyword">default</span> Formatter = yyyyMMdd HHmm<br>Thread Name= <span class="hljs-number">6</span> formatter = yy-M-d ah:mm<br>Thread Name= <span class="hljs-number">7</span> <span class="hljs-keyword">default</span> Formatter = yyyyMMdd HHmm<br>Thread Name= <span class="hljs-number">7</span> formatter = yy-M-d ah:mm<br>Thread Name= <span class="hljs-number">8</span> <span class="hljs-keyword">default</span> Formatter = yyyyMMdd HHmm<br>Thread Name= <span class="hljs-number">9</span> <span class="hljs-keyword">default</span> Formatter = yyyyMMdd HHmm<br>Thread Name= <span class="hljs-number">8</span> formatter = yy-M-d ah:mm<br>Thread Name= <span class="hljs-number">9</span> formatter = yy-M-d ah:mm<br></code></pre></td></tr></table></figure><p>ä»è¾“å‡ºä¸­å¯ä»¥çœ‹å‡ºï¼ŒThread-0å·²ç»æ”¹å˜äº†formatterçš„å€¼ï¼Œä½†ä»ç„¶æ˜¯thread-2é»˜è®¤æ ¼å¼åŒ–ç¨‹åºä¸åˆå§‹åŒ–å€¼ç›¸åŒï¼Œå…¶ä»–çº¿ç¨‹ä¹Ÿä¸€æ ·ã€‚</p><p>ä¸Šé¢æœ‰ä¸€æ®µä»£ç ç”¨åˆ°äº†åˆ›å»º ThreadLocal å˜é‡çš„é‚£æ®µä»£ç ç”¨åˆ°äº† Java8 çš„çŸ¥è¯†ï¼Œå®ƒç­‰äºä¸‹é¢è¿™æ®µä»£ç ï¼Œå¦‚æœä½ å†™äº†ä¸‹é¢è¿™æ®µä»£ç çš„è¯ï¼ŒIDEAä¼šæç¤ºä½ è½¬æ¢ä¸ºJava8çš„æ ¼å¼(IDEAçœŸçš„ä¸é”™ï¼)ã€‚å› ä¸ºThreadLocalç±»åœ¨Java 8ä¸­æ‰©å±•ï¼Œä½¿ç”¨ä¸€ä¸ªæ–°çš„æ–¹æ³•withInitial()ï¼Œå°†SupplieråŠŸèƒ½æ¥å£ä½œä¸ºå‚æ•°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ThreadLocal&lt;SimpleDateFormat&gt; formatter = <span class="hljs-keyword">new</span> ThreadLocal&lt;SimpleDateFormat&gt;()&#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">protected</span> SimpleDateFormat <span class="hljs-title">initialValue</span><span class="hljs-params">()</span></span><br><span class="hljs-function">        </span>&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SimpleDateFormat(<span class="hljs-string">&quot;yyyyMMdd HHmm&quot;</span>);<br>        &#125;<br>    &#125;;<br></code></pre></td></tr></table></figure><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>ä» Threadç±»æºä»£ç å…¥æ‰‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Thread</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Runnable</span> </span>&#123;<br> ......<br><span class="hljs-comment">//ä¸æ­¤çº¿ç¨‹æœ‰å…³çš„ThreadLocalå€¼ã€‚ç”±ThreadLocalç±»ç»´æŠ¤</span><br>ThreadLocal.ThreadLocalMap threadLocals = <span class="hljs-keyword">null</span>;<br> <br><span class="hljs-comment">//ä¸æ­¤çº¿ç¨‹æœ‰å…³çš„InheritableThreadLocalå€¼ã€‚ç”±InheritableThreadLocalç±»ç»´æŠ¤</span><br>ThreadLocal.ThreadLocalMap inheritableThreadLocals = <span class="hljs-keyword">null</span>;<br> ......<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»ä¸Šé¢Threadç±» æºä»£ç å¯ä»¥çœ‹å‡ºThread ç±»ä¸­æœ‰ä¸€ä¸ª threadLocals å’Œ ä¸€ä¸ª inheritableThreadLocals å˜é‡ï¼Œå®ƒä»¬éƒ½æ˜¯ ThreadLocalMap ç±»å‹çš„å˜é‡,æˆ‘ä»¬å¯ä»¥æŠŠ ThreadLocalMap ç†è§£ä¸ºThreadLocal ç±»å®ç°çš„å®šåˆ¶åŒ–çš„ HashMapã€‚é»˜è®¤æƒ…å†µä¸‹è¿™ä¸¤ä¸ªå˜é‡éƒ½æ˜¯nullï¼Œåªæœ‰å½“å‰çº¿ç¨‹è°ƒç”¨ ThreadLocal ç±»çš„ setæˆ–getæ–¹æ³•æ—¶æ‰åˆ›å»ºå®ƒä»¬ï¼Œå®é™…ä¸Šè°ƒç”¨è¿™ä¸¤ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œæˆ‘ä»¬è°ƒç”¨çš„æ˜¯ThreadLocalMapç±»å¯¹åº”çš„ get()ã€set()æ–¹æ³•ã€‚</p><p>ThreadLocalç±»çš„set()æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">set</span><span class="hljs-params">(T value)</span> </span>&#123;<br>        Thread t = Thread.currentThread();<br>        ThreadLocalMap map = getMap(t);<br>        <span class="hljs-keyword">if</span> (map != <span class="hljs-keyword">null</span>)<br>            map.set(<span class="hljs-keyword">this</span>, value);<br>        <span class="hljs-keyword">else</span><br>            createMap(t, value);<br>    &#125;<br>    <span class="hljs-function">ThreadLocalMap <span class="hljs-title">getMap</span><span class="hljs-params">(Thread t)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> t.threadLocals;<br>    &#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šé¢è¿™äº›å†…å®¹ï¼Œæˆ‘ä»¬è¶³ä»¥é€šè¿‡çŒœæµ‹å¾—å‡ºç»“è®ºï¼šæœ€ç»ˆçš„å˜é‡æ˜¯æ”¾åœ¨äº†å½“å‰çº¿ç¨‹çš„ ThreadLocalMap ä¸­ï¼Œå¹¶ä¸æ˜¯å­˜åœ¨ ThreadLocal ä¸Šï¼ŒThreadLocal å¯ä»¥ç†è§£ä¸ºåªæ˜¯ThreadLocalMapçš„å°è£…ï¼Œä¼ é€’äº†å˜é‡å€¼ã€‚ ThrealLocal ç±»ä¸­å¯ä»¥é€šè¿‡Thread.currentThread()è·å–åˆ°å½“å‰çº¿ç¨‹å¯¹è±¡åï¼Œç›´æ¥é€šè¿‡getMap(Thread t)å¯ä»¥è®¿é—®åˆ°è¯¥çº¿ç¨‹çš„ThreadLocalMapå¯¹è±¡ã€‚</p><p>æ¯ä¸ªThreadä¸­éƒ½å…·å¤‡ä¸€ä¸ªThreadLocalMapï¼Œè€ŒThreadLocalMapå¯ä»¥å­˜å‚¨ä»¥ThreadLocalä¸ºkeyçš„é”®å€¼å¯¹ã€‚ æ¯”å¦‚æˆ‘ä»¬åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­å£°æ˜äº†ä¸¤ä¸ª ThreadLocal å¯¹è±¡çš„è¯ï¼Œä¼šä½¿ç”¨ Threadå†…éƒ¨éƒ½æ˜¯ä½¿ç”¨ä»…æœ‰é‚£ä¸ªThreadLocalMap å­˜æ”¾æ•°æ®çš„ï¼ŒThreadLocalMapçš„ key å°±æ˜¯ ThreadLocalå¯¹è±¡ï¼Œvalue å°±æ˜¯ ThreadLocal å¯¹è±¡è°ƒç”¨setæ–¹æ³•è®¾ç½®çš„å€¼ã€‚ThreadLocal æ˜¯ mapç»“æ„æ˜¯ä¸ºäº†è®©æ¯ä¸ªçº¿ç¨‹å¯ä»¥å…³è”å¤šä¸ª ThreadLocalå˜é‡ã€‚è¿™ä¹Ÿå°±è§£é‡Šäº† ThreadLocal å£°æ˜çš„å˜é‡ä¸ºä»€ä¹ˆåœ¨æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ä¸“å±æœ¬åœ°å˜é‡ã€‚</p><p>ThreadLocalMapæ˜¯ThreadLocalçš„é™æ€å†…éƒ¨ç±»ã€‚<img src="https://cuixiaoyande.oss-cn-shanghai.aliyuncs.com/ThreadLocal%E5%86%85%E9%83%A8%E7%B1%BB_1575941927731.png?x-oss-process=style/small" alt="ThreadLocalå†…éƒ¨ç±»"></p><h2 id="å†…å­˜æ³„éœ²é—®é¢˜"><a href="#å†…å­˜æ³„éœ²é—®é¢˜" class="headerlink" title="å†…å­˜æ³„éœ²é—®é¢˜"></a>å†…å­˜æ³„éœ²é—®é¢˜</h2><p>ThreadLocalMap ä¸­ä½¿ç”¨çš„ key ä¸º ThreadLocal çš„å¼±å¼•ç”¨,è€Œ value æ˜¯å¼ºå¼•ç”¨ã€‚æ‰€ä»¥ï¼Œå¦‚æœ ThreadLocal æ²¡æœ‰è¢«å¤–éƒ¨å¼ºå¼•ç”¨çš„æƒ…å†µä¸‹ï¼Œåœ¨åƒåœ¾å›æ”¶çš„æ—¶å€™ï¼Œkey ä¼šè¢«æ¸…ç†æ‰ï¼Œè€Œ value ä¸ä¼šè¢«æ¸…ç†æ‰ã€‚è¿™æ ·ä¸€æ¥ï¼ŒThreadLocalMap ä¸­å°±ä¼šå‡ºç°keyä¸ºnullçš„Entryã€‚å‡å¦‚æˆ‘ä»¬ä¸åšä»»ä½•æªæ–½çš„è¯ï¼Œvalue æ°¸è¿œæ— æ³•è¢«GC å›æ”¶ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯èƒ½ä¼šäº§ç”Ÿå†…å­˜æ³„éœ²ã€‚ThreadLocalMapå®ç°ä¸­å·²ç»è€ƒè™‘äº†è¿™ç§æƒ…å†µï¼Œåœ¨è°ƒç”¨ set()ã€get()ã€remove() æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šæ¸…ç†æ‰ key ä¸º null çš„è®°å½•ã€‚ä½¿ç”¨å®Œ ThreadLocalæ–¹æ³•å æœ€å¥½æ‰‹åŠ¨è°ƒç”¨remove()æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Entry</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WeakReference</span>&lt;<span class="hljs-title">ThreadLocal</span>&lt;?&gt;&gt; </span>&#123;<br>            <span class="hljs-comment">/** The value associated with this ThreadLocal. */</span><br>            Object value;<br> <br>            Entry(ThreadLocal&lt;?&gt; k, Object v) &#123;<br>                <span class="hljs-keyword">super</span>(k);<br>                value = v;<br>            &#125;<br>        &#125;<br> <br></code></pre></td></tr></table></figure><h3 id="å¼±å¼•ç”¨"><a href="#å¼±å¼•ç”¨" class="headerlink" title="å¼±å¼•ç”¨"></a>å¼±å¼•ç”¨</h3><p>å¦‚æœä¸€ä¸ªå¯¹è±¡åªå…·æœ‰å¼±å¼•ç”¨ï¼Œé‚£å°±ç±»ä¼¼äºå¯æœ‰å¯æ— çš„ç”Ÿæ´»ç”¨å“ã€‚å¼±å¼•ç”¨ä¸è½¯å¼•ç”¨çš„åŒºåˆ«åœ¨äºï¼šåªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡æ‹¥æœ‰æ›´çŸ­æš‚çš„ç”Ÿå‘½å‘¨æœŸã€‚åœ¨åƒåœ¾å›æ”¶å™¨çº¿ç¨‹æ‰«æå®ƒ æ‰€ç®¡è¾–çš„å†…å­˜åŒºåŸŸçš„è¿‡ç¨‹ä¸­ï¼Œä¸€æ—¦å‘ç°äº†åªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ï¼Œä¸ç®¡å½“å‰å†…å­˜ç©ºé—´è¶³å¤Ÿä¸å¦ï¼Œéƒ½ä¼šå›æ”¶å®ƒçš„å†…å­˜ã€‚ä¸è¿‡ï¼Œç”±äºåƒåœ¾å›æ”¶å™¨æ˜¯ä¸€ä¸ªä¼˜å…ˆçº§å¾ˆä½çš„çº¿ç¨‹ï¼Œ å› æ­¤ä¸ä¸€å®šä¼šå¾ˆå¿«å‘ç°é‚£äº›åªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ã€‚</p><p>å¼±å¼•ç”¨å¯ä»¥å’Œä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ï¼Œå¦‚æœå¼±å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼ŒJavaè™šæ‹Ÿæœºå°±ä¼šæŠŠè¿™ä¸ªå¼±å¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>ThreadLocal</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>volatileå…³é”®å­—</title>
    <link href="/blog/2021/03/18/volatile%E5%85%B3%E9%94%AE%E5%AD%97/"/>
    <url>/blog/2021/03/18/volatile%E5%85%B3%E9%94%AE%E5%AD%97/</url>
    
    <content type="html"><![CDATA[<p>åœ¨ JDK1.2 ä¹‹å‰ï¼ŒJavaçš„å†…å­˜æ¨¡å‹å®ç°æ€»æ˜¯ä»ä¸»å­˜ï¼ˆå³å…±äº«å†…å­˜ï¼‰è¯»å–å˜é‡ï¼Œæ˜¯ä¸éœ€è¦è¿›è¡Œç‰¹åˆ«çš„æ³¨æ„çš„ã€‚è€Œåœ¨å½“å‰çš„ Java å†…å­˜æ¨¡å‹ä¸‹ï¼Œçº¿ç¨‹å¯ä»¥æŠŠå˜é‡ä¿å­˜æœ¬åœ°å†…å­˜ï¼ˆæ¯”å¦‚æœºå™¨çš„å¯„å­˜å™¨ï¼‰ä¸­ï¼Œè€Œä¸æ˜¯ç›´æ¥åœ¨ä¸»å­˜ä¸­è¿›è¡Œè¯»å†™ã€‚è¿™å°±å¯èƒ½é€ æˆä¸€ä¸ªçº¿ç¨‹åœ¨ä¸»å­˜ä¸­ä¿®æ”¹äº†ä¸€ä¸ªå˜é‡çš„å€¼ï¼Œè€Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹è¿˜ç»§ç»­ä½¿ç”¨å®ƒåœ¨å¯„å­˜å™¨ä¸­çš„å˜é‡å€¼çš„æ‹·è´ï¼Œé€ æˆæ•°æ®çš„ä¸ä¸€è‡´ã€‚<img src="https://cuixiaoyande.oss-cn-shanghai.aliyuncs.com/%E6%95%B0%E6%8D%AE%E4%B8%8D%E4%B8%80%E8%87%B4_1575855805654.png?x-oss-process=style/small" alt="æ•°æ®ä¸ä¸€è‡´">è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±éœ€è¦æŠŠå˜é‡å£°æ˜ä¸ºvolatileï¼Œè¿™å°±æŒ‡ç¤º JVMï¼Œè¿™ä¸ªå˜é‡æ˜¯ä¸ç¨³å®šçš„ï¼Œæ¯æ¬¡ä½¿ç”¨å®ƒéƒ½åˆ°ä¸»å­˜ä¸­è¿›è¡Œè¯»å–ã€‚</p><p>è¯´ç™½äº†ï¼Œ volatile å…³é”®å­—çš„ä¸»è¦ä½œç”¨å°±æ˜¯ä¿è¯å˜é‡çš„å¯è§æ€§ç„¶åè¿˜æœ‰ä¸€ä¸ªä½œç”¨æ˜¯é˜²æ­¢æŒ‡ä»¤é‡æ’åºã€‚<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/small-20210318200107505.jpeg" alt="volatileå…³é”®å­—çš„å¯è§æ€§"></p><h2 id="è¯´è¯´-synchronized-å…³é”®å­—å’Œ-volatile-å…³é”®å­—çš„åŒºåˆ«"><a href="#è¯´è¯´-synchronized-å…³é”®å­—å’Œ-volatile-å…³é”®å­—çš„åŒºåˆ«" class="headerlink" title="è¯´è¯´ synchronized å…³é”®å­—å’Œ volatile å…³é”®å­—çš„åŒºåˆ«"></a>è¯´è¯´ synchronized å…³é”®å­—å’Œ volatile å…³é”®å­—çš„åŒºåˆ«</h2><p>synchronizedå…³é”®å­—å’Œvolatileå…³é”®å­—æ¯”è¾ƒ</p><p>volatileå…³é”®å­—æ˜¯çº¿ç¨‹åŒæ­¥çš„è½»é‡çº§å®ç°ï¼Œæ‰€ä»¥volatileæ€§èƒ½è‚¯å®šæ¯”synchronizedå…³é”®å­—è¦å¥½ã€‚ä½†æ˜¯volatileå…³é”®å­—åªèƒ½ç”¨äºå˜é‡è€Œsynchronizedå…³é”®å­—å¯ä»¥ä¿®é¥°æ–¹æ³•ä»¥åŠä»£ç å—ã€‚synchronizedå…³é”®å­—åœ¨JavaSE1.6ä¹‹åè¿›è¡Œäº†ä¸»è¦åŒ…æ‹¬ä¸ºäº†å‡å°‘è·å¾—é”å’Œé‡Šæ”¾é”å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—è€Œå¼•å…¥çš„åå‘é”å’Œè½»é‡çº§é”ä»¥åŠå…¶å®ƒå„ç§ä¼˜åŒ–ä¹‹åæ‰§è¡Œæ•ˆç‡æœ‰äº†æ˜¾è‘—æå‡ï¼Œå®é™…å¼€å‘ä¸­ä½¿ç”¨ synchronized å…³é”®å­—çš„åœºæ™¯è¿˜æ˜¯æ›´å¤šä¸€äº›ã€‚ å¤šçº¿ç¨‹è®¿é—®volatileå…³é”®å­—ä¸ä¼šå‘ç”Ÿé˜»å¡ï¼Œè€Œsynchronizedå…³é”®å­—å¯èƒ½ä¼šå‘ç”Ÿé˜»å¡ volatileå…³é”®å­—èƒ½ä¿è¯æ•°æ®çš„å¯è§æ€§ï¼Œä½†ä¸èƒ½ä¿è¯æ•°æ®çš„åŸå­æ€§ã€‚synchronizedå…³é”®å­—ä¸¤è€…éƒ½èƒ½ä¿è¯ã€‚ volatileå…³é”®å­—ä¸»è¦ç”¨äºè§£å†³å˜é‡åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§ï¼Œè€Œ synchronizedå…³é”®å­—è§£å†³çš„æ˜¯å¤šä¸ªçº¿ç¨‹ä¹‹é—´è®¿é—®èµ„æºçš„åŒæ­¥æ€§ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>volatile</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>synchronizedå’ŒReentrantLockçš„åŒºåˆ«</title>
    <link href="/blog/2021/03/18/synchronized%E5%92%8CReentrantLock%E7%9A%84%E5%8C%BA%E5%88%AB/"/>
    <url>/blog/2021/03/18/synchronized%E5%92%8CReentrantLock%E7%9A%84%E5%8C%BA%E5%88%AB/</url>
    
    <content type="html"><![CDATA[<p>â‘  ä¸¤è€…éƒ½æ˜¯å¯é‡å…¥é”</p><p>ä¸¤è€…éƒ½æ˜¯å¯é‡å…¥é”ã€‚â€œå¯é‡å…¥é”â€æ¦‚å¿µæ˜¯ï¼šè‡ªå·±å¯ä»¥å†æ¬¡è·å–è‡ªå·±çš„å†…éƒ¨é”ã€‚æ¯”å¦‚ä¸€ä¸ªçº¿ç¨‹è·å¾—äº†æŸä¸ªå¯¹è±¡çš„é”ï¼Œæ­¤æ—¶è¿™ä¸ªå¯¹è±¡é”è¿˜æ²¡æœ‰é‡Šæ”¾ï¼Œå½“å…¶å†æ¬¡æƒ³è¦è·å–è¿™ä¸ªå¯¹è±¡çš„é”çš„æ—¶å€™è¿˜æ˜¯å¯ä»¥è·å–çš„ï¼Œå¦‚æœä¸å¯é”é‡å…¥çš„è¯ï¼Œå°±ä¼šé€ æˆæ­»é”ã€‚åŒä¸€ä¸ªçº¿ç¨‹æ¯æ¬¡è·å–é”ï¼Œé”çš„è®¡æ•°å™¨éƒ½è‡ªå¢1ï¼Œæ‰€ä»¥è¦ç­‰åˆ°é”çš„è®¡æ•°å™¨ä¸‹é™ä¸º0æ—¶æ‰èƒ½é‡Šæ”¾é”ã€‚</p><p>â‘¡ synchronized ä¾èµ–äº JVM è€Œ ReentrantLock ä¾èµ–äº API</p><p>synchronized æ˜¯ä¾èµ–äº JVM å®ç°çš„ï¼Œå‰é¢æˆ‘ä»¬ä¹Ÿè®²åˆ°äº† è™šæ‹Ÿæœºå›¢é˜Ÿåœ¨ JDK1.6 ä¸º synchronized å…³é”®å­—è¿›è¡Œäº†å¾ˆå¤šä¼˜åŒ–ï¼Œä½†æ˜¯è¿™äº›ä¼˜åŒ–éƒ½æ˜¯åœ¨è™šæ‹Ÿæœºå±‚é¢å®ç°çš„ï¼Œå¹¶æ²¡æœ‰ç›´æ¥æš´éœ²ç»™æˆ‘ä»¬ã€‚ReentrantLock æ˜¯ JDK å±‚é¢å®ç°çš„ï¼ˆä¹Ÿå°±æ˜¯ API å±‚é¢ï¼Œéœ€è¦ lock() å’Œ unlock() æ–¹æ³•é…åˆ try/finally è¯­å¥å—æ¥å®Œæˆï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹å®ƒçš„æºä»£ç ï¼Œæ¥çœ‹å®ƒæ˜¯å¦‚ä½•å®ç°çš„ã€‚</p><p>â‘¢ ReentrantLock æ¯” synchronized å¢åŠ äº†ä¸€äº›é«˜çº§åŠŸèƒ½</p><p>ç›¸æ¯”synchronizedï¼ŒReentrantLockå¢åŠ äº†ä¸€äº›é«˜çº§åŠŸèƒ½ã€‚ä¸»è¦æ¥è¯´ä¸»è¦æœ‰ä¸‰ç‚¹ï¼šâ‘ ç­‰å¾…å¯ä¸­æ–­ï¼›â‘¡å¯å®ç°å…¬å¹³é”ï¼›â‘¢å¯å®ç°é€‰æ‹©æ€§é€šçŸ¥ï¼ˆé”å¯ä»¥ç»‘å®šå¤šä¸ªæ¡ä»¶ï¼‰</p><p>ReentrantLockæä¾›äº†ä¸€ç§èƒ½å¤Ÿä¸­æ–­ç­‰å¾…é”çš„çº¿ç¨‹çš„æœºåˆ¶ï¼Œé€šè¿‡lock.lockInterruptibly()æ¥å®ç°è¿™ä¸ªæœºåˆ¶ã€‚ä¹Ÿå°±æ˜¯è¯´æ­£åœ¨ç­‰å¾…çš„çº¿ç¨‹å¯ä»¥é€‰æ‹©æ”¾å¼ƒç­‰å¾…ï¼Œæ”¹ä¸ºå¤„ç†å…¶ä»–äº‹æƒ…ã€‚ ReentrantLockå¯ä»¥æŒ‡å®šæ˜¯å…¬å¹³é”è¿˜æ˜¯éå…¬å¹³é”ã€‚è€Œsynchronizedåªèƒ½æ˜¯éå…¬å¹³é”ã€‚æ‰€è°“çš„å…¬å¹³é”å°±æ˜¯å…ˆç­‰å¾…çš„çº¿ç¨‹å…ˆè·å¾—é”ã€‚ ReentrantLocké»˜è®¤æƒ…å†µæ˜¯éå…¬å¹³çš„ï¼Œå¯ä»¥é€šè¿‡ ReentrantLockç±»çš„ReentrantLock(boolean fair)æ„é€ æ–¹æ³•æ¥åˆ¶å®šæ˜¯å¦æ˜¯å…¬å¹³çš„ã€‚ synchronizedå…³é”®å­—ä¸wait()å’Œnotify()/notifyAll()æ–¹æ³•ç›¸ç»“åˆå¯ä»¥å®ç°ç­‰å¾…/é€šçŸ¥æœºåˆ¶ï¼ŒReentrantLockç±»å½“ç„¶ä¹Ÿå¯ä»¥å®ç°ï¼Œä½†æ˜¯éœ€è¦å€ŸåŠ©äºConditionæ¥å£ä¸newCondition() æ–¹æ³•ã€‚Conditionæ˜¯JDK1.5ä¹‹åæ‰æœ‰çš„ï¼Œå®ƒå…·æœ‰å¾ˆå¥½çš„çµæ´»æ€§ï¼Œæ¯”å¦‚å¯ä»¥å®ç°å¤šè·¯é€šçŸ¥åŠŸèƒ½ä¹Ÿå°±æ˜¯åœ¨ä¸€ä¸ªLockå¯¹è±¡ä¸­å¯ä»¥åˆ›å»ºå¤šä¸ªConditionå®ä¾‹ï¼ˆå³å¯¹è±¡ç›‘è§†å™¨ï¼‰ï¼Œçº¿ç¨‹å¯¹è±¡å¯ä»¥æ³¨å†Œåœ¨æŒ‡å®šçš„Conditionä¸­ï¼Œä»è€Œå¯ä»¥æœ‰é€‰æ‹©æ€§çš„è¿›è¡Œçº¿ç¨‹é€šçŸ¥ï¼Œåœ¨è°ƒåº¦çº¿ç¨‹ä¸Šæ›´åŠ çµæ´»ã€‚ åœ¨ä½¿ç”¨notify()/notifyAll()æ–¹æ³•è¿›è¡Œé€šçŸ¥æ—¶ï¼Œè¢«é€šçŸ¥çš„çº¿ç¨‹æ˜¯ç”± JVM é€‰æ‹©çš„ï¼Œç”¨ReentrantLockç±»ç»“åˆConditionå®ä¾‹å¯ä»¥å®ç°â€œé€‰æ‹©æ€§é€šçŸ¥â€ ï¼Œè¿™ä¸ªåŠŸèƒ½éå¸¸é‡è¦ï¼Œè€Œä¸”æ˜¯Conditionæ¥å£é»˜è®¤æä¾›çš„ã€‚è€Œsynchronizedå…³é”®å­—å°±ç›¸å½“äºæ•´ä¸ªLockå¯¹è±¡ä¸­åªæœ‰ä¸€ä¸ªConditionå®ä¾‹ï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½æ³¨å†Œåœ¨å®ƒä¸€ä¸ªèº«ä¸Šã€‚å¦‚æœæ‰§è¡ŒnotifyAll()æ–¹æ³•çš„è¯å°±ä¼šé€šçŸ¥æ‰€æœ‰å¤„äºç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹è¿™æ ·ä¼šé€ æˆå¾ˆå¤§çš„æ•ˆç‡é—®é¢˜ï¼Œè€ŒConditionå®ä¾‹çš„signalAll()æ–¹æ³• åªä¼šå”¤é†’æ³¨å†Œåœ¨è¯¥Conditionå®ä¾‹ä¸­çš„æ‰€æœ‰ç­‰å¾…çº¿ç¨‹ã€‚ å¦‚æœä½ æƒ³ä½¿ç”¨ä¸Šè¿°åŠŸèƒ½ï¼Œé‚£ä¹ˆé€‰æ‹©ReentrantLockæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p><p>â‘£ æ€§èƒ½å·²ä¸æ˜¯é€‰æ‹©æ ‡å‡†</p>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>synchronized</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>synchronizedå…³é”®å­—</title>
    <link href="/blog/2021/03/16/synchronized%E5%85%B3%E9%94%AE%E5%AD%97/"/>
    <url>/blog/2021/03/16/synchronized%E5%85%B3%E9%94%AE%E5%AD%97/</url>
    
    <content type="html"><![CDATA[<h2 id="è¯´ä¸€è¯´è‡ªå·±å¯¹äº-synchronized-å…³é”®å­—çš„äº†è§£"><a href="#è¯´ä¸€è¯´è‡ªå·±å¯¹äº-synchronized-å…³é”®å­—çš„äº†è§£" class="headerlink" title="è¯´ä¸€è¯´è‡ªå·±å¯¹äº synchronized å…³é”®å­—çš„äº†è§£"></a>è¯´ä¸€è¯´è‡ªå·±å¯¹äº synchronized å…³é”®å­—çš„äº†è§£</h2><p>synchronizedå…³é”®å­—è§£å†³çš„æ˜¯å¤šä¸ªçº¿ç¨‹ä¹‹é—´è®¿é—®èµ„æºçš„åŒæ­¥æ€§ï¼Œsynchronizedå…³é”®å­—å¯ä»¥ä¿è¯è¢«å®ƒä¿®é¥°çš„æ–¹æ³•æˆ–è€…ä»£ç å—åœ¨ä»»æ„æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚</p><p>å¦å¤–ï¼Œåœ¨ Java æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œsynchronizedå±äºé‡é‡çº§é”ï¼Œæ•ˆç‡ä½ä¸‹ï¼Œå› ä¸ºç›‘è§†å™¨é”ï¼ˆmonitorï¼‰æ˜¯ä¾èµ–äºåº•å±‚çš„æ“ä½œç³»ç»Ÿçš„ Mutex Lock æ¥å®ç°çš„ï¼ŒJava çš„çº¿ç¨‹æ˜¯æ˜ å°„åˆ°æ“ä½œç³»ç»Ÿçš„åŸç”Ÿçº¿ç¨‹ä¹‹ä¸Šçš„ã€‚å¦‚æœè¦æŒ‚èµ·æˆ–è€…å”¤é†’ä¸€ä¸ªçº¿ç¨‹ï¼Œéƒ½éœ€è¦æ“ä½œç³»ç»Ÿå¸®å¿™å®Œæˆï¼Œè€Œæ“ä½œç³»ç»Ÿå®ç°çº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢æ—¶éœ€è¦ä»ç”¨æˆ·æ€è½¬æ¢åˆ°å†…æ ¸æ€ï¼Œè¿™ä¸ªçŠ¶æ€ä¹‹é—´çš„è½¬æ¢éœ€è¦ç›¸å¯¹æ¯”è¾ƒé•¿çš„æ—¶é—´ï¼Œæ—¶é—´æˆæœ¬ç›¸å¯¹è¾ƒé«˜ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæ—©æœŸçš„ synchronized æ•ˆç‡ä½çš„åŸå› ã€‚åº†å¹¸çš„æ˜¯åœ¨ Java 6 ä¹‹å Java å®˜æ–¹å¯¹ä» JVM å±‚é¢å¯¹synchronized è¾ƒå¤§ä¼˜åŒ–ï¼Œæ‰€ä»¥ç°åœ¨çš„ synchronized é”æ•ˆç‡ä¹Ÿä¼˜åŒ–å¾—å¾ˆä¸é”™äº†ã€‚JDK1.6å¯¹é”çš„å®ç°å¼•å…¥äº†å¤§é‡çš„ä¼˜åŒ–ï¼Œå¦‚è‡ªæ—‹é”ã€é€‚åº”æ€§è‡ªæ—‹é”ã€é”æ¶ˆé™¤ã€é”ç²—åŒ–ã€åå‘é”ã€è½»é‡çº§é”ç­‰æŠ€æœ¯æ¥å‡å°‘é”æ“ä½œçš„å¼€é”€ã€‚</p><h2 id="è¯´è¯´è‡ªå·±æ˜¯æ€ä¹ˆä½¿ç”¨-synchronized-å…³é”®å­—ï¼Œåœ¨é¡¹ç›®ä¸­ç”¨åˆ°äº†å—"><a href="#è¯´è¯´è‡ªå·±æ˜¯æ€ä¹ˆä½¿ç”¨-synchronized-å…³é”®å­—ï¼Œåœ¨é¡¹ç›®ä¸­ç”¨åˆ°äº†å—" class="headerlink" title="è¯´è¯´è‡ªå·±æ˜¯æ€ä¹ˆä½¿ç”¨ synchronized å…³é”®å­—ï¼Œåœ¨é¡¹ç›®ä¸­ç”¨åˆ°äº†å—"></a>è¯´è¯´è‡ªå·±æ˜¯æ€ä¹ˆä½¿ç”¨ synchronized å…³é”®å­—ï¼Œåœ¨é¡¹ç›®ä¸­ç”¨åˆ°äº†å—</h2><p>synchronizedå…³é”®å­—æœ€ä¸»è¦çš„ä¸‰ç§ä½¿ç”¨æ–¹å¼ï¼š</p><p>ä¿®é¥°å®ä¾‹æ–¹æ³•: ä½œç”¨äºå½“å‰å¯¹è±¡å®ä¾‹åŠ é”ï¼Œè¿›å…¥åŒæ­¥ä»£ç å‰è¦è·å¾—å½“å‰å¯¹è±¡å®ä¾‹çš„é” ä¿®é¥°é™æ€æ–¹æ³•: ä¹Ÿå°±æ˜¯ç»™å½“å‰ç±»åŠ é”ï¼Œä¼šä½œç”¨äºç±»çš„æ‰€æœ‰å¯¹è±¡å®ä¾‹ï¼Œå› ä¸ºé™æ€æˆå‘˜ä¸å±äºä»»ä½•ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œæ˜¯ç±»æˆå‘˜ï¼ˆ static è¡¨æ˜è¿™æ˜¯è¯¥ç±»çš„ä¸€ä¸ªé™æ€èµ„æºï¼Œä¸ç®¡newäº†å¤šå°‘ä¸ªå¯¹è±¡ï¼Œåªæœ‰ä¸€ä»½ï¼‰ã€‚æ‰€ä»¥å¦‚æœä¸€ä¸ªçº¿ç¨‹Aè°ƒç”¨ä¸€ä¸ªå®ä¾‹å¯¹è±¡çš„éé™æ€ synchronized æ–¹æ³•ï¼Œè€Œçº¿ç¨‹Béœ€è¦è°ƒç”¨è¿™ä¸ªå®ä¾‹å¯¹è±¡æ‰€å±ç±»çš„é™æ€ synchronized æ–¹æ³•ï¼Œæ˜¯å…è®¸çš„ï¼Œä¸ä¼šå‘ç”Ÿäº’æ–¥ç°è±¡ï¼Œå› ä¸ºè®¿é—®é™æ€ synchronized æ–¹æ³•å ç”¨çš„é”æ˜¯å½“å‰ç±»çš„é”ï¼Œè€Œè®¿é—®éé™æ€ synchronized æ–¹æ³•å ç”¨çš„é”æ˜¯å½“å‰å®ä¾‹å¯¹è±¡é”ã€‚ ä¿®é¥°ä»£ç å—: æŒ‡å®šåŠ é”å¯¹è±¡ï¼Œå¯¹ç»™å®šå¯¹è±¡åŠ é”ï¼Œè¿›å…¥åŒæ­¥ä»£ç åº“å‰è¦è·å¾—ç»™å®šå¯¹è±¡çš„é”ã€‚ æ€»ç»“ï¼š synchronized å…³é”®å­—åŠ åˆ° static é™æ€æ–¹æ³•å’Œ synchronized(class)ä»£ç å—ä¸Šéƒ½æ˜¯æ˜¯ç»™ Class ç±»ä¸Šé”ã€‚synchronized å…³é”®å­—åŠ åˆ°å®ä¾‹æ–¹æ³•ä¸Šæ˜¯ç»™å¯¹è±¡å®ä¾‹ä¸Šé”ã€‚å°½é‡ä¸è¦ä½¿ç”¨ synchronized(String a) å› ä¸ºJVMä¸­ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± å…·æœ‰ç¼“å­˜åŠŸèƒ½ï¼</p><p>ä¸‹é¢æˆ‘ä»¥ä¸€ä¸ªå¸¸è§çš„é¢è¯•é¢˜ä¸ºä¾‹è®²è§£ä¸€ä¸‹ synchronized å…³é”®å­—çš„å…·ä½“ä½¿ç”¨ã€‚</p><p>é¢è¯•ä¸­é¢è¯•å®˜ç»å¸¸ä¼šè¯´ï¼šâ€œå•ä¾‹æ¨¡å¼äº†è§£å—ï¼Ÿæ¥ç»™æˆ‘æ‰‹å†™ä¸€ä¸‹ï¼ç»™æˆ‘è§£é‡Šä¸€ä¸‹åŒé‡æ£€éªŒé”æ–¹å¼å®ç°å•ä¾‹æ¨¡å¼çš„åŸç†å‘—ï¼â€</p><p>åŒé‡æ ¡éªŒé”å®ç°å¯¹è±¡å•ä¾‹ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Singleton</span> </span>&#123;<br> <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">static</span> Singleton uniqueInstance;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">Singleton</span><span class="hljs-params">()</span> </span>&#123;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title">getUniqueInstance</span><span class="hljs-params">()</span> </span>&#123;<br>       <span class="hljs-comment">//å…ˆåˆ¤æ–­å¯¹è±¡æ˜¯å¦å·²ç»å®ä¾‹è¿‡ï¼Œæ²¡æœ‰å®ä¾‹åŒ–è¿‡æ‰è¿›å…¥åŠ é”ä»£ç </span><br>        <span class="hljs-keyword">if</span> (uniqueInstance == <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-comment">//ç±»å¯¹è±¡åŠ é”</span><br>            <span class="hljs-keyword">synchronized</span> (Singleton.class) &#123;<br>                <span class="hljs-keyword">if</span> (uniqueInstance == <span class="hljs-keyword">null</span>) &#123;<br>                    uniqueInstance = <span class="hljs-keyword">new</span> Singleton();<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> uniqueInstance;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦å¤–ï¼Œéœ€è¦æ³¨æ„ uniqueInstance é‡‡ç”¨ volatile å…³é”®å­—ä¿®é¥°ä¹Ÿæ˜¯å¾ˆæœ‰å¿…è¦ã€‚</p><p>uniqueInstance é‡‡ç”¨ volatile å…³é”®å­—ä¿®é¥°ä¹Ÿæ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œ uniqueInstance = new Singleton(); è¿™æ®µä»£ç å…¶å®æ˜¯åˆ†ä¸ºä¸‰æ­¥æ‰§è¡Œï¼š</p><p>ä¸º uniqueInstance åˆ†é…å†…å­˜ç©ºé—´ åˆå§‹åŒ– uniqueInstance å°† uniqueInstance æŒ‡å‘åˆ†é…çš„å†…å­˜åœ°å€ ä½†æ˜¯ç”±äº JVM å…·æœ‰æŒ‡ä»¤é‡æ’çš„ç‰¹æ€§ï¼Œæ‰§è¡Œé¡ºåºæœ‰å¯èƒ½å˜æˆ 1-&gt;3-&gt;2ã€‚æŒ‡ä»¤é‡æ’åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹ä¸ä¼šå‡ºç°é—®é¢˜ï¼Œä½†æ˜¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¼šå¯¼è‡´ä¸€ä¸ªçº¿ç¨‹è·å¾—è¿˜æ²¡æœ‰åˆå§‹åŒ–çš„å®ä¾‹ã€‚ä¾‹å¦‚ï¼Œçº¿ç¨‹ T1 æ‰§è¡Œäº† 1 å’Œ 3ï¼Œæ­¤æ—¶ T2 è°ƒç”¨ getUniqueInstance() åå‘ç° uniqueInstance ä¸ä¸ºç©ºï¼Œå› æ­¤è¿”å› uniqueInstanceï¼Œä½†æ­¤æ—¶ uniqueInstance è¿˜æœªè¢«åˆå§‹åŒ–ã€‚</p><p>ä½¿ç”¨ volatile å¯ä»¥ç¦æ­¢ JVM çš„æŒ‡ä»¤é‡æ’ï¼Œä¿è¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¹Ÿèƒ½æ­£å¸¸è¿è¡Œã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>synchronized</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä»€ä¹ˆæ˜¯çº¿ç¨‹æ­»é”?å¦‚ä½•é¿å…æ­»é”</title>
    <link href="/blog/2021/03/16/%E4%BB%80%E4%B9%88%E6%98%AF%E7%BA%BF%E7%A8%8B%E6%AD%BB%E9%94%81?%E5%A6%82%E4%BD%95%E9%81%BF%E5%85%8D%E6%AD%BB%E9%94%81/"/>
    <url>/blog/2021/03/16/%E4%BB%80%E4%B9%88%E6%98%AF%E7%BA%BF%E7%A8%8B%E6%AD%BB%E9%94%81?%E5%A6%82%E4%BD%95%E9%81%BF%E5%85%8D%E6%AD%BB%E9%94%81/</url>
    
    <content type="html"><![CDATA[<h2 id="è®¤è¯†çº¿ç¨‹æ­»é”"><a href="#è®¤è¯†çº¿ç¨‹æ­»é”" class="headerlink" title="è®¤è¯†çº¿ç¨‹æ­»é”"></a>è®¤è¯†çº¿ç¨‹æ­»é”</h2><p>å¤šä¸ªçº¿ç¨‹åŒæ—¶è¢«é˜»å¡ï¼Œå®ƒä»¬ä¸­çš„ä¸€ä¸ªæˆ–è€…å…¨éƒ¨éƒ½åœ¨ç­‰å¾…æŸä¸ªèµ„æºè¢«é‡Šæ”¾ã€‚ç”±äºçº¿ç¨‹è¢«æ— é™æœŸåœ°é˜»å¡ï¼Œå› æ­¤ç¨‹åºä¸å¯èƒ½æ­£å¸¸ç»ˆæ­¢ã€‚</p><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œçº¿ç¨‹ A æŒæœ‰èµ„æº 2ï¼Œçº¿ç¨‹ B æŒæœ‰èµ„æº 1ï¼Œä»–ä»¬åŒæ—¶éƒ½æƒ³ç”³è¯·å¯¹æ–¹çš„èµ„æºï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªçº¿ç¨‹å°±ä¼šäº’ç›¸ç­‰å¾…è€Œè¿›å…¥æ­»é”çŠ¶æ€ã€‚<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/small-20210316195143184.png" alt="2019-4æ­»é”1">ä¸‹é¢é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜çº¿ç¨‹æ­»é”,ä»£ç æ¨¡æ‹Ÿäº†ä¸Šå›¾çš„æ­»é”çš„æƒ…å†µ (ä»£ç æ¥æºäºã€Šå¹¶å‘ç¼–ç¨‹ä¹‹ç¾ã€‹)ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DeadLockDemo</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Object resource1 = <span class="hljs-keyword">new</span> Object();<span class="hljs-comment">//èµ„æº 1</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Object resource2 = <span class="hljs-keyword">new</span> Object();<span class="hljs-comment">//èµ„æº 2</span><br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;<br>            <span class="hljs-keyword">synchronized</span> (resource1) &#123;<br>                System.out.println(Thread.currentThread() + <span class="hljs-string">&quot;get resource1&quot;</span>);<br>                <span class="hljs-keyword">try</span> &#123;<br>                    Thread.sleep(<span class="hljs-number">1000</span>);<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>                System.out.println(Thread.currentThread() + <span class="hljs-string">&quot;waiting get resource2&quot;</span>);<br>                <span class="hljs-keyword">synchronized</span> (resource2) &#123;<br>                    System.out.println(Thread.currentThread() + <span class="hljs-string">&quot;get resource2&quot;</span>);<br>                &#125;<br>            &#125;<br>        &#125;, <span class="hljs-string">&quot;çº¿ç¨‹ 1&quot;</span>).start();<br> <br>        <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;<br>            <span class="hljs-keyword">synchronized</span> (resource2) &#123;<br>                System.out.println(Thread.currentThread() + <span class="hljs-string">&quot;get resource2&quot;</span>);<br>                <span class="hljs-keyword">try</span> &#123;<br>                    Thread.sleep(<span class="hljs-number">1000</span>);<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>                System.out.println(Thread.currentThread() + <span class="hljs-string">&quot;waiting get resource1&quot;</span>);<br>                <span class="hljs-keyword">synchronized</span> (resource1) &#123;<br>                    System.out.println(Thread.currentThread() + <span class="hljs-string">&quot;get resource1&quot;</span>);<br>                &#125;<br>            &#125;<br>        &#125;, <span class="hljs-string">&quot;çº¿ç¨‹ 2&quot;</span>).start();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>Output</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">Thread[çº¿ç¨‹ <span class="hljs-number">1</span>,<span class="hljs-number">5</span>,main]get resource1<br>Thread[çº¿ç¨‹ <span class="hljs-number">2</span>,<span class="hljs-number">5</span>,main]get resource2<br>Thread[çº¿ç¨‹ <span class="hljs-number">1</span>,<span class="hljs-number">5</span>,main]waiting get resource2<br>Thread[çº¿ç¨‹ <span class="hljs-number">2</span>,<span class="hljs-number">5</span>,main]waiting get resource1<br></code></pre></td></tr></table></figure><p>çº¿ç¨‹ A é€šè¿‡ synchronized (resource1) è·å¾— resource1 çš„ç›‘è§†å™¨é”ï¼Œç„¶åé€šè¿‡Thread.sleep(1000);è®©çº¿ç¨‹ A ä¼‘çœ  1s ä¸ºçš„æ˜¯è®©çº¿ç¨‹ B å¾—åˆ°æ‰§è¡Œç„¶åè·å–åˆ° resource2 çš„ç›‘è§†å™¨é”ã€‚çº¿ç¨‹ A å’Œçº¿ç¨‹ B ä¼‘çœ ç»“æŸäº†éƒ½å¼€å§‹ä¼å›¾è¯·æ±‚è·å–å¯¹æ–¹çš„èµ„æºï¼Œç„¶åè¿™ä¸¤ä¸ªçº¿ç¨‹å°±ä¼šé™·å…¥äº’ç›¸ç­‰å¾…çš„çŠ¶æ€ï¼Œè¿™ä¹Ÿå°±äº§ç”Ÿäº†æ­»é”ã€‚ä¸Šé¢çš„ä¾‹å­ç¬¦åˆäº§ç”Ÿæ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶ã€‚</p><p>å­¦è¿‡æ“ä½œç³»ç»Ÿçš„æœ‹å‹éƒ½çŸ¥é“äº§ç”Ÿæ­»é”å¿…é¡»å…·å¤‡ä»¥ä¸‹å››ä¸ªæ¡ä»¶ï¼š</p><ol><li>äº’æ–¥æ¡ä»¶ï¼šè¯¥èµ„æºä»»æ„ä¸€ä¸ªæ—¶åˆ»åªç”±ä¸€ä¸ªçº¿ç¨‹å ç”¨ã€‚</li><li>è¯·æ±‚ä¸ä¿æŒæ¡ä»¶ï¼šä¸€ä¸ªè¿›ç¨‹å› è¯·æ±‚èµ„æºè€Œé˜»å¡æ—¶ï¼Œå¯¹å·²è·å¾—çš„èµ„æºä¿æŒä¸æ”¾ã€‚</li><li>ä¸å‰¥å¤ºæ¡ä»¶:çº¿ç¨‹å·²è·å¾—çš„èµ„æºåœ¨æœ«ä½¿ç”¨å®Œä¹‹å‰ä¸èƒ½è¢«å…¶ä»–çº¿ç¨‹å¼ºè¡Œå‰¥å¤ºï¼Œåªæœ‰è‡ªå·±ä½¿ç”¨å®Œæ¯•åæ‰é‡Šæ”¾èµ„æºã€‚</li><li>å¾ªç¯ç­‰å¾…æ¡ä»¶:è‹¥å¹²è¿›ç¨‹ä¹‹é—´å½¢æˆä¸€ç§å¤´å°¾ç›¸æ¥çš„å¾ªç¯ç­‰å¾…èµ„æºå…³ç³»ã€‚</li></ol><h2 id="å¦‚ä½•é¿å…çº¿ç¨‹æ­»é”"><a href="#å¦‚ä½•é¿å…çº¿ç¨‹æ­»é”" class="headerlink" title="å¦‚ä½•é¿å…çº¿ç¨‹æ­»é”?"></a>å¦‚ä½•é¿å…çº¿ç¨‹æ­»é”?</h2><p>æˆ‘ä»¬åªè¦ç ´åäº§ç”Ÿæ­»é”çš„å››ä¸ªæ¡ä»¶ä¸­çš„å…¶ä¸­ä¸€ä¸ªå°±å¯ä»¥äº†ã€‚</p><p>ç ´åäº’æ–¥æ¡ä»¶</p><p>è¿™ä¸ªæ¡ä»¶æˆ‘ä»¬æ²¡æœ‰åŠæ³•ç ´åï¼Œå› ä¸ºæˆ‘ä»¬ç”¨é”æœ¬æ¥å°±æ˜¯æƒ³è®©ä»–ä»¬äº’æ–¥çš„ï¼ˆä¸´ç•Œèµ„æºéœ€è¦äº’æ–¥è®¿é—®ï¼‰ã€‚</p><p>ç ´åè¯·æ±‚ä¸ä¿æŒæ¡ä»¶</p><p>ä¸€æ¬¡æ€§ç”³è¯·æ‰€æœ‰çš„èµ„æºã€‚</p><p>ç ´åä¸å‰¥å¤ºæ¡ä»¶</p><p>å ç”¨éƒ¨åˆ†èµ„æºçš„çº¿ç¨‹è¿›ä¸€æ­¥ç”³è¯·å…¶ä»–èµ„æºæ—¶ï¼Œå¦‚æœç”³è¯·ä¸åˆ°ï¼Œå¯ä»¥ä¸»åŠ¨é‡Šæ”¾å®ƒå æœ‰çš„èµ„æºã€‚</p><p>ç ´åå¾ªç¯ç­‰å¾…æ¡ä»¶</p><p>é æŒ‰åºç”³è¯·èµ„æºæ¥é¢„é˜²ã€‚æŒ‰æŸä¸€é¡ºåºç”³è¯·èµ„æºï¼Œé‡Šæ”¾èµ„æºåˆ™ååºé‡Šæ”¾ã€‚ç ´åå¾ªç¯ç­‰å¾…æ¡ä»¶ã€‚</p><p>æˆ‘ä»¬å¯¹çº¿ç¨‹ 2 çš„ä»£ç ä¿®æ”¹æˆä¸‹é¢è¿™æ ·å°±ä¸ä¼šäº§ç”Ÿæ­»é”äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">new</span> Thread(() -&gt; &#123;<br>            <span class="hljs-keyword">synchronized</span> (resource1) &#123;<br>                System.out.println(Thread.currentThread() + <span class="hljs-string">&quot;get resource1&quot;</span>);<br>                <span class="hljs-keyword">try</span> &#123;<br>                    Thread.sleep(<span class="hljs-number">1000</span>);<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>                System.out.println(Thread.currentThread() + <span class="hljs-string">&quot;waiting get resource2&quot;</span>);<br>                <span class="hljs-keyword">synchronized</span> (resource2) &#123;<br>                    System.out.println(Thread.currentThread() + <span class="hljs-string">&quot;get resource2&quot;</span>);<br>                &#125;<br>            &#125;<br>        &#125;, <span class="hljs-string">&quot;çº¿ç¨‹ 2&quot;</span>).start();<br></code></pre></td></tr></table></figure><p>Output</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">Thread[çº¿ç¨‹ <span class="hljs-number">1</span>,<span class="hljs-number">5</span>,main]get resource1<br>Thread[çº¿ç¨‹ <span class="hljs-number">1</span>,<span class="hljs-number">5</span>,main]waiting get resource2<br>Thread[çº¿ç¨‹ <span class="hljs-number">1</span>,<span class="hljs-number">5</span>,main]get resource2<br>Thread[çº¿ç¨‹ <span class="hljs-number">2</span>,<span class="hljs-number">5</span>,main]get resource1<br>Thread[çº¿ç¨‹ <span class="hljs-number">2</span>,<span class="hljs-number">5</span>,main]waiting get resource2<br>Thread[çº¿ç¨‹ <span class="hljs-number">2</span>,<span class="hljs-number">5</span>,main]get resource2<br> <br>Process finished with exit code <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åˆ†æä¸€ä¸‹ä¸Šé¢çš„ä»£ç ä¸ºä»€ä¹ˆé¿å…äº†æ­»é”çš„å‘ç”Ÿ?</p><p>çº¿ç¨‹ 1 é¦–å…ˆè·å¾—åˆ° resource1 çš„ç›‘è§†å™¨é”,è¿™æ—¶å€™çº¿ç¨‹ 2 å°±è·å–ä¸åˆ°äº†ã€‚ç„¶åçº¿ç¨‹ 1 å†å»è·å– resource2 çš„ç›‘è§†å™¨é”ï¼Œå¯ä»¥è·å–åˆ°ã€‚ç„¶åçº¿ç¨‹ 1 é‡Šæ”¾äº†å¯¹ resource1ã€resource2 çš„ç›‘è§†å™¨é”çš„å ç”¨ï¼Œçº¿ç¨‹ 2 è·å–åˆ°å°±å¯ä»¥æ‰§è¡Œäº†ã€‚è¿™æ ·å°±ç ´åäº†ç ´åå¾ªç¯ç­‰å¾…æ¡ä»¶ï¼Œå› æ­¤é¿å…äº†æ­»é”ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>çº¿ç¨‹æ­»é”</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå’ŒçŠ¶æ€</title>
    <link href="/blog/2021/03/16/%E7%BA%BF%E7%A8%8B%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%92%8C%E7%8A%B6%E6%80%81/"/>
    <url>/blog/2021/03/16/%E7%BA%BF%E7%A8%8B%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%92%8C%E7%8A%B6%E6%80%81/</url>
    
    <content type="html"><![CDATA[<p>Java çº¿ç¨‹åœ¨è¿è¡Œçš„ç”Ÿå‘½å‘¨æœŸä¸­çš„æŒ‡å®šæ—¶åˆ»åªå¯èƒ½å¤„äºä¸‹é¢ 6 ç§ä¸åŒçŠ¶æ€çš„å…¶ä¸­ä¸€ä¸ªçŠ¶æ€ï¼ˆå›¾æºã€ŠJava å¹¶å‘ç¼–ç¨‹è‰ºæœ¯ã€‹4.1.4 èŠ‚ï¼‰ã€‚<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/small-20210316195056031.png" alt="Javaçº¿ç¨‹çš„çŠ¶æ€"></p><p>çº¿ç¨‹åœ¨ç”Ÿå‘½å‘¨æœŸä¸­å¹¶ä¸æ˜¯å›ºå®šå¤„äºæŸä¸€ä¸ªçŠ¶æ€è€Œæ˜¯éšç€ä»£ç çš„æ‰§è¡Œåœ¨ä¸åŒçŠ¶æ€ä¹‹é—´åˆ‡æ¢ã€‚Java çº¿ç¨‹çŠ¶æ€å˜è¿å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆå›¾æºã€ŠJava å¹¶å‘ç¼–ç¨‹è‰ºæœ¯ã€‹4.1.4 èŠ‚ï¼‰ï¼š<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/small-20210316195056316.png" alt="a"></p><p>ç”±ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼šçº¿ç¨‹åˆ›å»ºä¹‹åå®ƒå°†å¤„äº NEWï¼ˆæ–°å»ºï¼‰ çŠ¶æ€ï¼Œè°ƒç”¨ start() æ–¹æ³•åå¼€å§‹è¿è¡Œï¼Œçº¿ç¨‹è¿™æ—¶å€™å¤„äº READYï¼ˆå¯è¿è¡Œï¼‰ çŠ¶æ€ã€‚å¯è¿è¡ŒçŠ¶æ€çš„çº¿ç¨‹è·å¾—äº† CPU æ—¶é—´ç‰‡ï¼ˆtimesliceï¼‰åå°±å¤„äº RUNNINGï¼ˆè¿è¡Œï¼‰ çŠ¶æ€ã€‚</p><p>æ“ä½œç³»ç»Ÿéšè— Java è™šæ‹Ÿæœºï¼ˆJVMï¼‰ä¸­çš„ RUNNABLE å’Œ RUNNING çŠ¶æ€ï¼Œå®ƒåªèƒ½çœ‹åˆ° RUNNABLE çŠ¶æ€ï¼ˆå›¾æºï¼šHowToDoInJavaï¼šJava Thread Life Cycle and Thread Statesï¼‰ï¼Œæ‰€ä»¥ Java ç³»ç»Ÿä¸€èˆ¬å°†è¿™ä¸¤ä¸ªçŠ¶æ€ç»Ÿç§°ä¸º RUNNABLEï¼ˆè¿è¡Œä¸­ï¼‰ çŠ¶æ€ ã€‚<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/small-20210316195056428.png" alt="RUNNABLE-VS-RUNNING">å½“çº¿ç¨‹æ‰§è¡Œ wait()æ–¹æ³•ä¹‹åï¼Œçº¿ç¨‹è¿›å…¥ WAITINGï¼ˆç­‰å¾…ï¼‰ çŠ¶æ€ã€‚è¿›å…¥ç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹éœ€è¦ä¾é å…¶ä»–çº¿ç¨‹çš„é€šçŸ¥æ‰èƒ½å¤Ÿè¿”å›åˆ°è¿è¡ŒçŠ¶æ€ï¼Œè€Œ TIME_WAITING(è¶…æ—¶ç­‰å¾…) çŠ¶æ€ç›¸å½“äºåœ¨ç­‰å¾…çŠ¶æ€çš„åŸºç¡€ä¸Šå¢åŠ äº†è¶…æ—¶é™åˆ¶ï¼Œæ¯”å¦‚é€šè¿‡ sleepï¼ˆlong millisï¼‰æ–¹æ³•æˆ– waitï¼ˆlong millisï¼‰æ–¹æ³•å¯ä»¥å°† Java çº¿ç¨‹ç½®äº TIMED WAITING çŠ¶æ€ã€‚å½“è¶…æ—¶æ—¶é—´åˆ°è¾¾å Java çº¿ç¨‹å°†ä¼šè¿”å›åˆ° RUNNABLE çŠ¶æ€ã€‚å½“çº¿ç¨‹è°ƒç”¨åŒæ­¥æ–¹æ³•æ—¶ï¼Œåœ¨æ²¡æœ‰è·å–åˆ°é”çš„æƒ…å†µä¸‹ï¼Œçº¿ç¨‹å°†ä¼šè¿›å…¥åˆ° BLOCKEDï¼ˆé˜»å¡ï¼‰ çŠ¶æ€ã€‚çº¿ç¨‹åœ¨æ‰§è¡Œ Runnable çš„run()æ–¹æ³•ä¹‹åå°†ä¼šè¿›å…¥åˆ° TERMINATEDï¼ˆç»ˆæ­¢ï¼‰ çŠ¶æ€ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>ç”Ÿå‘½å‘¨æœŸ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä»€ä¹ˆæ˜¯çº¿ç¨‹å’Œè¿›ç¨‹</title>
    <link href="/blog/2021/03/16/%E4%BB%80%E4%B9%88%E6%98%AF%E7%BA%BF%E7%A8%8B%E5%92%8C%E8%BF%9B%E7%A8%8B/"/>
    <url>/blog/2021/03/16/%E4%BB%80%E4%B9%88%E6%98%AF%E7%BA%BF%E7%A8%8B%E5%92%8C%E8%BF%9B%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<p>1.1. ä½•ä¸ºè¿›ç¨‹? è¿›ç¨‹æ˜¯ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œè¿‡ç¨‹ï¼Œæ˜¯ç³»ç»Ÿè¿è¡Œç¨‹åºçš„åŸºæœ¬å•ä½ï¼Œå› æ­¤è¿›ç¨‹æ˜¯åŠ¨æ€çš„ã€‚ç³»ç»Ÿè¿è¡Œä¸€ä¸ªç¨‹åºå³æ˜¯ä¸€ä¸ªè¿›ç¨‹ä»åˆ›å»ºï¼Œè¿è¡Œåˆ°æ¶ˆäº¡çš„è¿‡ç¨‹ã€‚</p><p>åœ¨ Java ä¸­ï¼Œå½“æˆ‘ä»¬å¯åŠ¨ main å‡½æ•°æ—¶å…¶å®å°±æ˜¯å¯åŠ¨äº†ä¸€ä¸ª JVM çš„è¿›ç¨‹ï¼Œè€Œ main å‡½æ•°æ‰€åœ¨çš„çº¿ç¨‹å°±æ˜¯è¿™ä¸ªè¿›ç¨‹ä¸­çš„ä¸€ä¸ªçº¿ç¨‹ï¼Œä¹Ÿç§°ä¸»çº¿ç¨‹ã€‚</p><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ¨ windows ä¸­é€šè¿‡æŸ¥çœ‹ä»»åŠ¡ç®¡ç†å™¨çš„æ–¹å¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ¸…æ¥šçœ‹åˆ° window å½“å‰è¿è¡Œçš„è¿›ç¨‹ï¼ˆ.exe æ–‡ä»¶çš„è¿è¡Œï¼‰ã€‚<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/small-20210316194835966.png" alt="è¿›ç¨‹ç¤ºä¾‹å›¾ç‰‡-Windows">1.2. ä½•ä¸ºçº¿ç¨‹? çº¿ç¨‹ä¸è¿›ç¨‹ç›¸ä¼¼ï¼Œä½†çº¿ç¨‹æ˜¯ä¸€ä¸ªæ¯”è¿›ç¨‹æ›´å°çš„æ‰§è¡Œå•ä½ã€‚ä¸€ä¸ªè¿›ç¨‹åœ¨å…¶æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å¯ä»¥äº§ç”Ÿå¤šä¸ªçº¿ç¨‹ã€‚ä¸è¿›ç¨‹ä¸åŒçš„æ˜¯åŒç±»çš„å¤šä¸ªçº¿ç¨‹å…±äº«è¿›ç¨‹çš„å †å’Œæ–¹æ³•åŒºèµ„æºï¼Œä½†æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„ç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆï¼Œæ‰€ä»¥ç³»ç»Ÿåœ¨äº§ç”Ÿä¸€ä¸ªçº¿ç¨‹ï¼Œæˆ–æ˜¯åœ¨å„ä¸ªçº¿ç¨‹ä¹‹é—´ä½œåˆ‡æ¢å·¥ä½œæ—¶ï¼Œè´Ÿæ‹…è¦æ¯”è¿›ç¨‹å°å¾—å¤šï¼Œä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼Œçº¿ç¨‹ä¹Ÿè¢«ç§°ä¸ºè½»é‡çº§è¿›ç¨‹ã€‚</p><p>Java ç¨‹åºå¤©ç”Ÿå°±æ˜¯å¤šçº¿ç¨‹ç¨‹åºï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ JMX æ¥çœ‹ä¸€ä¸‹ä¸€ä¸ªæ™®é€šçš„ Java ç¨‹åºæœ‰å“ªäº›çº¿ç¨‹ï¼Œä»£ç å¦‚ä¸‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MultiThread</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-comment">// è·å– Java çº¿ç¨‹ç®¡ç† MXBean</span><br>    ThreadMXBean threadMXBean = ManagementFactory.getThreadMXBean();<br>        <span class="hljs-comment">// ä¸éœ€è¦è·å–åŒæ­¥çš„ monitor å’Œ synchronizer ä¿¡æ¯ï¼Œä»…è·å–çº¿ç¨‹å’Œçº¿ç¨‹å †æ ˆä¿¡æ¯</span><br>        ThreadInfo[] threadInfos = threadMXBean.dumpAllThreads(<span class="hljs-keyword">false</span>, <span class="hljs-keyword">false</span>);<br>        <span class="hljs-comment">// éå†çº¿ç¨‹ä¿¡æ¯ï¼Œä»…æ‰“å°çº¿ç¨‹ ID å’Œçº¿ç¨‹åç§°ä¿¡æ¯</span><br>        <span class="hljs-keyword">for</span> (ThreadInfo threadInfo : threadInfos) &#123;<br>            System.out.println(<span class="hljs-string">&quot;[&quot;</span> + threadInfo.getThreadId() + <span class="hljs-string">&quot;] &quot;</span> + threadInfo.getThreadName());<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ç¨‹åºè¾“å‡ºå¦‚ä¸‹ï¼ˆè¾“å‡ºå†…å®¹å¯èƒ½ä¸åŒï¼Œä¸ç”¨å¤ªçº ç»“ä¸‹é¢æ¯ä¸ªçº¿ç¨‹çš„ä½œç”¨ï¼Œåªç”¨çŸ¥é“ main çº¿ç¨‹æ‰§è¡Œ main æ–¹æ³•å³å¯ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">[<span class="hljs-number">5</span>] Attach Listener <span class="hljs-comment">//æ·»åŠ äº‹ä»¶</span><br>[<span class="hljs-number">4</span>] Signal Dispatcher <span class="hljs-comment">// åˆ†å‘å¤„ç†ç»™ JVM ä¿¡å·çš„çº¿ç¨‹</span><br>[<span class="hljs-number">3</span>] Finalizer <span class="hljs-comment">//è°ƒç”¨å¯¹è±¡ finalize æ–¹æ³•çš„çº¿ç¨‹</span><br>[<span class="hljs-number">2</span>] Reference Handler <span class="hljs-comment">//æ¸…é™¤ reference çº¿ç¨‹</span><br>[<span class="hljs-number">1</span>] main <span class="hljs-comment">//main çº¿ç¨‹,ç¨‹åºå…¥å£</span><br></code></pre></td></tr></table></figure><p>ä»ä¸Šé¢çš„è¾“å‡ºå†…å®¹å¯ä»¥çœ‹å‡ºï¼šä¸€ä¸ª Java ç¨‹åºçš„è¿è¡Œæ˜¯ main çº¿ç¨‹å’Œå¤šä¸ªå…¶ä»–çº¿ç¨‹åŒæ—¶è¿è¡Œã€‚</p><p>2.1. å›¾è§£è¿›ç¨‹å’Œçº¿ç¨‹çš„å…³ç³» ä¸‹å›¾æ˜¯ Java å†…å­˜åŒºåŸŸï¼Œé€šè¿‡ä¸‹å›¾æˆ‘ä»¬ä» JVM çš„è§’åº¦æ¥è¯´ä¸€ä¸‹çº¿ç¨‹å’Œè¿›ç¨‹ä¹‹é—´çš„å…³ç³»ã€‚å¦‚æœä½ å¯¹ Java å†…å­˜åŒºåŸŸ (è¿è¡Œæ—¶æ•°æ®åŒº) è¿™éƒ¨åˆ†çŸ¥è¯†ä¸å¤ªäº†è§£çš„è¯å¯ä»¥é˜…è¯»ä¸€ä¸‹è¿™ç¯‡æ–‡ç« ï¼šã€Šå¯èƒ½æ˜¯æŠŠ Java å†…å­˜åŒºåŸŸè®²çš„æœ€æ¸…æ¥šçš„ä¸€ç¯‡æ–‡ç« ã€‹<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/small-20210316194836243.png" alt="JVMè¿è¡Œæ—¶æ•°æ®åŒºåŸŸ">ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼šä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œå¤šä¸ªçº¿ç¨‹å…±äº«è¿›ç¨‹çš„å †å’Œæ–¹æ³•åŒº (JDK1.8 ä¹‹åçš„å…ƒç©ºé—´)èµ„æºï¼Œä½†æ˜¯æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„ç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆ å’Œ æœ¬åœ°æ–¹æ³•æ ˆã€‚</p><p>æ€»ç»“ï¼š çº¿ç¨‹ æ˜¯ è¿›ç¨‹ åˆ’åˆ†æˆçš„æ›´å°çš„è¿è¡Œå•ä½ã€‚çº¿ç¨‹å’Œè¿›ç¨‹æœ€å¤§çš„ä¸åŒåœ¨äºåŸºæœ¬ä¸Šå„è¿›ç¨‹æ˜¯ç‹¬ç«‹çš„ï¼Œè€Œå„çº¿ç¨‹åˆ™ä¸ä¸€å®šï¼Œå› ä¸ºåŒä¸€è¿›ç¨‹ä¸­çš„çº¿ç¨‹ææœ‰å¯èƒ½ä¼šç›¸äº’å½±å“ã€‚çº¿ç¨‹æ‰§è¡Œå¼€é”€å°ï¼Œä½†ä¸åˆ©äºèµ„æºçš„ç®¡ç†å’Œä¿æŠ¤ï¼›è€Œè¿›ç¨‹æ­£ç›¸å</p><p>ä¸‹é¢æ˜¯è¯¥çŸ¥è¯†ç‚¹çš„æ‰©å±•å†…å®¹ï¼</p><p>ä¸‹é¢æ¥æ€è€ƒè¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šä¸ºä»€ä¹ˆç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„å‘¢ï¼Ÿä¸ºä»€ä¹ˆå †å’Œæ–¹æ³•åŒºæ˜¯çº¿ç¨‹å…±äº«çš„å‘¢ï¼Ÿ</p><p>2.2. ç¨‹åºè®¡æ•°å™¨ä¸ºä»€ä¹ˆæ˜¯ç§æœ‰çš„? ç¨‹åºè®¡æ•°å™¨ä¸»è¦æœ‰ä¸‹é¢ä¸¤ä¸ªä½œç”¨ï¼š</p><p>å­—èŠ‚ç è§£é‡Šå™¨é€šè¿‡æ”¹å˜ç¨‹åºè®¡æ•°å™¨æ¥ä¾æ¬¡è¯»å–æŒ‡ä»¤ï¼Œä»è€Œå®ç°ä»£ç çš„æµç¨‹æ§åˆ¶ï¼Œå¦‚ï¼šé¡ºåºæ‰§è¡Œã€é€‰æ‹©ã€å¾ªç¯ã€å¼‚å¸¸å¤„ç†ã€‚ åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œç¨‹åºè®¡æ•°å™¨ç”¨äºè®°å½•å½“å‰çº¿ç¨‹æ‰§è¡Œçš„ä½ç½®ï¼Œä»è€Œå½“çº¿ç¨‹è¢«åˆ‡æ¢å›æ¥çš„æ—¶å€™èƒ½å¤ŸçŸ¥é“è¯¥çº¿ç¨‹ä¸Šæ¬¡è¿è¡Œåˆ°å“ªå„¿äº†ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæ‰§è¡Œçš„æ˜¯ native æ–¹æ³•ï¼Œé‚£ä¹ˆç¨‹åºè®¡æ•°å™¨è®°å½•çš„æ˜¯ undefined åœ°å€ï¼Œåªæœ‰æ‰§è¡Œçš„æ˜¯ Java ä»£ç æ—¶ç¨‹åºè®¡æ•°å™¨è®°å½•çš„æ‰æ˜¯ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ã€‚</p><p>æ‰€ä»¥ï¼Œç¨‹åºè®¡æ•°å™¨ç§æœ‰ä¸»è¦æ˜¯ä¸ºäº†çº¿ç¨‹åˆ‡æ¢åèƒ½æ¢å¤åˆ°æ­£ç¡®çš„æ‰§è¡Œä½ç½®ã€‚</p><p>2.3. è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆä¸ºä»€ä¹ˆæ˜¯ç§æœ‰çš„? è™šæ‹Ÿæœºæ ˆï¼š æ¯ä¸ª Java æ–¹æ³•åœ¨æ‰§è¡Œçš„åŒæ—¶ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€å¸¸é‡æ± å¼•ç”¨ç­‰ä¿¡æ¯ã€‚ä»æ–¹æ³•è°ƒç”¨ç›´è‡³æ‰§è¡Œå®Œæˆçš„è¿‡ç¨‹ï¼Œå°±å¯¹åº”ç€ä¸€ä¸ªæ ˆå¸§åœ¨ Java è™šæ‹Ÿæœºæ ˆä¸­å…¥æ ˆå’Œå‡ºæ ˆçš„è¿‡ç¨‹ã€‚ æœ¬åœ°æ–¹æ³•æ ˆï¼š å’Œè™šæ‹Ÿæœºæ ˆæ‰€å‘æŒ¥çš„ä½œç”¨éå¸¸ç›¸ä¼¼ï¼ŒåŒºåˆ«æ˜¯ï¼š è™šæ‹Ÿæœºæ ˆä¸ºè™šæ‹Ÿæœºæ‰§è¡Œ Java æ–¹æ³• ï¼ˆä¹Ÿå°±æ˜¯å­—èŠ‚ç ï¼‰æœåŠ¡ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆåˆ™ä¸ºè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„ Native æ–¹æ³•æœåŠ¡ã€‚ åœ¨ HotSpot è™šæ‹Ÿæœºä¸­å’Œ Java è™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ã€‚ æ‰€ä»¥ï¼Œä¸ºäº†ä¿è¯çº¿ç¨‹ä¸­çš„å±€éƒ¨å˜é‡ä¸è¢«åˆ«çš„çº¿ç¨‹è®¿é—®åˆ°ï¼Œè™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ã€‚</p><p>2.4. ä¸€å¥è¯ç®€å•äº†è§£å †å’Œæ–¹æ³•åŒº å †å’Œæ–¹æ³•åŒºæ˜¯æ‰€æœ‰çº¿ç¨‹å…±äº«çš„èµ„æºï¼Œå…¶ä¸­å †æ˜¯è¿›ç¨‹ä¸­æœ€å¤§çš„ä¸€å—å†…å­˜ï¼Œä¸»è¦ç”¨äºå­˜æ”¾æ–°åˆ›å»ºçš„å¯¹è±¡ (æ‰€æœ‰å¯¹è±¡éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜)ï¼Œæ–¹æ³•åŒºä¸»è¦ç”¨äºå­˜æ”¾å·²è¢«åŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>çº¿ç¨‹</tag>
      
      <tag>è¿›ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HashMapå’ŒHashSetåŒºåˆ«</title>
    <link href="/blog/2021/03/16/HashMap%E5%92%8CHashSet%E5%8C%BA%E5%88%AB/"/>
    <url>/blog/2021/03/16/HashMap%E5%92%8CHashSet%E5%8C%BA%E5%88%AB/</url>
    
    <content type="html"><![CDATA[<p>å¦‚æœä½ çœ‹è¿‡ HashSet æºç çš„è¯å°±åº”è¯¥çŸ¥é“ï¼šHashSet åº•å±‚å°±æ˜¯åŸºäº HashMap å®ç°çš„ã€‚ï¼ˆHashSet çš„æºç éå¸¸éå¸¸å°‘ï¼Œå› ä¸ºé™¤äº† clone()ã€writeObject()ã€readObject()æ˜¯ HashSet è‡ªå·±ä¸å¾—ä¸å®ç°ä¹‹å¤–ï¼Œå…¶ä»–æ–¹æ³•éƒ½æ˜¯ç›´æ¥è°ƒç”¨ HashMap ä¸­çš„æ–¹æ³•ã€‚<img src="https://cuixiaoyande.oss-cn-shanghai.aliyuncs.com/QQ20191129-094719@2x_1574992056988.png?x-oss-process=style/small" alt="QQ20191129-094719@2x"></p><h2 id="HashSetå¦‚ä½•æ£€æŸ¥é‡å¤"><a href="#HashSetå¦‚ä½•æ£€æŸ¥é‡å¤" class="headerlink" title="HashSetå¦‚ä½•æ£€æŸ¥é‡å¤"></a>HashSetå¦‚ä½•æ£€æŸ¥é‡å¤</h2><p>å½“ä½ æŠŠå¯¹è±¡åŠ å…¥HashSetæ—¶ï¼ŒHashSetä¼šå…ˆè®¡ç®—å¯¹è±¡çš„hashcodeå€¼æ¥åˆ¤æ–­å¯¹è±¡åŠ å…¥çš„ä½ç½®ï¼ŒåŒæ—¶ä¹Ÿä¼šä¸å…¶ä»–åŠ å…¥çš„å¯¹è±¡çš„hashcodeå€¼ä½œæ¯”è¾ƒï¼Œå¦‚æœæ²¡æœ‰ç›¸ç¬¦çš„hashcodeï¼ŒHashSetä¼šå‡è®¾å¯¹è±¡æ²¡æœ‰é‡å¤å‡ºç°ã€‚ä½†æ˜¯å¦‚æœå‘ç°æœ‰ç›¸åŒhashcodeå€¼çš„å¯¹è±¡ï¼Œè¿™æ—¶ä¼šè°ƒç”¨equalsï¼ˆï¼‰æ–¹æ³•æ¥æ£€æŸ¥hashcodeç›¸ç­‰çš„å¯¹è±¡æ˜¯å¦çœŸçš„ç›¸åŒã€‚å¦‚æœä¸¤è€…ç›¸åŒï¼ŒHashSetå°±ä¸ä¼šè®©åŠ å…¥æ“ä½œæˆåŠŸã€‚ï¼ˆæ‘˜è‡ªæˆ‘çš„Javaå¯è’™ä¹¦ã€ŠHead fist javaã€‹ç¬¬äºŒç‰ˆï¼‰</p><h3 id="hashCodeï¼ˆï¼‰ä¸equalsï¼ˆï¼‰çš„ç›¸å…³è§„å®šï¼š"><a href="#hashCodeï¼ˆï¼‰ä¸equalsï¼ˆï¼‰çš„ç›¸å…³è§„å®šï¼š" class="headerlink" title="hashCodeï¼ˆï¼‰ä¸equalsï¼ˆï¼‰çš„ç›¸å…³è§„å®šï¼š"></a>hashCodeï¼ˆï¼‰ä¸equalsï¼ˆï¼‰çš„ç›¸å…³è§„å®šï¼š</h3><ol><li>å¦‚æœä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰ï¼Œåˆ™hashcodeä¸€å®šä¹Ÿæ˜¯ç›¸åŒçš„</li><li>ä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰,å¯¹ä¸¤ä¸ªequalsæ–¹æ³•è¿”å›true</li><li>ä¸¤ä¸ªå¯¹è±¡æœ‰ç›¸åŒçš„hashcodeå€¼ï¼Œå®ƒä»¬ä¹Ÿä¸ä¸€å®šæ˜¯ç›¸ç­‰çš„</li><li>ç»¼ä¸Šï¼Œequalsæ–¹æ³•è¢«è¦†ç›–è¿‡ï¼Œåˆ™hashCodeæ–¹æ³•ä¹Ÿå¿…é¡»è¢«è¦†ç›–</li><li>hashCode()çš„é»˜è®¤è¡Œä¸ºæ˜¯å¯¹å †ä¸Šçš„å¯¹è±¡äº§ç”Ÿç‹¬ç‰¹å€¼ã€‚å¦‚æœæ²¡æœ‰é‡å†™hashCode()ï¼Œåˆ™è¯¥classçš„ä¸¤ä¸ªå¯¹è±¡æ— è®ºå¦‚ä½•éƒ½ä¸ä¼šç›¸ç­‰ï¼ˆå³ä½¿è¿™ä¸¤ä¸ªå¯¹è±¡æŒ‡å‘ç›¸åŒçš„æ•°æ®ï¼‰ã€‚</li></ol><h3 id="ä¸equalsçš„åŒºåˆ«"><a href="#ä¸equalsçš„åŒºåˆ«" class="headerlink" title="==ä¸equalsçš„åŒºåˆ«"></a>==ä¸equalsçš„åŒºåˆ«</h3><ol><li>==æ˜¯åˆ¤æ–­ä¸¤ä¸ªå˜é‡æˆ–å®ä¾‹æ˜¯ä¸æ˜¯æŒ‡å‘åŒä¸€ä¸ªå†…å­˜ç©ºé—´ equalsæ˜¯åˆ¤æ–­ä¸¤ä¸ªå˜é‡æˆ–å®ä¾‹æ‰€æŒ‡å‘çš„å†…å­˜ç©ºé—´çš„å€¼æ˜¯ä¸æ˜¯ç›¸åŒ</li><li>==æ˜¯æŒ‡å¯¹å†…å­˜åœ°å€è¿›è¡Œæ¯”è¾ƒ equals()æ˜¯å¯¹å­—ç¬¦ä¸²çš„å†…å®¹è¿›è¡Œæ¯”è¾ƒ</li><li>==æŒ‡å¼•ç”¨æ˜¯å¦ç›¸åŒ equals()æŒ‡çš„æ˜¯å€¼æ˜¯å¦ç›¸åŒ</li></ol><h2 id="HashMap-å¤šçº¿ç¨‹æ“ä½œå¯¼è‡´æ­»å¾ªç¯é—®é¢˜"><a href="#HashMap-å¤šçº¿ç¨‹æ“ä½œå¯¼è‡´æ­»å¾ªç¯é—®é¢˜" class="headerlink" title="HashMap å¤šçº¿ç¨‹æ“ä½œå¯¼è‡´æ­»å¾ªç¯é—®é¢˜"></a>HashMap å¤šçº¿ç¨‹æ“ä½œå¯¼è‡´æ­»å¾ªç¯é—®é¢˜</h2><p>ä¸»è¦åŸå› åœ¨äº å¹¶å‘ä¸‹çš„Rehash ä¼šé€ æˆå…ƒç´ ä¹‹é—´ä¼šå½¢æˆä¸€ä¸ªå¾ªç¯é“¾è¡¨ã€‚ä¸è¿‡ï¼Œjdk 1.8 åè§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯è¿˜æ˜¯ä¸å»ºè®®åœ¨å¤šçº¿ç¨‹ä¸‹ä½¿ç”¨ HashMap,å› ä¸ºå¤šçº¿ç¨‹ä¸‹ä½¿ç”¨ HashMap è¿˜æ˜¯ä¼šå­˜åœ¨å…¶ä»–é—®é¢˜æ¯”å¦‚æ•°æ®ä¸¢å¤±ã€‚å¹¶å‘ç¯å¢ƒä¸‹æ¨èä½¿ç”¨ ConcurrentHashMap ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>HashMap</tag>
      
      <tag>HashSet</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HashMapå’ŒHashtableçš„åŒºåˆ«</title>
    <link href="/blog/2021/03/15/HashMap%E5%92%8CHashtable%E7%9A%84%E5%8C%BA%E5%88%AB/"/>
    <url>/blog/2021/03/15/HashMap%E5%92%8CHashtable%E7%9A%84%E5%8C%BA%E5%88%AB/</url>
    
    <content type="html"><![CDATA[<ol><li>çº¿ç¨‹æ˜¯å¦å®‰å…¨ï¼š HashMap æ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼ŒHashTable æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼›HashTable å†…éƒ¨çš„æ–¹æ³•åŸºæœ¬éƒ½ç»è¿‡synchronized ä¿®é¥°ã€‚ï¼ˆå¦‚æœä½ è¦ä¿è¯çº¿ç¨‹å®‰å…¨çš„è¯å°±ä½¿ç”¨ ConcurrentHashMap å§ï¼ï¼‰ï¼›</li><li>æ•ˆç‡ï¼š å› ä¸ºçº¿ç¨‹å®‰å…¨çš„é—®é¢˜ï¼ŒHashMap è¦æ¯” HashTable æ•ˆç‡é«˜ä¸€ç‚¹ã€‚å¦å¤–ï¼ŒHashTable åŸºæœ¬è¢«æ·˜æ±°ï¼Œä¸è¦åœ¨ä»£ç ä¸­ä½¿ç”¨å®ƒï¼›</li><li>å¯¹Null key å’ŒNull valueçš„æ”¯æŒï¼š HashMap ä¸­ï¼Œnull å¯ä»¥ä½œä¸ºé”®ï¼Œè¿™æ ·çš„é”®åªæœ‰ä¸€ä¸ªï¼Œå¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªé”®æ‰€å¯¹åº”çš„å€¼ä¸º nullã€‚ã€‚ä½†æ˜¯åœ¨ HashTable ä¸­ put è¿›çš„é”®å€¼åªè¦æœ‰ä¸€ä¸ª nullï¼Œç›´æ¥æŠ›å‡º NullPointerExceptionã€‚</li><li>åˆå§‹å®¹é‡å¤§å°å’Œæ¯æ¬¡æ‰©å……å®¹é‡å¤§å°çš„ä¸åŒ ï¼š â‘ åˆ›å»ºæ—¶å¦‚æœä¸æŒ‡å®šå®¹é‡åˆå§‹å€¼ï¼ŒHashtable é»˜è®¤çš„åˆå§‹å¤§å°ä¸º11ï¼Œä¹‹åæ¯æ¬¡æ‰©å……ï¼Œå®¹é‡å˜ä¸ºåŸæ¥çš„2n+1ã€‚HashMap é»˜è®¤çš„åˆå§‹åŒ–å¤§å°ä¸º16ã€‚ä¹‹åæ¯æ¬¡æ‰©å……ï¼Œå®¹é‡å˜ä¸ºåŸæ¥çš„2å€ã€‚â‘¡åˆ›å»ºæ—¶å¦‚æœç»™å®šäº†å®¹é‡åˆå§‹å€¼ï¼Œé‚£ä¹ˆ Hashtable ä¼šç›´æ¥ä½¿ç”¨ä½ ç»™å®šçš„å¤§å°ï¼Œè€Œ HashMap ä¼šå°†å…¶æ‰©å……ä¸º2çš„å¹‚æ¬¡æ–¹å¤§å°ï¼ˆHashMap ä¸­çš„tableSizeFor()æ–¹æ³•ä¿è¯ï¼Œä¸‹é¢ç»™å‡ºäº†æºä»£ç ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ HashMap æ€»æ˜¯ä½¿ç”¨2çš„å¹‚ä½œä¸ºå“ˆå¸Œè¡¨çš„å¤§å°,åé¢ä¼šä»‹ç»åˆ°ä¸ºä»€ä¹ˆæ˜¯2çš„å¹‚æ¬¡æ–¹ã€‚</li><li>åº•å±‚æ•°æ®ç»“æ„ï¼š JDK1.8 ä»¥åçš„ HashMap åœ¨è§£å†³å“ˆå¸Œå†²çªæ—¶æœ‰äº†è¾ƒå¤§çš„å˜åŒ–ï¼Œå½“é“¾è¡¨é•¿åº¦å¤§äºé˜ˆå€¼ï¼ˆé»˜è®¤ä¸º8ï¼‰æ—¶ï¼Œå°†é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘ï¼Œä»¥å‡å°‘æœç´¢æ—¶é—´ã€‚Hashtable æ²¡æœ‰è¿™æ ·çš„æœºåˆ¶ã€‚ HashMap ä¸­å¸¦æœ‰åˆå§‹å®¹é‡çš„æ„é€ å‡½æ•°ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">HashMap</span><span class="hljs-params">(<span class="hljs-keyword">int</span> initialCapacity, <span class="hljs-keyword">float</span> loadFactor)</span> </span>&#123;<br>       <span class="hljs-keyword">if</span> (initialCapacity &lt; <span class="hljs-number">0</span>)<br>           <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">&quot;Illegal initial capacity: &quot;</span> +<br>                                              initialCapacity);<br>       <span class="hljs-keyword">if</span> (initialCapacity &gt; MAXIMUM_CAPACITY)<br>           initialCapacity = MAXIMUM_CAPACITY;<br>       <span class="hljs-keyword">if</span> (loadFactor &lt;= <span class="hljs-number">0</span> || Float.isNaN(loadFactor))<br>           <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">&quot;Illegal load factor: &quot;</span> +<br>                                              loadFactor);<br>       <span class="hljs-keyword">this</span>.loadFactor = loadFactor;<br>       <span class="hljs-keyword">this</span>.threshold = tableSizeFor(initialCapacity);<br>   &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">HashMap</span><span class="hljs-params">(<span class="hljs-keyword">int</span> initialCapacity)</span> </span>&#123;<br>       <span class="hljs-keyword">this</span>(initialCapacity, DEFAULT_LOAD_FACTOR);<br>   &#125;<br></code></pre></td></tr></table></figure><p>ä¸‹é¢è¿™ä¸ªæ–¹æ³•ä¿è¯äº† HashMap æ€»æ˜¯ä½¿ç”¨2çš„å¹‚ä½œä¸ºå“ˆå¸Œè¡¨çš„å¤§å°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">   * Returns a power of two size for the given target capacity.</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> <span class="hljs-title">tableSizeFor</span><span class="hljs-params">(<span class="hljs-keyword">int</span> cap)</span> </span>&#123;<br>      <span class="hljs-keyword">int</span> n = cap - <span class="hljs-number">1</span>;<br>      n |= n &gt;&gt;&gt; <span class="hljs-number">1</span>;<br>      n |= n &gt;&gt;&gt; <span class="hljs-number">2</span>;<br>      n |= n &gt;&gt;&gt; <span class="hljs-number">4</span>;<br>      n |= n &gt;&gt;&gt; <span class="hljs-number">8</span>;<br>      n |= n &gt;&gt;&gt; <span class="hljs-number">16</span>;<br>      <span class="hljs-keyword">return</span> (n &lt; <span class="hljs-number">0</span>) ? <span class="hljs-number">1</span> : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + <span class="hljs-number">1</span>;<br>  &#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>HashMap</tag>
      
      <tag>Hashtable</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>List,Set,Mapä¸‰è€…çš„åŒºåˆ«</title>
    <link href="/blog/2021/03/15/List,Set,Map%E4%B8%89%E8%80%85%E7%9A%84%E5%8C%BA%E5%88%AB/"/>
    <url>/blog/2021/03/15/List,Set,Map%E4%B8%89%E8%80%85%E7%9A%84%E5%8C%BA%E5%88%AB/</url>
    
    <content type="html"><![CDATA[<ol><li>List(å¯¹ä»˜é¡ºåºçš„å¥½å¸®æ‰‹)ï¼š Listæ¥å£å­˜å‚¨ä¸€ç»„ä¸å”¯ä¸€ï¼ˆå¯ä»¥æœ‰å¤šä¸ªå…ƒç´ å¼•ç”¨ç›¸åŒçš„å¯¹è±¡ï¼‰ï¼Œæœ‰åºçš„å¯¹è±¡</li><li>Set(æ³¨é‡ç‹¬ä¸€æ— äºŒçš„æ€§è´¨): ä¸å…è®¸é‡å¤çš„é›†åˆã€‚ä¸ä¼šæœ‰å¤šä¸ªå…ƒç´ å¼•ç”¨ç›¸åŒçš„å¯¹è±¡ã€‚</li><li>Map(ç”¨Keyæ¥æœç´¢çš„ä¸“å®¶): ä½¿ç”¨é”®å€¼å¯¹å­˜å‚¨ã€‚Mapä¼šç»´æŠ¤ä¸Keyæœ‰å…³è”çš„å€¼ã€‚ä¸¤ä¸ªKeyå¯ä»¥å¼•ç”¨ç›¸åŒçš„å¯¹è±¡ï¼Œä½†Keyä¸èƒ½é‡å¤ï¼Œå…¸å‹çš„Keyæ˜¯Stringç±»å‹ï¼Œä½†ä¹Ÿå¯ä»¥æ˜¯ä»»ä½•å¯¹è±¡ã€‚</li></ol><h2 id="Arraylist-ä¸-LinkedList-åŒºåˆ«"><a href="#Arraylist-ä¸-LinkedList-åŒºåˆ«" class="headerlink" title="Arraylist ä¸ LinkedList åŒºåˆ«?"></a>Arraylist ä¸ LinkedList åŒºåˆ«?</h2><ol><li>æ˜¯å¦ä¿è¯çº¿ç¨‹å®‰å…¨ï¼š ArrayList å’Œ LinkedList éƒ½æ˜¯ä¸åŒæ­¥çš„ï¼Œä¹Ÿå°±æ˜¯ä¸ä¿è¯çº¿ç¨‹å®‰å…¨ï¼›</li><li>åº•å±‚æ•°æ®ç»“æ„ï¼š Arraylist åº•å±‚ä½¿ç”¨çš„æ˜¯ Object æ•°ç»„ï¼›LinkedList åº•å±‚ä½¿ç”¨çš„æ˜¯ åŒå‘é“¾è¡¨ æ•°æ®ç»“æ„ï¼ˆJDK1.6ä¹‹å‰ä¸ºå¾ªç¯é“¾è¡¨ï¼ŒJDK1.7å–æ¶ˆäº†å¾ªç¯ã€‚æ³¨æ„åŒå‘é“¾è¡¨å’ŒåŒå‘å¾ªç¯é“¾è¡¨çš„åŒºåˆ«ï¼Œä¸‹é¢æœ‰ä»‹ç»åˆ°ï¼ï¼‰</li><li>æ’å…¥å’Œåˆ é™¤æ˜¯å¦å—å…ƒç´ ä½ç½®çš„å½±å“ï¼š â‘  ArrayList é‡‡ç”¨æ•°ç»„å­˜å‚¨ï¼Œæ‰€ä»¥æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦å—å…ƒç´ ä½ç½®çš„å½±å“ã€‚ æ¯”å¦‚ï¼šæ‰§è¡Œadd(E e)æ–¹æ³•çš„æ—¶å€™ï¼Œ ArrayList ä¼šé»˜è®¤åœ¨å°†æŒ‡å®šçš„å…ƒç´ è¿½åŠ åˆ°æ­¤åˆ—è¡¨çš„æœ«å°¾ï¼Œè¿™ç§æƒ…å†µæ—¶é—´å¤æ‚åº¦å°±æ˜¯O(1)ã€‚ä½†æ˜¯å¦‚æœè¦åœ¨æŒ‡å®šä½ç½® i æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„è¯ï¼ˆadd(int index, E element)ï¼‰æ—¶é—´å¤æ‚åº¦å°±ä¸º O(n-i)ã€‚å› ä¸ºåœ¨è¿›è¡Œä¸Šè¿°æ“ä½œçš„æ—¶å€™é›†åˆä¸­ç¬¬ i å’Œç¬¬ i ä¸ªå…ƒç´ ä¹‹åçš„(n-i)ä¸ªå…ƒç´ éƒ½è¦æ‰§è¡Œå‘åä½/å‘å‰ç§»ä¸€ä½çš„æ“ä½œã€‚ â‘¡ LinkedList é‡‡ç”¨é“¾è¡¨å­˜å‚¨ï¼Œæ‰€ä»¥å¯¹äºadd(E e)æ–¹æ³•çš„æ’å…¥ï¼Œåˆ é™¤å…ƒç´ æ—¶é—´å¤æ‚åº¦ä¸å—å…ƒç´ ä½ç½®çš„å½±å“ï¼Œè¿‘ä¼¼ Oï¼ˆ1ï¼‰ï¼Œå¦‚æœæ˜¯è¦åœ¨æŒ‡å®šä½ç½®iæ’å…¥å’Œåˆ é™¤å…ƒç´ çš„è¯ï¼ˆ(add(int index, E element)ï¼‰ æ—¶é—´å¤æ‚åº¦è¿‘ä¼¼ä¸ºo(n))å› ä¸ºéœ€è¦å…ˆç§»åŠ¨åˆ°æŒ‡å®šä½ç½®å†æ’å…¥ã€‚</li><li>æ˜¯å¦æ”¯æŒå¿«é€Ÿéšæœºè®¿é—®ï¼š LinkedList ä¸æ”¯æŒé«˜æ•ˆçš„éšæœºå…ƒç´ è®¿é—®ï¼Œè€Œ ArrayList æ”¯æŒã€‚å¿«é€Ÿéšæœºè®¿é—®å°±æ˜¯é€šè¿‡å…ƒç´ çš„åºå·å¿«é€Ÿè·å–å…ƒç´ å¯¹è±¡(å¯¹åº”äºget(int index)æ–¹æ³•)ã€‚</li><li>å†…å­˜ç©ºé—´å ç”¨ï¼š ArrayListçš„ç©º é—´æµªè´¹ä¸»è¦ä½“ç°åœ¨åœ¨liståˆ—è¡¨çš„ç»“å°¾ä¼šé¢„ç•™ä¸€å®šçš„å®¹é‡ç©ºé—´ï¼Œè€ŒLinkedListçš„ç©ºé—´èŠ±è´¹åˆ™ä½“ç°åœ¨å®ƒçš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½éœ€è¦æ¶ˆè€—æ¯”ArrayListæ›´å¤šçš„ç©ºé—´ï¼ˆå› ä¸ºè¦å­˜æ”¾ç›´æ¥åç»§å’Œç›´æ¥å‰é©±ä»¥åŠæ•°æ®ï¼‰ã€‚</li></ol><h3 id="è¡¥å……å†…å®¹-RandomAccessæ¥å£"><a href="#è¡¥å……å†…å®¹-RandomAccessæ¥å£" class="headerlink" title="è¡¥å……å†…å®¹:RandomAccessæ¥å£"></a>è¡¥å……å†…å®¹:RandomAccessæ¥å£</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">RandomAccess</span> </span>&#123;<br>&#125;<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹æºç æˆ‘ä»¬å‘ç°å®é™…ä¸Š RandomAccess æ¥å£ä¸­ä»€ä¹ˆéƒ½æ²¡æœ‰å®šä¹‰ã€‚æ‰€ä»¥ï¼Œåœ¨æˆ‘çœ‹æ¥ RandomAccess æ¥å£ä¸è¿‡æ˜¯ä¸€ä¸ªæ ‡è¯†ç½¢äº†ã€‚æ ‡è¯†ä»€ä¹ˆï¼Ÿ æ ‡è¯†å®ç°è¿™ä¸ªæ¥å£çš„ç±»å…·æœ‰éšæœºè®¿é—®åŠŸèƒ½ã€‚</p><p>åœ¨ binarySearchï¼ˆï¼‰æ–¹æ³•ä¸­ï¼Œå®ƒè¦åˆ¤æ–­ä¼ å…¥çš„list æ˜¯å¦ RamdomAccess çš„å®ä¾‹ï¼Œå¦‚æœæ˜¯ï¼Œè°ƒç”¨indexedBinarySearchï¼ˆï¼‰æ–¹æ³•ï¼Œå¦‚æœä¸æ˜¯ï¼Œé‚£ä¹ˆè°ƒç”¨iteratorBinarySearchï¼ˆï¼‰æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt;<br>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">binarySearch</span><span class="hljs-params">(List&lt;? extends Comparable&lt;? <span class="hljs-keyword">super</span> T&gt;&gt; list, T key)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (list <span class="hljs-keyword">instanceof</span> RandomAccess || list.size()&lt;BINARYSEARCH_THRESHOLD)<br>            <span class="hljs-keyword">return</span> Collections.indexedBinarySearch(list, key);<br>        <span class="hljs-keyword">else</span><br>            <span class="hljs-keyword">return</span> Collections.iteratorBinarySearch(list, key);<br>    &#125;<br></code></pre></td></tr></table></figure><p>ArrayList å®ç°äº† RandomAccess æ¥å£ï¼Œ è€Œ LinkedList æ²¡æœ‰å®ç°ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæˆ‘è§‰å¾—è¿˜æ˜¯å’Œåº•å±‚æ•°æ®ç»“æ„æœ‰å…³ï¼ArrayList åº•å±‚æ˜¯æ•°ç»„ï¼Œè€Œ LinkedList åº•å±‚æ˜¯é“¾è¡¨ã€‚æ•°ç»„å¤©ç„¶æ”¯æŒéšæœºè®¿é—®ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º Oï¼ˆ1ï¼‰ï¼Œæ‰€ä»¥ç§°ä¸ºå¿«é€Ÿéšæœºè®¿é—®ã€‚é“¾è¡¨éœ€è¦éå†åˆ°ç‰¹å®šä½ç½®æ‰èƒ½è®¿é—®ç‰¹å®šä½ç½®çš„å…ƒç´ ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º Oï¼ˆnï¼‰ï¼Œæ‰€ä»¥ä¸æ”¯æŒå¿«é€Ÿéšæœºè®¿é—®ã€‚ï¼ŒArrayList å®ç°äº† RandomAccess æ¥å£ï¼Œå°±è¡¨æ˜äº†ä»–å…·æœ‰å¿«é€Ÿéšæœºè®¿é—®åŠŸèƒ½ã€‚ RandomAccess æ¥å£åªæ˜¯æ ‡è¯†ï¼Œå¹¶ä¸æ˜¯è¯´ ArrayList å®ç° RandomAccess æ¥å£æ‰å…·æœ‰å¿«é€Ÿéšæœºè®¿é—®åŠŸèƒ½çš„ï¼</p><h3 id="ä¸‹é¢å†æ€»ç»“ä¸€ä¸‹-list-çš„éå†æ–¹å¼é€‰æ‹©ï¼š"><a href="#ä¸‹é¢å†æ€»ç»“ä¸€ä¸‹-list-çš„éå†æ–¹å¼é€‰æ‹©ï¼š" class="headerlink" title="ä¸‹é¢å†æ€»ç»“ä¸€ä¸‹ list çš„éå†æ–¹å¼é€‰æ‹©ï¼š"></a>ä¸‹é¢å†æ€»ç»“ä¸€ä¸‹ list çš„éå†æ–¹å¼é€‰æ‹©ï¼š</h3><p>å®ç°äº† RandomAccess æ¥å£çš„listï¼Œä¼˜å…ˆé€‰æ‹©æ™®é€š for å¾ªç¯ ï¼Œå…¶æ¬¡ foreach, æœªå®ç° RandomAccessæ¥å£çš„listï¼Œä¼˜å…ˆé€‰æ‹©iteratoréå†ï¼ˆforeachéå†åº•å±‚ä¹Ÿæ˜¯é€šè¿‡iteratorå®ç°çš„,ï¼‰ï¼Œå¤§sizeçš„æ•°æ®ï¼Œåƒä¸‡ä¸è¦ä½¿ç”¨æ™®é€šforå¾ªç¯</p><h3 id="è¡¥å……å†…å®¹-åŒå‘é“¾è¡¨å’ŒåŒå‘å¾ªç¯é“¾è¡¨"><a href="#è¡¥å……å†…å®¹-åŒå‘é“¾è¡¨å’ŒåŒå‘å¾ªç¯é“¾è¡¨" class="headerlink" title="è¡¥å……å†…å®¹:åŒå‘é“¾è¡¨å’ŒåŒå‘å¾ªç¯é“¾è¡¨"></a>è¡¥å……å†…å®¹:åŒå‘é“¾è¡¨å’ŒåŒå‘å¾ªç¯é“¾è¡¨</h3><p>åŒå‘é“¾è¡¨ï¼š åŒ…å«ä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ªprevæŒ‡å‘å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¸€ä¸ªnextæŒ‡å‘åä¸€ä¸ªèŠ‚ç‚¹ã€‚<img src="https://cuixiaoyande.oss-cn-shanghai.aliyuncs.com/%E5%8F%8C%E5%90%91%E9%93%BE%E8%A1%A8_1574818255138.png?x-oss-process=style/small" alt="åŒå‘é“¾è¡¨">åŒå‘å¾ªç¯é“¾è¡¨ï¼š æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„ next æŒ‡å‘headï¼Œè€Œ head çš„prevæŒ‡å‘æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ„æˆä¸€ä¸ªç¯ã€‚<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/small-20210315204506653.png" alt="åŒå‘å¾ªç¯é“¾è¡¨"></p>]]></content>
    
    
    
    <tags>
      
      <tag>List</tag>
      
      <tag>Set</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>getå’Œpostè¯·æ±‚çš„åŒºåˆ«</title>
    <link href="/blog/2021/03/15/get%E5%92%8Cpost%E8%AF%B7%E6%B1%82%E7%9A%84%E5%8C%BA%E5%88%AB/"/>
    <url>/blog/2021/03/15/get%E5%92%8Cpost%E8%AF%B7%E6%B1%82%E7%9A%84%E5%8C%BA%E5%88%AB/</url>
    
    <content type="html"><![CDATA[<p>ç½‘ä¸Šä¹Ÿæœ‰æ–‡ç« è¯´ï¼šgetå’Œpostè¯·æ±‚å®é™…ä¸Šæ˜¯æ²¡æœ‰åŒºåˆ«ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡ŒæŸ¥è¯¢ç›¸å…³æ–‡ç« ï¼ˆå‚è€ƒæ–‡ç« ï¼š<a href="https://www.cnblogs.com/logsharing/p/8448446.html%EF%BC%8C%E7%9F%A5%E4%B9%8E%E5%AF%B9%E5%BA%94%E7%9A%84%E9%97%AE%E9%A2%98%E9%93%BE%E6%8E%A5%EF%BC%9Aget%E5%92%8Cpost%E5%8C%BA%E5%88%AB%EF%BC%9F%EF%BC%89%EF%BC%81%E6%88%91%E4%B8%8B%E9%9D%A2%E7%BB%99%E5%87%BA%E7%9A%84%E5%8F%AA%E6%98%AF%E4%B8%80%E7%A7%8D%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AD%94%E6%A1%88%E3%80%82">https://www.cnblogs.com/logsharing/p/8448446.htmlï¼ŒçŸ¥ä¹å¯¹åº”çš„é—®é¢˜é“¾æ¥ï¼šgetå’ŒpoståŒºåˆ«ï¼Ÿï¼‰ï¼æˆ‘ä¸‹é¢ç»™å‡ºçš„åªæ˜¯ä¸€ç§å¸¸è§çš„ç­”æ¡ˆã€‚</a></p><p>â‘ getè¯·æ±‚ç”¨æ¥ä»æœåŠ¡å™¨ä¸Šè·å¾—èµ„æºï¼Œè€Œpostæ˜¯ç”¨æ¥å‘æœåŠ¡å™¨æäº¤æ•°æ®ï¼›</p><p>â‘¡getå°†è¡¨å•ä¸­æ•°æ®æŒ‰ç…§name=valueçš„å½¢å¼ï¼Œæ·»åŠ åˆ°action æ‰€æŒ‡å‘çš„URL åé¢ï¼Œå¹¶ä¸”ä¸¤è€…ä½¿ç”¨â€?â€è¿æ¥ï¼Œè€Œå„ä¸ªå˜é‡ä¹‹é—´ä½¿ç”¨â€&amp;â€è¿æ¥ï¼›postæ˜¯å°†è¡¨å•ä¸­çš„æ•°æ®æ”¾åœ¨HTTPåè®®çš„è¯·æ±‚å¤´æˆ–æ¶ˆæ¯ä½“ä¸­ï¼Œä¼ é€’åˆ°actionæ‰€æŒ‡å‘URLï¼›</p><p>â‘¢getä¼ è¾“çš„æ•°æ®è¦å—åˆ°URLé•¿åº¦é™åˆ¶ï¼ˆæœ€å¤§é•¿åº¦æ˜¯ 2048 ä¸ªå­—ç¬¦ï¼‰ï¼›è€Œpostå¯ä»¥ä¼ è¾“å¤§é‡çš„æ•°æ®ï¼Œä¸Šä¼ æ–‡ä»¶é€šå¸¸è¦ä½¿ç”¨postæ–¹å¼ï¼›</p><p>â‘£ä½¿ç”¨getæ—¶å‚æ•°ä¼šæ˜¾ç¤ºåœ¨åœ°å€æ ä¸Šï¼Œå¦‚æœè¿™äº›æ•°æ®ä¸æ˜¯æ•æ„Ÿæ•°æ®ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨getï¼›å¯¹äºæ•æ„Ÿæ•°æ®è¿˜æ˜¯åº”ç”¨ä½¿ç”¨postï¼›</p><p>â‘¤getä½¿ç”¨MIMEç±»å‹application/x-www-form-urlencodedçš„URLç¼–ç ï¼ˆä¹Ÿå«ç™¾åˆ†å·ç¼–ç ï¼‰æ–‡æœ¬çš„æ ¼å¼ä¼ é€’å‚æ•°ï¼Œä¿è¯è¢«ä¼ é€çš„å‚æ•°ç”±éµå¾ªè§„èŒƒçš„æ–‡æœ¬ç»„æˆï¼Œä¾‹å¦‚ä¸€ä¸ªç©ºæ ¼çš„ç¼–ç æ˜¯â€%20â€ã€‚</p><p>è¡¥å……ï¼šGETæ–¹å¼æäº¤è¡¨å•çš„å…¸å‹åº”ç”¨æ˜¯æœç´¢å¼•æ“ã€‚GETæ–¹å¼å°±æ˜¯è¢«è®¾è®¡ä¸ºæŸ¥è¯¢ç”¨çš„ã€‚</p><p>è¿˜æœ‰å¦å¤–ä¸€ç§å›ç­”ã€‚æ¨èå¤§å®¶çœ‹ä¸€ä¸‹ï¼š</p><p><a href="https://www.zhihu.com/question/28586791">https://www.zhihu.com/question/28586791</a> <a href="https://mp.weixin.qq.com/s?__biz=MzI3NzIzMzg3Mw==&amp;mid=100000054&amp;idx=1&amp;sn=71f6c214f3833d9ca20b9f7dcd9d33e4#rd">https://mp.weixin.qq.com/s?__biz=MzI3NzIzMzg3Mw==&amp;mid=100000054&amp;idx=1&amp;sn=71f6c214f3833d9ca20b9f7dcd9d33e4#rd</a> ä»€ä¹ˆæƒ…å†µä¸‹è°ƒç”¨doGet()å’ŒdoPost() Formæ ‡ç­¾é‡Œçš„methodçš„å±æ€§ä¸ºgetæ—¶è°ƒç”¨doGet()ï¼Œä¸ºpostæ—¶è°ƒç”¨doPost()ã€‚</p><p>è½¬å‘(Forward)å’Œé‡å®šå‘(Redirect)çš„åŒºåˆ« è½¬å‘æ˜¯æœåŠ¡å™¨è¡Œä¸ºï¼Œé‡å®šå‘æ˜¯å®¢æˆ·ç«¯è¡Œä¸ºã€‚</p><p>è½¬å‘ï¼ˆForwardï¼‰ é€šè¿‡RequestDispatcherå¯¹è±¡çš„forwardï¼ˆHttpServletRequest request,HttpServletResponse responseï¼‰æ–¹æ³•å®ç°çš„ã€‚RequestDispatcherå¯ä»¥é€šè¿‡HttpServletRequest çš„getRequestDispatcher()æ–¹æ³•è·å¾—ã€‚ä¾‹å¦‚ä¸‹é¢çš„ä»£ç å°±æ˜¯è·³è½¬åˆ°login_success.jspé¡µé¢ã€‚</p><figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vbscript"><span class="hljs-built_in">request</span>.getRequestDispatcher(<span class="hljs-string">&quot;login_success.jsp&quot;</span>).forward(<span class="hljs-built_in">request</span>, <span class="hljs-built_in">response</span>);<br></code></pre></td></tr></table></figure><p>é‡å®šå‘ï¼ˆRedirectï¼‰ æ˜¯åˆ©ç”¨æœåŠ¡å™¨è¿”å›çš„çŠ¶æ€ç æ¥å®ç°çš„ã€‚å®¢æˆ·ç«¯æµè§ˆå™¨è¯·æ±‚æœåŠ¡å™¨çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨ä¼šè¿”å›ä¸€ä¸ªçŠ¶æ€ç ã€‚æœåŠ¡å™¨é€šè¿‡ HttpServletResponse çš„ setStatus(int status) æ–¹æ³•è®¾ç½®çŠ¶æ€ç ã€‚å¦‚æœæœåŠ¡å™¨è¿”å›301æˆ–è€…302ï¼Œåˆ™æµè§ˆå™¨ä¼šåˆ°æ–°çš„ç½‘å€é‡æ–°è¯·æ±‚è¯¥èµ„æºã€‚</p><p>ä»åœ°å€æ æ˜¾ç¤ºæ¥è¯´ forwardæ˜¯æœåŠ¡å™¨è¯·æ±‚èµ„æº,æœåŠ¡å™¨ç›´æ¥è®¿é—®ç›®æ ‡åœ°å€çš„URL,æŠŠé‚£ä¸ªURLçš„å“åº”å†…å®¹è¯»å–è¿‡æ¥,ç„¶åæŠŠè¿™äº›å†…å®¹å†å‘ç»™æµè§ˆå™¨.æµè§ˆå™¨æ ¹æœ¬ä¸çŸ¥é“æœåŠ¡å™¨å‘é€çš„å†…å®¹ä»å“ªé‡Œæ¥çš„,æ‰€ä»¥å®ƒçš„åœ°å€æ è¿˜æ˜¯åŸæ¥çš„åœ°å€. redirectæ˜¯æœåŠ¡ç«¯æ ¹æ®é€»è¾‘,å‘é€ä¸€ä¸ªçŠ¶æ€ç ,å‘Šè¯‰æµè§ˆå™¨é‡æ–°å»è¯·æ±‚é‚£ä¸ªåœ°å€.æ‰€ä»¥åœ°å€æ æ˜¾ç¤ºçš„æ˜¯æ–°çš„URL.</p><p>ä»æ•°æ®å…±äº«æ¥è¯´ forward:è½¬å‘é¡µé¢å’Œè½¬å‘åˆ°çš„é¡µé¢å¯ä»¥å…±äº«requesté‡Œé¢çš„æ•°æ®. redirect:ä¸èƒ½å…±äº«æ•°æ®.</p><p>ä»è¿ç”¨åœ°æ–¹æ¥è¯´ forward:ä¸€èˆ¬ç”¨äºç”¨æˆ·ç™»é™†çš„æ—¶å€™,æ ¹æ®è§’è‰²è½¬å‘åˆ°ç›¸åº”çš„æ¨¡å—. redirect:ä¸€èˆ¬ç”¨äºç”¨æˆ·æ³¨é”€ç™»é™†æ—¶è¿”å›ä¸»é¡µé¢å’Œè·³è½¬åˆ°å…¶å®ƒçš„ç½‘ç«™ç­‰</p><p>ä»æ•ˆç‡æ¥è¯´ forward:é«˜. redirect:ä½.</p>]]></content>
    
    
    
    <tags>
      
      <tag>get</tag>
      
      <tag>post</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Servletæ€»ç»“</title>
    <link href="/blog/2021/03/15/Servlet%E6%80%BB%E7%BB%93/"/>
    <url>/blog/2021/03/15/Servlet%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<p>åœ¨Java Webç¨‹åºä¸­ï¼ŒServletä¸»è¦è´Ÿè´£æ¥æ”¶ç”¨æˆ·è¯·æ±‚ HttpServletRequest,åœ¨doGet(),doPost()ä¸­åšç›¸åº”çš„å¤„ç†ï¼Œå¹¶å°†å›åº”HttpServletResponseåé¦ˆç»™ç”¨æˆ·ã€‚Servlet å¯ä»¥è®¾ç½®åˆå§‹åŒ–å‚æ•°ï¼Œä¾›Servletå†…éƒ¨ä½¿ç”¨ã€‚ä¸€ä¸ªServletç±»åªä¼šæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œåœ¨å®ƒåˆå§‹åŒ–æ—¶è°ƒç”¨init()æ–¹æ³•ï¼Œé”€æ¯æ—¶è°ƒç”¨destroy()æ–¹æ³•ã€‚Servletéœ€è¦åœ¨web.xmlä¸­é…ç½®ï¼ˆMyEclipseä¸­åˆ›å»ºServletä¼šè‡ªåŠ¨é…ç½®ï¼‰ï¼Œä¸€ä¸ªServletå¯ä»¥è®¾ç½®å¤šä¸ªURLè®¿é—®ã€‚Servletä¸æ˜¯çº¿ç¨‹å®‰å…¨ï¼Œå› æ­¤è¦è°¨æ…ä½¿ç”¨ç±»å˜é‡ã€‚</p><h2 id="é˜è¿°Servletå’ŒCGIçš„åŒºåˆ«"><a href="#é˜è¿°Servletå’ŒCGIçš„åŒºåˆ«" class="headerlink" title="é˜è¿°Servletå’ŒCGIçš„åŒºåˆ«?"></a>é˜è¿°Servletå’ŒCGIçš„åŒºåˆ«?</h2><h3 id="CGIçš„ä¸è¶³ä¹‹å¤„"><a href="#CGIçš„ä¸è¶³ä¹‹å¤„" class="headerlink" title="CGIçš„ä¸è¶³ä¹‹å¤„:"></a>CGIçš„ä¸è¶³ä¹‹å¤„:</h3><p>1ï¼Œéœ€è¦ä¸ºæ¯ä¸ªè¯·æ±‚å¯åŠ¨ä¸€ä¸ªæ“ä½œCGIç¨‹åºçš„ç³»ç»Ÿè¿›ç¨‹ã€‚å¦‚æœè¯·æ±‚é¢‘ç¹ï¼Œè¿™å°†ä¼šå¸¦æ¥å¾ˆå¤§çš„å¼€é”€ã€‚</p><p>2ï¼Œéœ€è¦ä¸ºæ¯ä¸ªè¯·æ±‚åŠ è½½å’Œè¿è¡Œä¸€ä¸ªCGIç¨‹åºï¼Œè¿™å°†å¸¦æ¥å¾ˆå¤§çš„å¼€é”€</p><p>3ï¼Œéœ€è¦é‡å¤ç¼–å†™å¤„ç†ç½‘ç»œåè®®çš„ä»£ç ä»¥åŠç¼–ç ï¼Œè¿™äº›å·¥ä½œéƒ½æ˜¯éå¸¸è€—æ—¶çš„ã€‚</p><h3 id="Servletçš„ä¼˜ç‚¹"><a href="#Servletçš„ä¼˜ç‚¹" class="headerlink" title="Servletçš„ä¼˜ç‚¹:"></a>Servletçš„ä¼˜ç‚¹:</h3><p>1ï¼Œåªéœ€è¦å¯åŠ¨ä¸€ä¸ªæ“ä½œç³»ç»Ÿè¿›ç¨‹ä»¥åŠåŠ è½½ä¸€ä¸ªJVMï¼Œå¤§å¤§é™ä½äº†ç³»ç»Ÿçš„å¼€é”€</p><p>2ï¼Œå¦‚æœå¤šä¸ªè¯·æ±‚éœ€è¦åšåŒæ ·å¤„ç†çš„æ—¶å€™ï¼Œè¿™æ—¶å€™åªéœ€è¦åŠ è½½ä¸€ä¸ªç±»ï¼Œè¿™ä¹Ÿå¤§å¤§é™ä½äº†å¼€é”€</p><p>3ï¼Œæ‰€æœ‰åŠ¨æ€åŠ è½½çš„ç±»å¯ä»¥å®ç°å¯¹ç½‘ç»œåè®®ä»¥åŠè¯·æ±‚è§£ç çš„å…±äº«ï¼Œå¤§å¤§é™ä½äº†å·¥ä½œé‡ã€‚</p><p>4ï¼ŒServletèƒ½ç›´æ¥å’ŒWebæœåŠ¡å™¨äº¤äº’ï¼Œè€Œæ™®é€šçš„CGIç¨‹åºä¸èƒ½ã€‚Servletè¿˜èƒ½åœ¨å„ä¸ªç¨‹åºä¹‹é—´å…±äº«æ•°æ®ï¼Œä½¿æ•°æ®åº“è¿æ¥æ± ä¹‹ç±»çš„åŠŸèƒ½å¾ˆå®¹æ˜“å®ç°ã€‚</p><p>è¡¥å……ï¼šSun Microsystemså…¬å¸åœ¨1996å¹´å‘å¸ƒServletæŠ€æœ¯å°±æ˜¯ä¸ºäº†å’ŒCGIè¿›è¡Œç«äº‰ï¼ŒServletæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„Javaç¨‹åºï¼Œä¸€ä¸ªåŸºäºJavaçš„Webåº”ç”¨é€šå¸¸åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªServletç±»ã€‚Servletä¸èƒ½å¤Ÿè‡ªè¡Œåˆ›å»ºå¹¶æ‰§è¡Œï¼Œå®ƒæ˜¯åœ¨Servletå®¹å™¨ä¸­è¿è¡Œçš„ï¼Œå®¹å™¨å°†ç”¨æˆ·çš„è¯·æ±‚ä¼ é€’ç»™Servletç¨‹åºï¼Œå¹¶å°†Servletçš„å“åº”å›ä¼ ç»™ç”¨æˆ·ã€‚é€šå¸¸ä¸€ä¸ªServletä¼šå…³è”ä¸€ä¸ªæˆ–å¤šä¸ªJSPé¡µé¢ã€‚ä»¥å‰CGIç»å¸¸å› ä¸ºæ€§èƒ½å¼€é”€ä¸Šçš„é—®é¢˜è¢«è¯Ÿç—…ï¼Œç„¶è€ŒFast CGIæ—©å°±å·²ç»è§£å†³äº†CGIæ•ˆç‡ä¸Šçš„é—®é¢˜ï¼Œæ‰€ä»¥é¢è¯•çš„æ—¶å€™å¤§å¯ä¸å¿…ä¿¡å£å¼€æ²³çš„è¯Ÿç—…CGIï¼Œäº‹å®ä¸Šæœ‰å¾ˆå¤šä½ ç†Ÿæ‚‰çš„ç½‘ç«™éƒ½ä½¿ç”¨äº†CGIæŠ€æœ¯ã€‚</p><p>å‚è€ƒï¼šã€Šjavawebæ•´åˆå¼€å‘ç‹è€…å½’æ¥ã€‹P7</p><h3 id="Servletæ¥å£ä¸­æœ‰å“ªäº›æ–¹æ³•åŠServletç”Ÿå‘½å‘¨æœŸæ¢ç§˜"><a href="#Servletæ¥å£ä¸­æœ‰å“ªäº›æ–¹æ³•åŠServletç”Ÿå‘½å‘¨æœŸæ¢ç§˜" class="headerlink" title="Servletæ¥å£ä¸­æœ‰å“ªäº›æ–¹æ³•åŠServletç”Ÿå‘½å‘¨æœŸæ¢ç§˜"></a>Servletæ¥å£ä¸­æœ‰å“ªäº›æ–¹æ³•åŠServletç”Ÿå‘½å‘¨æœŸæ¢ç§˜</h3><p>Servletæ¥å£å®šä¹‰äº†5ä¸ªæ–¹æ³•ï¼Œå…¶ä¸­å‰ä¸‰ä¸ªæ–¹æ³•ä¸Servletç”Ÿå‘½å‘¨æœŸç›¸å…³ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">(ServletConfig config)</span> <span class="hljs-keyword">throws</span> ServletException</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">service</span><span class="hljs-params">(ServletRequest req, ServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, java.io.IOException</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">destroy</span><span class="hljs-params">()</span></span><br><span class="hljs-function">java.lang.String <span class="hljs-title">getServletInfo</span><span class="hljs-params">()</span></span><br><span class="hljs-function">ServletConfig <span class="hljs-title">getServletConfig</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span><br></code></pre></td></tr></table></figure><p>ç”Ÿå‘½å‘¨æœŸï¼š Webå®¹å™¨åŠ è½½Servletå¹¶å°†å…¶å®ä¾‹åŒ–åï¼ŒServletç”Ÿå‘½å‘¨æœŸå¼€å§‹ï¼Œå®¹å™¨è¿è¡Œå…¶init()æ–¹æ³•è¿›è¡ŒServletçš„åˆå§‹åŒ–ï¼›è¯·æ±‚åˆ°è¾¾æ—¶è°ƒç”¨Servletçš„service()æ–¹æ³•ï¼Œservice()æ–¹æ³•ä¼šæ ¹æ®éœ€è¦è°ƒç”¨ä¸è¯·æ±‚å¯¹åº”çš„doGetæˆ–doPostç­‰æ–¹æ³•ï¼›å½“æœåŠ¡å™¨å…³é—­æˆ–é¡¹ç›®è¢«å¸è½½æ—¶æœåŠ¡å™¨ä¼šå°†Servletå®ä¾‹é”€æ¯ï¼Œæ­¤æ—¶ä¼šè°ƒç”¨Servletçš„destroy()æ–¹æ³•ã€‚initæ–¹æ³•å’Œdestroyæ–¹æ³•åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œserviceæ–¹æ³•å®¢æˆ·ç«¯æ¯æ¬¡è¯·æ±‚Servletéƒ½ä¼šæ‰§è¡Œã€‚Servletä¸­æœ‰æ—¶ä¼šç”¨åˆ°ä¸€äº›éœ€è¦åˆå§‹åŒ–ä¸é”€æ¯çš„èµ„æºï¼Œå› æ­¤å¯ä»¥æŠŠåˆå§‹åŒ–èµ„æºçš„ä»£ç æ”¾å…¥initæ–¹æ³•ä¸­ï¼Œé”€æ¯èµ„æºçš„ä»£ç æ”¾å…¥destroyæ–¹æ³•ä¸­ï¼Œè¿™æ ·å°±ä¸éœ€è¦æ¯æ¬¡å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚éƒ½è¦åˆå§‹åŒ–ä¸é”€æ¯èµ„æºã€‚</p><p>å‚è€ƒï¼šã€Šjavawebæ•´åˆå¼€å‘ç‹è€…å½’æ¥ã€‹P81</p>]]></content>
    
    
    
    <tags>
      
      <tag>å·¥å…·</tag>
      
      <tag>Servlet</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ³›å‹çš„å®é™…åº”ç”¨</title>
    <link href="/blog/2021/03/15/%E6%B3%9B%E5%9E%8B%E7%9A%84%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8/"/>
    <url>/blog/2021/03/15/%E6%B3%9B%E5%9E%8B%E7%9A%84%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="å®ç°æœ€å°å€¼å‡½æ•°"><a href="#å®ç°æœ€å°å€¼å‡½æ•°" class="headerlink" title="å®ç°æœ€å°å€¼å‡½æ•°"></a>å®ç°æœ€å°å€¼å‡½æ•°</h2><p>è‡ªå·±è®¾è®¡ä¸€ä¸ªæ³›å‹çš„è·å–æ•°ç»„æœ€å°å€¼çš„å‡½æ•°.å¹¶ä¸”è¿™ä¸ªæ–¹æ³•åªèƒ½æ¥å—Numberçš„å­ç±»å¹¶ä¸”å®ç°äº†Comparableæ¥å£ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//æ³¨æ„ï¼šNumberå¹¶æ²¡æœ‰å®ç°Comparable</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> &lt;T extends Number &amp; Comparable&lt;? <span class="hljs-keyword">super</span> T&gt;&gt; <span class="hljs-function">T <span class="hljs-title">min</span><span class="hljs-params">(T[] values)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (values == <span class="hljs-keyword">null</span> || values.length == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>    T min = values[<span class="hljs-number">0</span>];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; values.length; i++) &#123;<br>        <span class="hljs-keyword">if</span> (min.compareTo(values[i]) &gt; <span class="hljs-number">0</span>) min = values[i];<br>    &#125;<br>    <span class="hljs-keyword">return</span> min;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">int</span> minInteger = min(<span class="hljs-keyword">new</span> Integer[]&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;);<span class="hljs-comment">//result:1</span><br><span class="hljs-keyword">double</span> minDouble = min(<span class="hljs-keyword">new</span> Double[]&#123;<span class="hljs-number">1.2</span>, <span class="hljs-number">2.2</span>, -<span class="hljs-number">1d</span>&#125;);<span class="hljs-comment">//result:-1d</span><br>String typeError = min(<span class="hljs-keyword">new</span> String[]&#123;<span class="hljs-string">&quot;1&quot;</span>,<span class="hljs-string">&quot;3&quot;</span>&#125;);<span class="hljs-comment">//æŠ¥é”™</span><br></code></pre></td></tr></table></figure><h1 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h1><h2 id="ä½¿ç”¨æ•°ç»„å®ç°æ ˆ"><a href="#ä½¿ç”¨æ•°ç»„å®ç°æ ˆ" class="headerlink" title="ä½¿ç”¨æ•°ç»„å®ç°æ ˆ"></a>ä½¿ç”¨æ•°ç»„å®ç°æ ˆ</h2><p>è‡ªå·±å®ç°ä¸€ä¸ªæ ˆï¼Œè¦æ±‚è¿™ä¸ªæ ˆå…·æœ‰push()ã€pop()ï¼ˆè¿”å›æ ˆé¡¶å…ƒç´ å¹¶å‡ºæ ˆï¼‰ã€peek() ï¼ˆè¿”å›æ ˆé¡¶å…ƒç´ ä¸å‡ºæ ˆï¼‰ã€isEmpty()ã€size()è¿™äº›åŸºæœ¬çš„æ–¹æ³•ã€‚</p><p>æç¤ºï¼šæ¯æ¬¡å…¥æ ˆä¹‹å‰å…ˆåˆ¤æ–­æ ˆçš„å®¹é‡æ˜¯å¦å¤Ÿç”¨ï¼Œå¦‚æœä¸å¤Ÿç”¨å°±ç”¨Arrays.copyOf()è¿›è¡Œæ‰©å®¹ï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyStack</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span>[] storage;<span class="hljs-comment">//å­˜æ”¾æ ˆä¸­å…ƒç´ çš„æ•°ç»„</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> capacity;<span class="hljs-comment">//æ ˆçš„å®¹é‡</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> count;<span class="hljs-comment">//æ ˆä¸­å…ƒç´ æ•°é‡</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> GROW_FACTOR = <span class="hljs-number">2</span>;<br> <br>    <span class="hljs-comment">//TODOï¼šä¸å¸¦åˆå§‹å®¹é‡çš„æ„é€ æ–¹æ³•ã€‚é»˜è®¤å®¹é‡ä¸º8</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MyStack</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.capacity = <span class="hljs-number">8</span>;<br>        <span class="hljs-keyword">this</span>.storage=<span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[<span class="hljs-number">8</span>];<br>        <span class="hljs-keyword">this</span>.count = <span class="hljs-number">0</span>;<br>    &#125;<br> <br>    <span class="hljs-comment">//TODOï¼šå¸¦åˆå§‹å®¹é‡çš„æ„é€ æ–¹æ³•</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MyStack</span><span class="hljs-params">(<span class="hljs-keyword">int</span> initialCapacity)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (initialCapacity &lt; <span class="hljs-number">1</span>)<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">&quot;Capacity too small.&quot;</span>);<br> <br>        <span class="hljs-keyword">this</span>.capacity = initialCapacity;<br>        <span class="hljs-keyword">this</span>.storage = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[initialCapacity];<br>        <span class="hljs-keyword">this</span>.count = <span class="hljs-number">0</span>;<br>    &#125;<br> <br>    <span class="hljs-comment">//TODOï¼šå…¥æ ˆ</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">push</span><span class="hljs-params">(<span class="hljs-keyword">int</span> value)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (count == capacity) &#123;<br>            ensureCapacity();<br>        &#125;<br>        storage[count++] = value;<br>    &#125;<br> <br>    <span class="hljs-comment">//TODOï¼šç¡®ä¿å®¹é‡å¤§å°</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ensureCapacity</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">int</span> newCapacity = capacity * GROW_FACTOR;<br>        storage = Arrays.copyOf(storage, newCapacity);<br>        capacity = newCapacity;<br>    &#125;<br> <br>    <span class="hljs-comment">//TODOï¼šè¿”å›æ ˆé¡¶å…ƒç´ å¹¶å‡ºæ ˆ</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> <span class="hljs-title">pop</span><span class="hljs-params">()</span> </span>&#123;<br>        count--;<br>        <span class="hljs-keyword">if</span> (count == -<span class="hljs-number">1</span>)<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">&quot;Stack is empty.&quot;</span>);<br> <br>        <span class="hljs-keyword">return</span> storage[count];<br>    &#125;<br> <br>    <span class="hljs-comment">//TODOï¼šè¿”å›æ ˆé¡¶å…ƒç´ ä¸å‡ºæ ˆ</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> <span class="hljs-title">peek</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (count == <span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">&quot;Stack is empty.&quot;</span>);<br>        &#125;<span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> storage[count-<span class="hljs-number">1</span>];<br>        &#125;<br>    &#125;<br> <br>    <span class="hljs-comment">//TODOï¼šåˆ¤æ–­æ ˆæ˜¯å¦ä¸ºç©º</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isEmpty</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> count == <span class="hljs-number">0</span>;<br>    &#125;<br> <br>    <span class="hljs-comment">//TODOï¼šè¿”å›æ ˆä¸­å…ƒç´ çš„ä¸ªæ•°</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> <span class="hljs-title">size</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> count;<br>    &#125;<br> <br>&#125;<br></code></pre></td></tr></table></figure><h2 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java">MyStack myStack = <span class="hljs-keyword">new</span> MyStack(<span class="hljs-number">3</span>);<br>myStack.push(<span class="hljs-number">1</span>);<br>myStack.push(<span class="hljs-number">2</span>);<br>myStack.push(<span class="hljs-number">3</span>);<br>myStack.push(<span class="hljs-number">4</span>);<br>myStack.push(<span class="hljs-number">5</span>);<br>myStack.push(<span class="hljs-number">6</span>);<br>myStack.push(<span class="hljs-number">7</span>);<br>myStack.push(<span class="hljs-number">8</span>);<br>System.out.println(myStack.peek());<span class="hljs-comment">//8</span><br>System.out.println(myStack.size());<span class="hljs-comment">//8</span><br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; i++) &#123;<br>    System.out.println(myStack.pop());<br>&#125;<br>System.out.println(myStack.isEmpty());<span class="hljs-comment">//true</span><br>myStack.pop();<span class="hljs-comment">//æŠ¥é”™ï¼šjava.lang.IllegalArgumentException: Stack is empty.</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>æ³›å‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Collection.toArray()</title>
    <link href="/blog/2021/03/14/Collection.toArray()/"/>
    <url>/blog/2021/03/14/Collection.toArray()/</url>
    
    <content type="html"><![CDATA[<p><strong>è¯¥æ–¹æ³•æ˜¯ä¸€ä¸ªæ³›å‹æ–¹æ³•ï¼š T[] toArray(T[] a); å¦‚æœtoArrayæ–¹æ³•ä¸­æ²¡æœ‰ä¼ é€’ä»»ä½•å‚æ•°çš„è¯è¿”å›çš„æ˜¯Objectç±»å‹æ•°ç»„ã€‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">String [] s= <span class="hljs-keyword">new</span> String[]&#123;<br>    <span class="hljs-string">&quot;dog&quot;</span>, <span class="hljs-string">&quot;lazy&quot;</span>, <span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;over&quot;</span>, <span class="hljs-string">&quot;jumps&quot;</span>, <span class="hljs-string">&quot;fox&quot;</span>, <span class="hljs-string">&quot;brown&quot;</span>, <span class="hljs-string">&quot;quick&quot;</span>, <span class="hljs-string">&quot;A&quot;</span><br>&#125;;<br>List&lt;String&gt; list = Arrays.asList(s);<br>Collections.reverse(list);<br>s=list.toArray(<span class="hljs-keyword">new</span> String[<span class="hljs-number">0</span>]);<span class="hljs-comment">//æ²¡æœ‰æŒ‡å®šç±»å‹çš„è¯ä¼šæŠ¥é”™</span><br></code></pre></td></tr></table></figure><p>ç”±äºJVMä¼˜åŒ–ï¼Œnew String[0]ä½œä¸ºCollection.toArray()æ–¹æ³•çš„å‚æ•°ç°åœ¨ä½¿ç”¨æ›´å¥½ï¼Œnew String[0]å°±æ˜¯èµ·ä¸€ä¸ªæ¨¡æ¿çš„ä½œç”¨ï¼ŒæŒ‡å®šäº†è¿”å›æ•°ç»„çš„ç±»å‹ï¼Œ0æ˜¯ä¸ºäº†èŠ‚çœç©ºé—´ï¼Œå› ä¸ºå®ƒåªæ˜¯ä¸ºäº†è¯´æ˜è¿”å›çš„ç±»å‹ã€‚è¯¦è§ï¼š<a href="https://shipilev.net/blog/2016/arrays-wisdom-ancients/">https://shipilev.net/blog/2016/arrays-wisdom-ancients/</a></p><p><strong>ä¸è¦åœ¨ foreach å¾ªç¯é‡Œè¿›è¡Œå…ƒç´ çš„ remove/add æ“ä½œ</strong></p><p>å¦‚æœè¦è¿›è¡Œremoveæ“ä½œï¼Œå¯ä»¥è°ƒç”¨è¿­ä»£å™¨çš„ removeæ–¹æ³•è€Œä¸æ˜¯é›†åˆç±»çš„ remove æ–¹æ³•ã€‚å› ä¸ºå¦‚æœåˆ—è¡¨åœ¨ä»»ä½•æ—¶é—´ä»ç»“æ„ä¸Šä¿®æ”¹åˆ›å»ºè¿­ä»£å™¨ä¹‹åï¼Œä»¥ä»»ä½•æ–¹å¼é™¤éé€šè¿‡è¿­ä»£å™¨è‡ªèº«remove/addæ–¹æ³•ï¼Œè¿­ä»£å™¨éƒ½å°†æŠ›å‡ºä¸€ä¸ªConcurrentModificationException,è¿™å°±æ˜¯å•çº¿ç¨‹çŠ¶æ€ä¸‹äº§ç”Ÿçš„ fail-fast æœºåˆ¶ã€‚</p><p>fail-fast æœºåˆ¶ ï¼šå¤šä¸ªçº¿ç¨‹å¯¹ fail-fast é›†åˆè¿›è¡Œä¿®æ”¹çš„æ—¶ï¼Œå¯èƒ½ä¼šæŠ›å‡ºConcurrentModificationExceptionï¼Œå•çº¿ç¨‹ä¸‹ä¹Ÿä¼šå‡ºç°è¿™ç§æƒ…å†µï¼Œä¸Šé¢å·²ç»æåˆ°è¿‡ã€‚</p><p>java.utilåŒ…ä¸‹é¢çš„æ‰€æœ‰çš„é›†åˆç±»éƒ½æ˜¯fail-fastçš„ï¼Œè€Œjava.util.concurrentåŒ…ä¸‹é¢çš„æ‰€æœ‰çš„ç±»éƒ½æ˜¯fail-safeçš„ã€‚</p><p>ä¸è¦åœ¨ foreach å¾ªç¯é‡Œè¿›è¡Œå…ƒç´ çš„ remove/add æ“ä½œ</p>]]></content>
    
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>Collection</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¦‚ä½•æ­£ç¡®çš„å°†æ•°ç»„è½¬æ¢ä¸ºArrayList</title>
    <link href="/blog/2021/03/14/%E5%A6%82%E4%BD%95%E6%AD%A3%E7%A1%AE%E7%9A%84%E5%B0%86%E6%95%B0%E7%BB%84%E8%BD%AC%E6%8D%A2%E4%B8%BAArrayList/"/>
    <url>/blog/2021/03/14/%E5%A6%82%E4%BD%95%E6%AD%A3%E7%A1%AE%E7%9A%84%E5%B0%86%E6%95%B0%E7%BB%84%E8%BD%AC%E6%8D%A2%E4%B8%BAArrayList/</url>
    
    <content type="html"><![CDATA[<h2 id="è‡ªå·±åŠ¨æ‰‹å®ç°ï¼ˆæ•™è‚²ç›®çš„ï¼‰"><a href="#è‡ªå·±åŠ¨æ‰‹å®ç°ï¼ˆæ•™è‚²ç›®çš„ï¼‰" class="headerlink" title="è‡ªå·±åŠ¨æ‰‹å®ç°ï¼ˆæ•™è‚²ç›®çš„ï¼‰"></a>è‡ªå·±åŠ¨æ‰‹å®ç°ï¼ˆæ•™è‚²ç›®çš„ï¼‰</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//JDK1.5+</span><br><span class="hljs-keyword">static</span> &lt;T&gt; <span class="hljs-function">List&lt;T&gt; <span class="hljs-title">arrayToList</span><span class="hljs-params">(<span class="hljs-keyword">final</span> T[] array)</span> </span>&#123;<br>  <span class="hljs-keyword">final</span> List&lt;T&gt; l = <span class="hljs-keyword">new</span> ArrayList&lt;T&gt;(array.length);<br> <br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> T s : array) &#123;<br>    l.add(s);<br>  &#125;<br>  <span class="hljs-keyword">return</span> (l);<br>&#125;<br>Integer [] myArray = &#123; <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span> &#125;;<br>System.out.println(arrayToList(myArray).getClass());<span class="hljs-comment">//class java.util.ArrayList</span><br></code></pre></td></tr></table></figure><h2 id="æœ€ç®€ä¾¿çš„æ–¹æ³•-æ¨è"><a href="#æœ€ç®€ä¾¿çš„æ–¹æ³•-æ¨è" class="headerlink" title="æœ€ç®€ä¾¿çš„æ–¹æ³•(æ¨è)"></a>æœ€ç®€ä¾¿çš„æ–¹æ³•(æ¨è)</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">List list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;(Arrays.asList(<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;b&quot;</span>, <span class="hljs-string">&quot;c&quot;</span>))<br> <br></code></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-Java8-çš„Stream-æ¨è"><a href="#ä½¿ç”¨-Java8-çš„Stream-æ¨è" class="headerlink" title="ä½¿ç”¨ Java8 çš„Stream(æ¨è)"></a>ä½¿ç”¨ Java8 çš„Stream(æ¨è)</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">Integer [] myArray = &#123; <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span> &#125;;<br>List myList = Arrays.stream(myArray).collect(Collectors.toList());<br><span class="hljs-comment">//åŸºæœ¬ç±»å‹ä¹Ÿå¯ä»¥å®ç°è½¬æ¢ï¼ˆä¾èµ–boxedçš„è£…ç®±æ“ä½œï¼‰</span><br><span class="hljs-keyword">int</span> [] myArray2 = &#123; <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span> &#125;;<br>List myList = Arrays.stream(myArray2).boxed().collect(Collectors.toList());<br></code></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-Guava-æ¨è"><a href="#ä½¿ç”¨-Guava-æ¨è" class="headerlink" title="ä½¿ç”¨ Guava(æ¨è)"></a>ä½¿ç”¨ Guava(æ¨è)</h2><p>å¯¹äºä¸å¯å˜é›†åˆï¼Œä½ å¯ä»¥ä½¿ç”¨ImmutableListç±»åŠå…¶of()ä¸copyOf()å·¥å‚æ–¹æ³•ï¼šï¼ˆå‚æ•°ä¸èƒ½ä¸ºç©ºï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;String&gt; il = ImmutableList.of(<span class="hljs-string">&quot;string&quot;</span>, <span class="hljs-string">&quot;elements&quot;</span>);  <span class="hljs-comment">// from varargs</span><br>List&lt;String&gt; il = ImmutableList.copyOf(aStringArray);      <span class="hljs-comment">// from array</span><br></code></pre></td></tr></table></figure><p>å¯¹äºå¯å˜é›†åˆï¼Œä½ å¯ä»¥ä½¿ç”¨Listsç±»åŠå…¶newArrayList()å·¥å‚æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;String&gt; l1 = Lists.newArrayList(anotherListOrCollection);    <span class="hljs-comment">// from collection</span><br>List&lt;String&gt; l2 = Lists.newArrayList(aStringArray);               <span class="hljs-comment">// from array</span><br>List&lt;String&gt; l3 = Lists.newArrayList(<span class="hljs-string">&quot;or&quot;</span>, <span class="hljs-string">&quot;string&quot;</span>, <span class="hljs-string">&quot;elements&quot;</span>); <span class="hljs-comment">// from varargs</span><br></code></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-Apache-Commons-Collections"><a href="#ä½¿ç”¨-Apache-Commons-Collections" class="headerlink" title="ä½¿ç”¨ Apache Commons Collections"></a>ä½¿ç”¨ Apache Commons Collections</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;String&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;String&gt;();<br>CollectionUtils.addAll(list, str);<br></code></pre></td></tr></table></figure><p>Collection.toArray()æ–¹æ³•ä½¿ç”¨çš„å‘&amp;å¦‚ä½•åè½¬æ•°ç»„ è¯¥æ–¹æ³•æ˜¯ä¸€ä¸ªæ³›å‹æ–¹æ³•ï¼š T[] toArray(T[] a); å¦‚æœtoArrayæ–¹æ³•ä¸­æ²¡æœ‰ä¼ é€’ä»»ä½•å‚æ•°çš„è¯è¿”å›çš„æ˜¯Objectç±»å‹æ•°ç»„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">String [] s= <span class="hljs-keyword">new</span> String[]&#123;<br>    <span class="hljs-string">&quot;dog&quot;</span>, <span class="hljs-string">&quot;lazy&quot;</span>, <span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;over&quot;</span>, <span class="hljs-string">&quot;jumps&quot;</span>, <span class="hljs-string">&quot;fox&quot;</span>, <span class="hljs-string">&quot;brown&quot;</span>, <span class="hljs-string">&quot;quick&quot;</span>, <span class="hljs-string">&quot;A&quot;</span><br>&#125;;<br>List&lt;String&gt; list = Arrays.asList(s);<br>Collections.reverse(list);<br>s=list.toArray(<span class="hljs-keyword">new</span> String[<span class="hljs-number">0</span>]);<span class="hljs-comment">//æ²¡æœ‰æŒ‡å®šç±»å‹çš„è¯ä¼šæŠ¥é”™</span><br></code></pre></td></tr></table></figure><p>ç”±äºJVMä¼˜åŒ–ï¼Œnew String[0]ä½œä¸ºCollection.toArray()æ–¹æ³•çš„å‚æ•°ç°åœ¨ä½¿ç”¨æ›´å¥½ï¼Œnew String[0]å°±æ˜¯èµ·ä¸€ä¸ªæ¨¡æ¿çš„ä½œç”¨ï¼ŒæŒ‡å®šäº†è¿”å›æ•°ç»„çš„ç±»å‹ï¼Œ0æ˜¯ä¸ºäº†èŠ‚çœç©ºé—´ï¼Œå› ä¸ºå®ƒåªæ˜¯ä¸ºäº†è¯´æ˜è¿”å›çš„ç±»å‹ã€‚è¯¦è§ï¼š<a href="https://shipilev.net/blog/2016/arrays-wisdom-ancients/">https://shipilev.net/blog/2016/arrays-wisdom-ancients/</a></p><p><strong>ä¸è¦åœ¨ foreach å¾ªç¯é‡Œè¿›è¡Œå…ƒç´ çš„ remove/add æ“ä½œ</strong> å¦‚æœè¦è¿›è¡Œremoveæ“ä½œï¼Œå¯ä»¥è°ƒç”¨è¿­ä»£å™¨çš„ removeæ–¹æ³•è€Œä¸æ˜¯é›†åˆç±»çš„ remove æ–¹æ³•ã€‚å› ä¸ºå¦‚æœåˆ—è¡¨åœ¨ä»»ä½•æ—¶é—´ä»ç»“æ„ä¸Šä¿®æ”¹åˆ›å»ºè¿­ä»£å™¨ä¹‹åï¼Œä»¥ä»»ä½•æ–¹å¼é™¤éé€šè¿‡è¿­ä»£å™¨è‡ªèº«remove/addæ–¹æ³•ï¼Œè¿­ä»£å™¨éƒ½å°†æŠ›å‡ºä¸€ä¸ªConcurrentModificationException,è¿™å°±æ˜¯å•çº¿ç¨‹çŠ¶æ€ä¸‹äº§ç”Ÿçš„ fail-fast æœºåˆ¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">fail-fast æœºåˆ¶ ï¼šå¤šä¸ªçº¿ç¨‹å¯¹ fail-fast é›†åˆè¿›è¡Œä¿®æ”¹çš„æ—¶ï¼Œå¯èƒ½ä¼šæŠ›å‡ºConcurrentModificationExceptionï¼Œå•çº¿ç¨‹ä¸‹ä¹Ÿä¼šå‡ºç°è¿™ç§æƒ…å†µï¼Œä¸Šé¢å·²ç»æåˆ°è¿‡ã€‚<br></code></pre></td></tr></table></figure><p>java.utilåŒ…ä¸‹é¢çš„æ‰€æœ‰çš„é›†åˆç±»éƒ½æ˜¯fail-fastçš„ï¼Œè€Œjava.util.concurrentåŒ…ä¸‹é¢çš„æ‰€æœ‰çš„ç±»éƒ½æ˜¯fail-safeçš„ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>ArrayList</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Arrays.asList()ä½¿ç”¨æŒ‡å—</title>
    <link href="/blog/2021/03/14/Arrays.asList()%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/"/>
    <url>/blog/2021/03/14/Arrays.asList()%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/</url>
    
    <content type="html"><![CDATA[<p><strong>æœ€è¿‘ä½¿ç”¨Arrays.asList()é‡åˆ°äº†ä¸€äº›å‘ï¼Œç„¶ååœ¨ç½‘ä¸Šçœ‹åˆ°è¿™ç¯‡æ–‡ç« ï¼šJava Array to List Examples æ„Ÿè§‰æŒºä¸é”™çš„ï¼Œä½†æ˜¯è¿˜ä¸æ˜¯ç‰¹åˆ«å…¨é¢ã€‚æ‰€ä»¥ï¼Œè‡ªå·±å¯¹äºè¿™å—å°çŸ¥è¯†ç‚¹è¿›è¡Œäº†ç®€å•çš„æ€»ç»“ã€‚</strong></p><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>Arrays.asList()åœ¨å¹³æ—¶å¼€å‘ä¸­è¿˜æ˜¯æ¯”è¾ƒå¸¸è§çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒå°†ä¸€ä¸ªæ•°ç»„è½¬æ¢ä¸ºä¸€ä¸ªListé›†åˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">String[] myArray = &#123; <span class="hljs-string">&quot;Apple&quot;</span>, <span class="hljs-string">&quot;Banana&quot;</span>, <span class="hljs-string">&quot;Orange&quot;</span> &#125;ï¼› <br>List&lt;String&gt; myList = Arrays.asList(myArray);<br><span class="hljs-comment">//ä¸Šé¢ä¸¤ä¸ªè¯­å¥ç­‰ä»·äºä¸‹é¢ä¸€æ¡è¯­å¥</span><br>List&lt;String&gt; myList = Arrays.asList(<span class="hljs-string">&quot;Apple&quot;</span>,<span class="hljs-string">&quot;Banana&quot;</span>, <span class="hljs-string">&quot;Orange&quot;</span>);<br></code></pre></td></tr></table></figure><p>JDK æºç å¯¹äºè¿™ä¸ªæ–¹æ³•çš„è¯´æ˜ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *è¿”å›ç”±æŒ‡å®šæ•°ç»„æ”¯æŒçš„å›ºå®šå¤§å°çš„åˆ—è¡¨ã€‚æ­¤æ–¹æ³•ä½œä¸ºåŸºäºæ•°ç»„å’ŒåŸºäºé›†åˆçš„APIä¹‹é—´çš„æ¡¥æ¢ï¼Œä¸           Collection.toArray()ç»“åˆä½¿ç”¨ã€‚è¿”å›çš„Listæ˜¯å¯åºåˆ—åŒ–å¹¶å®ç°RandomAccessæ¥å£ã€‚</span><br><span class="hljs-comment"> */</span> <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; <span class="hljs-function">List&lt;T&gt; <span class="hljs-title">asList</span><span class="hljs-params">(T... a)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ArrayList&lt;&gt;(a);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ä½¿ç”¨æ—¶çš„æ³¨æ„äº‹é¡¹æ€»ç»“"><a href="#ä½¿ç”¨æ—¶çš„æ³¨æ„äº‹é¡¹æ€»ç»“" class="headerlink" title="ä½¿ç”¨æ—¶çš„æ³¨æ„äº‹é¡¹æ€»ç»“"></a>ä½¿ç”¨æ—¶çš„æ³¨æ„äº‹é¡¹æ€»ç»“</h2><p>ä¼ é€’çš„æ•°ç»„å¿…é¡»æ˜¯å¯¹è±¡æ•°ç»„ï¼Œè€Œä¸æ˜¯åŸºæœ¬ç±»å‹ã€‚</p><p>Arrays.asList()æ˜¯æ³›å‹æ–¹æ³•ï¼Œä¼ å…¥çš„å¯¹è±¡å¿…é¡»æ˜¯å¯¹è±¡æ•°ç»„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">int</span>[] myArray = &#123; <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span> &#125;;<br>List myList = Arrays.asList(myArray);<br>System.out.println(myList.size());<span class="hljs-comment">//1</span><br>System.out.println(myList.get(<span class="hljs-number">0</span>));<span class="hljs-comment">//æ•°ç»„åœ°å€å€¼</span><br>System.out.println(myList.get(<span class="hljs-number">1</span>));<span class="hljs-comment">//æŠ¥é”™ï¼šArrayIndexOutOfBoundsException</span><br><span class="hljs-keyword">int</span> [] array=(<span class="hljs-keyword">int</span>[]) myList.get(<span class="hljs-number">0</span>);<br>System.out.println(array[<span class="hljs-number">0</span>]);<span class="hljs-comment">//1</span><br></code></pre></td></tr></table></figure><p>å½“ä¼ å…¥ä¸€ä¸ªåŸç”Ÿæ•°æ®ç±»å‹æ•°ç»„æ—¶ï¼ŒArrays.asList() çš„çœŸæ­£å¾—åˆ°çš„å‚æ•°å°±ä¸æ˜¯æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œè€Œæ˜¯æ•°ç»„å¯¹è±¡æœ¬èº«ï¼æ­¤æ—¶List çš„å”¯ä¸€å…ƒç´ å°±æ˜¯è¿™ä¸ªæ•°ç»„ï¼Œè¿™ä¹Ÿå°±è§£é‡Šäº†ä¸Šé¢çš„ä»£ç ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨åŒ…è£…ç±»å‹æ•°ç»„å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>Integer[] myArray = { 1, 2, 3 }; ä½¿ç”¨é›†åˆçš„ä¿®æ”¹æ–¹æ³•:add()ã€remove()ã€clear()ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">List myList = Arrays.asList(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);<br>myList.add(<span class="hljs-number">4</span>);<span class="hljs-comment">//è¿è¡Œæ—¶æŠ¥é”™ï¼šUnsupportedOperationException</span><br>myList.remove(<span class="hljs-number">1</span>);<span class="hljs-comment">//è¿è¡Œæ—¶æŠ¥é”™ï¼šUnsupportedOperationException</span><br>myList.clear();<span class="hljs-comment">//è¿è¡Œæ—¶æŠ¥é”™ï¼šUnsupportedOperationException</span><br></code></pre></td></tr></table></figure><p>Arrays.asList() æ–¹æ³•è¿”å›çš„å¹¶ä¸æ˜¯ java.util.ArrayList ï¼Œè€Œæ˜¯ java.util.Arrays çš„ä¸€ä¸ªå†…éƒ¨ç±»,è¿™ä¸ªå†…éƒ¨ç±»å¹¶æ²¡æœ‰å®ç°é›†åˆçš„ä¿®æ”¹æ–¹æ³•æˆ–è€…è¯´å¹¶æ²¡æœ‰é‡å†™è¿™äº›æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">List myList = Arrays.asList(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);<br>System.out.println(myList.getClass());<span class="hljs-comment">//class java.util.Arrays$ArrayList</span><br></code></pre></td></tr></table></figure><p>ä¸‹å›¾æ˜¯java.util.Arrays$ArrayListçš„ç®€æ˜“æºç ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªç±»é‡å†™çš„æ–¹æ³•æœ‰å“ªäº›ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ArrayList</span>&lt;<span class="hljs-title">E</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractList</span>&lt;<span class="hljs-title">E</span>&gt;</span><br><span class="hljs-class">       <span class="hljs-keyword">implements</span> <span class="hljs-title">RandomAccess</span>, <span class="hljs-title">java</span>.<span class="hljs-title">io</span>.<span class="hljs-title">Serializable</span></span><br><span class="hljs-class">   </span>&#123;<br>       ...<br><br>       <span class="hljs-meta">@Override</span><br>       <span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">get</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index)</span> </span>&#123;<br>         ...<br>       &#125;<br><br>       <span class="hljs-meta">@Override</span><br>       <span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">set</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index, E element)</span> </span>&#123;<br>         ...<br>       &#125;<br><br>       <span class="hljs-meta">@Override</span><br>       <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">indexOf</span><span class="hljs-params">(Object o)</span> </span>&#123;<br>         ...<br>       &#125;<br><br>       <span class="hljs-meta">@Override</span><br>       <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">contains</span><span class="hljs-params">(Object o)</span> </span>&#123;<br>          ...<br>       &#125;<br><br>       <span class="hljs-meta">@Override</span><br>       <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">forEach</span><span class="hljs-params">(Consumer&lt;? <span class="hljs-keyword">super</span> E&gt; action)</span> </span>&#123;<br>         ...<br>       &#125;<br><br>       <span class="hljs-meta">@Override</span><br>       <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">replaceAll</span><span class="hljs-params">(UnaryOperator&lt;E&gt; operator)</span> </span>&#123;<br>         ...<br>       &#125;<br><br>       <span class="hljs-meta">@Override</span><br>       <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sort</span><span class="hljs-params">(Comparator&lt;? <span class="hljs-keyword">super</span> E&gt; c)</span> </span>&#123;<br>         ...<br>       &#125;<br>   &#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å†çœ‹ä¸€ä¸‹java.util.AbstractListçš„remove()æ–¹æ³•ï¼Œè¿™æ ·æˆ‘ä»¬å°±æ˜ç™½ä¸ºå•¥ä¼šæŠ›å‡ºUnsupportedOperationExceptionã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">remove</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index)</span> </span>&#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UnsupportedOperationException();<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Arrays</tag>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ­£ç¡®ä½¿ç”¨equalsæ–¹æ³•</title>
    <link href="/blog/2021/03/13/%E6%AD%A3%E7%A1%AE%E4%BD%BF%E7%94%A8equals%E6%96%B9%E6%B3%95/"/>
    <url>/blog/2021/03/13/%E6%AD%A3%E7%A1%AE%E4%BD%BF%E7%94%A8equals%E6%96%B9%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<p>Objectçš„equalsæ–¹æ³•å®¹æ˜“æŠ›ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œåº”ä½¿ç”¨å¸¸é‡æˆ–ç¡®å®šæœ‰å€¼çš„å¯¹è±¡æ¥è°ƒç”¨ equalsã€‚</p><h2 id="ä¸¾ä¸ªä¾‹å­ï¼š"><a href="#ä¸¾ä¸ªä¾‹å­ï¼š" class="headerlink" title="ä¸¾ä¸ªä¾‹å­ï¼š"></a>ä¸¾ä¸ªä¾‹å­ï¼š</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ä¸èƒ½ä½¿ç”¨ä¸€ä¸ªå€¼ä¸ºnullçš„å¼•ç”¨ç±»å‹å˜é‡æ¥è°ƒç”¨éé™æ€æ–¹æ³•ï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸</span><br>String str = <span class="hljs-keyword">null</span>;<br><span class="hljs-keyword">if</span> (str.equals(<span class="hljs-string">&quot;SnailClimb&quot;</span>)) &#123;<br>  ...<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>  ..<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿è¡Œä¸Šé¢çš„ç¨‹åºä¼šæŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œä½†æ˜¯æˆ‘ä»¬æŠŠç¬¬äºŒè¡Œçš„æ¡ä»¶åˆ¤æ–­è¯­å¥æ”¹ä¸ºä¸‹é¢è¿™æ ·çš„è¯ï¼Œå°±ä¸ä¼šæŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œelse è¯­å¥å—å¾—åˆ°æ‰§è¡Œã€‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-string">&quot;SnailClimb&quot;</span>.equals(str);<span class="hljs-comment">// false </span><br></code></pre></td></tr></table></figure><p>ä¸è¿‡æ›´æ¨èä½¿ç”¨ java.util.Objects#equals(JDK7 å¼•å…¥çš„å·¥å…·ç±»)ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">Objects.equals(<span class="hljs-keyword">null</span>,<span class="hljs-string">&quot;SnailClimb&quot;</span>);<span class="hljs-comment">// false</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹java.util.Objects#equalsçš„æºç å°±çŸ¥é“åŸå› äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">equals</span><span class="hljs-params">(Object a, Object b)</span> </span>&#123;<br>        <span class="hljs-comment">// å¯ä»¥é¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚å¦‚æœa==nullçš„è¯æ­¤æ—¶a.equals(b)å°±ä¸ä¼šå¾—åˆ°æ‰§è¡Œï¼Œé¿å…å‡ºç°ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚</span><br>        <span class="hljs-keyword">return</span> (a == b) || (a != <span class="hljs-keyword">null</span> &amp;&amp; a.equals(b));<br>    &#125;<br></code></pre></td></tr></table></figure><h2 id="æ³¨æ„ï¼š"><a href="#æ³¨æ„ï¼š" class="headerlink" title="æ³¨æ„ï¼š"></a>æ³¨æ„ï¼š</h2><ul><li>æ¯ç§åŸå§‹ç±»å‹éƒ½æœ‰é»˜è®¤å€¼ä¸€æ ·ï¼Œå¦‚inté»˜è®¤å€¼ä¸º 0ï¼Œboolean çš„é»˜è®¤å€¼ä¸º falseï¼Œnull æ˜¯ä»»ä½•å¼•ç”¨ç±»å‹çš„é»˜è®¤å€¼ï¼Œä¸ä¸¥æ ¼çš„è¯´æ˜¯æ‰€æœ‰ Object ç±»å‹çš„é»˜è®¤å€¼ã€‚</li><li>å¯ä»¥ä½¿ç”¨ == æˆ–è€… != æ“ä½œæ¥æ¯”è¾ƒnullå€¼ï¼Œä½†æ˜¯ä¸èƒ½ä½¿ç”¨å…¶ä»–ç®—æ³•æˆ–è€…é€»è¾‘æ“ä½œã€‚åœ¨Javaä¸­null == nullå°†è¿”å›trueã€‚</li><li>ä¸èƒ½ä½¿ç”¨ä¸€ä¸ªå€¼ä¸ºnullçš„å¼•ç”¨ç±»å‹å˜é‡æ¥è°ƒç”¨éé™æ€æ–¹æ³•ï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>equals</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaä¸­IOæµåˆ†ä¸ºå‡ ç§</title>
    <link href="/blog/2021/03/13/Java%E4%B8%ADIO%E6%B5%81%E5%88%86%E4%B8%BA%E5%87%A0%E7%A7%8D/"/>
    <url>/blog/2021/03/13/Java%E4%B8%ADIO%E6%B5%81%E5%88%86%E4%B8%BA%E5%87%A0%E7%A7%8D/</url>
    
    <content type="html"><![CDATA[<ol><li>InputStream/Reader: æ‰€æœ‰çš„è¾“å…¥æµçš„åŸºç±»ï¼Œå‰è€…æ˜¯å­—èŠ‚è¾“å…¥æµï¼Œåè€…æ˜¯å­—ç¬¦è¾“å…¥æµã€‚</li><li>OutputStream/Writer: æ‰€æœ‰è¾“å‡ºæµçš„åŸºç±»ï¼Œå‰è€…æ˜¯å­—èŠ‚è¾“å‡ºæµï¼Œåè€…æ˜¯å­—ç¬¦è¾“å‡ºæµã€‚</li></ol><h3 id="æ—¢ç„¶æœ‰äº†å­—èŠ‚æµ-ä¸ºä»€ä¹ˆè¿˜è¦æœ‰å­—ç¬¦æµ"><a href="#æ—¢ç„¶æœ‰äº†å­—èŠ‚æµ-ä¸ºä»€ä¹ˆè¿˜è¦æœ‰å­—ç¬¦æµ" class="headerlink" title="æ—¢ç„¶æœ‰äº†å­—èŠ‚æµ,ä¸ºä»€ä¹ˆè¿˜è¦æœ‰å­—ç¬¦æµ?"></a>æ—¢ç„¶æœ‰äº†å­—èŠ‚æµ,ä¸ºä»€ä¹ˆè¿˜è¦æœ‰å­—ç¬¦æµ?</h3><p><strong>é—®é¢˜æœ¬è´¨æƒ³é—®ï¼šä¸ç®¡æ˜¯æ–‡ä»¶è¯»å†™è¿˜æ˜¯ç½‘ç»œå‘é€æ¥æ”¶ï¼Œä¿¡æ¯çš„æœ€å°å­˜å‚¨å•å…ƒéƒ½æ˜¯å­—èŠ‚ï¼Œé‚£ä¸ºä»€ä¹ˆ I/O æµæ“ä½œè¦åˆ†ä¸ºå­—èŠ‚æµæ“ä½œå’Œå­—ç¬¦æµæ“ä½œå‘¢ï¼Ÿ</strong></p><p>å›ç­”ï¼šå­—ç¬¦æµæ˜¯ç”± Java è™šæ‹Ÿæœºå°†å­—èŠ‚è½¬æ¢å¾—åˆ°çš„ï¼Œé—®é¢˜å°±å‡ºåœ¨è¿™ä¸ªè¿‡ç¨‹è¿˜ç®—æ˜¯éå¸¸è€—æ—¶ï¼Œå¹¶ä¸”ï¼Œå¦‚æœæˆ‘ä»¬ä¸çŸ¥é“ç¼–ç ç±»å‹å°±å¾ˆå®¹æ˜“å‡ºç°ä¹±ç é—®é¢˜ã€‚æ‰€ä»¥ï¼Œ I/O æµå°±å¹²è„†æä¾›äº†ä¸€ä¸ªç›´æ¥æ“ä½œå­—ç¬¦çš„æ¥å£ï¼Œæ–¹ä¾¿æˆ‘ä»¬å¹³æ—¶å¯¹å­—ç¬¦è¿›è¡Œæµæ“ä½œã€‚å¦‚æœéŸ³é¢‘æ–‡ä»¶ã€å›¾ç‰‡ç­‰åª’ä½“æ–‡ä»¶ç”¨å­—èŠ‚æµæ¯”è¾ƒå¥½ï¼Œå¦‚æœæ¶‰åŠåˆ°å­—ç¬¦çš„è¯ä½¿ç”¨å­—ç¬¦æµæ¯”è¾ƒå¥½ã€‚</p><h3 id="BIO-NIO-AIO-æœ‰ä»€ä¹ˆåŒºåˆ«"><a href="#BIO-NIO-AIO-æœ‰ä»€ä¹ˆåŒºåˆ«" class="headerlink" title="BIO,NIO,AIO æœ‰ä»€ä¹ˆåŒºåˆ«?"></a>BIO,NIO,AIO æœ‰ä»€ä¹ˆåŒºåˆ«?</h3><ul><li>BIO (Blocking I/O): åŒæ­¥é˜»å¡I/Oæ¨¡å¼ï¼Œæ•°æ®çš„è¯»å–å†™å…¥å¿…é¡»é˜»å¡åœ¨ä¸€ä¸ªçº¿ç¨‹å†…ç­‰å¾…å…¶å®Œæˆã€‚åœ¨æ´»åŠ¨è¿æ¥æ•°ä¸æ˜¯ç‰¹åˆ«é«˜ï¼ˆå°äºå•æœº1000ï¼‰çš„æƒ…å†µä¸‹ï¼Œè¿™ç§æ¨¡å‹æ˜¯æ¯”è¾ƒä¸é”™çš„ï¼Œå¯ä»¥è®©æ¯ä¸€ä¸ªè¿æ¥ä¸“æ³¨äºè‡ªå·±çš„ I/O å¹¶ä¸”ç¼–ç¨‹æ¨¡å‹ç®€å•ï¼Œä¹Ÿä¸ç”¨è¿‡å¤šè€ƒè™‘ç³»ç»Ÿçš„è¿‡è½½ã€é™æµç­‰é—®é¢˜ã€‚çº¿ç¨‹æ± æœ¬èº«å°±æ˜¯ä¸€ä¸ªå¤©ç„¶çš„æ¼æ–—ï¼Œå¯ä»¥ç¼“å†²ä¸€äº›ç³»ç»Ÿå¤„ç†ä¸äº†çš„è¿æ¥æˆ–è¯·æ±‚ã€‚ä½†æ˜¯ï¼Œå½“é¢å¯¹åä¸‡ç”šè‡³ç™¾ä¸‡çº§è¿æ¥çš„æ—¶å€™ï¼Œä¼ ç»Ÿçš„ BIO æ¨¡å‹æ˜¯æ— èƒ½ä¸ºåŠ›çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ›´é«˜æ•ˆçš„ I/O å¤„ç†æ¨¡å‹æ¥åº”å¯¹æ›´é«˜çš„å¹¶å‘é‡ã€‚</li><li>NIO (New I/O): NIOæ˜¯ä¸€ç§åŒæ­¥éé˜»å¡çš„I/Oæ¨¡å‹ï¼Œåœ¨Java 1.4 ä¸­å¼•å…¥äº†NIOæ¡†æ¶ï¼Œå¯¹åº” java.nio åŒ…ï¼Œæä¾›äº† Channel , Selectorï¼ŒBufferç­‰æŠ½è±¡ã€‚NIOä¸­çš„Nå¯ä»¥ç†è§£ä¸ºNon-blockingï¼Œä¸å•çº¯æ˜¯Newã€‚å®ƒæ”¯æŒé¢å‘ç¼“å†²çš„ï¼ŒåŸºäºé€šé“çš„I/Oæ“ä½œæ–¹æ³•ã€‚ NIOæä¾›äº†ä¸ä¼ ç»ŸBIOæ¨¡å‹ä¸­çš„ Socket å’Œ ServerSocket ç›¸å¯¹åº”çš„ SocketChannel å’Œ ServerSocketChannel ä¸¤ç§ä¸åŒçš„å¥—æ¥å­—é€šé“å®ç°,ä¸¤ç§é€šé“éƒ½æ”¯æŒé˜»å¡å’Œéé˜»å¡ä¸¤ç§æ¨¡å¼ã€‚é˜»å¡æ¨¡å¼ä½¿ç”¨å°±åƒä¼ ç»Ÿä¸­çš„æ”¯æŒä¸€æ ·ï¼Œæ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯æ€§èƒ½å’Œå¯é æ€§éƒ½ä¸å¥½ï¼›éé˜»å¡æ¨¡å¼æ­£å¥½ä¸ä¹‹ç›¸åã€‚å¯¹äºä½è´Ÿè½½ã€ä½å¹¶å‘çš„åº”ç”¨ç¨‹åºï¼Œå¯ä»¥ä½¿ç”¨åŒæ­¥é˜»å¡I/Oæ¥æå‡å¼€å‘é€Ÿç‡å’Œæ›´å¥½çš„ç»´æŠ¤æ€§ï¼›å¯¹äºé«˜è´Ÿè½½ã€é«˜å¹¶å‘çš„ï¼ˆç½‘ç»œï¼‰åº”ç”¨ï¼Œåº”ä½¿ç”¨ NIO çš„éé˜»å¡æ¨¡å¼æ¥å¼€å‘</li><li>AIO (Asynchronous I/O): AIO ä¹Ÿå°±æ˜¯ NIO 2ã€‚åœ¨ Java 7 ä¸­å¼•å…¥äº† NIO çš„æ”¹è¿›ç‰ˆ NIO 2,å®ƒæ˜¯å¼‚æ­¥éé˜»å¡çš„IOæ¨¡å‹ã€‚å¼‚æ­¥ IO æ˜¯åŸºäºäº‹ä»¶å’Œå›è°ƒæœºåˆ¶å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯åº”ç”¨æ“ä½œä¹‹åä¼šç›´æ¥è¿”å›ï¼Œä¸ä¼šå µå¡åœ¨é‚£é‡Œï¼Œå½“åå°å¤„ç†å®Œæˆï¼Œæ“ä½œç³»ç»Ÿä¼šé€šçŸ¥ç›¸åº”çš„çº¿ç¨‹è¿›è¡Œåç»­çš„æ“ä½œã€‚AIO æ˜¯å¼‚æ­¥IOçš„ç¼©å†™ï¼Œè™½ç„¶ NIO åœ¨ç½‘ç»œæ“ä½œä¸­ï¼Œæä¾›äº†éé˜»å¡çš„æ–¹æ³•ï¼Œä½†æ˜¯ NIO çš„ IO è¡Œä¸ºè¿˜æ˜¯åŒæ­¥çš„ã€‚å¯¹äº NIO æ¥è¯´ï¼Œæˆ‘ä»¬çš„ä¸šåŠ¡çº¿ç¨‹æ˜¯åœ¨ IO æ“ä½œå‡†å¤‡å¥½æ—¶ï¼Œå¾—åˆ°é€šçŸ¥ï¼Œæ¥ç€å°±ç”±è¿™ä¸ªçº¿ç¨‹è‡ªè¡Œè¿›è¡Œ IO æ“ä½œï¼ŒIOæ“ä½œæœ¬èº«æ˜¯åŒæ­¥çš„ã€‚æŸ¥é˜…ç½‘ä¸Šç›¸å…³èµ„æ–™ï¼Œæˆ‘å‘ç°å°±ç›®å‰æ¥è¯´ AIO çš„åº”ç”¨è¿˜ä¸æ˜¯å¾ˆå¹¿æ³›ï¼ŒNetty ä¹‹å‰ä¹Ÿå°è¯•ä½¿ç”¨è¿‡ AIOï¼Œä¸è¿‡åˆæ”¾å¼ƒäº†ã€‚</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>io</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaä¸­çš„å¼‚å¸¸å¤„ç†</title>
    <link href="/blog/2021/03/13/Java%E4%B8%AD%E7%9A%84%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/"/>
    <url>/blog/2021/03/13/Java%E4%B8%AD%E7%9A%84%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/</url>
    
    <content type="html"><![CDATA[<p>åœ¨ Java ä¸­ï¼Œæ‰€æœ‰çš„å¼‚å¸¸éƒ½æœ‰ä¸€ä¸ªå…±åŒçš„ç¥–å…ˆjava.langåŒ…ä¸­çš„ Throwableç±»ã€‚Throwableï¼š æœ‰ä¸¤ä¸ªé‡è¦çš„å­ç±»ï¼šExceptionï¼ˆå¼‚å¸¸ï¼‰ å’Œ Errorï¼ˆé”™è¯¯ï¼‰ ï¼ŒäºŒè€…éƒ½æ˜¯ Java å¼‚å¸¸å¤„ç†çš„é‡è¦å­ç±»ï¼Œå„è‡ªéƒ½åŒ…å«å¤§é‡å­ç±»ã€‚</p><p>Errorï¼ˆé”™è¯¯ï¼‰:æ˜¯ç¨‹åºæ— æ³•å¤„ç†çš„é”™è¯¯ï¼Œè¡¨ç¤ºè¿è¡Œåº”ç”¨ç¨‹åºä¸­è¾ƒä¸¥é‡é—®é¢˜ã€‚å¤§å¤šæ•°é”™è¯¯ä¸ä»£ç ç¼–å†™è€…æ‰§è¡Œçš„æ“ä½œæ— å…³ï¼Œè€Œè¡¨ç¤ºä»£ç è¿è¡Œæ—¶ JVMï¼ˆJava è™šæ‹Ÿæœºï¼‰å‡ºç°çš„é—®é¢˜ã€‚ä¾‹å¦‚ï¼ŒJavaè™šæ‹Ÿæœºè¿è¡Œé”™è¯¯ï¼ˆVirtual MachineErrorï¼‰ï¼Œå½“ JVM ä¸å†æœ‰ç»§ç»­æ‰§è¡Œæ“ä½œæ‰€éœ€çš„å†…å­˜èµ„æºæ—¶ï¼Œå°†å‡ºç° OutOfMemoryErrorã€‚è¿™äº›å¼‚å¸¸å‘ç”Ÿæ—¶ï¼ŒJavaè™šæ‹Ÿæœºï¼ˆJVMï¼‰ä¸€èˆ¬ä¼šé€‰æ‹©çº¿ç¨‹ç»ˆæ­¢ã€‚</p><p>è¿™äº›é”™è¯¯è¡¨ç¤ºæ•…éšœå‘ç”Ÿäºè™šæ‹Ÿæœºè‡ªèº«ã€æˆ–è€…å‘ç”Ÿåœ¨è™šæ‹Ÿæœºè¯•å›¾æ‰§è¡Œåº”ç”¨æ—¶ï¼Œå¦‚Javaè™šæ‹Ÿæœºè¿è¡Œé”™è¯¯ï¼ˆVirtual MachineErrorï¼‰ã€ç±»å®šä¹‰é”™è¯¯ï¼ˆNoClassDefFoundErrorï¼‰ç­‰ã€‚è¿™äº›é”™è¯¯æ˜¯ä¸å¯æŸ¥çš„ï¼Œå› ä¸ºå®ƒä»¬åœ¨åº”ç”¨ç¨‹åºçš„æ§åˆ¶å’Œå¤„ç†èƒ½åŠ›ä¹‹ å¤–ï¼Œè€Œä¸”ç»å¤§å¤šæ•°æ˜¯ç¨‹åºè¿è¡Œæ—¶ä¸å…è®¸å‡ºç°çš„çŠ¶å†µã€‚å¯¹äºè®¾è®¡åˆç†çš„åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œå³ä½¿ç¡®å®å‘ç”Ÿäº†é”™è¯¯ï¼Œæœ¬è´¨ä¸Šä¹Ÿä¸åº”è¯¥è¯•å›¾å»å¤„ç†å®ƒæ‰€å¼•èµ·çš„å¼‚å¸¸çŠ¶å†µã€‚åœ¨ Javaä¸­ï¼Œé”™è¯¯é€šè¿‡Errorçš„å­ç±»æè¿°ã€‚</p><p>Exceptionï¼ˆå¼‚å¸¸ï¼‰:æ˜¯ç¨‹åºæœ¬èº«å¯ä»¥å¤„ç†çš„å¼‚å¸¸ã€‚Exception ç±»æœ‰ä¸€ä¸ªé‡è¦çš„å­ç±» RuntimeExceptionã€‚RuntimeException å¼‚å¸¸ç”±Javaè™šæ‹ŸæœºæŠ›å‡ºã€‚NullPointerExceptionï¼ˆè¦è®¿é—®çš„å˜é‡æ²¡æœ‰å¼•ç”¨ä»»ä½•å¯¹è±¡æ—¶ï¼ŒæŠ›å‡ºè¯¥å¼‚å¸¸ï¼‰ã€ArithmeticExceptionï¼ˆç®—æœ¯è¿ç®—å¼‚å¸¸ï¼Œä¸€ä¸ªæ•´æ•°é™¤ä»¥0æ—¶ï¼ŒæŠ›å‡ºè¯¥å¼‚å¸¸ï¼‰å’Œ ArrayIndexOutOfBoundsException ï¼ˆä¸‹æ ‡è¶Šç•Œå¼‚å¸¸ï¼‰ã€‚</p><p>æ³¨æ„ï¼šå¼‚å¸¸å’Œé”™è¯¯çš„åŒºåˆ«ï¼šå¼‚å¸¸èƒ½è¢«ç¨‹åºæœ¬èº«å¤„ç†ï¼Œé”™è¯¯æ˜¯æ— æ³•å¤„ç†ã€‚</p><h2 id="Throwableç±»å¸¸ç”¨æ–¹æ³•"><a href="#Throwableç±»å¸¸ç”¨æ–¹æ³•" class="headerlink" title="Throwableç±»å¸¸ç”¨æ–¹æ³•"></a>Throwableç±»å¸¸ç”¨æ–¹æ³•</h2><p>public string getMessage():è¿”å›å¼‚å¸¸å‘ç”Ÿæ—¶çš„ç®€è¦æè¿° public string toString():è¿”å›å¼‚å¸¸å‘ç”Ÿæ—¶çš„è¯¦ç»†ä¿¡æ¯ public string getLocalizedMessage():è¿”å›å¼‚å¸¸å¯¹è±¡çš„æœ¬åœ°åŒ–ä¿¡æ¯ã€‚ä½¿ç”¨Throwableçš„å­ç±»è¦†ç›–è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥å£°ç§°æœ¬åœ°åŒ–ä¿¡æ¯ã€‚å¦‚æœå­ç±»æ²¡æœ‰è¦†ç›–è¯¥æ–¹æ³•ï¼Œåˆ™è¯¥æ–¹æ³•è¿”å›çš„ä¿¡æ¯ä¸getMessageï¼ˆï¼‰è¿”å›çš„ç»“æœç›¸åŒ public void printStackTrace():åœ¨æ§åˆ¶å°ä¸Šæ‰“å°Throwableå¯¹è±¡å°è£…çš„å¼‚å¸¸ä¿¡æ¯</p><h2 id="å¼‚å¸¸å¤„ç†æ€»ç»“"><a href="#å¼‚å¸¸å¤„ç†æ€»ç»“" class="headerlink" title="å¼‚å¸¸å¤„ç†æ€»ç»“"></a>å¼‚å¸¸å¤„ç†æ€»ç»“</h2><p>try å—ï¼š ç”¨äºæ•è·å¼‚å¸¸ã€‚å…¶åå¯æ¥é›¶ä¸ªæˆ–å¤šä¸ªcatchå—ï¼Œå¦‚æœæ²¡æœ‰catchå—ï¼Œåˆ™å¿…é¡»è·Ÿä¸€ä¸ªfinallyå—ã€‚ catch å—ï¼š ç”¨äºå¤„ç†tryæ•è·åˆ°çš„å¼‚å¸¸ã€‚ finally å—ï¼š æ— è®ºæ˜¯å¦æ•è·æˆ–å¤„ç†å¼‚å¸¸ï¼Œfinallyå—é‡Œçš„è¯­å¥éƒ½ä¼šè¢«æ‰§è¡Œã€‚å½“åœ¨tryå—æˆ–catchå—ä¸­é‡åˆ°return è¯­å¥æ—¶ï¼Œfinallyè¯­å¥å—å°†åœ¨æ–¹æ³•è¿”å›ä¹‹å‰è¢«æ‰§è¡Œã€‚</p><p><strong>åœ¨ä»¥ä¸‹4ç§ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œfinallyå—ä¸ä¼šè¢«æ‰§è¡Œï¼š</strong></p><p>åœ¨finallyè¯­å¥å—ç¬¬ä¸€è¡Œå‘ç”Ÿäº†å¼‚å¸¸ã€‚ å› ä¸ºåœ¨å…¶ä»–è¡Œï¼Œfinallyå—è¿˜æ˜¯ä¼šå¾—åˆ°æ‰§è¡Œ åœ¨å‰é¢çš„ä»£ç ä¸­ç”¨äº†System.exit(int)å·²é€€å‡ºç¨‹åºã€‚ exitæ˜¯å¸¦å‚å‡½æ•° ï¼›è‹¥è¯¥è¯­å¥åœ¨å¼‚å¸¸è¯­å¥ä¹‹åï¼Œfinallyä¼šæ‰§è¡Œ ç¨‹åºæ‰€åœ¨çš„çº¿ç¨‹æ­»äº¡ã€‚ å…³é—­CPUã€‚</p><p>æ³¨æ„ï¼š å½“tryè¯­å¥å’Œfinallyè¯­å¥ä¸­éƒ½æœ‰returnè¯­å¥æ—¶ï¼Œåœ¨æ–¹æ³•è¿”å›ä¹‹å‰ï¼Œfinallyè¯­å¥çš„å†…å®¹å°†è¢«æ‰§è¡Œï¼Œå¹¶ä¸”finallyè¯­å¥çš„è¿”å›å€¼å°†ä¼šè¦†ç›–åŸå§‹çš„è¿”å›å€¼ã€‚å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">f</span><span class="hljs-params">(<span class="hljs-keyword">int</span> value)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> value * value;<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">if</span> (value == <span class="hljs-number">2</span>) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœè°ƒç”¨ f(2)ï¼Œè¿”å›å€¼å°†æ˜¯0ï¼Œå› ä¸ºfinallyè¯­å¥çš„è¿”å›å€¼è¦†ç›–äº†tryè¯­å¥å—çš„è¿”å›å€¼ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>å¼‚å¸¸</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>==ä¸equalså’ŒhashCodeä¸equals</title>
    <link href="/blog/2021/03/12/==%E4%B8%8Eequals%E5%92%8ChashCode%E4%B8%8Eequals/"/>
    <url>/blog/2021/03/12/==%E4%B8%8Eequals%E5%92%8ChashCode%E4%B8%8Eequals/</url>
    
    <content type="html"><![CDATA[<p>== : å®ƒçš„ä½œç”¨æ˜¯åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡çš„åœ°å€æ˜¯ä¸æ˜¯ç›¸ç­‰ã€‚å³ï¼Œåˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡(åŸºæœ¬æ•°æ®ç±»å‹==æ¯”è¾ƒçš„æ˜¯å€¼ï¼Œå¼•ç”¨æ•°æ®ç±»å‹==æ¯”è¾ƒçš„æ˜¯å†…å­˜åœ°å€)ã€‚</p><p>equals() : å®ƒçš„ä½œç”¨ä¹Ÿæ˜¯åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ã€‚ä½†å®ƒä¸€èˆ¬æœ‰ä¸¤ç§ä½¿ç”¨æƒ…å†µï¼š</p><p>æƒ…å†µ1ï¼šç±»æ²¡æœ‰è¦†ç›– equals() æ–¹æ³•ã€‚åˆ™é€šè¿‡ equals() æ¯”è¾ƒè¯¥ç±»çš„ä¸¤ä¸ªå¯¹è±¡æ—¶ï¼Œç­‰ä»·äºé€šè¿‡â€œ==â€æ¯”è¾ƒè¿™ä¸¤ä¸ªå¯¹è±¡ã€‚ æƒ…å†µ2ï¼šç±»è¦†ç›–äº† equals() æ–¹æ³•ã€‚ä¸€èˆ¬ï¼Œæˆ‘ä»¬éƒ½è¦†ç›– equals() æ–¹æ³•æ¥æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„å†…å®¹æ˜¯å¦ç›¸ç­‰ï¼›è‹¥å®ƒä»¬çš„å†…å®¹ç›¸ç­‰ï¼Œåˆ™è¿”å› true (å³ï¼Œè®¤ä¸ºè¿™ä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰)ã€‚</p><h2 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">test1</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        String a = <span class="hljs-keyword">new</span> String(<span class="hljs-string">&quot;ab&quot;</span>); <span class="hljs-comment">// a ä¸ºä¸€ä¸ªå¼•ç”¨</span><br>        String b = <span class="hljs-keyword">new</span> String(<span class="hljs-string">&quot;ab&quot;</span>); <span class="hljs-comment">// bä¸ºå¦ä¸€ä¸ªå¼•ç”¨,å¯¹è±¡çš„å†…å®¹ä¸€æ ·</span><br>        String aa = <span class="hljs-string">&quot;ab&quot;</span>; <span class="hljs-comment">// æ”¾åœ¨å¸¸é‡æ± ä¸­</span><br>        String bb = <span class="hljs-string">&quot;ab&quot;</span>; <span class="hljs-comment">// ä»å¸¸é‡æ± ä¸­æŸ¥æ‰¾</span><br>        <span class="hljs-keyword">if</span> (aa == bb) <span class="hljs-comment">// true</span><br>            System.out.println(<span class="hljs-string">&quot;aa==bb&quot;</span>);<br>        <span class="hljs-keyword">if</span> (a == b) <span class="hljs-comment">// falseï¼ŒéåŒä¸€å¯¹è±¡</span><br>            System.out.println(<span class="hljs-string">&quot;a==b&quot;</span>);<br>        <span class="hljs-keyword">if</span> (a.equals(b)) <span class="hljs-comment">// true</span><br>            System.out.println(<span class="hljs-string">&quot;aEQb&quot;</span>);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-number">42</span> == <span class="hljs-number">42.0</span>) &#123; <span class="hljs-comment">// true</span><br>            System.out.println(<span class="hljs-string">&quot;true&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="è¯´æ˜ï¼š"><a href="#è¯´æ˜ï¼š" class="headerlink" title="è¯´æ˜ï¼š"></a>è¯´æ˜ï¼š</h2><p>String ä¸­çš„ equals æ–¹æ³•æ˜¯è¢«é‡å†™è¿‡çš„ï¼Œå› ä¸º object çš„ equals æ–¹æ³•æ˜¯æ¯”è¾ƒçš„å¯¹è±¡çš„å†…å­˜åœ°å€ï¼Œè€Œ String çš„ equals æ–¹æ³•æ¯”è¾ƒçš„æ˜¯å¯¹è±¡çš„å€¼ã€‚ å½“åˆ›å»º String ç±»å‹çš„å¯¹è±¡æ—¶ï¼Œè™šæ‹Ÿæœºä¼šåœ¨å¸¸é‡æ± ä¸­æŸ¥æ‰¾æœ‰æ²¡æœ‰å·²ç»å­˜åœ¨çš„å€¼å’Œè¦åˆ›å»ºçš„å€¼ç›¸åŒçš„å¯¹è±¡ï¼Œå¦‚æœæœ‰å°±æŠŠå®ƒèµ‹ç»™å½“å‰å¼•ç”¨ã€‚å¦‚æœæ²¡æœ‰å°±åœ¨å¸¸é‡æ± ä¸­é‡æ–°åˆ›å»ºä¸€ä¸ª String å¯¹è±¡ã€‚</p><p>é¢è¯•å®˜å¯èƒ½ä¼šé—®ä½ ï¼šâ€œä½ é‡å†™è¿‡ hashcode å’Œ equals ä¹ˆï¼Œä¸ºä»€ä¹ˆé‡å†™equalsæ—¶å¿…é¡»é‡å†™hashCodeæ–¹æ³•ï¼Ÿâ€</p><h2 id="hashCodeï¼ˆï¼‰ä»‹ç»"><a href="#hashCodeï¼ˆï¼‰ä»‹ç»" class="headerlink" title="hashCodeï¼ˆï¼‰ä»‹ç»"></a>hashCodeï¼ˆï¼‰ä»‹ç»</h2><p>hashCode() çš„ä½œç”¨æ˜¯è·å–å“ˆå¸Œç ï¼Œä¹Ÿç§°ä¸ºæ•£åˆ—ç ï¼›å®ƒå®é™…ä¸Šæ˜¯è¿”å›ä¸€ä¸ªintæ•´æ•°ã€‚è¿™ä¸ªå“ˆå¸Œç çš„ä½œç”¨æ˜¯ç¡®å®šè¯¥å¯¹è±¡åœ¨å“ˆå¸Œè¡¨ä¸­çš„ç´¢å¼•ä½ç½®ã€‚hashCode() å®šä¹‰åœ¨JDKçš„Object.javaä¸­ï¼Œè¿™å°±æ„å‘³ç€Javaä¸­çš„ä»»ä½•ç±»éƒ½åŒ…å«æœ‰hashCode() å‡½æ•°ã€‚</p><p>æ•£åˆ—è¡¨å­˜å‚¨çš„æ˜¯é”®å€¼å¯¹(key-value)ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯ï¼šèƒ½æ ¹æ®â€œé”®â€å¿«é€Ÿçš„æ£€ç´¢å‡ºå¯¹åº”çš„â€œå€¼â€ã€‚è¿™å…¶ä¸­å°±åˆ©ç”¨åˆ°äº†æ•£åˆ—ç ï¼ï¼ˆå¯ä»¥å¿«é€Ÿæ‰¾åˆ°æ‰€éœ€è¦çš„å¯¹è±¡ï¼‰</p><p>ä¸ºä»€ä¹ˆè¦æœ‰ hashCode æˆ‘ä»¬å…ˆä»¥â€œHashSet å¦‚ä½•æ£€æŸ¥é‡å¤â€ä¸ºä¾‹å­æ¥è¯´æ˜ä¸ºä»€ä¹ˆè¦æœ‰ hashCodeï¼š å½“ä½ æŠŠå¯¹è±¡åŠ å…¥ HashSet æ—¶ï¼ŒHashSet ä¼šå…ˆè®¡ç®—å¯¹è±¡çš„ hashcode å€¼æ¥åˆ¤æ–­å¯¹è±¡åŠ å…¥çš„ä½ç½®ï¼ŒåŒæ—¶ä¹Ÿä¼šä¸å…¶ä»–å·²ç»åŠ å…¥çš„å¯¹è±¡çš„ hashcode å€¼ä½œæ¯”è¾ƒï¼Œå¦‚æœæ²¡æœ‰ç›¸ç¬¦çš„hashcodeï¼ŒHashSetä¼šå‡è®¾å¯¹è±¡æ²¡æœ‰é‡å¤å‡ºç°ã€‚ä½†æ˜¯å¦‚æœå‘ç°æœ‰ç›¸åŒ hashcode å€¼çš„å¯¹è±¡ï¼Œè¿™æ—¶ä¼šè°ƒç”¨ equalsï¼ˆï¼‰æ–¹æ³•æ¥æ£€æŸ¥ hashcode ç›¸ç­‰çš„å¯¹è±¡æ˜¯å¦çœŸçš„ç›¸åŒã€‚å¦‚æœä¸¤è€…ç›¸åŒï¼ŒHashSet å°±ä¸ä¼šè®©å…¶åŠ å…¥æ“ä½œæˆåŠŸã€‚å¦‚æœä¸åŒçš„è¯ï¼Œå°±ä¼šé‡æ–°æ•£åˆ—åˆ°å…¶ä»–ä½ç½®ã€‚ï¼ˆæ‘˜è‡ªæˆ‘çš„Javaå¯è’™ä¹¦ã€ŠHead first javaã€‹ç¬¬äºŒç‰ˆï¼‰ã€‚è¿™æ ·æˆ‘ä»¬å°±å¤§å¤§å‡å°‘äº† equals çš„æ¬¡æ•°ï¼Œç›¸åº”å°±å¤§å¤§æé«˜äº†æ‰§è¡Œé€Ÿåº¦ã€‚</p><p>é€šè¿‡æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼šhashCode() çš„ä½œç”¨å°±æ˜¯è·å–å“ˆå¸Œç ï¼Œä¹Ÿç§°ä¸ºæ•£åˆ—ç ï¼›å®ƒå®é™…ä¸Šæ˜¯è¿”å›ä¸€ä¸ªintæ•´æ•°ã€‚è¿™ä¸ªå“ˆå¸Œç çš„ä½œç”¨æ˜¯ç¡®å®šè¯¥å¯¹è±¡åœ¨å“ˆå¸Œè¡¨ä¸­çš„ç´¢å¼•ä½ç½®ã€‚hashCode()åœ¨æ•£åˆ—è¡¨ä¸­æ‰æœ‰ç”¨ï¼Œåœ¨å…¶å®ƒæƒ…å†µä¸‹æ²¡ç”¨ã€‚åœ¨æ•£åˆ—è¡¨ä¸­hashCode() çš„ä½œç”¨æ˜¯è·å–å¯¹è±¡çš„æ•£åˆ—ç ï¼Œè¿›è€Œç¡®å®šè¯¥å¯¹è±¡åœ¨æ•£åˆ—è¡¨ä¸­çš„ä½ç½®ã€‚</p><p>hashCodeï¼ˆï¼‰ä¸equalsï¼ˆï¼‰çš„ç›¸å…³è§„å®š å¦‚æœä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰ï¼Œåˆ™hashcodeä¸€å®šä¹Ÿæ˜¯ç›¸åŒçš„ ä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰,å¯¹ä¸¤ä¸ªå¯¹è±¡åˆ†åˆ«è°ƒç”¨equalsæ–¹æ³•éƒ½è¿”å›true ä¸¤ä¸ªå¯¹è±¡æœ‰ç›¸åŒçš„hashcodeå€¼ï¼Œå®ƒä»¬ä¹Ÿä¸ä¸€å®šæ˜¯ç›¸ç­‰çš„ å› æ­¤ï¼Œequals æ–¹æ³•è¢«è¦†ç›–è¿‡ï¼Œåˆ™ hashCode æ–¹æ³•ä¹Ÿå¿…é¡»è¢«è¦†ç›– hashCode() çš„é»˜è®¤è¡Œä¸ºæ˜¯å¯¹å †ä¸Šçš„å¯¹è±¡äº§ç”Ÿç‹¬ç‰¹å€¼ã€‚å¦‚æœæ²¡æœ‰é‡å†™ hashCode()ï¼Œåˆ™è¯¥ class çš„ä¸¤ä¸ªå¯¹è±¡æ— è®ºå¦‚ä½•éƒ½ä¸ä¼šç›¸ç­‰ï¼ˆå³ä½¿è¿™ä¸¤ä¸ªå¯¹è±¡æŒ‡å‘ç›¸åŒçš„æ•°æ®ï¼‰</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Stringå’ŒStringBufferå’ŒStringBuilderçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ</title>
    <link href="/blog/2021/03/12/String%E5%92%8CStringBuffer%E5%92%8CStringBuilder%E7%9A%84%E5%8C%BA%E5%88%AB%E6%98%AF%E4%BB%80%E4%B9%88/"/>
    <url>/blog/2021/03/12/String%E5%92%8CStringBuffer%E5%92%8CStringBuilder%E7%9A%84%E5%8C%BA%E5%88%AB%E6%98%AF%E4%BB%80%E4%B9%88/</url>
    
    <content type="html"><![CDATA[<h1 id="å¯å˜æ€§"><a href="#å¯å˜æ€§" class="headerlink" title="å¯å˜æ€§"></a>å¯å˜æ€§</h1><p>ç®€å•çš„æ¥è¯´ï¼šString ç±»ä¸­ä½¿ç”¨ final å…³é”®å­—ä¿®é¥°å­—ç¬¦æ•°ç»„æ¥ä¿å­˜å­—ç¬¦ä¸²ï¼Œprivateã€€finalã€€charã€€value[]ï¼Œæ‰€ä»¥ String å¯¹è±¡æ˜¯ä¸å¯å˜çš„ã€‚è€ŒStringBuilder ä¸ StringBuffer éƒ½ç»§æ‰¿è‡ª AbstractStringBuilder ç±»ï¼Œåœ¨ AbstractStringBuilder ä¸­ä¹Ÿæ˜¯ä½¿ç”¨å­—ç¬¦æ•°ç»„ä¿å­˜å­—ç¬¦ä¸²char[]value ä½†æ˜¯æ²¡æœ‰ç”¨ final å…³é”®å­—ä¿®é¥°ï¼Œæ‰€ä»¥è¿™ä¸¤ç§å¯¹è±¡éƒ½æ˜¯å¯å˜çš„ã€‚</p><p>StringBuilder ä¸ StringBuffer çš„æ„é€ æ–¹æ³•éƒ½æ˜¯è°ƒç”¨çˆ¶ç±»æ„é€ æ–¹æ³•ä¹Ÿå°±æ˜¯ AbstractStringBuilder å®ç°çš„ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡ŒæŸ¥é˜…æºç ã€‚ <strong>AbstractStringBuilder.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AbstractStringBuilder</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Appendable</span>, <span class="hljs-title">CharSequence</span> </span>&#123;<br>    <span class="hljs-keyword">char</span>[] value;<br>    <span class="hljs-keyword">int</span> count;<br>    AbstractStringBuilder() &#123;<br>    &#125;<br>    AbstractStringBuilder(<span class="hljs-keyword">int</span> capacity) &#123;<br>        value = <span class="hljs-keyword">new</span> <span class="hljs-keyword">char</span>[capacity];<br>    &#125;<br></code></pre></td></tr></table></figure><h1 id="çº¿ç¨‹å®‰å…¨æ€§"><a href="#çº¿ç¨‹å®‰å…¨æ€§" class="headerlink" title="çº¿ç¨‹å®‰å…¨æ€§"></a>çº¿ç¨‹å®‰å…¨æ€§</h1><p>String ä¸­çš„å¯¹è±¡æ˜¯ä¸å¯å˜çš„ï¼Œä¹Ÿå°±å¯ä»¥ç†è§£ä¸ºå¸¸é‡ï¼Œçº¿ç¨‹å®‰å…¨ã€‚AbstractStringBuilder æ˜¯ StringBuilder ä¸ StringBuffer çš„å…¬å…±çˆ¶ç±»ï¼Œå®šä¹‰äº†ä¸€äº›å­—ç¬¦ä¸²çš„åŸºæœ¬æ“ä½œï¼Œå¦‚ expandCapacityã€appendã€insertã€indexOf ç­‰å…¬å…±æ–¹æ³•ã€‚StringBuffer å¯¹æ–¹æ³•åŠ äº†åŒæ­¥é”æˆ–è€…å¯¹è°ƒç”¨çš„æ–¹æ³•åŠ äº†åŒæ­¥é”ï¼Œæ‰€ä»¥æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚StringBuilder å¹¶æ²¡æœ‰å¯¹æ–¹æ³•è¿›è¡ŒåŠ åŒæ­¥é”ï¼Œæ‰€ä»¥æ˜¯éçº¿ç¨‹å®‰å…¨çš„ã€‚ã€€</p><h1 id="æ€§èƒ½"><a href="#æ€§èƒ½" class="headerlink" title="æ€§èƒ½"></a>æ€§èƒ½</h1><p>æ¯æ¬¡å¯¹ String ç±»å‹è¿›è¡Œæ”¹å˜çš„æ—¶å€™ï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ String å¯¹è±¡ï¼Œç„¶åå°†æŒ‡é’ˆæŒ‡å‘æ–°çš„ String å¯¹è±¡ã€‚StringBuffer æ¯æ¬¡éƒ½ä¼šå¯¹ StringBuffer å¯¹è±¡æœ¬èº«è¿›è¡Œæ“ä½œï¼Œè€Œä¸æ˜¯ç”Ÿæˆæ–°çš„å¯¹è±¡å¹¶æ”¹å˜å¯¹è±¡å¼•ç”¨ã€‚ç›¸åŒæƒ…å†µä¸‹ä½¿ç”¨ StringBuilder ç›¸æ¯”ä½¿ç”¨ StringBuffer ä»…èƒ½è·å¾— 10%~15% å·¦å³çš„æ€§èƒ½æå‡ï¼Œä½†å´è¦å†’å¤šçº¿ç¨‹ä¸å®‰å…¨çš„é£é™©ã€‚</p><h1 id="å¯¹äºä¸‰è€…ä½¿ç”¨çš„æ€»ç»“"><a href="#å¯¹äºä¸‰è€…ä½¿ç”¨çš„æ€»ç»“" class="headerlink" title="å¯¹äºä¸‰è€…ä½¿ç”¨çš„æ€»ç»“"></a>å¯¹äºä¸‰è€…ä½¿ç”¨çš„æ€»ç»“</h1><p>æ“ä½œå°‘é‡çš„æ•°æ®: é€‚ç”¨String å•çº¿ç¨‹æ“ä½œå­—ç¬¦ä¸²ç¼“å†²åŒºä¸‹æ“ä½œå¤§é‡æ•°æ®: é€‚ç”¨StringBuilder å¤šçº¿ç¨‹æ“ä½œå­—ç¬¦ä¸²ç¼“å†²åŒºä¸‹æ“ä½œå¤§é‡æ•°æ®: é€‚ç”¨StringBuffer</p>]]></content>
    
    
    
    <tags>
      
      <tag>StringBuffer</tag>
      
      <tag>StringBuilder</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>javaæ¯”è¾ƒä¸¤ä¸ªæ—¥æœŸç›¸å·®çš„å¤©æ•°</title>
    <link href="/blog/2021/03/12/java%E6%AF%94%E8%BE%83%E4%B8%A4%E4%B8%AA%E6%97%A5%E6%9C%9F%E7%9B%B8%E5%B7%AE%E7%9A%84%E5%A4%A9%E6%95%B0/"/>
    <url>/blog/2021/03/12/java%E6%AF%94%E8%BE%83%E4%B8%A4%E4%B8%AA%E6%97%A5%E6%9C%9F%E7%9B%B8%E5%B7%AE%E7%9A%84%E5%A4%A9%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<p>åˆ¤æ–­ä¸¤ä¸ªDateç±»å‹çš„æ—¥æœŸä¹‹é—´çš„å¤©æ•°</p><h2 id="é€šè¿‡è®¡ç®—æ¯«ç§’æ•°åˆ¤æ–­"><a href="#é€šè¿‡è®¡ç®—æ¯«ç§’æ•°åˆ¤æ–­" class="headerlink" title="é€šè¿‡è®¡ç®—æ¯«ç§’æ•°åˆ¤æ–­"></a>é€šè¿‡è®¡ç®—æ¯«ç§’æ•°åˆ¤æ–­</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>    DateFormat df = <span class="hljs-keyword">new</span> SimpleDateFormat(<span class="hljs-string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);<br>    Date date = df.parse(<span class="hljs-string">&quot;2019-11-04 20:23:31&quot;</span>);<br>    <span class="hljs-keyword">long</span> days = (<span class="hljs-keyword">new</span> Date().getTime() - date.getTime()) / <span class="hljs-number">1000</span> / <span class="hljs-number">3600</span> / <span class="hljs-number">24</span>;<br>    System.out.println(days);<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼ä¸»è¦æ˜¯é€šè¿‡è®¡ç®—ä¸¤ä¸ªæ—¶é—´ä¹‹é—´çš„æ¯«ç§’æ•°æ¥åˆ¤æ–­ï¼Œå¦‚æœç›¸å·®ä¸è¶…è¿‡24å°æ—¶ï¼Œåˆ™è¯´æ˜æ˜¯åŒä¸€å¤©</p><h2 id="ä¹Ÿå¯ä»¥é€šè¿‡å°†æ—¶åˆ†ç§’è®¾ç½®ä¸º0æ¥é€šè¿‡æ—¥æœŸåˆ¤æ–­"><a href="#ä¹Ÿå¯ä»¥é€šè¿‡å°†æ—¶åˆ†ç§’è®¾ç½®ä¸º0æ¥é€šè¿‡æ—¥æœŸåˆ¤æ–­" class="headerlink" title="ä¹Ÿå¯ä»¥é€šè¿‡å°†æ—¶åˆ†ç§’è®¾ç½®ä¸º0æ¥é€šè¿‡æ—¥æœŸåˆ¤æ–­"></a>ä¹Ÿå¯ä»¥é€šè¿‡å°†æ—¶åˆ†ç§’è®¾ç½®ä¸º0æ¥é€šè¿‡æ—¥æœŸåˆ¤æ–­</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>    DateFormat df = <span class="hljs-keyword">new</span> SimpleDateFormat(<span class="hljs-string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);<br>    Date date = df.parse(<span class="hljs-string">&quot;2019-11-04 20:23:31&quot;</span>);<br>    <span class="hljs-keyword">long</span> days = <span class="hljs-keyword">new</span> Date().getTime() / <span class="hljs-number">1000</span> / <span class="hljs-number">3600</span> / <span class="hljs-number">24</span> - date.getTime() / <span class="hljs-number">1000</span> / <span class="hljs-number">3600</span> / <span class="hljs-number">24</span>;<br>    System.out.println(days);<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>å·¥å…·ç±»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Zuulè‡ªå®šä¹‰è¿‡æ»¤å™¨</title>
    <link href="/blog/2021/03/11/Zuul%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%87%E6%BB%A4%E5%99%A8/"/>
    <url>/blog/2021/03/11/Zuul%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%87%E6%BB%A4%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<p>**Zuul çš„æ ¸å¿ƒæŠ€æœ¯å°±æ˜¯è¿‡æ»¤å™¨ï¼Œè¯¥æ¡†æ¶æä¾›äº† ZuulFilter æ¥å£è®©å¼€å‘è€…å¯ä»¥è‡ªå®šä¹‰è¿‡æ»¤è§„åˆ™ã€‚</p><p>æˆ‘ä»¬ä»¥èº«ä»½æ£€éªŒä¸ºä¾‹ï¼Œè‡ªå®šä¹‰ ZuulFilter è¿‡æ»¤å™¨å®ç°è¯¥åŠŸèƒ½ã€‚**</p><h2 id="åˆ›å»ºç”¨æˆ·æœåŠ¡"><a href="#åˆ›å»ºç”¨æˆ·æœåŠ¡" class="headerlink" title="åˆ›å»ºç”¨æˆ·æœåŠ¡"></a>åˆ›å»ºç”¨æˆ·æœåŠ¡</h2><p>æ–°å»ºåä¸º user-server çš„é¡¹ç›®ã€‚</p><p>æ·»åŠ ä¾èµ–ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;!-- common api --&gt;<br>&lt;dependency&gt;<br>  &lt;groupId&gt;com.extlight.springcloud&lt;/groupId&gt;<br>  &lt;artifactId&gt;common-api&lt;/artifactId&gt;<br>  &lt;version&gt;$&#123;parent-version&#125;&lt;/version&gt;<br>&lt;/dependency&gt;<br>  <br>&lt;!-- springmvc --&gt;<br>&lt;dependency&gt;<br>&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br> <br>&lt;!-- eureka å®¢æˆ·ç«¯ --&gt;<br>&lt;dependency&gt;<br>&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br>&lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure><h2 id="application-ymlï¼š"><a href="#application-ymlï¼š" class="headerlink" title="application.ymlï¼š"></a>application.ymlï¼š</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java">server:<br>    port: <span class="hljs-number">8200</span><br> <br>spring:<br>  application:<br>    name: USER<br>    <br>eureka:<br>    instance:<br>        instance-id: user-api-<span class="hljs-number">8200</span><br>        prefer-ip-address: true # è®¿é—®è·¯å¾„å¯ä»¥æ˜¾ç¤º IP<br>    client:<br>        service-url:<br>            defaultZone: http:<span class="hljs-comment">//localhost:9000/eureka/  # æ³¨å†Œä¸­å¿ƒè®¿é—®åœ°å€</span><br></code></pre></td></tr></table></figure><h2 id="ç™»å½•æ¥å£ï¼š"><a href="#ç™»å½•æ¥å£ï¼š" class="headerlink" title="ç™»å½•æ¥å£ï¼š"></a>ç™»å½•æ¥å£ï¼š</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/user&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoginController</span> </span>&#123;<br> <br><span class="hljs-meta">@PostMapping(&quot;/login&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> Result <span class="hljs-title">login</span><span class="hljs-params">(String username, String password, HttpServletResponse response)</span> </span>&#123;<br><br><br><span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;admin&quot;</span>.equals(username) &amp;&amp; <span class="hljs-string">&quot;admin&quot;</span>.equals(password)) &#123;<br><span class="hljs-comment">// æ¨¡æ‹Ÿç”Ÿæˆ tokenï¼Œå®é™…å¼€å‘ä¸­ token åº”å­˜æ”¾åœ¨æ•°æ®åº“æˆ–ç¼“å­˜ä¸­</span><br>String token = <span class="hljs-string">&quot;123456&quot;</span>;<br>Cookie cookie = <span class="hljs-keyword">new</span> Cookie(<span class="hljs-string">&quot;token&quot;</span>, token);<br>cookie.setPath(<span class="hljs-string">&quot;/&quot;</span>);<br>cookie.setMaxAge(<span class="hljs-number">60</span> * <span class="hljs-number">10</span>);<br>response.addCookie(cookie);<br><br><span class="hljs-keyword">return</span> Result.success();<br>&#125;<br><br><span class="hljs-keyword">return</span> Result.fail(<span class="hljs-number">401</span>, <span class="hljs-string">&quot;è´¦å·æˆ–å¯†ç é”™è¯¯&quot;</span>);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="user-server-å¯åŠ¨ç±»ï¼š"><a href="#user-server-å¯åŠ¨ç±»ï¼š" class="headerlink" title="user-server å¯åŠ¨ç±»ï¼š"></a>user-server å¯åŠ¨ç±»ï¼š</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@EnableEurekaClient</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServerApplication</span> </span>&#123;<br> <br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>SpringApplication.run(UserServerApplication.class, args);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="åˆ›å»º-ZuulFilter-è¿‡æ»¤å™¨"><a href="#åˆ›å»º-ZuulFilter-è¿‡æ»¤å™¨" class="headerlink" title="åˆ›å»º ZuulFilter è¿‡æ»¤å™¨"></a>åˆ›å»º ZuulFilter è¿‡æ»¤å™¨</h2><p>åœ¨ gateway-server é¡¹ç›®ä¸­ï¼Œæ–°å»ºä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œéœ€è¦ç»§æ‰¿ ZuulFilter ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AuthenticationFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ZuulFilter</span> </span>&#123;<br> <br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ˜¯å¦å¼€å¯è¿‡æ»¤</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">shouldFilter</span><span class="hljs-params">()</span> </span>&#123;<br>RequestContext context = RequestContext.getCurrentContext();<br>        HttpServletRequest request = context.getRequest();<br>        <br><span class="hljs-keyword">boolean</span> flag = request.getRequestURI().contains(<span class="hljs-string">&quot;/login&quot;</span>);<br><span class="hljs-comment">// å¦‚æœæ˜¯ç™»å½•è¯·æ±‚ä¸è¿›è¡Œè¿‡æ»¤</span><br><span class="hljs-keyword">if</span> (flag) &#123;<br>System.out.println(<span class="hljs-string">&quot;========ä¸æ‰§è¡Œ zuul è¿‡æ»¤æ–¹æ³•=======&quot;</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>System.out.println(<span class="hljs-string">&quot;========æ‰§è¡Œ zuul è¿‡æ»¤æ–¹æ³•=======&quot;</span>);<br>&#125;<br><span class="hljs-keyword">return</span> !flag;<br>&#125;<br> <br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è¿‡æ»¤å™¨æ‰§è¡Œå†…å®¹</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">run</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> ZuulException </span>&#123;<br><br>RequestContext context = RequestContext.getCurrentContext();<br>        HttpServletRequest request = context.getRequest();<br>        String token = request.getParameter(<span class="hljs-string">&quot;token&quot;</span>);<br>        <span class="hljs-comment">// æ­¤å¤„æ¨¡æ‹Ÿè·å–æ•°æ®åº“æˆ–ç¼“å­˜ä¸­çš„ token</span><br>        String dbToken = <span class="hljs-string">&quot;123456&quot;</span>;<br>        <span class="hljs-comment">// æ­¤å¤„ç®€å•æ£€éªŒ token</span><br>        <span class="hljs-keyword">if</span> (token == <span class="hljs-keyword">null</span> || <span class="hljs-string">&quot;&quot;</span>.equals(token) || !dbToken.equals(token)) &#123;<br>        context.setSendZuulResponse(<span class="hljs-keyword">false</span>);<br>        context.setResponseStatusCode(HttpStatus.UNAUTHORIZED.value());<br>        &#125;<br>        <br><span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>&#125;<br> <br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è¿‡æ»¤å™¨ç±»å‹</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">filterType</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;pre&quot;</span>;<br>&#125;<br> <br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">filterOrder</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br> <br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å…¶ä¸­ï¼ŒfilterType-æœ‰-4-ç§ç±»å‹ï¼š"><a href="#å…¶ä¸­ï¼ŒfilterType-æœ‰-4-ç§ç±»å‹ï¼š" class="headerlink" title="å…¶ä¸­ï¼ŒfilterType æœ‰ 4 ç§ç±»å‹ï¼š"></a>å…¶ä¸­ï¼ŒfilterType æœ‰ 4 ç§ç±»å‹ï¼š</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">preï¼š è¿™ç§è¿‡æ»¤å™¨åœ¨è¯·æ±‚è¢«è·¯ç”±ä¹‹å‰è°ƒç”¨ã€‚æˆ‘ä»¬å¯åˆ©ç”¨è¿™ç§è¿‡æ»¤å™¨å®ç°èº«ä»½éªŒè¯ã€åœ¨é›†ç¾¤ä¸­é€‰æ‹©è¯·æ±‚çš„å¾®æœåŠ¡ã€è®°å½•è°ƒè¯•ä¿¡æ¯ç­‰ã€‚<br> <br>routingï¼šè¿™ç§è¿‡æ»¤å™¨å°†è¯·æ±‚è·¯ç”±åˆ°å¾®æœåŠ¡ã€‚è¿™ç§è¿‡æ»¤å™¨ç”¨äºæ„å»ºå‘é€ç»™å¾®æœåŠ¡çš„è¯·æ±‚ï¼Œå¹¶ä½¿ç”¨ Apache HttpClient æˆ– Netfilx Ribbon è¯·æ±‚å¾®æœåŠ¡ã€‚<br> <br>postï¼šè¿™ç§è¿‡æ»¤å™¨åœ¨è·¯ç”±åˆ°å¾®æœåŠ¡ä»¥åæ‰§è¡Œã€‚è¿™ç§è¿‡æ»¤å™¨å¯ç”¨æ¥ä¸ºå“åº”æ·»åŠ æ ‡å‡†çš„ HTTP Headerã€æ”¶é›†ç»Ÿè®¡ä¿¡æ¯å’ŒæŒ‡æ ‡ã€å°†å“åº”ä»å¾®æœåŠ¡å‘é€ç»™å®¢æˆ·ç«¯ç­‰ã€‚<br> <br>errorï¼šåœ¨å…¶ä»–é˜¶æ®µå‘ç”Ÿé”™è¯¯æ—¶æ‰§è¡Œè¯¥è¿‡æ»¤å™¨ã€‚<br> <br></code></pre></td></tr></table></figure><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/small-20210311213320401.jpeg" alt="zuul-04"></p><h2 id="è¿è¡Œæ‰€æœ‰é¡¹ç›®ï¼Œæµ‹è¯•æ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š"><a href="#è¿è¡Œæ‰€æœ‰é¡¹ç›®ï¼Œæµ‹è¯•æ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š" class="headerlink" title="è¿è¡Œæ‰€æœ‰é¡¹ç›®ï¼Œæµ‹è¯•æ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š"></a>è¿è¡Œæ‰€æœ‰é¡¹ç›®ï¼Œæµ‹è¯•æ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š</h2><p>è¯·æ±‚ç”¨æˆ·æœåŠ¡çš„ç™»å½•æ¥å£(<a href="http://localhost:9600/user/user/login)%EF%BC%8C%E8%AF%B7%E6%B1%82%E4%B8%8D%E6%89%A7%E8%A1%8C">http://localhost:9600/user/user/login)ï¼Œè¯·æ±‚ä¸æ‰§è¡Œ</a> zuul è¿‡æ»¤æ–¹æ³•ï¼Œå¹¶ä¸”è¯·æ±‚å“åº”è¿”å›çš„ cookie åŒ…å« token</p><p>è¯·æ±‚è®¢å•æœåŠ¡çš„ä¸‹å•æ¥å£(<a href="http://localhost:9600/extlight/order/place)%EF%BC%8C%E4%BD%86%E4%B8%8D%E6%90%BA%E5%B8%A6">http://localhost:9600/extlight/order/place)ï¼Œä½†ä¸æºå¸¦</a> tokenï¼Œè¯·æ±‚éœ€è¦æ‰§è¡Œ zuul è¿‡æ»¤æ–¹æ³•ï¼Œè¯·æ±‚å“åº” 401 æƒé™ä¸è¶³</p><p>è¯·æ±‚è®¢å•æœåŠ¡çš„ä¸‹å•æ¥å£(<a href="http://localhost:9600/extlight/order/place)%EF%BC%8C%E6%90%BA%E5%B8%A6%E4%B9%8B%E5%89%8D%E7%99%BB%E5%BD%95%E6%8E%A5%E5%8F%A3%E8%BF%94%E5%9B%9E%E7%9A%84">http://localhost:9600/extlight/order/place)ï¼Œæºå¸¦ä¹‹å‰ç™»å½•æ¥å£è¿”å›çš„</a> tokenï¼Œè¯·æ±‚éœ€è¦æ‰§è¡Œ zuul è¿‡æ»¤æ–¹æ³•ï¼Œæ ¡éªŒé€šè¿‡åè·¯ç”±åˆ°è®¢å•æœåŠ¡æ‰§è¡Œä¹‹åçš„æ“ä½œ</p>]]></content>
    
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>Zuul</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ideaå°†é¡¹ç›®æäº¤åˆ°ç äº‘</title>
    <link href="/blog/2021/03/11/idea%E5%B0%86%E9%A1%B9%E7%9B%AE%E6%8F%90%E4%BA%A4%E5%88%B0%E7%A0%81%E4%BA%91/"/>
    <url>/blog/2021/03/11/idea%E5%B0%86%E9%A1%B9%E7%9B%AE%E6%8F%90%E4%BA%A4%E5%88%B0%E7%A0%81%E4%BA%91/</url>
    
    <content type="html"><![CDATA[<p><a href="https://bk.cuixiaoyan.xyz/archives/github">é¦–å…ˆå…ˆçœ‹ideaæäº¤åˆ°github</a> æˆ‘çˆ±å†™ä»£ç  å˜¿å˜¿</p><p>å…ˆä¸‹è½½æ’ä»¶<img src="https://cuixiaoyande.oss-cn-shanghai.aliyuncs.com/QQ20191105-093954@2x_1572918288442.png?x-oss-process=style/small" alt="QQ20191105-093954@2x">ç„¶åå†å»ç äº‘å¼„å…¬åŒ™<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/small-20210311213144761.png" alt="QQ20191105-094104@2x">å› ä¸ºæˆ‘çš„é¡¹ç›®ä¹‹å‰ç»‘å®šäº†github æ‰€ä»¥ç°åœ¨å†ç»‘å®šç äº‘<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/small-20210311213145817.png" alt="QQ20191105-094203@2x">è¿™é‡Œè®¾ç½®æäº¤çš„è·¯å¾„<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/small-20210311213146647.png" alt="QQ20191105-094229@2x">å¦‚ä¸‹<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/small-20210311213146872.png" alt="QQ20191105-094243@2x">æœ€åpushçš„æ—¶å€™<img src="https://cuixiaoyande.oss-cn-shanghai.aliyuncs.com/QQ20191105-094229@2x_1572918294237.png?x-oss-process=style/small" alt="QQ20191105-094229@2x">éœ€è¦é€‰æ‹©æäº¤åˆ°å“ªé‡Œ æ˜¯ç äº‘è¿˜æ˜¯ github<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/small-20210311213147586.png" alt="QQ20191105-094315@2x"></p>]]></content>
    
    
    
    <tags>
      
      <tag>idea</tag>
      
      <tag>ç äº‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringCloudå…¥é—¨ä¹‹Zuulç¯‡</title>
    <link href="/blog/2021/03/11/SpringCloud%E5%85%A5%E9%97%A8Zuul%E7%AF%87/"/>
    <url>/blog/2021/03/11/SpringCloud%E5%85%A5%E9%97%A8Zuul%E7%AF%87/</url>
    
    <content type="html"><![CDATA[<p>éšç€ä¸šåŠ¡çš„æ‰©å±•ï¼Œå¾®æœåŠ¡ä¼šä¸å¯¹å¢åŠ ï¼Œç›¸åº”çš„å…¶å¯¹å¤–å¼€æ”¾çš„ API æ¥å£ä¹ŸåŠ¿å¿…å¢å¤šï¼Œè¿™ä¸åˆ©äºå‰ç«¯çš„è°ƒç”¨ä»¥åŠä¸åŒåœºæ™¯ä¸‹æ•°æ®çš„è¿”å›ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬é€šå¸¸éƒ½éœ€è¦è®¾è®¡ä¸€ä¸ª API ç½‘å…³ä½œä¸ºä¸€ä¸ªç»Ÿä¸€çš„ API å…¥å£ï¼Œæ¥ç»„åˆä¸€ä¸ªæˆ–å¤šä¸ªå†…éƒ¨ APIã€‚</p><h2 id="API-ç½‘å…³ä½¿ç”¨åœºæ™¯"><a href="#API-ç½‘å…³ä½¿ç”¨åœºæ™¯" class="headerlink" title="API ç½‘å…³ä½¿ç”¨åœºæ™¯"></a>API ç½‘å…³ä½¿ç”¨åœºæ™¯</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java">é»‘ç™½åå•ï¼š å®ç°é€šè¿‡ IP åœ°å€æ§åˆ¶è¯·æ±‚çš„è®¿é—®<br> <br>æ—¥å¿—ï¼šå®ç°è®¿é—®æ—¥å¿—çš„è®°å½•ï¼Œè¿›è€Œå®ç°æ—¥å¿—åˆ†æï¼Œå¤„ç†æ€§èƒ½æŒ‡æ ‡ç­‰<br> <br>åè®®é€‚é…ï¼šå®ç°é€šä¿¡åè®®çš„æ ¡éªŒã€é€‚é…è½¬æ¢çš„åŠŸèƒ½<br> <br>èº«ä»½è®¤è¯ï¼šå¯¹è¯·æ±‚è¿›è¡Œèº«ä»½è®¤è¯<br> <br>è®¡æµé™æµï¼šå¯ä»¥è®¾è®¡é™æµè§„åˆ™ï¼Œè®°å½•è®¿é—®æµé‡<br> <br>è·¯ç”±ï¼šå°†è¯·æ±‚è¿›è¡Œå†…éƒ¨ï¼ˆæœåŠ¡ï¼‰è½¬å‘<br></code></pre></td></tr></table></figure><h2 id="API-ç½‘å…³çš„å®ç°"><a href="#API-ç½‘å…³çš„å®ç°" class="headerlink" title="API ç½‘å…³çš„å®ç°"></a>API ç½‘å…³çš„å®ç°</h2><p>ä¸šç•Œå¸¸ç”¨çš„ API ç½‘å…³æœ‰å¾ˆå¤šæ–¹å¼ï¼Œå¦‚ï¼šSpring Cloud Zuulã€ Nginxã€Tykã€Kongã€‚æœ¬ç¯‡ä»‹ç»çš„å¯¹è±¡æ­£æ˜¯ Spring Cloud Zuulã€‚</p><p>Zuul æ˜¯ Netflix å…¬å¸å¼€æºçš„ä¸€ä¸ª API ç½‘å…³ç»„ä»¶ï¼Œæä¾›äº†è®¤è¯ã€é‰´æƒã€é™æµã€åŠ¨æ€è·¯ç”±ã€ç›‘æ§ã€å¼¹æ€§ã€å®‰å…¨ã€è´Ÿè½½å‡è¡¡ã€ååŠ©å•ç‚¹å‹æµ‹ç­‰è¾¹ç¼˜æœåŠ¡çš„æ¡†æ¶ã€‚</p><p>Spring Cloud Zuul æ˜¯åŸºäº Netflix Zuul çš„å¾®æœåŠ¡è·¯ç”±å’Œè¿‡æ»¤å™¨çš„è§£å†³æ–¹æ¡ˆï¼Œä¹Ÿç”¨äºå®ç° API ç½‘å…³ã€‚å…¶ä¸­ï¼Œè·¯ç”±åŠŸèƒ½è´Ÿè´£å°†å¤–éƒ¨è¯·æ±‚è½¬å‘åˆ°å…·ä½“çš„å¾®æœåŠ¡å®ä¾‹ä¸Šï¼Œæ˜¯å®ç°å¤–éƒ¨è®¿é—®ç»Ÿä¸€å…¥é—¨çš„åŸºç¡€ã€‚è€Œè¿‡æ»¤åŠŸèƒ½æ˜¯è´Ÿè´£å¯¹è¯·æ±‚çš„å¤„ç†è¿‡ç¨‹è¿›è¡Œå¹²é¢„ï¼Œæ˜¯å®ç°è¯·æ±‚æ ¡éªŒã€æœåŠ¡èšåˆç­‰åŠŸèƒ½çš„åŸºç¡€ã€‚</p><p>Spring Cloud Zuul å’Œ Eureka è¿›è¡Œæ•´åˆæ—¶ï¼ŒZuul å°†è‡ªèº«æ³¨å†Œåˆ° Eureka æœåŠ¡ä¸­ï¼ŒåŒæ—¶ä» Eureka ä¸­è·å–å…¶ä»–å¾®æœåŠ¡ä¿¡æ¯ï¼Œä»¥ä¾¿è¯·æ±‚å¯ä»¥å‡†ç¡®çš„é€šè¿‡ Zuul è½¬å‘åˆ°å…·ä½“å¾®æœåŠ¡ä¸Šã€‚</p><h2 id="å½“å‰çš„é¡¹ç›®åˆ—è¡¨å¦‚ä¸‹ï¼š"><a href="#å½“å‰çš„é¡¹ç›®åˆ—è¡¨å¦‚ä¸‹ï¼š" class="headerlink" title="å½“å‰çš„é¡¹ç›®åˆ—è¡¨å¦‚ä¸‹ï¼š"></a>å½“å‰çš„é¡¹ç›®åˆ—è¡¨å¦‚ä¸‹ï¼š</h2><p>æœåŠ¡å®ä¾‹ ç«¯å£ æè¿° common-api - å…¬ç”¨çš„ apiï¼Œå¦‚ï¼šå®ä½“ç±» eureka-server 9000 æ³¨å†Œä¸­å¿ƒï¼ˆEureka æœåŠ¡ç«¯ï¼‰ goods-server 8081 å•†å“æœåŠ¡ï¼ˆEureka å®¢æˆ·ç«¯ï¼‰ goods-server-02 8082 å•†å“æœåŠ¡ï¼ˆEureka å®¢æˆ·ç«¯ï¼‰ goods-server-03 8083 å•†å“æœåŠ¡ï¼ˆEureka å®¢æˆ·ç«¯ï¼‰ order-server 8100 è®¢å•æœåŠ¡ï¼ˆEureka å®¢æˆ·ç«¯ï¼‰ åˆ›å»ºä¸€ä¸ªä¸ºå gateway-server çš„ Spring Boot é¡¹ç›®ã€‚</p><h2 id="æ·»åŠ ä¾èµ–"><a href="#æ·»åŠ ä¾èµ–" class="headerlink" title="æ·»åŠ ä¾èµ–"></a>æ·»åŠ ä¾èµ–</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;!-- eureka å®¢æˆ·ç«¯ --&gt;<br>&lt;dependency&gt;<br>&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br>&lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br> <br>&lt;!-- zuul ç½‘å…³ --&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br>    &lt;artifactId&gt;spring-cloud-starter-netflix-zuul&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure><h2 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java">server:<br>    port: <span class="hljs-number">9600</span><br> <br>spring:<br>    application:<br>        name: gateway<br> <br>eureka:<br>    instance:<br>        instance-id: gateway-<span class="hljs-number">9600</span><br>        prefer-ip-address: <span class="hljs-keyword">true</span> <br>    client:<br>        service-url:<br>            defaultZone: http:<span class="hljs-comment">//localhost:9000/eureka/  # æ³¨å†Œä¸­å¿ƒè®¿é—®åœ°å€</span><br></code></pre></td></tr></table></figure><h2 id="å¯åŠ¨-Zuul"><a href="#å¯åŠ¨-Zuul" class="headerlink" title="å¯åŠ¨ Zuul"></a>å¯åŠ¨ Zuul</h2><p>åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ  @EnableZuulProxy æ³¨è§£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@EnableZuulProxy</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GatewayApplication</span> </span>&#123;<br> <br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>SpringApplication.run(GatewayApplication.class, args);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯åŠ¨ä¸Šè¾¹çš„æ‰€æœ‰é¡¹ç›®ï¼Œæ‰“å¼€ Postman è¯·æ±‚è®¢å•ä¸‹å•æ¥å£ï¼Œå¦‚ä¸‹å›¾ï¼š<img src="https://cuixiaoyande.oss-cn-shanghai.aliyuncs.com/zuul-01_1572832302170.gif?x-oss-process=style/small" alt="zuul-01">å›¾ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆä¸ç»è¿‡ç½‘å…³ç›´æ¥è®¿é—® order-server é¡¹ç›®è¯·æ±‚åœ°å€ï¼š<a href="http://localhost:8100/order/place">http://localhost:8100/order/place</a></p><p>ä¹‹åå†ä¿®æ”¹æˆè®¿é—® gateway-server é¡¹ç›®çš„è¯·æ±‚åœ°å€ï¼š<a href="http://localhost:9600/order/order/place">http://localhost:9600/order/order/place</a></p><p>æœ€ç»ˆï¼Œå“åº”ç»“æœéƒ½ä¸€æ ·ã€‚</p><p>æç¤ºï¼š<a href="http://localhost:9600/order/order/place">http://localhost:9600/order/order/place</a> ä¸­ç¬¬ä¸€ä¸ª order è¡¨ç¤ºçš„æ˜¯æ³¨å†Œåœ¨ Eureka ä¸Šçš„è®¢å•æœåŠ¡åç§°ã€‚</p><h2 id="zuul-å¸¸ç”¨é…ç½®"><a href="#zuul-å¸¸ç”¨é…ç½®" class="headerlink" title="zuul å¸¸ç”¨é…ç½®"></a>zuul å¸¸ç”¨é…ç½®</h2><p>ä¿®æ”¹è·¯ç”±ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">zuul:<br>  sensitive-headers: # å…¨å±€å¿½ç•¥æ•æ„Ÿå¤´ï¼Œå³å…è®¸æ¥æ”¶ cookie ç­‰è¯·æ±‚å¤´ä¿¡æ¯   <br>  routes:<br>    extlight: # ä»»æ„åå­—ï¼Œä¿è¯å”¯ä¸€å³å¯<br>      path: /extlight<span class="hljs-comment">/** # è‡ªå®šä¹‰ï¼ŒçœŸæ­£ç”¨åˆ°çš„è¯·æ±‚åœ°å€</span><br><span class="hljs-comment">      service-id: ORDER  # è·¯ç”±åˆ°çš„ç›®æ ‡æœåŠ¡åç§°</span><br><span class="hljs-comment"> </span><br></code></pre></td></tr></table></figure><p>å°†è®¢å•æœåŠ¡çš„è·¯ç”±åç§°æ”¹æˆ extlightã€‚</p><p>ä½¿ç”¨ Postman è¯·æ±‚ä¸‹å•æ¥å£ï¼Œè¿è¡Œç»“æœï¼š<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/small-20210311213025395.jpeg" alt="zuul-02">è¯·æ±‚æˆåŠŸã€‚</p><h2 id="ç¦ç”¨è·¯ç”±ï¼š"><a href="#ç¦ç”¨è·¯ç”±ï¼š" class="headerlink" title="ç¦ç”¨è·¯ç”±ï¼š"></a>ç¦ç”¨è·¯ç”±ï¼š</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">zuul:<br>  ignored-patterns:<br>  - /order/order<span class="hljs-comment">/**   </span><br><span class="hljs-comment"></span><br></code></pre></td></tr></table></figure><p><a href="http://localhost:9600/order/order/place">http://localhost:9600/order/order/place</a> æ— æ³•è¢«æ­£å¸¸è·¯ç”±åˆ°è®¢å•æœåŠ¡ï¼Œå“åº”è¿”å› 404ã€‚</p><h2 id="è·¯ç”±åŠ å‰ç¼€ï¼š"><a href="#è·¯ç”±åŠ å‰ç¼€ï¼š" class="headerlink" title="è·¯ç”±åŠ å‰ç¼€ï¼š"></a>è·¯ç”±åŠ å‰ç¼€ï¼š</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">zuul:<br>  prefix: /api<br></code></pre></td></tr></table></figure><p>æ‰€æœ‰è¯·æ±‚ä¸­çš„ path éœ€è¦æ·»åŠ  api å‰ç¼€ã€‚å¦‚: <a href="http://localhost:9600/extlight/order/place">http://localhost:9600/extlight/order/place</a> éœ€è¦æ”¹æˆ <a href="http://localhost:9600/api/extlight/order/place%E3%80%82">http://localhost:9600/api/extlight/order/placeã€‚</a></p><h2 id="è®¾ç½®æ•æ„Ÿå¤´ï¼š"><a href="#è®¾ç½®æ•æ„Ÿå¤´ï¼š" class="headerlink" title="è®¾ç½®æ•æ„Ÿå¤´ï¼š"></a>è®¾ç½®æ•æ„Ÿå¤´ï¼š</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">zuul:<br>  sensitive-headers: # è®¾ç½®å…¨å±€æ•æ„Ÿå¤´ï¼Œå¦‚æœä¸ºç©ºï¼Œè¡¨ç¤ºæ¥æ”¶æ‰€æœ‰æ•æ„Ÿå¤´ä¿¡æ¯<br>æˆ–è€…<br>zuul:<br>  routes:<br>    extlight: # ä»»æ„åå­—ï¼Œä¿è¯å”¯ä¸€å³å¯<br>      path: /extlight<span class="hljs-comment">/** # è‡ªå®šä¹‰ï¼ŒçœŸæ­£ç”¨åˆ°çš„è¯·æ±‚åœ°å€</span><br><span class="hljs-comment">      service-id: ORDER  # è·¯ç”±åˆ°çš„ç›®æ ‡æœåŠ¡åç§°</span><br><span class="hljs-comment">      sensitive-headers: # é’ˆå¯¹ /extlight/ çš„è¯·æ±‚è®¾ç½®æ•æ„Ÿå¤´ä¿¡æ¯</span><br><span class="hljs-comment"> </span><br></code></pre></td></tr></table></figure><p><a href="https://github.com/cuixiaoyan/zuul">æºç ä¸‹è½½</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>SpringCloud</tag>
      
      <tag>Zuul</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hystrixä»ªè¡¨ç›˜</title>
    <link href="/blog/2021/03/10/Hystrix%E4%BB%AA%E8%A1%A8%E7%9B%98/"/>
    <url>/blog/2021/03/10/Hystrix%E4%BB%AA%E8%A1%A8%E7%9B%98/</url>
    
    <content type="html"><![CDATA[<p><strong>é™¤äº†æœåŠ¡ç†”æ–­ã€é™çº§çš„åŠŸèƒ½å¤–ï¼ŒHystrix è¿˜æä¾›äº†å‡†åŠæ—¶çš„è°ƒç”¨ç›‘æ§ã€‚ Hystrix ä¼šæŒç»­åœ°è®°å½•æ‰€æœ‰é€šè¿‡ Hystrix å‘èµ·çš„è¯·æ±‚çš„æ‰§è¡Œä¿¡æ¯ï¼Œå¹¶ä»¥ç»Ÿè®¡æŠ¥è¡¨å’Œå›¾å½¢æ–¹å¼å±•ç¤ºç»™ç”¨æˆ·ã€‚</strong></p><h2 id="é…ç½®è¢«ç›‘æ§æ–¹"><a href="#é…ç½®è¢«ç›‘æ§æ–¹" class="headerlink" title="é…ç½®è¢«ç›‘æ§æ–¹"></a>é…ç½®è¢«ç›‘æ§æ–¹</h2><p>order-server é¡¹ç›®ä¸­ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependency&gt;<br>    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>    &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹ application.ymlï¼Œå¼€æ”¾ç«¯å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">management:<br>  endpoints:<br>    web:<br>      exposure:<br>        include: <span class="hljs-string">&quot;*&quot;</span><br></code></pre></td></tr></table></figure><h2 id="é…ç½®ç›‘æ§æ–¹"><a href="#é…ç½®ç›‘æ§æ–¹" class="headerlink" title="é…ç½®ç›‘æ§æ–¹"></a>é…ç½®ç›‘æ§æ–¹</h2><p>æ–°å»ºä¸€ä¸ªåä¸º hystrix-dashboard é¡¹ç›®ï¼Œæ·»åŠ å¦‚ä¸‹ä¾èµ–ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;!-- hystrix-dashboard --&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br>    &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix-dashboard&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure><p>æ–°å»º application.yml</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">server:<br>  port: <span class="hljs-number">9300</span><br>  <br>spring:<br>  application:<br>    name: Hystrix-Dashboard  <br></code></pre></td></tr></table></figure><p>å¼€å¯ç›‘æ§åŠŸèƒ½ åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ  @EnableHystrixDashboard æ³¨è§£ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@EnableHystrixDashboard</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HystrixdashboardApplication</span> </span>&#123;<br> <br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>SpringApplication.run(HystrixdashboardApplication.class, args);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯åŠ¨,æµè§ˆå™¨è®¿é—®: <a href="http://localhost:9300/hystrix![hystrix-06](https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/small-20210310202348565.jpeg)">http://localhost:9300/hystrix![hystrix-06](https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/small-20210310202348565.jpeg)</a></p><h2 id="ç›‘æ§è®¾ç½®"><a href="#ç›‘æ§è®¾ç½®" class="headerlink" title="ç›‘æ§è®¾ç½®"></a>ç›‘æ§è®¾ç½®</h2><p>æˆ‘ä»¬ä»¥ç›‘æ§ order-server ä¸ºä¾‹ï¼Œåœ¨ç›‘æ§ç•Œé¢æ·»åŠ ç›‘æ§ä¿¡æ¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"># éœ€è¦ç›‘æ§çš„æœåŠ¡åœ°å€<br>http:<span class="hljs-comment">//localhost:8100/actuator/hystrix.stream</span><br> <br>delay: è¯·æ±‚é—´éš”æ—¶é—´<br> <br>title: ç›‘æ§åç§°<br> <br>ç‚¹å‡» monitor stream<br> <br>æ‰¹é‡è®¿é—® order-server æœåŠ¡çš„ä¸‹å•æ¥å£ã€‚<br></code></pre></td></tr></table></figure><p>æœ€ç»ˆæ•ˆæœå¦‚ä¸‹ï¼š<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/small-20210310202348764.jpeg" alt="hystrix-07-01">é€šè¿‡æ‰¹é‡è®¿é—®ä¸‹å•æ¥å£ï¼Œå‘ç°å›¾ä¸­å®å¿ƒåœ†å’Œæ›²çº¿å‘ç”Ÿäº†å˜åŒ–ã€‚é‚£æˆ‘ä»¬å¦‚ä½•æ ¹æ®è¿™ä¸¤ä¸ªå›¾å½¢æŸ¥çœ‹ç›‘æ§ä¿¡æ¯å‘¢ï¼Ÿ</p><p>å®å¿ƒåœ†ï¼šé€šè¿‡é¢œè‰²çš„å˜åŒ–ä»£è¡¨å®ä¾‹çš„å¥åº·ç¨‹åº¦ï¼Œå¥åº·åº¦ä»ç»¿è‰²&gt;é»„è‰²&gt;æ©™è‰²&gt;çº¢è‰²é€’å‡ã€‚å…¶å¤§å°ä¹Ÿä¼šæ ¹æ®å®ä¾‹çš„è¯·æ±‚æµé‡å‘ç”Ÿå˜åŒ–ï¼Œæµé‡è¶Šå¤§å®å¿ƒåœ†è¶Šå¤§ã€‚</p><p>æ›²çº¿ï¼šç”¨æ¥è®°å½•é—´éš”æ—¶é—´å†…æµé‡çš„ç›¸å¯¹å˜åŒ–ï¼Œé€šå¸¸å¯ä»¥è§‚å¯Ÿåˆ°æµé‡çš„ä¸Šå‡å’Œä¸‹é™è¶‹åŠ¿ã€‚ <a href="https://github.com/cuixiaoyan/hystrix">æºç ä¸‹è½½</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>Hystrix</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ‰¹é‡å»é™¤æ–‡ä»¶,æ–‡ä»¶å¤¹çš„åç§°ä¸­æŒ‡å®šçš„å­—ç¬¦</title>
    <link href="/blog/2021/03/10/%E6%89%B9%E9%87%8F%E5%8E%BB%E9%99%A4%E6%96%87%E4%BB%B6,%E6%96%87%E4%BB%B6%E5%A4%B9%E7%9A%84%E5%90%8D%E7%A7%B0%E4%B8%AD%E6%8C%87%E5%AE%9A%E7%9A%84%E5%AD%97%E7%AC%A6/"/>
    <url>/blog/2021/03/10/%E6%89%B9%E9%87%8F%E5%8E%BB%E9%99%A4%E6%96%87%E4%BB%B6,%E6%96%87%E4%BB%B6%E5%A4%B9%E7%9A%84%E5%90%8D%E7%A7%B0%E4%B8%AD%E6%8C%87%E5%AE%9A%E7%9A%84%E5%AD%97%E7%AC%A6/</url>
    
    <content type="html"><![CDATA[<p><strong>æ•ˆæœå¦‚ä¸‹</strong></p><h2 id="æ‰§è¡Œå‰"><a href="#æ‰§è¡Œå‰" class="headerlink" title="æ‰§è¡Œå‰"></a>æ‰§è¡Œå‰</h2><p><img src="https://cuixiaoyande.oss-cn-shanghai.aliyuncs.com/20191029095253196_1572490020008.png?x-oss-process=style/small" alt="20191029095253196"></p><h2 id="æ‰§è¡Œå"><a href="#æ‰§è¡Œå" class="headerlink" title="æ‰§è¡Œå"></a>æ‰§è¡Œå</h2><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/small-20210310202248495.png" alt="20191029095319557">å®Œæ•´ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.we;<br><span class="hljs-keyword">import</span> java.io.File;<br> <br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ‰¹é‡å»é™¤æ–‡ä»¶ã€æ–‡ä»¶å¤¹çš„åç§°ä¸­æŒ‡å®šçš„å­—ç¬¦</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> WalterWen</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ClearAdvert</span> </span>&#123;<br><span class="hljs-comment">//ADä¸ºå¹¿å‘Šå†…å®¹</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String AD = <span class="hljs-string">&quot;è¦å»é™¤çš„å­—ç¬¦&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> fileNum = <span class="hljs-number">0</span>;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-comment">//æ–‡ä»¶å¤¹è·¯å¾„å</span><br>        String rootPath = <span class="hljs-string">&quot;æŒ‡å®šçš„æ–‡ä»¶ï¼ˆå¤¹ï¼‰è·¯å¾„&quot;</span>;<br>        scanFile(rootPath);<br>        System.out.println(<span class="hljs-string">&quot;å…±å»å¹¿å‘Š&quot;</span> + fileNum + <span class="hljs-string">&quot;ä¸ªæ–‡ä»¶&quot;</span>);<br>    &#125;<br> <br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">     * é€’å½’è°ƒç”¨æŸ¥æ‰¾æŒ‡å®šæ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰æ–‡ä»¶</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">scanFile</span><span class="hljs-params">(String path)</span> </span>&#123;<br>        File dirFile = reName(<span class="hljs-keyword">new</span> File(path));<br>        System.out.println(dirFile.getAbsolutePath());<br>        <span class="hljs-keyword">if</span> (dirFile.isDirectory())&#123;<br>            String[] fileList = dirFile.list();<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; fileList.length; i++) &#123;<br>                path = dirFile.getAbsolutePath() + <span class="hljs-string">&quot;\\&quot;</span> + fileList[i];<br>                scanFile(path);<br>            &#125;<br>        &#125;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> File <span class="hljs-title">reName</span><span class="hljs-params">(File oldFile)</span> </span>&#123;<br>        <span class="hljs-comment">//ä¸å¸¦è·¯å¾„çš„æ–‡ä»¶å</span><br>        String originalName = oldFile.getName();        <br>        <span class="hljs-keyword">if</span> (originalName.contains(AD)) &#123;<br>            <span class="hljs-comment">//å¸¦è·¯å¾„çš„æ–‡ä»¶å</span><br>            String oldFilePath = oldFile.getAbsolutePath();<span class="hljs-comment">// ç›®å½•è·¯å¾„</span><br>            String newFilePath = oldFilePath.replace(AD, <span class="hljs-string">&quot;&quot;</span>);<br>            File newFile = <span class="hljs-keyword">new</span> File(newFilePath);<br>            <span class="hljs-keyword">if</span> (oldFile.renameTo(newFile)) &#123;<br>                fileNum++;<br>                <span class="hljs-keyword">return</span> newFile;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> oldFile;<br>    &#125;<br>&#125;<br> <br></code></pre></td></tr></table></figure><p><a href="https://bk.cuixiaoyan.xyz/archives/quzifu#%E6%89%A7%E8%A1%8C%E5%89%8D">æ‰§è¡Œå‰</a><a href="https://bk.cuixiaoyan.xyz/archives/quzifu#%E6%89%A7%E8%A1%8C%E5%90%8E">æ‰§è¡Œå</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>å·¥å…·</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringCloudå…¥é—¨ä¹‹Hystrixç¯‡</title>
    <link href="/blog/2021/03/10/SpringCloud%E5%85%A5%E9%97%A8%E4%B9%8BHystrix%E7%AF%87/"/>
    <url>/blog/2021/03/10/SpringCloud%E5%85%A5%E9%97%A8%E4%B9%8BHystrix%E7%AF%87/</url>
    
    <content type="html"><![CDATA[<h1 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h1><p>åœ¨å¾®æœåŠ¡åº”ç”¨ä¸­ï¼ŒæœåŠ¡å­˜åœ¨ä¸€å®šçš„ä¾èµ–å…³ç³»ï¼Œå¦‚æœæŸä¸ªç›®æ ‡æœåŠ¡è°ƒç”¨æ…¢æˆ–è€…æœ‰å¤§é‡è¶…æ—¶é€ æˆæœåŠ¡ä¸å¯ç”¨ï¼Œé—´æ¥å¯¼è‡´å…¶ä»–çš„ä¾èµ–æœåŠ¡ä¸å¯ç”¨ï¼Œæœ€ä¸¥é‡çš„å¯èƒ½ä¼šé˜»å¡æ•´æ¡ä¾èµ–é“¾ï¼Œæœ€ç»ˆå¯¼è‡´ä¸šåŠ¡ç³»ç»Ÿå´©æºƒï¼ˆåˆç§°é›ªå´©æ•ˆåº”ï¼‰ã€‚</p><p>ä¸Šè¿°çš„é—®é¢˜å°†æ˜¯æœ¬ç¯‡éœ€è¦è§£å†³çš„é—®é¢˜ã€‚</p><h2 id="è¯·æ±‚ç†”æ–­"><a href="#è¯·æ±‚ç†”æ–­" class="headerlink" title="è¯·æ±‚ç†”æ–­"></a>è¯·æ±‚ç†”æ–­</h2><p>æ–­è·¯å™¨æ˜¯ä¸€ç§å¼€å…³è®¾ç½®ï¼Œå½“æŸä¸ªæœåŠ¡å•å…ƒå‘ç”Ÿæ•…éšœä¹‹åï¼Œé€šè¿‡æ–­è·¯å™¨çš„æ•…éšœç›‘æ§ï¼Œå‘è°ƒç”¨æ–¹è¿”å›ä¸€ä¸ªç¬¦åˆé¢„æœŸçš„æœåŠ¡é™çº§å¤„ç†ï¼ˆfallbackï¼‰ï¼Œè€Œä¸æ˜¯é•¿æ—¶é—´çš„ç­‰å¾…æˆ–è€…æŠ›å‡ºè°ƒç”¨æ–¹æ— æ³•å¤„ç†çš„å¼‚å¸¸ï¼Œè¿™æ ·ä¿è¯äº†æœåŠ¡è°ƒç”¨æ–¹çš„çº¿ç¨‹ä¸ä¼šé•¿æ—¶é—´è¢«å ç”¨ï¼Œä»è€Œé¿å…äº†æ•…éšœåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿçš„è”“å»¶ä¹ƒè‡³å´©æºƒã€‚</p><h2 id="æœåŠ¡é™çº§"><a href="#æœåŠ¡é™çº§" class="headerlink" title="æœåŠ¡é™çº§"></a>æœåŠ¡é™çº§</h2><p>fallback ç›¸å½“äºæ˜¯é™çº§æ“ä½œã€‚å¯¹äºæŸ¥è¯¢æ“ä½œ, æˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ª fallback æ–¹æ³•, å½“è¯·æ±‚åç«¯æœåŠ¡å‡ºç°å¼‚å¸¸çš„æ—¶å€™, å¯ä»¥ä½¿ç”¨ fallback æ–¹æ³•è¿”å›çš„å€¼ã€‚ fallback æ–¹æ³•çš„è¿”å›å€¼ä¸€èˆ¬æ˜¯è®¾ç½®çš„é»˜è®¤å€¼æˆ–è€…æ¥è‡ªç¼“å­˜ï¼Œå‘ŠçŸ¥åé¢çš„è¯·æ±‚æœåŠ¡ä¸å¯ç”¨äº†ï¼Œä¸è¦å†è¯·æ±‚äº†ã€‚</p><h2 id="è¯·æ±‚ç†”æ–­å’ŒæœåŠ¡é™çº§åŒºåˆ«"><a href="#è¯·æ±‚ç†”æ–­å’ŒæœåŠ¡é™çº§åŒºåˆ«" class="headerlink" title="è¯·æ±‚ç†”æ–­å’ŒæœåŠ¡é™çº§åŒºåˆ«"></a>è¯·æ±‚ç†”æ–­å’ŒæœåŠ¡é™çº§åŒºåˆ«</h2><p>ç›¸åŒï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">ç›®æ ‡ä¸€è‡´ï¼šä¸ºäº†é˜²æ­¢ç³»ç»Ÿå´©æºƒè€Œå®æ–½çš„ä¸€ç§é˜²å¾¡æ‰‹æ®µ<br> <br>è¡¨ç°å½¢å¼ä¸€è‡´ï¼šå½“è¯·æ±‚ç›®æ ‡åœ¨ä¸€å®šæ—¶é—´å†…æ— å“åº”æ—¶ï¼Œè¿”å›æˆ–æ‰§è¡Œé»˜è®¤å“åº”å†…å®¹<br></code></pre></td></tr></table></figure><p>ä¸åŒ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">è§¦å‘æ¡ä»¶ä¸åŒï¼šä¸‹æ¸¸æœåŠ¡å‡ºç°æ•…éšœè§¦å‘è¯·æ±‚ç†”æ–­ã€‚ç³»ç»Ÿè´Ÿè·è¶…è¿‡é˜ˆå€¼è§¦å‘æœåŠ¡é™çº§ã€‚<br> <br>ç®¡ç†ç›®æ ‡å±‚æ¬¡ä¸åŒï¼šè¯·æ±‚ç†”æ–­é’ˆå¯¹æ‰€æœ‰å¾®æœåŠ¡ã€‚æœåŠ¡é™çº§é’ˆå¯¹æ•´ä¸ªç³»ç»Ÿä¸­çš„å¤–å›´æœåŠ¡ã€‚<br></code></pre></td></tr></table></figure><h2 id="å®ç°æ–¹æ¡ˆ"><a href="#å®ç°æ–¹æ¡ˆ" class="headerlink" title="å®ç°æ–¹æ¡ˆ"></a>å®ç°æ–¹æ¡ˆ</h2><p>Spring Cloud Hystrix å®ç°äº†æ–­è·¯å™¨ã€çº¿ç¨‹éš”ç¦»ç­‰ä¸€ç³»åˆ—æœåŠ¡ä¿æŠ¤åŠŸèƒ½ã€‚å®ƒæ˜¯åŸºäº Netflix çš„å¼€æºæ¡†æ¶ Hystrix å®ç°çš„ï¼Œè¯¥æ¡†æ¶çš„ç›®çš„åœ¨äºé€šè¿‡æ§åˆ¶è®¿é—®è¿œç¨‹ç³»ç»Ÿã€æœåŠ¡å’Œç¬¬ä¸‰æ–¹åº“èŠ‚ç‚¹ï¼Œä»è€Œå¯¹å»¶è¿Ÿå’Œæ•…éšœæä¾›æ›´å¼ºå¤§çš„å®¹é”™èƒ½åŠ›ã€‚</p><p>Hystrix å…·å¤‡æœåŠ¡ç†”æ–­ã€æœåŠ¡é™çº§ã€çº¿ç¨‹å’Œä¿¡å·éš”ç¦»ã€è¯·æ±‚ç¼“å­˜ã€è¯·æ±‚åˆå¹¶ä»¥åŠæœåŠ¡ç›‘æ§çš„èƒ½åŠ›ã€‚</p><h1 id="è¯·æ±‚ç†”æ–­å®æˆ˜"><a href="#è¯·æ±‚ç†”æ–­å®æˆ˜" class="headerlink" title="è¯·æ±‚ç†”æ–­å®æˆ˜"></a>è¯·æ±‚ç†”æ–­å®æˆ˜</h1><p>ç°åœ¨çš„é¡¹ç›®åˆ—è¡¨å¦‚ä¸‹ï¼š æœåŠ¡å®ä¾‹ ç«¯å£ æè¿° common-api - å…¬ç”¨çš„ apiï¼Œå¦‚ï¼šå®ä½“ç±» eureka-server 9000 æ³¨å†Œä¸­å¿ƒï¼ˆEureka æœåŠ¡ç«¯ï¼‰ goods-server 8081 å•†å“æœåŠ¡ï¼ˆEureka å®¢æˆ·ç«¯ï¼‰ goods-server-02 8082 å•†å“æœåŠ¡ï¼ˆEureka å®¢æˆ·ç«¯ï¼‰ goods-server-03 8083 å•†å“æœåŠ¡ï¼ˆEureka å®¢æˆ·ç«¯ï¼‰ order-server 8100 è®¢å•æœåŠ¡ï¼ˆEureka å®¢æˆ·ç«¯ï¼‰ åœ¨ order-server é¡¹ç›®ä¸­ï¼š</p><h2 id="æ·»åŠ ä¾èµ–"><a href="#æ·»åŠ ä¾èµ–" class="headerlink" title="æ·»åŠ ä¾èµ–"></a>æ·»åŠ ä¾èµ–</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;!-- hystrix --&gt;<br>&lt;dependency&gt;<br>&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br>&lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure><h2 id="è®¾ç½®ç†”æ–­ç­–ç•¥"><a href="#è®¾ç½®ç†”æ–­ç­–ç•¥" class="headerlink" title="è®¾ç½®ç†”æ–­ç­–ç•¥"></a>è®¾ç½®ç†”æ–­ç­–ç•¥</h2><p>æˆ‘ä»¬æ¥ä¿®æ”¹è·å–ä¸‹è®¢å•çš„æ–¹æ³•ï¼Œåœ¨ placeOrder æ–¹æ³•ä¸ŠåŠ  @HystrixCommand æ³¨è§£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OrderServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">OrderService</span></span>&#123;<br><br><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> RestTemplate restTemplate;<br><br><span class="hljs-comment">//@Autowired</span><br><span class="hljs-comment">//private GoodsServiceClient goodsServiceClient;</span><br> <br><span class="hljs-meta">@HystrixCommand(fallbackMethod = &quot;defaultByPlaceOrder&quot;)</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">placeOrder</span><span class="hljs-params">(Order order)</span> <span class="hljs-keyword">throws</span> Exception</span>&#123;<br><br>Result result = <span class="hljs-keyword">this</span>.restTemplate.getForObject(<span class="hljs-string">&quot;http://GOODS/goods/goodsInfo/&quot;</span> + order.getGoodsId(), Result.class);<br><br><span class="hljs-comment">//Result result = this.goodsServiceClient.goodsInfo(order.getGoodsId());</span><br><br><span class="hljs-keyword">if</span> (result != <span class="hljs-keyword">null</span> &amp;&amp; result.getCode() == <span class="hljs-number">200</span>) &#123;<br>System.out.println(<span class="hljs-string">&quot;=====ä¸‹è®¢å•====&quot;</span>);<br>System.out.println(result.getData());<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>System.out.println(result.getMsg());<br>&#125;<br>&#125;<br><br> <br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">defaultByPlaceOrder</span><span class="hljs-params">(Order order)</span> </span>&#123;<br>System.out.println(<span class="hljs-string">&quot;å•†å“æœåŠ¡ç³»ç»Ÿå¼‚å¸¸&quot;</span>);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å½“è°ƒç”¨å•†å“æœåŠ¡è¶…æ—¶æˆ–å‡ºç°å¼‚å¸¸æ—¶ï¼ŒHystrix ä¼šè°ƒç”¨ @HystrixCommand ä¸­æŒ‡å®šçš„ fallbackMethod æ–¹æ³•è·å–è¿”å›å€¼æˆ–æ‰§è¡Œå¼‚å¸¸å¤„ç†ã€‚</p><p>æ³¨æ„ï¼šfallbackMethod æ–¹æ³•è¦æ±‚ä¸æ­£å¸¸æ–¹æ³•æœ‰ç›¸åŒçš„å…¥å‚å’Œå›å‚ã€‚</p><h2 id="å¯åŠ¨ç†”æ–­åŠŸèƒ½"><a href="#å¯åŠ¨ç†”æ–­åŠŸèƒ½" class="headerlink" title="å¯åŠ¨ç†”æ–­åŠŸèƒ½"></a>å¯åŠ¨ç†”æ–­åŠŸèƒ½</h2><p>åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ  @EnableCircuitBreaker æ³¨è§£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@EnableCircuitBreaker</span><br><span class="hljs-meta">@EnableEurekaClient</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OrderServerApplication</span> </span>&#123;<br> <br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>SpringApplication.run(OrderServerApplication.class, args);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ç†”æ–­æµ‹è¯•"><a href="#ç†”æ–­æµ‹è¯•" class="headerlink" title="ç†”æ–­æµ‹è¯•"></a>ç†”æ–­æµ‹è¯•</h2><p>æˆ‘ä»¬é¦–å…ˆæ¼”ç¤ºæ²¡æœ‰å¼€å¯ç†”æ–­çš„åŠŸèƒ½ï¼Œå³å…ˆæŠŠä¸Šè¾¹çš„ @EnableCircuitBreaker æ³¨è§£è¿›è¡Œæ³¨é‡Šã€‚ å¯åŠ¨å¥½æ‰€æœ‰é¡¹ç›®ï¼Œä½¿ç”¨ Postman è¯·æ±‚ order-server è¿›è¡Œä¸‹å•æ“ä½œï¼Œè¿è¡Œç»“æœå¦‚ä¸‹ï¼š<img src="https://cuixiaoyande.oss-cn-shanghai.aliyuncs.com/hystrix-03-02_1572403574165.gif?x-oss-process=style/small" alt="hystrix-03-02">å½“æˆ‘ä»¬è¯·æ±‚å‘é€çš„ goodsId çš„å•†å“ä¸å­˜åœ¨ï¼ŒæœåŠ¡æä¾›æ–¹æŠ›ä¼šå¼‚å¸¸ï¼Œè°ƒç”¨æ–¹æ— æ³•å¤„ç†ï¼Œå› æ­¤åªèƒ½å±•ç¤ºå›¾ä¸­çš„å¼‚å¸¸ä¿¡æ¯ã€‚</p><p>ä¸‹é¢ï¼Œæˆ‘ä»¬å†å°† @EnableCircuitBreaker æ³¨è§£çš„æ³¨é‡Šæ”¾å¼€ï¼Œè¿è¡Œç»“æœå¦‚ä¸‹ï¼š<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/small-20210310202116369.jpeg" alt="hystrix-04-02"></p><p>ä»å›¾ä¸­å¯çŸ¥ï¼Œè™½ç„¶è¯·æ±‚äº†ä¸€ä¸ª goodsId ä¸å­˜åœ¨çš„å•†å“ï¼Œä½†æ˜¯è°ƒç”¨æ–¹ï¼ˆorder-serverï¼‰å¼€å¯äº†ç†”æ–­æœºåˆ¶ï¼Œæ‰§è¡Œé»˜è®¤æ–¹æ³•ï¼Œä»è€Œä½¿æ¥å£èƒ½æ­£å¸¸é€šä¿¡è€Œä¸æ˜¯æŠ›å‡ºè°ƒç”¨æ–¹ä¸å¯å¤„ç†çš„å¼‚å¸¸å¯¼è‡´æ•´ä¸ªç³»ç»Ÿä¸èƒ½æ­£å¸¸è¿è¡Œã€‚</p><p>çœ‹åˆ°è¿™é‡Œï¼Œæˆ–è®¸ä¼šæœ‰è¯»è€…äº§ç”Ÿä¸€ä¸ªç–‘é—®ï¼Œå¦‚æœç±»ä¸­å®šä¹‰ N ä¸ªæ–¹æ³•ï¼Œæ˜¯ä¸æ˜¯æ„å‘³ç€åŒæ—¶ä¹Ÿè¦å®šä¹‰ N ä¸ªå¼‚å¸¸å¤„ç†çš„æ–¹æ³•å‘¢ï¼Œç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚</p><p>Hystrix è¿˜æä¾›äº† @DefaultProperties ç»Ÿä¸€å¤„ç†è¯·æ±‚ç†”æ–­ï¼Œåœ¨è¯¥æ³¨è§£ä¸Šè®¾ç½® defaultFallback å±æ€§å€¼ï¼Œå³ç†”æ–­å¼€å¯åè¦æ‰§è¡Œçš„æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-meta">@DefaultProperties(defaultFallback = &quot;defaultByHystrix&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OrderServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">OrderService</span></span>&#123;<br><br><span class="hljs-comment">//@Autowired</span><br><span class="hljs-comment">//private RestTemplate restTemplate;</span><br><br><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> GoodsServiceClient goodsServiceClient;<br> <br><span class="hljs-meta">@HystrixCommand</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">placeOrder</span><span class="hljs-params">(Order order)</span> <span class="hljs-keyword">throws</span> Exception</span>&#123;<br><br><span class="hljs-comment">//Result result = this.restTemplate.getForObject(&quot;http://GOODS/goods/goodsInfo/&quot; + order.getGoodsId(), Result.class);</span><br><br>Result result = <span class="hljs-keyword">this</span>.goodsServiceClient.goodsInfo(order.getGoodsId());<br><br><span class="hljs-keyword">if</span> (result != <span class="hljs-keyword">null</span> &amp;&amp; result.getCode() == <span class="hljs-number">200</span>) &#123;<br>System.out.println(<span class="hljs-string">&quot;=====ä¸‹è®¢å•====&quot;</span>);<br>System.out.println(result.getData());<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>System.out.println(result.getMsg());<br>&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">defaultByHystrix</span><span class="hljs-params">()</span> </span>&#123;<br>System.out.println(<span class="hljs-string">&quot;å•†å“æœåŠ¡ç³»ç»Ÿå¼‚å¸¸&quot;</span>);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼šdefaultFallback å®šä¹‰çš„æ–¹æ³•å¿…é¡»æ˜¯æ— å‚çš„ã€‚ <a href="https://github.com/cuixiaoyan/hystrix">æºç ä¸‹è½½</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>SpringCloud</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaè§£å†³Emojiè¡¨æƒ…è¿‡æ»¤é—®é¢˜</title>
    <link href="/blog/2021/03/07/Java%E8%A7%A3%E5%86%B3Emoji%E8%A1%A8%E6%83%85%E8%BF%87%E6%BB%A4%E9%97%AE%E9%A2%98/"/>
    <url>/blog/2021/03/07/Java%E8%A7%A3%E5%86%B3Emoji%E8%A1%A8%E6%83%85%E8%BF%87%E6%BB%A4%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<p><strong>é—®é¢˜ï¼š</strong></p><p>Emojiè¡¨æƒ…ä»ä¸‰æ–¹æ•°æ®ä¸­è·å–æ²¡æœ‰è¿‡æ»¤ï¼Œå¯¼è‡´å­˜å…¥DBçš„æ—¶å€™æŠ¥é”™ã€‚</p><p><strong>åŸå› ï¼š</strong></p><p>UTF-8ç¼–ç æœ‰å¯èƒ½æ˜¯ä¸¤ä¸ªã€ä¸‰ä¸ªã€å››ä¸ªå­—èŠ‚ã€‚Emojiè¡¨æƒ…æ˜¯4ä¸ªå­—èŠ‚ï¼Œè€ŒMysqlçš„utf8ç¼–ç æœ€å¤š3ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥æ•°æ®æ’ä¸è¿›å»ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><p>1.å°†å·²ç»å»ºå¥½çš„è¡¨ä¹Ÿè½¬æ¢æˆutf8mb4ï¼Œè¿™ä¸ªæ–¹æ³•ä¸å¯è¡Œï¼Œæœ‰çš„æ—¶å€™å°±ä¸çµäº†ã€‚</p><p>2ï¼Œå†™ä¸ªå·¥å…·ç±»ï¼šè¿‡æ»¤æ‰emojiè¡¨æƒ…ç¬¦å·</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EmojiFilter</span> </span>&#123;<br>   <br> <br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isEmojiCharacter</span><span class="hljs-params">(<span class="hljs-keyword">char</span> codePoint)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> (codePoint == <span class="hljs-number">0x0</span>) || (codePoint == <span class="hljs-number">0x9</span>) || (codePoint == <span class="hljs-number">0xA</span>)<br>                || (codePoint == <span class="hljs-number">0xD</span>)<br>                || ((codePoint &gt;= <span class="hljs-number">0x20</span>) &amp;&amp; (codePoint &lt;= <span class="hljs-number">0xD7FF</span>))<br>                || ((codePoint &gt;= <span class="hljs-number">0xE000</span>) &amp;&amp; (codePoint &lt;= <span class="hljs-number">0xFFFD</span>))<br>                || ((codePoint &gt;= <span class="hljs-number">0x10000</span>) &amp;&amp; (codePoint &lt;= <span class="hljs-number">0x10FFFF</span>));<br>    &#125;<br> <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è¿‡æ»¤emoji æˆ–è€… å…¶ä»–éæ–‡å­—ç±»å‹çš„å­—ç¬¦</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> source</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">filterEmoji</span><span class="hljs-params">(String source)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (StringUtils.isBlank(source)) &#123;<br>            <span class="hljs-keyword">return</span> source;<br>        &#125;<br>        StringBuilder buf = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">int</span> len = source.length();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; len; i++) &#123;<br>            <span class="hljs-keyword">char</span> codePoint = source.charAt(i);<br>            <span class="hljs-keyword">if</span> (isEmojiCharacter(codePoint)) &#123;<br>                <span class="hljs-keyword">if</span> (buf == <span class="hljs-keyword">null</span>) &#123;<br>                    buf = <span class="hljs-keyword">new</span> StringBuilder(source.length());<br>                &#125;<br>                buf.append(codePoint);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (buf == <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> source;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">if</span> (buf.length() == len) &#123;<br>                buf = <span class="hljs-keyword">null</span>;<br>                <span class="hljs-keyword">return</span> source;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">return</span> buf.toString();<br>            &#125;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨åˆ«äººå°è£…çš„ä¸€ä¸ªç±»ï¼Œä¸“é—¨è§£å†³emojié—®é¢˜çš„ã€‚è¿™ä¸ªåœ¨gitä¸Šæœ‰å¼€æºçš„ä»£ç ã€‚åœ¨pomå·¥ç¨‹ä¸­å¼•å…¥</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependency&gt;<br>&lt;groupId&gt;com.vdurmont&lt;/groupId&gt;<br>&lt;artifactId&gt;emoji-java&lt;/artifactId&gt;<br>&lt;version&gt;4.0.0&lt;/version&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure><p>ç›´æ¥å°±å¯ä»¥åœ¨ä»£ç ä¸­ä½¿ç”¨äº†ã€‚</p><p>EmojiParser.removeAllEmojis(str) è¿™ä¸ªæ–¹æ³•å¯ä»¥è¿‡æ»¤æ‰å­—ç¬¦ä¸²å†…çš„emojiè¡¨æƒ…ã€‚</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>SpringCloudå…¥é—¨ä¹‹Feignç¯‡</title>
    <link href="/blog/2021/03/07/SpringCloud%E5%85%A5%E9%97%A8%E4%B9%8BFeign%E7%AF%87/"/>
    <url>/blog/2021/03/07/SpringCloud%E5%85%A5%E9%97%A8%E4%B9%8BFeign%E7%AF%87/</url>
    
    <content type="html"><![CDATA[<p>ä¸Šé¢ä»‹ç»äº† Ribbon ä½¿ç”¨è´Ÿè½½å‡è¡¡è°ƒç”¨å¾®æœåŠ¡ï¼Œä½†å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šæ¶ˆè´¹ç«¯æ¯ä¸ªè¯·æ±‚æ–¹æ³•ä¸­éƒ½éœ€è¦æ‹¼æ¥è¯·æ±‚æœåŠ¡çš„ URL åœ°å€ï¼Œå­˜åœ¨ç¡¬ç¼–ç é—®é¢˜ä¸”ä¸ç¬¦åˆé¢å‘å¯¹è±¡ç¼–ç¨‹æ€æƒ³ã€‚å¦‚æœæœåŠ¡åç§°å‘ç”Ÿå˜åŒ–ï¼Œæ¶ˆè´¹ç«¯ä¹Ÿéœ€è¦è·Ÿç€ä¿®æ”¹ã€‚</p><p>æœ¬ç¯‡æ–‡ç« å°†ä»‹ç» Feign æ¥è§£å†³ä¸Šè¾¹çš„é—®é¢˜ã€‚</p><p>Feign æ˜¯ä¸€ä¸ªå£°æ˜å¼çš„ Web Service å®¢æˆ·ç«¯ã€‚ä½¿ç”¨ Feign èƒ½è®©ç¼–å†™ Web Service å®¢æˆ·ç«¯æ›´åŠ ç®€å•ï¼ŒåŒæ—¶æ”¯æŒä¸Eurekaã€Ribbon ç»„åˆä½¿ç”¨ä»¥æ”¯æŒè´Ÿè½½å‡è¡¡ã€‚</p><p>Spring Cloud å¯¹ Feign è¿›è¡Œäº†å°è£…ï¼Œä½¿å…¶æ”¯æŒäº† Spring MVC æ ‡å‡†æ³¨è§£å’Œ HttpMessageConvertersã€‚</p><p>Feign çš„ä½¿ç”¨æ–¹æ³•æ˜¯å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œç„¶ååœ¨å…¶ä¸Šè¾¹æ·»åŠ  @FeignClient æ³¨è§£ã€‚</p><h2 id="æ·»åŠ ä¾èµ–"><a href="#æ·»åŠ ä¾èµ–" class="headerlink" title="æ·»åŠ ä¾èµ–"></a>æ·»åŠ ä¾èµ–</h2><p>åœ¨ common-api å’Œ user-web é¡¹ç›®ä¸­æ·»åŠ ä¾èµ–ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependency&gt;<br>    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br>    &lt;artifactId&gt;spring-cloud-starter-feign&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure><h2 id="å®šä¹‰æ¥å£"><a href="#å®šä¹‰æ¥å£" class="headerlink" title="å®šä¹‰æ¥å£"></a>å®šä¹‰æ¥å£</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@FeignClient(value=&quot;USER-API&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserFeignService</span> </span>&#123;<br>    <br>    <span class="hljs-meta">@RequestMapping(&quot;/provider/user/get/&#123;id&#125;&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">get</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ @FeignClient æ³¨è§£æŒ‡å®šè°ƒç”¨çš„å¾®æœåŠ¡åç§°ï¼Œå°è£…äº†è°ƒç”¨ USER-API çš„è¿‡ç¨‹ï¼Œä½œä¸ºæ¶ˆè´¹æ–¹è°ƒç”¨æ¨¡æ¿ã€‚</p><h2 id="ä¿®æ”¹æœåŠ¡æ¶ˆè´¹æ–¹"><a href="#ä¿®æ”¹æœåŠ¡æ¶ˆè´¹æ–¹" class="headerlink" title="ä¿®æ”¹æœåŠ¡æ¶ˆè´¹æ–¹"></a>ä¿®æ”¹æœåŠ¡æ¶ˆè´¹æ–¹</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/user&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> </span>&#123;<br>    <br>    <span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> UserFeignService userFeignService;<br><br><span class="hljs-meta">@RequestMapping(&quot;get/&#123;id&#125;&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">get</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>    <span class="hljs-comment">// ä½¿ç”¨ Feign å°è£…çš„æ¨¡æ¿</span><br><span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.userFeignService.get(id);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç›´æ¥ä½¿ç”¨ Feign å°è£…æ¨¡æ¿è°ƒç”¨æœåŠ¡æ–¹ï¼Œä»è€Œå®ç°é¢å‘å¯¹è±¡ç¼–ç¨‹ã€‚</p><h2 id="å¯åŠ¨-Feign-åŠŸèƒ½"><a href="#å¯åŠ¨-Feign-åŠŸèƒ½" class="headerlink" title="å¯åŠ¨ Feign åŠŸèƒ½"></a>å¯åŠ¨ Feign åŠŸèƒ½</h2><p>åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ  @EnableEeignClients æ³¨è§£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">@<span class="hljs-meta">@EnableFeignClients(basePackages=&#123;&quot;com.extlight.springcloud&quot;&#125;)</span><br><span class="hljs-meta">@ComponentScan(&quot;com.extlight.springcloud&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ConsumerApplication</span> </span>&#123;<br> <br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>SpringApplication.run(ConsumerApplication.class, args);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰“å¼€æµè§ˆå™¨è®¿é—® user-web é¡¹ç›®ï¼Œè¯·æ±‚ç»“æœå¦‚ä¸‹å›¾ï¼š<img src="https://cuixiaoyande.oss-cn-shanghai.aliyuncs.com/feign_1571967712084.jpg?x-oss-process=style/small" alt="feign"><a href="https://github.com/cuixiaoyan/feign">æºç ä¸‹è½½</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>SpringCloud</tag>
      
      <tag>Feign</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¤šçº¿ç¨‹å®¹æ˜“äº§ç”Ÿçš„40ä¸ªé—®é¢˜æ±‡æ€»</title>
    <link href="/blog/2021/03/07/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%AE%B9%E6%98%93%E4%BA%A7%E7%94%9F%E7%9A%8440%E4%B8%AA%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/"/>
    <url>/blog/2021/03/07/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%AE%B9%E6%98%93%E4%BA%A7%E7%94%9F%E7%9A%8440%E4%B8%AA%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/</url>
    
    <content type="html"><![CDATA[<p><strong>è¿™äº›å¤šçº¿ç¨‹çš„é—®é¢˜ï¼Œæœ‰äº›æ¥æºäºå„å¤§ç½‘ç«™ã€æœ‰äº›æ¥æºäºè‡ªå·±çš„æ€è€ƒã€‚å¯èƒ½æœ‰äº›é—®é¢˜ç½‘ä¸Šæœ‰ã€å¯èƒ½æœ‰äº›é—®é¢˜å¯¹åº”çš„ç­”æ¡ˆä¹Ÿæœ‰ã€ä¹Ÿå¯èƒ½æœ‰äº›å„ä½ç½‘å‹ä¹Ÿéƒ½çœ‹è¿‡ï¼Œä½†æ˜¯æœ¬æ–‡å†™ä½œçš„é‡å¿ƒå°±æ˜¯æ‰€æœ‰çš„é—®é¢˜éƒ½ä¼šæŒ‰ç…§è‡ªå·±çš„ç†è§£å›ç­”ä¸€éï¼Œä¸ä¼šå»çœ‹ç½‘ä¸Šçš„ç­”æ¡ˆï¼Œå› æ­¤å¯èƒ½æœ‰äº›é—®é¢˜è®²çš„ä¸å¯¹ï¼Œèƒ½æŒ‡æ­£çš„å¸Œæœ›å¤§å®¶ä¸åæŒ‡æ•™ã€‚</strong></p><p>40ä¸ªé—®é¢˜æ±‡æ€»</p><p>1ã€å¤šçº¿ç¨‹æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</p><p>ä¸€ä¸ªå¯èƒ½åœ¨å¾ˆå¤šäººçœ‹æ¥å¾ˆæ‰¯æ·¡çš„ä¸€ä¸ªé—®é¢˜ï¼šæˆ‘ä¼šç”¨å¤šçº¿ç¨‹å°±å¥½äº†ï¼Œè¿˜ç®¡å®ƒæœ‰ä»€ä¹ˆç”¨ï¼Ÿåœ¨æˆ‘çœ‹æ¥ï¼Œè¿™ä¸ªå›ç­”æ›´æ‰¯æ·¡ã€‚æ‰€è°“â€çŸ¥å…¶ç„¶çŸ¥å…¶æ‰€ä»¥ç„¶â€ï¼Œâ€ä¼šç”¨â€åªæ˜¯â€çŸ¥å…¶ç„¶â€ï¼Œâ€ä¸ºä»€ä¹ˆç”¨â€æ‰æ˜¯â€çŸ¥å…¶æ‰€ä»¥ç„¶â€ï¼Œåªæœ‰è¾¾åˆ°â€çŸ¥å…¶ç„¶çŸ¥å…¶æ‰€ä»¥ç„¶â€çš„ç¨‹åº¦æ‰å¯ä»¥è¯´æ˜¯æŠŠä¸€ä¸ªçŸ¥è¯†ç‚¹è¿ç”¨è‡ªå¦‚ã€‚OKï¼Œä¸‹é¢è¯´è¯´æˆ‘å¯¹è¿™ä¸ªé—®é¢˜çš„çœ‹æ³•ï¼š</p><p>ï¼ˆ1ï¼‰å‘æŒ¥å¤šæ ¸CPUçš„ä¼˜åŠ¿</p><p>éšç€å·¥ä¸šçš„è¿›æ­¥ï¼Œç°åœ¨çš„ç¬”è®°æœ¬ã€å°å¼æœºä¹ƒè‡³å•†ç”¨çš„åº”ç”¨æœåŠ¡å™¨è‡³å°‘ä¹Ÿéƒ½æ˜¯åŒæ ¸çš„ï¼Œ4æ ¸ã€8æ ¸ç”šè‡³16æ ¸çš„ä¹Ÿéƒ½ä¸å°‘è§ï¼Œå¦‚æœæ˜¯å•çº¿ç¨‹çš„ç¨‹åºï¼Œé‚£ä¹ˆåœ¨åŒæ ¸CPUä¸Šå°±æµªè´¹äº†50%ï¼Œåœ¨4æ ¸CPUä¸Šå°±æµªè´¹äº†75%ã€‚å•æ ¸CPUä¸Šæ‰€è°“çš„â€å¤šçº¿ç¨‹â€é‚£æ˜¯å‡çš„å¤šçº¿ç¨‹ï¼ŒåŒä¸€æ—¶é—´å¤„ç†å™¨åªä¼šå¤„ç†ä¸€æ®µé€»è¾‘ï¼Œåªä¸è¿‡çº¿ç¨‹ä¹‹é—´åˆ‡æ¢å¾—æ¯”è¾ƒå¿«ï¼Œçœ‹ç€åƒå¤šä¸ªçº¿ç¨‹â€åŒæ—¶â€è¿è¡Œç½¢äº†ã€‚å¤šæ ¸CPUä¸Šçš„å¤šçº¿ç¨‹æ‰æ˜¯çœŸæ­£çš„å¤šçº¿ç¨‹ï¼Œå®ƒèƒ½è®©ä½ çš„å¤šæ®µé€»è¾‘åŒæ—¶å·¥ä½œï¼Œå¤šçº¿ç¨‹ï¼Œå¯ä»¥çœŸæ­£å‘æŒ¥å‡ºå¤šæ ¸CPUçš„ä¼˜åŠ¿æ¥ï¼Œè¾¾åˆ°å……åˆ†åˆ©ç”¨CPUçš„ç›®çš„ã€‚</p><p>ï¼ˆ2ï¼‰é˜²æ­¢é˜»å¡</p><p>ä»ç¨‹åºè¿è¡Œæ•ˆç‡çš„è§’åº¦æ¥çœ‹ï¼Œå•æ ¸CPUä¸ä½†ä¸ä¼šå‘æŒ¥å‡ºå¤šçº¿ç¨‹çš„ä¼˜åŠ¿ï¼Œåè€Œä¼šå› ä¸ºåœ¨å•æ ¸CPUä¸Šè¿è¡Œå¤šçº¿ç¨‹å¯¼è‡´çº¿ç¨‹ä¸Šä¸‹æ–‡çš„åˆ‡æ¢ï¼Œè€Œé™ä½ç¨‹åºæ•´ä½“çš„æ•ˆç‡ã€‚ä½†æ˜¯å•æ ¸CPUæˆ‘ä»¬è¿˜æ˜¯è¦åº”ç”¨å¤šçº¿ç¨‹ï¼Œå°±æ˜¯ä¸ºäº†é˜²æ­¢é˜»å¡ã€‚è¯•æƒ³ï¼Œå¦‚æœå•æ ¸CPUä½¿ç”¨å•çº¿ç¨‹ï¼Œé‚£ä¹ˆåªè¦è¿™ä¸ªçº¿ç¨‹é˜»å¡äº†ï¼Œæ¯”æ–¹è¯´è¿œç¨‹è¯»å–æŸä¸ªæ•°æ®å§ï¼Œå¯¹ç«¯è¿Ÿè¿Ÿæœªè¿”å›åˆæ²¡æœ‰è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œé‚£ä¹ˆä½ çš„æ•´ä¸ªç¨‹åºåœ¨æ•°æ®è¿”å›å›æ¥ä¹‹å‰å°±åœæ­¢è¿è¡Œäº†ã€‚å¤šçº¿ç¨‹å¯ä»¥é˜²æ­¢è¿™ä¸ªé—®é¢˜ï¼Œå¤šæ¡çº¿ç¨‹åŒæ—¶è¿è¡Œï¼Œå“ªæ€•ä¸€æ¡çº¿ç¨‹çš„ä»£ç æ‰§è¡Œè¯»å–æ•°æ®é˜»å¡ï¼Œä¹Ÿä¸ä¼šå½±å“å…¶å®ƒä»»åŠ¡çš„æ‰§è¡Œã€‚</p><p>ï¼ˆ3ï¼‰ä¾¿äºå»ºæ¨¡</p><p>è¿™æ˜¯å¦å¤–ä¸€ä¸ªæ²¡æœ‰è¿™ä¹ˆæ˜æ˜¾çš„ä¼˜ç‚¹äº†ã€‚å‡è®¾æœ‰ä¸€ä¸ªå¤§çš„ä»»åŠ¡Aï¼Œå•çº¿ç¨‹ç¼–ç¨‹ï¼Œé‚£ä¹ˆå°±è¦è€ƒè™‘å¾ˆå¤šï¼Œå»ºç«‹æ•´ä¸ªç¨‹åºæ¨¡å‹æ¯”è¾ƒéº»çƒ¦ã€‚ä½†æ˜¯å¦‚æœæŠŠè¿™ä¸ªå¤§çš„ä»»åŠ¡Aåˆ†è§£æˆå‡ ä¸ªå°ä»»åŠ¡ï¼Œä»»åŠ¡Bã€ä»»åŠ¡Cã€ä»»åŠ¡Dï¼Œåˆ†åˆ«å»ºç«‹ç¨‹åºæ¨¡å‹ï¼Œå¹¶é€šè¿‡å¤šçº¿ç¨‹åˆ†åˆ«è¿è¡Œè¿™å‡ ä¸ªä»»åŠ¡ï¼Œé‚£å°±ç®€å•å¾ˆå¤šäº†ã€‚</p><p>2ã€åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼</p><p>æ¯”è¾ƒå¸¸è§çš„ä¸€ä¸ªé—®é¢˜äº†ï¼Œä¸€èˆ¬å°±æ˜¯ä¸¤ç§ï¼š</p><p>ï¼ˆ1ï¼‰ç»§æ‰¿Threadç±»</p><p>ï¼ˆ2ï¼‰å®ç°Runnableæ¥å£</p><p>è‡³äºå“ªä¸ªå¥½ï¼Œä¸ç”¨è¯´è‚¯å®šæ˜¯åè€…å¥½ï¼Œå› ä¸ºå®ç°æ¥å£çš„æ–¹å¼æ¯”ç»§æ‰¿ç±»çš„æ–¹å¼æ›´çµæ´»ï¼Œä¹Ÿèƒ½å‡å°‘ç¨‹åºä¹‹é—´çš„è€¦åˆåº¦ï¼Œé¢å‘æ¥å£ç¼–ç¨‹ä¹Ÿæ˜¯è®¾è®¡æ¨¡å¼6å¤§åŸåˆ™çš„æ ¸å¿ƒã€‚</p><p>3ã€start()æ–¹æ³•å’Œrun()æ–¹æ³•çš„åŒºåˆ«</p><p>åªæœ‰è°ƒç”¨äº†start()æ–¹æ³•ï¼Œæ‰ä¼šè¡¨ç°å‡ºå¤šçº¿ç¨‹çš„ç‰¹æ€§ï¼Œä¸åŒçº¿ç¨‹çš„run()æ–¹æ³•é‡Œé¢çš„ä»£ç äº¤æ›¿æ‰§è¡Œã€‚å¦‚æœåªæ˜¯è°ƒç”¨run()æ–¹æ³•ï¼Œé‚£ä¹ˆä»£ç è¿˜æ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œå¿…é¡»ç­‰å¾…ä¸€ä¸ªçº¿ç¨‹çš„run()æ–¹æ³•é‡Œé¢çš„ä»£ç å…¨éƒ¨æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹æ‰å¯ä»¥æ‰§è¡Œå…¶run()æ–¹æ³•é‡Œé¢çš„ä»£ç ã€‚</p><p>4ã€Runnableæ¥å£å’ŒCallableæ¥å£çš„åŒºåˆ«</p><p>æœ‰ç‚¹æ·±çš„é—®é¢˜äº†ï¼Œä¹Ÿçœ‹å‡ºä¸€ä¸ªJavaç¨‹åºå‘˜å­¦ä¹ çŸ¥è¯†çš„å¹¿åº¦ã€‚</p><p>Runnableæ¥å£ä¸­çš„run()æ–¹æ³•çš„è¿”å›å€¼æ˜¯voidï¼Œå®ƒåšçš„äº‹æƒ…åªæ˜¯çº¯ç²¹åœ°å»æ‰§è¡Œrun()æ–¹æ³•ä¸­çš„ä»£ç è€Œå·²ï¼›Callableæ¥å£ä¸­çš„call()æ–¹æ³•æ˜¯æœ‰è¿”å›å€¼çš„ï¼Œæ˜¯ä¸€ä¸ªæ³›å‹ï¼Œå’ŒFutureã€FutureTaské…åˆå¯ä»¥ç”¨æ¥è·å–å¼‚æ­¥æ‰§è¡Œçš„ç»“æœã€‚</p><p>è¿™å…¶å®æ˜¯å¾ˆæœ‰ç”¨çš„ä¸€ä¸ªç‰¹æ€§ï¼Œå› ä¸ºå¤šçº¿ç¨‹ç›¸æ¯”å•çº¿ç¨‹æ›´éš¾ã€æ›´å¤æ‚çš„ä¸€ä¸ªé‡è¦åŸå› å°±æ˜¯å› ä¸ºå¤šçº¿ç¨‹å……æ»¡ç€æœªçŸ¥æ€§ï¼ŒæŸæ¡çº¿ç¨‹æ˜¯å¦æ‰§è¡Œäº†ï¼ŸæŸæ¡çº¿ç¨‹æ‰§è¡Œäº†å¤šä¹…ï¼ŸæŸæ¡çº¿ç¨‹æ‰§è¡Œçš„æ—¶å€™æˆ‘ä»¬æœŸæœ›çš„æ•°æ®æ˜¯å¦å·²ç»èµ‹å€¼å®Œæ¯•ï¼Ÿæ— æ³•å¾—çŸ¥ï¼Œæˆ‘ä»¬èƒ½åšçš„åªæ˜¯ç­‰å¾…è¿™æ¡å¤šçº¿ç¨‹çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•è€Œå·²ã€‚è€ŒCallable+Future/FutureTaskå´å¯ä»¥è·å–å¤šçº¿ç¨‹è¿è¡Œçš„ç»“æœï¼Œå¯ä»¥åœ¨ç­‰å¾…æ—¶é—´å¤ªé•¿æ²¡è·å–åˆ°éœ€è¦çš„æ•°æ®çš„æƒ…å†µä¸‹å–æ¶ˆè¯¥çº¿ç¨‹çš„ä»»åŠ¡ï¼ŒçœŸçš„æ˜¯éå¸¸æœ‰ç”¨ã€‚</p><p>5ã€CyclicBarrierå’ŒCountDownLatchçš„åŒºåˆ«</p><p>ä¸¤ä¸ªçœ‹ä¸Šå»æœ‰ç‚¹åƒçš„ç±»ï¼Œéƒ½åœ¨java.util.concurrentä¸‹ï¼Œéƒ½å¯ä»¥ç”¨æ¥è¡¨ç¤ºä»£ç è¿è¡Œåˆ°æŸä¸ªç‚¹ä¸Šï¼ŒäºŒè€…çš„åŒºåˆ«åœ¨äºï¼š</p><p>ï¼ˆ1ï¼‰CyclicBarrierçš„æŸä¸ªçº¿ç¨‹è¿è¡Œåˆ°æŸä¸ªç‚¹ä¸Šä¹‹åï¼Œè¯¥çº¿ç¨‹å³åœæ­¢è¿è¡Œï¼Œç›´åˆ°æ‰€æœ‰çš„çº¿ç¨‹éƒ½åˆ°è¾¾äº†è¿™ä¸ªç‚¹ï¼Œæ‰€æœ‰çº¿ç¨‹æ‰é‡æ–°è¿è¡Œï¼›CountDownLatchåˆ™ä¸æ˜¯ï¼ŒæŸçº¿ç¨‹è¿è¡Œåˆ°æŸä¸ªç‚¹ä¸Šä¹‹åï¼Œåªæ˜¯ç»™æŸä¸ªæ•°å€¼-1è€Œå·²ï¼Œè¯¥çº¿ç¨‹ç»§ç»­è¿è¡Œ</p><p>ï¼ˆ2ï¼‰CyclicBarrieråªèƒ½å”¤èµ·ä¸€ä¸ªä»»åŠ¡ï¼ŒCountDownLatchå¯ä»¥å”¤èµ·å¤šä¸ªä»»åŠ¡</p><p>ï¼ˆ3ï¼‰CyclicBarrierå¯é‡ç”¨ï¼ŒCountDownLatchä¸å¯é‡ç”¨ï¼Œè®¡æ•°å€¼ä¸º0è¯¥CountDownLatchå°±ä¸å¯å†ç”¨äº†</p><p>6ã€Volatileå…³é”®å­—çš„ä½œç”¨</p><p>ä¸€ä¸ªéå¸¸é‡è¦çš„é—®é¢˜ï¼Œæ˜¯æ¯ä¸ªå­¦ä¹ ã€åº”ç”¨å¤šçº¿ç¨‹çš„Javaç¨‹åºå‘˜éƒ½å¿…é¡»æŒæ¡çš„ã€‚ç†è§£volatileå…³é”®å­—çš„ä½œç”¨çš„å‰ææ˜¯è¦ç†è§£Javaå†…å­˜æ¨¡å‹ï¼Œè¿™é‡Œå°±ä¸è®²Javaå†…å­˜æ¨¡å‹äº†ï¼Œå¯ä»¥å‚è§ç¬¬31ç‚¹ï¼Œvolatileå…³é”®å­—çš„ä½œç”¨ä¸»è¦æœ‰ä¸¤ä¸ªï¼š</p><p>ï¼ˆ1ï¼‰å¤šçº¿ç¨‹ä¸»è¦å›´ç»•å¯è§æ€§å’ŒåŸå­æ€§ä¸¤ä¸ªç‰¹æ€§è€Œå±•å¼€ï¼Œä½¿ç”¨volatileå…³é”®å­—ä¿®é¥°çš„å˜é‡ï¼Œä¿è¯äº†å…¶åœ¨å¤šçº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§ï¼Œå³æ¯æ¬¡è¯»å–åˆ°volatileå˜é‡ï¼Œä¸€å®šæ˜¯æœ€æ–°çš„æ•°æ®</p><p>ï¼ˆ2ï¼‰ä»£ç åº•å±‚æ‰§è¡Œä¸åƒæˆ‘ä»¬çœ‹åˆ°çš„é«˜çº§è¯­è¨€â€”-Javaç¨‹åºè¿™ä¹ˆç®€å•ï¼Œå®ƒçš„æ‰§è¡Œæ˜¯Javaä»£ç â€“&gt;å­—èŠ‚ç â€“&gt;æ ¹æ®å­—èŠ‚ç æ‰§è¡Œå¯¹åº”çš„C/Cä»£ç â€“&gt;C/Cä»£ç è¢«ç¼–è¯‘æˆæ±‡ç¼–è¯­è¨€â€“&gt;å’Œç¡¬ä»¶ç”µè·¯äº¤äº’ï¼Œç°å®ä¸­ï¼Œä¸ºäº†è·å–æ›´å¥½çš„æ€§èƒ½JVMå¯èƒ½ä¼šå¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’åºï¼Œå¤šçº¿ç¨‹ä¸‹å¯èƒ½ä¼šå‡ºç°ä¸€äº›æ„æƒ³ä¸åˆ°çš„é—®é¢˜ã€‚ä½¿ç”¨volatileåˆ™ä¼šå¯¹ç¦æ­¢è¯­ä¹‰é‡æ’åºï¼Œå½“ç„¶è¿™ä¹Ÿä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†ä»£ç æ‰§è¡Œæ•ˆç‡</p><p>ä»å®è·µè§’åº¦è€Œè¨€ï¼Œvolatileçš„ä¸€ä¸ªé‡è¦ä½œç”¨å°±æ˜¯å’ŒCASç»“åˆï¼Œä¿è¯äº†åŸå­æ€§ï¼Œè¯¦ç»†çš„å¯ä»¥å‚è§java.util.concurrent.atomicåŒ…ä¸‹çš„ç±»ï¼Œæ¯”å¦‚AtomicIntegerã€‚</p><p>7ã€ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨ åˆæ˜¯ä¸€ä¸ªç†è®ºçš„é—®é¢˜ï¼Œå„å¼å„æ ·çš„ç­”æ¡ˆæœ‰å¾ˆå¤šï¼Œæˆ‘ç»™å‡ºä¸€ä¸ªä¸ªäººè®¤ä¸ºè§£é‡Šåœ°æœ€å¥½çš„ï¼šå¦‚æœä½ çš„ä»£ç åœ¨å¤šçº¿ç¨‹ä¸‹æ‰§è¡Œå’Œåœ¨å•çº¿ç¨‹ä¸‹æ‰§è¡Œæ°¸è¿œéƒ½èƒ½è·å¾—ä¸€æ ·çš„ç»“æœï¼Œé‚£ä¹ˆä½ çš„ä»£ç å°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><p>è¿™ä¸ªé—®é¢˜æœ‰å€¼å¾—ä¸€æçš„åœ°æ–¹ï¼Œå°±æ˜¯çº¿ç¨‹å®‰å…¨ä¹Ÿæ˜¯æœ‰å‡ ä¸ªçº§åˆ«çš„ï¼š</p><p>ï¼ˆ1ï¼‰ä¸å¯å˜</p><p>åƒStringã€Integerã€Longè¿™äº›ï¼Œéƒ½æ˜¯finalç±»å‹çš„ç±»ï¼Œä»»ä½•ä¸€ä¸ªçº¿ç¨‹éƒ½æ”¹å˜ä¸äº†å®ƒä»¬çš„å€¼ï¼Œè¦æ”¹å˜é™¤éæ–°åˆ›å»ºä¸€ä¸ªï¼Œå› æ­¤è¿™äº›ä¸å¯å˜å¯¹è±¡ä¸éœ€è¦ä»»ä½•åŒæ­¥æ‰‹æ®µå°±å¯ä»¥ç›´æ¥åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä½¿ç”¨</p><p>ï¼ˆ2ï¼‰ç»å¯¹çº¿ç¨‹å®‰å…¨</p><p>ä¸ç®¡è¿è¡Œæ—¶ç¯å¢ƒå¦‚ä½•ï¼Œè°ƒç”¨è€…éƒ½ä¸éœ€è¦é¢å¤–çš„åŒæ­¥æªæ–½ã€‚è¦åšåˆ°è¿™ä¸€ç‚¹é€šå¸¸éœ€è¦ä»˜å‡ºè®¸å¤šé¢å¤–çš„ä»£ä»·ï¼ŒJavaä¸­æ ‡æ³¨è‡ªå·±æ˜¯çº¿ç¨‹å®‰å…¨çš„ç±»ï¼Œå®é™…ä¸Šç»å¤§å¤šæ•°éƒ½ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¸è¿‡ç»å¯¹çº¿ç¨‹å®‰å…¨çš„ç±»ï¼ŒJavaä¸­ä¹Ÿæœ‰ï¼Œæ¯”æ–¹è¯´CopyOnWriteArrayListã€CopyOnWriteArraySet</p><p>ï¼ˆ3ï¼‰ç›¸å¯¹çº¿ç¨‹å®‰å…¨</p><p>ç›¸å¯¹çº¿ç¨‹å®‰å…¨ä¹Ÿå°±æ˜¯æˆ‘ä»¬é€šå¸¸æ„ä¹‰ä¸Šæ‰€è¯´çš„çº¿ç¨‹å®‰å…¨ï¼ŒåƒVectorè¿™ç§ï¼Œaddã€removeæ–¹æ³•éƒ½æ˜¯åŸå­æ“ä½œï¼Œä¸ä¼šè¢«æ‰“æ–­ï¼Œä½†ä¹Ÿä»…é™äºæ­¤ï¼Œå¦‚æœæœ‰ä¸ªçº¿ç¨‹åœ¨éå†æŸä¸ªVectorã€æœ‰ä¸ªçº¿ç¨‹åŒæ—¶åœ¨addè¿™ä¸ªVectorï¼Œ99%çš„æƒ…å†µä¸‹éƒ½ä¼šå‡ºç°ConcurrentModificationExceptionï¼Œä¹Ÿå°±æ˜¯fail-fastæœºåˆ¶ã€‚</p><p>ï¼ˆ4ï¼‰çº¿ç¨‹éå®‰å…¨</p><p>è¿™ä¸ªå°±æ²¡ä»€ä¹ˆå¥½è¯´çš„äº†ï¼ŒArrayListã€LinkedListã€HashMapç­‰éƒ½æ˜¯çº¿ç¨‹éå®‰å…¨çš„ç±»</p><p>8ã€Javaä¸­å¦‚ä½•è·å–åˆ°çº¿ç¨‹dumpæ–‡ä»¶</p><p>æ­»å¾ªç¯ã€æ­»é”ã€é˜»å¡ã€é¡µé¢æ‰“å¼€æ…¢ç­‰é—®é¢˜ï¼Œæ‰“çº¿ç¨‹dumpæ˜¯æœ€å¥½çš„è§£å†³é—®é¢˜çš„é€”å¾„ã€‚æ‰€è°“çº¿ç¨‹dumpä¹Ÿå°±æ˜¯çº¿ç¨‹å †æ ˆï¼Œè·å–åˆ°çº¿ç¨‹å †æ ˆæœ‰ä¸¤æ­¥ï¼š</p><p>ï¼ˆ1ï¼‰è·å–åˆ°çº¿ç¨‹çš„pidï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨jpså‘½ä»¤ï¼Œåœ¨Linuxç¯å¢ƒä¸‹è¿˜å¯ä»¥ä½¿ç”¨ps -ef | grep java</p><p>ï¼ˆ2ï¼‰æ‰“å°çº¿ç¨‹å †æ ˆï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨jstack pidå‘½ä»¤ï¼Œåœ¨Linuxç¯å¢ƒä¸‹è¿˜å¯ä»¥ä½¿ç”¨kill -3 pid</p><p>å¦å¤–æä¸€ç‚¹ï¼ŒThreadç±»æä¾›äº†ä¸€ä¸ªgetStackTrace()æ–¹æ³•ä¹Ÿå¯ä»¥ç”¨äºè·å–çº¿ç¨‹å †æ ˆã€‚è¿™æ˜¯ä¸€ä¸ªå®ä¾‹æ–¹æ³•ï¼Œå› æ­¤æ­¤æ–¹æ³•æ˜¯å’Œå…·ä½“çº¿ç¨‹å®ä¾‹ç»‘å®šçš„ï¼Œæ¯æ¬¡è·å–è·å–åˆ°çš„æ˜¯å…·ä½“æŸä¸ªçº¿ç¨‹å½“å‰è¿è¡Œçš„å †æ ˆï¼Œ</p><p>9ã€ä¸€ä¸ªçº¿ç¨‹å¦‚æœå‡ºç°äº†è¿è¡Œæ—¶å¼‚å¸¸ä¼šæ€ä¹ˆæ ·</p><p>å¦‚æœè¿™ä¸ªå¼‚å¸¸æ²¡æœ‰è¢«æ•è·çš„è¯ï¼Œè¿™ä¸ªçº¿ç¨‹å°±åœæ­¢æ‰§è¡Œäº†ã€‚å¦å¤–é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼šå¦‚æœè¿™ä¸ªçº¿ç¨‹æŒæœ‰æŸä¸ªæŸä¸ªå¯¹è±¡çš„ç›‘è§†å™¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡ç›‘è§†å™¨ä¼šè¢«ç«‹å³é‡Šæ”¾</p><p>10ã€å¦‚ä½•åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´å…±äº«æ•°æ®</p><p>é€šè¿‡åœ¨çº¿ç¨‹ä¹‹é—´å…±äº«å¯¹è±¡å°±å¯ä»¥äº†ï¼Œç„¶åé€šè¿‡wait/notify/notifyAllã€await/signal/signalAllè¿›è¡Œå”¤èµ·å’Œç­‰å¾…ï¼Œæ¯”æ–¹è¯´é˜»å¡é˜Ÿåˆ—BlockingQueueå°±æ˜¯ä¸ºçº¿ç¨‹ä¹‹é—´å…±äº«æ•°æ®è€Œè®¾è®¡çš„</p><p>11ã€sleepæ–¹æ³•å’Œwaitæ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«</p><p>è¿™ä¸ªé—®é¢˜å¸¸é—®ï¼Œsleepæ–¹æ³•å’Œwaitæ–¹æ³•éƒ½å¯ä»¥ç”¨æ¥æ”¾å¼ƒCPUä¸€å®šçš„æ—¶é—´ï¼Œä¸åŒç‚¹åœ¨äºå¦‚æœçº¿ç¨‹æŒæœ‰æŸä¸ªå¯¹è±¡çš„ç›‘è§†å™¨ï¼Œsleepæ–¹æ³•ä¸ä¼šæ”¾å¼ƒè¿™ä¸ªå¯¹è±¡çš„ç›‘è§†å™¨ï¼Œwaitæ–¹æ³•ä¼šæ”¾å¼ƒè¿™ä¸ªå¯¹è±¡çš„ç›‘è§†å™¨</p><p>12ã€ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹çš„ä½œç”¨æ˜¯ä»€ä¹ˆ</p><p>è¿™ä¸ªé—®é¢˜å¾ˆç†è®ºï¼Œä½†æ˜¯å¾ˆé‡è¦ï¼š</p><p>ï¼ˆ1ï¼‰é€šè¿‡å¹³è¡¡ç”Ÿäº§è€…çš„ç”Ÿäº§èƒ½åŠ›å’Œæ¶ˆè´¹è€…çš„æ¶ˆè´¹èƒ½åŠ›æ¥æå‡æ•´ä¸ªç³»ç»Ÿçš„è¿è¡Œæ•ˆç‡ï¼Œè¿™æ˜¯ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹æœ€é‡è¦çš„ä½œç”¨ ï¼ˆ2ï¼‰è§£è€¦ï¼Œè¿™æ˜¯ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹é™„å¸¦çš„ä½œç”¨ï¼Œè§£è€¦æ„å‘³ç€ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´çš„è”ç³»å°‘ï¼Œè”ç³»è¶Šå°‘è¶Šå¯ä»¥ç‹¬è‡ªå‘å±•è€Œä¸éœ€è¦æ”¶åˆ°ç›¸äº’çš„åˆ¶çº¦</p><p>13ã€ThreadLocalæœ‰ä»€ä¹ˆç”¨</p><p>ç®€å•è¯´ThreadLocalå°±æ˜¯ä¸€ç§ä»¥ç©ºé—´æ¢æ—¶é—´çš„åšæ³•ï¼Œåœ¨æ¯ä¸ªThreadé‡Œé¢ç»´æŠ¤äº†ä¸€ä¸ªä»¥å¼€åœ°å€æ³•å®ç°çš„ThreadLocal.ThreadLocalMapï¼ŒæŠŠæ•°æ®è¿›è¡Œéš”ç¦»ï¼Œæ•°æ®ä¸å…±äº«ï¼Œè‡ªç„¶å°±æ²¡æœ‰çº¿ç¨‹å®‰å…¨æ–¹é¢çš„é—®é¢˜äº†</p><p>14ã€ä¸ºä»€ä¹ˆwait()æ–¹æ³•å’Œnotify()/notifyAll()æ–¹æ³•è¦åœ¨åŒæ­¥å—ä¸­è¢«è°ƒç”¨</p><p>è¿™æ˜¯JDKå¼ºåˆ¶çš„ï¼Œwait()æ–¹æ³•å’Œnotify()/notifyAll()æ–¹æ³•åœ¨è°ƒç”¨å‰éƒ½å¿…é¡»å…ˆè·å¾—å¯¹è±¡çš„é”</p><p>15ã€wait()æ–¹æ³•å’Œnotify()/notifyAll()æ–¹æ³•åœ¨æ”¾å¼ƒå¯¹è±¡ç›‘è§†å™¨æ—¶æœ‰ä»€ä¹ˆåŒºåˆ«</p><p>wait()æ–¹æ³•å’Œnotify()/notifyAll()æ–¹æ³•åœ¨æ”¾å¼ƒå¯¹è±¡ç›‘è§†å™¨çš„æ—¶å€™çš„åŒºåˆ«åœ¨äºï¼šwait()æ–¹æ³•ç«‹å³é‡Šæ”¾å¯¹è±¡ç›‘è§†å™¨ï¼Œnotify()/notifyAll()æ–¹æ³•åˆ™ä¼šç­‰å¾…çº¿ç¨‹å‰©ä½™ä»£ç æ‰§è¡Œå®Œæ¯•æ‰ä¼šæ”¾å¼ƒå¯¹è±¡ç›‘è§†å™¨ã€‚</p><p>16ã€ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± </p><p>é¿å…é¢‘ç¹åœ°åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ï¼Œè¾¾åˆ°çº¿ç¨‹å¯¹è±¡çš„é‡ç”¨ã€‚å¦å¤–ï¼Œä½¿ç”¨çº¿ç¨‹æ± è¿˜å¯ä»¥æ ¹æ®é¡¹ç›®çµæ´»åœ°æ§åˆ¶å¹¶å‘çš„æ•°ç›®ã€‚</p><p>17ã€æ€ä¹ˆæ£€æµ‹ä¸€ä¸ªçº¿ç¨‹æ˜¯å¦æŒæœ‰å¯¹è±¡ç›‘è§†å™¨</p><p>æˆ‘ä¹Ÿæ˜¯åœ¨ç½‘ä¸Šçœ‹åˆ°ä¸€é“å¤šçº¿ç¨‹é¢è¯•é¢˜æ‰çŸ¥é“æœ‰æ–¹æ³•å¯ä»¥åˆ¤æ–­æŸä¸ªçº¿ç¨‹æ˜¯å¦æŒæœ‰å¯¹è±¡ç›‘è§†å™¨ï¼šThreadç±»æä¾›äº†ä¸€ä¸ªholdsLock(Object obj)æ–¹æ³•ï¼Œå½“ä¸”ä»…å½“å¯¹è±¡objçš„ç›‘è§†å™¨è¢«æŸæ¡çº¿ç¨‹æŒæœ‰çš„æ—¶å€™æ‰ä¼šè¿”å›trueï¼Œæ³¨æ„è¿™æ˜¯ä¸€ä¸ªstaticæ–¹æ³•ï¼Œè¿™æ„å‘³ç€â€œæŸæ¡çº¿ç¨‹â€æŒ‡çš„æ˜¯å½“å‰çº¿ç¨‹ã€‚</p><p>18ã€synchronizedå’ŒReentrantLockçš„åŒºåˆ«</p><p>synchronizedæ˜¯å’Œifã€elseã€forã€whileä¸€æ ·çš„å…³é”®å­—ï¼ŒReentrantLockæ˜¯ç±»ï¼Œè¿™æ˜¯äºŒè€…çš„æœ¬è´¨åŒºåˆ«ã€‚æ—¢ç„¶ReentrantLockæ˜¯ç±»ï¼Œé‚£ä¹ˆå®ƒå°±æä¾›äº†æ¯”synchronizedæ›´å¤šæ›´çµæ´»çš„ç‰¹æ€§ï¼Œå¯ä»¥è¢«ç»§æ‰¿ã€å¯ä»¥æœ‰æ–¹æ³•ã€å¯ä»¥æœ‰å„ç§å„æ ·çš„ç±»å˜é‡ï¼ŒReentrantLockæ¯”synchronizedçš„æ‰©å±•æ€§ä½“ç°åœ¨å‡ ç‚¹ä¸Šï¼š</p><p>ï¼ˆ1ï¼‰ReentrantLockå¯ä»¥å¯¹è·å–é”çš„ç­‰å¾…æ—¶é—´è¿›è¡Œè®¾ç½®ï¼Œè¿™æ ·å°±é¿å…äº†æ­»é”</p><p>ï¼ˆ2ï¼‰ReentrantLockå¯ä»¥è·å–å„ç§é”çš„ä¿¡æ¯</p><p>ï¼ˆ3ï¼‰ReentrantLockå¯ä»¥çµæ´»åœ°å®ç°å¤šè·¯é€šçŸ¥</p><p>å¦å¤–ï¼ŒäºŒè€…çš„é”æœºåˆ¶å…¶å®ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ã€‚ReentrantLockåº•å±‚è°ƒç”¨çš„æ˜¯Unsafeçš„parkæ–¹æ³•åŠ é”ï¼Œsynchronizedæ“ä½œçš„åº”è¯¥æ˜¯å¯¹è±¡å¤´ä¸­mark wordï¼Œè¿™ç‚¹æˆ‘ä¸èƒ½ç¡®å®šã€‚</p><p>19ã€ConcurrentHashMapçš„å¹¶å‘åº¦æ˜¯ä»€ä¹ˆ</p><p>ConcurrentHashMapçš„å¹¶å‘åº¦å°±æ˜¯segmentçš„å¤§å°ï¼Œé»˜è®¤ä¸º16ï¼Œè¿™æ„å‘³ç€æœ€å¤šåŒæ—¶å¯ä»¥æœ‰16æ¡çº¿ç¨‹æ“ä½œConcurrentHashMapï¼Œè¿™ä¹Ÿæ˜¯ConcurrentHashMapå¯¹Hashtableçš„æœ€å¤§ä¼˜åŠ¿ï¼Œä»»ä½•æƒ…å†µä¸‹ï¼ŒHashtableèƒ½åŒæ—¶æœ‰ä¸¤æ¡çº¿ç¨‹è·å–Hashtableä¸­çš„æ•°æ®å—ï¼Ÿ</p><p>20ã€ReadWriteLockæ˜¯ä»€ä¹ˆ é¦–å…ˆæ˜ç¡®ä¸€ä¸‹ï¼Œä¸æ˜¯è¯´ReentrantLockä¸å¥½ï¼Œåªæ˜¯ReentrantLockæŸäº›æ—¶å€™æœ‰å±€é™ã€‚å¦‚æœä½¿ç”¨ReentrantLockï¼Œå¯èƒ½æœ¬èº«æ˜¯ä¸ºäº†é˜²æ­¢çº¿ç¨‹Aåœ¨å†™æ•°æ®ã€çº¿ç¨‹Båœ¨è¯»æ•°æ®é€ æˆçš„æ•°æ®ä¸ä¸€è‡´ï¼Œä½†è¿™æ ·ï¼Œå¦‚æœçº¿ç¨‹Cåœ¨è¯»æ•°æ®ã€çº¿ç¨‹Dä¹Ÿåœ¨è¯»æ•°æ®ï¼Œè¯»æ•°æ®æ˜¯ä¸ä¼šæ”¹å˜æ•°æ®çš„ï¼Œæ²¡æœ‰å¿…è¦åŠ é”ï¼Œä½†æ˜¯è¿˜æ˜¯åŠ é”äº†ï¼Œé™ä½äº†ç¨‹åºçš„æ€§èƒ½ã€‚</p><p>å› ä¸ºè¿™ä¸ªï¼Œæ‰è¯ç”Ÿäº†è¯»å†™é”ReadWriteLockã€‚ReadWriteLockæ˜¯ä¸€ä¸ªè¯»å†™é”æ¥å£ï¼ŒReentrantReadWriteLockæ˜¯ReadWriteLockæ¥å£çš„ä¸€ä¸ªå…·ä½“å®ç°ï¼Œå®ç°äº†è¯»å†™çš„åˆ†ç¦»ï¼Œè¯»é”æ˜¯å…±äº«çš„ï¼Œå†™é”æ˜¯ç‹¬å çš„ï¼Œè¯»å’Œè¯»ä¹‹é—´ä¸ä¼šäº’æ–¥ï¼Œè¯»å’Œå†™ã€å†™å’Œè¯»ã€å†™å’Œå†™ä¹‹é—´æ‰ä¼šäº’æ–¥ï¼Œæå‡äº†è¯»å†™çš„æ€§èƒ½ã€‚</p><p>21ã€FutureTaskæ˜¯ä»€ä¹ˆ</p><p>è¿™ä¸ªå…¶å®å‰é¢æœ‰æåˆ°è¿‡ï¼ŒFutureTaskè¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥è¿ç®—çš„ä»»åŠ¡ã€‚FutureTaské‡Œé¢å¯ä»¥ä¼ å…¥ä¸€ä¸ªCallableçš„å…·ä½“å®ç°ç±»ï¼Œå¯ä»¥å¯¹è¿™ä¸ªå¼‚æ­¥è¿ç®—çš„ä»»åŠ¡çš„ç»“æœè¿›è¡Œç­‰å¾…è·å–ã€åˆ¤æ–­æ˜¯å¦å·²ç»å®Œæˆã€å–æ¶ˆä»»åŠ¡ç­‰æ“ä½œã€‚å½“ç„¶ï¼Œç”±äºFutureTaskä¹Ÿæ˜¯Runnableæ¥å£çš„å®ç°ç±»ï¼Œæ‰€ä»¥FutureTaskä¹Ÿå¯ä»¥æ”¾å…¥çº¿ç¨‹æ± ä¸­ã€‚</p><p>22ã€Linuxç¯å¢ƒä¸‹å¦‚ä½•æŸ¥æ‰¾å“ªä¸ªçº¿ç¨‹ä½¿ç”¨CPUæœ€é•¿ â€˜</p><p>è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒåå®è·µçš„é—®é¢˜ï¼Œè¿™ç§é—®é¢˜æˆ‘è§‰å¾—æŒºæœ‰æ„ä¹‰çš„ã€‚å¯ä»¥è¿™ä¹ˆåšï¼š</p><p>ï¼ˆ1ï¼‰è·å–é¡¹ç›®çš„pidï¼Œjpsæˆ–è€…ps -ef | grep javaï¼Œè¿™ä¸ªå‰é¢æœ‰è®²è¿‡</p><p>ï¼ˆ2ï¼‰top -H -p pidï¼Œé¡ºåºä¸èƒ½æ”¹å˜</p><p>è¿™æ ·å°±å¯ä»¥æ‰“å°å‡ºå½“å‰çš„é¡¹ç›®ï¼Œæ¯æ¡çº¿ç¨‹å ç”¨CPUæ—¶é—´çš„ç™¾åˆ†æ¯”ã€‚æ³¨æ„è¿™é‡Œæ‰“å‡ºçš„æ˜¯LWPï¼Œä¹Ÿå°±æ˜¯æ“ä½œç³»ç»ŸåŸç”Ÿçº¿ç¨‹çš„çº¿ç¨‹å·ï¼Œæˆ‘ç¬”è®°æœ¬å±±æ²¡æœ‰éƒ¨ç½²Linuxç¯å¢ƒä¸‹çš„Javaå·¥ç¨‹ï¼Œå› æ­¤æ²¡æœ‰åŠæ³•æˆªå›¾æ¼”ç¤ºï¼Œç½‘å‹æœ‹å‹ä»¬å¦‚æœå…¬å¸æ˜¯ä½¿ç”¨Linuxç¯å¢ƒéƒ¨ç½²é¡¹ç›®çš„è¯ï¼Œå¯ä»¥å°è¯•ä¸€ä¸‹ã€‚</p><p>ä½¿ç”¨â€top -H -p pidâ€+â€jps pidâ€å¯ä»¥å¾ˆå®¹æ˜“åœ°æ‰¾åˆ°æŸæ¡å ç”¨CPUé«˜çš„çº¿ç¨‹çš„çº¿ç¨‹å †æ ˆï¼Œä»è€Œå®šä½å ç”¨CPUé«˜çš„åŸå› ï¼Œä¸€èˆ¬æ˜¯å› ä¸ºä¸å½“çš„ä»£ç æ“ä½œå¯¼è‡´äº†æ­»å¾ªç¯ã€‚</p><p>æœ€åæä¸€ç‚¹ï¼Œâ€top -H -p pidâ€æ‰“å‡ºæ¥çš„LWPæ˜¯åè¿›åˆ¶çš„ï¼Œâ€jps pidâ€æ‰“å‡ºæ¥çš„æœ¬åœ°çº¿ç¨‹å·æ˜¯åå…­è¿›åˆ¶çš„ï¼Œè½¬æ¢ä¸€ä¸‹ï¼Œå°±èƒ½å®šä½åˆ°å ç”¨CPUé«˜çš„çº¿ç¨‹çš„å½“å‰çº¿ç¨‹å †æ ˆäº†ã€‚</p><p>23ã€Javaç¼–ç¨‹å†™ä¸€ä¸ªä¼šå¯¼è‡´æ­»é”çš„ç¨‹åº</p><p>ç¬¬ä¸€æ¬¡çœ‹åˆ°è¿™ä¸ªé¢˜ç›®ï¼Œè§‰å¾—è¿™æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„é—®é¢˜ã€‚å¾ˆå¤šäººéƒ½çŸ¥é“æ­»é”æ˜¯æ€ä¹ˆä¸€å›äº‹å„¿ï¼šçº¿ç¨‹Aå’Œçº¿ç¨‹Bç›¸äº’ç­‰å¾…å¯¹æ–¹æŒæœ‰çš„é”å¯¼è‡´ç¨‹åºæ— é™æ­»å¾ªç¯ä¸‹å»ã€‚å½“ç„¶ä¹Ÿä»…é™äºæ­¤äº†ï¼Œé—®ä¸€ä¸‹æ€ä¹ˆå†™ä¸€ä¸ªæ­»é”çš„ç¨‹åºå°±ä¸çŸ¥é“äº†ï¼Œè¿™ç§æƒ…å†µè¯´ç™½äº†å°±æ˜¯ä¸æ‡‚ä»€ä¹ˆæ˜¯æ­»é”ï¼Œæ‡‚ä¸€ä¸ªç†è®ºå°±å®Œäº‹å„¿äº†ï¼Œå®è·µä¸­ç¢°åˆ°æ­»é”çš„é—®é¢˜åŸºæœ¬ä¸Šæ˜¯çœ‹ä¸å‡ºæ¥çš„ã€‚</p><p>çœŸæ­£ç†è§£ä»€ä¹ˆæ˜¯æ­»é”ï¼Œè¿™ä¸ªé—®é¢˜å…¶å®ä¸éš¾ï¼Œå‡ ä¸ªæ­¥éª¤ï¼š</p><p>ï¼ˆ1ï¼‰ä¸¤ä¸ªçº¿ç¨‹é‡Œé¢åˆ†åˆ«æŒæœ‰ä¸¤ä¸ªObjectå¯¹è±¡ï¼šlock1å’Œlock2ã€‚è¿™ä¸¤ä¸ªlockä½œä¸ºåŒæ­¥ä»£ç å—çš„é”ï¼›</p><p>ï¼ˆ2ï¼‰çº¿ç¨‹1çš„run()æ–¹æ³•ä¸­åŒæ­¥ä»£ç å—å…ˆè·å–lock1çš„å¯¹è±¡é”ï¼ŒThread.sleep(xxx)ï¼Œæ—¶é—´ä¸éœ€è¦å¤ªå¤šï¼Œ50æ¯«ç§’å·®ä¸å¤šäº†ï¼Œç„¶åæ¥ç€è·å–lock2çš„å¯¹è±¡é”ã€‚è¿™ä¹ˆåšä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢çº¿ç¨‹1å¯åŠ¨ä¸€ä¸‹å­å°±è¿ç»­è·å¾—äº†lock1å’Œlock2ä¸¤ä¸ªå¯¹è±¡çš„å¯¹è±¡é”</p><p>ï¼ˆ3ï¼‰çº¿ç¨‹2çš„run)(æ–¹æ³•ä¸­åŒæ­¥ä»£ç å—å…ˆè·å–lock2çš„å¯¹è±¡é”ï¼Œæ¥ç€è·å–lock1çš„å¯¹è±¡é”ï¼Œå½“ç„¶è¿™æ—¶lock1çš„å¯¹è±¡é”å·²ç»è¢«çº¿ç¨‹1é”æŒæœ‰ï¼Œçº¿ç¨‹2è‚¯å®šæ˜¯è¦ç­‰å¾…çº¿ç¨‹1é‡Šæ”¾lock1çš„å¯¹è±¡é”çš„</p><p>è¿™æ ·ï¼Œçº¿ç¨‹1â€³ç¡è§‰â€ç¡å®Œï¼Œçº¿ç¨‹2å·²ç»è·å–äº†lock2çš„å¯¹è±¡é”äº†ï¼Œçº¿ç¨‹1æ­¤æ—¶å°è¯•è·å–lock2çš„å¯¹è±¡é”ï¼Œä¾¿è¢«é˜»å¡ï¼Œæ­¤æ—¶ä¸€ä¸ªæ­»é”å°±å½¢æˆäº†ã€‚ä»£ç å°±ä¸å†™äº†ï¼Œå çš„ç¯‡å¹…æœ‰ç‚¹å¤šï¼ŒJavaå¤šçº¿ç¨‹ï¼šæ­»é”è¿™ç¯‡æ–‡ç« é‡Œé¢æœ‰ï¼Œå°±æ˜¯ä¸Šé¢æ­¥éª¤çš„ä»£ç å®ç°ã€‚</p><p>24ã€æ€ä¹ˆå”¤é†’ä¸€ä¸ªé˜»å¡çš„çº¿ç¨‹</p><p>å¦‚æœçº¿ç¨‹æ˜¯å› ä¸ºè°ƒç”¨äº†wait()ã€sleep()æˆ–è€…join()æ–¹æ³•è€Œå¯¼è‡´çš„é˜»å¡ï¼Œå¯ä»¥ä¸­æ–­çº¿ç¨‹ï¼Œå¹¶ä¸”é€šè¿‡æŠ›å‡ºInterruptedExceptionæ¥å”¤é†’å®ƒï¼›å¦‚æœçº¿ç¨‹é‡åˆ°äº†IOé˜»å¡ï¼Œæ— èƒ½ä¸ºåŠ›ï¼Œå› ä¸ºIOæ˜¯æ“ä½œç³»ç»Ÿå®ç°çš„ï¼ŒJavaä»£ç å¹¶æ²¡æœ‰åŠæ³•ç›´æ¥æ¥è§¦åˆ°æ“ä½œç³»ç»Ÿã€‚</p><p>25ã€ä¸å¯å˜å¯¹è±¡å¯¹å¤šçº¿ç¨‹æœ‰ä»€ä¹ˆå¸®åŠ©</p><p>å‰é¢æœ‰æåˆ°è¿‡çš„ä¸€ä¸ªé—®é¢˜ï¼Œä¸å¯å˜å¯¹è±¡ä¿è¯äº†å¯¹è±¡çš„å†…å­˜å¯è§æ€§ï¼Œå¯¹ä¸å¯å˜å¯¹è±¡çš„è¯»å–ä¸éœ€è¦è¿›è¡Œé¢å¤–çš„åŒæ­¥æ‰‹æ®µï¼Œæå‡äº†ä»£ç æ‰§è¡Œæ•ˆç‡ã€‚</p><p>26ã€ä»€ä¹ˆæ˜¯å¤šçº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢</p><p>å¤šçº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯æŒ‡CPUæ§åˆ¶æƒç”±ä¸€ä¸ªå·²ç»æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹åˆ‡æ¢åˆ°å¦å¤–ä¸€ä¸ªå°±ç»ªå¹¶ç­‰å¾…è·å–CPUæ‰§è¡Œæƒçš„çº¿ç¨‹çš„è¿‡ç¨‹ã€‚</p><p>27ã€å¦‚æœä½ æäº¤ä»»åŠ¡æ—¶ï¼Œçº¿ç¨‹æ± é˜Ÿåˆ—å·²æ»¡ï¼Œè¿™æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆ</p><p>å¦‚æœä½ ä½¿ç”¨çš„LinkedBlockingQueueï¼Œä¹Ÿå°±æ˜¯æ— ç•Œé˜Ÿåˆ—çš„è¯ï¼Œæ²¡å…³ç³»ï¼Œç»§ç»­æ·»åŠ ä»»åŠ¡åˆ°é˜»å¡é˜Ÿåˆ—ä¸­ç­‰å¾…æ‰§è¡Œï¼Œå› ä¸ºLinkedBlockingQueueå¯ä»¥è¿‘ä¹è®¤ä¸ºæ˜¯ä¸€ä¸ªæ— ç©·å¤§çš„é˜Ÿåˆ—ï¼Œå¯ä»¥æ— é™å­˜æ”¾ä»»åŠ¡ï¼›å¦‚æœä½ ä½¿ç”¨çš„æ˜¯æœ‰ç•Œé˜Ÿåˆ—æ¯”æ–¹è¯´ArrayBlockingQueueçš„è¯ï¼Œä»»åŠ¡é¦–å…ˆä¼šè¢«æ·»åŠ åˆ°ArrayBlockingQueueä¸­ï¼ŒArrayBlockingQueueæ»¡äº†ï¼Œåˆ™ä¼šä½¿ç”¨æ‹’ç»ç­–ç•¥RejectedExecutionHandlerå¤„ç†æ»¡äº†çš„ä»»åŠ¡ï¼Œé»˜è®¤æ˜¯AbortPolicyã€‚</p><p>28ã€Javaä¸­ç”¨åˆ°çš„çº¿ç¨‹è°ƒåº¦ç®—æ³•æ˜¯ä»€ä¹ˆ</p><p>æŠ¢å å¼ã€‚ä¸€ä¸ªçº¿ç¨‹ç”¨å®ŒCPUä¹‹åï¼Œæ“ä½œç³»ç»Ÿä¼šæ ¹æ®çº¿ç¨‹ä¼˜å…ˆçº§ã€çº¿ç¨‹é¥¥é¥¿æƒ…å†µç­‰æ•°æ®ç®—å‡ºä¸€ä¸ªæ€»çš„ä¼˜å…ˆçº§å¹¶åˆ†é…ä¸‹ä¸€ä¸ªæ—¶é—´ç‰‡ç»™æŸä¸ªçº¿ç¨‹æ‰§è¡Œã€‚</p><p>29ã€Thread.sleep(0)çš„ä½œç”¨æ˜¯ä»€ä¹ˆ</p><p>è¿™ä¸ªé—®é¢˜å’Œä¸Šé¢é‚£ä¸ªé—®é¢˜æ˜¯ç›¸å…³çš„ï¼Œæˆ‘å°±è¿åœ¨ä¸€èµ·äº†ã€‚ç”±äºJavaé‡‡ç”¨æŠ¢å å¼çš„çº¿ç¨‹è°ƒåº¦ç®—æ³•ï¼Œå› æ­¤å¯èƒ½ä¼šå‡ºç°æŸæ¡çº¿ç¨‹å¸¸å¸¸è·å–åˆ°CPUæ§åˆ¶æƒçš„æƒ…å†µï¼Œä¸ºäº†è®©æŸäº›ä¼˜å…ˆçº§æ¯”è¾ƒä½çš„çº¿ç¨‹ä¹Ÿèƒ½è·å–åˆ°CPUæ§åˆ¶æƒï¼Œå¯ä»¥ä½¿ç”¨Thread.sleep(0)æ‰‹åŠ¨è§¦å‘ä¸€æ¬¡æ“ä½œç³»ç»Ÿåˆ†é…æ—¶é—´ç‰‡çš„æ“ä½œï¼Œè¿™ä¹Ÿæ˜¯å¹³è¡¡CPUæ§åˆ¶æƒçš„ä¸€ç§æ“ä½œã€‚</p><p>30ã€ä»€ä¹ˆæ˜¯è‡ªæ—‹</p><p>å¾ˆå¤šsynchronizedé‡Œé¢çš„ä»£ç åªæ˜¯ä¸€äº›å¾ˆç®€å•çš„ä»£ç ï¼Œæ‰§è¡Œæ—¶é—´éå¸¸å¿«ï¼Œæ­¤æ—¶ç­‰å¾…çš„çº¿ç¨‹éƒ½åŠ é”å¯èƒ½æ˜¯ä¸€ç§ä¸å¤ªå€¼å¾—çš„æ“ä½œï¼Œå› ä¸ºçº¿ç¨‹é˜»å¡æ¶‰åŠåˆ°ç”¨æˆ·æ€å’Œå†…æ ¸æ€åˆ‡æ¢çš„é—®é¢˜ã€‚æ—¢ç„¶synchronizedé‡Œé¢çš„ä»£ç æ‰§è¡Œåœ°éå¸¸å¿«ï¼Œä¸å¦¨è®©ç­‰å¾…é”çš„çº¿ç¨‹ä¸è¦è¢«é˜»å¡ï¼Œè€Œæ˜¯åœ¨synchronizedçš„è¾¹ç•Œåšå¿™å¾ªç¯ï¼Œè¿™å°±æ˜¯è‡ªæ—‹ã€‚å¦‚æœåšäº†å¤šæ¬¡å¿™å¾ªç¯å‘ç°è¿˜æ²¡æœ‰è·å¾—é”ï¼Œå†é˜»å¡ï¼Œè¿™æ ·å¯èƒ½æ˜¯ä¸€ç§æ›´å¥½çš„ç­–ç•¥ã€‚</p><p>31ã€ä»€ä¹ˆæ˜¯Javaå†…å­˜æ¨¡å‹</p><p>Javaå†…å­˜æ¨¡å‹å®šä¹‰äº†ä¸€ç§å¤šçº¿ç¨‹è®¿é—®Javaå†…å­˜çš„è§„èŒƒã€‚Javaå†…å­˜æ¨¡å‹è¦å®Œæ•´è®²ä¸æ˜¯è¿™é‡Œå‡ å¥è¯èƒ½è¯´æ¸…æ¥šçš„ï¼Œæˆ‘ç®€å•æ€»ç»“ä¸€ä¸‹Javaå†…å­˜æ¨¡å‹çš„å‡ éƒ¨åˆ†å†…å®¹ï¼š</p><p>ï¼ˆ1ï¼‰Javaå†…å­˜æ¨¡å‹å°†å†…å­˜åˆ†ä¸ºäº†ä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜ã€‚ç±»çš„çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯ç±»ä¹‹é—´å…±äº«çš„å˜é‡ï¼Œæ˜¯å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­çš„ï¼Œæ¯æ¬¡Javaçº¿ç¨‹ç”¨åˆ°è¿™äº›ä¸»å†…å­˜ä¸­çš„å˜é‡çš„æ—¶å€™ï¼Œä¼šè¯»ä¸€æ¬¡ä¸»å†…å­˜ä¸­çš„å˜é‡ï¼Œå¹¶è®©è¿™äº›å†…å­˜åœ¨è‡ªå·±çš„å·¥ä½œå†…å­˜ä¸­æœ‰ä¸€ä»½æ‹·è´ï¼Œè¿è¡Œè‡ªå·±çº¿ç¨‹ä»£ç çš„æ—¶å€™ï¼Œç”¨åˆ°è¿™äº›å˜é‡ï¼Œæ“ä½œçš„éƒ½æ˜¯è‡ªå·±å·¥ä½œå†…å­˜ä¸­çš„é‚£ä¸€ä»½ã€‚åœ¨çº¿ç¨‹ä»£ç æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œä¼šå°†æœ€æ–°çš„å€¼æ›´æ–°åˆ°ä¸»å†…å­˜ä¸­å»</p><p>ï¼ˆ2ï¼‰å®šä¹‰äº†å‡ ä¸ªåŸå­æ“ä½œï¼Œç”¨äºæ“ä½œä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜ä¸­çš„å˜é‡</p><p>ï¼ˆ3ï¼‰å®šä¹‰äº†volatileå˜é‡çš„ä½¿ç”¨è§„åˆ™</p><p>ï¼ˆ4ï¼‰happens-beforeï¼Œå³å…ˆè¡Œå‘ç”ŸåŸåˆ™ï¼Œå®šä¹‰äº†æ“ä½œAå¿…ç„¶å…ˆè¡Œå‘ç”Ÿäºæ“ä½œBçš„ä¸€äº›è§„åˆ™ï¼Œæ¯”å¦‚åœ¨åŒä¸€ä¸ªçº¿ç¨‹å†…æ§åˆ¶æµå‰é¢çš„ä»£ç ä¸€å®šå…ˆè¡Œå‘ç”Ÿäºæ§åˆ¶æµåé¢çš„ä»£ç ã€ä¸€ä¸ªé‡Šæ”¾é”unlockçš„åŠ¨ä½œä¸€å®šå…ˆè¡Œå‘ç”Ÿäºåé¢å¯¹äºåŒä¸€ä¸ªé”è¿›è¡Œé”å®šlockçš„åŠ¨ä½œç­‰ç­‰ï¼Œåªè¦ç¬¦åˆè¿™äº›è§„åˆ™ï¼Œåˆ™ä¸éœ€è¦é¢å¤–åšåŒæ­¥æªæ–½ï¼Œå¦‚æœæŸæ®µä»£ç ä¸ç¬¦åˆæ‰€æœ‰çš„happens-beforeè§„åˆ™ï¼Œåˆ™è¿™æ®µä»£ç ä¸€å®šæ˜¯çº¿ç¨‹éå®‰å…¨çš„</p><p>32ã€ä»€ä¹ˆæ˜¯CAS</p><p>CASï¼Œå…¨ç§°ä¸ºCompare and Setï¼Œå³æ¯”è¾ƒ-è®¾ç½®ã€‚å‡è®¾æœ‰ä¸‰ä¸ªæ“ä½œæ•°ï¼šå†…å­˜å€¼Vã€æ—§çš„é¢„æœŸå€¼Aã€è¦ä¿®æ”¹çš„å€¼Bï¼Œå½“ä¸”ä»…å½“é¢„æœŸå€¼Aå’Œå†…å­˜å€¼Vç›¸åŒæ—¶ï¼Œæ‰ä¼šå°†å†…å­˜å€¼ä¿®æ”¹ä¸ºBå¹¶è¿”å›trueï¼Œå¦åˆ™ä»€ä¹ˆéƒ½ä¸åšå¹¶è¿”å›falseã€‚å½“ç„¶CASä¸€å®šè¦volatileå˜é‡é…åˆï¼Œè¿™æ ·æ‰èƒ½ä¿è¯æ¯æ¬¡æ‹¿åˆ°çš„å˜é‡æ˜¯ä¸»å†…å­˜ä¸­æœ€æ–°çš„é‚£ä¸ªå€¼ï¼Œå¦åˆ™æ—§çš„é¢„æœŸå€¼Aå¯¹æŸæ¡çº¿ç¨‹æ¥è¯´ï¼Œæ°¸è¿œæ˜¯ä¸€ä¸ªä¸ä¼šå˜çš„å€¼Aï¼Œåªè¦æŸæ¬¡CASæ“ä½œå¤±è´¥ï¼Œæ°¸è¿œéƒ½ä¸å¯èƒ½æˆåŠŸã€‚</p><p>33ã€ä»€ä¹ˆæ˜¯ä¹è§‚é”å’Œæ‚²è§‚é”</p><p>ï¼ˆ1ï¼‰ä¹è§‚é”ï¼šå°±åƒå®ƒçš„åå­—ä¸€æ ·ï¼Œå¯¹äºå¹¶å‘é—´æ“ä½œäº§ç”Ÿçš„çº¿ç¨‹å®‰å…¨é—®é¢˜æŒä¹è§‚çŠ¶æ€ï¼Œä¹è§‚é”è®¤ä¸ºç«äº‰ä¸æ€»æ˜¯ä¼šå‘ç”Ÿï¼Œå› æ­¤å®ƒä¸éœ€è¦æŒæœ‰é”ï¼Œå°†æ¯”è¾ƒ-è®¾ç½®è¿™ä¸¤ä¸ªåŠ¨ä½œä½œä¸ºä¸€ä¸ªåŸå­æ“ä½œå°è¯•å»ä¿®æ”¹å†…å­˜ä¸­çš„å˜é‡ï¼Œå¦‚æœå¤±è´¥åˆ™è¡¨ç¤ºå‘ç”Ÿå†²çªï¼Œé‚£ä¹ˆå°±åº”è¯¥æœ‰ç›¸åº”çš„é‡è¯•é€»è¾‘ã€‚</p><p>ï¼ˆ2ï¼‰æ‚²è§‚é”ï¼šè¿˜æ˜¯åƒå®ƒçš„åå­—ä¸€æ ·ï¼Œå¯¹äºå¹¶å‘é—´æ“ä½œäº§ç”Ÿçš„çº¿ç¨‹å®‰å…¨é—®é¢˜æŒæ‚²è§‚çŠ¶æ€ï¼Œæ‚²è§‚é”è®¤ä¸ºç«äº‰æ€»æ˜¯ä¼šå‘ç”Ÿï¼Œå› æ­¤æ¯æ¬¡å¯¹æŸèµ„æºè¿›è¡Œæ“ä½œæ—¶ï¼Œéƒ½ä¼šæŒæœ‰ä¸€ä¸ªç‹¬å çš„é”ï¼Œå°±åƒsynchronizedï¼Œä¸ç®¡ä¸‰ä¸ƒäºŒåä¸€ï¼Œç›´æ¥ä¸Šäº†é”å°±æ“ä½œèµ„æºäº†ã€‚</p><p>34ã€ä»€ä¹ˆæ˜¯AQS</p><p>ç®€å•è¯´ä¸€ä¸‹AQSï¼ŒAQSå…¨ç§°ä¸ºAbstractQueuedSychronizerï¼Œç¿»è¯‘è¿‡æ¥åº”è¯¥æ˜¯æŠ½è±¡é˜Ÿåˆ—åŒæ­¥å™¨ã€‚</p><p>å¦‚æœè¯´java.util.concurrentçš„åŸºç¡€æ˜¯CASçš„è¯ï¼Œé‚£ä¹ˆAQSå°±æ˜¯æ•´ä¸ªJavaå¹¶å‘åŒ…çš„æ ¸å¿ƒäº†ï¼ŒReentrantLockã€CountDownLatchã€Semaphoreç­‰ç­‰éƒ½ç”¨åˆ°äº†å®ƒã€‚AQSå®é™…ä¸Šä»¥åŒå‘é˜Ÿåˆ—çš„å½¢å¼è¿æ¥æ‰€æœ‰çš„Entryï¼Œæ¯”æ–¹è¯´ReentrantLockï¼Œæ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹éƒ½è¢«æ”¾åœ¨ä¸€ä¸ªEntryä¸­å¹¶è¿æˆåŒå‘é˜Ÿåˆ—ï¼Œå‰é¢ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ReentrantLockå¥½äº†ï¼Œåˆ™åŒå‘é˜Ÿåˆ—å®é™…ä¸Šçš„ç¬¬ä¸€ä¸ªEntryå¼€å§‹è¿è¡Œã€‚</p><p>AQSå®šä¹‰äº†å¯¹åŒå‘é˜Ÿåˆ—æ‰€æœ‰çš„æ“ä½œï¼Œè€Œåªå¼€æ”¾äº†tryLockå’ŒtryReleaseæ–¹æ³•ç»™å¼€å‘è€…ä½¿ç”¨ï¼Œå¼€å‘è€…å¯ä»¥æ ¹æ®è‡ªå·±çš„å®ç°é‡å†™tryLockå’ŒtryReleaseæ–¹æ³•ï¼Œä»¥å®ç°è‡ªå·±çš„å¹¶å‘åŠŸèƒ½ã€‚</p><p>35ã€å•ä¾‹æ¨¡å¼çš„çº¿ç¨‹å®‰å…¨æ€§</p><p>è€ç”Ÿå¸¸è°ˆçš„é—®é¢˜äº†ï¼Œé¦–å…ˆè¦è¯´çš„æ˜¯å•ä¾‹æ¨¡å¼çš„çº¿ç¨‹å®‰å…¨æ„å‘³ç€ï¼šæŸä¸ªç±»çš„å®ä¾‹åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹åªä¼šè¢«åˆ›å»ºä¸€æ¬¡å‡ºæ¥ã€‚å•ä¾‹æ¨¡å¼æœ‰å¾ˆå¤šç§çš„å†™æ³•ï¼Œæˆ‘æ€»ç»“ä¸€ä¸‹ï¼š</p><p>ï¼ˆ1ï¼‰é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼çš„å†™æ³•ï¼šçº¿ç¨‹å®‰å…¨</p><p>ï¼ˆ2ï¼‰æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼çš„å†™æ³•ï¼šéçº¿ç¨‹å®‰å…¨</p><p>ï¼ˆ3ï¼‰åŒæ£€é”å•ä¾‹æ¨¡å¼çš„å†™æ³•ï¼šçº¿ç¨‹å®‰å…¨</p><p>36ã€Semaphoreæœ‰ä»€ä¹ˆä½œç”¨</p><p>Semaphoreå°±æ˜¯ä¸€ä¸ªä¿¡å·é‡ï¼Œå®ƒçš„ä½œç”¨æ˜¯é™åˆ¶æŸæ®µä»£ç å—çš„å¹¶å‘æ•°ã€‚Semaphoreæœ‰ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå¯ä»¥ä¼ å…¥ä¸€ä¸ªintå‹æ•´æ•°nï¼Œè¡¨ç¤ºæŸæ®µä»£ç æœ€å¤šåªæœ‰nä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®ï¼Œå¦‚æœè¶…å‡ºäº†nï¼Œé‚£ä¹ˆè¯·ç­‰å¾…ï¼Œç­‰åˆ°æŸä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•è¿™æ®µä»£ç å—ï¼Œä¸‹ä¸€ä¸ªçº¿ç¨‹å†è¿›å…¥ã€‚ç”±æ­¤å¯ä»¥çœ‹å‡ºå¦‚æœSemaphoreæ„é€ å‡½æ•°ä¸­ä¼ å…¥çš„intå‹æ•´æ•°n=1ï¼Œç›¸å½“äºå˜æˆäº†ä¸€ä¸ªsynchronizedäº†ã€‚</p><p>37ã€Hashtableçš„size()æ–¹æ³•ä¸­æ˜æ˜åªæœ‰ä¸€æ¡è¯­å¥â€return countâ€ï¼Œä¸ºä»€ä¹ˆè¿˜è¦åšåŒæ­¥ï¼Ÿ</p><p>è¿™æ˜¯æˆ‘ä¹‹å‰çš„ä¸€ä¸ªå›°æƒ‘ï¼Œä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰æƒ³è¿‡è¿™ä¸ªé—®é¢˜ã€‚æŸä¸ªæ–¹æ³•ä¸­å¦‚æœæœ‰å¤šæ¡è¯­å¥ï¼Œå¹¶ä¸”éƒ½åœ¨æ“ä½œåŒä¸€ä¸ªç±»å˜é‡ï¼Œé‚£ä¹ˆåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¸åŠ é”ï¼ŒåŠ¿å¿…ä¼šå¼•å‘çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œè¿™å¾ˆå¥½ç†è§£ï¼Œä½†æ˜¯size()æ–¹æ³•æ˜æ˜åªæœ‰ä¸€æ¡è¯­å¥ï¼Œä¸ºä»€ä¹ˆè¿˜è¦åŠ é”ï¼Ÿ</p><p>å…³äºè¿™ä¸ªé—®é¢˜ï¼Œåœ¨æ…¢æ…¢åœ°å·¥ä½œã€å­¦ä¹ ä¸­ï¼Œæœ‰äº†ç†è§£ï¼Œä¸»è¦åŸå› æœ‰ä¸¤ç‚¹ï¼š</p><p>ï¼ˆ1ï¼‰åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€æ¡çº¿ç¨‹æ‰§è¡Œå›ºå®šç±»çš„åŒæ­¥æ–¹æ³•ï¼Œä½†æ˜¯å¯¹äºç±»çš„éåŒæ­¥æ–¹æ³•ï¼Œå¯ä»¥å¤šæ¡çº¿ç¨‹åŒæ—¶è®¿é—®ã€‚æ‰€ä»¥ï¼Œè¿™æ ·å°±æœ‰é—®é¢˜äº†ï¼Œå¯èƒ½çº¿ç¨‹Aåœ¨æ‰§è¡ŒHashtableçš„putæ–¹æ³•æ·»åŠ æ•°æ®ï¼Œçº¿ç¨‹Båˆ™å¯ä»¥æ­£å¸¸è°ƒç”¨size()æ–¹æ³•è¯»å–Hashtableä¸­å½“å‰å…ƒç´ çš„ä¸ªæ•°ï¼Œé‚£è¯»å–åˆ°çš„å€¼å¯èƒ½ä¸æ˜¯æœ€æ–°çš„ï¼Œå¯èƒ½çº¿ç¨‹Aæ·»åŠ äº†å®Œäº†æ•°æ®ï¼Œä½†æ˜¯æ²¡æœ‰å¯¹size++ï¼Œçº¿ç¨‹Bå°±å·²ç»è¯»å–sizeäº†ï¼Œé‚£ä¹ˆå¯¹äºçº¿ç¨‹Bæ¥è¯´è¯»å–åˆ°çš„sizeä¸€å®šæ˜¯ä¸å‡†ç¡®çš„ã€‚è€Œç»™size()æ–¹æ³•åŠ äº†åŒæ­¥ä¹‹åï¼Œæ„å‘³ç€çº¿ç¨‹Bè°ƒç”¨size()æ–¹æ³•åªæœ‰åœ¨çº¿ç¨‹Aè°ƒç”¨putæ–¹æ³•å®Œæ¯•ä¹‹åæ‰å¯ä»¥è°ƒç”¨ï¼Œè¿™æ ·å°±ä¿è¯äº†çº¿ç¨‹å®‰å…¨æ€§</p><p>ï¼ˆ2ï¼‰CPUæ‰§è¡Œä»£ç ï¼Œæ‰§è¡Œçš„ä¸æ˜¯Javaä»£ç ï¼Œè¿™ç‚¹å¾ˆå…³é”®ï¼Œä¸€å®šå¾—è®°ä½ã€‚Javaä»£ç æœ€ç»ˆæ˜¯è¢«ç¿»è¯‘æˆæ±‡ç¼–ä»£ç æ‰§è¡Œçš„ï¼Œæ±‡ç¼–ä»£ç æ‰æ˜¯çœŸæ­£å¯ä»¥å’Œç¡¬ä»¶ç”µè·¯äº¤äº’çš„ä»£ç ã€‚å³ä½¿ä½ çœ‹åˆ°Javaä»£ç åªæœ‰ä¸€è¡Œï¼Œç”šè‡³ä½ çœ‹åˆ°Javaä»£ç ç¼–è¯‘ä¹‹åç”Ÿæˆçš„å­—èŠ‚ç ä¹Ÿåªæœ‰ä¸€è¡Œï¼Œä¹Ÿä¸æ„å‘³ç€å¯¹äºåº•å±‚æ¥è¯´è¿™å¥è¯­å¥çš„æ“ä½œåªæœ‰ä¸€ä¸ªã€‚ä¸€å¥â€return countâ€å‡è®¾è¢«ç¿»è¯‘æˆäº†ä¸‰å¥æ±‡ç¼–è¯­å¥æ‰§è¡Œï¼Œå®Œå…¨å¯èƒ½æ‰§è¡Œå®Œç¬¬ä¸€å¥ï¼Œçº¿ç¨‹å°±åˆ‡æ¢äº†ã€‚</p><p>38ã€çº¿ç¨‹ç±»çš„æ„é€ æ–¹æ³•ã€é™æ€å—æ˜¯è¢«å“ªä¸ªçº¿ç¨‹è°ƒç”¨çš„</p><p>è¿™æ˜¯ä¸€ä¸ªéå¸¸åˆé’»å’Œç‹¡çŒ¾çš„é—®é¢˜ã€‚è¯·è®°ä½ï¼šçº¿ç¨‹ç±»çš„æ„é€ æ–¹æ³•ã€é™æ€å—æ˜¯è¢«newè¿™ä¸ªçº¿ç¨‹ç±»æ‰€åœ¨çš„çº¿ç¨‹æ‰€è°ƒç”¨çš„ï¼Œè€Œrunæ–¹æ³•é‡Œé¢çš„ä»£ç æ‰æ˜¯è¢«çº¿ç¨‹è‡ªèº«æ‰€è°ƒç”¨çš„ã€‚</p><p>å¦‚æœè¯´ä¸Šé¢çš„è¯´æ³•è®©ä½ æ„Ÿåˆ°å›°æƒ‘ï¼Œé‚£ä¹ˆæˆ‘ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾Thread2ä¸­newäº†Thread1ï¼Œmainå‡½æ•°ä¸­newäº†Thread2ï¼Œé‚£ä¹ˆï¼š</p><p>ï¼ˆ1ï¼‰Thread2çš„æ„é€ æ–¹æ³•ã€é™æ€å—æ˜¯mainçº¿ç¨‹è°ƒç”¨çš„ï¼ŒThread2çš„run()æ–¹æ³•æ˜¯Thread2è‡ªå·±è°ƒç”¨çš„</p><p>ï¼ˆ2ï¼‰Thread1çš„æ„é€ æ–¹æ³•ã€é™æ€å—æ˜¯Thread2è°ƒç”¨çš„ï¼ŒThread1çš„run()æ–¹æ³•æ˜¯Thread1è‡ªå·±è°ƒç”¨çš„</p><p>39ã€åŒæ­¥æ–¹æ³•å’ŒåŒæ­¥å—ï¼Œå“ªä¸ªæ˜¯æ›´å¥½çš„é€‰æ‹© åŒæ­¥å—ï¼Œè¿™æ„å‘³ç€åŒæ­¥å—ä¹‹å¤–çš„ä»£ç æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œè¿™æ¯”åŒæ­¥æ•´ä¸ªæ–¹æ³•æ›´æå‡ä»£ç çš„æ•ˆç‡ã€‚è¯·çŸ¥é“ä¸€æ¡åŸåˆ™ï¼šåŒæ­¥çš„èŒƒå›´è¶Šå°‘è¶Šå¥½ã€‚</p><p>å€Ÿç€è¿™ä¸€æ¡ï¼Œæˆ‘é¢å¤–æä¸€ç‚¹ï¼Œè™½è¯´åŒæ­¥çš„èŒƒå›´è¶Šå°‘è¶Šå¥½ï¼Œä½†æ˜¯åœ¨Javaè™šæ‹Ÿæœºä¸­è¿˜æ˜¯å­˜åœ¨ç€ä¸€ç§å«åšé”ç²—åŒ–çš„ä¼˜åŒ–æ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•å°±æ˜¯æŠŠåŒæ­¥èŒƒå›´å˜å¤§ã€‚è¿™æ˜¯æœ‰ç”¨çš„ï¼Œæ¯”æ–¹è¯´StringBufferï¼Œå®ƒæ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ç±»ï¼Œè‡ªç„¶æœ€å¸¸ç”¨çš„append()æ–¹æ³•æ˜¯ä¸€ä¸ªåŒæ­¥æ–¹æ³•ï¼Œæˆ‘ä»¬å†™ä»£ç çš„æ—¶å€™ä¼šåå¤appendå­—ç¬¦ä¸²ï¼Œè¿™æ„å‘³ç€è¦è¿›è¡Œåå¤çš„åŠ é”-&gt;è§£é”ï¼Œè¿™å¯¹æ€§èƒ½ä¸åˆ©ï¼Œå› ä¸ºè¿™æ„å‘³ç€Javaè™šæ‹Ÿæœºåœ¨è¿™æ¡çº¿ç¨‹ä¸Šè¦åå¤åœ°åœ¨å†…æ ¸æ€å’Œç”¨æˆ·æ€ä¹‹é—´è¿›è¡Œåˆ‡æ¢ï¼Œå› æ­¤Javaè™šæ‹Ÿæœºä¼šå°†å¤šæ¬¡appendæ–¹æ³•è°ƒç”¨çš„ä»£ç è¿›è¡Œä¸€ä¸ªé”ç²—åŒ–çš„æ“ä½œï¼Œå°†å¤šæ¬¡çš„appendçš„æ“ä½œæ‰©å±•åˆ°appendæ–¹æ³•çš„å¤´å°¾ï¼Œå˜æˆä¸€ä¸ªå¤§çš„åŒæ­¥å—ï¼Œè¿™æ ·å°±å‡å°‘äº†åŠ é”â€“&gt;è§£é”çš„æ¬¡æ•°ï¼Œæœ‰æ•ˆåœ°æå‡äº†ä»£ç æ‰§è¡Œçš„æ•ˆç‡ã€‚</p><p>40ã€é«˜å¹¶å‘ã€ä»»åŠ¡æ‰§è¡Œæ—¶é—´çŸ­çš„ä¸šåŠ¡æ€æ ·ä½¿ç”¨çº¿ç¨‹æ± ï¼Ÿå¹¶å‘ä¸é«˜ã€ä»»åŠ¡æ‰§è¡Œæ—¶é—´é•¿çš„ä¸šåŠ¡æ€æ ·ä½¿ç”¨çº¿ç¨‹æ± ï¼Ÿå¹¶å‘é«˜ã€ä¸šåŠ¡æ‰§è¡Œæ—¶é—´é•¿çš„ä¸šåŠ¡æ€æ ·ä½¿ç”¨çº¿ç¨‹æ± ï¼Ÿ</p><p>è¿™æ˜¯æˆ‘åœ¨å¹¶å‘ç¼–ç¨‹ç½‘ä¸Šçœ‹åˆ°çš„ä¸€ä¸ªé—®é¢˜ï¼ŒæŠŠè¿™ä¸ªé—®é¢˜æ”¾åœ¨æœ€åä¸€ä¸ªï¼Œå¸Œæœ›æ¯ä¸ªäººéƒ½èƒ½çœ‹åˆ°å¹¶ä¸”æ€è€ƒä¸€ä¸‹ï¼Œå› ä¸ºè¿™ä¸ªé—®é¢˜éå¸¸å¥½ã€éå¸¸å®é™…ã€éå¸¸ä¸“ä¸šã€‚å…³äºè¿™ä¸ªé—®é¢˜ï¼Œä¸ªäººçœ‹æ³•æ˜¯ï¼š</p><p>ï¼ˆ1ï¼‰é«˜å¹¶å‘ã€ä»»åŠ¡æ‰§è¡Œæ—¶é—´çŸ­çš„ä¸šåŠ¡ï¼Œçº¿ç¨‹æ± çº¿ç¨‹æ•°å¯ä»¥è®¾ç½®ä¸ºCPUæ ¸æ•°+1ï¼Œå‡å°‘çº¿ç¨‹ä¸Šä¸‹æ–‡çš„åˆ‡æ¢</p><p>ï¼ˆ2ï¼‰å¹¶å‘ä¸é«˜ã€ä»»åŠ¡æ‰§è¡Œæ—¶é—´é•¿çš„ä¸šåŠ¡è¦åŒºåˆ†å¼€çœ‹ï¼š</p><p>aï¼‰å‡å¦‚æ˜¯ä¸šåŠ¡æ—¶é—´é•¿é›†ä¸­åœ¨IOæ“ä½œä¸Šï¼Œä¹Ÿå°±æ˜¯IOå¯†é›†å‹çš„ä»»åŠ¡ï¼Œå› ä¸ºIOæ“ä½œå¹¶ä¸å ç”¨CPUï¼Œæ‰€ä»¥ä¸è¦è®©æ‰€æœ‰çš„CPUé—²ä¸‹æ¥ï¼Œå¯ä»¥åŠ å¤§çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ç›®ï¼Œè®©CPUå¤„ç†æ›´å¤šçš„ä¸šåŠ¡</p><p>bï¼‰å‡å¦‚æ˜¯ä¸šåŠ¡æ—¶é—´é•¿é›†ä¸­åœ¨è®¡ç®—æ“ä½œä¸Šï¼Œä¹Ÿå°±æ˜¯è®¡ç®—å¯†é›†å‹ä»»åŠ¡ï¼Œè¿™ä¸ªå°±æ²¡åŠæ³•äº†ï¼Œå’Œï¼ˆ1ï¼‰ä¸€æ ·å§ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°è®¾ç½®å¾—å°‘ä¸€äº›ï¼Œå‡å°‘çº¿ç¨‹ä¸Šä¸‹æ–‡çš„åˆ‡æ¢</p><p>ï¼ˆ3ï¼‰å¹¶å‘é«˜ã€ä¸šåŠ¡æ‰§è¡Œæ—¶é—´é•¿ï¼Œè§£å†³è¿™ç§ç±»å‹ä»»åŠ¡çš„å…³é”®ä¸åœ¨äºçº¿ç¨‹æ± è€Œåœ¨äºæ•´ä½“æ¶æ„çš„è®¾è®¡ï¼Œçœ‹çœ‹è¿™äº›ä¸šåŠ¡é‡Œé¢æŸäº›æ•°æ®æ˜¯å¦èƒ½åšç¼“å­˜æ˜¯ç¬¬ä¸€æ­¥ï¼Œå¢åŠ æœåŠ¡å™¨æ˜¯ç¬¬äºŒæ­¥ï¼Œè‡³äºçº¿ç¨‹æ± çš„è®¾ç½®ï¼Œè®¾ç½®å‚è€ƒï¼ˆ2ï¼‰ã€‚æœ€åï¼Œä¸šåŠ¡æ‰§è¡Œæ—¶é—´é•¿çš„é—®é¢˜ï¼Œä¹Ÿå¯èƒ½éœ€è¦åˆ†æä¸€ä¸‹ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½ä½¿ç”¨ä¸­é—´ä»¶å¯¹ä»»åŠ¡è¿›è¡Œæ‹†åˆ†å’Œè§£è€¦ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>çº¿ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Ribbonè´Ÿè½½å‡è¡¡</title>
    <link href="/blog/2021/03/02/Ribbon%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/"/>
    <url>/blog/2021/03/02/Ribbon%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/</url>
    
    <content type="html"><![CDATA[<p>ç­–ç•¥è§„åˆ™ Ribbon æä¾› IRule æ¥å£ï¼Œè¯¥æ¥å£å®šä¹‰äº†å¦‚ä½•è®¿é—®æœåŠ¡çš„ç­–ç•¥ï¼Œä»¥ä¸‹æ˜¯è¯¥æ¥å£çš„å®ç°ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">1</span>) RoundRobinRuleï¼šè½®è¯¢ï¼Œé»˜è®¤ä½¿ç”¨çš„è§„åˆ™ï¼›<br><span class="hljs-number">2</span>) RandomRuleï¼šéšæœºï¼›<br><span class="hljs-number">3</span>) AvailabilityFilteringRuleï¼šå…ˆè¿‡æ»¤ç”±äºå¤šæ¬¡è®¿é—®æ•…éšœè€Œå¤„äºæ–­è·¯å™¨è·³é—¸çŠ¶æ€ä»¥åŠå¹¶å‘è¿æ¥æ•°é‡è¶…è¿‡é˜€å€¼å¾—æœåŠ¡ï¼Œç„¶åä»å‰©ä½™æœåŠ¡åˆ—è¡¨ä¸­æŒ‰ç…§è½®è¯¢ç­–ç•¥è¿›è¡Œè®¿é—®ï¼›<br><span class="hljs-number">4</span>) WeightedResponseTimeRuleï¼šæ ¹æ®å¹³å‡å“åº”æ—¶é—´è®¡ç®—æ‰€æœ‰çš„æƒé‡ï¼Œå“åº”æ—¶é—´è¶Šå¿«æœåŠ¡æƒé‡è¶Šæœ‰å¯èƒ½è¢«é€‰ä¸­ï¼›<br><span class="hljs-number">5</span>) RetryRuleï¼šå…ˆæŒ‰ç…§ RoundRobinRule ç­–ç•¥è·å–æœåŠ¡ï¼Œå¦‚æœè·å–æœåŠ¡å¤±è´¥åˆ™åœ¨æŒ‡å®šæ—¶é—´å†…è¿›è¡Œé‡è¯•ï¼Œè·å–å¯ç”¨æœåŠ¡ï¼›<br><span class="hljs-number">6</span>) BestAvailableRuleï¼šå…ˆè¿‡æ»¤ç”±äºå¤šæ¬¡è®¿é—®æ•…éšœè€Œå¤„äºæ–­è·¯å™¨è·³é—¸çŠ¶æ€çš„æœåŠ¡ï¼Œç„¶åé€‰æ‹©å¹¶å‘é‡æœ€å°çš„æœåŠ¡ï¼›<br><span class="hljs-number">7</span>) ZoneAvoidanceRuleï¼šåˆ¤æ–­ server æ‰€åœ¨åŒºåŸŸçš„æ€§èƒ½å’Œ server çš„å¯ç”¨æ€§æ¥é€‰æ‹©æœåŠ¡å™¨ã€‚<br></code></pre></td></tr></table></figure><p>ç­–ç•¥ä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RestConfiguration</span> </span>&#123;<br> <br><span class="hljs-meta">@Bean</span><br><span class="hljs-meta">@LoadBalanced</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> RestTemplate <span class="hljs-title">getRestTemplate</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RestTemplate();<br>&#125;<br><br><span class="hljs-meta">@Bean</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> IRule <span class="hljs-title">testRule</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RandomRule();<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰‹åŠ¨åˆ›å»ºè´Ÿè½½å‡è¡¡è§„åˆ™å¯¹è±¡ï¼Œæœ¬æ¬¡æµ‹è¯•ä½¿ç”¨çš„ç­–ç•¥æ˜¯éšæœºã€‚</p><p>å¯åŠ¨ user-consumer é¡¹ç›®ä½¿ç”¨æµè§ˆå™¨è®¿é—®æ¥å£ï¼Œè¿è¡Œç»“æœå¦‚ä¸‹ï¼š<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/small-20210302204744717.jpeg" alt="ribbon-02"></p><p>ç”±å›¾å¯çŸ¥ï¼Œéšæœºç­–ç•¥å·²ç”Ÿæ•ˆï¼Œè´Ÿè½½å‡è¡¡çš„ç­–ç•¥ç”±è½®è¯¢å˜æˆäº†éšæœºã€‚ <a href="https://github.com/cuixiaoyan/ribbon">æºç ä¸‹è½½</a></p>]]></content>
    
    
    <categories>
      
      <category>Ribbon</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>Ribbon</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringCloudå…¥é—¨ä¹‹Ribbonç¯‡</title>
    <link href="/blog/2021/03/02/SpringCloud%E5%85%A5%E9%97%A8%E4%B9%8BRibbon%E7%AF%87/"/>
    <url>/blog/2021/03/02/SpringCloud%E5%85%A5%E9%97%A8%E4%B9%8BRibbon%E7%AF%87/</url>
    
    <content type="html"><![CDATA[<p>æœ¬ç¯‡æ–‡ç« å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ Ribbon å®Œæˆå‘ç°æœåŠ¡çš„è°ƒç”¨ä»¥åŠå…¶è´Ÿè½½å‡è¡¡çš„è§„åˆ™çš„ä½¿ç”¨ã€‚ Spring Cloud Ribbon æ˜¯åŸºäº Netflix Ribbon å®ç°çš„ä¸€å¥—å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡å·¥å…·ï¼Œå…¶ä¸»è¦åŠŸèƒ½æ˜¯æä¾›å®¢æˆ·ç«¯çš„è½¯ä»¶è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œå°† Netflix çš„ä¸­é—´å±‚æœåŠ¡è¿æ¥åœ¨ä¸€èµ·ã€‚</p><p>å…¶è¿è¡ŒåŸç†å¦‚ä¸‹å›¾ï¼š<img src="https://cuixiaoyande.oss-cn-shanghai.aliyuncs.com/ribbon_1571707503910.png?x-oss-process=style/small" alt="ribbon">Ribbon è¿è¡Œæ—¶åˆ†æˆ 2 ä¸ªæ­¥éª¤ï¼š 1ã€å…ˆé€‰æ‹©åœ¨åŒä¸€ä¸ªåŒºåŸŸè´Ÿè½½è¾ƒå°‘çš„ EurekaServer; 2ã€ å†æ ¹æ®ç”¨æˆ·æŒ‡å®šçš„ç­–ç•¥ï¼Œåœ¨ä» EurekaServer ä¸­è·å–æ³¨å†Œåˆ—è¡¨ä¸­çš„æœåŠ¡ä¿¡æ¯è¿›è¡Œè°ƒç”¨ã€‚</p><p>æ·»åŠ ä¾èµ–ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependency&gt;<br>    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br>    &lt;artifactId&gt;spring-cloud-starter-ribbon&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure><p>å…¶å®ï¼Œæ·»åŠ  Eureka åŒ…æ—¶ï¼Œä¼šè‡ªåŠ¨æ·»åŠ  Ribbon ä¾èµ–åŒ…ã€‚ ä¿®æ”¹è¯·æ±‚ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RestConfiguration</span> </span>&#123;<br> <br><span class="hljs-meta">@Bean</span><br><span class="hljs-meta">@LoadBalanced</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> RestTemplate <span class="hljs-title">getRestTemplate</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RestTemplate();<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ­£å¦‚ä¸Šæ–‡ä»‹ç»çš„ï¼ŒRibbon æ˜¯å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡å·¥å…·ï¼Œæ‰€ä»¥åœ¨ getRestTemplate æ–¹æ³•ä¸Šæ·»åŠ  @LoadBalanced æ³¨è§£å®ç°è´Ÿè½½å‡è¡¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/user&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> </span>&#123;<br><br><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> RestTemplate restTemplate;<br><br><span class="hljs-comment">//@RequestMapping(&quot;get/&#123;id&#125;&quot;)</span><br><span class="hljs-comment">//public User get(@PathVariable(&quot;id&quot;) Integer id) throws Exception &#123;</span><br><span class="hljs-comment">//// æ²¡æœ‰ä½¿ç”¨ Eureka æ—¶ï¼Œuri ä¸ºæ¶ˆæ¯æä¾›è€…çš„åœ°å€ï¼Œéœ€è¦æŒ‡å®š ip å’Œ ç«¯å£</span><br><span class="hljs-comment">//return restTemplate.getForObject(new URI(&quot;http://localhost:8081/provider/user/get/&quot; + id), User.class);</span><br><span class="hljs-comment">//&#125;</span><br><br><span class="hljs-comment">//@Autowired</span><br><span class="hljs-comment">//private DiscoveryClient client;</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//@RequestMapping(&quot;get/&#123;id&#125;&quot;)</span><br><span class="hljs-comment">//public User get(@PathVariable(&quot;id&quot;) Integer id) throws Exception &#123;</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//List&lt;ServiceInstance&gt; list = this.client.getInstances(&quot;USER-API&quot;);</span><br><span class="hljs-comment">//String uri = &quot;&quot;;</span><br><span class="hljs-comment">//    for (ServiceInstance instance : list) &#123;</span><br><span class="hljs-comment">//        if (instance.getUri() != null &amp;&amp; !&quot;&quot;.equals(instance.getUri().toString())) &#123;</span><br><span class="hljs-comment">//        uri = instance.getUri().toString();</span><br><span class="hljs-comment">//        break;</span><br><span class="hljs-comment">//        &#125;</span><br><span class="hljs-comment">//    &#125;</span><br><span class="hljs-comment">//return restTemplate.getForObject(uri + &quot;/provider/user/get/&quot; + id, User.class);</span><br><span class="hljs-comment">//&#125;</span><br><br><span class="hljs-meta">@RequestMapping(&quot;get/&#123;id&#125;&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">get</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>    <span class="hljs-comment">// ä½¿ç”¨ Eureka + Ribbon åï¼Œuri å¡«å†™æœåŠ¡åç§°å³å¯</span><br><span class="hljs-keyword">return</span> restTemplate.getForObject(<span class="hljs-string">&quot;http://USER-API/provider/user/get/&quot;</span> + id, User.class);<br>&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹ DiscoveryClient ç›¸å…³ä»£ç ï¼Œä½¿ç”¨ USER-API æœåŠ¡åç§°ä½œä¸ºè¯·æ±‚ URLã€‚</p><p>åœ¨å¯åŠ¨ç±»ä¸Šå°† @EnableDiscoveryClient æ›¿æ¢æˆ @EnableEurekaClient æ³¨è§£ã€‚ å®Œæˆä¸Šè¾¹ 4 ä¸ªæ“ä½œåï¼Œå¯åŠ¨ user-consumer é¡¹ç›®ä½¿ç”¨æµè§ˆå™¨è®¿é—®æ¥å£ï¼Œè¿è¡Œç»“æœå¦‚ä¸‹ï¼š<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/small-20210302204653022.jpeg" alt="ribbon-01">ç”±å›¾å¯çŸ¥ï¼ŒRibbon é»˜è®¤ä½¿ç”¨è´Ÿè½½å‡è¡¡çš„ç­–ç•¥æ˜¯è½®è¯¢ï¼Œå¯¹æœåŠ¡è¿›è¡Œè°ƒç”¨ã€‚ <a href="https://github.com/cuixiaoyan/ribbon">æºç ä¸‹è½½</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>Ribbon</tag>
      
      <tag>SpringCloud</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Eurekaé›†ç¾¤</title>
    <link href="/blog/2021/03/02/Eureka%E9%9B%86%E7%BE%A4/"/>
    <url>/blog/2021/03/02/Eureka%E9%9B%86%E7%BE%A4/</url>
    
    <content type="html"><![CDATA[<p>Eureka ä½œä¸ºæ³¨å†Œä¸­å¿ƒï¼Œä¿å­˜äº†ç³»ç»ŸæœåŠ¡çš„ç›¸å…³ä¿¡æ¯ï¼Œå¦‚æœæ³¨å†Œä¸­å¿ƒæŒ‚æ‰ï¼Œé‚£ä¹ˆç³»ç»Ÿå°±ç˜«ç—ªäº†ã€‚å› æ­¤ï¼Œå¯¹ Eureka åšé›†ç¾¤å®ç°é«˜å¯ç”¨æ˜¯å¿…ä¸å¯å°‘çš„ã€‚</p><p>æœ¬æ¬¡æµ‹è¯•ä½¿ç”¨ä¸€å°æœºå™¨éƒ¨ç½² Eureka é›†ç¾¤ï¼Œé€šè¿‡åå­—å’Œç«¯å£åŒºåˆ†ä¸åŒçš„ eureka æœåŠ¡ã€‚ Eureka åç§° ç«¯å£å· eureka01 9001 eureka02 9002 ç”±äºä½¿ç”¨ä¸€å°æœºå™¨ï¼Œä½¿ç”¨ä¸¤ä¸ªåç§°è¿˜éœ€è¦ä¿®æ”¹ C:\Windows\System32\drivers\etc ä¸‹çš„ host æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>  eureka01<br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>  eureka02<br></code></pre></td></tr></table></figure><p>application.yml æ–‡ä»¶éœ€è¦è¿›è¡Œå¦‚ä¸‹ä¿®æ”¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java">server:<br>    port: <span class="hljs-number">9001</span><br>    <br>eureka:<br>    instance:<br>        hostname: eureka01   # eureka å®ä¾‹åç§°<br>    client:<br>        register-with-eureka: false # ä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±<br>        fetch-registry: false       # è¡¨ç¤ºè‡ªå·±å°±æ˜¯æ³¨å†Œä¸­å¿ƒ<br>        service-url:<br>            defaultZone: http:<span class="hljs-comment">//eureka01:9001/eureka/,http://eureka02:9002/eureka/</span><br></code></pre></td></tr></table></figure><p>ä¸¤ä¸ª eureka æœåŠ¡å®ä¾‹çš„é…ç½®æ–‡ä»¶ä¿®æ”¹æ–¹å¼ç±»ä¼¼ï¼Œå°†åç§°å’Œç«¯å£è¿›è¡Œä¿®æ”¹å³å¯ã€‚ æœåŠ¡æ³¨å†Œçš„é¡¹ç›®ä¸­ï¼Œå°† eureka.client.service-url.defaultZone æ”¹æˆé›†ç¾¤çš„ url å³å¯ã€‚ å¯åŠ¨æ•ˆæœå¦‚ä¸‹å›¾ï¼š<img src="https://cuixiaoyande.oss-cn-shanghai.aliyuncs.com/springcloud-eureka-05_1571621779024.jpg?x-oss-process=style/small" alt="springcloud-eureka-05"></p><p><strong>Eureka ä¸ Zookeeper çš„åŒºåˆ«</strong> ä¸¤è€…éƒ½å¯ä»¥å……å½“æ³¨å†Œä¸­å¿ƒçš„è§’è‰²ï¼Œä¸”å¯ä»¥é›†ç¾¤å®ç°é«˜å¯ç”¨ï¼Œç›¸å½“äºå°å‹çš„åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿã€‚</p><h2 id="CAP-ç†è®º"><a href="#CAP-ç†è®º" class="headerlink" title="CAP ç†è®º"></a>CAP ç†è®º</h2><p>CAP åˆ†åˆ«ä¸º consistency(å¼ºä¸€è‡´æ€§)ã€availability(å¯ç”¨æ€§) å’Œ partition toleranc(åˆ†åŒºå®¹é”™æ€§)ã€‚</p><p>ç†è®ºæ ¸å¿ƒï¼šä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸å¯èƒ½åŒæ—¶å¾ˆå¥½çš„æ»¡è¶³ä¸€è‡´æ€§ã€å¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™æ€§è¿™ä¸‰ä¸ªéœ€æ±‚ã€‚å› æ­¤ï¼Œæ ¹æ® CAP åŸç†å°† NoSQL æ•°æ®åº“åˆ†æˆæ»¡è¶³ CA åŸåˆ™ã€æ»¡è¶³ CP åŸåˆ™å’Œæ»¡è¶³ AP åŸåˆ™ä¸‰å¤§ç±»ï¼š <strong>CAï¼šå•ç‚¹é›†ç¾¤ï¼Œæ»¡è¶³ä¸€è‡´æ€§ï¼Œå¯ç”¨æ€§çš„ç³»ç»Ÿï¼Œé€šå¸¸åœ¨å¯æ‰©å±•æ€§ä¸Šä¸é«˜ CP: æ»¡è¶³ä¸€è‡´æ€§ï¼Œåˆ†åŒºå®¹é”™æ€§çš„ç³»ç»Ÿï¼Œé€šå¸¸æ€§èƒ½ä¸æ˜¯ç‰¹åˆ«é«˜ AP: æ»¡è¶³å¯ç”¨æ€§ï¼Œåˆ†åŒºå®¹é”™æ€§çš„ç³»ç»Ÿï¼Œé€šè¿‡å¯¹ä¸€è‡´æ€§è¦æ±‚è¾ƒä½</strong> ç®€å•çš„è¯´ï¼šCAP ç†è®ºæè¿°åœ¨åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿä¸­ï¼Œæœ€å¤šåªèƒ½æ»¡è¶³ä¸¤ä¸ªéœ€æ±‚ã€‚</p><h2 id="Zookeeper-ä¿è¯-CP"><a href="#Zookeeper-ä¿è¯-CP" class="headerlink" title="Zookeeper ä¿è¯ CP"></a>Zookeeper ä¿è¯ CP</h2><p>å½“å‘æ³¨å†Œä¸­å¿ƒæŸ¥è¯¢æœåŠ¡åˆ—è¡¨æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å®¹å¿æ³¨å†Œä¸­å¿ƒè¿”å›çš„æ˜¯å‡ åˆ†é’Ÿå‰çš„æ³¨å†Œä¿¡æ¯ï¼Œä½†ä¸èƒ½æ¥å—æœåŠ¡ç›´æ¥æŒ‚æ‰ä¸å¯ç”¨äº†ã€‚å› æ­¤ï¼ŒæœåŠ¡æ³¨å†Œä¸­å¿ƒå¯¹å¯ç”¨æ€§çš„è¦æ±‚é«˜äºä¸€è‡´æ€§ã€‚</p><p>ä½†æ˜¯ï¼Œzookeeper ä¼šå‡ºç°ä¸€ç§æƒ…å†µï¼Œå½“ master èŠ‚ç‚¹å› ä¸ºç½‘ç»œæ•…éšœä¸å…¶ä»–èŠ‚ç‚¹å¤±å»è”ç³»æ—¶ï¼Œå‰©ä½™èŠ‚ç‚¹ä¼šé‡æ–°è¿›è¡Œ leader é€‰ä¸¾ã€‚é—®é¢˜åœ¨äºï¼Œé€‰ä¸¾ leader çš„æ—¶é—´è¾ƒé•¿ï¼Œ30 ~ 120 ç§’ï¼Œä¸”é€‰ä¸¾æœŸé—´æ•´ä¸ª zookeeper é›†ç¾¤æ˜¯ä¸å¯ç”¨çš„ï¼Œè¿™æœŸé—´ä¼šå¯¼è‡´æ³¨å†ŒæœåŠ¡ç˜«ç—ªã€‚åœ¨äº‘éƒ¨ç½²çš„ç¯å¢ƒä¸‹ï¼Œå› ç½‘ç»œé—®é¢˜å¯¼è‡´ zookeeper é›†ç¾¤å¤±å» master èŠ‚ç‚¹çš„æ¦‚ç‡è¾ƒå¤§ï¼Œè™½ç„¶æœåŠ¡èƒ½æœ€ç»ˆæ¢å¤ï¼Œä½†æ˜¯æ¼«é•¿çš„é€‰ä¸¾æ—¶é—´å¯¼è‡´æ³¨å†ŒæœåŠ¡é•¿æœŸä¸å¯ç”¨æ˜¯ä¸èƒ½å®¹å¿çš„ã€‚</p><h2 id="Eureka-ä¿è¯-AP"><a href="#Eureka-ä¿è¯-AP" class="headerlink" title="Eureka ä¿è¯ AP"></a>Eureka ä¿è¯ AP</h2><p>Eureka åœ¨è®¾è®¡ä¸Šä¼˜å…ˆä¿è¯äº†å¯ç”¨æ€§ã€‚EurekaServer å„ä¸ªèŠ‚ç‚¹éƒ½æ˜¯å¹³ç­‰çš„ï¼Œå‡ ä¸ªèŠ‚ç‚¹æŒ‚æ‰ä¸ä¼šå½±å“æ­£å¸¸èŠ‚ç‚¹çš„å·¥ä½œï¼Œå‰©ä½™çš„èŠ‚ç‚¹ä¾ç„¶å¯ä»¥æä¾›æ³¨å†Œå’Œå‘ç°æœåŠ¡ã€‚</p><p>è€Œ Eureka å®¢æˆ·ç«¯åœ¨å‘æŸä¸ª EurekaServer æ³¨å†Œæˆ–å‘ç°è¿æ¥å¤±è´¥æ—¶ï¼Œä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°å…¶ä»– EurekaServer èŠ‚ç‚¹ï¼Œåªè¦æœ‰ä¸€å° EurekaServer æ­£å¸¸è¿è¡Œï¼Œå°±èƒ½ä¿è¯æ³¨å†ŒæœåŠ¡å¯ç”¨ï¼Œåªä¸è¿‡æŸ¥è¯¢åˆ°çš„ä¿¡æ¯å¯èƒ½ä¸æ˜¯æœ€æ–°çš„ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼ŒEurekaServer è¿˜æœ‰ä¸€ç§è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ï¼Œå¦‚æœåœ¨ 15 åˆ†é’Ÿå†…è¶…è¿‡ 85% çš„èŠ‚ç‚¹éƒ½æ²¡æœ‰æ­£å¸¸çš„å¿ƒè·³ï¼Œé‚£ä¹ˆ EurekaServer å°†è®¤ä¸ºå®¢æˆ·ç«¯ä¸æ³¨å†Œä¸­å¿ƒå‡ºç°ç½‘ç»œæ•…éšœï¼Œæ­¤æ—¶ä¼šå‡ºç°ä¸€ä¸‹å‡ ç§æƒ…å†µï¼š</p><p>EurekaServer ä¸å†ä»æ³¨å†Œåˆ—è¡¨ä¸­ç§»é™¤å› ä¸ºé•¿æ—¶é—´æ²¡æœ‰æ”¶åˆ°å¿ƒè·³è€Œåº”è¯¥è¿‡æœŸçš„æœåŠ¡</p><p>EurekaServer ä»ç„¶èƒ½å¤Ÿæ¥æ”¶æ–°æœåŠ¡çš„æ³¨å†Œå’ŒæŸ¥è¯¢è¯·æ±‚ï¼Œä½†ä¸ä¼šè¢«åŒæ­¥åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Š</p><p>å½“ç½‘ç»œç¨³å®šæ—¶ï¼Œå½“å‰ EurekaServer èŠ‚ç‚¹æ–°çš„æ³¨å†Œä¿¡æ¯ä¼šåŒæ­¥åˆ°å…¶ä»–èŠ‚ç‚¹ä¸­ å› æ­¤ï¼ŒEureka å¯ä»¥å¾ˆå¥½çš„åº”å¯¹å› ç½‘ç»œæ•…éšœå¯¼è‡´éƒ¨åˆ†èŠ‚ç‚¹å¤±å»è”ç³»çš„æƒ…å†µï¼Œè€Œä¸ä¼šå‘ Zookeeper é‚£æ ·æ˜¯æ•´ä¸ªæ³¨å†ŒæœåŠ¡ç˜«ç—ªã€‚ <a href="https://github.com/cuixiaoyan/eureka">æºç ä¸‹è½½</a></p>]]></content>
    
    
    <categories>
      
      <category>spring</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Eureka</tag>
      
      <tag>spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringCloud å…¥é—¨ä¹‹Eureka ç¯‡</title>
    <link href="/blog/2021/02/27/SpringCloud%E5%85%A5%E9%97%A8%E4%B9%8BEureka%E7%AF%87/"/>
    <url>/blog/2021/02/27/SpringCloud%E5%85%A5%E9%97%A8%E4%B9%8BEureka%E7%AF%87/</url>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>Spring Cloud æ˜¯ä¸€ç³»åˆ—æ¡†æ¶çš„æœ‰åºé›†åˆã€‚å®ƒåˆ©ç”¨ Spring Boot çš„å¼€å‘ä¾¿åˆ©æ€§å·§å¦™åœ°ç®€åŒ–äº†åˆ†å¸ƒå¼ç³»ç»ŸåŸºç¡€è®¾æ–½çš„å¼€å‘ï¼Œå¦‚æœåŠ¡å‘ç°æ³¨å†Œã€é…ç½®ä¸­å¿ƒã€æ¶ˆæ¯æ€»çº¿ã€è´Ÿè½½å‡è¡¡ã€æ–­è·¯å™¨ã€æ•°æ®ç›‘æ§ç­‰ï¼Œéƒ½å¯ä»¥ç”¨ Spring Boot çš„å¼€å‘é£æ ¼åšåˆ°ä¸€é”®å¯åŠ¨å’Œéƒ¨ç½²ã€‚</p><p>æœ¬ç¯‡ä»‹ç» Spring Cloud å…¥é—¨ç³»åˆ—ä¸­çš„ Eurekaï¼Œå®ç°å¿«é€Ÿå…¥é—¨ã€‚</p><h1 id="ç®€å•ä»‹ç»"><a href="#ç®€å•ä»‹ç»" class="headerlink" title="ç®€å•ä»‹ç»"></a>ç®€å•ä»‹ç»</h1><p>Eureka æ˜¯ Netflix çš„å­æ¨¡å—ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŸºäº REST çš„æœåŠ¡ï¼Œç”¨äºå®šä½æœåŠ¡ï¼Œä»¥å®ç°äº‘ç«¯ä¸­é—´å±‚æœåŠ¡å‘ç°å’Œæ•…éšœè½¬ç§»ã€‚</p><p>æœåŠ¡æ³¨å†Œå’Œå‘ç°å¯¹äºå¾®æœåŠ¡æ¶æ„è€Œè¨€ï¼Œæ˜¯éå¸¸é‡è¦çš„ã€‚æœ‰äº†æœåŠ¡å‘ç°å’Œæ³¨å†Œï¼Œåªéœ€è¦ä½¿ç”¨æœåŠ¡çš„æ ‡è¯†ç¬¦å°±å¯ä»¥è®¿é—®åˆ°æœåŠ¡ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹æœåŠ¡è°ƒç”¨çš„é…ç½®æ–‡ä»¶ã€‚è¯¥åŠŸèƒ½ç±»ä¼¼äº Dubbo çš„æ³¨å†Œä¸­å¿ƒï¼Œæ¯”å¦‚ Zookeeperã€‚</p><p>Eureka é‡‡ç”¨äº† CS çš„è®¾è®¡æ¶æ„ã€‚Eureka Server ä½œä¸ºæœåŠ¡æ³¨å†ŒåŠŸèƒ½çš„æœåŠ¡ç«¯ï¼Œå®ƒæ˜¯æœåŠ¡æ³¨å†Œä¸­å¿ƒã€‚è€Œç³»ç»Ÿä¸­å…¶ä»–å¾®æœåŠ¡åˆ™ä½¿ç”¨ Eureka çš„å®¢æˆ·ç«¯è¿æ¥åˆ° Eureka Server å¹¶ç»´æŒå¿ƒè·³è¿æ¥ã€‚</p><p>å…¶è¿è¡ŒåŸç†å¦‚ä¸‹å›¾ï¼š<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/small.jpeg" alt="springcloud-eureka-01">ç”±å›¾å¯çŸ¥ï¼ŒEureka çš„è¿è¡ŒåŸç†å’Œ Dubbo å¤§åŒå°å¼‚ï¼Œ Eureka åŒ…å«ä¸¤ä¸ªç»„ä»¶ï¼š Eureka Server å’Œ Eureka Clientã€‚</p><p>Eureka Server æä¾›æœåŠ¡çš„æ³¨å†ŒæœåŠ¡ã€‚å„ä¸ªæœåŠ¡èŠ‚ç‚¹å¯åŠ¨åä¼šåœ¨ Eureka Server ä¸­æ³¨å†ŒæœåŠ¡ï¼ŒEureka Server ä¸­çš„æœåŠ¡æ³¨å†Œè¡¨ä¼šå­˜å‚¨æ‰€æœ‰å¯ç”¨çš„æœåŠ¡èŠ‚ç‚¹ä¿¡æ¯ã€‚</p><p>Eureka Client æ˜¯ä¸€ä¸ª Java å®¢æˆ·ç«¯ï¼Œç”¨äºç®€åŒ– Eureka Server çš„äº¤äº’ï¼Œå®¢æˆ·ç«¯åŒæ—¶ä¹Ÿå…·å¤‡ä¸€ä¸ªå†…ç½®çš„ã€ä½¿ç”¨è½®è¯¢è´Ÿè½½ç®—æ³•çš„è´Ÿè½½å‡è¡¡å™¨ã€‚åœ¨åº”ç”¨å¯åŠ¨åï¼Œå‘ Eureka Server å‘é€å¿ƒè·³ï¼ˆé»˜è®¤å‘¨æœŸ 30 ç§’ï¼‰ã€‚å¦‚æœ Eureka Server åœ¨å¤šä¸ªå¿ƒè·³å‘¨æœŸå†…æ²¡æœ‰æ¥æ”¶åˆ°æŸä¸ªèŠ‚ç‚¹çš„å¿ƒè·³ï¼ŒEureka Server ä¼šä»æœåŠ¡æ³¨å†Œè¡¨ä¸­å°†è¯¥æœåŠ¡èŠ‚ç‚¹ä¿¡æ¯ç§»é™¤ã€‚</p><h1 id="æ­å»ºæ³¨å†Œä¸­å¿ƒ"><a href="#æ­å»ºæ³¨å†Œä¸­å¿ƒ" class="headerlink" title="æ­å»ºæ³¨å†Œä¸­å¿ƒ"></a>æ­å»ºæ³¨å†Œä¸­å¿ƒ</h1><p>åˆ›å»º Spring Boot é¡¹ç›®ï¼Œåä¸º eureka-serverï¼Œè¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</p><h2 id="æ·»åŠ ä¾èµ–"><a href="#æ·»åŠ ä¾èµ–" class="headerlink" title="æ·»åŠ ä¾èµ–"></a>æ·»åŠ ä¾èµ–</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependencyManagement&gt;<br>  &lt;dependencies&gt;<br>  &lt;dependency&gt;<br>&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br>&lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;<br>&lt;version&gt;Dalston.SR1&lt;/version&gt;<br>&lt;type&gt;pom&lt;/type&gt;<br>&lt;scope&gt;import&lt;/scope&gt;<br>&lt;/dependency&gt;<br><br>&lt;dependency&gt;<br>&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;<br>&lt;version&gt;1.5.9.RELEASE&lt;/version&gt;<br>&lt;type&gt;pom&lt;/type&gt;<br>&lt;scope&gt;import&lt;/scope&gt;<br>&lt;/dependency&gt;<br>  &lt;/dependencies&gt;<br>&lt;/dependencyManagement&gt;<br>  <br>&lt;dependencies&gt;  <br>    &lt;!-- eureka æœåŠ¡ç«¯ --&gt;<br>    &lt;dependency&gt;<br>        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br>        &lt;artifactId&gt;spring-cloud-starter-eureka-server&lt;/artifactId&gt;<br>    &lt;/dependency&gt;<br>&lt;/dependencies&gt;<br></code></pre></td></tr></table></figure><p>Spring Boot ä¸ SpringCloud æœ‰ç‰ˆæœ¬å…¼å®¹å…³ç³»ï¼Œå¦‚æœå¼•ç”¨ç‰ˆæœ¬ä¸å¯¹åº”ï¼Œé¡¹ç›®å¯åŠ¨ä¼šæŠ¥é”™ã€‚</p><h2 id="application-yml-é…ç½®å‚æ•°"><a href="#application-yml-é…ç½®å‚æ•°" class="headerlink" title="application.yml é…ç½®å‚æ•°"></a>application.yml é…ç½®å‚æ•°</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java">server:<br>    port: <span class="hljs-number">9000</span><br>    <br>eureka:<br>    instance:<br>        hostname: localhost   # eureka å®ä¾‹åç§°<br>    client:<br>        register-with-eureka: false # ä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±<br>        fetch-registry: false       # æ˜¯å¦æ£€ç´¢æœåŠ¡<br>        service-url:<br>            defaultZone: http:<span class="hljs-comment">//$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/  # æ³¨å†Œä¸­å¿ƒè®¿é—®åœ°å€</span><br></code></pre></td></tr></table></figure><h2 id="å¼€å¯æ³¨å†Œä¸­å¿ƒåŠŸèƒ½"><a href="#å¼€å¯æ³¨å†Œä¸­å¿ƒåŠŸèƒ½" class="headerlink" title="å¼€å¯æ³¨å†Œä¸­å¿ƒåŠŸèƒ½"></a>å¼€å¯æ³¨å†Œä¸­å¿ƒåŠŸèƒ½</h2><p>åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ  @EnableEurekaServer æ³¨è§£ã€‚</p><p>è‡³æ­¤ï¼Œå‡†å¤‡å·¥ä½œå®Œæˆï¼Œå¯åŠ¨é¡¹ç›®å®Œæˆåï¼Œæµè§ˆå™¨è®¿é—® <a href="http://localhost:9000/">http://localhost:9000</a> ï¼ŒæŸ¥çœ‹ Eureka æœåŠ¡ç›‘æ§ç•Œé¢ï¼Œå¦‚ä¸‹å›¾ï¼š<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/small.png" alt="springcloud-eureka-02">é€šè¿‡è¯¥ç½‘å€å¯ä»¥æŸ¥çœ‹æ³¨å†Œä¸­å¿ƒæ³¨å†ŒæœåŠ¡çš„ç›¸å…³ä¿¡æ¯ã€‚å½“å‰è¿˜æ²¡æœ‰æœåŠ¡æ³¨å†Œï¼Œå› æ­¤æ²¡æœ‰æœåŠ¡ä¿¡æ¯ã€‚</p><p>è¡¥å……ï¼š<a href="http://localhost:9000/">http://localhost:9000</a> æ˜¯ Eureka ç›‘ç®¡ç•Œé¢è®¿é—®åœ°å€ï¼Œè€Œ <a href="http://localhost:9000/eureka/">http://localhost:9000/eureka/</a> Eureka æ³¨å†ŒæœåŠ¡çš„åœ°å€ã€‚</p><h1 id="å®æˆ˜æ¼”ç»ƒ"><a href="#å®æˆ˜æ¼”ç»ƒ" class="headerlink" title="å®æˆ˜æ¼”ç»ƒ"></a>å®æˆ˜æ¼”ç»ƒ</h1><p>äº†è§£ Eureka çš„ç¯å¢ƒæ­å»ºåï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œå®æˆ˜ç›´è§‚çš„æ„Ÿå— Eureka çš„çœŸæ­£ä½œç”¨ï¼Œè¿™æ ·æ‰èƒ½æ¸…æ¥šæŒæ¡å’Œå­¦ä¹  Eureka ã€‚</p><p>æˆ‘ä»¬å†åˆ›å»ºä¸¤ä¸ª Spring Boot é¡¹ç›®ï¼Œä¸€ä¸ªåä¸º user-api ï¼Œç”¨äºæä¾›æ¥å£æœåŠ¡ï¼Œå¦ä¸€ä¸ªåä¸º user-webï¼Œç”¨äºè°ƒç”¨ user-api æ¥å£è·å–æ•°æ®ä¸æµè§ˆå™¨äº¤äº’ã€‚ æœåŠ¡å®ä¾‹ ç«¯å£ æè¿° eureka 9000 æ³¨å†Œä¸­å¿ƒï¼ˆEureka æœåŠ¡ç«¯ï¼‰ user-api 8081 æœåŠ¡æä¾›è€…ï¼ˆEureka å®¢æˆ·ç«¯ï¼‰ user-web 80 æœåŠ¡æ¶ˆè´¹è€…ï¼Œä¸æµè§ˆå™¨ç«¯äº¤äº’ï¼ˆEureka å®¢æˆ·ç«¯ï¼‰</p><h2 id="user-api-é¡¹ç›®éƒ¨åˆ†ä»£ç ï¼ˆæœåŠ¡æä¾›ï¼‰"><a href="#user-api-é¡¹ç›®éƒ¨åˆ†ä»£ç ï¼ˆæœåŠ¡æä¾›ï¼‰" class="headerlink" title="user-api é¡¹ç›®éƒ¨åˆ†ä»£ç ï¼ˆæœåŠ¡æä¾›ï¼‰"></a>user-api é¡¹ç›®éƒ¨åˆ†ä»£ç ï¼ˆæœåŠ¡æä¾›ï¼‰</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependency&gt;<br>&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br> <br>&lt;!-- eureka å®¢æˆ·ç«¯ --&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br>    &lt;artifactId&gt;spring-cloud-starter-eureka&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure><h2 id="é…ç½®å‚æ•°"><a href="#é…ç½®å‚æ•°" class="headerlink" title="é…ç½®å‚æ•°"></a>é…ç½®å‚æ•°</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java">server:<br>    port: <span class="hljs-number">8081</span><br> <br>spring:<br>    application:<br>        name: user-api<br> <br>eureka:<br>    instance:<br>        instance-id: user-api-<span class="hljs-number">8081</span><br>        prefer-ip-address: true # è®¿é—®è·¯å¾„å¯ä»¥æ˜¾ç¤º IP<br>    client:<br>        service-url:<br>            defaultZone: http:<span class="hljs-comment">//localhost:9000/eureka/  # æ³¨å†Œä¸­å¿ƒè®¿é—®åœ°å€</span><br></code></pre></td></tr></table></figure><h2 id="æœåŠ¡æ¥å£ï¼š"><a href="#æœåŠ¡æ¥å£ï¼š" class="headerlink" title="æœåŠ¡æ¥å£ï¼š"></a>æœåŠ¡æ¥å£ï¼š</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserService</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">getById</span><span class="hljs-params">(Integer id)</span></span>;<br>&#125;<br> <br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserService</span> </span>&#123;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Map&lt;Integer,User&gt; map;<br><br><span class="hljs-keyword">static</span> &#123;<br>map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>; i&lt;<span class="hljs-number">6</span>; i++) &#123;<br>map.put(i, <span class="hljs-keyword">new</span> User(i,<span class="hljs-string">&quot;test&quot;</span> +i , <span class="hljs-string">&quot;pwd&quot;</span> + i));<br>&#125;<br>&#125;<br> <br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">getById</span><span class="hljs-params">(Integer id)</span> </span>&#123;<br><span class="hljs-keyword">return</span> map.get(id);<br>&#125;<br> <br>&#125;<br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/provider/user&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> </span>&#123;<br><br><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> UserService userService;<br> <br><span class="hljs-meta">@RequestMapping(&quot;/get/&#123;id&#125;&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">get</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> </span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.userService.getById(id);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼šè¯¥ controller æ˜¯ç»™ user-web ä½¿ç”¨çš„ï¼ˆå†…éƒ¨æœåŠ¡ï¼‰ï¼Œä¸æ˜¯ç»™æµè§ˆå™¨ç«¯è°ƒç”¨çš„ã€‚</p><h2 id="å¼€å¯æœåŠ¡æ³¨å†ŒåŠŸèƒ½ï¼š"><a href="#å¼€å¯æœåŠ¡æ³¨å†ŒåŠŸèƒ½ï¼š" class="headerlink" title="å¼€å¯æœåŠ¡æ³¨å†ŒåŠŸèƒ½ï¼š"></a>å¼€å¯æœåŠ¡æ³¨å†ŒåŠŸèƒ½ï¼š</h2><p>åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ  @EnableEurekaClient æ³¨è§£ã€‚</p><p>å¯åŠ¨é¡¹ç›®å®Œæˆåï¼Œæµè§ˆå™¨è®¿é—® <a href="http://localhost:9000/">http://localhost:9000</a> æŸ¥çœ‹ Eureka æœåŠ¡ç›‘æ§ç•Œé¢ ï¼Œå¦‚ä¸‹å›¾ï¼š<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/small-20210227094510603.jpeg" alt="springcloud-eureka-03">ä»å›¾å¯çŸ¥ï¼Œuser ç›¸å…³æœåŠ¡ä¿¡æ¯å·²ç»æ³¨å†Œåˆ° Eureka æœåŠ¡ä¸­äº†ã€‚</p><p>è¡¥å……ï¼šåœ¨ä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬è¿˜çœ‹åˆ°ä¸€ä¸²çº¢è‰²çš„å­—ä½“ï¼Œé‚£æ˜¯å› ä¸º Eureka å¯åŠ¨äº†è‡ªæˆ‘ä¿æŠ¤çš„æœºåˆ¶ã€‚å½“ EurekaServer åœ¨çŸ­æ—¶é—´å†…ä¸¢å¤±è¿‡å¤šå®¢æˆ·ç«¯æ—¶ï¼ˆå¯èƒ½å‘ç”Ÿäº†ç½‘ç»œæ•…éšœï¼‰ï¼ŒEurekaServer å°†è¿›å…¥è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ã€‚è¿›å…¥è¯¥æ¨¡å¼åï¼ŒEurekaServer ä¼šä¿æŠ¤æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„ä¿¡æ¯ä¸è¢«åˆ é™¤ã€‚å½“ç½‘ç»œæ•…éšœæ¢å¤åï¼ŒEurekaServer ä¼šè‡ªåŠ¨é€€å‡ºè‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ã€‚</p><h2 id="user-web-é¡¹ç›®éƒ¨åˆ†ä»£ç ï¼ˆæœåŠ¡æ¶ˆè´¹ï¼‰"><a href="#user-web-é¡¹ç›®éƒ¨åˆ†ä»£ç ï¼ˆæœåŠ¡æ¶ˆè´¹ï¼‰" class="headerlink" title="user-web é¡¹ç›®éƒ¨åˆ†ä»£ç ï¼ˆæœåŠ¡æ¶ˆè´¹ï¼‰"></a>user-web é¡¹ç›®éƒ¨åˆ†ä»£ç ï¼ˆæœåŠ¡æ¶ˆè´¹ï¼‰</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependency&gt;<br>&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br> <br>&lt;!-- eureka å®¢æˆ·ç«¯ --&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br>    &lt;artifactId&gt;spring-cloud-starter-eureka&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure><h2 id="é…ç½®å‚æ•°-1"><a href="#é…ç½®å‚æ•°-1" class="headerlink" title="é…ç½®å‚æ•°"></a>é…ç½®å‚æ•°</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java">server:<br>  port: <span class="hljs-number">80</span><br> <br>spring:<br>  application:<br>    name: user-web<br>      <br>eureka:<br>  client:<br>    register-with-eureka: false # ä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±<br>    fetch-registry: true        # æ˜¯å¦æ£€ç´¢æœåŠ¡<br>    service-url:<br>      defaultZone: http:<span class="hljs-comment">//localhost:9000/eureka/  # æ³¨å†Œä¸­å¿ƒè®¿é—®åœ°å€</span><br></code></pre></td></tr></table></figure><h2 id="å®¢æˆ·ç«¯ï¼š"><a href="#å®¢æˆ·ç«¯ï¼š" class="headerlink" title="å®¢æˆ·ç«¯ï¼š"></a>å®¢æˆ·ç«¯ï¼š</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RestConfiguration</span> </span>&#123;<br> <br><span class="hljs-meta">@Bean</span><br><span class="hljs-meta">@LoadBalanced</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> RestTemplate <span class="hljs-title">getRestTemplate</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RestTemplate();<br>&#125;<br>&#125;<br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/user&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> </span>&#123;<br><br><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> RestTemplate restTemplate;<br><br><span class="hljs-comment">//@RequestMapping(&quot;get/&#123;id&#125;&quot;)</span><br><span class="hljs-comment">//public User get(@PathVariable(&quot;id&quot;) Integer id) throws Exception &#123;</span><br><span class="hljs-comment">//// æ²¡æœ‰ä½¿ç”¨ Eureka æ—¶ï¼Œuri ä¸ºæ¶ˆæ¯æä¾›è€…çš„åœ°å€ï¼Œéœ€è¦æŒ‡å®š ip å’Œ ç«¯å£</span><br><span class="hljs-comment">//return restTemplate.getForObject(new URI(&quot;http://localhost:8081/provider/user/get/&quot; + id), User.class);</span><br><span class="hljs-comment">//&#125;</span><br> <br>    <span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> DiscoveryClient client;<br><br><span class="hljs-meta">@RequestMapping(&quot;get/&#123;id&#125;&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">get</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br><br>List&lt;ServiceInstance&gt; list = <span class="hljs-keyword">this</span>.client.getInstances(<span class="hljs-string">&quot;USER-API&quot;</span>);<br>String uri = <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-keyword">for</span> (ServiceInstance instance : list) &#123;<br>        <span class="hljs-keyword">if</span> (instance.getUri() != <span class="hljs-keyword">null</span> &amp;&amp; !<span class="hljs-string">&quot;&quot;</span>.equals(instance.getUri())) &#123;<br>        uri = instance.getUri().toString();<br>        <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br><span class="hljs-keyword">return</span> restTemplate.getForObject(uri + <span class="hljs-string">&quot;/provider/user/get/&quot;</span> + id, User.class);<br>&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å¼€å¯æœåŠ¡å‘ç°åŠŸèƒ½ï¼š"><a href="#å¼€å¯æœåŠ¡å‘ç°åŠŸèƒ½ï¼š" class="headerlink" title="å¼€å¯æœåŠ¡å‘ç°åŠŸèƒ½ï¼š"></a>å¼€å¯æœåŠ¡å‘ç°åŠŸèƒ½ï¼š</h2><p>åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ  @EnableDiscoveryClient æ³¨è§£ã€‚</p><p>å¯åŠ¨é¡¹ç›®åï¼Œä½¿ç”¨æµè§ˆå™¨è®¿é—® user-web é¡¹ç›®æ¥å£ï¼Œè¿è¡Œç»“æœå¦‚ä¸‹ï¼š<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/small-20210227094510701.jpeg" alt="springcloud-eureka-04-2"></p><p><a href="https://github.com/cuixiaoyan/eureka">æºç ä¸‹è½½</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>å·¥å…·ç±»</tag>
      
      <tag>SpringCloud</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pythonç»Ÿè®¡å­—ç¬¦å‡ºç°æ¬¡æ•°(CounteråŒ…)ä»¥åŠtxtæ–‡ä»¶å†™å…¥</title>
    <link href="/blog/2021/02/27/Python%E7%BB%9F%E8%AE%A1%E5%AD%97%E7%AC%A6%E5%87%BA%E7%8E%B0%E6%AC%A1%E6%95%B0(Counter%E5%8C%85)%E4%BB%A5%E5%8F%8Atxt%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5/"/>
    <url>/blog/2021/02/27/Python%E7%BB%9F%E8%AE%A1%E5%AD%97%E7%AC%A6%E5%87%BA%E7%8E%B0%E6%AC%A1%E6%95%B0(Counter%E5%8C%85)%E4%BB%A5%E5%8F%8Atxt%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5/</url>
    
    <content type="html"><![CDATA[<h1 id="ç»Ÿè®¡å­—ç¬¦-å¯ä»¥åœ¨jiebaåˆ†è¯ä¹‹åä½¿ç”¨"><a href="#ç»Ÿè®¡å­—ç¬¦-å¯ä»¥åœ¨jiebaåˆ†è¯ä¹‹åä½¿ç”¨" class="headerlink" title="ç»Ÿè®¡å­—ç¬¦(å¯ä»¥åœ¨jiebaåˆ†è¯ä¹‹åä½¿ç”¨)"></a>ç»Ÿè®¡å­—ç¬¦(å¯ä»¥åœ¨jiebaåˆ†è¯ä¹‹åä½¿ç”¨)</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> Counter<br><span class="hljs-keyword">from</span> operator <span class="hljs-keyword">import</span> itemgetter<br> <br><span class="hljs-comment"># txt_listå¯ä»¥å†™æˆå‡½æ•°å‚æ•°è¿›è¡Œå¯¼å…¥</span><br>txt_list = [<span class="hljs-string">&#x27;åƒå¤&#x27;</span>,<span class="hljs-string">&#x27;äººé—´&#x27;</span>,<span class="hljs-string">&#x27;äººé—´&#x27;</span>,<span class="hljs-string">&#x27;é¾™&#x27;</span>,<span class="hljs-string">&#x27;é¾™&#x27;</span>,<span class="hljs-string">&#x27;é¾™&#x27;</span>,<span class="hljs-string">&#x27;å“ˆå“ˆå“ˆ&#x27;</span>,<span class="hljs-string">&#x27;äººæ‰&#x27;</span>,<span class="hljs-string">&#x27;åƒå¤&#x27;</span>,<span class="hljs-string">&#x27;åƒå¤&#x27;</span>]<br>c = Counter()<br><span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> txt_list:<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(x) &gt;= <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">if</span> x == <span class="hljs-string">&#x27;\r\n&#x27;</span> <span class="hljs-keyword">or</span> x == <span class="hljs-string">&#x27;\n&#x27;</span> <span class="hljs-keyword">or</span> x == <span class="hljs-string">&#x27; &#x27;</span>:<br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">else</span>:<br>            c[x] += <span class="hljs-number">1</span><br>print(<span class="hljs-string">&#x27;å¸¸ç”¨è¯é¢‘ç»Ÿè®¡ç»“æœ: \n&#x27;</span>)<br><span class="hljs-keyword">for</span> (k, v) <span class="hljs-keyword">in</span> c.most_common(<span class="hljs-number">4</span>): <span class="hljs-comment">#æ‰“å°æ’åå‰å››ä½</span><br>    print(<span class="hljs-string">&#x27;%s%s %s  %d&#x27;</span> % (<span class="hljs-string">&#x27;  &#x27;</span> * (<span class="hljs-number">3</span> ), k, <span class="hljs-string">&#x27;*&#x27;</span> * <span class="hljs-number">3</span>, v))<br> <br><span class="hljs-comment"># æŒ‰ç…§è¯é¢‘æ•°ä»å¤§åˆ°å°æ‰“å°</span><br>d = <span class="hljs-built_in">sorted</span>(c.items(),key=itemgetter(<span class="hljs-number">1</span>),reverse = <span class="hljs-literal">True</span>)<br><span class="hljs-keyword">for</span> ss,tt <span class="hljs-keyword">in</span> d:<br>    out_words=ss + <span class="hljs-string">&#x27;\t&#x27;</span> + <span class="hljs-built_in">str</span>(tt)<br>    print(out_words)<br></code></pre></td></tr></table></figure><h1 id="å¤šæ¬¡è¦†ç›–ï¼Œå¾ªç¯å†™å…¥æ–‡ä»¶"><a href="#å¤šæ¬¡è¦†ç›–ï¼Œå¾ªç¯å†™å…¥æ–‡ä»¶" class="headerlink" title="å¤šæ¬¡è¦†ç›–ï¼Œå¾ªç¯å†™å…¥æ–‡ä»¶"></a>å¤šæ¬¡è¦†ç›–ï¼Œå¾ªç¯å†™å…¥æ–‡ä»¶</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#å†™å…¥æ–‡ä»¶ï¼Œå¤šæ¬¡å†™å…¥ï¼Œåä¸€æ¬¡è¦†ç›–å‰ä¸€æ¬¡ï¼Œä½†æ˜¯out_wordsæœ¬èº«æ˜¯åœ¨å åŠ çš„</span><br><span class="hljs-comment">#å³ï¼šç¬¬ä¸€æ¬¡å†™å…¥çš„æ˜¯ï¼šåƒå¤\t3\n;ç¬¬äºŒæ¬¡å†™å…¥çš„æ˜¯ï¼šåƒå¤\t3\né¾™\t3\nï¼Œè¦†ç›–ä¸Šä¸€æ¬¡çš„æ•°æ®;</span><br><span class="hljs-comment">#ç¬¬ä¸‰æ¬¡æ˜¯ï¼šåƒå¤\t3\né¾™\t3\näººé—´\t2\nï¼Œç»§ç»­è¦†ç›–ä¸Šä¸€æ¬¡çš„æ•°æ®</span><br>out_words = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> ss,tt <span class="hljs-keyword">in</span> d:<br>    out_words=out_words + ss + <span class="hljs-string">&#x27;\t&#x27;</span> + <span class="hljs-built_in">str</span>(tt) + <span class="hljs-string">&#x27;\n&#x27;</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">r&quot;.\sss.txt&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>,encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        f.write(out_words+<span class="hljs-string">&#x27;\n&#x27;</span>)<br></code></pre></td></tr></table></figure><p>æ¯”å¦‚ï¼Œå¾ªç¯ä¸¤æ¬¡çš„ç»“æœæ˜¯ï¼š<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/1468269-20191016222751323-1357691422_1571276134547.png" alt="1468269-20191016222751323-1357691422"></p><p>ä¸€æ¬¡æ€§å†™å…¥æ–‡ä»¶ï¼Œä¸­é—´ä¸ä¼šè¦†ç›–å’Œå¤šæ¬¡å†™å…¥ï¼›ä½†æ˜¯å¦‚æœé‡å¤è¿è¡Œä»£ç ï¼Œåˆ™ä¼šè¦†ç›–ä¹‹å‰çš„å…¨éƒ¨å†…å®¹ï¼Œä¸€æ¬¡æ€§é‡æ–°å†™å…¥æ‰€æœ‰æ–°å†…å®¹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">out_words = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> ss,tt <span class="hljs-keyword">in</span> d:<br>    out_words=out_words + ss + <span class="hljs-string">&#x27;\t&#x27;</span> + <span class="hljs-built_in">str</span>(tt) + <span class="hljs-string">&#x27;\n&#x27;</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">r&quot;.\ttt.txt&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>,encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        f.write(out_words+<span class="hljs-string">&#x27;\n&#x27;</span>)<br></code></pre></td></tr></table></figure><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/1468269-20191016222730634-1775423973_1571276133624.png" alt="1468269-20191016222730634-1775423973"></p>]]></content>
    
    
    
    <tags>
      
      <tag>Python</tag>
      
      <tag>Counter</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¦‚ä½•æ­£ç¡®éå†åˆ é™¤Listä¸­çš„å…ƒç´ (æ™®é€šforå¾ªç¯ã€å¢å¼ºforå¾ªç¯ã€è¿­ä»£å™¨iteratorã€removeIf+æ–¹æ³•å¼•ç”¨)</title>
    <link href="/blog/2021/02/27/%E5%A6%82%E4%BD%95%E6%AD%A3%E7%A1%AE%E9%81%8D%E5%8E%86%E5%88%A0%E9%99%A4List%E4%B8%AD%E7%9A%84%E5%85%83%E7%B4%A0(%E6%99%AE%E9%80%9Afor%E5%BE%AA%E7%8E%AF%E3%80%81%E5%A2%9E%E5%BC%BAfor%E5%BE%AA%E7%8E%AF%E3%80%81%E8%BF%AD%E4%BB%A3%E5%99%A8iterator%E3%80%81removeIf+%E6%96%B9%E6%B3%95%E5%BC%95%E7%94%A8)/"/>
    <url>/blog/2021/02/27/%E5%A6%82%E4%BD%95%E6%AD%A3%E7%A1%AE%E9%81%8D%E5%8E%86%E5%88%A0%E9%99%A4List%E4%B8%AD%E7%9A%84%E5%85%83%E7%B4%A0(%E6%99%AE%E9%80%9Afor%E5%BE%AA%E7%8E%AF%E3%80%81%E5%A2%9E%E5%BC%BAfor%E5%BE%AA%E7%8E%AF%E3%80%81%E8%BF%AD%E4%BB%A3%E5%99%A8iterator%E3%80%81removeIf+%E6%96%B9%E6%B3%95%E5%BC%95%E7%94%A8)/</url>
    
    <content type="html"><![CDATA[<p>éå†åˆ é™¤Listä¸­ç¬¦åˆæ¡ä»¶çš„å…ƒç´ ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š</p><ol><li>æ™®é€šforå¾ªç¯ 2.å¢å¼ºforå¾ªç¯ foreach 3.è¿­ä»£å™¨iterator 4.removeIf å’Œ æ–¹æ³•å¼•ç”¨ (ä¸€è¡Œä»£ç æå®š) å…¶ä¸­ä½¿ç”¨æ™®é€šforå¾ªç¯å®¹æ˜“é€ æˆé—æ¼å…ƒç´ çš„é—®é¢˜ï¼Œå¢å¼ºforå¾ªç¯foreachä¼šæŠ¥java.util.ConcurrentModificationExceptionå¹¶å‘ä¿®æ”¹å¼‚å¸¸ã€‚</li></ol><p>æ‰€ä»¥æ¨èä½¿ç”¨è¿­ä»£å™¨iteratorï¼Œæˆ–è€…JDK1.8ä»¥ä¸Šä½¿ç”¨lambdaè¡¨è¾¾å¼è¿›è¡ŒListçš„éå†åˆ é™¤å…ƒç´ æ“ä½œã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸Šè¿°å‡ ç§æ–¹æ³•çš„å…·ä½“åˆ†æï¼š</p><h1 id="æ™®é€šforå¾ªç¯"><a href="#æ™®é€šforå¾ªç¯" class="headerlink" title="æ™®é€šforå¾ªç¯"></a>æ™®é€šforå¾ªç¯</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/** </span><br><span class="hljs-comment"> * æ™®é€šforå¾ªç¯éå†åˆ é™¤å…ƒç´ </span><br><span class="hljs-comment"> */</span>  <br>    List&lt;Student&gt; students = <span class="hljs-keyword">this</span>.getStudents();  <br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;students.size(); i++) &#123;  <br>        <span class="hljs-keyword">if</span> (students.get(i).getId()%<span class="hljs-number">3</span> == <span class="hljs-number">0</span>) &#123;  <br>            Student student = students.get(i);  <br>            students.remove(student);  <br>        &#125;  <br>    &#125;<br></code></pre></td></tr></table></figure><p>ç”±äºåœ¨å¾ªç¯ä¸­åˆ é™¤å…ƒç´ åï¼Œlistçš„ç´¢å¼•ä¼šè‡ªåŠ¨å˜åŒ–ï¼Œlist.size()è·å–åˆ°çš„listé•¿åº¦ä¹Ÿä¼šå®æ—¶æ›´æ–°ï¼Œæ‰€ä»¥ä¼šé€ æˆæ¼æ‰è¢«åˆ é™¤å…ƒç´ åä¸€ä¸ªç´¢å¼•çš„å…ƒç´ ã€‚</p><p>æ¯”å¦‚å¾ªç¯åˆ°ç¬¬2ä¸ªå…ƒç´ æ—¶ä½ æŠŠå®ƒåˆ äº†ï¼Œæ¥ä¸‹æ¥å»è®¿é—®ç¬¬3ä¸ªå…ƒç´ ï¼Œå®é™…ä¸Šè®¿é—®åˆ°çš„æ˜¯åŸæ¥listçš„ç¬¬4ä¸ªå…ƒç´ ï¼Œå› ä¸ºåŸæ¥çš„ç¬¬3ä¸ªå…ƒç´ å˜æˆäº†ç°åœ¨çš„ç¬¬2ä¸ªå…ƒç´ ã€‚è¿™æ ·å°±é€ æˆäº†å…ƒç´ çš„é—æ¼ã€‚</p><h1 id="å¢å¼ºforå¾ªç¯-foreach"><a href="#å¢å¼ºforå¾ªç¯-foreach" class="headerlink" title="å¢å¼ºforå¾ªç¯ foreach"></a>å¢å¼ºforå¾ªç¯ foreach</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å¢å¼ºforå¾ªç¯éå†åˆ é™¤å…ƒç´ </span><br><span class="hljs-comment"> */</span><br>    List&lt;Student&gt; students = <span class="hljs-keyword">this</span>.getStudents();  <br>    <span class="hljs-keyword">for</span> (Student stu : students) &#123;  <br>        <span class="hljs-keyword">if</span> (stu.getId() == <span class="hljs-number">2</span>)   <br>            students.remove(stu);  <br>    &#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨foreachéå†å¾ªç¯åˆ é™¤ç¬¦åˆæ¡ä»¶çš„å…ƒç´ ï¼Œä¸ä¼šå‡ºç°æ™®é€šforå¾ªç¯çš„é—æ¼å…ƒç´ é—®é¢˜ï¼Œä½†æ˜¯ä¼šäº§ç”Ÿjava.util.ConcurrentModificationExceptionå¹¶å‘ä¿®æ”¹å¼‚å¸¸çš„é”™è¯¯ã€‚</p><p>æŠ¥ConcurrentModificationExceptioné”™è¯¯çš„åŸå› ï¼š</p><p>ã€€ã€€å…ˆæ¥çœ‹ä¸€ä¸‹JDKæºç ä¸­ArrayListçš„removeæºç æ˜¯æ€ä¹ˆå®ç°çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">remove</span><span class="hljs-params">(Object o)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (o == <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> index = <span class="hljs-number">0</span>; index &lt; size; index++)<br>                <span class="hljs-keyword">if</span> (elementData[index] == <span class="hljs-keyword">null</span>) &#123;<br>                    fastRemove(index);<br>                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>                &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> index = <span class="hljs-number">0</span>; index &lt; size; index++)<br>                <span class="hljs-keyword">if</span> (o.equals(elementData[index])) &#123;<br>                    fastRemove(index);<br>                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>                &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>    &#125;<br></code></pre></td></tr></table></figure><p>ä¸€èˆ¬æƒ…å†µä¸‹ç¨‹åºçš„æ‰§è¡Œè·¯å¾„ä¼šèµ°åˆ°elseè·¯å¾„ä¸‹æœ€ç»ˆè°ƒç”¨fastRemoveæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">fastRemove</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index)</span> </span>&#123;<br>        modCount++;<br>        <span class="hljs-keyword">int</span> numMoved = size - index - <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">if</span> (numMoved &gt; <span class="hljs-number">0</span>)<br>            System.arraycopy(elementData, index+<span class="hljs-number">1</span>, elementData, index,<br>                             numMoved);<br>        elementData[--size] = <span class="hljs-keyword">null</span>; <span class="hljs-comment">// clear to let GC do its work</span><br>    &#125;<br></code></pre></td></tr></table></figure><p>åœ¨fastRemoveæ–¹æ³•ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ç¬¬2è¡ŒæŠŠmodCountå˜é‡çš„å€¼åŠ ä¸€ï¼Œä½†åœ¨ArrayListè¿”å›çš„è¿­ä»£å™¨ä¼šåšè¿­ä»£å™¨å†…éƒ¨çš„ä¿®æ”¹æ¬¡æ•°æ£€æŸ¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">checkForComodification</span><span class="hljs-params">()</span> </span>&#123;<br>         <span class="hljs-keyword">if</span> (modCount != expectedModCount)<br>             <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ConcurrentModificationException();<br>     &#125;<br></code></pre></td></tr></table></figure><p>è€Œforeachå†™æ³•æ˜¯å¯¹å®é™…çš„Iterableã€hasNextã€nextæ–¹æ³•çš„ç®€å†™ï¼Œå› ä¸ºä¸Šé¢çš„remove(Object)æ–¹æ³•ä¿®æ”¹äº†modCountçš„å€¼ï¼Œæ‰€ä»¥æ‰ä¼šæŠ¥å‡ºå¹¶å‘ä¿®æ”¹å¼‚å¸¸ã€‚</p><p>è¦é¿å…è¿™ç§æƒ…å†µçš„å‡ºç°åˆ™åœ¨ä½¿ç”¨è¿­ä»£å™¨è¿­ä»£æ—¶ï¼ˆæ˜¾å¼æˆ–for-eachçš„éšå¼ï¼‰ä¸è¦ä½¿ç”¨Listçš„removeï¼Œæ”¹ä¸ºç”¨Iteratorçš„removeå³å¯ã€‚</p><h1 id="è¿­ä»£å™¨iterator"><a href="#è¿­ä»£å™¨iterator" class="headerlink" title="è¿­ä»£å™¨iterator"></a>è¿­ä»£å™¨iterator</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  è¿­ä»£å™¨iterator</span><br><span class="hljs-comment"> */</span><br>     List&lt;Student&gt; students = <span class="hljs-keyword">this</span>.getStudents();  <br>     System.out.println(students);  <br>     Iterator&lt;Student&gt; iterator = students.iterator();  <br>     <span class="hljs-keyword">while</span> (iterator .hasNext()) &#123;  <br>         Student student = iterator .next();  <br>         <span class="hljs-keyword">if</span> (iterator.getId() % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>)  <br>             iterator.remove();<span class="hljs-comment">//è¿™é‡Œè¦ä½¿ç”¨Iteratorçš„removeæ–¹æ³•ç§»é™¤å½“å‰å¯¹è±¡ï¼Œå¦‚æœä½¿ç”¨Listçš„removeæ–¹æ³•ï¼Œåˆ™åŒæ ·ä¼šå‡ºç°ConcurrentModificationException  </span><br>     &#125;<br></code></pre></td></tr></table></figure><p>ç”±ä¸Šè¿°foreachæŠ¥é”™çš„åŸå› ï¼Œæ³¨æ„è¦ä½¿ç”¨è¿­ä»£å™¨çš„removeæ–¹æ³•ï¼Œè€Œä¸æ˜¯Listçš„removeæ–¹æ³•ã€‚</p><h1 id="removeIf-å’Œ-æ–¹æ³•å¼•ç”¨"><a href="#removeIf-å’Œ-æ–¹æ³•å¼•ç”¨" class="headerlink" title="removeIf å’Œ æ–¹æ³•å¼•ç”¨"></a>removeIf å’Œ æ–¹æ³•å¼•ç”¨</h1><p>åœ¨JDK1.8ä¸­ï¼ŒCollectionä»¥åŠå…¶å­ç±»æ–°åŠ å…¥äº†removeIfæ–¹æ³•ï¼Œä½œç”¨æ˜¯æŒ‰ç…§ä¸€å®šè§„åˆ™è¿‡æ»¤é›†åˆä¸­çš„å…ƒç´ ã€‚</p><p>æ–¹æ³•å¼•ç”¨æ˜¯ä¹Ÿæ˜¯JDK1.8çš„æ–°ç‰¹æ€§ä¹‹ä¸€ã€‚æ–¹æ³•å¼•ç”¨é€šè¿‡æ–¹æ³•çš„åå­—æ¥æŒ‡å‘ä¸€ä¸ªæ–¹æ³•ï¼Œä½¿ç”¨ä¸€å¯¹å†’å· :: æ¥å®Œæˆå¯¹æ–¹æ³•çš„è°ƒç”¨ï¼Œå¯ä»¥ä½¿è¯­è¨€çš„æ„é€ æ›´ç´§å‡‘ç®€æ´ï¼Œå‡å°‘å†—ä½™ä»£ç ã€‚</p><p>ä½¿ç”¨removeIfå’Œæ–¹æ³•å¼•ç”¨åˆ é™¤Listä¸­ç¬¦åˆæ¡ä»¶çš„å…ƒç´ ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;String&gt; urls = <span class="hljs-keyword">this</span>.getUrls();  <br> <br><span class="hljs-comment">// ä½¿ç”¨æ–¹æ³•å¼•ç”¨åˆ é™¤urlsä¸­å€¼ä¸º&quot;null&quot;çš„å…ƒç´ </span><br>urls.removeIf(<span class="hljs-string">&quot;null&quot;</span>::equals);<br> <br></code></pre></td></tr></table></figure><p>ä½œä¸ºremoveIfçš„æ¡ä»¶ï¼Œä¸ºtrueæ—¶å°±åˆ é™¤å…ƒç´ ã€‚</p><p>ä½¿ç”¨removeIf å’Œ æ–¹æ³•å¼•ç”¨ï¼Œå¯ä»¥å°†åŸæœ¬éœ€è¦ä¸ƒå…«è¡Œçš„ä»£ç ï¼Œç¼©å‡åˆ°ä¸€è¡Œå³å¯å®Œæˆï¼Œä½¿ä»£ç çš„æ„é€ æ›´ç´§å‡‘ç®€æ´ï¼Œå‡å°‘å†—ä½™ä»£ç ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>List</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBootäºŒåä¸ªæ³¨è§£</title>
    <link href="/blog/2021/02/27/SpringBoot%E4%BA%8C%E5%8D%81%E4%B8%AA%E6%B3%A8%E8%A7%A3/"/>
    <url>/blog/2021/02/27/SpringBoot%E4%BA%8C%E5%8D%81%E4%B8%AA%E6%B3%A8%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h1 id="SpringBootApplication"><a href="#SpringBootApplication" class="headerlink" title="@SpringBootApplication"></a>@SpringBootApplication</h1><p>@SpringBootApplication æ³¨è§£ç”¨äºå£°æ˜è‡ªåŠ¨é…ç½®ï¼Œå³è®©Spring Boot è‡ªåŠ¨ä¸ºç¨‹åºè¿›è¡Œå¿…è¦çš„é…ç½®ï¼›@SpringBootApplication æ³¨è§£é…ç½®ç­‰åŒäº@Configurationã€@EnableAutoConfiguration å’Œ@ComponentScan ä¸‰ä¸ªæ³¨è§£çš„é…ç½®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.EnableAutoConfiguration;<br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.ComponentScan;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br> <br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-comment">/*@Configuration  ä¸‰è€…åªå’Œç­‰åŒäº @SpringBootApplication æ³¨è§£è¿›è¡Œè‡ªåŠ¨é…ç½®</span><br><span class="hljs-comment">@EnableAutoConfiguration</span><br><span class="hljs-comment">@ComponentScan*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JzxyApplication</span> </span>&#123;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        SpringApplication.run(JzxyApplication.class, args);<br>        <br>    &#125;<br> <br>&#125;<br></code></pre></td></tr></table></figure><h1 id="Contronller"><a href="#Contronller" class="headerlink" title="@Contronller"></a>@Contronller</h1><p>@Contronller æ³¨è§£ç”¨äºå®šä¹‰è¯¥ç±»å±äºæ§åˆ¶å™¨ç±»ï¼Œå› ä¸ºåœ¨Sping Boot é¡¹ç›®ä¸­æ˜¯ç”±æ§åˆ¶å™¨è´Ÿè´£å°†ç”¨æˆ·è¯·æ±‚çš„URL è½¬å‘åˆ°å¯¹åº”çš„æœåŠ¡æ¥å£ï¼ˆService æœåŠ¡å±‚ï¼‰ï¼ŒSoä½¿ç”¨å…¶æ˜¯å¿…ä¸å¯å°‘ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å®šä¹‰æ§åˆ¶å™¨ç±» <span class="hljs-doctag">@Controller</span> </span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Controller</span><br><span class="hljs-meta">@RequestMapping(&quot;/demon/linux&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LinuxUsersController</span> </span>&#123;<br> <br>    <span class="hljs-meta">@RequestMapping(&quot;/add/host&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Map <span class="hljs-title">getLinuxConn</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> List&lt;LinuxConnEntity&gt; list)</span> </span>&#123;<br>        Map resultMap = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">return</span> list == <span class="hljs-keyword">null</span><br>                ? setResult(resultMap, Constant.ZERO, Constant.REQUEST_NULL_MSG)<br>                : linuxUsersServiceImpl.createLinuxConn(list);<br> <br>    &#125;<br></code></pre></td></tr></table></figure><h1 id="ResponseBody"><a href="#ResponseBody" class="headerlink" title="@ResponseBody"></a>@ResponseBody</h1><p>@ResponseBody æ³¨è§£è¡¨ç¤ºè¯¥æ–¹æ³•çš„è¿”å›ç»“æœç›´æ¥å†™å…¥HTTP çš„Response Body ä¸­ï¼Œè¯¥æ³¨è§£ä¸€èˆ¬åœ¨å¼‚æ­¥è·å–æ•°æ®æ—¶ä½¿ç”¨ï¼Œç”¨äºæ„å»ºRESTful çš„APIï¼›å¦å¤–ï¼Œåœ¨ä½¿ç”¨@RequestMapping æ³¨è§£åè¿”å›å€¼é€šå¸¸ä¼šè§£æä¸ºè·¯å¾„è·³è½¬ï¼Œè€Œåœ¨åŠ ä¸Šäº†@ResponseBody æ³¨è§£åï¼Œè¿”å›ç»“æœåˆ™ä¸ä¼šè¢«è§£æä¸ºè·¯å¾„è€Œæ˜¯ç›´æ¥å†™å…¥HTTP Response Body ä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¼‚æ­¥è·å–json æ•°æ®ï¼ŒåŠ ä¸Š<span class="hljs-doctag">@responsebody</span> æ³¨è§£åï¼Œä¼šç›´æ¥è¿”å›json æ•°æ®</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-meta">@RequestMapping(&quot;/responsebody&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> LinuxUserEntity <span class="hljs-title">testOne</span><span class="hljs-params">(LinuxUserEntity linuxUserEntity)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> linuxUsersServiceImpl.test();<br>        <span class="hljs-number">9</span>     &#125;<br></code></pre></td></tr></table></figure><h1 id="RestController"><a href="#RestController" class="headerlink" title="@RestController"></a>@RestController</h1><p>@RestController æ³¨è§£ç”¨äºæ ‡æ³¨æ§åˆ¶å±‚ç»„ä»¶ï¼Œå…¶æ˜¯@ResponseBody å’Œ@Contronller ä¸¤ä¸ªæ³¨è§£çš„é›†åˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@RestController</span> ç­‰ä»·äº<span class="hljs-doctag">@Controller</span> å’Œ <span class="hljs-doctag">@ResponseBody</span> ä¸¤ä¸ªæ³¨è§£çš„é›†åˆ</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/responsebody/linux&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LinuxUsersController</span> </span>&#123;<br> <br>    <span class="hljs-meta">@RequestMapping(&quot;/responsebody&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> LinuxUserEntity <span class="hljs-title">testOne</span><span class="hljs-params">(LinuxUserEntity linuxUserEntity)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> linuxUsersServiceImpl.test();<br>        <span class="hljs-number">12</span>     &#125;<br></code></pre></td></tr></table></figure><h1 id="RequestMapping"><a href="#RequestMapping" class="headerlink" title="@RequestMapping"></a>@RequestMapping</h1><p>@RequestMapping æ˜¯æä¾›è·¯ç”±ä¿¡æ¯çš„æ³¨è§£ï¼Œå…¶æ˜¯è´Ÿè´£URL åˆ°Controller ä¸­çš„å…·ä½“å‡½æ•°çš„æ˜ å°„ï¼›æ­¤å¤–ï¼Œè¯¥æ³¨è§£åçš„æ‹¬å·å†…ç»å¸¸ä¼šä½¿ç”¨å¦‚ä¸‹å…­ä¸ªå±æ€§ï¼š</p><ol><li>paramï¼šæŒ‡å®šè¯·æ±‚request ä¸­å¿…é¡»åŒ…å«æŸäº›å‚æ•°ï¼Œå¦åˆ™ä¸å¤„ç†è¯¥æ–¹æ³•ï¼›</li><li>headerï¼šæŒ‡å®šè¯·æ±‚request ä¸­å¿…é¡»åŒ…å«æŸäº›æŒ‡å®šçš„header å€¼ï¼Œå¦åˆ™ä¸å¤„ç†è¯¥æ–¹æ³•ï¼›</li><li>valueï¼šæŒ‡å®šè¯·æ±‚çš„å®é™…åœ°å€ï¼›</li><li>methodï¼šæŒ‡å®šè¯·æ±‚çš„æ–¹æ³•method ç±»å‹ï¼Œé€šå¸¸è®¾è®¡ä¸ºRESTful é£æ ¼çš„GETã€POSTã€PUT å’ŒDELETEï¼›</li><li>consumesï¼šæŒ‡å®šå¤„ç†è¯·æ±‚æäº¤å†…å®¹çš„å…·ä½“ç±»å‹ï¼ˆå³Content-Typeï¼‰ï¼Œå¦‚applicatin/json å’Œtext/html ç­‰ç±»å‹æ ¼å¼ï¼›</li></ol><p>6: producesï¼šæŒ‡å®šè¿”å›çš„å†…å®¹ç±»å‹ï¼Œè®¾ç½®è¯¥å±æ€§åä»…å½“request è¯·æ±‚å¤´ä¸­çš„Accept ç±»å‹ä¸­åŒ…å«è¯¥åˆ¶å®šç±»å‹æ—¶æ‰ä¼šè¿”å›ï¼Œéœ€è°¨æ…ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@RequestMapping</span> æä¾›è·¯ç”±ä¿¡æ¯çš„æ³¨è§£</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@RequestMapping(&quot;/responsebody&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> LinuxUserEntity <span class="hljs-title">testOne</span><span class="hljs-params">(LinuxUserEntity linuxUserEntity)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> linuxUsersServiceImpl.test();<br>    &#125;<br></code></pre></td></tr></table></figure><h1 id="EnableAutoConfiguration"><a href="#EnableAutoConfiguration" class="headerlink" title="@EnableAutoConfiguration"></a>@EnableAutoConfiguration</h1><p>@EnableAutoConfiguration æ˜¯Spring Boot è‡ªåŠ¨é…ç½®æ³¨è§£ï¼Œå…¶ä¼šæ ¹æ®é¡¹ç›®ä¸­æ·»åŠ çš„ä¾èµ–è‡ªåŠ¨é…ç½®Spring åº”ç”¨ï¼›æ¯”å¦‚Spring Boot è‡ªåŠ¨é…ç½®å†…åµŒtomcat çš„ç«¯å£ä¸º8080ï¼›è¿˜æœ‰è‡ªåŠ¨è½½å…¥åº”ç”¨ç¨‹åºæ‰€éœ€çš„æ‰€æœ‰Beanï¼Œè¿™ä¾èµ–äºSpring Boot åœ¨ç±»è·¯å¾„ä¸­çš„æŸ¥æ‰¾ç»“æœï¼Œå°±æ¯”å¦‚ä½ åœ¨classpath ä¸‹å­˜åœ¨HSQLDBï¼Œå¹¶ä¸”æ²¡æœ‰æ‰‹åŠ¨é…ç½®ä»»ä½•æ•°æ®åº“è¿æ¥Beanï¼Œé‚£ä¹ˆ@EnableAutoConfiguration æ³¨è§£å°±ä¼šè‡ªåŠ¨é…ç½®ä¸€ä¸ªå†…å­˜æ¨¡å‹ï¼ˆin-memoryï¼‰æ•°æ®åº“ã€‚</p><h1 id="ComponentScan"><a href="#ComponentScan" class="headerlink" title="@ComponentScan"></a>@ComponentScan</h1><p>@ComponentScan æ³¨è§£è¡¨ç¤ºè¯¥ç±»ä¼šè‡ªåŠ¨å‘ç°æ‰«æç»„ä»¶ï¼Œè‹¥æ‰«æåˆ°åŒ…å«@Componentã€@Controller å’Œ@Service ç­‰æ³¨è§£çš„ç±»ï¼Œåˆ™ä¼šå°†å…¶æ³¨å†Œä¸ºBeanï¼Œå¹¶ä¸”å¯ä»¥è‡ªåŠ¨æ”¶é›†æ‰€æœ‰çš„Spring ç»„ä»¶ï¼ŒåŒ…æ‹¬æœ‰@Configuration æ³¨è§£æ ‡æ³¨çš„ç±»ï¼›å¼€å‘ä¸­ç»å¸¸ä½¿ç”¨@ComponentScan æ³¨è§£æœç´¢Beansï¼Œå¹¶ç»“åˆ@Autowired æ³¨è§£å°†Beans æ³¨å…¥ï¼Œè‹¥æ²¡æœ‰è¿›è¡Œé…ç½®ï¼Œåˆ™Spring Boot åªä¼šæ‰«æSpringBootApplication å¯åŠ¨ç±»æ‰€åœ¨åŒ…ä¸‹åŠå…¶å­åŒ…ä¸‹çš„ä½¿ç”¨äº†@Serviceã€@Repository ç­‰æ³¨è§£çš„ç±»ã€‚</p><h1 id="Configuration"><a href="#Configuration" class="headerlink" title="@Configuration"></a>@Configuration</h1><p>@Configuration æ³¨è§£ä½œç”¨ç±»ä¼¼äºä¼ ç»Ÿçš„xml é…ç½®æ–‡ä»¶ï¼›ä¾‹å¦‚ï¼Œæœ‰ç¬¬ä¸‰æ–¹åº“éœ€è¦ç”¨åˆ°xml æ–‡ä»¶ï¼Œåˆ™å¯ä»¥é€šè¿‡æ·»åŠ @Configuration æ³¨è§£è¡¨ç¤ºè¯¥ç±»ä½œä¸ºé¡¹ç›®çš„é…ç½®ä¸»ç±»ï¼Œç„¶åä½¿ç”¨@ImportResource æ³¨è§£åŠ è½½xml é…ç½®æ–‡ä»¶å†…å®¹ã€‚</p><h1 id="Import"><a href="#Import" class="headerlink" title="@Import"></a>@Import</h1><p>@Import æ³¨è§£ä½œç”¨æ˜¯å¯¼å…¥å…¶å®ƒé…ç½®ç±»ã€‚</p><h1 id="ImportResource"><a href="#ImportResource" class="headerlink" title="@ImportResource"></a>@ImportResource</h1><p>@ImportResource æ³¨è§£ä½œç”¨æ˜¯åŠ è½½xml é…ç½®æ–‡ä»¶ã€‚</p><h1 id="Autowired"><a href="#Autowired" class="headerlink" title="@Autowired"></a>@Autowired</h1><p>@Autowired æ³¨è§£çš„ä½œç”¨æ˜¯è‡ªåŠ¨å¯¼å…¥ä¾èµ–çš„Beanï¼›å³æŠŠé…ç½®å¥½çš„Bean æ‹¿æ¥ç”¨ï¼Œå®Œæˆå±æ€§ã€æ–¹æ³•çš„ç»„è£…ï¼Œå®ƒå¯ä»¥å¯¹ç±»æˆå‘˜å˜é‡ã€æ–¹æ³•åŠæ„é€ å‡½æ•°è¿›è¡Œæ ‡æ³¨ï¼Œå®Œæˆè‡ªåŠ¨è£…é…çš„å·¥ä½œï¼›å¹¶ä¸”å½“åŠ ä¸Šæ ‡ç­¾ï¼ˆrequired=falseï¼‰æ—¶ï¼Œå°±ç®—æ‰¾ä¸åˆ°bean ä¹Ÿä¸æŠ¥é”™ï¼Œå…è®¸æ³¨å…¥ä¸ºç©ºã€‚</p><h1 id="Service"><a href="#Service" class="headerlink" title="@Service"></a>@Service</h1><p>@Service æ³¨è§£çš„ä½œç”¨æ˜¯æ ‡å¿—æŸç±»ä¸ºService å±‚ï¼Œæ˜¯Service æœåŠ¡å±‚ç»„ä»¶æ³¨è§£ã€‚</p><h1 id="Repository"><a href="#Repository" class="headerlink" title="@Repository"></a>@Repository</h1><p>@Repository æ³¨è§£ä½œç”¨æ˜¯æ ‡å¿—æŸç±»ä¸ºæ•°æ®å±‚ï¼Œå…¶å¯ç”¨äºç¡®ä¿DAO å±‚æˆ–è€…Repositories èƒ½æ­£å¸¸è½¬è¯‘ï¼›å½“@Repository æ³¨è§£ä¿®é¥°DAO æˆ–è€…repositories ç±»æ—¶ä¼šè¢«ComponentScan å‘ç°å¹¶é…ç½®ã€‚</p><h1 id="Bean"><a href="#Bean" class="headerlink" title="@Bean"></a>@Bean</h1><p>@Bean æ³¨è§£ç›¸å½“äºXML é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨çš„æ ‡ç­¾ï¼Œåˆå§‹åŒ–çš„æ—¶å€™åˆ›å»ºå¯¹è±¡ï¼Œå¹¶äº¤ç”±IOC å®¹å™¨ç®¡ç†ï¼›éœ€è¦æ³¨æ„çš„æ˜¯@Bean æ³¨è§£æ˜¯æ”¾åœ¨æ–¹æ³•çš„ä¸Šé¢ï¼Œè€Œä¸æ˜¯ç±»ï¼Œæ„æ€æ˜¯äº§ç”Ÿä¸€ä¸ªbeanï¼Œå¹¶äº¤ç»™spring ç®¡ç†ã€‚</p><h1 id="Value"><a href="#Value" class="headerlink" title="@Value"></a>@Value</h1><p>@Value æ³¨è§£ä½œç”¨æ˜¯æ³¨å…¥Spring Boot é…ç½®æ–‡ä»¶application.propertiesï¼Œå³è·å–application.properties é…ç½®æ–‡ä»¶ä¸­å±æ€§çš„å€¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Value(value = &quot;#&#123;VEHIVLE_TOPIC&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String VEHIVLE_TOPIC;<br></code></pre></td></tr></table></figure><h1 id="inject"><a href="#inject" class="headerlink" title="@inject"></a>@inject</h1><p>@inject æ³¨è§£ä½œç”¨ä¸@Autowired ç›¸åŒï¼Œä¸åŒçš„æ˜¯å…¶æ²¡æœ‰require å±æ€§ï¼Œå¼ºåˆ¶è¦æ±‚æ³¨å…¥ä¸èƒ½ä¸ºç©ºã€‚</p><h1 id="Component"><a href="#Component" class="headerlink" title="@Component"></a>@Component</h1><p>@Component æ³¨è§£æ³›æŒ‡ç»„ä»¶ï¼Œå³å½“ç»„ä»¶ä¸æ–¹ä¾¿å½’ç±»æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¯¥æ³¨è§£è¿›è¡Œæ ‡æ³¨å½’ç±»ã€‚</p><h1 id="Qualifier"><a href="#Qualifier" class="headerlink" title="@Qualifier"></a>@Qualifier</h1><p>@Qualifier æ³¨è§£ç”¨äºå½“æœ‰å¤šä¸ªåŒä¸€ç±»å‹çš„Bean æ—¶ï¼Œé€šè¿‡@Qualifier(â€œnameâ€) æ ¹æ®åå­—æ¥æŒ‡å®šæ³¨å…¥çš„Beanï¼›å…¶éœ€è¦é…åˆ@Autowired ä½¿ç”¨ï¼Œæ ¹æ®åå­—è¿›è¡Œæ³¨å…¥ï¼Œè¿›è¡Œæ›´ç»†ç²’åº¦çš„æ§åˆ¶å¦‚ä½•é€‰æ‹©è¦æ³¨å…¥çš„Beanã€‚</p><h1 id="Resouce"><a href="#Resouce" class="headerlink" title="@Resouce"></a>@Resouce</h1><p>@Resouce æ³¨è§£çš„ä½œç”¨ä¸@Autowired ç›¸ä¼¼ï¼Œéƒ½æ˜¯è‡ªåŠ¨æ³¨å…¥ä¾èµ–çš„Beanï¼›ä¸åŒçš„æ˜¯@Resource(name=â€nameâ€,type=â€typeâ€) å¤šäº†æ‹¬å·å†…çš„å±æ€§ï¼Œå½“æ²¡æœ‰æ‹¬å·å†…å†…å®¹çš„è¯ï¼Œé»˜è®¤byNameã€‚</p><h1 id="PathVariable"><a href="#PathVariable" class="headerlink" title="@PathVariable"></a>@PathVariable</h1><p>@PathVariable æ³¨è§£çš„ä½œç”¨æ˜¯è·å–è·¯å¾„å˜é‡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@RequestMapping</span> è·å–è·¯å¾„å˜é‡</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@RequestMapping(&quot;/ioc/get/&#123;address&#125;&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">testOne</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String address )</span> </span>&#123;<br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * è·å–å¾—åˆ°è·¯å¾„ä¸­address çš„å€¼</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-keyword">return</span> address;<br>    &#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>SpringBoot</tag>
      
      <tag>æ³¨è§£</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JavaåŸºæœ¬ç±»å‹å’ŒåŒ…è£…ç±»å‹</title>
    <link href="/blog/2021/02/27/Java%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B%E5%92%8C%E5%8C%85%E8%A3%85%E7%B1%BB%E5%9E%8B/"/>
    <url>/blog/2021/02/27/Java%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B%E5%92%8C%E5%8C%85%E8%A3%85%E7%B1%BB%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="åŒ…è£…ç±»å‹å¯ä»¥ä¸º-nullï¼Œè€ŒåŸºæœ¬ç±»å‹ä¸å¯ä»¥"><a href="#åŒ…è£…ç±»å‹å¯ä»¥ä¸º-nullï¼Œè€ŒåŸºæœ¬ç±»å‹ä¸å¯ä»¥" class="headerlink" title="åŒ…è£…ç±»å‹å¯ä»¥ä¸º nullï¼Œè€ŒåŸºæœ¬ç±»å‹ä¸å¯ä»¥"></a>åŒ…è£…ç±»å‹å¯ä»¥ä¸º nullï¼Œè€ŒåŸºæœ¬ç±»å‹ä¸å¯ä»¥</h1><p>åˆ«å°çœ‹è¿™ä¸€ç‚¹åŒºåˆ«ï¼Œå®ƒä½¿å¾—åŒ…è£…ç±»å‹å¯ä»¥åº”ç”¨äº POJO ä¸­ï¼Œè€ŒåŸºæœ¬ç±»å‹åˆ™ä¸è¡Œã€‚</p><p>POJO æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¿™é‡Œç¨å¾®è¯´æ˜ä¸€ä¸‹ã€‚</p><p>POJO çš„è‹±æ–‡å…¨ç§°æ˜¯ Plain Ordinary Java Objectï¼Œç¿»è¯‘ä¸€ä¸‹å°±æ˜¯ï¼Œç®€å•æ— è§„åˆ™çš„ Java å¯¹è±¡ï¼Œåªæœ‰å±æ€§å­—æ®µä»¥åŠ setter å’Œ getter æ–¹æ³•ï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Writer</span> </span>&#123;<br><span class="hljs-keyword">private</span> Integer age;<br><span class="hljs-keyword">private</span> String name;<br> <br><span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getAge</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">return</span> age;<br>&#125;<br> <br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setAge</span><span class="hljs-params">(Integer age)</span> </span>&#123;<br><span class="hljs-keyword">this</span>.age = age;<br>&#125;<br> <br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">return</span> name;<br>&#125;<br> <br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setName</span><span class="hljs-params">(String name)</span> </span>&#123;<br><span class="hljs-keyword">this</span>.name = name;<br>&#125;<br>&#125;<br> <br></code></pre></td></tr></table></figure><p>å’Œ POJO ç±»ä¼¼çš„ï¼Œè¿˜æœ‰æ•°æ®ä¼ è¾“å¯¹è±¡ DTOï¼ˆData Transfer Objectï¼Œæ³›æŒ‡ç”¨äºå±•ç¤ºå±‚ä¸æœåŠ¡å±‚ä¹‹é—´çš„æ•°æ®ä¼ è¾“å¯¹è±¡ï¼‰ã€è§†å›¾å¯¹è±¡ VOï¼ˆView Objectï¼ŒæŠŠæŸä¸ªé¡µé¢çš„æ•°æ®å°è£…èµ·æ¥ï¼‰ã€æŒä¹…åŒ–å¯¹è±¡ POï¼ˆPersistant Objectï¼Œå¯ä»¥çœ‹æˆæ˜¯ä¸æ•°æ®åº“ä¸­çš„è¡¨æ˜ å°„çš„ Java å¯¹è±¡ï¼‰ã€‚</p><p>é‚£ä¸ºä»€ä¹ˆ POJO çš„å±æ€§å¿…é¡»è¦ç”¨åŒ…è£…ç±»å‹å‘¢ï¼Ÿ æ•°æ®åº“çš„æŸ¥è¯¢ç»“æœå¯èƒ½æ˜¯ nullï¼Œå¦‚æœä½¿ç”¨åŸºæœ¬ç±»å‹çš„è¯ï¼Œå› ä¸ºè¦è‡ªåŠ¨æ‹†ç®±ï¼ˆå°†åŒ…è£…ç±»å‹è½¬ä¸ºåŸºæœ¬ç±»å‹ï¼Œæ¯”å¦‚è¯´æŠŠ Integer å¯¹è±¡è½¬æ¢æˆ int å€¼ï¼‰ï¼Œå°±ä¼šæŠ›å‡º NullPointerException çš„å¼‚å¸¸ã€‚</p><h1 id="åŒ…è£…ç±»å‹å¯ç”¨äºæ³›å‹ï¼Œè€ŒåŸºæœ¬ç±»å‹ä¸å¯ä»¥"><a href="#åŒ…è£…ç±»å‹å¯ç”¨äºæ³›å‹ï¼Œè€ŒåŸºæœ¬ç±»å‹ä¸å¯ä»¥" class="headerlink" title="åŒ…è£…ç±»å‹å¯ç”¨äºæ³›å‹ï¼Œè€ŒåŸºæœ¬ç±»å‹ä¸å¯ä»¥"></a>åŒ…è£…ç±»å‹å¯ç”¨äºæ³›å‹ï¼Œè€ŒåŸºæœ¬ç±»å‹ä¸å¯ä»¥</h1><p>æ³›å‹ä¸èƒ½ä½¿ç”¨åŸºæœ¬ç±»å‹ï¼Œå› ä¸ºä½¿ç”¨åŸºæœ¬ç±»å‹æ—¶ä¼šç¼–è¯‘å‡ºé”™ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;<span class="hljs-keyword">int</span>&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;(); <span class="hljs-comment">// æç¤º Syntax error, insert &quot;Dimensions&quot; to complete ReferenceType</span><br>List&lt;Integer&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br> <br></code></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºæ³›å‹åœ¨ç¼–è¯‘æ—¶ä¼šè¿›è¡Œç±»å‹æ“¦é™¤ï¼Œæœ€ååªä¿ç•™åŸå§‹ç±»å‹ï¼Œè€ŒåŸå§‹ç±»å‹åªèƒ½æ˜¯ Object ç±»åŠå…¶å­ç±»â€”â€”åŸºæœ¬ç±»å‹æ˜¯ä¸ªç‰¹ä¾‹ã€‚</p><h1 id="åŸºæœ¬ç±»å‹æ¯”åŒ…è£…ç±»å‹æ›´é«˜æ•ˆ"><a href="#åŸºæœ¬ç±»å‹æ¯”åŒ…è£…ç±»å‹æ›´é«˜æ•ˆ" class="headerlink" title="åŸºæœ¬ç±»å‹æ¯”åŒ…è£…ç±»å‹æ›´é«˜æ•ˆ"></a>åŸºæœ¬ç±»å‹æ¯”åŒ…è£…ç±»å‹æ›´é«˜æ•ˆ</h1><p>åŸºæœ¬ç±»å‹åœ¨æ ˆä¸­ç›´æ¥å­˜å‚¨çš„å…·ä½“æ•°å€¼ï¼Œè€ŒåŒ…è£…ç±»å‹åˆ™å­˜å‚¨çš„æ˜¯å †ä¸­çš„å¼•ç”¨ã€‚<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xMTc5Mzg5LTM4MGYzMDk4YWQ3YzQwN2UucG5n_1571020521890.jpeg" alt="åŸºæœ¬">å¾ˆæ˜¾ç„¶ï¼Œç›¸æ¯”è¾ƒäºåŸºæœ¬ç±»å‹è€Œè¨€ï¼ŒåŒ…è£…ç±»å‹éœ€è¦å ç”¨æ›´å¤šçš„å†…å­˜ç©ºé—´ã€‚å‡å¦‚æ²¡æœ‰åŸºæœ¬ç±»å‹çš„è¯ï¼Œå¯¹äºæ•°å€¼è¿™ç±»ç»å¸¸ä½¿ç”¨åˆ°çš„æ•°æ®æ¥è¯´ï¼Œæ¯æ¬¡éƒ½è¦é€šè¿‡ new ä¸€ä¸ªåŒ…è£…ç±»å‹å°±æ˜¾å¾—éå¸¸ç¬¨é‡ã€‚</p><h1 id="ä¸¤ä¸ªåŒ…è£…ç±»å‹çš„å€¼å¯ä»¥ç›¸åŒï¼Œä½†å´ä¸ç›¸ç­‰"><a href="#ä¸¤ä¸ªåŒ…è£…ç±»å‹çš„å€¼å¯ä»¥ç›¸åŒï¼Œä½†å´ä¸ç›¸ç­‰" class="headerlink" title="ä¸¤ä¸ªåŒ…è£…ç±»å‹çš„å€¼å¯ä»¥ç›¸åŒï¼Œä½†å´ä¸ç›¸ç­‰"></a>ä¸¤ä¸ªåŒ…è£…ç±»å‹çš„å€¼å¯ä»¥ç›¸åŒï¼Œä½†å´ä¸ç›¸ç­‰</h1><p>ä¸¤ä¸ªåŒ…è£…ç±»å‹çš„å€¼å¯ä»¥ç›¸åŒï¼Œä½†å´ä¸ç›¸ç­‰â€”â€”è¿™å¥è¯æ€ä¹ˆç†è§£å‘¢ï¼Ÿæ¥çœ‹ä¸€æ®µä»£ç å°±æ˜æ˜ç™½ç™½äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">Integer chenmo = <span class="hljs-keyword">new</span> Integer(<span class="hljs-number">10</span>);<br>Integer wanger = <span class="hljs-keyword">new</span> Integer(<span class="hljs-number">10</span>);<br> <br>System.out.println(chenmo == wanger); <span class="hljs-comment">// false</span><br>System.out.println(chenmo.equals(wanger )); <span class="hljs-comment">// true</span><br> <br></code></pre></td></tr></table></figure><p>ä¸¤ä¸ªåŒ…è£…ç±»å‹åœ¨ä½¿ç”¨â€œâ€è¿›è¡Œåˆ¤æ–­çš„æ—¶å€™ï¼Œåˆ¤æ–­çš„æ˜¯å…¶æŒ‡å‘çš„åœ°å€æ˜¯å¦ç›¸ç­‰ã€‚chenmo å’Œ wanger ä¸¤ä¸ªå˜é‡ä½¿ç”¨äº† new å…³é”®å­—ï¼Œå¯¼è‡´å®ƒä»¬åœ¨â€œâ€çš„æ—¶å€™è¾“å‡ºäº† falseã€‚</p><p>è€Œ chenmo.equals(wanger) çš„è¾“å‡ºç»“æœä¸º trueï¼Œæ˜¯å› ä¸º equals æ–¹æ³•å†…éƒ¨æ¯”è¾ƒçš„æ˜¯ä¸¤ä¸ª int å€¼æ˜¯å¦ç›¸ç­‰ã€‚æºç å¦‚ä¸‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> value;<br> <br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">intValue</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> value;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">equals</span><span class="hljs-params">(Object obj)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> Integer) &#123;<br>        <span class="hljs-keyword">return</span> value == ((Integer)obj).intValue();<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>&#125;<br> <br></code></pre></td></tr></table></figure><p>è™½ç„¶ chenmo å’Œ wanger çš„å€¼éƒ½æ˜¯ 10ï¼Œä½†ä»–ä»¬å¹¶ä¸ç›¸ç­‰ã€‚æ¢å¥è¯è¯´å°±æ˜¯ï¼šå°†â€œ==â€æ“ä½œç¬¦åº”ç”¨äºåŒ…è£…ç±»å‹æ¯”è¾ƒçš„æ—¶å€™ï¼Œå…¶ç»“æœå¾ˆå¯èƒ½ä¼šå’Œé¢„æœŸçš„ä¸ç¬¦ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>åŸºç¡€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pythonçˆ¬å›¾ç‰‡</title>
    <link href="/blog/2021/02/21/python%E7%88%AC%E5%9B%BE%E7%89%87/"/>
    <url>/blog/2021/02/21/python%E7%88%AC%E5%9B%BE%E7%89%87/</url>
    
    <content type="html"><![CDATA[<p><strong>è¿™ä¸ªä¾‹å­ä¹Ÿä¸æ˜¯æˆ‘æœ¬æ„,ä¸è¿‡å¥½åƒå¤§å®¶éƒ½å–œæ¬¢çˆ¬è¿™ç±»å›¾ç‰‡æœ¬äººæŠ±ç€å­¦ä¹ æŠ€æœ¯çš„æ€åº¦ æ·±å…¥ç ”ç©¶,äº†è§£å•¦å…¶è¿‡ç¨‹(æ»‘ç¨½)</strong></p><p>å»ºè®®: ç¼–è¯‘å™¨debugè¿è¡Œ,åŠ ä¸Šæµè§ˆå™¨å¼€å‘è€…è°ƒè¯• ä¼šæœ‰æ›´åŠ å®¹æ˜“äº†è§£</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># å¯¼å…¥requestsåº“</span><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-comment"># å¯¼å…¥æ–‡ä»¶æ“ä½œåº“</span><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> bs4<br><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> importlib<br><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">import</span> time<br>importlib.reload(sys)<br> <br> <br><span class="hljs-comment"># è¶Šå¤šè¶Šå¥½</span><br>meizi_headers = [<br>    <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/39.0.2171.95 Safari/537.36&quot;</span>,<br>    <span class="hljs-string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.153 Safari/537.36&quot;</span>,<br>    <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 6.1; WOW64; rv:30.0) Gecko/20100101 Firefox/30.0&quot;</span>,<br>    <span class="hljs-string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_2) AppleWebKit/537.75.14 (KHTML, like Gecko) Version/7.0.3 Safari/537.75.14&quot;</span>,<br>    <span class="hljs-string">&quot;Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.2; Win64; x64; Trident/6.0)&quot;</span>,<br>    <span class="hljs-string">&#x27;Mozilla/5.0 (Windows; U; Windows NT 5.1; it; rv:1.8.1.11) Gecko/20071127 Firefox/2.0.0.11&#x27;</span>,<br>    <span class="hljs-string">&#x27;Opera/9.25 (Windows NT 5.1; U; en)&#x27;</span>,<br>    <span class="hljs-string">&#x27;Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 1.1.4322; .NET CLR 2.0.50727)&#x27;</span>,<br>    <span class="hljs-string">&#x27;Mozilla/5.0 (compatible; Konqueror/3.5; Linux) KHTML/3.5.5 (like Gecko) (Kubuntu)&#x27;</span>,<br>    <span class="hljs-string">&#x27;Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.8.0.12) Gecko/20070731 Ubuntu/dapper-security Firefox/1.5.0.12&#x27;</span>,<br>    <span class="hljs-string">&#x27;Lynx/2.8.5rel.1 libwww-FM/2.14 SSL-MM/1.4.1 GNUTLS/1.2.9&#x27;</span>,<br>    <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux i686) AppleWebKit/535.7 (KHTML, like Gecko) Ubuntu/11.04 Chromium/16.0.912.77 Chrome/16.0.912.77 Safari/535.7&quot;</span>,<br>    <span class="hljs-string">&quot;Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:10.0) Gecko/20100101 Firefox/10.0&quot;</span>,<br>    <span class="hljs-string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.99 Safari/537.36&#x27;</span><br>]<br><span class="hljs-comment"># ç»™è¯·æ±‚æŒ‡å®šä¸€ä¸ªè¯·æ±‚å¤´æ¥æ¨¡æ‹Ÿchromeæµè§ˆå™¨</span><br><span class="hljs-keyword">global</span> headers<br>headers = &#123;<span class="hljs-string">&#x27;User-Agent&#x27;</span>: random.choice(meizi_headers)&#125;<br><span class="hljs-comment"># çˆ¬å›¾åœ°å€</span><br>mziTu = <span class="hljs-string">&#x27;http://www.mzitu.com/&#x27;</span><br><span class="hljs-comment"># å®šä¹‰å­˜å‚¨ä½ç½®</span><br><span class="hljs-keyword">global</span> save_path<br>save_path = <span class="hljs-string">&#x27;/Users/cuixiaoyan/Downloads/a&#x27;</span><br> <br> <br><span class="hljs-comment"># åˆ›å»ºæ–‡ä»¶å¤¹</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">createFile</span>(<span class="hljs-params">file_path</span>):</span><br>    <span class="hljs-keyword">if</span> os.path.exists(file_path) <span class="hljs-keyword">is</span> <span class="hljs-literal">False</span>:<br>        os.makedirs(file_path)<br>    <span class="hljs-comment"># åˆ‡æ¢è·¯å¾„è‡³ä¸Šé¢åˆ›å»ºçš„æ–‡ä»¶å¤¹</span><br>    os.chdir(file_path)<br> <br> <br><span class="hljs-comment"># ä¸‹è½½æ–‡ä»¶</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">download</span>(<span class="hljs-params">page_no, file_path</span>):</span><br>    <span class="hljs-keyword">global</span> headers<br>    res_sub = requests.get(page_no, headers=headers)<br>    <span class="hljs-comment"># è§£æhtml</span><br>    soup_sub = BeautifulSoup(res_sub.text, <span class="hljs-string">&#x27;html.parser&#x27;</span>)<br>    <span class="hljs-comment"># è·å–é¡µé¢çš„æ ç›®åœ°å€</span><br>    all_a = soup_sub.find(<span class="hljs-string">&#x27;div&#x27;</span>,class_=<span class="hljs-string">&#x27;postlist&#x27;</span>).find_all(<span class="hljs-string">&#x27;a&#x27;</span>,target=<span class="hljs-string">&#x27;_blank&#x27;</span>)<br>    count = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> all_a:<br>        count = count + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> (count % <span class="hljs-number">2</span>) == <span class="hljs-number">0</span>:<br>            headers = &#123;<span class="hljs-string">&#x27;User-Agent&#x27;</span>: random.choice(meizi_headers)&#125;<br>            print(<span class="hljs-string">&quot;å†…é¡µç¬¬å‡ é¡µï¼š&quot;</span> + <span class="hljs-built_in">str</span>(count))<br>            <span class="hljs-comment"># æå–href</span><br>            href = a.attrs[<span class="hljs-string">&#x27;href&#x27;</span>]<br>            print(<span class="hljs-string">&quot;å¥—å›¾åœ°å€ï¼š&quot;</span> + href)<br>            res_sub_1 = requests.get(href, headers=headers)<br>            soup_sub_1 = BeautifulSoup(res_sub_1.text, <span class="hljs-string">&#x27;html.parser&#x27;</span>)<br>            <span class="hljs-comment"># ------ è¿™é‡Œæœ€å¥½ä½¿ç”¨å¼‚å¸¸å¤„ç† ------</span><br>            <span class="hljs-keyword">try</span>:<br>                <span class="hljs-comment"># è·å–å¥—å›¾çš„æœ€å¤§æ•°é‡</span><br>                pic_max = soup_sub_1.find(<span class="hljs-string">&#x27;div&#x27;</span>, class_=<span class="hljs-string">&#x27;pagenavi&#x27;</span>).find_all(<span class="hljs-string">&#x27;span&#x27;</span>)[<span class="hljs-number">6</span>].text<br>                print(<span class="hljs-string">&quot;å¥—å›¾æ•°é‡ï¼š&quot;</span> + pic_max)<br>                <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">int</span>(pic_max) + <span class="hljs-number">1</span>):<br>                    <span class="hljs-comment"># å•ä½ä¸ºç§’ï¼Œ1-3 éšæœºæ•°</span><br>                    time.sleep(random.randint(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>))<br>                    headers = &#123;<span class="hljs-string">&#x27;User-Agent&#x27;</span>: random.choice(meizi_headers)&#125;<br>                    <span class="hljs-comment"># print(&quot;å­å†…é¡µç¬¬å‡ é¡µï¼š&quot; + str(j))</span><br>                    <span class="hljs-comment"># j intç±»å‹éœ€è¦è½¬å­—ç¬¦ä¸²</span><br>                    href_sub = href + <span class="hljs-string">&quot;/&quot;</span> + <span class="hljs-built_in">str</span>(j)<br>                    print(<span class="hljs-string">&quot;å›¾ç‰‡åœ°å€ï¼š&quot;</span>+href_sub)<br>                    res_sub_2 = requests.get(href_sub, headers=headers)<br>                    soup_sub_2 = BeautifulSoup(res_sub_2.text, <span class="hljs-string">&quot;html.parser&quot;</span>)<br>                    img = soup_sub_2.find(<span class="hljs-string">&#x27;div&#x27;</span>, class_=<span class="hljs-string">&#x27;main-image&#x27;</span>).find(<span class="hljs-string">&#x27;img&#x27;</span>)<br>                    <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(img, bs4.element.Tag):<br>                        <span class="hljs-comment"># æå–src</span><br>                        url = img.attrs[<span class="hljs-string">&#x27;src&#x27;</span>]<br>                        array = url.split(<span class="hljs-string">&#x27;/&#x27;</span>)<br>                        file_name = array[<span class="hljs-built_in">len</span>(array)-<span class="hljs-number">1</span>]<br>                        <span class="hljs-comment"># é˜²ç›—é“¾åŠ å…¥Referer</span><br>                        headers = &#123;<span class="hljs-string">&#x27;User-Agent&#x27;</span>: random.choice(meizi_headers), <span class="hljs-string">&#x27;Referer&#x27;</span>: url&#125;<br>                        img = requests.get(url, headers=headers)<br>                        print(<span class="hljs-string">&#x27;å¼€å§‹ä¿å­˜å›¾ç‰‡&#x27;</span>, img)<br>                        f = <span class="hljs-built_in">open</span>(file_name, <span class="hljs-string">&#x27;ab&#x27;</span>)<br>                        f.write(img.content)<br>                        print(file_name, <span class="hljs-string">&#x27;å›¾ç‰‡ä¿å­˜æˆåŠŸï¼&#x27;</span>)<br>                        f.close()<br>            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>                print(e)<br> <br> <br><span class="hljs-comment"># ä¸»æ–¹æ³•</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    res = requests.get(mziTu, headers=headers)<br>    <span class="hljs-comment"># ä½¿ç”¨è‡ªå¸¦çš„html.parserè§£æ</span><br>    soup = BeautifulSoup(res.text, <span class="hljs-string">&#x27;html.parser&#x27;</span>)<br>    <span class="hljs-comment"># åˆ›å»ºæ–‡ä»¶å¤¹</span><br>    createFile(save_path)<br>    <span class="hljs-comment"># è·å–é¦–é¡µæ€»é¡µæ•°</span><br>    img_max = soup.find(<span class="hljs-string">&#x27;div&#x27;</span>, class_=<span class="hljs-string">&#x27;nav-links&#x27;</span>).find_all(<span class="hljs-string">&#x27;a&#x27;</span>)[<span class="hljs-number">3</span>].text<br>    <span class="hljs-comment"># print(&quot;æ€»é¡µæ•°:&quot;+img_max)</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">int</span>(img_max) + <span class="hljs-number">1</span>):<br>        <span class="hljs-comment"># è·å–æ¯é¡µçš„URLåœ°å€</span><br>        <span class="hljs-keyword">if</span> i == <span class="hljs-number">1</span>:<br>            page = mziTu<br>        <span class="hljs-keyword">else</span>:<br>            page = mziTu + <span class="hljs-string">&#x27;page/&#x27;</span> + <span class="hljs-built_in">str</span>(i)<br>        file = save_path + <span class="hljs-string">&#x27;\\&#x27;</span> + <span class="hljs-built_in">str</span>(i)<br>        createFile(file)<br>        <span class="hljs-comment"># ä¸‹è½½æ¯é¡µçš„å›¾ç‰‡</span><br>        print(<span class="hljs-string">&quot;å¥—å›¾é¡µç ï¼š&quot;</span> + page)<br>        download(page, file)<br> <br> <br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>å·¥å…·ç±»</tag>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>My97Dateæ§ä»¶è®¾ç½®é»˜è®¤æ—¶é—´</title>
    <link href="/blog/2021/02/21/My97Date%E6%8E%A7%E4%BB%B6%E8%AE%BE%E7%BD%AE%E9%BB%98%E8%AE%A4%E6%97%B6%E9%97%B4/"/>
    <url>/blog/2021/02/21/My97Date%E6%8E%A7%E4%BB%B6%E8%AE%BE%E7%BD%AE%E9%BB%98%E8%AE%A4%E6%97%B6%E9%97%B4/</url>
    
    <content type="html"><![CDATA[<p><strong>éœ€æ±‚:è®¾ç½®å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´åˆå§‹åŒ–æ—¶é—´éš”ä¸ºä¸€å‘¨</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;startTime&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;startTime&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width: 45%&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;Wdate&quot;</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&quot;WdatePicker(&#123;maxDate: $(&#x27;#endTime&#x27;).val(),dateFmt:&#x27;yyyy-MM-dd&#x27; &#125;)&quot;</span> <span class="hljs-attr">ignore</span>=<span class="hljs-string">&quot;ignore&quot;</span>/&gt;</span><br> <br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;endTime&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;endTime&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width: 45%&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;Wdate&quot;</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&quot;WdatePicker(&#123;minDate: $(&#x27;#startTime&#x27;).val(),dateFmt:&#x27;yyyy-MM-dd&#x27; &#125;)&quot;</span><span class="hljs-attr">ignore</span>=<span class="hljs-string">&quot;ignore&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦è®¾ç½®ä¸€ä¸ªæœˆåçš„è¯ å°±åŠ 30</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs js">       <span class="hljs-built_in">Date</span>.prototype.pattern = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fmt</span>) </span>&#123;<br>           <span class="hljs-keyword">var</span> o = &#123;<br>               <span class="hljs-string">&quot;M+&quot;</span>: <span class="hljs-built_in">this</span>.getMonth() + <span class="hljs-number">1</span>, <span class="hljs-comment">//æœˆä»½</span><br>               <span class="hljs-string">&quot;d+&quot;</span>: <span class="hljs-built_in">this</span>.getDate(), <span class="hljs-comment">//æ—¥</span><br>               <span class="hljs-string">&quot;h+&quot;</span>: <span class="hljs-built_in">this</span>.getHours() % <span class="hljs-number">12</span> == <span class="hljs-number">0</span> ? <span class="hljs-number">12</span> : <span class="hljs-built_in">this</span>.getHours() % <span class="hljs-number">12</span>, <span class="hljs-comment">//å°æ—¶</span><br>               <span class="hljs-string">&quot;H+&quot;</span>: <span class="hljs-built_in">this</span>.getHours(), <span class="hljs-comment">//å°æ—¶</span><br>               <span class="hljs-string">&quot;m+&quot;</span>: <span class="hljs-built_in">this</span>.getMinutes(), <span class="hljs-comment">//åˆ†</span><br>               <span class="hljs-string">&quot;s+&quot;</span>: <span class="hljs-built_in">this</span>.getSeconds(), <span class="hljs-comment">//ç§’</span><br>               <span class="hljs-string">&quot;q+&quot;</span>: <span class="hljs-built_in">Math</span>.floor((<span class="hljs-built_in">this</span>.getMonth() + <span class="hljs-number">3</span>) / <span class="hljs-number">3</span>), <span class="hljs-comment">//å­£åº¦</span><br>               <span class="hljs-string">&quot;S&quot;</span>: <span class="hljs-built_in">this</span>.getMilliseconds() <span class="hljs-comment">//æ¯«ç§’</span><br>           &#125;;<br>           <span class="hljs-keyword">var</span> week = &#123;<br>               <span class="hljs-string">&quot;0&quot;</span>: <span class="hljs-string">&quot;\u65e5&quot;</span>,<br>               <span class="hljs-string">&quot;1&quot;</span>: <span class="hljs-string">&quot;\u4e00&quot;</span>,<br>               <span class="hljs-string">&quot;2&quot;</span>: <span class="hljs-string">&quot;\u4e8c&quot;</span>,<br>               <span class="hljs-string">&quot;3&quot;</span>: <span class="hljs-string">&quot;\u4e09&quot;</span>,<br>               <span class="hljs-string">&quot;4&quot;</span>: <span class="hljs-string">&quot;\u56db&quot;</span>,<br>               <span class="hljs-string">&quot;5&quot;</span>: <span class="hljs-string">&quot;\u4e94&quot;</span>,<br>               <span class="hljs-string">&quot;6&quot;</span>: <span class="hljs-string">&quot;\u516d&quot;</span><br>           &#125;;<br>           <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/(y+)/</span>.test(fmt)) &#123;<br>               fmt = fmt.replace(<span class="hljs-built_in">RegExp</span>.$1, (<span class="hljs-built_in">this</span>.getFullYear() + <span class="hljs-string">&quot;&quot;</span>).substr(<span class="hljs-number">4</span> - <span class="hljs-built_in">RegExp</span>.$1.length));<br>           &#125;<br>           <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/(E+)/</span>.test(fmt)) &#123;<br>               fmt = fmt.replace(<span class="hljs-built_in">RegExp</span>.$1, ((<span class="hljs-built_in">RegExp</span>.$1.length &gt; <span class="hljs-number">1</span>) ? (<span class="hljs-built_in">RegExp</span>.$1.length &gt; <span class="hljs-number">2</span> ? <span class="hljs-string">&quot;\u661f\u671f&quot;</span> : <span class="hljs-string">&quot;\u5468&quot;</span>) : <span class="hljs-string">&quot;&quot;</span>) + week[<span class="hljs-built_in">this</span>.getDay() + <span class="hljs-string">&quot;&quot;</span>]);<br>           &#125;<br>           <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> k <span class="hljs-keyword">in</span> o) &#123;<br>               <span class="hljs-keyword">if</span> (<span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(<span class="hljs-string">&quot;(&quot;</span> + k + <span class="hljs-string">&quot;)&quot;</span>).test(fmt)) &#123;<br>                   fmt = fmt.replace(<span class="hljs-built_in">RegExp</span>.$1, (<span class="hljs-built_in">RegExp</span>.$1.length == <span class="hljs-number">1</span>) ? (o[k]) : ((<span class="hljs-string">&quot;00&quot;</span> + o[k]).substr((<span class="hljs-string">&quot;&quot;</span> + o[k]).length)));<br>               &#125;<br>           &#125;<br>           <span class="hljs-keyword">return</span> fmt;<br>       &#125;<br>       $(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>           <span class="hljs-keyword">var</span> dt = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();<br>           <span class="hljs-comment">//$(&quot;#startTime&quot;).val(dt.pattern(&quot;yyyy-MM-dd hh:mm:ss&quot;));</span><br>           $(<span class="hljs-string">&quot;#startTime&quot;</span>).val(dt.pattern(<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>));<br>           dt.setDate(dt.getDate() + <span class="hljs-number">7</span>);<span class="hljs-comment">//è·å–ä¸ƒå¤©åçš„æ—¥æœŸ</span><br>           $(<span class="hljs-string">&quot;#endTime&quot;</span>).val(dt.pattern(<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>));<br><br>       &#125;);<br><span class="hljs-keyword">var</span> url = <span class="hljs-string">&#x27;multitaskEchartsController.do?getAchievement&#x27;</span>;<br>       url += <span class="hljs-string">&#x27;&amp;startTime=&#x27;</span> + $(<span class="hljs-string">&quot;#startTime&quot;</span>).val()<br>       url += <span class="hljs-string">&#x27;&amp;endTime=&#x27;</span> + $(<span class="hljs-string">&quot;#endTime&quot;</span>).val()<br><br>       <span class="hljs-keyword">var</span> dt = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();<br>       <span class="hljs-comment">//$(&quot;#startTime&quot;).val(dt.pattern(&quot;yyyy-MM-dd hh:mm:ss&quot;));</span><br>       $(<span class="hljs-string">&quot;#startTime&quot;</span>).val(dt.pattern(<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>));<br>       dt.setDate(dt.getDate() + <span class="hljs-number">7</span>);<span class="hljs-comment">//è·å–ä¸ƒå¤©åçš„æ—¥æœŸ</span><br>       $(<span class="hljs-string">&quot;#endTime&quot;</span>).val(dt.pattern(<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>));<br></code></pre></td></tr></table></figure><p>æ•ˆæœå¦‚ä¸‹<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/QQ20191011-113936@2x_1570765228201.png" alt="QQ20191011-113936@2x"></p>]]></content>
    
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>My97Date</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JSONæ•°ç»„å½¢å¼å­—ç¬¦ä¸²è½¬æ¢ä¸ºMapæ•°ç»„</title>
    <link href="/blog/2021/02/21/JSON%E6%95%B0%E7%BB%84%E5%BD%A2%E5%BC%8F%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%AC%E6%8D%A2%E4%B8%BAMap%E6%95%B0%E7%BB%84/"/>
    <url>/blog/2021/02/21/JSON%E6%95%B0%E7%BB%84%E5%BD%A2%E5%BC%8F%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%AC%E6%8D%A2%E4%B8%BAMap%E6%95%B0%E7%BB%84/</url>
    
    <content type="html"><![CDATA[<p><strong>é˜¿é‡Œå·´å·´å°è£…çš„FastJSONæ¥è½¬æ¢JSONæ•°ç»„å½¢å¼å­—ç¬¦ä¸²</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.zkn.newlearn.json;<br> <br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSONArray;<br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSONObject;<br> <br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Map;<br> <br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è¿™é‡Œæˆ‘ç”¨åˆ°çš„æ˜¯ç¬¬ä¸€ç§æ–¹å¼</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JsonToMapTest02</span> </span>&#123;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span></span>&#123;<br> <br>        String strArr = <span class="hljs-string">&quot;[&#123;\&quot;0\&quot;:\&quot;zhangsan\&quot;,\&quot;1\&quot;:\&quot;lisi\&quot;,\&quot;2\&quot;:\&quot;wangwu\&quot;,\&quot;3\&quot;:\&quot;maliu\&quot;&#125;,&quot;</span> +<br>                <span class="hljs-string">&quot;&#123;\&quot;00\&quot;:\&quot;zhangsan\&quot;,\&quot;11\&quot;:\&quot;lisi\&quot;,\&quot;22\&quot;:\&quot;wangwu\&quot;,\&quot;33\&quot;:\&quot;maliu\&quot;&#125;]&quot;</span>;<br>        <span class="hljs-comment">//ç¬¬ä¸€ç§æ–¹å¼</span><br>        List&lt;Map&lt;String,String&gt;&gt; listObjectFir = (List&lt;Map&lt;String,String&gt;&gt;) JSONArray.parse(strArr);<br>        System.out.println(<span class="hljs-string">&quot;åˆ©ç”¨JSONArrayä¸­çš„parseæ–¹æ³•æ¥è§£æjsonæ•°ç»„å­—ç¬¦ä¸²&quot;</span>);<br>        <span class="hljs-keyword">for</span>(Map&lt;String,String&gt; mapList : listObjectFir)&#123;<br>            <span class="hljs-keyword">for</span> (Map.Entry entry : mapList.entrySet())&#123;<br>               System.out.println( entry.getKey()  + <span class="hljs-string">&quot;  &quot;</span> +entry.getValue());<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">//ç¬¬äºŒç§æ–¹å¼</span><br>        List&lt;Map&lt;String,String&gt;&gt; listObjectSec = JSONArray.parseObject(strArr,List.class);<br>        System.out.println(<span class="hljs-string">&quot;åˆ©ç”¨JSONArrayä¸­çš„parseObjectæ–¹æ³•å¹¶æŒ‡å®šè¿”å›ç±»å‹æ¥è§£æjsonæ•°ç»„å­—ç¬¦ä¸²&quot;</span>);<br>        <span class="hljs-keyword">for</span>(Map&lt;String,String&gt; mapList : listObjectSec)&#123;<br>            <span class="hljs-keyword">for</span> (Map.Entry entry : mapList.entrySet())&#123;<br>                System.out.println( entry.getKey()  + <span class="hljs-string">&quot;  &quot;</span> +entry.getValue());<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">//ç¬¬ä¸‰ç§æ–¹å¼</span><br>        JSONArray listObjectThir = JSONArray.parseArray(strArr);<br>        System.out.println(<span class="hljs-string">&quot;åˆ©ç”¨JSONArrayä¸­çš„parseArrayæ–¹æ³•æ¥è§£æjsonæ•°ç»„å­—ç¬¦ä¸²&quot;</span>);<br>        <span class="hljs-keyword">for</span>(Object mapList : listObjectThir)&#123;<br>            <span class="hljs-keyword">for</span> (Object entry : ((Map)mapList).entrySet())&#123;<br>                System.out.println(((Map.Entry)entry).getKey()  + <span class="hljs-string">&quot;  &quot;</span> +((Map.Entry)entry).getValue());<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">//ç¬¬å››ç§æ–¹å¼</span><br>        List listObjectFour = JSONArray.parseArray(strArr,Map.class);<br>        System.out.println(<span class="hljs-string">&quot;åˆ©ç”¨JSONArrayä¸­çš„parseArrayæ–¹æ³•å¹¶æŒ‡å®šè¿”å›ç±»å‹æ¥è§£æjsonæ•°ç»„å­—ç¬¦ä¸²&quot;</span>);<br>        <span class="hljs-keyword">for</span>(Object mapList : listObjectFour)&#123;<br>            <span class="hljs-keyword">for</span> (Object entry : ((Map)mapList).entrySet())&#123;<br>                System.out.println(((Map.Entry)entry).getKey()  + <span class="hljs-string">&quot;  &quot;</span> +((Map.Entry)entry).getValue());<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">//ç¬¬äº”ç§æ–¹å¼</span><br>        JSONArray listObjectFifth = JSONObject.parseArray(strArr);<br>        System.out.println(<span class="hljs-string">&quot;åˆ©ç”¨JSONObjectä¸­çš„parseArrayæ–¹æ³•æ¥è§£æjsonæ•°ç»„å­—ç¬¦ä¸²&quot;</span>);<br>        <span class="hljs-keyword">for</span>(Object mapList : listObjectFifth)&#123;<br>            <span class="hljs-keyword">for</span> (Object entry : ((Map)mapList).entrySet())&#123;<br>                System.out.println(((Map.Entry)entry).getKey()  + <span class="hljs-string">&quot;  &quot;</span> +((Map.Entry)entry).getValue());<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">//ç¬¬å…­ç§æ–¹å¼</span><br>        List listObjectSix = JSONObject.parseArray(strArr,Map.class);<br>        System.out.println(<span class="hljs-string">&quot;åˆ©ç”¨JSONObjectä¸­çš„parseArrayæ–¹æ³•å¹¶æŒ‡å®šè¿”å›ç±»å‹æ¥è§£æjsonæ•°ç»„å­—ç¬¦ä¸²&quot;</span>);<br>        <span class="hljs-keyword">for</span>(Object mapList : listObjectSix)&#123;<br>            <span class="hljs-keyword">for</span> (Object entry : ((Map)mapList).entrySet())&#123;<br>                System.out.println(((Map.Entry)entry).getKey()  + <span class="hljs-string">&quot;  &quot;</span> +((Map.Entry)entry).getValue());<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">//ç¬¬ä¸ƒç§æ–¹å¼</span><br>        JSONArray listObjectSeven = JSON.parseArray(strArr);<br>        System.out.println(<span class="hljs-string">&quot;åˆ©ç”¨JSONä¸­çš„parseArrayæ–¹æ³•æ¥è§£æjsonæ•°ç»„å­—ç¬¦ä¸²&quot;</span>);<br>        <span class="hljs-keyword">for</span>(Object mapList : listObjectSeven)&#123;<br>            <span class="hljs-keyword">for</span> (Object entry : ((Map)mapList).entrySet())&#123;<br>                System.out.println(((Map.Entry)entry).getKey()  + <span class="hljs-string">&quot;  &quot;</span> +((Map.Entry)entry).getValue());<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">//ç¬¬å…«ç§æ–¹å¼</span><br>        List listObjectEigh = JSONObject.parseArray(strArr,Map.class);<br>        System.out.println(<span class="hljs-string">&quot;åˆ©ç”¨JSONä¸­çš„parseArrayæ–¹æ³•å¹¶æŒ‡å®šè¿”å›ç±»å‹æ¥è§£æjsonæ•°ç»„å­—ç¬¦ä¸²&quot;</span>);<br>        <span class="hljs-keyword">for</span>(Object mapList : listObjectEigh)&#123;<br>            <span class="hljs-keyword">for</span> (Object entry : ((Map)mapList).entrySet())&#123;<br>                System.out.println(((Map.Entry)entry).getKey()  + <span class="hljs-string">&quot;  &quot;</span> +((Map.Entry)entry).getValue());<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·ç±»</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>FastJSON</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>macOSå¤§æ›´æ–°å¯¼è‡´gitå’Œsvnæ— æ³•ä½¿ç”¨</title>
    <link href="/blog/2021/02/17/macOS%E5%A4%A7%E6%9B%B4%E6%96%B0%E5%AF%BC%E8%87%B4git%E5%92%8Csvn%E6%97%A0%E6%B3%95%E4%BD%BF%E7%94%A8/"/>
    <url>/blog/2021/02/17/macOS%E5%A4%A7%E6%9B%B4%E6%96%B0%E5%AF%BC%E8%87%B4git%E5%92%8Csvn%E6%97%A0%E6%B3%95%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<p>å¤§æ›´æ–°ä¹‹å æ›´æ–°ä¸€å †è‡ªå¸¦æ²¡ç”¨è½¯ä»¶ä¹‹å</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">$ git --version<br> <br>xcrun: error: <span class="hljs-function">invalid active developer <span class="hljs-title">path</span> <span class="hljs-params">(/Library/Developer/CommandLineTools)</span>, missing </span><br><span class="hljs-function">xcrun at: /Library/Developer/CommandLineTools/usr/bin/xcrun</span><br><span class="hljs-function"> </span><br><span class="hljs-function"> </span><br></code></pre></td></tr></table></figure><p>åŸå› æ˜¯ç³»ç»Ÿå‡çº§äº†ï¼Œä½†æ˜¯Xcodeçš„å‘½ä»¤è¡Œå·¥å…·æœªå‡çº§å¯¼è‡´çš„ï¼Œæ›´æ–°ä¸€ä¸‹å°±å¯ä»¥äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">$ xcode-select --install<br> <br>xcode-select: note: install requested <span class="hljs-keyword">for</span> command line developer tools<br>å¼¹çª—å®‰è£…å®Œé‡å¯ç«¯å£å†è¾“å…¥å‘½ä»¤å°±å¯ä»¥äº†<br> <br>$ git --version<br>git version <span class="hljs-number">2.17</span><span class="hljs-number">.2</span> (Apple Git-<span class="hljs-number">113</span>)<br> <br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>macOS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>macOS</tag>
      
      <tag>git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaä¸Šä¼ è§£å‹zipæ–‡ä»¶,å¹¶ä¸”è§£ææ–‡ä»¶é‡Œé¢çš„excelå’Œå›¾ç‰‡</title>
    <link href="/blog/2021/02/17/Java%E4%B8%8A%E4%BC%A0%E8%A7%A3%E5%8E%8Bzip%E6%96%87%E4%BB%B6,%E5%B9%B6%E4%B8%94%E8%A7%A3%E6%9E%90%E6%96%87%E4%BB%B6%E9%87%8C%E9%9D%A2%E7%9A%84excel%E5%92%8C%E5%9B%BE%E7%89%87/"/>
    <url>/blog/2021/02/17/Java%E4%B8%8A%E4%BC%A0%E8%A7%A3%E5%8E%8Bzip%E6%96%87%E4%BB%B6,%E5%B9%B6%E4%B8%94%E8%A7%A3%E6%9E%90%E6%96%87%E4%BB%B6%E9%87%8C%E9%9D%A2%E7%9A%84excel%E5%92%8C%E5%9B%BE%E7%89%87/</url>
    
    <content type="html"><![CDATA[<p><strong>éœ€æ±‚ï¼šä¸Šä¼ ä¸€ä¸ªzipæ–‡ä»¶ï¼Œzipæ–‡ä»¶é‡Œé¢åŒ…å«ä¸€ä¸ªexcelå’Œå¾ˆå¤šå›¾ç‰‡ï¼Œéœ€è¦æŠŠexcelé‡Œé¢çš„ä¿¡æ¯è§£æå‡ºæ¥ä¿å­˜åˆ°è¡¨ä¸­ï¼ŒåŒæ—¶å›¾ç‰‡ä¹Ÿè½¬åŒ–æˆbase64ä¿å­˜åˆ°æ•°æ®åº“è¡¨ä¸­ã€‚</strong></p><h1 id="ä¸€"><a href="#ä¸€" class="headerlink" title="ä¸€"></a>ä¸€</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è¿™ä¸ªdeomoå…¥å‚çš„ç±»å‹æ˜¯MultipartFileï¼Œå¾ˆå¤šç½‘ä¸Šçš„ä¾‹å­æ˜¯Fileç±»å‹</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> file (zip)</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> request</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> response</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PostMapping(&quot;/addPersonsFileOfZip&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">addPersonsFileOfZip</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;file&quot;)</span> MultipartFile file, HttpServletRequest request)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        String createdId = request.getParameter(KEY_CREATED_ID);<br>        <span class="hljs-comment">//æ­£å¸¸ä¸Šè¿™é‡Œéœ€è¦æ£€æŸ¥ä¸€ä¸‹createdIdæ˜¯å¦ä¸ºç©º</span><br>        <br>        <span class="hljs-comment">//åŸåˆ™ä¸Šè¿™ä¸ªuploadZipFilesAndParseæ–¹æ³•éœ€è¦å†™åˆ°serviceå’ŒserviceImplä¸­</span><br>        String result =uploadZipFilesAndParse(file,createdId);<br>        <span class="hljs-keyword">return</span>  result;<br>    &#125;<br></code></pre></td></tr></table></figure><h1 id="äºŒ"><a href="#äºŒ" class="headerlink" title="äºŒ"></a>äºŒ</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     *è¿”å›çš„æ˜¯æ‰¹æ¬¡å·</span><br><span class="hljs-comment">     *åŒæ—¶æˆ‘å¦å¤–å¼€äº†çº¿ç¨‹å¤„ç†zipæ–‡ä»¶é‡Œé¢çš„å›¾ç‰‡å’Œexcelï¼Œ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">uploadZipFilesAndParse</span><span class="hljs-params">(MultipartFile file, String createdId)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        String filename = file.getOriginalFilename();<br>        String fileType = filename.substring(filename.lastIndexOf(<span class="hljs-string">&quot;.&quot;</span>) + <span class="hljs-number">1</span>).toLowerCase(Locale.US);<br>        String uuid = UUID.randomUUID().toString();<br>        <span class="hljs-comment">//åˆ¤æ–­æ–‡ä»¶æ˜¯ä¸æ˜¯zipç±»å‹</span><br>        <span class="hljs-keyword">if</span>(fileType.equals(<span class="hljs-string">&quot;zip&quot;</span>))&#123;<br>            <br>            <span class="hljs-comment">//FileConfig.localtionæ˜¯é…ç½®æ–‡ä»¶å’Œconfigç±»ç”Ÿäº§çš„ï¼Œæˆ‘ä¼šåœ¨è¯„è®ºåŒºé™„ä¸Šè¿™äº›ä»£ç ï¼Œæµ‹è¯•demoçš„æ—¶å€™å¤§å®¶å¯ä»¥ç›´æ¥æŠŠFileConfig.localtionæ›¿æ¢æˆD:/test</span><br>            <span class="hljs-comment">//String desPath = FileConfig.localtion + File.separator + uuid.replaceAll(&quot;-&quot;, &quot;&quot;);</span><br>            String desPath = <span class="hljs-string">&quot;D:/test&quot;</span> + File.separator + uuid.replaceAll(<span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);<br>            <br>            <br>            <span class="hljs-comment">//ä¸‹é¢è¿™ä¸‰è¡Œçš„ä»£ç å°±æ˜¯æŠŠä¸Šä¼ æ–‡ä»¶copyåˆ°æœåŠ¡å™¨ï¼Œä¸€å®šä¸è¦é—æ¼äº†ã€‚</span><br>            <span class="hljs-comment">//é—æ¼äº†è¿™ä¸ªä»£ç ï¼Œåœ¨æœ¬åœ°æµ‹è¯•ç¯å¢ƒä¸ä¼šå‡ºé—®é¢˜ï¼Œåœ¨æœåŠ¡å™¨ä¸Šä¸€å®šä¼šæŠ¥æ²¡æœ‰æ‰¾åˆ°æ–‡ä»¶çš„é”™è¯¯</span><br>            String savePath = FileConfig.localtion + File.separator;<br>            File savefile = <span class="hljs-keyword">new</span> File(savePath+filename);<br>            file.transferTo(savefile);<br>            <br>            FileUtil fileUtil = <span class="hljs-keyword">new</span> FileUtil();<br>            <span class="hljs-comment">//è§£å‹zipæ–‡ä»¶ï¼Œæˆ‘æ˜¯å†™åœ¨å…¬å…±ç±»é‡Œé¢ï¼ŒFileUtilç±»ä»£ç è¯„è®ºåŒºè§</span><br>            FileUtil.unZip(file, desPath,savePath);<br>            <span class="hljs-keyword">new</span> Thread(<span class="hljs-keyword">new</span> Runnable() &#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>                    List&lt;File&gt; fileList = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>                    fileList = fileUtil.getSubFiles(desPath,fileList);<br>                        <span class="hljs-keyword">for</span> (File oneFile : fileList)&#123;<br>                            <span class="hljs-keyword">if</span> (oneFile.getName().toLowerCase().endsWith(<span class="hljs-string">&quot;.xls&quot;</span>) || oneFile.getName().toLowerCase().endsWith(<span class="hljs-string">&quot;.xlsx&quot;</span>) ) &#123;<br>                                <span class="hljs-keyword">try</span> &#123;<br>                                    <span class="hljs-comment">//è§£æå¤„ç†excelæ–‡ä»¶</span><br>                                    parseExcelFile(oneFile,createdId,uuid);<br>                                &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                                    LogUtils.error(e.getMessage());<br>                                &#125;<br>                            &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(oneFile.getName().toLowerCase().endsWith(<span class="hljs-string">&quot;.jpg&quot;</span>)) &#123;<br>                                <span class="hljs-keyword">try</span> &#123;<br>                                    <span class="hljs-comment">//è§£æå¤„ç†å›¾ç‰‡æ–‡ä»¶</span><br>                                    parseImageFile(oneFile,createdId,uuid);<br>                                &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                                    LogUtils.error(e.getMessage());<br>                                &#125;<br>                            &#125;<br>                        &#125;    <br>                        <br>                        <span class="hljs-comment">//æœ€åè¦åˆ é™¤æ–‡ä»¶ï¼Œåˆ é™¤æ–‡ä»¶çš„æ–¹æ³•è§è¯„è®ºåŒºFileUtilç±»</span><br>                        FileUtil.clearFiles(desPath);<br>                        <br>                &#125;<br>            &#125;).start();            <br> <br>        &#125;<br>        <span class="hljs-keyword">return</span> uuid;<br>    &#125;<br></code></pre></td></tr></table></figure><h1 id="è§£å‹zipæ–‡ä»¶çš„unzipæ–¹æ³•"><a href="#è§£å‹zipæ–‡ä»¶çš„unzipæ–¹æ³•" class="headerlink" title="è§£å‹zipæ–‡ä»¶çš„unzipæ–¹æ³•"></a>è§£å‹zipæ–‡ä»¶çš„unzipæ–¹æ³•</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">unZip</span><span class="hljs-params">(MultipartFile  srcFile, String destDirPath,String savePath)</span> <span class="hljs-keyword">throws</span> RuntimeException, IOException </span>&#123;<br>        <span class="hljs-keyword">long</span> startTime = System.currentTimeMillis();<br>        <br>        File file = <span class="hljs-keyword">null</span>;  <br>        InputStream ins = srcFile.getInputStream();  <br>        file=<span class="hljs-keyword">new</span> File(savePath+srcFile.getOriginalFilename()); <br>        LogUtils.info(<span class="hljs-string">&quot;MultipartFile transform to File,MultipartFile name:&quot;</span>+srcFile.getOriginalFilename());<br>        inputStreamToFile(ins, file);  <br>        <br>        <span class="hljs-keyword">if</span> (!file.exists()) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(file.getPath() + <span class="hljs-string">&quot;,file is not found&quot;</span>);<br>        &#125;<br>        ZipFile zipFile = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            zipFile = <span class="hljs-keyword">new</span> ZipFile(file);<br>            Enumeration&lt;?&gt; entries = zipFile.entries();<br>            <span class="hljs-keyword">while</span> (entries.hasMoreElements()) &#123;<br>                ZipEntry entry = (ZipEntry) entries.nextElement();<br>                LogUtils.info(<span class="hljs-string">&quot;zipFile context name:&quot;</span>+entry.getName());<br>                <span class="hljs-keyword">if</span> (entry.isDirectory()) &#123;<br>                    String dirPath = destDirPath + File.separator+ entry.getName();<br>                    File dir = <span class="hljs-keyword">new</span> File(dirPath);<br>                    dir.mkdirs();<br>                &#125;<span class="hljs-keyword">else</span> &#123;<br>                    File targetFile = <span class="hljs-keyword">new</span> File(destDirPath + File.separator + entry.getName());<br>                    targetFile.setExecutable(<span class="hljs-keyword">true</span>);<br>                    <span class="hljs-keyword">if</span>(!targetFile.getParentFile().exists())&#123;<br>                        targetFile.getParentFile().mkdirs();<br>                    &#125;<br>                    targetFile.createNewFile();<br>                    InputStream is = zipFile.getInputStream(entry);<br>                    FileOutputStream fos = <span class="hljs-keyword">new</span> FileOutputStream(targetFile);<br>                    <span class="hljs-keyword">int</span> len;<br>                    <span class="hljs-keyword">byte</span>[] buf = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">1024</span>];<br>                    <span class="hljs-keyword">while</span> ((len = is.read(buf)) != -<span class="hljs-number">1</span>) &#123;<br>                        fos.write(buf, <span class="hljs-number">0</span>, len);<br>                    &#125;<br>                    fos.close();<br>                    is.close();<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">long</span> endTime = System.currentTimeMillis();<br>            LogUtils.info(<span class="hljs-string">&quot;unZip time--&gt;&quot;</span> + (endTime - startTime) + <span class="hljs-string">&quot; ms&quot;</span>);<br>        &#125;<span class="hljs-keyword">catch</span>(Exception e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;unzip error from FileUtil&quot;</span>, e);<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">if</span>(zipFile != <span class="hljs-keyword">null</span>)&#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    zipFile.close();<br>                &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>            <br>            <span class="hljs-comment">//MultipartFile change to file may create a temp file in the project root folder(delete the temp file)</span><br>            File del = <span class="hljs-keyword">new</span> File(file.toURI());  <br>            del.delete(); <br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><h1 id="inputStreamToFile"><a href="#inputStreamToFile" class="headerlink" title="inputStreamToFile"></a>inputStreamToFile</h1><p>unzipæ–¹æ³•ä¸­çš„inputStreamToFileæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„ç›®çš„æ˜¯æŠŠMultipartFileè½¬æˆFileç±»å‹ï¼Œä½†æ˜¯ä¼šåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œåˆ‡è®°è¦åˆ é™¤</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">inputStreamToFile</span><span class="hljs-params">(InputStream ins, File file)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            OutputStream os = <span class="hljs-keyword">new</span> FileOutputStream(file);<br>            <span class="hljs-keyword">int</span> bytesRead = <span class="hljs-number">0</span>;<br>            <span class="hljs-keyword">byte</span>[] buffer = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">8192</span>];<br>            <span class="hljs-keyword">while</span> ((bytesRead = ins.read(buffer, <span class="hljs-number">0</span>, <span class="hljs-number">8192</span>)) != -<span class="hljs-number">1</span>) &#123;<br>                os.write(buffer, <span class="hljs-number">0</span>, bytesRead);<br>            &#125;<br>            os.close();<br>            ins.close();<br>            LogUtils.info(<span class="hljs-string">&quot;MultipartFile transform to File completed!&quot;</span>);<br>        &#125;<span class="hljs-keyword">catch</span>(Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><h1 id="parseExcelFile"><a href="#parseExcelFile" class="headerlink" title="parseExcelFile"></a>parseExcelFile</h1><p>parseExcelFileæ–¹æ³•æ˜¯è§£æexcelçš„æ–¹æ³•ï¼Œé‡Œé¢åŒ…æ‹¬æˆ‘è‡ªå·±é¡¹ç›®çš„é€»è¾‘å¤„ç†ï¼Œå¤§å®¶å¯ä»¥åˆ é™¤è¿™äº›ä»£ç ï¼Œåªä¿ç•™è§£æexcelçš„ä»£ç å°±å¥½</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">parseExcelFile</span><span class="hljs-params">(File file,String createdId,String uuid)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <br>        LogUtils.info(<span class="hljs-string">&quot;file name:&quot;</span>+file.getName());<br>        FileInputStream is = <span class="hljs-keyword">new</span> FileInputStream(file); <br>        Workbook workbook = WorkbookFactory.create(is);<br>        Sheet sheet = workbook.getSheetAt(<span class="hljs-number">0</span>);<br>        <br>        <span class="hljs-keyword">int</span> firstRowIndex = sheet.getFirstRowNum() + <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">int</span> lastRowIndex = sheet.getLastRowNum();<br>        <br>        List&lt;VapBatchPersonInfo&gt; batchPersonList = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> rIndex = firstRowIndex; rIndex &lt;= lastRowIndex; rIndex++) &#123;<br>            <br>            VapBatchPersonInfo vapBatchPersonInfo  = <span class="hljs-keyword">new</span> VapBatchPersonInfo();<br>            Row row = sheet.getRow(rIndex);<br>            <span class="hljs-keyword">if</span> (row != <span class="hljs-keyword">null</span>) &#123;<br>                <span class="hljs-keyword">int</span> firstCellIndex = row.getFirstCellNum();<br>                <span class="hljs-keyword">int</span> lastCellIndex = row.getLastCellNum();<br>                JSONObject jsonObject = <span class="hljs-keyword">new</span> JSONObject();<br>                jsonObject.put(KEY_CREATED_ID, createdId);<br> <br>                Cell resultCell = row.createCell(lastCellIndex);<br>                Cell msgCell = row.createCell(lastCellIndex + <span class="hljs-number">1</span>);<br>                Boolean flag = <span class="hljs-keyword">false</span>;<br>                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> cIndex = firstCellIndex; cIndex &lt; lastCellIndex; cIndex++) &#123;<br>                    Cell cell = row.getCell(cIndex);<br>                    String titleName = sheet.getRow(<span class="hljs-number">0</span>).getCell(cIndex).toString();<br>                    String checkTitleName = checkTitleName(cIndex, titleName);<br>                    <span class="hljs-keyword">if</span> (!<span class="hljs-string">&quot;SUCCESS&quot;</span>.equals(checkTitleName)) &#123;<br>                        msgCell.setCellValue(checkTitleName);<br>                        resultCell.setCellValue(<span class="hljs-string">&quot;Failed&quot;</span>);<br>                        flag = <span class="hljs-keyword">true</span>;<br>                        <span class="hljs-keyword">break</span>;<br>                    &#125;<br>                    <span class="hljs-keyword">if</span> (cell != <span class="hljs-keyword">null</span>) &#123;<br>                        cell.setCellType(CellType.STRING);<br>                        jsonObject.put(titleName, cell.toString());<br>                    &#125;<br> <br>                &#125;<br>                <span class="hljs-keyword">if</span> (flag) &#123;<br>                    rIndex = <span class="hljs-number">0</span>;<br>                    lastRowIndex = <span class="hljs-number">0</span>;<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    vapBatchPersonInfo.setBatchNo(uuid);<br>                    vapBatchPersonInfo.setName(jsonObject.getString(<span class="hljs-string">&quot;fullName&quot;</span>));<br>                    vapBatchPersonInfo.setImageName(jsonObject.getString(<span class="hljs-string">&quot;imageName&quot;</span>));<br>                    vapBatchPersonInfo.setConfidenceThreshold(jsonObject.getString(<span class="hljs-string">&quot;confidenceThreshold&quot;</span>));<br>                    vapBatchPersonInfo.setCreatedId(jsonObject.getString(<span class="hljs-string">&quot;createdId&quot;</span>));<br>                    vapBatchPersonInfo.setIdentityNo(jsonObject.getString(<span class="hljs-string">&quot;identityNo&quot;</span>));<br>                    vapBatchPersonInfo.setCreatedDate(<span class="hljs-keyword">new</span> Date());<br>                    vapBatchPersonInfo.setLastUpdatedId(jsonObject.getString(<span class="hljs-string">&quot;createdId&quot;</span>));<br>                    vapBatchPersonInfo.setLastUpdatedDate(<span class="hljs-keyword">new</span> Date());<br>                    vapBatchPersonInfo.setStatus(TaskStatus.RUNNING);<br>                    batchPersonList.add(vapBatchPersonInfo);<br>                &#125;<br>            &#125;<br>        &#125;<br>        batchPersonInfoRepository.saveAll(batchPersonList);<br>        <br>    &#125;<br></code></pre></td></tr></table></figure><h1 id="è§£æå›¾ç‰‡çš„æ–¹æ³•"><a href="#è§£æå›¾ç‰‡çš„æ–¹æ³•" class="headerlink" title="è§£æå›¾ç‰‡çš„æ–¹æ³•"></a>è§£æå›¾ç‰‡çš„æ–¹æ³•</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">parseImageFile</span><span class="hljs-params">(File file, String createdId, String uuid)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <br>        String imgStr =<span class="hljs-string">&quot;&quot;</span>;<br>        FileInputStream fis = <span class="hljs-keyword">new</span> FileInputStream(file);<br>        <span class="hljs-keyword">byte</span>[] buffer = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[(<span class="hljs-keyword">int</span>) file.length()]; <br>        <span class="hljs-keyword">int</span> offset = <span class="hljs-number">0</span>; <br>        <span class="hljs-keyword">int</span> numRead = <span class="hljs-number">0</span>; <br>        <span class="hljs-keyword">while</span> (offset &lt; buffer.length &amp;&amp; (numRead = fis.read(buffer, offset, buffer.length - offset)) &gt;= <span class="hljs-number">0</span>) &#123;<br>            offset += numRead;<br>        &#125; <br>        <span class="hljs-keyword">if</span> (offset != buffer.length) &#123; <br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IOException(<span class="hljs-string">&quot;Could not completely read file &quot;</span> + file.getName()); <br>        &#125; <br>        fis.close(); <br>        Base64 encoder = <span class="hljs-keyword">new</span> Base64();<br>        imgStr = Base64.encodeBase64String(buffer);<br>        imgStr.length();<br>        LogUtils.info(<span class="hljs-string">&quot;file name:&quot;</span>+file.getName());<br><span class="hljs-comment">//        LogUtils.info(&quot;file imgStr:&quot;+imgStr);</span><br><span class="hljs-comment">//        LogUtils.info(&quot;file imgStr.length:&quot;+imgStr.length());</span><br> <br>    &#125;<br></code></pre></td></tr></table></figure><h1 id="FileConfigæ–‡ä»¶"><a href="#FileConfigæ–‡ä»¶" class="headerlink" title="FileConfigæ–‡ä»¶"></a>FileConfigæ–‡ä»¶</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;<br><span class="hljs-keyword">import</span> org.springframework.core.annotation.Order;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br> <br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *Jun 12, 2019</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> * FileConfig.java</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@ConfigurationProperties(prefix = &quot;upload&quot;)</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Order</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileConfig</span> </span>&#123;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String localtion;    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String maxFileSize;    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String maxRequestSize;    <br> <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> localtion the localtion to set</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setLocaltion</span><span class="hljs-params">(String localtion)</span> </span>&#123;<br>        FileConfig.localtion = localtion;<br>    &#125;<br> <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> maxFileSize the maxFileSize to set</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setMaxFileSize</span><span class="hljs-params">(String maxFileSize)</span> </span>&#123;<br>        FileConfig.maxFileSize = maxFileSize;<br>    &#125;<br> <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> maxRequestSize the maxRequestSize to set</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setMaxRequestSize</span><span class="hljs-params">(String maxRequestSize)</span> </span>&#123;<br>        FileConfig.maxRequestSize = maxRequestSize;<br>    &#125;<br>    <br>    <br>&#125;<br></code></pre></td></tr></table></figure><h1 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h1><p>é…ç½®æ–‡ä»¶ç±»å‹æ˜¯yml,å¤§å®¶ä¹Ÿå¯ä»¥è‡ªå·±æ”¹æˆpropertiesæ–‡ä»¶æ ¼å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">upload: <br>  #localtion: $&#123;UPLOAD_DIR:/home/data/test&#125;<br>  localtion: $&#123;UPLOAD_DIR:D:/test&#125;<br>  maxFileSize: 10240KB <br>  maxRequestSize: 102400KB  <br></code></pre></td></tr></table></figure><h1 id="FileUtilç±»"><a href="#FileUtilç±»" class="headerlink" title="FileUtilç±»"></a>FileUtilç±»</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.nio.channels.FileChannel;<br><span class="hljs-keyword">import</span> java.nio.file.Files;<br><span class="hljs-keyword">import</span> java.nio.file.Path;<br><span class="hljs-keyword">import</span> java.nio.file.Paths;<br><span class="hljs-keyword">import</span> java.nio.file.attribute.PosixFilePermission;<br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.Enumeration;<br><span class="hljs-keyword">import</span> java.util.HashSet;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Set;<br><span class="hljs-keyword">import</span> java.util.zip.ZipEntry;<br><span class="hljs-keyword">import</span> java.util.zip.ZipFile;<br> <br><span class="hljs-keyword">import</span> org.springframework.web.multipart.MultipartFile;<br> <br><span class="hljs-keyword">import</span> sg.com.mha.ummi.common.util.LogUtils;<br> <br> <br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileUtil</span> </span>&#123;<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">clearFiles</span><span class="hljs-params">(String workspaceRootPath)</span> </span>&#123;<br>        File file = <span class="hljs-keyword">new</span> File(workspaceRootPath);<br>        deleteFile(file);<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteFile</span><span class="hljs-params">(File file)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (file.exists()) &#123;<br>            <span class="hljs-keyword">if</span> (file.isDirectory()) &#123;<br>                File[] files = file.listFiles();<br>                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; files.length; i++) &#123;<br>                    deleteFile(files[i]);<br>                &#125;<br>            &#125;<br>        &#125;<br>        file.delete();<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">fileWrite</span><span class="hljs-params">(String str, String fileNamePath)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        FileWriter writer = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            File file = <span class="hljs-keyword">new</span> File(fileNamePath);<br>            <span class="hljs-keyword">if</span> (!file.getParentFile().exists()) &#123;<br>                file.getParentFile().mkdirs();<br>                file.createNewFile();<br>            &#125;<br>            writer = <span class="hljs-keyword">new</span> FileWriter(file, <span class="hljs-keyword">true</span>);<br>            writer.write(str + System.getProperty(<span class="hljs-string">&quot;line.separator&quot;</span>));<br> <br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            LogUtils.error(e.getMessage());<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">if</span> (writer != <span class="hljs-keyword">null</span>) &#123;<br>                writer.close();<br>            &#125;<br>        &#125;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">changePermission</span><span class="hljs-params">(File dirFile, <span class="hljs-keyword">int</span> mode)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        <span class="hljs-keyword">char</span>[] modes = Integer.toOctalString(mode).toCharArray();<br>        <span class="hljs-keyword">if</span> (modes.length != <span class="hljs-number">3</span>) &#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        Set&lt;PosixFilePermission&gt; perms = <span class="hljs-keyword">new</span> HashSet&lt;PosixFilePermission&gt;();<br>        <span class="hljs-keyword">switch</span> (modes[<span class="hljs-number">0</span>]) &#123;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;1&#x27;</span>:<br>                perms.add(PosixFilePermission.OWNER_EXECUTE);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;2&#x27;</span>:<br>                perms.add(PosixFilePermission.OWNER_WRITE);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;4&#x27;</span>:<br>                perms.add(PosixFilePermission.OWNER_READ);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;5&#x27;</span>:<br>                perms.add(PosixFilePermission.OWNER_READ);<br>                perms.add(PosixFilePermission.OWNER_EXECUTE);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;6&#x27;</span>:<br>                perms.add(PosixFilePermission.OWNER_READ);<br>                perms.add(PosixFilePermission.OWNER_WRITE);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;7&#x27;</span>:<br>                perms.add(PosixFilePermission.OWNER_READ);<br>                perms.add(PosixFilePermission.OWNER_WRITE);<br>                perms.add(PosixFilePermission.OWNER_EXECUTE);<br>                <span class="hljs-keyword">break</span>;<br> <br>            <span class="hljs-keyword">default</span>:<br>                <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-keyword">switch</span> (modes[<span class="hljs-number">1</span>]) &#123;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;1&#x27;</span>:<br>                perms.add(PosixFilePermission.GROUP_EXECUTE);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;2&#x27;</span>:<br>                perms.add(PosixFilePermission.GROUP_WRITE);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;4&#x27;</span>:<br>                perms.add(PosixFilePermission.GROUP_READ);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;5&#x27;</span>:<br>                perms.add(PosixFilePermission.GROUP_READ);<br>                perms.add(PosixFilePermission.GROUP_EXECUTE);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;6&#x27;</span>:<br>                perms.add(PosixFilePermission.GROUP_READ);<br>                perms.add(PosixFilePermission.GROUP_WRITE);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;7&#x27;</span>:<br>                perms.add(PosixFilePermission.GROUP_READ);<br>                perms.add(PosixFilePermission.GROUP_WRITE);<br>                perms.add(PosixFilePermission.GROUP_EXECUTE);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">default</span>:<br>                <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-keyword">switch</span> (modes[<span class="hljs-number">2</span>]) &#123;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;1&#x27;</span>:<br>                perms.add(PosixFilePermission.OTHERS_EXECUTE);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;2&#x27;</span>:<br>                perms.add(PosixFilePermission.OTHERS_WRITE);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;4&#x27;</span>:<br>                perms.add(PosixFilePermission.OTHERS_READ);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;5&#x27;</span>:<br>                perms.add(PosixFilePermission.OTHERS_EXECUTE);<br>                perms.add(PosixFilePermission.OTHERS_READ);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;6&#x27;</span>:<br>                perms.add(PosixFilePermission.OTHERS_READ);<br>                perms.add(PosixFilePermission.OTHERS_WRITE);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;7&#x27;</span>:<br>                perms.add(PosixFilePermission.OTHERS_EXECUTE);<br>                perms.add(PosixFilePermission.OTHERS_READ);<br>                perms.add(PosixFilePermission.OTHERS_WRITE);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">default</span>:<br>                <span class="hljs-keyword">break</span>;<br>        &#125;<br> <br>        <span class="hljs-keyword">try</span> &#123;<br>            Path path = Paths.get(dirFile.getAbsolutePath());<br>            Files.setPosixFilePermissions(path, perms);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> File <span class="hljs-title">mkFile</span><span class="hljs-params">(String fileName)</span> </span>&#123;<br>        File f = <span class="hljs-keyword">new</span> File(fileName);<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">if</span> (f.exists()) &#123;<br>                f.delete();<br>            &#125;<br>            f.createNewFile();<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> f;<br>    &#125;<br> <br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">copyDirAndFile</span><span class="hljs-params">(String oldPath, String newPath)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        <span class="hljs-keyword">if</span> (!(<span class="hljs-keyword">new</span> File(newPath)).exists()) &#123;<br>            (<span class="hljs-keyword">new</span> File(newPath)).mkdir();<br>        &#125;<br>        File file = <span class="hljs-keyword">new</span> File(oldPath);<br>        <span class="hljs-comment">//file name list</span><br>        String[] filePaths = file.list();<br>        <span class="hljs-keyword">for</span> (String filePath : filePaths) &#123;<br>            String oldFullPath = oldPath + file.separator + filePath;<br>            String newFullPath = newPath + file.separator + filePath;<br>            File oldFile = <span class="hljs-keyword">new</span> File(oldFullPath);<br>            File newFile = <span class="hljs-keyword">new</span> File(newFullPath);<br>            <span class="hljs-keyword">if</span> (oldFile.isDirectory()) &#123;<br>                copyDirAndFile(oldFullPath, newFullPath);<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (oldFile.isFile()) &#123;<br>                copyFile(oldFile, newFile);<br>            &#125;<br>        &#125;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">copyFile</span><span class="hljs-params">(File source, File dest)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        FileChannel inputChannel = <span class="hljs-keyword">null</span>;<br>        FileChannel outputChannel = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            inputChannel = <span class="hljs-keyword">new</span> FileInputStream(source).getChannel();<br>            outputChannel = <span class="hljs-keyword">new</span> FileOutputStream(dest).getChannel();<br>            outputChannel.transferFrom(inputChannel, <span class="hljs-number">0</span>, inputChannel.size());<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            inputChannel.close();<br>            outputChannel.close();<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@author</span> panchaoyuan</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> srcFile    Unzipped file</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> destDirPath   Unzipped destination folder</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> RuntimeException</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException </span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">unZip</span><span class="hljs-params">(MultipartFile  srcFile, String destDirPath,String savePath)</span> <span class="hljs-keyword">throws</span> RuntimeException, IOException </span>&#123;<br>        <span class="hljs-keyword">long</span> startTime = System.currentTimeMillis();<br>        <br>        File file = <span class="hljs-keyword">null</span>;  <br>        InputStream ins = srcFile.getInputStream();  <br>        file=<span class="hljs-keyword">new</span> File(savePath+srcFile.getOriginalFilename()); <br>        LogUtils.info(<span class="hljs-string">&quot;MultipartFile transform to File,MultipartFile name:&quot;</span>+srcFile.getOriginalFilename());<br>        inputStreamToFile(ins, file);  <br>        <br>        <span class="hljs-keyword">if</span> (!file.exists()) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(file.getPath() + <span class="hljs-string">&quot;,file is not found&quot;</span>);<br>        &#125;<br>        ZipFile zipFile = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            zipFile = <span class="hljs-keyword">new</span> ZipFile(file);<br>            Enumeration&lt;?&gt; entries = zipFile.entries();<br>            <span class="hljs-keyword">while</span> (entries.hasMoreElements()) &#123;<br>                ZipEntry entry = (ZipEntry) entries.nextElement();<br>                LogUtils.info(<span class="hljs-string">&quot;zipFile context name:&quot;</span>+entry.getName());<br>                <span class="hljs-keyword">if</span> (entry.isDirectory()) &#123;<br>                    String dirPath = destDirPath + File.separator+ entry.getName();<br>                    File dir = <span class="hljs-keyword">new</span> File(dirPath);<br>                    dir.mkdirs();<br>                &#125;<span class="hljs-keyword">else</span> &#123;<br>                    File targetFile = <span class="hljs-keyword">new</span> File(destDirPath + File.separator + entry.getName());<br>                    targetFile.setExecutable(<span class="hljs-keyword">true</span>);<br>                    <span class="hljs-keyword">if</span>(!targetFile.getParentFile().exists())&#123;<br>                        targetFile.getParentFile().mkdirs();<br>                    &#125;<br>                    targetFile.createNewFile();<br>                    InputStream is = zipFile.getInputStream(entry);<br>                    FileOutputStream fos = <span class="hljs-keyword">new</span> FileOutputStream(targetFile);<br>                    <span class="hljs-keyword">int</span> len;<br>                    <span class="hljs-keyword">byte</span>[] buf = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">1024</span>];<br>                    <span class="hljs-keyword">while</span> ((len = is.read(buf)) != -<span class="hljs-number">1</span>) &#123;<br>                        fos.write(buf, <span class="hljs-number">0</span>, len);<br>                    &#125;<br>                    fos.close();<br>                    is.close();<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">long</span> endTime = System.currentTimeMillis();<br>            LogUtils.info(<span class="hljs-string">&quot;unZip time--&gt;&quot;</span> + (endTime - startTime) + <span class="hljs-string">&quot; ms&quot;</span>);<br>        &#125;<span class="hljs-keyword">catch</span>(Exception e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;unzip error from FileUtil&quot;</span>, e);<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">if</span>(zipFile != <span class="hljs-keyword">null</span>)&#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    zipFile.close();<br>                &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>            <br>            <span class="hljs-comment">//MultipartFile change to file may create a temp file in the project root folder(delete the temp file)</span><br>            File del = <span class="hljs-keyword">new</span> File(file.toURI());  <br>            del.delete(); <br>        &#125;<br>    &#125;<br> <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * MultipartFile changed to File</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@author</span> panchaoyuan</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> </span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">inputStreamToFile</span><span class="hljs-params">(InputStream ins, File file)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            OutputStream os = <span class="hljs-keyword">new</span> FileOutputStream(file);<br>            <span class="hljs-keyword">int</span> bytesRead = <span class="hljs-number">0</span>;<br>            <span class="hljs-keyword">byte</span>[] buffer = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">8192</span>];<br>            <span class="hljs-keyword">while</span> ((bytesRead = ins.read(buffer, <span class="hljs-number">0</span>, <span class="hljs-number">8192</span>)) != -<span class="hljs-number">1</span>) &#123;<br>                os.write(buffer, <span class="hljs-number">0</span>, bytesRead);<br>            &#125;<br>            os.close();<br>            ins.close();<br>            LogUtils.info(<span class="hljs-string">&quot;MultipartFile transform to File completed!&quot;</span>);<br>        &#125;<span class="hljs-keyword">catch</span>(Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br> <br>      <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@author</span> panchaoyuan</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;File&gt; <span class="hljs-title">getSubFiles</span><span class="hljs-params">(String  desFile,List&lt;File&gt; fileList)</span> </span>&#123;<br>        File file = <span class="hljs-keyword">new</span> File(desFile);<br>        File[] files = file.listFiles();<br>        <span class="hljs-keyword">for</span> (File fileIndex : files) &#123;<br>            <span class="hljs-keyword">if</span> (!fileIndex.exists()) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NullPointerException(<span class="hljs-string">&quot;Cannot find &quot;</span> + fileIndex);<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (fileIndex.isFile()) &#123;<br>                fileList.add(fileIndex);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">if</span> (fileIndex.isDirectory()) &#123;<br>                    getSubFiles(fileIndex.getAbsolutePath(),fileList);<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> fileList;<br>    &#125;<br>    <br>    <br>&#125;<br></code></pre></td></tr></table></figure><p><a href="https://bk.cuixiaoyan.xyz/archives/jiexi#%E4%B8%80">ä¸€</a><a href="https://bk.cuixiaoyan.xyz/archives/jiexi#%E4%BA%8C">äºŒ</a><a href="https://bk.cuixiaoyan.xyz/archives/jiexi#%E8%A7%A3%E5%8E%8Bzip%E6%96%87%E4%BB%B6%E7%9A%84unzip%E6%96%B9%E6%B3%95">è§£å‹zipæ–‡ä»¶çš„unzipæ–¹æ³•</a><a href="https://bk.cuixiaoyan.xyz/archives/jiexi#inputstreamtofile">inputStreamToFile</a><a href="https://bk.cuixiaoyan.xyz/archives/jiexi#parseexcelfile">parseExcelFile</a><a href="https://bk.cuixiaoyan.xyz/archives/jiexi#%E8%A7%A3%E6%9E%90%E5%9B%BE%E7%89%87%E7%9A%84%E6%96%B9%E6%B3%95">è§£æå›¾ç‰‡çš„æ–¹æ³•</a><a href="https://bk.cuixiaoyan.xyz/archives/jiexi#fileconfig%E6%96%87%E4%BB%B6">FileConfigæ–‡ä»¶</a><a href="https://bk.cuixiaoyan.xyz/archives/jiexi#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">é…ç½®æ–‡ä»¶</a><a href="https://bk.cuixiaoyan.xyz/archives/jiexi#fileutil%E7%B1%BB">FileUtilç±»</a></p>]]></content>
    
    
    <categories>
      
      <category>excel</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>excel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pythonå®ç°å¾®ä¿¡å¤´åƒåŠ å›½æ——</title>
    <link href="/blog/2021/02/17/python%E5%AE%9E%E7%8E%B0%E5%BE%AE%E4%BF%A1%E5%A4%B4%E5%83%8F%E5%8A%A0%E5%9B%BD%E6%97%97/"/>
    <url>/blog/2021/02/17/python%E5%AE%9E%E7%8E%B0%E5%BE%AE%E4%BF%A1%E5%A4%B4%E5%83%8F%E5%8A%A0%E5%9B%BD%E6%97%97/</url>
    
    <content type="html"><![CDATA[<p>å–œè¿å›½åº†,æœ€è¿‘åˆ°å¤„éƒ½æ˜¯å……æ»¡è¿™å¯¹ç¥–å›½å¯¹ç¥ç¦,è¿™é‡Œèº«ä¸ºç å†œæˆ‘ä¹Ÿå¾ˆå¼€å¿ƒã€‚ å¹¶ä¸æ˜¯ä¸ºäº†æƒ³æ”¾å‡(æ‰‹åŠ¨ç‹—å¤´)<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/WX20190930-152916@2x_1569828571186.png" alt="WX20190930-152916@2x">ä»£ç å¦‚ä¸‹:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf8 -*-</span><br><span class="hljs-keyword">import</span> cv2<br><span class="hljs-comment"># è¯»å–å¤´åƒå’Œå›½æ——å›¾æ¡ˆ</span><br>img_head = cv2.imread(<span class="hljs-string">&#x27;/Users/cuixiaoyan/biancheng/python/guoqi/img/touxiang.jpeg&#x27;</span>)<br>img_flag = cv2.imread(<span class="hljs-string">&#x27;/Users/cuixiaoyan/biancheng/python/guoqi/img/guoqi.png&#x27;</span>)<br><span class="hljs-comment"># è·å–å¤´åƒå’Œå›½æ——å›¾æ¡ˆå®½åº¦</span><br>w_head, h_head = img_head.shape[:<span class="hljs-number">2</span>]<br>w_flag, h_flag = img_flag.shape[:<span class="hljs-number">2</span>]<br><span class="hljs-comment"># è®¡ç®—å›¾æ¡ˆç¼©æ”¾æ¯”ä¾‹</span><br>scale = w_head / w_flag / <span class="hljs-number">4</span><br><span class="hljs-comment"># ç¼©æ”¾å›¾æ¡ˆ</span><br>img_flag = cv2.resize(img_flag, (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>), fx=scale, fy=scale)<br><span class="hljs-comment"># è·å–ç¼©æ”¾åæ–°å®½åº¦</span><br>w_flag, h_flag = img_flag.shape[:<span class="hljs-number">2</span>]<br><span class="hljs-comment"># æŒ‰3ä¸ªé€šé“åˆå¹¶å›¾ç‰‡</span><br><span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>):<br>    img_head[w_head - w_flag:, h_head - h_flag:, c] = img_flag[:, :, c]<br><span class="hljs-comment"># ä¿å­˜æœ€ç»ˆç»“æœ è·¯å¾„å¯ä»¥å†™ä¸ºç»å¯¹ æˆ–è€…ç›¸å¯¹</span><br>cv2.imwrite(<span class="hljs-string">&#x27;/Users/cuixiaoyan/biancheng/python/guoqi/img/duang.png&#x27;</span>, img_head)<br></code></pre></td></tr></table></figure><p>ç¥ç¦ç¥–å›½æ°¸è¿œç¹è£æ˜Œç››ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>å¾®ä¿¡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åˆ†åº“åˆ†è¡¨ä¹‹å,idä¸»é”®å¦‚ä½•å¤„ç†</title>
    <link href="/blog/2021/02/12/%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E4%B9%8B%E5%90%8E,id%E4%B8%BB%E9%94%AE%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86/"/>
    <url>/blog/2021/02/12/%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E4%B9%8B%E5%90%8E,id%E4%B8%BB%E9%94%AE%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86/</url>
    
    <content type="html"><![CDATA[<p><strong>å…¶å®è¿™æ˜¯åˆ†åº“åˆ†è¡¨ä¹‹åä½ å¿…ç„¶è¦é¢å¯¹çš„ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ id å’‹ç”Ÿæˆï¼Ÿå› ä¸ºè¦æ˜¯åˆ†æˆå¤šä¸ªè¡¨ä¹‹åï¼Œæ¯ä¸ªè¡¨éƒ½æ˜¯ä» 1 å¼€å§‹ç´¯åŠ ï¼Œé‚£è‚¯å®šä¸å¯¹å•Šï¼Œéœ€è¦ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ id æ¥æ”¯æŒã€‚æ‰€ä»¥è¿™éƒ½æ˜¯ä½ å®é™…ç”Ÿäº§ç¯å¢ƒä¸­å¿…é¡»è€ƒè™‘çš„é—®é¢˜ã€‚</strong></p><h1 id="æ•°æ®åº“è‡ªå¢-id"><a href="#æ•°æ®åº“è‡ªå¢-id" class="headerlink" title="æ•°æ®åº“è‡ªå¢ id"></a>æ•°æ®åº“è‡ªå¢ id</h1><p>è¿™ä¸ªå°±æ˜¯è¯´ä½ çš„ç³»ç»Ÿé‡Œæ¯æ¬¡å¾—åˆ°ä¸€ä¸ª idï¼Œéƒ½æ˜¯å¾€ä¸€ä¸ªåº“çš„ä¸€ä¸ªè¡¨é‡Œæ’å…¥ä¸€æ¡æ²¡ä»€ä¹ˆä¸šåŠ¡å«ä¹‰çš„æ•°æ®ï¼Œç„¶åè·å–ä¸€ä¸ªæ•°æ®åº“è‡ªå¢çš„ä¸€ä¸ª idã€‚æ‹¿åˆ°è¿™ä¸ª id ä¹‹åå†å¾€å¯¹åº”çš„åˆ†åº“åˆ†è¡¨é‡Œå»å†™å…¥ã€‚</p><p>è¿™ä¸ªæ–¹æ¡ˆçš„å¥½å¤„å°±æ˜¯æ–¹ä¾¿ç®€å•ï¼Œè°éƒ½ä¼šç”¨ï¼›ç¼ºç‚¹å°±æ˜¯å•åº“ç”Ÿæˆè‡ªå¢ idï¼Œè¦æ˜¯é«˜å¹¶å‘çš„è¯ï¼Œå°±ä¼šæœ‰ç“¶é¢ˆçš„ï¼›å¦‚æœä½ ç¡¬æ˜¯è¦æ”¹è¿›ä¸€ä¸‹ï¼Œé‚£ä¹ˆå°±ä¸“é—¨å¼€ä¸€ä¸ªæœåŠ¡å‡ºæ¥ï¼Œè¿™ä¸ªæœåŠ¡æ¯æ¬¡å°±æ‹¿åˆ°å½“å‰ id æœ€å¤§å€¼ï¼Œç„¶åè‡ªå·±é€’å¢å‡ ä¸ª idï¼Œä¸€æ¬¡æ€§è¿”å›ä¸€æ‰¹ idï¼Œç„¶åå†æŠŠå½“å‰æœ€å¤§ id å€¼ä¿®æ”¹æˆé€’å¢å‡ ä¸ª id ä¹‹åçš„ä¸€ä¸ªå€¼ï¼›ä½†æ˜¯æ— è®ºå¦‚ä½•éƒ½æ˜¯åŸºäºå•ä¸ªæ•°æ®åº“ã€‚</p><p>é€‚åˆçš„åœºæ™¯ï¼šä½ åˆ†åº“åˆ†è¡¨å°±ä¿©åŸå› ï¼Œè¦ä¸å°±æ˜¯å•åº“å¹¶å‘å¤ªé«˜ï¼Œè¦ä¸å°±æ˜¯å•åº“æ•°æ®é‡å¤ªå¤§ï¼›é™¤éæ˜¯ä½ å¹¶å‘ä¸é«˜ï¼Œä½†æ˜¯æ•°æ®é‡å¤ªå¤§å¯¼è‡´çš„åˆ†åº“åˆ†è¡¨æ‰©å®¹ï¼Œä½ å¯ä»¥ç”¨è¿™ä¸ªæ–¹æ¡ˆï¼Œå› ä¸ºå¯èƒ½æ¯ç§’æœ€é«˜å¹¶å‘æœ€å¤šå°±å‡ ç™¾ï¼Œé‚£ä¹ˆå°±èµ°å•ç‹¬çš„ä¸€ä¸ªåº“å’Œè¡¨ç”Ÿæˆè‡ªå¢ä¸»é”®å³å¯ã€‚</p><h1 id="è®¾ç½®æ•°æ®åº“-sequence-æˆ–è€…è¡¨è‡ªå¢å­—æ®µæ­¥é•¿"><a href="#è®¾ç½®æ•°æ®åº“-sequence-æˆ–è€…è¡¨è‡ªå¢å­—æ®µæ­¥é•¿" class="headerlink" title="è®¾ç½®æ•°æ®åº“ sequence æˆ–è€…è¡¨è‡ªå¢å­—æ®µæ­¥é•¿"></a>è®¾ç½®æ•°æ®åº“ sequence æˆ–è€…è¡¨è‡ªå¢å­—æ®µæ­¥é•¿</h1><p>å¯ä»¥é€šè¿‡è®¾ç½®æ•°æ®åº“ sequence æˆ–è€…è¡¨çš„è‡ªå¢å­—æ®µæ­¥é•¿æ¥è¿›è¡Œæ°´å¹³ä¼¸ç¼©ã€‚</p><p>æ¯”å¦‚è¯´ï¼Œç°åœ¨æœ‰ 8 ä¸ªæœåŠ¡èŠ‚ç‚¹ï¼Œæ¯ä¸ªæœåŠ¡èŠ‚ç‚¹ä½¿ç”¨ä¸€ä¸ª sequence åŠŸèƒ½æ¥äº§ç”Ÿ IDï¼Œæ¯ä¸ª sequence çš„èµ·å§‹ ID ä¸åŒï¼Œå¹¶ä¸”ä¾æ¬¡é€’å¢ï¼Œæ­¥é•¿éƒ½æ˜¯ 8ã€‚<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/1756639-20190929231341180-1764461227_1569810079034.jpg" alt="1756639-20190929231341180-1764461227">é€‚åˆçš„åœºæ™¯ï¼šåœ¨ç”¨æˆ·é˜²æ­¢äº§ç”Ÿçš„ ID é‡å¤æ—¶ï¼Œè¿™ç§æ–¹æ¡ˆå®ç°èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œä¹Ÿèƒ½è¾¾åˆ°æ€§èƒ½ç›®æ ‡ã€‚ä½†æ˜¯æœåŠ¡èŠ‚ç‚¹å›ºå®šï¼Œæ­¥é•¿ä¹Ÿå›ºå®šï¼Œå°†æ¥å¦‚æœè¿˜è¦å¢åŠ æœåŠ¡èŠ‚ç‚¹ï¼Œå°±ä¸å¥½æäº†ã€‚</p><h1 id="UUID"><a href="#UUID" class="headerlink" title="UUID"></a>UUID</h1><p>å¥½å¤„å°±æ˜¯æœ¬åœ°ç”Ÿæˆï¼Œä¸è¦åŸºäºæ•°æ®åº“æ¥äº†ï¼›ä¸å¥½ä¹‹å¤„å°±æ˜¯ï¼ŒUUID å¤ªé•¿äº†ã€å ç”¨ç©ºé—´å¤§ï¼Œä½œä¸ºä¸»é”®æ€§èƒ½å¤ªå·®äº†ï¼›æ›´é‡è¦çš„æ˜¯ï¼ŒUUID ä¸å…·æœ‰æœ‰åºæ€§ï¼Œä¼šå¯¼è‡´ B+ æ ‘ç´¢å¼•åœ¨å†™çš„æ—¶å€™æœ‰è¿‡å¤šçš„éšæœºå†™æ“ä½œï¼ˆè¿ç»­çš„ ID å¯ä»¥äº§ç”Ÿéƒ¨åˆ†é¡ºåºå†™ï¼‰ï¼Œè¿˜æœ‰ï¼Œç”±äºåœ¨å†™çš„æ—¶å€™ä¸èƒ½äº§ç”Ÿæœ‰é¡ºåºçš„ append æ“ä½œï¼Œè€Œéœ€è¦è¿›è¡Œ insert æ“ä½œï¼Œå°†ä¼šè¯»å–æ•´ä¸ª B+ æ ‘èŠ‚ç‚¹åˆ°å†…å­˜ï¼Œåœ¨æ’å…¥è¿™æ¡è®°å½•åä¼šå°†æ•´ä¸ªèŠ‚ç‚¹å†™å›ç£ç›˜ï¼Œè¿™ç§æ“ä½œåœ¨è®°å½•å ç”¨ç©ºé—´æ¯”è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼Œæ€§èƒ½ä¸‹é™æ˜æ˜¾ã€‚</p><p>é€‚åˆçš„åœºæ™¯ï¼šå¦‚æœä½ æ˜¯è¦éšæœºç”Ÿæˆä¸ªä»€ä¹ˆæ–‡ä»¶åã€ç¼–å·ä¹‹ç±»çš„ï¼Œä½ å¯ä»¥ç”¨ UUIDï¼Œä½†æ˜¯ä½œä¸ºä¸»é”®æ˜¯ä¸èƒ½ç”¨ UUID çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">UUID.randomUUID().toString().replace(â€œ-â€, â€œâ€) -&gt; sfsdf23423rr234sfdaf<br> <br></code></pre></td></tr></table></figure><h1 id="è·å–ç³»ç»Ÿå½“å‰æ—¶é—´"><a href="#è·å–ç³»ç»Ÿå½“å‰æ—¶é—´" class="headerlink" title="è·å–ç³»ç»Ÿå½“å‰æ—¶é—´"></a>è·å–ç³»ç»Ÿå½“å‰æ—¶é—´</h1><p>è¿™ä¸ªå°±æ˜¯è·å–å½“å‰æ—¶é—´å³å¯ï¼Œä½†æ˜¯é—®é¢˜æ˜¯ï¼Œå¹¶å‘å¾ˆé«˜çš„æ—¶å€™ï¼Œæ¯”å¦‚ä¸€ç§’å¹¶å‘å‡ åƒï¼Œä¼šæœ‰é‡å¤çš„æƒ…å†µï¼Œè¿™ä¸ªæ˜¯è‚¯å®šä¸åˆé€‚çš„ã€‚åŸºæœ¬å°±ä¸ç”¨è€ƒè™‘äº†ã€‚</p><p>é€‚åˆçš„åœºæ™¯ï¼šä¸€èˆ¬å¦‚æœç”¨è¿™ä¸ªæ–¹æ¡ˆï¼Œæ˜¯å°†å½“å‰æ—¶é—´è·Ÿå¾ˆå¤šå…¶ä»–çš„ä¸šåŠ¡å­—æ®µæ‹¼æ¥èµ·æ¥ï¼Œä½œä¸ºä¸€ä¸ª idï¼Œå¦‚æœä¸šåŠ¡ä¸Šä½ è§‰å¾—å¯ä»¥æ¥å—ï¼Œé‚£ä¹ˆä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ä½ å¯ä»¥å°†åˆ«çš„ä¸šåŠ¡å­—æ®µå€¼è·Ÿå½“å‰æ—¶é—´æ‹¼æ¥èµ·æ¥ï¼Œç»„æˆä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ç¼–å·ã€‚</p><h1 id="snowflake-ç®—æ³•"><a href="#snowflake-ç®—æ³•" class="headerlink" title="snowflake ç®—æ³•"></a>snowflake ç®—æ³•</h1><p>snowflake ç®—æ³•æ˜¯ twitter å¼€æºçš„åˆ†å¸ƒå¼ id ç”Ÿæˆç®—æ³•ï¼Œé‡‡ç”¨ Scala è¯­è¨€å®ç°ï¼Œæ˜¯æŠŠä¸€ä¸ª 64 ä½çš„ long å‹çš„ idï¼Œ1 ä¸ª bit æ˜¯ä¸ç”¨çš„ï¼Œç”¨å…¶ä¸­çš„ 41 bit ä½œä¸ºæ¯«ç§’æ•°ï¼Œç”¨ 10 bit ä½œä¸ºå·¥ä½œæœºå™¨ idï¼Œ12 bit ä½œä¸ºåºåˆ—å·ã€‚</p><ol><li>1 bitï¼šä¸ç”¨ï¼Œä¸ºå•¥å‘¢ï¼Ÿå› ä¸ºäºŒè¿›åˆ¶é‡Œç¬¬ä¸€ä¸ª bit ä¸ºå¦‚æœæ˜¯ 1ï¼Œé‚£ä¹ˆéƒ½æ˜¯è´Ÿæ•°ï¼Œä½†æ˜¯æˆ‘ä»¬ç”Ÿæˆçš„ id éƒ½æ˜¯æ­£æ•°ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ª bit ç»Ÿä¸€éƒ½æ˜¯ 0ã€‚</li><li>41 bitï¼šè¡¨ç¤ºçš„æ˜¯æ—¶é—´æˆ³ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚41 bit å¯ä»¥è¡¨ç¤ºçš„æ•°å­—å¤šè¾¾ 2^41 - 1ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥æ ‡è¯† 2^41 - 1 ä¸ªæ¯«ç§’å€¼ï¼Œæ¢ç®—æˆå¹´å°±æ˜¯è¡¨ç¤º69å¹´çš„æ—¶é—´ã€‚</li><li>10 bitï¼šè®°å½•å·¥ä½œæœºå™¨ idï¼Œä»£è¡¨çš„æ˜¯è¿™ä¸ªæœåŠ¡æœ€å¤šå¯ä»¥éƒ¨ç½²åœ¨ 2^10å°æœºå™¨ä¸Šå“ªï¼Œä¹Ÿå°±æ˜¯1024å°æœºå™¨ã€‚ä½†æ˜¯ 10 bit é‡Œ 5 ä¸ª bit ä»£è¡¨æœºæˆ¿ idï¼Œ5 ä¸ª bit ä»£è¡¨æœºå™¨ idã€‚æ„æ€å°±æ˜¯æœ€å¤šä»£è¡¨ 2^5ä¸ªæœºæˆ¿ï¼ˆ32ä¸ªæœºæˆ¿ï¼‰ï¼Œæ¯ä¸ªæœºæˆ¿é‡Œå¯ä»¥ä»£è¡¨ 2^5 ä¸ªæœºå™¨ï¼ˆ32å°æœºå™¨ï¼‰ã€‚</li><li>12 bitï¼šè¿™ä¸ªæ˜¯ç”¨æ¥è®°å½•åŒä¸€ä¸ªæ¯«ç§’å†…äº§ç”Ÿçš„ä¸åŒ idï¼Œ12 bit å¯ä»¥ä»£è¡¨çš„æœ€å¤§æ­£æ•´æ•°æ˜¯ 2^12 - 1 = 4096ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥ç”¨è¿™ä¸ª 12 bit ä»£è¡¨çš„æ•°å­—æ¥åŒºåˆ†åŒä¸€ä¸ªæ¯«ç§’å†…çš„ 4096 ä¸ªä¸åŒçš„ idã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IdWorker</span> </span>&#123;<br> <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> workerId;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> datacenterId;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> sequence;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">IdWorker</span><span class="hljs-params">(<span class="hljs-keyword">long</span> workerId, <span class="hljs-keyword">long</span> datacenterId, <span class="hljs-keyword">long</span> sequence)</span> </span>&#123;<br>        <span class="hljs-comment">// sanity check for workerId</span><br>        <span class="hljs-comment">// è¿™å„¿ä¸å°±æ£€æŸ¥äº†ä¸€ä¸‹ï¼Œè¦æ±‚å°±æ˜¯ä½ ä¼ é€’è¿›æ¥çš„æœºæˆ¿idå’Œæœºå™¨idä¸èƒ½è¶…è¿‡32ï¼Œä¸èƒ½å°äº0</span><br>        <span class="hljs-keyword">if</span> (workerId &gt; maxWorkerId || workerId &lt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<br>                    String.format(<span class="hljs-string">&quot;worker Id can&#x27;t be greater than %d or less than 0&quot;</span>, maxWorkerId));<br>        &#125;<br>        <span class="hljs-keyword">if</span> (datacenterId &gt; maxDatacenterId || datacenterId &lt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<br>                    String.format(<span class="hljs-string">&quot;datacenter Id can&#x27;t be greater than %d or less than 0&quot;</span>, maxDatacenterId));<br>        &#125;<br>        System.out.printf(<br>                <span class="hljs-string">&quot;worker starting. timestamp left shift %d, datacenter id bits %d, worker id bits %d, sequence bits %d, workerid %d&quot;</span>,<br>                timestampLeftShift, datacenterIdBits, workerIdBits, sequenceBits, workerId);<br> <br>        <span class="hljs-keyword">this</span>.workerId = workerId;<br>        <span class="hljs-keyword">this</span>.datacenterId = datacenterId;<br>        <span class="hljs-keyword">this</span>.sequence = sequence;<br>    &#125;<br> <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> twepoch = <span class="hljs-number">1288834974657L</span>;<br> <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> workerIdBits = <span class="hljs-number">5L</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> datacenterIdBits = <span class="hljs-number">5L</span>;<br> <br>    <span class="hljs-comment">// è¿™ä¸ªæ˜¯äºŒè¿›åˆ¶è¿ç®—ï¼Œå°±æ˜¯ 5 bitæœ€å¤šåªèƒ½æœ‰31ä¸ªæ•°å­—ï¼Œä¹Ÿå°±æ˜¯è¯´æœºå™¨idæœ€å¤šåªèƒ½æ˜¯32ä»¥å†…</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> maxWorkerId = -<span class="hljs-number">1L</span> ^ (-<span class="hljs-number">1L</span> &lt;&lt; workerIdBits);<br> <br>    <span class="hljs-comment">// è¿™ä¸ªæ˜¯ä¸€ä¸ªæ„æ€ï¼Œå°±æ˜¯ 5 bitæœ€å¤šåªèƒ½æœ‰31ä¸ªæ•°å­—ï¼Œæœºæˆ¿idæœ€å¤šåªèƒ½æ˜¯32ä»¥å†…</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> maxDatacenterId = -<span class="hljs-number">1L</span> ^ (-<span class="hljs-number">1L</span> &lt;&lt; datacenterIdBits);<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> sequenceBits = <span class="hljs-number">12L</span>;<br> <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> workerIdShift = sequenceBits;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> datacenterIdShift = sequenceBits + workerIdBits;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> timestampLeftShift = sequenceBits + workerIdBits + datacenterIdBits;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> sequenceMask = -<span class="hljs-number">1L</span> ^ (-<span class="hljs-number">1L</span> &lt;&lt; sequenceBits);<br> <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> lastTimestamp = -<span class="hljs-number">1L</span>;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">getWorkerId</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> workerId;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">getDatacenterId</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> datacenterId;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">getTimestamp</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> System.currentTimeMillis();<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">long</span> <span class="hljs-title">nextId</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-comment">// è¿™å„¿å°±æ˜¯è·å–å½“å‰æ—¶é—´æˆ³ï¼Œå•ä½æ˜¯æ¯«ç§’</span><br>        <span class="hljs-keyword">long</span> timestamp = timeGen();<br> <br>        <span class="hljs-keyword">if</span> (timestamp &lt; lastTimestamp) &#123;<br>            System.err.printf(<span class="hljs-string">&quot;clock is moving backwards.  Rejecting requests until %d.&quot;</span>, lastTimestamp);<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(String.format(<br>                    <span class="hljs-string">&quot;Clock moved backwards.  Refusing to generate id for %d milliseconds&quot;</span>, lastTimestamp - timestamp));<br>        &#125;<br> <br>        <span class="hljs-keyword">if</span> (lastTimestamp == timestamp) &#123;<br>            <span class="hljs-comment">// è¿™ä¸ªæ„æ€æ˜¯è¯´ä¸€ä¸ªæ¯«ç§’å†…æœ€å¤šåªèƒ½æœ‰4096ä¸ªæ•°å­—</span><br>            <span class="hljs-comment">// æ— è®ºä½ ä¼ é€’å¤šå°‘è¿›æ¥ï¼Œè¿™ä¸ªä½è¿ç®—ä¿è¯å§‹ç»ˆå°±æ˜¯åœ¨4096è¿™ä¸ªèŒƒå›´å†…ï¼Œé¿å…ä½ è‡ªå·±ä¼ é€’ä¸ªsequenceè¶…è¿‡äº†4096è¿™ä¸ªèŒƒå›´</span><br>            sequence = (sequence + <span class="hljs-number">1</span>) &amp; sequenceMask;<br>            <span class="hljs-keyword">if</span> (sequence == <span class="hljs-number">0</span>) &#123;<br>                timestamp = tilNextMillis(lastTimestamp);<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            sequence = <span class="hljs-number">0</span>;<br>        &#125;<br> <br>        <span class="hljs-comment">// è¿™å„¿è®°å½•ä¸€ä¸‹æœ€è¿‘ä¸€æ¬¡ç”Ÿæˆidçš„æ—¶é—´æˆ³ï¼Œå•ä½æ˜¯æ¯«ç§’</span><br>        lastTimestamp = timestamp;<br> <br>        <span class="hljs-comment">// è¿™å„¿å°±æ˜¯å°†æ—¶é—´æˆ³å·¦ç§»ï¼Œæ”¾åˆ° 41 bité‚£å„¿ï¼›</span><br>        <span class="hljs-comment">// å°†æœºæˆ¿ idå·¦ç§»æ”¾åˆ° 5 bité‚£å„¿ï¼›</span><br>        <span class="hljs-comment">// å°†æœºå™¨idå·¦ç§»æ”¾åˆ°5 bité‚£å„¿ï¼›å°†åºå·æ”¾æœ€å12 bitï¼›</span><br>        <span class="hljs-comment">// æœ€åæ‹¼æ¥èµ·æ¥æˆä¸€ä¸ª 64 bitçš„äºŒè¿›åˆ¶æ•°å­—ï¼Œè½¬æ¢æˆ 10 è¿›åˆ¶å°±æ˜¯ä¸ª long å‹</span><br>        <span class="hljs-keyword">return</span> ((timestamp - twepoch) &lt;&lt; timestampLeftShift) | (datacenterId &lt;&lt; datacenterIdShift)<br>                | (workerId &lt;&lt; workerIdShift) | sequence;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> <span class="hljs-title">tilNextMillis</span><span class="hljs-params">(<span class="hljs-keyword">long</span> lastTimestamp)</span> </span>&#123;<br>        <span class="hljs-keyword">long</span> timestamp = timeGen();<br>        <span class="hljs-keyword">while</span> (timestamp &lt;= lastTimestamp) &#123;<br>            timestamp = timeGen();<br>        &#125;<br>        <span class="hljs-keyword">return</span> timestamp;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> <span class="hljs-title">timeGen</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> System.currentTimeMillis();<br>    &#125;<br> <br>    <span class="hljs-comment">// ---------------æµ‹è¯•---------------</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        IdWorker worker = <span class="hljs-keyword">new</span> IdWorker(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">30</span>; i++) &#123;<br>            System.out.println(worker.nextId());<br>        &#125;<br>    &#125;<br> <br>&#125;<br></code></pre></td></tr></table></figure><p>æ€ä¹ˆè¯´å‘¢ï¼Œå¤§æ¦‚è¿™ä¸ªæ„æ€å§ï¼Œå°±æ˜¯è¯´ 41 bit æ˜¯å½“å‰æ¯«ç§’å•ä½çš„ä¸€ä¸ªæ—¶é—´æˆ³ï¼Œå°±è¿™æ„æ€ï¼›ç„¶å 5 bit æ˜¯ä½ ä¼ é€’è¿›æ¥çš„ä¸€ä¸ªæœºæˆ¿ idï¼ˆä½†æ˜¯æœ€å¤§åªèƒ½æ˜¯ 32 ä»¥å†…ï¼‰ï¼Œå¦å¤– 5 bit æ˜¯ä½ ä¼ é€’è¿›æ¥çš„æœºå™¨ idï¼ˆä½†æ˜¯æœ€å¤§åªèƒ½æ˜¯ 32 ä»¥å†…ï¼‰ï¼Œå‰©ä¸‹çš„é‚£ä¸ª 12 bitåºåˆ—å·ï¼Œå°±æ˜¯å¦‚æœè·Ÿä½ ä¸Šæ¬¡ç”Ÿæˆ id çš„æ—¶é—´è¿˜åœ¨ä¸€ä¸ªæ¯«ç§’å†…ï¼Œé‚£ä¹ˆä¼šæŠŠé¡ºåºç»™ä½ ç´¯åŠ ï¼Œæœ€å¤šåœ¨ 4096 ä¸ªåºå·ä»¥å†…ã€‚</p><p>æ‰€ä»¥ä½ è‡ªå·±åˆ©ç”¨è¿™ä¸ªå·¥å…·ç±»ï¼Œè‡ªå·±æä¸€ä¸ªæœåŠ¡ï¼Œç„¶åå¯¹æ¯ä¸ªæœºæˆ¿çš„æ¯ä¸ªæœºå™¨éƒ½åˆå§‹åŒ–è¿™ä¹ˆä¸€ä¸ªä¸œè¥¿ï¼Œåˆšå¼€å§‹è¿™ä¸ªæœºæˆ¿çš„è¿™ä¸ªæœºå™¨çš„åºå·å°±æ˜¯ 0ã€‚ç„¶åæ¯æ¬¡æ¥æ”¶åˆ°ä¸€ä¸ªè¯·æ±‚ï¼Œè¯´è¿™ä¸ªæœºæˆ¿çš„è¿™ä¸ªæœºå™¨è¦ç”Ÿæˆä¸€ä¸ª idï¼Œä½ å°±æ‰¾åˆ°å¯¹åº”çš„ Worker ç”Ÿæˆã€‚</p><p>åˆ©ç”¨è¿™ä¸ª snowflake ç®—æ³•ï¼Œä½ å¯ä»¥å¼€å‘è‡ªå·±å…¬å¸çš„æœåŠ¡ï¼Œç”šè‡³å¯¹äºæœºæˆ¿ id å’Œæœºå™¨ idï¼Œåæ­£ç»™ä½ é¢„ç•™äº† 5 bit + 5 bitï¼Œä½ æ¢æˆåˆ«çš„æœ‰ä¸šåŠ¡å«ä¹‰çš„ä¸œè¥¿ä¹Ÿå¯ä»¥çš„ã€‚</p><p>è¿™ä¸ª snowflake ç®—æ³•ç›¸å¯¹æ¥è¯´è¿˜æ˜¯æ¯”è¾ƒé è°±çš„ï¼Œæ‰€ä»¥ä½ è¦çœŸæ˜¯æåˆ†å¸ƒå¼ id ç”Ÿæˆï¼Œå¦‚æœæ˜¯é«˜å¹¶å‘å•¥çš„ï¼Œé‚£ä¹ˆç”¨è¿™ä¸ªåº”è¯¥æ€§èƒ½æ¯”è¾ƒå¥½ï¼Œä¸€èˆ¬æ¯ç§’å‡ ä¸‡å¹¶å‘çš„åœºæ™¯ï¼Œä¹Ÿè¶³å¤Ÿä½ ç”¨äº†ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>mysql</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å·¥å…·ç±»</tag>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ€ä¹ˆå¿«é€Ÿæ’100æ¡æ•°æ®ç”¨æ—¶æœ€çŸ­</title>
    <link href="/blog/2021/02/12/%E6%80%8E%E4%B9%88%E5%BF%AB%E9%80%9F%E6%8F%92100%E6%9D%A1%E6%95%B0%E6%8D%AE%E7%94%A8%E6%97%B6%E6%9C%80%E7%9F%AD/"/>
    <url>/blog/2021/02/12/%E6%80%8E%E4%B9%88%E5%BF%AB%E9%80%9F%E6%8F%92100%E6%9D%A1%E6%95%B0%E6%8D%AE%E7%94%A8%E6%97%B6%E6%9C%80%E7%9F%AD/</url>
    
    <content type="html"><![CDATA[<p>é—®ï¼šä¸ºä½•å¯¹åŒä¸€ä¸ªè¡¨çš„æ’å…¥å¤šçº¿ç¨‹ä¼šæ¯”å•çº¿ç¨‹å¿«ï¼ŸåŒä¸€æ—¶é—´å¯¹ä¸€ä¸ªè¡¨çš„å†™æ“ä½œä¸åº”è¯¥æ˜¯ç‹¬å çš„å—ï¼Ÿ ç­”ï¼šåœ¨æ•°æ®é‡Œåšæ’å…¥æ“ä½œçš„æ—¶å€™ï¼Œæ•´ä½“æ—¶é—´çš„åˆ†é…æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>é“¾æ¥è€—æ—¶ ï¼ˆ30%ï¼‰</li><li>å‘é€queryåˆ°æœåŠ¡å™¨ ï¼ˆ20%ï¼‰</li><li>è§£æquery ï¼ˆ20%ï¼‰</li><li>æ’å…¥æ“ä½œ ï¼ˆ10% * è¯æ¡æ•°ç›®ï¼‰</li><li>æ’å…¥index ï¼ˆ10% * Indexçš„æ•°ç›®ï¼‰</li><li>å…³é—­é“¾æ¥ ï¼ˆ10%ï¼‰ ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºæ¥ï¼ŒçœŸæ­£è€—æ—¶çš„ä¸æ˜¯æ“ä½œï¼Œè€Œæ˜¯é“¾æ¥ï¼Œè§£æçš„è¿‡ç¨‹ã€‚ MySQLæ’å…¥æ•°æ®åœ¨å†™é˜¶æ®µæ˜¯ç‹¬å çš„ï¼Œä½†æ˜¯æ’å…¥ä¸€æ¡æ•°æ®ä»ç„¶éœ€è¦è§£æã€è®¡ç®—ã€æœ€åæ‰è¿›è¡Œå†™å¤„ç†ï¼Œæ¯”å¦‚è¦ç»™æ¯ä¸€æ¡è®°å½•åˆ†é…è‡ªå¢idï¼Œæ ¡éªŒä¸»é”®å”¯ä¸€é”®å±æ€§ï¼Œæˆ–è€…å…¶ä»–ä¸€äº›é€»è¾‘å¤„ç†ï¼Œéƒ½æ˜¯éœ€è¦è®¡ç®—çš„ï¼Œæ‰€ä»¥è¯´å¤šçº¿ç¨‹èƒ½å¤Ÿæé«˜æ•ˆç‡ã€‚ å¤šçº¿ç¨‹æ’å…¥(å¤šè¡¨) åˆ†åŒºåˆ†è¡¨åä½¿ç”¨å¤šçº¿ç¨‹æ’å…¥ã€‚ é¢„å¤„ç†SQL</li><li>æ™®é€šSQLï¼Œå³ä½¿ç”¨Statementæ¥å£æ‰§è¡ŒSQL</li><li>é¢„å¤„ç†SQLï¼Œå³ä½¿ç”¨PreparedStatementæ¥å£æ‰§è¡ŒSQL ä½¿ç”¨PreparedStatementæ¥å£å…è®¸æ•°æ®åº“é¢„ç¼–è¯‘SQLè¯­å¥ï¼Œä»¥ååªéœ€ä¼ å…¥å‚æ•°ï¼Œé¿å…äº†æ•°æ®åº“æ¯æ¬¡éƒ½ç¼–è¯‘SQLè¯­å¥ï¼Œå› æ­¤æ€§èƒ½æ›´å¥½ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java">String sql = <span class="hljs-string">&quot;insert into testdb.tuser (name, remark, createtime, updatetime) values (?, ?, ?, ?)&quot;</span>;<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; m; i++) &#123;<br>    <span class="hljs-comment">//ä»æ± ä¸­è·å–è¿æ¥</span><br>    Connection conn = myBroker.getConnection();<br>    PreparedStatement pstmt = conn.prepareStatement(sql);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> k = <span class="hljs-number">0</span>; k &lt; n; k++) &#123;<br>            pstmt.setString(<span class="hljs-number">1</span>, RandomToolkit.generateString(<span class="hljs-number">12</span>));<br>            pstmt.setString(<span class="hljs-number">2</span>, RandomToolkit.generateString(<span class="hljs-number">24</span>));<br>            pstmt.setDate(<span class="hljs-number">3</span>, <span class="hljs-keyword">new</span> Date(System.currentTimeMillis()));<br>            pstmt.setDate(<span class="hljs-number">4</span>, <span class="hljs-keyword">new</span> Date(System.currentTimeMillis()));<br>            <span class="hljs-comment">//åŠ å…¥æ‰¹å¤„ç†</span><br>            pstmt.addBatch();<br>    &#125;<br>    pstmt.executeBatch();    <span class="hljs-comment">//æ‰§è¡Œæ‰¹å¤„ç†</span><br>    pstmt.close();<br>    myBroker.freeConnection(conn); <span class="hljs-comment">//è¿æ¥å½’æ± </span><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>å¤šå€¼æ’å…¥SQL</strong></p><ol><li>æ™®é€šæ’å…¥SQLï¼šINSERT INTO TBL_TEST (id) VALUES(1)</li><li>å¤šå€¼æ’å…¥SQLï¼šINSERT INTO TBL_TEST (id) VALUES (1), (2), (3) ä½¿ç”¨å¤šå€¼æ’å…¥SQLï¼ŒSQLè¯­å¥çš„æ€»é•¿åº¦å‡å°‘ï¼Œå³å‡å°‘äº†ç½‘ç»œIOï¼ŒåŒæ—¶ä¹Ÿé™ä½äº†è¿æ¥æ¬¡æ•°ï¼Œæ•°æ®åº“ä¸€æ¬¡SQLè§£æï¼Œèƒ½å¤Ÿæ’å…¥å¤šæ¡æ•°æ®ã€‚ <strong>äº‹åŠ¡(Næ¡æäº¤ä¸€æ¬¡)</strong> åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­æäº¤å¤§é‡INSERTè¯­å¥å¯ä»¥æé«˜æ€§èƒ½ã€‚</li><li>å°†è¡¨çš„å­˜å‚¨å¼•æ“ä¿®æ”¹ä¸ºmyisam</li><li>å°† sql æ‹¼æ¥æˆå­—ç¬¦ä¸²ï¼Œæ¯ 1000 æ¡å·¦å³æäº¤äº‹åŠ¡ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/// &lt;summary&gt;</span><br>        <span class="hljs-comment">/// æ‰§è¡Œå¤šæ¡SQLè¯­å¥ï¼Œå®ç°æ•°æ®åº“äº‹åŠ¡ã€‚</span><br>        <span class="hljs-comment">/// &lt;/summary&gt;mysqlæ•°æ®åº“</span><br>        <span class="hljs-comment">/// &lt;param name=&quot;SQLStringList&quot;&gt;å¤šæ¡SQLè¯­å¥&lt;/param&gt;</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ExecuteSqlTran</span><span class="hljs-params">(List&lt;string&gt; SQLStringList)</span></span><br><span class="hljs-function">        </span>&#123;<br>            using (MySqlConnection conn = <span class="hljs-keyword">new</span> MySqlConnection(connectionString))<br>            &#123;<br>                <span class="hljs-keyword">if</span> (DBVariable.flag)<br>                &#123;<br>                    conn.Open();<br>                    MySqlCommand cmd = <span class="hljs-keyword">new</span> MySqlCommand();<br>                    cmd.Connection = conn;<br>                    MySqlTransaction tx = conn.BeginTransaction();<br>                    cmd.Transaction = tx;<br>                    <span class="hljs-keyword">try</span><br>                    &#123;<br>                        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> n = <span class="hljs-number">0</span>; n &lt; SQLStringList.Count; n++)<br>                        &#123;<br>                            string strsql = SQLStringList[n].ToString();<br>                            <span class="hljs-keyword">if</span> (strsql.Trim().Length &gt; <span class="hljs-number">1</span>)<br>                            &#123;<br>                                cmd.CommandText = strsql;<br>                                cmd.ExecuteNonQuery();<br>                            &#125;<br>                            <span class="hljs-comment">//åæ¥åŠ ä¸Šçš„</span><br>                            <span class="hljs-keyword">if</span> (n &gt; <span class="hljs-number">0</span> &amp;&amp; (n % <span class="hljs-number">1000</span> == <span class="hljs-number">0</span> || n == SQLStringList.Count - <span class="hljs-number">1</span>))<br>                            &#123;<br>                                tx.Commit();<br>                                tx = conn.BeginTransaction();<br>                            &#125;<br>                        &#125;<br>                        <span class="hljs-comment">//tx.Commit();//åŸæ¥ä¸€æ¬¡æ€§æäº¤</span><br>                    &#125;<br>                    <span class="hljs-keyword">catch</span> (System.Data.SqlClient.SqlException E)<br>                    &#123;<br>                        tx.Rollback();<br>                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(E.Message);<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;<br></code></pre></td></tr></table></figure><p>10wæ¡æ•°æ®å¤§æ¦‚ç”¨æ—¶10sï¼</p>]]></content>
    
    
    
    <tags>
      
      <tag>æ•°æ®åº“</tag>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å°†mapæŒ‰ç…§å€¼æ’åº</title>
    <link href="/blog/2021/02/12/%E5%B0%86map%E6%8C%89%E7%85%A7%E5%80%BC%E6%8E%92%E5%BA%8F/"/>
    <url>/blog/2021/02/12/%E5%B0%86map%E6%8C%89%E7%85%A7%E5%80%BC%E6%8E%92%E5%BA%8F/</url>
    
    <content type="html"><![CDATA[<p>å€¼é‡Œé¢å­˜æ”¾çš„æ˜¯ä¸€ä¸ªå¯¹è±¡éœ€è¦æ ¹æ®idæ’åº å°†ç›¸åŒçš„äººæ”¾åœ¨ä¸€èµ·</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;Map.Entry&lt;String, CorrectRate&gt;&gt; list =<br>               <span class="hljs-keyword">new</span> LinkedList&lt;Map.Entry&lt;String, CorrectRate&gt;&gt;(correctRateOm.entrySet());<br>       Collections.sort(list, <span class="hljs-keyword">new</span> Comparator&lt;Map.Entry&lt;String, CorrectRate&gt;&gt;() &#123;<br>           <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">compare</span><span class="hljs-params">(Map.Entry&lt;String, CorrectRate&gt; o1, Map.Entry&lt;String, CorrectRate&gt; o2)</span> </span>&#123;<br>               <span class="hljs-keyword">return</span> (o1.getValue().getStudentId()).compareTo(o2.getValue().getStudentId());<br>           &#125;<br>       &#125;);<br></code></pre></td></tr></table></figure><h1 id="listé›†åˆåˆ†é¡µ"><a href="#listé›†åˆåˆ†é¡µ" class="headerlink" title="listé›†åˆåˆ†é¡µ"></a>listé›†åˆåˆ†é¡µ</h1><p>javaå¯¹listè¿›è¡Œåˆ†é¡µ <strong>ä¸šåŠ¡åœºæ™¯å› ä¸ºæ•°æ®æ˜¯é€šè¿‡ä»æ•°æ®åº“ä¸­å¤šæ¬¡sqlæŸ¥å‡ºæ¥ä¹‹åå­˜æ”¾åˆ°list æ— æ³•ä½¿ç”¨sqlè¿›è¡Œåˆ†é¡µ</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.unote.echarts.entity;<br> <br><span class="hljs-keyword">import</span> java.util.List;<br> <br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@program</span>: unote</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@description</span>: liståˆ†é¡µå·¥å…·ç±»</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span>: cuixy</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@create</span>: 2019-09-27 09:37</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PageModel</span> </span>&#123;<br> <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> page = <span class="hljs-number">1</span>; <span class="hljs-comment">// å½“å‰é¡µ</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> totalPages = <span class="hljs-number">0</span>; <span class="hljs-comment">// æ€»é¡µæ•°</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> pageRecorders;<span class="hljs-comment">// æ¯é¡µ5æ¡æ•°æ®</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> totalRows = <span class="hljs-number">0</span>; <span class="hljs-comment">// æ€»æ•°æ®æ•°</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> pageStartRow = <span class="hljs-number">0</span>;<span class="hljs-comment">// æ¯é¡µçš„èµ·å§‹æ•°</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> pageEndRow = <span class="hljs-number">0</span>; <span class="hljs-comment">// æ¯é¡µæ˜¾ç¤ºæ•°æ®çš„ç»ˆæ­¢æ•°</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> hasNextPage = <span class="hljs-keyword">false</span>; <span class="hljs-comment">// æ˜¯å¦æœ‰ä¸‹ä¸€é¡µ</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> hasPreviousPage = <span class="hljs-keyword">false</span>; <span class="hljs-comment">// æ˜¯å¦æœ‰å‰ä¸€é¡µ</span><br>    <span class="hljs-keyword">private</span> List list;<br> <br>    <span class="hljs-comment">// private Iterator it;</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">PageModel</span><span class="hljs-params">(List list, <span class="hljs-keyword">int</span> pageRecorders)</span> </span>&#123;<br>        init(list, pageRecorders);<span class="hljs-comment">// é€šè¿‡å¯¹è±¡é›†ï¼Œè®°å½•æ€»æ•°åˆ’åˆ†</span><br>    &#125;<br> <br>    <span class="hljs-comment">/** */</span><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆå§‹åŒ–listï¼Œå¹¶å‘Šä¹‹è¯¥listæ¯é¡µçš„è®°å½•æ•°</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> list</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> pageRecorders</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">(List list, <span class="hljs-keyword">int</span> pageRecorders)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.pageRecorders = pageRecorders;<br>        <span class="hljs-keyword">this</span>.list = list;<br>        totalRows = list.size();<br>        <span class="hljs-comment">// it = list.iterator();</span><br>        hasPreviousPage = <span class="hljs-keyword">false</span>;<br>        <span class="hljs-keyword">if</span> ((totalRows % pageRecorders) == <span class="hljs-number">0</span>) &#123;<br>            totalPages = totalRows / pageRecorders;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            totalPages = totalRows / pageRecorders + <span class="hljs-number">1</span>;<br>        &#125;<br> <br>        <span class="hljs-keyword">if</span> (page &gt;= totalPages) &#123;<br>            hasNextPage = <span class="hljs-keyword">false</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            hasNextPage = <span class="hljs-keyword">true</span>;<br>        &#125;<br> <br>        <span class="hljs-keyword">if</span> (totalRows &lt; pageRecorders) &#123;<br>            <span class="hljs-keyword">this</span>.pageStartRow = <span class="hljs-number">0</span>;<br>            <span class="hljs-keyword">this</span>.pageEndRow = totalRows;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">this</span>.pageStartRow = <span class="hljs-number">0</span>;<br>            <span class="hljs-keyword">this</span>.pageEndRow = pageRecorders;<br>        &#125;<br>    &#125;<br> <br>    <span class="hljs-comment">// åˆ¤æ–­è¦ä¸è¦åˆ†é¡µ</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isNext</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> list.size() &gt; <span class="hljs-number">5</span>;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setHasPreviousPage</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> hasPreviousPage)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.hasPreviousPage = hasPreviousPage;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">(<span class="hljs-keyword">int</span> temp)</span> </span>&#123;<br>        String str = Integer.toString(temp);<br>        <span class="hljs-keyword">return</span> str;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">description</span><span class="hljs-params">()</span> </span>&#123;<br> <br>        String description = <span class="hljs-string">&quot;å…±æœ‰æ•°æ®æ•°:&quot;</span> + <span class="hljs-keyword">this</span>.getTotalRows()<br>                + <span class="hljs-string">&quot;å…±æœ‰é¡µæ•°: &quot;</span> + <span class="hljs-keyword">this</span>.getTotalPages()<br>                + <span class="hljs-string">&quot;å½“å‰é¡µæ•°ä¸º:&quot;</span> + <span class="hljs-keyword">this</span>.getPage()<br>                + <span class="hljs-string">&quot; æ˜¯å¦æœ‰å‰ä¸€é¡µ: &quot;</span> + <span class="hljs-keyword">this</span>.isHasPreviousPage()<br>                + <span class="hljs-string">&quot; æ˜¯å¦æœ‰ä¸‹ä¸€é¡µ:&quot;</span> + <span class="hljs-keyword">this</span>.isHasNextPage()<br>                + <span class="hljs-string">&quot; å¼€å§‹è¡Œæ•°:&quot;</span> + <span class="hljs-keyword">this</span>.getPageStartRow()<br>                + <span class="hljs-string">&quot; ç»ˆæ­¢è¡Œæ•°:&quot;</span> + <span class="hljs-keyword">this</span>.getPageEndRow();<br> <br>        System.out.println(description);<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> List <span class="hljs-title">getNextPage</span><span class="hljs-params">()</span> </span>&#123;<br>        page = page + <span class="hljs-number">1</span>;<br> <br>        disposePage();<br> <br>        System.out.println(<span class="hljs-string">&quot;ç”¨æˆ·å‡‹ç”¨çš„æ˜¯ç¬¬&quot;</span> + page + <span class="hljs-string">&quot;é¡µ&quot;</span>);<br>        <span class="hljs-keyword">this</span>.description();<br>        <span class="hljs-keyword">return</span> getObjects(page);<br>    &#125;<br> <br>    <span class="hljs-comment">/** */</span><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¤„ç†åˆ†é¡µ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">disposePage</span><span class="hljs-params">()</span> </span>&#123;<br> <br>        <span class="hljs-keyword">if</span> (page == <span class="hljs-number">0</span>) &#123;<br>            page = <span class="hljs-number">1</span>;<br>        &#125;<br> <br>        <span class="hljs-keyword">if</span> ((page - <span class="hljs-number">1</span>) &gt; <span class="hljs-number">0</span>) &#123;<br>            hasPreviousPage = <span class="hljs-keyword">true</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            hasPreviousPage = <span class="hljs-keyword">false</span>;<br>        &#125;<br> <br>        <span class="hljs-keyword">if</span> (page &gt;= totalPages) &#123;<br>            hasNextPage = <span class="hljs-keyword">false</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            hasNextPage = <span class="hljs-keyword">true</span>;<br>        &#125;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> List <span class="hljs-title">getPreviousPage</span><span class="hljs-params">()</span> </span>&#123;<br> <br>        page = page - <span class="hljs-number">1</span>;<br> <br>        <span class="hljs-keyword">if</span> ((page - <span class="hljs-number">1</span>) &gt; <span class="hljs-number">0</span>) &#123;<br>            hasPreviousPage = <span class="hljs-keyword">true</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            hasPreviousPage = <span class="hljs-keyword">false</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (page &gt;= totalPages) &#123;<br>            hasNextPage = <span class="hljs-keyword">false</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            hasNextPage = <span class="hljs-keyword">true</span>;<br>        &#125;<br>        <span class="hljs-keyword">this</span>.description();<br>        <span class="hljs-keyword">return</span> getObjects(page);<br>    &#125;<br> <br>    <span class="hljs-comment">/** */</span><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·å–ç¬¬å‡ é¡µçš„å†…å®¹</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> page</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> List <span class="hljs-title">getObjects</span><span class="hljs-params">(<span class="hljs-keyword">int</span> page)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (page == <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">this</span>.setPage(<span class="hljs-number">1</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">this</span>.setPage(page);<br>        &#125;<br>        <span class="hljs-keyword">this</span>.disposePage();<br>        <span class="hljs-keyword">if</span> (page * pageRecorders &lt; totalRows) &#123;<span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦ä¸ºæœ€åä¸€é¡µ</span><br>            pageEndRow = page * pageRecorders;<br>            pageStartRow = pageEndRow - pageRecorders;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            pageEndRow = totalRows;<br>            pageStartRow = pageRecorders * (totalPages - <span class="hljs-number">1</span>);<br>        &#125;<br> <br>        List objects = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">if</span> (!list.isEmpty()) &#123;<br>            objects = list.subList(pageStartRow, pageEndRow);<br>        &#125;<br>        <span class="hljs-comment">//this.description();</span><br>        <span class="hljs-keyword">return</span> objects;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> List <span class="hljs-title">getFistPage</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isNext()) &#123;<br>            <span class="hljs-keyword">return</span> list.subList(<span class="hljs-number">0</span>, pageRecorders);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> list;<br>        &#125;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isHasNextPage</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> hasNextPage;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setHasNextPage</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> hasNextPage)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.hasNextPage = hasNextPage;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> List <span class="hljs-title">getList</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> list;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setList</span><span class="hljs-params">(List list)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.list = list;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getPage</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> page;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPage</span><span class="hljs-params">(<span class="hljs-keyword">int</span> page)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.page = page;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getPageEndRow</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> pageEndRow;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPageEndRow</span><span class="hljs-params">(<span class="hljs-keyword">int</span> pageEndRow)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.pageEndRow = pageEndRow;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getPageRecorders</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> pageRecorders;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPageRecorders</span><span class="hljs-params">(<span class="hljs-keyword">int</span> pageRecorders)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.pageRecorders = pageRecorders;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getPageStartRow</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> pageStartRow;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPageStartRow</span><span class="hljs-params">(<span class="hljs-keyword">int</span> pageStartRow)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.pageStartRow = pageStartRow;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getTotalPages</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> totalPages;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setTotalPages</span><span class="hljs-params">(<span class="hljs-keyword">int</span> totalPages)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.totalPages = totalPages;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getTotalRows</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> totalRows;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setTotalRows</span><span class="hljs-params">(<span class="hljs-keyword">int</span> totalRows)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.totalRows = totalRows;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isHasPreviousPage</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> hasPreviousPage;<br>    &#125;<br> <br> <br>&#125;<br></code></pre></td></tr></table></figure><p>è°ƒç”¨æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">PageModel pm = <span class="hljs-keyword">new</span> PageModel(list, Integer.parseInt(page_size));<span class="hljs-comment">//æ¯é¡µæ˜¾ç¤ºæ¡æ•°</span><br> <br>List sublist = pm.getObjects(Integer.parseInt(page_no));<span class="hljs-comment">//æ˜¾ç¤ºç¬¬å‡ é¡µ</span><br> <br> <br>data.put(<span class="hljs-string">&quot;list&quot;</span>, sublist);<br>data.put(<span class="hljs-string">&quot;total_count&quot;</span>, list.size());<br>data.put(<span class="hljs-string">&quot;page_no&quot;</span>, Integer.parseInt(page_no));<br>data.put(<span class="hljs-string">&quot;page_size&quot;</span>, Integer.parseInt(page_size));<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·ç±»</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>map</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è·å–mapå¯¹è±¡ä¸­çš„æœ€å¤§æœ€å°å€¼</title>
    <link href="/blog/2021/02/07/%E8%8E%B7%E5%8F%96map%E5%AF%B9%E8%B1%A1%E4%B8%AD%E7%9A%84%E6%9C%80%E5%A4%A7%E6%9C%80%E5%B0%8F%E5%80%BC/"/>
    <url>/blog/2021/02/07/%E8%8E%B7%E5%8F%96map%E5%AF%B9%E8%B1%A1%E4%B8%AD%E7%9A%84%E6%9C%80%E5%A4%A7%E6%9C%80%E5%B0%8F%E5%80%BC/</url>
    
    <content type="html"><![CDATA[<p>é‡åˆ°çš„é—®é¢˜æ˜¯è·å–mapä¸­çš„æœ€é«˜æˆç»©å’Œæœ€ä½æˆç»© xxx.entrySet() è¿™é‡Œæ”¾çš„ä½ çš„map</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/WechatIMG96_1569388966080.png" alt="WechatIMG96">ä¸¤ç§æ–¹å¼</p><h1 id="1-8å"><a href="#1-8å" class="headerlink" title="1.8å"></a>1.8å</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;Map.Entry&lt;String, CorrectRate&gt;&gt; list = <span class="hljs-keyword">new</span> ArrayList(correctRateOm.entrySet());<br>Collections.sort(list, (o1, o2) -&gt; (o1.getValue().getScore().intValue() - o2.getValue().getScore().intValue()));<br>        <br>Double minScore = list.get(<span class="hljs-number">0</span>).getValue().getScore();<br> <br>List&lt;Map.Entry&lt;String, CorrectRate&gt;&gt; list1 = <span class="hljs-keyword">new</span> ArrayList(correctRateOm.entrySet());<br>Collections.sort(list1, (o1, o2) -&gt; (o2.getValue().getScore().intValue()) - o1.getValue().getScore().intValue());<br> <br>Double maxScore = list1.get(<span class="hljs-number">0</span>).getValue().getScore();<br></code></pre></td></tr></table></figure><h1 id="1-8å‰"><a href="#1-8å‰" class="headerlink" title="1.8å‰"></a>1.8å‰</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//æœ€å¤§å€¼</span><br>               List&lt;Map.Entry&lt;String, CorrectRate&gt;&gt; list = <span class="hljs-keyword">new</span> ArrayList(correctRateOm.entrySet());<br>               Collections.sort(list, <span class="hljs-keyword">new</span> Comparator&lt;Map.Entry&lt;String, CorrectRate&gt;&gt;() &#123;<br>                           <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">compare</span><span class="hljs-params">(Map.Entry&lt;String, CorrectRate&gt; o1, Map.Entry&lt;String, CorrectRate&gt; o2)</span> </span>&#123;<br>                               <span class="hljs-keyword">return</span> (o2.getValue().getScore().intValue() - o1.getValue().getScore().intValue());<br>                           &#125;<br>                       &#125;<br>               );<br>Double maxScore = list.get(<span class="hljs-number">0</span>).getValue().getScore();<br><br>               <span class="hljs-comment">//æœ€å°å€¼</span><br>               List&lt;Map.Entry&lt;String, CorrectRate&gt;&gt; list1 = <span class="hljs-keyword">new</span> ArrayList(correctRateOm1.entrySet());<br>               Collections.sort(list1, <span class="hljs-keyword">new</span> Comparator&lt;Map.Entry&lt;String, CorrectRate&gt;&gt;() &#123;<br>                           <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">compare</span><span class="hljs-params">(Map.Entry&lt;String, CorrectRate&gt; o1, Map.Entry&lt;String, CorrectRate&gt; o2)</span> </span>&#123;<br>                               <span class="hljs-keyword">return</span> (o1.getValue().getScore().intValue() - o2.getValue().getScore().intValue());<br>                           &#125;<br>                       &#125;<br>               );<br>Double minScore = list1.get(<span class="hljs-number">0</span>).getValue().getScore();<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>å·¥å…·</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBootæ•´åˆRabbitMQ</title>
    <link href="/blog/2021/02/06/SpringBoot%E6%95%B4%E5%90%88RabbitMQ/"/>
    <url>/blog/2021/02/06/SpringBoot%E6%95%B4%E5%90%88RabbitMQ/</url>
    
    <content type="html"><![CDATA[<h1 id="æ·»åŠ ä¾èµ–"><a href="#æ·»åŠ ä¾èµ–" class="headerlink" title="æ·»åŠ ä¾èµ–"></a>æ·»åŠ ä¾èµ–</h1><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependency&gt;<br>    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>    &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure><h1 id="æ·»åŠ é…ç½®"><a href="#æ·»åŠ é…ç½®" class="headerlink" title="æ·»åŠ é…ç½®"></a>æ·»åŠ é…ç½®</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">spring.rabbitmq.host=<span class="hljs-number">192.168</span><span class="hljs-number">.2</span><span class="hljs-number">.71</span><br>spring.rabbitmq.port=<span class="hljs-number">5672</span><br>spring.rabbitmq.username=light<br>spring.rabbitmq.password=light<br>spring.rabbitmq.virtual-host=/test<br></code></pre></td></tr></table></figure><h1 id="ç¼–ç "><a href="#ç¼–ç " class="headerlink" title="ç¼–ç "></a>ç¼–ç </h1><h2 id="é…ç½®ç±»"><a href="#é…ç½®ç±»" class="headerlink" title="é…ç½®ç±»"></a>é…ç½®ç±»</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AmqpConfirguration</span> </span>&#123;<br> <br>  <span class="hljs-comment">//=============ç®€å•ã€å·¥ä½œé˜Ÿåˆ—æ¨¡å¼===============</span><br> <br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String SIMPLE_QUEUE = <span class="hljs-string">&quot;simple_queue&quot;</span>;<br> <br>  <span class="hljs-meta">@Bean</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> Queue <span class="hljs-title">queue</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Queue(SIMPLE_QUEUE, <span class="hljs-keyword">true</span>);<br>  &#125;<br> <br>  <span class="hljs-comment">//===============å‘å¸ƒ/è®¢é˜…æ¨¡å¼============</span><br> <br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String PS_QUEUE_1 = <span class="hljs-string">&quot;ps_queue_1&quot;</span>;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String PS_QUEUE_2 = <span class="hljs-string">&quot;ps_queue_2&quot;</span>;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String FANOUT_EXCHANGE = <span class="hljs-string">&quot;fanout_exchange&quot;</span>;<br> <br>  <span class="hljs-meta">@Bean</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> Queue <span class="hljs-title">psQueue1</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Queue(PS_QUEUE_1, <span class="hljs-keyword">true</span>);<br>  &#125;<br> <br>  <span class="hljs-meta">@Bean</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> Queue <span class="hljs-title">psQueue2</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Queue(PS_QUEUE_2, <span class="hljs-keyword">true</span>);<br>  &#125;<br> <br>  <span class="hljs-meta">@Bean</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> FanoutExchange <span class="hljs-title">fanoutExchange</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FanoutExchange(FANOUT_EXCHANGE);<br>  &#125;<br> <br>  <span class="hljs-meta">@Bean</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> Binding <span class="hljs-title">fanoutBinding1</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> BindingBuilder.bind(psQueue1()).to(fanoutExchange());<br>  &#125;<br> <br>  <span class="hljs-meta">@Bean</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> Binding <span class="hljs-title">fanoutBinding2</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> BindingBuilder.bind(psQueue2()).to(fanoutExchange());<br>  &#125;<br> <br>  <span class="hljs-comment">//===============è·¯ç”±æ¨¡å¼============</span><br> <br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String ROUTING_QUEUE_1 = <span class="hljs-string">&quot;routing_queue_1&quot;</span>;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String ROUTING_QUEUE_2 = <span class="hljs-string">&quot;routing_queue_2&quot;</span>;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String DIRECT_EXCHANGE = <span class="hljs-string">&quot;direct_exchange&quot;</span>;<br> <br>  <span class="hljs-meta">@Bean</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> Queue <span class="hljs-title">routingQueue1</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Queue(ROUTING_QUEUE_1, <span class="hljs-keyword">true</span>);<br>  &#125;<br> <br>  <span class="hljs-meta">@Bean</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> Queue <span class="hljs-title">routingQueue2</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Queue(ROUTING_QUEUE_2, <span class="hljs-keyword">true</span>);<br>  &#125;<br> <br>  <span class="hljs-meta">@Bean</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> DirectExchange <span class="hljs-title">directExchange</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DirectExchange(DIRECT_EXCHANGE);<br>  &#125;<br> <br>  <span class="hljs-meta">@Bean</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> Binding <span class="hljs-title">directBinding1</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> BindingBuilder.bind(routingQueue1()).to(directExchange()).with(<span class="hljs-string">&quot;user&quot;</span>);<br>  &#125;<br> <br>  <span class="hljs-meta">@Bean</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> Binding <span class="hljs-title">directBinding2</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> BindingBuilder.bind(routingQueue2()).to(directExchange()).with(<span class="hljs-string">&quot;order&quot;</span>);<br>  &#125;<br> <br>  <span class="hljs-comment">//===============ä¸»é¢˜æ¨¡å¼============</span><br> <br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String TOPIC_QUEUE_1 = <span class="hljs-string">&quot;topic_queue_1&quot;</span>;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String TOPIC_QUEUE_2 = <span class="hljs-string">&quot;topic_queue_2&quot;</span>;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String TOPIC_EXCHANGE = <span class="hljs-string">&quot;topic_exchange&quot;</span>;<br> <br>  <span class="hljs-meta">@Bean</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> Queue <span class="hljs-title">topicQueue1</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Queue(TOPIC_QUEUE_1, <span class="hljs-keyword">true</span>);<br>  &#125;<br> <br>  <span class="hljs-meta">@Bean</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> Queue <span class="hljs-title">topicQueue2</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Queue(TOPIC_QUEUE_2, <span class="hljs-keyword">true</span>);<br>  &#125;<br> <br>  <span class="hljs-meta">@Bean</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> TopicExchange <span class="hljs-title">topicExchange</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> TopicExchange(TOPIC_EXCHANGE);<br>  &#125;<br> <br>  <span class="hljs-meta">@Bean</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> Binding <span class="hljs-title">topicBinding1</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> BindingBuilder.bind(topicQueue1()).to(topicExchange()).with(<span class="hljs-string">&quot;user.add&quot;</span>);<br>  &#125;<br> <br>  <span class="hljs-meta">@Bean</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> Binding <span class="hljs-title">topicBinding2</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> BindingBuilder.bind(topicQueue2()).to(topicExchange()).with(<span class="hljs-string">&quot;user.#&quot;</span>);<br>  &#125;<br> <br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æ¶ˆæ¯ç”Ÿäº§è€…ï¼š"><a href="#æ¶ˆæ¯ç”Ÿäº§è€…ï¼š" class="headerlink" title="æ¶ˆæ¯ç”Ÿäº§è€…ï¼š"></a>æ¶ˆæ¯ç”Ÿäº§è€…ï¼š</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AmqpSender</span> </span>&#123;<br> <br>  <span class="hljs-meta">@Autowired</span><br>  <span class="hljs-keyword">private</span> AmqpTemplate amqpTemplate;<br> <br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * ç®€å•æ¨¡å¼å‘é€</span><br><span class="hljs-comment">   *</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> message</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">simpleSend</span><span class="hljs-params">(String message)</span> </span>&#123;<br>    <span class="hljs-keyword">this</span>.amqpTemplate.convertAndSend(AmqpConfirguration.SIMPLE_QUEUE, message);<br>  &#125;<br> <br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * å‘å¸ƒ/è®¢é˜…æ¨¡å¼å‘é€</span><br><span class="hljs-comment">   *</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> message</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">psSend</span><span class="hljs-params">(String message)</span> </span>&#123;<br>    <span class="hljs-keyword">this</span>.amqpTemplate.convertAndSend(AmqpConfirguration.FANOUT_EXCHANGE, <span class="hljs-string">&quot;&quot;</span>, message);<br>  &#125;<br> <br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * è·¯ç”±æ¨¡å¼å‘é€</span><br><span class="hljs-comment">   *</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> message</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">routingSend</span><span class="hljs-params">(String routingKey, String message)</span> </span>&#123;<br>    <span class="hljs-keyword">this</span>.amqpTemplate.convertAndSend(AmqpConfirguration.DIRECT_EXCHANGE, routingKey, message);<br>  &#125;<br> <br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * ä¸»é¢˜æ¨¡å¼å‘é€</span><br><span class="hljs-comment">   *</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> routingKey</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> message</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">topicSend</span><span class="hljs-params">(String routingKey, String message)</span> </span>&#123;<br>    <span class="hljs-keyword">this</span>.amqpTemplate.convertAndSend(AmqpConfirguration.TOPIC_EXCHANGE, routingKey, message);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æ¶ˆæ¯æ¶ˆè´¹è€…ï¼š"><a href="#æ¶ˆæ¯æ¶ˆè´¹è€…ï¼š" class="headerlink" title="æ¶ˆæ¯æ¶ˆè´¹è€…ï¼š"></a>æ¶ˆæ¯æ¶ˆè´¹è€…ï¼š</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AmqpReceiver</span> </span>&#123;<br> <br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * ç®€å•æ¨¡å¼æ¥æ”¶</span><br><span class="hljs-comment">   *</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> message</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-meta">@RabbitListener(queues = AmqpConfirguration.SIMPLE_QUEUE)</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">simpleReceive</span><span class="hljs-params">(String message)</span> </span>&#123;<br>    System.out.println(<span class="hljs-string">&quot;æ¥æ”¶æ¶ˆæ¯:&quot;</span> + message);<br>  &#125;<br> <br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * å‘å¸ƒ/è®¢é˜…æ¨¡å¼æ¥æ”¶</span><br><span class="hljs-comment">   *</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> message</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-meta">@RabbitListener(queues = AmqpConfirguration.PS_QUEUE_1)</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">psReceive1</span><span class="hljs-params">(String message)</span> </span>&#123;<br>    System.out.println(AmqpConfirguration.PS_QUEUE_1 + <span class="hljs-string">&quot;æ¥æ”¶æ¶ˆæ¯:&quot;</span> + message);<br>  &#125;<br> <br>  <span class="hljs-meta">@RabbitListener(queues = AmqpConfirguration.PS_QUEUE_2)</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">psReceive2</span><span class="hljs-params">(String message)</span> </span>&#123;<br>    System.out.println(AmqpConfirguration.PS_QUEUE_2 + <span class="hljs-string">&quot;æ¥æ”¶æ¶ˆæ¯:&quot;</span> + message);<br>  &#125;<br> <br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * è·¯ç”±æ¨¡å¼æ¥æ”¶</span><br><span class="hljs-comment">   *</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> message</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-meta">@RabbitListener(queues = AmqpConfirguration.ROUTING_QUEUE_1)</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">routingReceive1</span><span class="hljs-params">(String message)</span> </span>&#123;<br>    System.out.println(AmqpConfirguration.ROUTING_QUEUE_1 + <span class="hljs-string">&quot;æ¥æ”¶æ¶ˆæ¯:&quot;</span> + message);<br>  &#125;<br> <br>  <span class="hljs-meta">@RabbitListener(queues = AmqpConfirguration.ROUTING_QUEUE_2)</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">routingReceive2</span><span class="hljs-params">(String message)</span> </span>&#123;<br>    System.out.println(AmqpConfirguration.ROUTING_QUEUE_2 + <span class="hljs-string">&quot;æ¥æ”¶æ¶ˆæ¯:&quot;</span> + message);<br>  &#125;<br> <br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * ä¸»é¢˜æ¨¡å¼æ¥æ”¶</span><br><span class="hljs-comment">   *</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> message</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-meta">@RabbitListener(queues = AmqpConfirguration.TOPIC_QUEUE_1)</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">topicReceive1</span><span class="hljs-params">(String message)</span> </span>&#123;<br>    System.out.println(AmqpConfirguration.TOPIC_QUEUE_1 + <span class="hljs-string">&quot;æ¥æ”¶æ¶ˆæ¯:&quot;</span> + message);<br>  &#125;<br> <br>  <span class="hljs-meta">@RabbitListener(queues = AmqpConfirguration.TOPIC_QUEUE_2)</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">topicReceive2</span><span class="hljs-params">(String message)</span> </span>&#123;<br>    System.out.println(AmqpConfirguration.TOPIC_QUEUE_2 + <span class="hljs-string">&quot;æ¥æ”¶æ¶ˆæ¯:&quot;</span> + message);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¶ˆæ¯æ¶ˆè´¹è€…ä½¿ç”¨ @RabbitListener æ³¨è§£ç›‘å¬æ¶ˆæ¯ã€‚</p><h1 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RunWith(SpringRunner.class)</span><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AmqpTest</span> </span>&#123;<br> <br>  <span class="hljs-meta">@Autowired</span><br>  <span class="hljs-keyword">private</span> AmqpSender sender;<br> <br>  <span class="hljs-meta">@Test</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testSimpleSend</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">6</span>; i++) &#123;<br>      <span class="hljs-keyword">this</span>.sender.simpleSend(<span class="hljs-string">&quot;test simpleSend &quot;</span> + i);<br>    &#125;<br>  &#125;<br> <br>  <span class="hljs-meta">@Test</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testPsSend</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">6</span>; i++) &#123;<br>      <span class="hljs-keyword">this</span>.sender.psSend(<span class="hljs-string">&quot;test psSend &quot;</span> + i);<br>    &#125;<br>  &#125;<br> <br>  <span class="hljs-meta">@Test</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testRoutingSend</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">6</span>; i++) &#123;<br>      <span class="hljs-keyword">this</span>.sender.routingSend(<span class="hljs-string">&quot;order&quot;</span>, <span class="hljs-string">&quot;test routingSend &quot;</span> + i);<br>    &#125;<br>  &#125;<br> <br>  <span class="hljs-meta">@Test</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testTopicSend</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">6</span>; i++) &#123;<br>      <span class="hljs-keyword">this</span>.sender.topicSend(<span class="hljs-string">&quot;user.add&quot;</span>, <span class="hljs-string">&quot;test topicSend &quot;</span> + i);<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>SpringBoot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SpringBoot</tag>
      
      <tag>RabbitMQ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBootæ•´åˆActiveMQ</title>
    <link href="/blog/2021/02/06/SpringBoot%E6%95%B4%E5%90%88ActiveMQ/"/>
    <url>/blog/2021/02/06/SpringBoot%E6%95%B4%E5%90%88ActiveMQ/</url>
    
    <content type="html"><![CDATA[<h1 id="æ·»åŠ ä¾èµ–"><a href="#æ·»åŠ ä¾èµ–" class="headerlink" title="æ·»åŠ ä¾èµ–"></a>æ·»åŠ ä¾èµ–</h1><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependency&gt;<br>  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>  &lt;artifactId&gt;spring-boot-starter-activemq&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br> <br>&lt;!-- å¦‚æœéœ€è¦é…ç½®è¿æ¥æ± ï¼Œæ·»åŠ å¦‚ä¸‹ä¾èµ– --&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;org.apache.activemq&lt;/groupId&gt;<br>    &lt;artifactId&gt;activemq-pool&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure><h1 id="æ·»åŠ é…ç½®"><a href="#æ·»åŠ é…ç½®" class="headerlink" title="æ·»åŠ é…ç½®"></a>æ·»åŠ é…ç½®</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"># activemq é…ç½®<br>spring.activemq.broker-url=tcp:<span class="hljs-comment">//192.168.2.61:61616</span><br>spring.activemq.user=admin<br>spring.activemq.password=admin<br>spring.activemq.pool.enabled=<span class="hljs-keyword">false</span><br>spring.activemq.pool.max-connections=<span class="hljs-number">50</span><br># ä½¿ç”¨å‘å¸ƒ/è®¢é˜…æ¨¡å¼æ—¶ï¼Œä¸‹è¾¹é…ç½®éœ€è¦è®¾ç½®æˆ true<br>spring.jms.pub-sub-domain=<span class="hljs-keyword">false</span><br></code></pre></td></tr></table></figure><p>æ­¤å¤„ spring.activemq.pool.enabled=falseï¼Œè¡¨ç¤ºå…³é—­è¿æ¥æ± ã€‚</p><h1 id="ç¼–ç "><a href="#ç¼–ç " class="headerlink" title="ç¼–ç "></a>ç¼–ç </h1><h2 id="é…ç½®ç±»"><a href="#é…ç½®ç±»" class="headerlink" title="é…ç½®ç±»"></a>é…ç½®ç±»</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JmsConfirguration</span> </span>&#123;<br> <br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String QUEUE_NAME = <span class="hljs-string">&quot;activemq_queue&quot;</span>;<br> <br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String TOPIC_NAME = <span class="hljs-string">&quot;activemq_topic&quot;</span>;<br> <br>  <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Queue <span class="hljs-title">queue</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ActiveMQQueue(QUEUE_NAME);<br>    &#125;<br> <br>  <span class="hljs-meta">@Bean</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> Topic <span class="hljs-title">topic</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ActiveMQTopic(TOPIC_NAME);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æ¶ˆæ¯ç”Ÿäº§è€…"><a href="#æ¶ˆæ¯ç”Ÿäº§è€…" class="headerlink" title="æ¶ˆæ¯ç”Ÿäº§è€…"></a>æ¶ˆæ¯ç”Ÿäº§è€…</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JmsSender</span> </span>&#123;<br> <br>  <span class="hljs-meta">@Autowired</span><br>  <span class="hljs-keyword">private</span> Queue queue;<br> <br>  <span class="hljs-meta">@Autowired</span><br>  <span class="hljs-keyword">private</span> Topic topic;<br> <br>  <span class="hljs-meta">@Autowired</span><br>  <span class="hljs-keyword">private</span> JmsMessagingTemplate jmsTemplate;<br> <br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendByQueue</span><span class="hljs-params">(String message)</span> </span>&#123;<br>    <span class="hljs-keyword">this</span>.jmsTemplate.convertAndSend(queue, message);<br>  &#125;<br> <br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendByTopic</span><span class="hljs-params">(String message)</span> </span>&#123;<br>    <span class="hljs-keyword">this</span>.jmsTemplate.convertAndSend(topic, message);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æ¶ˆæ¯æ¶ˆè´¹è€…"><a href="#æ¶ˆæ¯æ¶ˆè´¹è€…" class="headerlink" title="æ¶ˆæ¯æ¶ˆè´¹è€…"></a>æ¶ˆæ¯æ¶ˆè´¹è€…</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JmsReceiver</span> </span>&#123;<br> <br>  <span class="hljs-meta">@JmsListener(destination = JmsConfirguration.QUEUE_NAME)</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">receiveByQueue</span><span class="hljs-params">(String message)</span> </span>&#123;<br>    System.out.println(<span class="hljs-string">&quot;æ¥æ”¶é˜Ÿåˆ—æ¶ˆæ¯:&quot;</span> + message);<br>  &#125;<br> <br>  <span class="hljs-meta">@JmsListener(destination = JmsConfirguration.TOPIC_NAME)</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">receiveByTopic</span><span class="hljs-params">(String message)</span> </span>&#123;<br>    System.out.println(<span class="hljs-string">&quot;æ¥æ”¶ä¸»é¢˜æ¶ˆæ¯:&quot;</span> + message);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¶ˆæ¯æ¶ˆè´¹è€…ä½¿ç”¨ @JmsListener æ³¨è§£ç›‘å¬æ¶ˆæ¯ã€‚</p><h1 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RunWith(SpringRunner.class)</span><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JmsTest</span> </span>&#123;<br> <br>  <span class="hljs-meta">@Autowired</span><br>  <span class="hljs-keyword">private</span> JmsSender sender;<br> <br>  <span class="hljs-meta">@Test</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testSendByQueue</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">6</span>; i++) &#123;<br>      <span class="hljs-keyword">this</span>.sender.sendByQueue(<span class="hljs-string">&quot;hello activemq queue &quot;</span> + i);<br>    &#125;<br>  &#125;<br> <br>  <span class="hljs-meta">@Test</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testSendByTopic</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">6</span>; i++) &#123;<br>      <span class="hljs-keyword">this</span>.sender.sendByTopic(<span class="hljs-string">&quot;hello activemq topic &quot;</span> + i);<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="æ‰“å°ç»“æœï¼š"><a href="#æ‰“å°ç»“æœï¼š" class="headerlink" title="æ‰“å°ç»“æœï¼š"></a>æ‰“å°ç»“æœï¼š</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">æ¥æ”¶é˜Ÿåˆ—æ¶ˆæ¯:hello activemq queue <span class="hljs-number">1</span><br>æ¥æ”¶é˜Ÿåˆ—æ¶ˆæ¯:hello activemq queue <span class="hljs-number">2</span><br>æ¥æ”¶é˜Ÿåˆ—æ¶ˆæ¯:hello activemq queue <span class="hljs-number">3</span><br>æ¥æ”¶é˜Ÿåˆ—æ¶ˆæ¯:hello activemq queue <span class="hljs-number">4</span><br>æ¥æ”¶é˜Ÿåˆ—æ¶ˆæ¯:hello activemq queue <span class="hljs-number">5</span><br></code></pre></td></tr></table></figure><h1 id="æµ‹è¯•å‘å¸ƒ-è®¢é˜…æ¨¡å¼æ—¶"><a href="#æµ‹è¯•å‘å¸ƒ-è®¢é˜…æ¨¡å¼æ—¶" class="headerlink" title="æµ‹è¯•å‘å¸ƒ/è®¢é˜…æ¨¡å¼æ—¶"></a>æµ‹è¯•å‘å¸ƒ/è®¢é˜…æ¨¡å¼æ—¶</h1><p>è®¾ç½® spring.jms.pub-sub-domain=true</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">æ¥æ”¶ä¸»é¢˜æ¶ˆæ¯:hello activemq topic <span class="hljs-number">1</span><br>æ¥æ”¶ä¸»é¢˜æ¶ˆæ¯:hello activemq topic <span class="hljs-number">2</span><br>æ¥æ”¶ä¸»é¢˜æ¶ˆæ¯:hello activemq topic <span class="hljs-number">3</span><br>æ¥æ”¶ä¸»é¢˜æ¶ˆæ¯:hello activemq topic <span class="hljs-number">4</span><br>æ¥æ”¶ä¸»é¢˜æ¶ˆæ¯:hello activemq topic <span class="hljs-number">5</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>SpringBoot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SpringBoot</tag>
      
      <tag>ActiveMQ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ideaå°†é¡¹ç›®æäº¤åˆ°githubä¸Š</title>
    <link href="/blog/2021/02/06/idea%E5%B0%86%E9%A1%B9%E7%9B%AE%E6%8F%90%E4%BA%A4%E5%88%B0github%E4%B8%8A/"/>
    <url>/blog/2021/02/06/idea%E5%B0%86%E9%A1%B9%E7%9B%AE%E6%8F%90%E4%BA%A4%E5%88%B0github%E4%B8%8A/</url>
    
    <content type="html"><![CDATA[<p>é¦–å…ˆåŒºåˆ†git å’Œ github æ˜¯ä¸ä¸€æ ·çš„, github å’Œ ç äº‘æ˜¯ä¸€æ ·çš„ã€‚ æˆ‘çš„æ–‡å­—è¡¨è¾¾ç¡®å®å·® æ‰€ä»¥ä¸€å›¾èƒœä¸‡è¯­åƒè¨€</p><h1 id="é…ç½®æœ¬åœ°"><a href="#é…ç½®æœ¬åœ°" class="headerlink" title="é…ç½®æœ¬åœ°"></a>é…ç½®æœ¬åœ°</h1><p>å…ˆæŠŠä»–æ”¾åˆ°æœ¬åœ°git æœ¬åœ°æƒ³å¿…å¤§å®¶éƒ½å·²ç»å®‰è£…å¥½äº† æ²¡æœ‰å®‰è£…çš„è¯ç™¾åº¦ä¸€ä¸‹ ç„¶åé€‰æ‹©æ•´ä¸ªé¡¹ç›®çš„æ–‡ä»¶å¤¹ ç„¶åé¡¹ç›®ä¼šå˜æˆçº¢è‰²<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/WX20190924-133614@2x_1569303820807.png" alt="WX20190924-133614@2x"></p><h1 id="ä¸Šä¼ æœ¬åœ°"><a href="#ä¸Šä¼ æœ¬åœ°" class="headerlink" title="ä¸Šä¼ æœ¬åœ°"></a>ä¸Šä¼ æœ¬åœ°</h1><p>å³é”®é¡¹ç›® addä¹‹å æ–‡ä»¶éƒ½ä¼šå˜æˆç»¿è‰² ç„¶ååœ¨æäº¤é¡¹ç›®å°±æ²¡é¢œè‰²äº†<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/WX20190924-133704@2x_1569303820892.png" alt="WX20190924-133704@2x"></p><h1 id="ä¸Šä¼ åˆ°GitHub"><a href="#ä¸Šä¼ åˆ°GitHub" class="headerlink" title="ä¸Šä¼ åˆ°GitHub"></a>ä¸Šä¼ åˆ°GitHub</h1><p>è¿™é‡Œè¾“å…¥å¤‡æ³¨ å°±ä¼šæäº¤åˆ°GitHub å¯ä»¥è‡ªå®šä¹‰åå­—æˆ‘è¿™é‡Œä½¿ç”¨çš„å°±æ˜¯é¡¹ç›®çš„åå­—<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/WX20190924-133818@2x_1569303820981.png" alt="WX20190924-133818@2x"></p><h1 id="å®Œæˆ"><a href="#å®Œæˆ" class="headerlink" title="å®Œæˆ"></a>å®Œæˆ</h1><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/WX20190924-134320@2x_1569303820947.png" alt="WX20190924-134320@2x">#ä¸¤è€…åŒºåˆ† ä¸€èˆ¬ä¸Šå…ˆä¸Šä¼ åˆ°æœ¬åœ° ç„¶åå†å³é”®push<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/WX20190924-133901@2x_1569303821043.png" alt="WX20190924-133901@2x"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>SpringBootæ•´åˆRedis</title>
    <link href="/blog/2021/02/05/SpringBoot%E6%95%B4%E5%90%88Redis/"/>
    <url>/blog/2021/02/05/SpringBoot%E6%95%B4%E5%90%88Redis/</url>
    
    <content type="html"><![CDATA[<p>Spring Data Redis ä¸ºæˆ‘ä»¬æä¾› RedisTemplate å’Œ StringRedisTemplate ä¸¤ä¸ªæ¨¡æ¿è¿›è¡Œæ•°æ®æ“ä½œï¼Œå®ƒä»¬ä¸»è¦ çš„è®¿é—®æ–¹æ³•å¦‚ä¸‹ï¼š<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/WX20190919-173422@2x_1568885674306.png" alt="WX20190919-173422@2x"></p><h1 id="æ·»åŠ ä¾èµ–"><a href="#æ·»åŠ ä¾èµ–" class="headerlink" title="æ·»åŠ ä¾èµ–"></a>æ·»åŠ ä¾èµ–</h1><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependency&gt;<br>  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>  &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure><h1 id="é…ç½®è¿æ¥"><a href="#é…ç½®è¿æ¥" class="headerlink" title="é…ç½®è¿æ¥"></a>é…ç½®è¿æ¥</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">spring.redis.host=<span class="hljs-number">192.168</span><span class="hljs-number">.2</span><span class="hljs-number">.11</span><br>spring.redis.port=<span class="hljs-number">6379</span><br>spring.redis.password=redis123<br></code></pre></td></tr></table></figure><h1 id="ç¼–ç "><a href="#ç¼–ç " class="headerlink" title="ç¼–ç "></a>ç¼–ç </h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RedisDao</span> </span>&#123;<br> <br>  <span class="hljs-meta">@Autowired</span><br>  <span class="hljs-keyword">private</span> StringRedisTemplate stringRedisTemplate;<br> <br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">set</span><span class="hljs-params">(String key, String value)</span> </span>&#123;<br>    <span class="hljs-keyword">this</span>.stringRedisTemplate.opsForValue().set(key, value);<br>  &#125;<br> <br>  <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">get</span><span class="hljs-params">(String key)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.stringRedisTemplate.opsForValue().get(key);<br>  &#125;<br> <br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">delete</span><span class="hljs-params">(String key)</span> </span>&#123;<br>    <span class="hljs-keyword">this</span>.stringRedisTemplate.delete(key);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RunWith(SpringRunner.class)</span><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RedisDaoTest</span> </span>&#123;<br> <br>  <span class="hljs-meta">@Autowired</span><br>  <span class="hljs-keyword">private</span> RedisDao redisDao;<br> <br>  <span class="hljs-meta">@Test</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testSet</span><span class="hljs-params">()</span> </span>&#123;<br>    String key = <span class="hljs-string">&quot;name&quot;</span>;<br>    String value = <span class="hljs-string">&quot;zhangsan&quot;</span>;<br> <br>    <span class="hljs-keyword">this</span>.redisDao.set(key, value);<br>  &#125;<br> <br>  <span class="hljs-meta">@Test</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testGet</span><span class="hljs-params">()</span> </span>&#123;<br>    String key = <span class="hljs-string">&quot;name&quot;</span>;<br>    String value = <span class="hljs-keyword">this</span>.redisDao.get(key);<br>    System.out.println(value);<br>  &#125;<br> <br>  <span class="hljs-meta">@Test</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testDelete</span><span class="hljs-params">()</span> </span>&#123;<br>    String key = <span class="hljs-string">&quot;name&quot;</span>;<br>    <span class="hljs-keyword">this</span>.redisDao.delete(key);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>SpringBoot</tag>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBooté…ç½®EhCacheç¼“å­˜</title>
    <link href="/blog/2021/02/05/SpringBoot%E9%85%8D%E7%BD%AEEhCache%E7%BC%93%E5%AD%98/"/>
    <url>/blog/2021/02/05/SpringBoot%E9%85%8D%E7%BD%AEEhCache%E7%BC%93%E5%AD%98/</url>
    
    <content type="html"><![CDATA[<h1 id="æ·»åŠ ä¾èµ–"><a href="#æ·»åŠ ä¾èµ–" class="headerlink" title="æ·»åŠ ä¾èµ–"></a>æ·»åŠ ä¾èµ–</h1><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependency&gt;<br>  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>  &lt;artifactId&gt;spring-boot-starter-cache&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br> <br>&lt;dependency&gt;<br>  &lt;groupId&gt;net.sf.ehcache&lt;/groupId&gt;<br>  &lt;artifactId&gt;ehcache&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure><h1 id="æ·»åŠ é…ç½®"><a href="#æ·»åŠ é…ç½®" class="headerlink" title="æ·»åŠ é…ç½®"></a>æ·»åŠ é…ç½®</h1><p>åœ¨ src/main/resources ç›®å½•ä¸‹åˆ›å»º ehcache.xml æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;<br>&lt;ehcache xmlns:xsi=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br>         xsi:noNamespaceSchemaLocation=<span class="hljs-string">&quot;http://ehcache.org/ehcache.xsd&quot;</span>&gt;<br> <br>    &lt;!-- ç£ç›˜ç¼“å­˜ä½ç½® --&gt;<br>    &lt;diskStore path=<span class="hljs-string">&quot;java.io.tmpdir/ehcache&quot;</span>/&gt;<br> <br>    &lt;!-- é»˜è®¤ç¼“å­˜ --&gt;<br>    &lt;defaultCache<br>            maxEntriesLocalHeap=<span class="hljs-string">&quot;10000&quot;</span><br>            eternal=<span class="hljs-string">&quot;false&quot;</span><br>            timeToIdleSeconds=<span class="hljs-string">&quot;120&quot;</span><br>            timeToLiveSeconds=<span class="hljs-string">&quot;120&quot;</span><br>            maxEntriesLocalDisk=<span class="hljs-string">&quot;10000000&quot;</span><br>            diskExpiryThreadIntervalSeconds=<span class="hljs-string">&quot;120&quot;</span><br>            memoryStoreEvictionPolicy=<span class="hljs-string">&quot;LRU&quot;</span>&gt;<br>        &lt;persistence strategy=<span class="hljs-string">&quot;localTempSwap&quot;</span>/&gt;<br>    &lt;/defaultCache&gt;<br> <br>    &lt;!-- è‡ªå®šä¹‰ç¼“å­˜ --&gt;<br>    &lt;cache name=<span class="hljs-string">&quot;department&quot;</span><br>           maxElementsInMemory=<span class="hljs-string">&quot;1000&quot;</span><br>           eternal=<span class="hljs-string">&quot;false&quot;</span><br>           timeToIdleSeconds=<span class="hljs-string">&quot;50&quot;</span><br>           timeToLiveSeconds=<span class="hljs-string">&quot;50&quot;</span><br>           overflowToDisk=<span class="hljs-string">&quot;false&quot;</span><br>           memoryStoreEvictionPolicy=<span class="hljs-string">&quot;LRU&quot;</span>/&gt;<br>&lt;/ehcache&gt;<br></code></pre></td></tr></table></figure><h1 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java">nameï¼šCache çš„å”¯ä¸€æ ‡è¯†<br>maxElementsInMemoryï¼šå†…å­˜ä¸­å…è®¸å­˜å‚¨çš„æœ€å¤§çš„å…ƒç´ ä¸ªæ•°<br>maxElementsOnDiskï¼šç¡¬ç›˜æœ€å¤§ç¼“å­˜ä¸ªæ•°ï¼Œ<span class="hljs-number">0</span>ä»£è¡¨æ— é™ä¸ª<br>clearOnFlushï¼šå†…å­˜æ•°é‡æœ€å¤§æ—¶æ˜¯å¦æ¸…é™¤<br>eternalï¼šç¼“å­˜å¯¹è±¡æ˜¯å¦æ°¸ä¹…æœ‰æ•ˆï¼Œå¦‚æœæ˜¯ï¼Œè¶…æ—¶è®¾ç½®å°†è¢«å¿½ç•¥<br>overflowToDiskï¼šå†…å­˜ä¸è¶³ï¼ˆè¶…è¿‡ maxElementsInMemoryï¼‰æ—¶ï¼Œæ˜¯å¦å¯ç”¨ç£ç›˜ç¼“å­˜<br>timeToIdleSecondsï¼šè®¾ç½®å¯¹è±¡åœ¨å¤±æ•ˆå‰çš„å…è®¸é—²ç½®æ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰ã€‚ä»…å½“eternal=<span class="hljs-keyword">false</span>å¯¹è±¡ä¸æ˜¯æ°¸ä¹…æœ‰æ•ˆæ—¶ä½¿ç”¨ï¼Œå¯é€‰å±æ€§ï¼Œé»˜è®¤å€¼æ˜¯<span class="hljs-number">0</span>ï¼Œä¹Ÿå°±æ˜¯å¯é—²ç½®æ—¶é—´æ— ç©·å¤§<br>timeToLiveSecondsï¼šç¼“å­˜æ•°æ®çš„ç”Ÿå­˜æ—¶é—´ï¼ˆTTLï¼‰ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå…ƒç´ ä»æ„å»ºåˆ°æ¶ˆäº¡çš„æœ€å¤§æ—¶é—´é—´éš”å€¼ï¼Œè¿™åªèƒ½åœ¨å…ƒç´ ä¸æ˜¯æ°¸ä¹…é©»ç•™æ—¶æœ‰æ•ˆï¼Œå¦‚æœè¯¥å€¼æ˜¯<span class="hljs-number">0</span>å°±æ„å‘³ç€å…ƒç´ å¯ä»¥åœé¡¿æ— ç©·é•¿çš„æ—¶é—´<br>diskPersistentï¼šæ˜¯å¦å°†ç¼“å­˜æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šï¼Œå¦‚æœä¸º <span class="hljs-keyword">true</span>ï¼ŒJVM é‡å¯æ•°æ®ä¾ç„¶å­˜åœ¨ã€‚é»˜è®¤å€¼æ˜¯<span class="hljs-keyword">false</span><br>diskSpoolBufferSizeMBï¼šè¿™ä¸ªå‚æ•°è®¾ç½®DiskStoreï¼ˆç£ç›˜ç¼“å­˜ï¼‰çš„ç¼“å­˜åŒºå¤§å°ã€‚é»˜è®¤æ˜¯30MBã€‚æ¯ä¸ªCacheéƒ½åº”è¯¥æœ‰è‡ªå·±çš„ä¸€ä¸ªç¼“å†²åŒº<br>diskExpiryThreadIntervalSecondsï¼šç£ç›˜å¤±æ•ˆçº¿ç¨‹è¿è¡Œæ—¶é—´é—´éš”ï¼Œé»˜è®¤æ˜¯<span class="hljs-number">120</span>ç§’<br>memoryStoreEvictionPolicyï¼šå½“è¾¾åˆ° maxElementsInMemory é™åˆ¶æ—¶ï¼ŒEhcache å°†æ ¹æ®æŒ‡å®šç­–ç•¥æ¸…é™¤å†…å­˜ã€‚é»˜è®¤ä¸º LRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰ï¼Œå…¶ä»–ç­–ç•¥æœ‰ FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰ï¼ŒLFUï¼ˆè¾ƒå°‘ä½¿ç”¨ï¼‰<br></code></pre></td></tr></table></figure><h1 id="application-properties-ï¼š"><a href="#application-properties-ï¼š" class="headerlink" title="application.properties ï¼š"></a>application.properties ï¼š</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"># ç¼“å­˜ç±»å‹ï¼ˆehcacheã€redisï¼‰<br>spring.cache.type=ehcache<br> <br># ehcache é…ç½®æ–‡ä»¶<br>spring.cache.ehcache.config=classpath:ehcache.xml<br> <br># æ‰“å°æ—¥å¿—ï¼ŒæŸ¥çœ‹ sql<br>logging.level.com.light.springboot=DEBUG<br></code></pre></td></tr></table></figure><h1 id="ç¼–ç "><a href="#ç¼–ç " class="headerlink" title="ç¼–ç "></a>ç¼–ç </h1><p>åœ¨æŒä¹…å±‚ç¯‡çš„åŸºç¡€ä¸Šï¼Œç»“åˆ Mybatis æµ‹è¯•ï¼š</p><p>Service å±‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@CacheConfig(cacheNames = &quot;department&quot;)</span><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DepartmentService</span> </span>&#123;<br> <br>  <span class="hljs-meta">@Autowired</span><br>  <span class="hljs-keyword">private</span> DepartmentMapper departmentMapper;<br> <br>  <span class="hljs-meta">@CachePut(key = &quot;#department.id&quot;)</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> Department <span class="hljs-title">save</span><span class="hljs-params">(Department department)</span> </span>&#123;<br>    System.out.println(<span class="hljs-string">&quot;ä¿å­˜ id=&quot;</span> + department.getId() + <span class="hljs-string">&quot; çš„æ•°æ®&quot;</span>);<br>    <span class="hljs-keyword">this</span>.departmentMapper.insert(department);<br>    <span class="hljs-keyword">return</span> department;<br>  &#125;<br> <br>  <span class="hljs-meta">@CachePut(key = &quot;#department.id&quot;)</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> Department <span class="hljs-title">update</span><span class="hljs-params">(Department department)</span> </span>&#123;<br>    System.out.println(<span class="hljs-string">&quot;ä¿®æ”¹ id=&quot;</span> + department.getId() + <span class="hljs-string">&quot; çš„æ•°æ®&quot;</span>);<br>    <span class="hljs-keyword">this</span>.departmentMapper.update(department);<br>    <span class="hljs-keyword">return</span> department;<br>  &#125;<br> <br>  <span class="hljs-meta">@Cacheable(key = &quot;#id&quot;)</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> Department <span class="hljs-title">getDepartmentById</span><span class="hljs-params">(Integer id)</span> </span>&#123;<br>    System.out.println(<span class="hljs-string">&quot;è·å– id=&quot;</span> + id + <span class="hljs-string">&quot; çš„æ•°æ®&quot;</span>);<br>    Department department = <span class="hljs-keyword">this</span>.departmentMapper.getById(id);<br>    <span class="hljs-keyword">return</span> department;<br>  &#125;<br> <br>  <span class="hljs-meta">@CacheEvict(key = &quot;#id&quot;)</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">delete</span><span class="hljs-params">(Integer id)</span> </span>&#123;<br>    System.out.println(<span class="hljs-string">&quot;åˆ é™¤ id=&quot;</span> + id + <span class="hljs-string">&quot; çš„æ•°æ®&quot;</span>);<br>    <span class="hljs-keyword">this</span>.departmentMapper.deleteById(id);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="æ§åˆ¶å±‚ï¼š"><a href="#æ§åˆ¶å±‚ï¼š" class="headerlink" title="æ§åˆ¶å±‚ï¼š"></a>æ§åˆ¶å±‚ï¼š</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-meta">@RequestMapping(&quot;department&quot;)</span><br><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DepartmentController</span> </span>&#123;<br> <br>  <span class="hljs-meta">@Autowired</span><br>  <span class="hljs-keyword">private</span> DepartmentService departmentService;<br> <br>  <span class="hljs-meta">@RequestMapping(&quot;save&quot;)</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String,Object&gt; <span class="hljs-title">save</span><span class="hljs-params">(Department department)</span> </span>&#123;<br>    <span class="hljs-keyword">this</span>.departmentService.save(department);<br> <br>    Map&lt;String,Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;String,Object&gt;();<br>    map.put(<span class="hljs-string">&quot;code&quot;</span>, <span class="hljs-string">&quot;200&quot;</span>);<br>    map.put(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;ä¿å­˜æˆåŠŸ&quot;</span>);<br>    <span class="hljs-keyword">return</span> map;<br>  &#125;<br> <br>  <span class="hljs-meta">@RequestMapping(&quot;get/&#123;id&#125;&quot;)</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String,Object&gt; <span class="hljs-title">get</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> </span>&#123;<br>    Department department = <span class="hljs-keyword">this</span>.departmentService.getDepartmentById(id);<br> <br>    Map&lt;String,Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;String,Object&gt;();<br>    map.put(<span class="hljs-string">&quot;code&quot;</span>, <span class="hljs-string">&quot;200&quot;</span>);<br>    map.put(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;è·å–æˆåŠŸ&quot;</span>);<br>    map.put(<span class="hljs-string">&quot;data&quot;</span>, department);<br>    <span class="hljs-keyword">return</span> map;<br>  &#125;<br> <br>  <span class="hljs-meta">@RequestMapping(&quot;update&quot;)</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String,Object&gt; <span class="hljs-title">update</span><span class="hljs-params">(Department department)</span> </span>&#123;<br>    <span class="hljs-keyword">this</span>.departmentService.update(department);<br> <br>    Map&lt;String,Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;String,Object&gt;();<br>    map.put(<span class="hljs-string">&quot;code&quot;</span>, <span class="hljs-string">&quot;200&quot;</span>);<br>    map.put(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;ä¿®æ”¹æˆåŠŸ&quot;</span>);<br>    <span class="hljs-keyword">return</span> map;<br>  &#125;<br> <br>  <span class="hljs-meta">@RequestMapping(&quot;delete/&#123;id&#125;&quot;)</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String,Object&gt; <span class="hljs-title">delete</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> </span>&#123;<br>    <span class="hljs-keyword">this</span>.departmentService.delete(id);<br> <br>    Map&lt;String,Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;String,Object&gt;();<br>    map.put(<span class="hljs-string">&quot;code&quot;</span>, <span class="hljs-string">&quot;200&quot;</span>);<br>    map.put(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;åˆ é™¤æˆåŠŸ&quot;</span>);<br>    <span class="hljs-keyword">return</span> map;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯åŠ¨ç±»ï¼š</p><p>æ·»åŠ  @EnableCaching æ³¨è§£ï¼Œå¼€å¯ç¼“å­˜åŠŸèƒ½ã€‚</p><h1 id="æµ‹è¯•è¯´æ˜"><a href="#æµ‹è¯•è¯´æ˜" class="headerlink" title="æµ‹è¯•è¯´æ˜"></a>æµ‹è¯•è¯´æ˜</h1><p>ç”±äº ehcache ç¼“å­˜æ˜¯å­˜å‚¨åœ¨åº”ç”¨çš„å†…å­˜ä¸­ï¼Œå¦‚æœä½¿ç”¨ junit æµ‹è¯•ï¼Œæ–¹æ³•æ‰§è¡Œå®Œæ¯•ç¼“å­˜å°±é‡Šæ”¾äº†ï¼Œæ— æ³•æ­£å¸¸æµ‹è¯•ç¼“å­˜æ•ˆæœï¼Œå› æ­¤æµ‹è¯•ä½¿ç”¨å‘èµ· http è¯·æ±‚çš„å½¢å¼ã€‚</p><p>å‘èµ·ä¿å­˜è¯·æ±‚ï¼š</p><h2 id="å‘èµ·ä¿å­˜è¯·æ±‚ï¼š"><a href="#å‘èµ·ä¿å­˜è¯·æ±‚ï¼š" class="headerlink" title="å‘èµ·ä¿å­˜è¯·æ±‚ï¼š"></a>å‘èµ·ä¿å­˜è¯·æ±‚ï¼š</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">ä¿å­˜ id=<span class="hljs-number">2</span> çš„æ•°æ®<br><span class="hljs-number">2017</span>-<span class="hljs-number">12</span>-<span class="hljs-number">06</span> <span class="hljs-number">14</span>:<span class="hljs-number">50</span>:<span class="hljs-number">48.800</span> DEBUG <span class="hljs-number">680</span> --- [nio-<span class="hljs-number">8081</span>-exec-<span class="hljs-number">7</span>] c.l.s.dao.DepartmentMapper.insert        : ==&gt;  Preparing: <span class="hljs-function">insert into <span class="hljs-title">department</span><span class="hljs-params">(id,name,descr)</span> <span class="hljs-title">values</span><span class="hljs-params">(?,?,?)</span></span><br><span class="hljs-function">2017-12-06 14:50:48.801 DEBUG 680 --- [nio-8081-exec-7] c.l.s.dao.DepartmentMapper.insert        : </span>==&gt; Parameters: <span class="hljs-number">2</span>(Integer), Ehcache éƒ¨é—¨(String), Ehcache(String)<br><span class="hljs-number">2017</span>-<span class="hljs-number">12</span>-<span class="hljs-number">06</span> <span class="hljs-number">14</span>:<span class="hljs-number">50</span>:<span class="hljs-number">48.868</span> DEBUG <span class="hljs-number">680</span> --- [nio-<span class="hljs-number">8081</span>-exec-<span class="hljs-number">7</span>] c.l.s.dao.DepartmentMapper.insert        : &lt;==    Updates: <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>ä¿å­˜æˆåŠŸåï¼Œç«‹åˆ»å‘èµ·æŸ¥è¯¢è¯·æ±‚ï¼Œæ²¡æœ‰æ—¥å¿—æ‰“å°ï¼Œä½†è¿”å›å¯¹è±¡æ•°æ®ï¼Œè¯´æ˜æ•°æ®æ˜¯ä»ç¼“å­˜ä¸­è·å–ã€‚</p><h2 id="å‘èµ·ä¿®æ”¹è¯·æ±‚ï¼š"><a href="#å‘èµ·ä¿®æ”¹è¯·æ±‚ï¼š" class="headerlink" title="å‘èµ·ä¿®æ”¹è¯·æ±‚ï¼š"></a>å‘èµ·ä¿®æ”¹è¯·æ±‚ï¼š</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">ä¿®æ”¹ id=<span class="hljs-number">2</span> çš„æ•°æ®<br><span class="hljs-number">2017</span>-<span class="hljs-number">12</span>-<span class="hljs-number">06</span> <span class="hljs-number">14</span>:<span class="hljs-number">51</span>:<span class="hljs-number">16.588</span> DEBUG <span class="hljs-number">680</span> --- [nio-<span class="hljs-number">8081</span>-exec-<span class="hljs-number">8</span>] c.l.s.dao.DepartmentMapper.update        : ==&gt;  Preparing: update department set name = ? , descr = ? where id = ?<br><span class="hljs-number">2017</span>-<span class="hljs-number">12</span>-<span class="hljs-number">06</span> <span class="hljs-number">14</span>:<span class="hljs-number">51</span>:<span class="hljs-number">16.589</span> DEBUG <span class="hljs-number">680</span> --- [nio-<span class="hljs-number">8081</span>-exec-<span class="hljs-number">8</span>] c.l.s.dao.DepartmentMapper.update        : ==&gt; Parameters: Ehcache éƒ¨é—¨<span class="hljs-number">2</span>(String), Ehcache2(String), <span class="hljs-number">2</span>(Integer)<br><span class="hljs-number">2017</span>-<span class="hljs-number">12</span>-<span class="hljs-number">06</span> <span class="hljs-number">14</span>:<span class="hljs-number">51</span>:<span class="hljs-number">16.657</span> DEBUG <span class="hljs-number">680</span> --- [nio-<span class="hljs-number">8081</span>-exec-<span class="hljs-number">8</span>] c.l.s.dao.DepartmentMapper.update        : &lt;==    Updates: <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>ä¿®æ”¹æˆåŠŸåï¼Œç«‹åˆ»å‘èµ·æŸ¥è¯¢è¯·æ±‚ï¼Œæ²¡æœ‰æ—¥å¿—æ‰“å°ï¼Œä½†è¿”å›ä¿®æ”¹åçš„å¯¹è±¡æ•°æ®ï¼Œè¯´æ˜ç¼“å­˜ä¸­çš„æ•°æ®å·²ç»åŒæ­¥ã€‚</p><h2 id="å‘èµ·åˆ é™¤è¯·æ±‚ï¼š"><a href="#å‘èµ·åˆ é™¤è¯·æ±‚ï¼š" class="headerlink" title="å‘èµ·åˆ é™¤è¯·æ±‚ï¼š"></a>å‘èµ·åˆ é™¤è¯·æ±‚ï¼š</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">åˆ é™¤ id=<span class="hljs-number">2</span> çš„æ•°æ®<br><span class="hljs-number">2017</span>-<span class="hljs-number">12</span>-<span class="hljs-number">06</span> <span class="hljs-number">14</span>:<span class="hljs-number">52</span>:<span class="hljs-number">07.572</span> DEBUG <span class="hljs-number">680</span> --- [nio-<span class="hljs-number">8081</span>-exec-<span class="hljs-number">1</span>] c.l.s.dao.DepartmentMapper.deleteById    : ==&gt;  Preparing: delete from department where id = ?<br><span class="hljs-number">2017</span>-<span class="hljs-number">12</span>-<span class="hljs-number">06</span> <span class="hljs-number">14</span>:<span class="hljs-number">52</span>:<span class="hljs-number">07.572</span> DEBUG <span class="hljs-number">680</span> --- [nio-<span class="hljs-number">8081</span>-exec-<span class="hljs-number">1</span>] c.l.s.dao.DepartmentMapper.deleteById    : ==&gt; Parameters: <span class="hljs-number">2</span>(Integer)<br><span class="hljs-number">2017</span>-<span class="hljs-number">12</span>-<span class="hljs-number">06</span> <span class="hljs-number">14</span>:<span class="hljs-number">52</span>:<span class="hljs-number">07.613</span> DEBUG <span class="hljs-number">680</span> --- [nio-<span class="hljs-number">8081</span>-exec-<span class="hljs-number">1</span>] c.l.s.dao.DepartmentMapper.deleteById    : &lt;==    Updates: <span class="hljs-number">1</span><br> <br></code></pre></td></tr></table></figure><p>åˆ é™¤æˆåŠŸåï¼Œç«‹åˆ»å‘èµ·æŸ¥è¯¢è¯·æ±‚ï¼Œæ§åˆ¶å°æ‰“å° sql è¯­å¥ï¼Œè¯´æ˜ç¼“å­˜æ•°æ®è¢«åˆ é™¤ï¼Œéœ€è¦æŸ¥è¯¢æ•°æ®åº“ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">è·å– id=<span class="hljs-number">2</span> çš„æ•°æ®<br><span class="hljs-number">2017</span>-<span class="hljs-number">12</span>-<span class="hljs-number">06</span> <span class="hljs-number">14</span>:<span class="hljs-number">52</span>:<span class="hljs-number">40.324</span> DEBUG <span class="hljs-number">680</span> --- [nio-<span class="hljs-number">8081</span>-exec-<span class="hljs-number">3</span>] c.l.s.dao.DepartmentMapper.getById       : ==&gt;  Preparing: select id,name,descr from department where id = ?<br><span class="hljs-number">2017</span>-<span class="hljs-number">12</span>-<span class="hljs-number">06</span> <span class="hljs-number">14</span>:<span class="hljs-number">52</span>:<span class="hljs-number">40.325</span> DEBUG <span class="hljs-number">680</span> --- [nio-<span class="hljs-number">8081</span>-exec-<span class="hljs-number">3</span>] c.l.s.dao.DepartmentMapper.getById       : ==&gt; Parameters: <span class="hljs-number">2</span>(Integer)<br><span class="hljs-number">2017</span>-<span class="hljs-number">12</span>-<span class="hljs-number">06</span> <span class="hljs-number">14</span>:<span class="hljs-number">52</span>:<span class="hljs-number">40.328</span> DEBUG <span class="hljs-number">680</span> --- [nio-<span class="hljs-number">8081</span>-exec-<span class="hljs-number">3</span>] c.l.s.dao.DepartmentMapper.getById       : &lt;==      Total: <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>SpringBoot</tag>
      
      <tag>EhCache</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Springbooté…ç½® Druid æ•°æ®æº</title>
    <link href="/blog/2021/02/03/Springboot%E9%85%8D%E7%BD%AEDruid%20%E6%95%B0%E6%8D%AE%E6%BA%90/"/>
    <url>/blog/2021/02/03/Springboot%E9%85%8D%E7%BD%AEDruid%20%E6%95%B0%E6%8D%AE%E6%BA%90/</url>
    
    <content type="html"><![CDATA[<h1 id="æ·»åŠ ä¾èµ–"><a href="#æ·»åŠ ä¾èµ–" class="headerlink" title="æ·»åŠ ä¾èµ–"></a>æ·»åŠ ä¾èµ–</h1><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependency&gt;<br>    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;<br>    &lt;artifactId&gt;druid&lt;/artifactId&gt;<br>    &lt;version&gt;1.1.8&lt;/version&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure><h1 id="æ·»åŠ é…ç½®"><a href="#æ·»åŠ é…ç½®" class="headerlink" title="æ·»åŠ é…ç½®"></a>æ·»åŠ é…ç½®</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java">spring.datasource.druid.driverClassName=com.mysql.jdbc.Driver<br>spring.datasource.druid.url=jdbc:mysql:<span class="hljs-comment">//localhost:3306/springboot?useUnicode=true&amp;characterEncoding=utf8&amp;serverTimezone=UTC</span><br>spring.datasource.druid.username=root<br>spring.datasource.druid.password=tiger<br> <br>spring.datasource.druid.initialSize=<span class="hljs-number">5</span><br>spring.datasource.druid.minIdle=<span class="hljs-number">5</span><br>spring.datasource.druid.maxActive=<span class="hljs-number">20</span><br>spring.datasource.druid.maxWait=<span class="hljs-number">60000</span><br>spring.datasource.druid.timeBetweenEvictionRunsMillis=<span class="hljs-number">60000</span><br>spring.datasource.druid.min-evictableIdleTimeMillis=<span class="hljs-number">300000</span><br>spring.datasource.druid.validationQuery=SELECT <span class="hljs-number">1</span> FROM DUAL<br>spring.datasource.druid.testWhileIdle=<span class="hljs-keyword">true</span><br>spring.datasource.druid.testOnBorrow=<span class="hljs-keyword">false</span><br>spring.datasource.druid.testOnReturn=<span class="hljs-keyword">false</span><br>spring.datasource.druid.poolPreparedStatements=<span class="hljs-keyword">true</span><br>spring.datasource.druid.maxPoolPreparedStatementPerConnectionSize=<span class="hljs-number">20</span><br>spring.datasource.druid.filters=stat,wall<br> <br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼šé…ç½®ä¸­éƒ½æ˜¯ä»¥ spring.datasource.druid å¼€å¤´ï¼Œä½¿ç”¨é©¼å³°å‘½å</p><h1 id="ä»£ç å¦‚ä¸‹"><a href="#ä»£ç å¦‚ä¸‹" class="headerlink" title="ä»£ç å¦‚ä¸‹"></a>ä»£ç å¦‚ä¸‹</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DruidConfiguration</span> </span>&#123;<br> <br>    <span class="hljs-meta">@ConfigurationProperties(prefix = &quot;spring.datasource.druid&quot;)</span><br>    <span class="hljs-meta">@Bean(initMethod = &quot;init&quot;,destroyMethod = &quot;close&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> DruidDataSource <span class="hljs-title">dataSource</span><span class="hljs-params">()</span> </span>&#123;<br>        DruidDataSource ds = <span class="hljs-keyword">new</span> DruidDataSource();<br>        ds.setProxyFilters(Arrays.asList(statFilter()));<br>        <span class="hljs-keyword">return</span> ds;<br>    &#125;<br> <br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Filter <span class="hljs-title">statFilter</span><span class="hljs-params">()</span> </span>&#123;<br>        StatFilter filter = <span class="hljs-keyword">new</span> StatFilter();<br>        filter.setSlowSqlMillis(<span class="hljs-number">5000</span>);<br>        filter.setLogSlowSql(<span class="hljs-keyword">true</span>);<br>        filter.setMergeSql(<span class="hljs-keyword">true</span>);<br>        <span class="hljs-keyword">return</span> filter;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸ºäº†ä¿è¯è®¿é—®çš„å®‰å…¨æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java">## druid ç›‘æ§<br>spring.datasource.druid.web-stat-filter.enabled=<span class="hljs-keyword">true</span><br>spring.datasource.druid.web-stat-filter.url-pattern=<span class="hljs-comment">/*</span><br><span class="hljs-comment">spring.datasource.druid.web-stat-filter.exclusions=*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*</span><br><span class="hljs-comment"> </span><br><span class="hljs-comment">## druid ç›‘æ§é¡µé¢</span><br><span class="hljs-comment">spring.datasource.druid.stat-view-servlet.enabled=true</span><br><span class="hljs-comment">spring.datasource.druid.stat-view-servlet.url-pattern=/druid/*</span><br><span class="hljs-comment">spring.datasource.druid.stat-view-servlet.login-username=druid</span><br><span class="hljs-comment">spring.datasource.druid.stat-view-servlet.login-password=druid123</span><br><span class="hljs-comment"> </span><br></code></pre></td></tr></table></figure><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/WX20190917-133136@2x_1568698317734.png" alt="WX20190917-133136@2x"></p>]]></content>
    
    
    
    <tags>
      
      <tag>Springboot</tag>
      
      <tag>Druid</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBootæ•´åˆMybatis</title>
    <link href="/blog/2021/02/03/SpringBoot%E6%95%B4%E5%90%88Mybatis/"/>
    <url>/blog/2021/02/03/SpringBoot%E6%95%B4%E5%90%88Mybatis/</url>
    
    <content type="html"><![CDATA[<h1 id="æ•´åˆ-Mybatis"><a href="#æ•´åˆ-Mybatis" class="headerlink" title="æ•´åˆ Mybatis"></a>æ•´åˆ Mybatis</h1><h2 id="é…ç½®ä¾èµ–"><a href="#é…ç½®ä¾èµ–" class="headerlink" title="é…ç½®ä¾èµ–"></a>é…ç½®ä¾èµ–</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;!-- jdbc --&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>    &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br> <br>&lt;!-- mybatis --&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;org.mybatis&lt;/groupId&gt;<br>    &lt;artifactId&gt;mybatis&lt;/artifactId&gt;<br>    &lt;version&gt;3.4.4&lt;/version&gt;<br>&lt;/dependency&gt;<br> <br>&lt;!-- spring,mybatisæ•´åˆåŒ… --&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;org.mybatis&lt;/groupId&gt;<br>    &lt;artifactId&gt;mybatis-spring&lt;/artifactId&gt;<br>    &lt;version&gt;1.3.1&lt;/version&gt;<br>&lt;/dependency&gt;<br> <br>&lt;!-- mysql é©±åŠ¨åŒ… --&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;mysql&lt;/groupId&gt;<br>    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure><h2 id="é…ç½®æ•°æ®åº“è¿æ¥ï¼š"><a href="#é…ç½®æ•°æ®åº“è¿æ¥ï¼š" class="headerlink" title="é…ç½®æ•°æ®åº“è¿æ¥ï¼š"></a>é…ç½®æ•°æ®åº“è¿æ¥ï¼š</h2><p>åœ¨ application.properties ä¸­æ·»åŠ ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"># æ•°æ®æºé…ç½®<br>spring.datasource.driver-<span class="hljs-class"><span class="hljs-keyword">class</span>-<span class="hljs-title">name</span></span>=com.mysql.jdbc.Driver<br>spring.datasource.url=jdbc:mysql:<span class="hljs-comment">//localhost:3306/springboot?useUnicode=true&amp;characterEncoding=utf8&amp;serverTimezone=UTC</span><br>spring.datasource.username=root<br>spring.datasource.password=tiger<br></code></pre></td></tr></table></figure><h2 id="åˆ›å»ºé…ç½®ç±»ï¼š"><a href="#åˆ›å»ºé…ç½®ç±»ï¼š" class="headerlink" title="åˆ›å»ºé…ç½®ç±»ï¼š"></a>åˆ›å»ºé…ç½®ç±»ï¼š</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBatisConfiguration</span> </span>&#123;<br> <br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@ConditionalOnMissingBean</span> <span class="hljs-comment">// å½“å®¹å™¨é‡Œæ²¡æœ‰æŒ‡å®šçš„ Bean çš„æƒ…å†µä¸‹åˆ›å»ºè¯¥å¯¹è±¡</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> SqlSessionFactoryBean <span class="hljs-title">sqlSessionFactory</span><span class="hljs-params">(DataSource dataSource)</span> </span>&#123;<br>        SqlSessionFactoryBean sqlSessionFactoryBean = <span class="hljs-keyword">new</span> SqlSessionFactoryBean();<br>        <span class="hljs-comment">// è®¾ç½®æ•°æ®æº</span><br>        sqlSessionFactoryBean.setDataSource(dataSource);<br> <br>        <span class="hljs-comment">// è®¾ç½®mybatisçš„ä¸»é…ç½®æ–‡ä»¶</span><br>        sqlSessionFactoryBean.setConfigLocation(<span class="hljs-keyword">new</span> ClassPathResource(<span class="hljs-string">&quot;mybatis/mybatis-config.xml&quot;</span>));<br> <br>        <span class="hljs-comment">// è®¾ç½®mapperæ˜ å°„æ–‡ä»¶</span><br>        PathMatchingResourcePatternResolver resolver = <span class="hljs-keyword">new</span> PathMatchingResourcePatternResolver();<br>        Resource[] mapperXml;<br>        <span class="hljs-keyword">try</span> &#123;<br>            mapperXml = resolver.getResources(<span class="hljs-string">&quot;classpath:mybatis/mapper/*.xml&quot;</span>);<br>            sqlSessionFactoryBean.setMapperLocations(mapperXml);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br> <br>        <span class="hljs-comment">// è®¾ç½®åˆ«ååŒ…</span><br>        sqlSessionFactoryBean.setTypeAliasesPackage(<span class="hljs-string">&quot;com.light.springboot.domain&quot;</span>);<br> <br>        <span class="hljs-keyword">return</span> sqlSessionFactoryBean;<br>    &#125;<br> <br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@ConditionalOnBean(SqlSessionFactoryBean.class)</span> <span class="hljs-comment">// å½“ SqlSessionFactoryBean å®ä¾‹å­˜åœ¨æ—¶åˆ›å»ºå¯¹è±¡</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> MapperScannerConfigurer <span class="hljs-title">mapperScannerConfigurer</span><span class="hljs-params">()</span> </span>&#123;<br>        MapperScannerConfigurer mapperScannerConfigurer = <span class="hljs-keyword">new</span> MapperScannerConfigurer();<br>        mapperScannerConfigurer.setBasePackage(<span class="hljs-string">&quot;com.light.springboot.mapper&quot;</span>);<br>        <span class="hljs-keyword">return</span> mapperScannerConfigurer;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ src/main/resources ä¸‹åˆ›å»º mybatis æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨ mybatis æ–‡ä»¶å¤¹ä¸­åˆ›å»º â€œmybatis-config.xmlâ€ é…ç½®æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;<br>&lt;!DOCTYPE configuration<br>        PUBLIC <span class="hljs-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span><br>        <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;<br>&lt;configuration&gt;<br>    &lt;settings&gt;<br>        &lt;!-- è·å–æ•°æ®åº“è‡ªå¢ä¸»é”®å€¼ --&gt;<br>        &lt;setting name=<span class="hljs-string">&quot;useGeneratedKeys&quot;</span> value=<span class="hljs-string">&quot;true&quot;</span>/&gt;<br>        &lt;!-- ä½¿ç”¨åˆ—åˆ«åæ›¿æ¢åˆ—åï¼Œé»˜è®¤ä¸º <span class="hljs-keyword">true</span> --&gt;<br>        &lt;setting name=<span class="hljs-string">&quot;useColumnLabel&quot;</span> value=<span class="hljs-string">&quot;true&quot;</span>/&gt;<br>        &lt;!-- å¼€å¯é©¼å³°å‘½åè½¬æ¢ï¼šTable(create_time) =&gt; Entity(createTime) --&gt;<br>        &lt;setting name=<span class="hljs-string">&quot;mapUnderscoreToCamelCase&quot;</span> value=<span class="hljs-string">&quot;true&quot;</span>/&gt;<br>    &lt;/settings&gt;<br>&lt;/configuration&gt;<br></code></pre></td></tr></table></figure><p>mybatis æ–‡ä»¶å¤¹ä¸‹å†åˆ›å»ºä¸€ä¸ª â€œmapperâ€ æ–‡ä»¶å¤¹ï¼Œé‡Œè¾¹å­˜æ”¾ Mpper æ¥å£å¯¹åº”çš„ mapper æ˜ å°„æ–‡ä»¶ã€‚</p><h1 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h1><h2 id="å»ºè¡¨"><a href="#å»ºè¡¨" class="headerlink" title="å»ºè¡¨"></a>å»ºè¡¨</h2><p>åœ¨ MySQL ä¸­åˆ›å»ºåä¸º springboot çš„æ•°æ®åº“ï¼Œåœ¨è¯¥åº“ä¸­åˆ›å»º role è¡¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">CREATE TABLE `department` (<br>    `id` INT(<span class="hljs-number">11</span>) NOT NULL,<br>    `name` VARCHAR(<span class="hljs-number">10</span>) NOT NULL,<br>    `descr` VARCHAR(<span class="hljs-number">50</span>) NULL DEFAULT NULL,<br>    <span class="hljs-function">PRIMARY <span class="hljs-title">KEY</span> <span class="hljs-params">(`id`)</span></span><br><span class="hljs-function">)</span><br><span class="hljs-function">ENGINE</span>=InnoDB<br>;<br></code></pre></td></tr></table></figure><h2 id="å®ä½“ç±»"><a href="#å®ä½“ç±»" class="headerlink" title="å®ä½“ç±»"></a>å®ä½“ç±»</h2><p>setet å’Œ getter æ–¹æ³•çœç•¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Department</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span></span>&#123;<br> <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = <span class="hljs-number">6067283535977178571L</span>;<br> <br>    <span class="hljs-keyword">private</span> Integer id;<br>    <br>    <span class="hljs-keyword">private</span> String name;<br>    <br>    <span class="hljs-keyword">private</span> String descr;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Mapper-æ¥å£"><a href="#Mapper-æ¥å£" class="headerlink" title="Mapper æ¥å£"></a>Mapper æ¥å£</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Mapper</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">DepartmentMapper</span> </span>&#123;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">insert</span><span class="hljs-params">(Department department)</span></span>;<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Department <span class="hljs-title">getById</span><span class="hljs-params">(Integer id)</span></span>;<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">(Department department)</span></span>;<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteById</span><span class="hljs-params">(Integer id)</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¡¥å……ï¼šMapper æ¥å£éœ€è¦æ·»åŠ  @Mapper æ³¨è§£ï¼Œå¦‚æœä¸æƒ³ä½¿ç”¨è¯¥æ³¨è§£ï¼Œå¯ä»¥åœ¨å¯åŠ¨ç±»ä¸Šä½¿ç”¨ @MapperScan é…ç½® Mapper æ¥å£è·¯å¾„</p><p>mybatis/mapper/departmentMapper.xml ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;<br>&lt;!DOCTYPE mapper PUBLIC <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span><br><span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;<br>&lt;mapper namespace=<span class="hljs-string">&quot;com.light.springboot.dao.DepartmentMapper&quot;</span>&gt;<br> <br>    &lt;insert id=<span class="hljs-string">&quot;insert&quot;</span> parameterType=<span class="hljs-string">&quot;com.light.springboot.domain.Department&quot;</span>&gt;<br>        <span class="hljs-function">insert into <span class="hljs-title">department</span><span class="hljs-params">(id,name,descr)</span> <span class="hljs-title">values</span><span class="hljs-params">(#&#123;id&#125;,#&#123;name&#125;,#&#123;descr&#125;)</span></span><br><span class="hljs-function">    &lt;/insert&gt;</span><br><span class="hljs-function">    </span><br><span class="hljs-function">    &lt;select id</span>=<span class="hljs-string">&quot;getById&quot;</span> parameterType=<span class="hljs-string">&quot;java.lang.Integer&quot;</span> resultType=<span class="hljs-string">&quot;com.light.springboot.domain.Department&quot;</span>&gt;<br>        select id,name,descr from department where id = #&#123;id&#125;<br>    &lt;/select&gt;<br>    <br>    &lt;update id=<span class="hljs-string">&quot;update&quot;</span> parameterType=<span class="hljs-string">&quot;com.light.springboot.domain.Department&quot;</span>&gt;<br>        update department set descr = #&#123;descr&#125; where id = #&#123;id&#125;<br>    &lt;/update&gt;<br>    <br>    &lt;delete id=<span class="hljs-string">&quot;deleteById&quot;</span> parameterType=<span class="hljs-string">&quot;java.lang.Integer&quot;</span>&gt;<br>        delete from department where id = #&#123;id&#125;<br>    &lt;/delete&gt;<br>&lt;/mapper&gt;<br></code></pre></td></tr></table></figure><h2 id="æµ‹è¯•ç±»"><a href="#æµ‹è¯•ç±»" class="headerlink" title="æµ‹è¯•ç±»"></a>æµ‹è¯•ç±»</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RunWith(SpringRunner.class)</span><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DepartmentTest</span> </span>&#123;<br> <br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> DepartmentMapper departmentMapper;<br>    <br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testInsert</span><span class="hljs-params">()</span> </span>&#123;<br>        Department department = <span class="hljs-keyword">new</span> Department();<br>        department.setId(<span class="hljs-number">1</span>);<br>        department.setName(<span class="hljs-string">&quot;ç ”å‘éƒ¨&quot;</span>);<br>        department.setDescr(<span class="hljs-string">&quot;å¼€å‘äº§å“&quot;</span>);<br>        <span class="hljs-keyword">this</span>.departmentMapper.insert(department);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testGetById</span><span class="hljs-params">()</span> </span>&#123;<br>        Department department = <span class="hljs-keyword">this</span>.departmentMapper.getById(<span class="hljs-number">1</span>);<br>        System.out.println(department);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testUpdate</span><span class="hljs-params">()</span> </span>&#123;<br>        Department department = <span class="hljs-keyword">new</span> Department();<br>        department.setId(<span class="hljs-number">1</span>);<br>        department.setDescr(<span class="hljs-string">&quot;å¼€å‘é«˜çº§äº§å“&quot;</span>);<br>        <span class="hljs-keyword">this</span>.departmentMapper.update(department);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testDeleteById</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.departmentMapper.deleteById(<span class="hljs-number">1</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>SpringBoot</tag>
      
      <tag>Mybatis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBootæ•´åˆSpring-data-jpa</title>
    <link href="/blog/2021/02/03/SpringBoot%E6%95%B4%E5%90%88Spring-data-jpa/"/>
    <url>/blog/2021/02/03/SpringBoot%E6%95%B4%E5%90%88Spring-data-jpa/</url>
    
    <content type="html"><![CDATA[<p>å¢åˆ æ”¹æŸ¥å¾ˆçˆ½å°±å¯¹äº† é€‚åˆä¸šåŠ¡æ€§æ¯”è¾ƒå•ä¸€çš„é¡¹ç›®</p><h1 id="æ·»åŠ ä¾èµ–"><a href="#æ·»åŠ ä¾èµ–" class="headerlink" title="æ·»åŠ ä¾èµ–"></a>æ·»åŠ ä¾èµ–</h1><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;!-- jdbc --&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>    &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br> <br>&lt;!-- springboot,jpa æ•´åˆåŒ…--&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>    &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br> <br>&lt;!-- mysql é©±åŠ¨åŒ… --&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;mysql&lt;/groupId&gt;<br>    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure><h1 id="é…ç½®æ•°æ®åº“è¿æ¥"><a href="#é…ç½®æ•°æ®åº“è¿æ¥" class="headerlink" title="é…ç½®æ•°æ®åº“è¿æ¥"></a>é…ç½®æ•°æ®åº“è¿æ¥</h1><p>åœ¨ application.properties ä¸­æ·»åŠ ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"># æ•°æ®åº“è¿æ¥é…ç½®<br>spring.datasource.driver-<span class="hljs-class"><span class="hljs-keyword">class</span>-<span class="hljs-title">name</span></span>=com.mysql.jdbc.Driver<br>spring.datasource.url=jdbc:mysql:<span class="hljs-comment">//localhost:3306/springboot?useUnicode=true&amp;characterEncoding=utf8&amp;serverTimezone=UTC</span><br>spring.datasource.username=root<br>spring.datasource.password=tiger<br> <br># JPA é…ç½®<br>spring.jpa.hibernate.ddl-auto=update<br>spring.jpa.show-sql=<span class="hljs-keyword">true</span><br></code></pre></td></tr></table></figure><h1 id="ç¼–ç "><a href="#ç¼–ç " class="headerlink" title="ç¼–ç "></a>ç¼–ç </h1><h2 id="å»ºè¡¨"><a href="#å»ºè¡¨" class="headerlink" title="å»ºè¡¨"></a>å»ºè¡¨</h2><p>åœ¨ MySQL ä¸­åˆ›å»ºåä¸º springboot çš„æ•°æ®åº“ï¼Œåœ¨è¯¥åº“ä¸­åˆ›å»º role è¡¨ï¼š æ³¨æ„ï¼Œä¸»é”® ID ä¸º AUTO_INCREMENT è‡ªå¢ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">CREATE TABLE `role` (<br>    `id` INT(<span class="hljs-number">11</span>) NOT NULL AUTO_INCREMENT,<br>    `name` VARCHAR(<span class="hljs-number">10</span>) NOT NULL,<br>    `descr` VARCHAR(<span class="hljs-number">100</span>) NULL DEFAULT NULL,<br>    <span class="hljs-function">PRIMARY <span class="hljs-title">KEY</span> <span class="hljs-params">(`id`)</span></span><br><span class="hljs-function">)</span><br><span class="hljs-function">COLLATE</span>=<span class="hljs-string">&#x27;utf8_general_ci&#x27;</span><br>ENGINE=InnoDB<br>;<br></code></pre></td></tr></table></figure><h2 id="å»ºå®ä½“ç±»"><a href="#å»ºå®ä½“ç±»" class="headerlink" title="å»ºå®ä½“ç±»"></a>å»ºå®ä½“ç±»</h2><p>æ·»åŠ ç›¸åº”çš„æ³¨è§£ getset</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Entity</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Role</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span></span>&#123;<br> <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = <span class="hljs-number">3926276668667517847L</span>;<br> <br>    <span class="hljs-meta">@Id</span><br>    <span class="hljs-meta">@GeneratedValue</span><br>    <span class="hljs-keyword">private</span> Integer id;<br>    <br>    <span class="hljs-meta">@Column</span><br>    <span class="hljs-keyword">private</span> String name;<br>    <br>    <span class="hljs-meta">@Column</span><br>    <span class="hljs-keyword">private</span> String descr;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Repository-æ¥å£"><a href="#Repository-æ¥å£" class="headerlink" title="Repository æ¥å£"></a>Repository æ¥å£</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">RoleRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">Role</span>, <span class="hljs-title">Integer</span>&gt;</span>&#123;<br> <br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æµ‹è¯•ç±»"><a href="#æµ‹è¯•ç±»" class="headerlink" title="æµ‹è¯•ç±»"></a>æµ‹è¯•ç±»</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RunWith(SpringRunner.class)</span><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RoleRepositoryTest</span> </span>&#123;<br> <br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RoleRepository roleRepository;<br>    <br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testInsert</span><span class="hljs-params">()</span> </span>&#123;<br>        Role role = <span class="hljs-keyword">new</span> Role();<br>        role.setName(<span class="hljs-string">&quot;ç®¡ç†å‘˜&quot;</span>);<br>        role.setDescr(<span class="hljs-string">&quot;æµ‹è¯•&quot;</span>);<br>        Role result = <span class="hljs-keyword">this</span>.roleRepository.save(role);<br>        System.out.println(result);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testFindOne</span><span class="hljs-params">()</span> </span>&#123;<br>        Role role = <span class="hljs-keyword">this</span>.roleRepository.findOne(<span class="hljs-number">1</span>);<br>        System.out.println(role);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testUpdate</span><span class="hljs-params">()</span> </span>&#123;<br>        Role role = <span class="hljs-keyword">new</span> Role();<br>        role.setId(<span class="hljs-number">1</span>);<br>        role.setName(<span class="hljs-string">&quot;ç®¡ç†å‘˜&quot;</span>);<br>        role.setDescr(<span class="hljs-string">&quot;æ§åˆ¶æƒé™&quot;</span>);<br>        Role result = <span class="hljs-keyword">this</span>.roleRepository.save(role);<br>        System.out.println(result);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testDelete</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.roleRepository.delete(<span class="hljs-number">1</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>SpringBoot</tag>
      
      <tag>jpa</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Dockerå®‰è£…Tomcat</title>
    <link href="/blog/2021/02/02/Docker%E5%AE%89%E8%A3%85Tomcat/"/>
    <url>/blog/2021/02/02/Docker%E5%AE%89%E8%A3%85Tomcat/</url>
    
    <content type="html"><![CDATA[<h1 id="æŸ¥çœ‹-Tomcat-é•œåƒ"><a href="#æŸ¥çœ‹-Tomcat-é•œåƒ" class="headerlink" title="æŸ¥çœ‹ Tomcat é•œåƒ"></a>æŸ¥çœ‹ Tomcat é•œåƒ</h1><p>æˆ‘ä¸€èˆ¬ä¸Šéƒ½æ˜¯ç›´æ¥è·å–æœ€æ–°çš„ é™¤éæŒ‡å®šè¦å“ªä¸ªç‰ˆæœ¬çš„æ—¶å€™ <strong>docker search tomcat</strong></p><h1 id="è·å–-Tomcat-é•œåƒ"><a href="#è·å–-Tomcat-é•œåƒ" class="headerlink" title="è·å– Tomcat é•œåƒ"></a>è·å– Tomcat é•œåƒ</h1><p>æ¯”å¦‚ï¼š è¿™ç§æ˜¯æŒ‡å®šç‰ˆæœ¬ docker pull mongo:3.2.4 dockre pull redis:3.2</p><p><strong>docker pull tomcat</strong>ï¼ˆè¿™ç§æ–¹æ³•æ˜¯è·å–æœ€æ–°çš„Tomcaté•œåƒï¼‰</p><h1 id="å¯åŠ¨Tomcatå®¹å™¨å®ä¾‹"><a href="#å¯åŠ¨Tomcatå®¹å™¨å®ä¾‹" class="headerlink" title="å¯åŠ¨Tomcatå®¹å™¨å®ä¾‹"></a>å¯åŠ¨Tomcatå®¹å™¨å®ä¾‹</h1><p>ç¬¬ä¸€ä¸ªç«¯å£æ˜¯å¤–éƒ¨è®¿é—®çš„ æˆ‘è¿™é‡Œæ¢æˆ 8888 <strong>docker run â€“name tomcat -d -it â€“rm -p 8888:8080 tomcat</strong> â€“rm:è¡¨ç¤ºå½“å…³é—­æˆ–è€…é”€æ¯å½“å‰å®¹å™¨å®ä¾‹è¿›ç¨‹æ—¶ï¼ŒåŒæ—¶é”€æ¯å®¹å™¨å®ä¾‹ã€‚<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/WX20190911-173602@2x_1568194575420.png" alt="WX20190911-173602@2x"></p><h1 id="å®ä¾‹åŒ–Tomcatå®¹å™¨å®ä¾‹"><a href="#å®ä¾‹åŒ–Tomcatå®¹å™¨å®ä¾‹" class="headerlink" title="å®ä¾‹åŒ–Tomcatå®¹å™¨å®ä¾‹"></a>å®ä¾‹åŒ–Tomcatå®¹å™¨å®ä¾‹</h1><p>docker restart tomcatï¼ˆtomcatæ˜¯å½“å‰å®ä¾‹çš„åç§°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å½“å‰å®ä¾‹çš„å®¹å™¨IDæ¥é‡å¯ï¼‰</p><h1 id="å…³é—­Tomcatå®¹å™¨å®ä¾‹"><a href="#å…³é—­Tomcatå®¹å™¨å®ä¾‹" class="headerlink" title="å…³é—­Tomcatå®¹å™¨å®ä¾‹"></a>å…³é—­Tomcatå®¹å™¨å®ä¾‹</h1><p>docker stop tomcatï¼ˆtomcatæ˜¯å½“å‰å®ä¾‹çš„åç§°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å½“å‰å®ä¾‹çš„å®¹å™¨IDæ¥é‡å¯ï¼‰</p><h1 id="å¯åŠ¨Tomcatå®¹å™¨å®ä¾‹-1"><a href="#å¯åŠ¨Tomcatå®¹å™¨å®ä¾‹-1" class="headerlink" title="å¯åŠ¨Tomcatå®¹å™¨å®ä¾‹"></a>å¯åŠ¨Tomcatå®¹å™¨å®ä¾‹</h1><p>docker start tomcat</p><h1 id="æŸ¥çœ‹Tomcatå®¹å™¨å®ä¾‹è¿›ç¨‹ä¿¡æ¯"><a href="#æŸ¥çœ‹Tomcatå®¹å™¨å®ä¾‹è¿›ç¨‹ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹Tomcatå®¹å™¨å®ä¾‹è¿›ç¨‹ä¿¡æ¯"></a>æŸ¥çœ‹Tomcatå®¹å™¨å®ä¾‹è¿›ç¨‹ä¿¡æ¯</h1><p>é€šè¿‡docker top tomcatæŸ¥çœ‹</p><p>é€šè¿‡ps -ef | grep tomcatæŸ¥çœ‹</p><h1 id="æ€æ­»Tomcatå®¹å™¨å®ä¾‹è¿›ç¨‹"><a href="#æ€æ­»Tomcatå®¹å™¨å®ä¾‹è¿›ç¨‹" class="headerlink" title="æ€æ­»Tomcatå®¹å™¨å®ä¾‹è¿›ç¨‹"></a>æ€æ­»Tomcatå®¹å™¨å®ä¾‹è¿›ç¨‹</h1><p>docker kill -s KILL tomcat å†æŸ¥çœ‹ docker ps</p><h1 id="ç§»é™¤Tomcatå®¹å™¨å®ä¾‹"><a href="#ç§»é™¤Tomcatå®¹å™¨å®ä¾‹" class="headerlink" title="ç§»é™¤Tomcatå®¹å™¨å®ä¾‹"></a>ç§»é™¤Tomcatå®¹å™¨å®ä¾‹</h1><p>docker rm -f -v tomcat</p><h1 id="è¿›å…¥Tomcatå®¹å™¨å®ä¾‹"><a href="#è¿›å…¥Tomcatå®¹å™¨å®ä¾‹" class="headerlink" title="è¿›å…¥Tomcatå®¹å™¨å®ä¾‹"></a>è¿›å…¥Tomcatå®¹å™¨å®ä¾‹</h1><p>docker exec -it tomcat /bin/sh</p><h1 id="Tomcat-ç¯å¢ƒè¯´æ˜"><a href="#Tomcat-ç¯å¢ƒè¯´æ˜" class="headerlink" title="Tomcat ç¯å¢ƒè¯´æ˜"></a>Tomcat ç¯å¢ƒè¯´æ˜</h1><p>Tomcat 7ã€Tomcat 8 åœ¨å®¹å™¨çš„ä¸­çš„é»˜è®¤ç¯å¢ƒï¼š CATALINA_BASE: /usr/local/tomcat CATALINA_HOME: /usr/local/tomcat CATALINA_TMPDIR: /usr/local/tomcat/temp JRE_HOME: /usr CLASSPATH: /usr/local/tomcat/bin/bootstrap.jar:/usr/local/tomcat/bin/tomcat-juli.jar</p><h1 id="ä¸Šä¼ WEBåº”ç”¨åˆ°Tomcatçš„å®¹å™¨å®ä¾‹ä¸­"><a href="#ä¸Šä¼ WEBåº”ç”¨åˆ°Tomcatçš„å®¹å™¨å®ä¾‹ä¸­" class="headerlink" title="ä¸Šä¼ WEBåº”ç”¨åˆ°Tomcatçš„å®¹å™¨å®ä¾‹ä¸­"></a>ä¸Šä¼ WEBåº”ç”¨åˆ°Tomcatçš„å®¹å™¨å®ä¾‹ä¸­</h1><p>è¿›å…¥waråŒ… æ–‡ä»¶æ‰€åœ¨ç›®å½• docker cp tyrone-demo.war tomcat:/usr/local/tomcat/webapps</p><p>æ³¨æ„ï¼šå°†WEBåº”ç”¨å¤åˆ¶åˆ°Tomcatå®¹å™¨å®ä¾‹ä¸­åï¼Œä¼šè‡ªåŠ¨è§£å‹éƒ¨ç½²çš„ï¼Œä¸éœ€è¦é‡å¯å®¹å™¨ã€‚</p><h1 id="æŸ¥çœ‹Tomcatå®¹å™¨å®ä¾‹ä¸­çš„WEBåº”ç”¨"><a href="#æŸ¥çœ‹Tomcatå®¹å™¨å®ä¾‹ä¸­çš„WEBåº”ç”¨" class="headerlink" title="æŸ¥çœ‹Tomcatå®¹å™¨å®ä¾‹ä¸­çš„WEBåº”ç”¨"></a>æŸ¥çœ‹Tomcatå®¹å™¨å®ä¾‹ä¸­çš„WEBåº”ç”¨</h1><p>è¯­æ³•ï¼šdocker exec -it tomcat /bin/shï¼ˆç›¸å½“äºå¼€å¯tomcatç»ˆç«¯ï¼‰</p>]]></content>
    
    
    
    <tags>
      
      <tag>Docker</tag>
      
      <tag>Tomcat</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HashMapæŒ‰ç…§valueæ’åº</title>
    <link href="/blog/2021/02/02/HashMap%E6%8C%89%E7%85%A7value%E6%8E%92%E5%BA%8F/"/>
    <url>/blog/2021/02/02/HashMap%E6%8C%89%E7%85%A7value%E6%8E%92%E5%BA%8F/</url>
    
    <content type="html"><![CDATA[<h1 id="é¢è¯•é¢˜"><a href="#é¢è¯•é¢˜" class="headerlink" title="é¢è¯•é¢˜"></a>é¢è¯•é¢˜</h1><p>ç»™å®šä¸€ä¸ªHashMap&lt;String, BuziObj&gt; buziObjMap;ï¼Œå…¶ä¸­ BuziObj å®ç°äº† Comparable æ¥å£ã€‚ç°åœ¨éœ€è¦å°† buziObjMap æŒ‰ç…§ BuziObj æœ‰åºè¾“å‡ºã€‚æ³¨æ„ï¼ŒBuziObj å®ä¾‹æœ‰å¯èƒ½ç›¸ç­‰ï¼Œè¦æ±‚å¤šæ¬¡è¿”å›çš„ç»“æœä¸€è‡´ã€‚å¯ä»¥ä½¿ç”¨JDKæä¾›çš„å„ç§APIã€‚</p><p>å½“æ—¶è‡ªå·±çš„æƒ³æ³•æ˜¯ï¼Œå°† buziObjMap çš„ values æ”¾åœ¨ä¸€ä¸ª List ä¸­ã€‚ç„¶åä½¿ç”¨ Collections.sort(valuesList) å¯¹å­˜æ”¾ values çš„ valuesList æ’åºã€‚å†éå†æ’åºä¹‹åçš„ valuesList å’Œ buziObjMapï¼Œæ¯”å¯¹ valuesList ä¸ buziObjMap ä¸­çš„å€¼ï¼Œç›¸ç­‰ä¹‹åï¼Œå°†å½“å‰ buziObjMap ä¸­çš„ Entry æ”¾åœ¨ LinkedHashMap ä¸­ï¼Œè¿”å› LinkedHashMap å³å¯ã€‚</p><p>ä½†æ˜¯å¦‚ä¸Šè§£æ³•ä¸»è¦å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š 1ï¼Œä¸æ»¡è¶³å¤šæ¬¡æ‰§è¡Œè¿”å›ç»“æœä¸€è‡´è¿™ä¸ªè¦æ±‚ï¼Œå› ä¸ºåœ¨éå† valuesList ä¸ buziObjMap æ—¶ï¼ŒbuziObjMapçš„è¾“å‡ºé¡ºåºæ— æ³•ä¿è¯æ¯æ¬¡éƒ½æ˜¯ä¸€è‡´çš„ã€‚ 2ï¼Œç®—æ³•çš„å¤æ‚åº¦è¿‡å¤§ã€‚</p><h1 id="å®é™…é‡åˆ°çš„é—®é¢˜"><a href="#å®é™…é‡åˆ°çš„é—®é¢˜" class="headerlink" title="å®é™…é‡åˆ°çš„é—®é¢˜"></a>å®é™…é‡åˆ°çš„é—®é¢˜</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"> <br> <br>List&lt;Map.Entry&lt;K, V&gt;&gt; list =  <br>            <span class="hljs-keyword">new</span> LinkedList&lt;Map.Entry&lt;K, V&gt;&gt;( map.entrySet() );  <br>        Collections.sort( list, <span class="hljs-keyword">new</span> Comparator&lt;Map.Entry&lt;K, V&gt;&gt;()  <br>        &#123;  <br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">compare</span><span class="hljs-params">( Map.Entry&lt;K, V&gt; o1, Map.Entry&lt;K, V&gt; o2 )</span>  </span><br><span class="hljs-function">            </span>&#123;  <br>                <span class="hljs-keyword">return</span> (o1.getValue()).compareTo( o2.getValue() );  <br>            &#125;  <br>        &#125; );  <br>  <br>        Map&lt;K, V&gt; result = <span class="hljs-keyword">new</span> LinkedHashMap&lt;K, V&gt;();  <br>        <span class="hljs-keyword">for</span> (Map.Entry&lt;K, V&gt; entry : list)  <br>        &#123;  <br>            result.put( entry.getKey(), entry.getValue() );  <br>        &#125;<br> <br><span class="hljs-comment">//map é‡Œé¢çš„å±æ€§å€¼éœ€è¦æ›¿æ¢æˆè‡ªå·±çš„ æˆ‘è¿™é‡Œç”¨çš„keyæ˜¯Stringå‹ value æ˜¯å®ä½“ç±»</span><br>  List&lt;Map.Entry&lt;String, CorrectRate&gt;&gt; list =<br>                <span class="hljs-keyword">new</span> LinkedList&lt;Map.Entry&lt;String, CorrectRate&gt;&gt;(correctRateOm.entrySet());<br>        Collections.sort(list, <span class="hljs-keyword">new</span> Comparator&lt;Map.Entry&lt;String, CorrectRate&gt;&gt;() &#123;<br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">compare</span><span class="hljs-params">(Map.Entry&lt;String, CorrectRate&gt; o1, Map.Entry&lt;String, CorrectRate&gt; o2)</span> </span>&#123;<br>                <span class="hljs-keyword">return</span> (o1.getValue().getStudentId()).compareTo(o2.getValue().getStudentId());<br>            &#125;<br>        &#125;);<br> <br></code></pre></td></tr></table></figure><p>list è¿”å›çš„å°±æ˜¯æ’å¥½é¡ºåºçš„å•¦</p><p><a href="https://bk.cuixiaoyan.xyz/archives/valuepaixu#%E9%9D%A2%E8%AF%95%E9%A2%98">é¢è¯•é¢˜</a><a href="https://bk.cuixiaoyan.xyz/archives/valuepaixu#%E5%AE%9E%E9%99%85%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98">å®é™…é‡åˆ°çš„é—®é¢˜</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>HashMap</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>javaçš„ä¸‰ç§éšæœºæ•°ç”Ÿæˆæ–¹å¼</title>
    <link href="/blog/2021/02/02/java%E7%9A%84%E4%B8%89%E7%A7%8D%E9%9A%8F%E6%9C%BA%E6%95%B0%E7%94%9F%E6%88%90%E6%96%B9%E5%BC%8F/"/>
    <url>/blog/2021/02/02/java%E7%9A%84%E4%B8%89%E7%A7%8D%E9%9A%8F%E6%9C%BA%E6%95%B0%E7%94%9F%E6%88%90%E6%96%B9%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<p>éšæœºæ•°çš„äº§ç”Ÿåœ¨ä¸€äº›ä»£ç ä¸­å¾ˆå¸¸ç”¨ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬å¿…é¡»è¦æŒæ¡çš„ã€‚è€Œjavaä¸­äº§ç”Ÿéšæœºæ•°çš„æ–¹æ³•ä¸»è¦æœ‰ä¸‰ç§ï¼š</p><p>ç¬¬ä¸€ç§ï¼šnew Random()</p><p>ç¬¬äºŒç§ï¼šMath.random()</p><p>ç¬¬ä¸‰ç§ï¼šcurrentTimeMillis()</p><p>ç¬¬ä¸€ç§éœ€è¦å€ŸåŠ©java.util.Randomç±»æ¥äº§ç”Ÿä¸€ä¸ªéšæœºæ•°å‘ç”Ÿå™¨ï¼Œä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„ä¸€ç§ï¼Œæ„é€ å‡½æ•°æœ‰ä¸¤ä¸ªï¼ŒRandom()å’ŒRandom(long seed)ã€‚ç¬¬ä¸€ä¸ªå°±æ˜¯ä»¥å½“å‰æ—¶é—´ä¸ºé»˜è®¤ç§å­ï¼Œç¬¬äºŒä¸ªæ˜¯ä»¥æŒ‡å®šçš„ç§å­å€¼è¿›è¡Œã€‚äº§ç”Ÿä¹‹åï¼Œå€ŸåŠ©ä¸åŒçš„è¯­å¥äº§ç”Ÿä¸åŒç±»å‹çš„æ•°ã€‚</p><p>ç§å­å°±æ˜¯äº§ç”Ÿéšæœºæ•°çš„ç¬¬ä¸€æ¬¡ä½¿ç”¨å€¼,æœºåˆ¶æ˜¯é€šè¿‡ä¸€ä¸ªå‡½æ•°,å°†è¿™ä¸ªç§å­çš„å€¼è½¬åŒ–ä¸ºéšæœºæ•°ç©ºé—´ä¸­çš„æŸä¸€ä¸ªç‚¹ä¸Š,å¹¶ä¸”äº§ç”Ÿçš„éšæœºæ•°å‡åŒ€çš„æ•£å¸ƒåœ¨ç©ºé—´ä¸­ã€‚ä»¥åäº§ç”Ÿçš„éšæœºæ•°éƒ½ä¸å‰ä¸€ä¸ªéšæœºæ•°æœ‰å…³ã€‚ä»¥ä»£ç ä¸ºä¾‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span></span><br><span class="hljs-function"></span>&#123;<br>ã€€ã€€Random r = <span class="hljs-keyword">new</span> Random(<span class="hljs-number">1</span>);<br>ã€€ã€€<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span> ; i&lt;<span class="hljs-number">5</span> ; i++)<br>ã€€ã€€&#123;<br>ã€€ã€€ã€€ã€€<span class="hljs-keyword">int</span> ran1 = r.nextInt(<span class="hljs-number">100</span>);<br>ã€€ã€€ã€€ã€€System.out.println(ran1);<br>ã€€ã€€&#125;<br>&#125;<br> <br></code></pre></td></tr></table></figure><p>åœ¨æˆ‘çš„ç¼–è¯‘å™¨ä¸‹äº§ç”Ÿçš„äº”ä¸ªæ•°å‡ä¸º85,88,47,13,54ï¼Œå¦‚æœé‡‡ç”¨Random r = new Random()ï¼Œäº§ç”Ÿçš„éšæœºæ•°å°±ä¸åŒï¼Œè¿™å°±æ˜¯ç¡®å®šç§å­å¯¼è‡´çš„ç»“æœã€‚</p><p>è€Œç¬¬äºŒç§æ–¹æ³•è¿”å›çš„æ•°å€¼æ˜¯[0.0,1.0ï¼‰çš„doubleå‹æ•°å€¼ï¼Œç”±äºdoubleç±»æ•°çš„ç²¾åº¦å¾ˆé«˜ï¼Œå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸‹çœ‹åšéšæœºæ•°ï¼Œå€ŸåŠ©ï¼ˆintï¼‰æ¥è¿›è¡Œç±»å‹è½¬æ¢å°±å¯ä»¥å¾—åˆ°æ•´æ•°éšæœºæ•°äº†ï¼Œä»£ç å¦‚ä¸‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span></span><br><span class="hljs-function"> </span>&#123;    <br>    <span class="hljs-keyword">int</span> max=<span class="hljs-number">100</span>,min=<span class="hljs-number">1</span>;<br>     <span class="hljs-keyword">int</span> ran2 = (<span class="hljs-keyword">int</span>) (Math.random()*(max-min)+min); <br>     System.out.println(ran2);<br> &#125;<br> <br></code></pre></td></tr></table></figure><p>è‡³äºç¬¬ä¸‰ç§æ–¹æ³•è™½ç„¶ä¸å¸¸ç”¨ï¼Œä½†æ˜¯ä¹Ÿæ˜¯ä¸€ç§æ€è·¯ã€‚æ–¹æ³•è¿”å›ä»1970å¹´1æœˆ1æ—¥0æ—¶0åˆ†0ç§’ï¼ˆè¿™ä¸UNIXç³»ç»Ÿæœ‰å…³ï¼‰åˆ°ç°åœ¨çš„ä¸€ä¸ªlongå‹çš„æ¯«ç§’æ•°ï¼Œå–æ¨¡ä¹‹åå³å¯å¾—åˆ°æ‰€éœ€èŒƒå›´å†…çš„éšæœºæ•°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">int</span> max=<span class="hljs-number">100</span>,min=<span class="hljs-number">1</span>;<br><span class="hljs-keyword">long</span> randomNum = System.currentTimeMillis();<br><span class="hljs-keyword">int</span> ran3 = (<span class="hljs-keyword">int</span>) (randomNum%(max-min)+min);<br>System.out.println(ran3);<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>å·¥å…·ç±»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è´ªå¿ƒç®—æ³•ç§»é™¤Kä¸ªæ•°å­—</title>
    <link href="/blog/2021/02/01/%E8%B4%AA%E5%BF%83%E7%AE%97%E6%B3%95%E7%A7%BB%E9%99%A4K%E4%B8%AA%E6%95%B0%E5%AD%97/"/>
    <url>/blog/2021/02/01/%E8%B4%AA%E5%BF%83%E7%AE%97%E6%B3%95%E7%A7%BB%E9%99%A4K%E4%B8%AA%E6%95%B0%E5%AD%97/</url>
    
    <content type="html"><![CDATA[<p>é¢˜ç›®æè¿°ï¼šæœ‰ä¸€ åè¿›åˆ¶æ­£æ•´æ•°ï¼Œç§»é™¤å…¶ä¸­çš„ K ä¸ªæ•°ï¼Œä½¿å‰©ä¸‹çš„æ•°å­—æ˜¯æ‰€æœ‰å¯èƒ½ä¸­æœ€å¤§çš„ã€‚ å‡è®¾ï¼š å­—ç¬¦ä¸²çš„é•¿åº¦ä¸€å®šå¤§äºç­‰äº K å­—ç¬¦ä¸²ä¸ä¼šä»¥ 0 å¼€å¤´</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">è¾“å…¥ï¼š<span class="hljs-number">1432219</span><br>           <span class="hljs-number">3</span><br> <br>è¾“å‡ºï¼š<span class="hljs-number">4329</span><br></code></pre></td></tr></table></figure><p>ç®—æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.Scanner;<br><span class="hljs-keyword">import</span> java.util.Stack;<br> <br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DeleteK</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>Scanner scanner=<span class="hljs-keyword">new</span> Scanner(System.in);<br>String num=scanner.nextLine();<br><span class="hljs-keyword">int</span> k=scanner.nextInt();<br>String resulteString=DeleteK.removeK(num, k);<br>System.out.println(resulteString);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span>   <span class="hljs-keyword">static</span> String <span class="hljs-title">removeK</span><span class="hljs-params">(String num,<span class="hljs-keyword">int</span> k)</span> </span>&#123;<br>String result=<span class="hljs-string">&quot;&quot;</span>;<br><span class="hljs-comment">//æ ¹æ®æ•°å€¼æ¯”è¾ƒè¿›è¡Œå…¥æ ˆç§»é™¤</span><br>Stack&lt;Integer&gt; stack=<span class="hljs-keyword">new</span> Stack&lt;Integer&gt;();<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; num.length(); i++) &#123;<br><span class="hljs-keyword">int</span> temp=num.charAt(i)-<span class="hljs-string">&#x27;0&#x27;</span>;<br><span class="hljs-comment">//è¿›è¡Œæ¯”è¾ƒæ“ä½œ</span><br><span class="hljs-keyword">while</span> (stack.size()!=<span class="hljs-number">0</span>&amp;&amp;stack.peek()&lt;temp&amp;&amp;k&gt;<span class="hljs-number">0</span>) &#123;<br>stack.pop();<br>k--;<br>&#125;<br><span class="hljs-comment">//æ¯”è¾ƒå®Œæˆåï¼Œæ‰§è¡Œå…¥æ ˆæ“ä½œ</span><br><span class="hljs-keyword">if</span> (stack.size()!=<span class="hljs-number">0</span>||temp!=<span class="hljs-number">0</span>) &#123;<br>stack.push(temp);<br>&#125;<br>&#125;<br><span class="hljs-comment">//å¦‚æœå­˜åœ¨æ•°æ®å…¨éƒ¨å­˜å…¥æ ˆä¸­ï¼Œä½†æ˜¯kçš„å€¼ä¸ä¸º0çš„</span><br><span class="hljs-keyword">while</span> (k&gt;<span class="hljs-number">0</span>&amp;&amp;stack.size()!=<span class="hljs-number">0</span>) &#123;<br>stack.pop();<br>k--;<br>&#125;<br><br><span class="hljs-comment">//å°†æ•°æ®ä»æ ˆä¸­å…¨éƒ¨å–å‡º</span><br><span class="hljs-keyword">while</span> (stack.size()!=<span class="hljs-number">0</span>) &#123;<br>result=stack.pop()+result;<br>&#125;<br><br><span class="hljs-keyword">return</span> result;<br>&#125;<br>&#125;<br> <br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>ç®—æ³•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBootå·¥å…·é›†æˆ</title>
    <link href="/blog/2021/02/01/SpringBoot%E5%B7%A5%E5%85%B7%E9%9B%86%E6%88%90/"/>
    <url>/blog/2021/02/01/SpringBoot%E5%B7%A5%E5%85%B7%E9%9B%86%E6%88%90/</url>
    
    <content type="html"><![CDATA[<h1 id="æ•´åˆ-JavaMail"><a href="#æ•´åˆ-JavaMail" class="headerlink" title="æ•´åˆ JavaMail"></a>æ•´åˆ JavaMail</h1><p>æœ¬æ¬¡æµ‹è¯•æ¼”ç¤ºå¸¦æ¨¡æ¿çš„é‚®ä»¶ï¼Œä½¿ç”¨ Freemark å®ç°é‚®ä»¶çš„æ¨¡æ¿ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><code class="hljs java"> æ·»åŠ ä¾èµ–<br>&lt;dependency&gt;<br>&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>&lt;artifactId&gt;spring-boot-starter-mail&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br> <br>&lt;dependency&gt;<br>&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>&lt;artifactId&gt;spring-boot-starter-freemarker&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br> <br>æ·»åŠ é…ç½®<br>åœ¨ application.properties ä¸­æ·»åŠ <br>è¿™é‡Œçš„å¯†ç éœ€è¦è®¾ç½®çš„æ˜¯<span class="hljs-number">163</span>çš„ç¬¬ä¸‰æ–¹å·¥å…·è®¿é—®å¯†ç <br># javamail é…ç½®<br>spring.mail.host=smtp<span class="hljs-number">.163</span>.com<br>spring.mail.username=<span class="hljs-number">13738137546</span>@<span class="hljs-number">163.</span>com<br>spring.mail.password=<br>spring.mail.properties.mail.smtp.auth=<span class="hljs-keyword">true</span><br>spring.mail.properties.mail.smtp.starttls.enable=<span class="hljs-keyword">true</span><br>spring.mail.properties.mail.smtp.starttls.required=<span class="hljs-keyword">true</span><br> <br> <br> ç¼–ç <br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@EnableConfigurationProperties(MailProperties.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JavaMailComponent</span> </span>&#123;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String template = <span class="hljs-string">&quot;mail.ftl&quot;</span>;<br> <br><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> FreeMarkerConfigurer freeMarkerConfigurer;<br><br><span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> JavaMailSender javaMailSender;<br> <br><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> MailProperties mailProperties;<br> <br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendMail</span><span class="hljs-params">(String email)</span> </span>&#123;<br>Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;String, Object&gt;();<br>map.put(<span class="hljs-string">&quot;email&quot;</span>, email);<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-comment">// è·å–å†…å®¹</span><br>String text = <span class="hljs-keyword">this</span>.getTextByTemplate(template, map);<br><span class="hljs-comment">// å‘é€</span><br><span class="hljs-keyword">this</span>.send(email, text);<br>&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>e.printStackTrace();<br>&#125;<br>&#125;<br> <br><span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">getTextByTemplate</span><span class="hljs-params">(String template, Map&lt;String, Object&gt; model)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br><span class="hljs-keyword">return</span> FreeMarkerTemplateUtils<br>.processTemplateIntoString(<span class="hljs-keyword">this</span>.freeMarkerConfigurer.getConfiguration().getTemplate(template), model);<br>&#125;<br> <br><span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">send</span><span class="hljs-params">(String email, String text)</span> <span class="hljs-keyword">throws</span> MessagingException, UnsupportedEncodingException </span>&#123;<br>MimeMessage message = <span class="hljs-keyword">this</span>.javaMailSender.createMimeMessage();<br>MimeMessageHelper helper = <span class="hljs-keyword">new</span> MimeMessageHelper(message, <span class="hljs-keyword">true</span>, <span class="hljs-string">&quot;UTF-8&quot;</span>);<br>InternetAddress from = <span class="hljs-keyword">new</span> InternetAddress();<br>from.setAddress(<span class="hljs-keyword">this</span>.mailProperties.getUsername());<br>from.setPersonal(<span class="hljs-string">&quot;å´”ç¬‘é¢œ&quot;</span>, <span class="hljs-string">&quot;UTF-8&quot;</span>);<br>helper.setFrom(from);<br>helper.setTo(email);<br>helper.setSubject(<span class="hljs-string">&quot;SpringBoot å‘é€çš„ç¬¬ä¸€å°é‚®ä»¶&quot;</span>);<br>helper.setText(text, <span class="hljs-keyword">true</span>);<br><span class="hljs-keyword">this</span>.javaMailSender.send(message);<br><span class="hljs-keyword">return</span> text;<br>&#125;<br>&#125;<br> <br>åœ¨ src/main/resources ä¸‹çš„ template ç›®å½•ä¸‹åˆ›å»ºåä¸º mail.ftl çš„æ–‡ä»¶ï¼Œå…¶å†…å®¹å¦‚ä¸‹ï¼š<br>&lt;!DOCTYPE html&gt;<br>&lt;html lang=<span class="hljs-string">&quot;zh&quot;</span>&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;Content-Type&quot;</span> content=<span class="hljs-string">&quot;text/html; charset=UTF-8&quot;</span> /&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;div style=<span class="hljs-string">&quot;width: 600px; text-align: left; margin: 0 auto;&quot;</span>&gt;<br>&lt;h1 style=&quot;color: #005da7;&quot;&gt;å´”ç¬‘é¢œ&lt;/h1&gt;<br>&lt;div style=&quot;border-bottom: 5px solid #005da7; height: 2px; width: 100%;&quot;&gt;&lt;/div&gt;<br>&lt;div style=<span class="hljs-string">&quot;border: 1px solid #005da7; font-size: 16px; line-height: 50px; padding: 20px;&quot;</span>&gt;<br>&lt;div&gt;$&#123;email&#125;ï¼Œæ‚¨å¥½ï¼&lt;/div&gt;<br>&lt;div&gt;<br>è¿™æ˜¯ä¸ªæµ‹è¯•<br>&lt;/div&gt;<br>&lt;div&gt;<br>æƒ³äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—® &lt;a href=<span class="hljs-string">&quot;https://bk.cuixiaoyan.xyz/&quot;</span>&gt;https:<span class="hljs-comment">//bk.cuixiaoyan.xyz/&lt;/a&gt;</span><br>&lt;/div&gt;<br>&lt;/div&gt;<br>&lt;/div&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br> <br>æµ‹è¯•<br><span class="hljs-meta">@RunWith(SpringRunner.class)</span><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MailTest</span> </span>&#123;<br> <br><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> JavaMailComponent javaMailComponent;<br><br><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">this</span>.javaMailComponent.sendMail(<span class="hljs-string">&quot;56696508@qq.com&quot;</span>);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="æ•´åˆå®šæ—¶ä»»åŠ¡"><a href="#æ•´åˆå®šæ—¶ä»»åŠ¡" class="headerlink" title="æ•´åˆå®šæ—¶ä»»åŠ¡"></a>æ•´åˆå®šæ—¶ä»»åŠ¡</h1><h2 id="Scheduled-æ–¹å¼"><a href="#Scheduled-æ–¹å¼" class="headerlink" title="Scheduled æ–¹å¼"></a>Scheduled æ–¹å¼</h2><h3 id="ä»»åŠ¡ç±»"><a href="#ä»»åŠ¡ç±»" class="headerlink" title="ä»»åŠ¡ç±»"></a>ä»»åŠ¡ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"> <span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Schedule</span> </span>&#123;<br> <br><span class="hljs-meta">@Scheduled(fixedRate = 2000)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">task</span><span class="hljs-params">()</span> </span>&#123;<br>System.out.println(<span class="hljs-string">&quot;å¯åŠ¨å®šæ—¶ä»»åŠ¡:&quot;</span> + <span class="hljs-keyword">new</span> Date());<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ @Scheduled å®šä¹‰ä»»åŠ¡æ‰§è¡Œæ—¶é—´ï¼Œä»£ç ä¸­è¡¨ç¤ºæ¯éš” 2 ç§’æ‰§è¡Œä¸€æ¬¡ä»»åŠ¡ã€‚</p><h3 id="å¼€å¯å®šæ—¶è®¡åˆ’"><a href="#å¼€å¯å®šæ—¶è®¡åˆ’" class="headerlink" title="å¼€å¯å®šæ—¶è®¡åˆ’"></a>å¼€å¯å®šæ—¶è®¡åˆ’</h3><p>åªéœ€åœ¨ Spring Boot çš„å¯åŠ¨ç±»ä¸Šæ·»åŠ  @EnableScheduling åï¼Œå¯åŠ¨é¡¹ç›®å³å¯ã€‚<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/springboot-web-schedule_1567762142429.jpg" alt="springboot-web-schedule"></p><h3 id="å¹¶è¡Œæ‰§è¡Œ"><a href="#å¹¶è¡Œæ‰§è¡Œ" class="headerlink" title="å¹¶è¡Œæ‰§è¡Œ"></a>å¹¶è¡Œæ‰§è¡Œ</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Task ä½¿ç”¨ä¸€æ¡çº¿ç¨‹ä¸²è¡Œçš„æ‰§è¡Œæ‰€æœ‰çš„å®šæ—¶ä»»åŠ¡ã€‚ä¸ºäº†æé«˜æ‰§è¡Œæ•ˆç‡ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨ç¼–å†™ä¸€ä¸ªçº¿ç¨‹æ± å®ç°å®šæ—¶ä»»åŠ¡çš„å¹¶è¡Œæ‰§è¡Œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@EnableScheduling</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AsyncTaskConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">SchedulingConfigurer</span>, <span class="hljs-title">AsyncConfigurer</span> </span>&#123;<br> <br>    <span class="hljs-comment">//çº¿ç¨‹æ± çº¿ç¨‹æ•°é‡</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> corePoolSize = <span class="hljs-number">5</span>;<br>    <br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> ThreadPoolTaskScheduler <span class="hljs-title">taskScheduler</span><span class="hljs-params">()</span> </span>&#123;<br>        ThreadPoolTaskScheduler scheduler = <span class="hljs-keyword">new</span> ThreadPoolTaskScheduler();<br>        scheduler.initialize();<span class="hljs-comment">//åˆå§‹åŒ–çº¿ç¨‹æ± </span><br>        scheduler.setPoolSize(corePoolSize);<span class="hljs-comment">//çº¿ç¨‹æ± å®¹é‡</span><br>        <span class="hljs-keyword">return</span> scheduler;<br>    &#125;<br> <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Executor <span class="hljs-title">getAsyncExecutor</span><span class="hljs-params">()</span> </span>&#123;<br>        Executor executor = <span class="hljs-keyword">this</span>.taskScheduler();<br>        <span class="hljs-keyword">return</span> executor;<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> AsyncUncaughtExceptionHandler <span class="hljs-title">getAsyncUncaughtExceptionHandler</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configureTasks</span><span class="hljs-params">(ScheduledTaskRegistrar scheduledTaskRegistrar)</span> </span>&#123;<br>        scheduledTaskRegistrar.setTaskScheduler(taskScheduler());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="æ•´åˆ-Swagger2"><a href="#æ•´åˆ-Swagger2" class="headerlink" title="æ•´åˆ Swagger2"></a>æ•´åˆ Swagger2</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs java">æ·»åŠ ä¾èµ–<br>&lt;dependency&gt;<br>&lt;groupId&gt;io.springfox&lt;/groupId&gt;<br>&lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt;<br>&lt;version&gt;2.7.0&lt;/version&gt;<br>&lt;/dependency&gt;<br>&lt;dependency&gt;<br>&lt;groupId&gt;io.springfox&lt;/groupId&gt;<br>&lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt;<br>&lt;version&gt;2.7.0&lt;/version&gt;<br>&lt;/dependency&gt;<br> <br>é‡æ–°åˆ›å»ºä¸€ä¸ªé…ç½®ç±»ï¼Œå¦‚ä¸‹ï¼š<br> <br><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@EnableSwagger2</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Swagger2Configuration</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebMvcConfigurationSupport</span> </span>&#123;<br> <br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Docket <span class="hljs-title">accessToken</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Docket(DocumentationType.SWAGGER_2)<br>                .groupName(<span class="hljs-string">&quot;api&quot;</span>)<span class="hljs-comment">// å®šä¹‰ç»„</span><br>                .select() <span class="hljs-comment">// é€‰æ‹©é‚£äº›è·¯å¾„å’Œ api ä¼šç”Ÿæˆ document</span><br>                .apis(RequestHandlerSelectors.basePackage(<span class="hljs-string">&quot;com.cxy.template.controller&quot;</span>)) <span class="hljs-comment">// æ‹¦æˆªçš„åŒ…è·¯å¾„</span><br>                .paths(PathSelectors.regex(<span class="hljs-string">&quot;/*/.*&quot;</span>))<span class="hljs-comment">// æ‹¦æˆªçš„æ¥å£è·¯å¾„</span><br>                .build() <span class="hljs-comment">// åˆ›å»º</span><br>                .apiInfo(apiInfo()); <span class="hljs-comment">// é…ç½®è¯´æ˜</span><br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">private</span> ApiInfo <span class="hljs-title">apiInfo</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ApiInfoBuilder()<span class="hljs-comment">//</span><br>                .title(<span class="hljs-string">&quot;Spring Boot ä¹‹ Web ç¯‡&quot;</span>)<span class="hljs-comment">// æ ‡é¢˜</span><br>                .description(<span class="hljs-string">&quot;spring boot Web ç›¸å…³å†…å®¹&quot;</span>)<span class="hljs-comment">// æè¿°</span><br>                .termsOfServiceUrl(<span class="hljs-string">&quot;https://bk.cuixiaoyan.xyz/&quot;</span>)<span class="hljs-comment">//</span><br>                .contact(<span class="hljs-keyword">new</span> Contact(<span class="hljs-string">&quot;moonlightL&quot;</span>, <span class="hljs-string">&quot;https://bk.cuixiaoyan.xyz/&quot;</span>, <span class="hljs-string">&quot;cuixiaoyande@163.com&quot;</span>))<span class="hljs-comment">// è”ç³»</span><br>                .version(<span class="hljs-string">&quot;1.0&quot;</span>)<span class="hljs-comment">// ç‰ˆæœ¬</span><br>                .build();<br>    &#125;<br> <br> <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addResourceHandlers</span><span class="hljs-params">(ResourceHandlerRegistry registry)</span> </span>&#123;<br>        <span class="hljs-comment">// è§£å†³é™æ€èµ„æºæ— æ³•è®¿é—®</span><br>        registry.addResourceHandler(<span class="hljs-string">&quot;/**&quot;</span>)<br>                .addResourceLocations(<span class="hljs-string">&quot;classpath:/static/&quot;</span>);<br>        <span class="hljs-comment">// è§£å†³swaggeræ— æ³•è®¿é—®</span><br>        registry.addResourceHandler(<span class="hljs-string">&quot;/swagger-ui.html&quot;</span>)<br>                .addResourceLocations(<span class="hljs-string">&quot;classpath:/META-INF/resources/&quot;</span>);<br>        <span class="hljs-comment">// è§£å†³swaggerçš„jsæ–‡ä»¶æ— æ³•è®¿é—®</span><br>        registry.addResourceHandler(<span class="hljs-string">&quot;/webjars/**&quot;</span>)<br>                .addResourceLocations(<span class="hljs-string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>);<br>    &#125;<br> <br> <br>&#125;<br> <br></code></pre></td></tr></table></figure><p>ä¸ºäº†èƒ½æ›´å¥½çš„è¯´æ˜æ¥å£ä¿¡æ¯ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨ Controller ç±»ä¸Šä½¿ç”¨ Swagger2 ç›¸å…³æ³¨è§£è¯´æ˜ä¿¡æ¯ã€‚ æˆ‘ä»¬ä»¥ FastJsonController ä¸ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Api(value = &quot;FastJsonæµ‹è¯•&quot;, tags = &#123; &quot;æµ‹è¯•æ¥å£&quot; &#125;)</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;fastjson&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FastJsonController</span> </span>&#123;<br> <br><span class="hljs-meta">@ApiOperation(&quot;è·å–ç”¨æˆ·ä¿¡æ¯&quot;)</span><br><span class="hljs-meta">@ApiImplicitParam(name = &quot;name&quot;, value = &quot;ç”¨æˆ·å&quot;, dataType = &quot;string&quot;, paramType = &quot;query&quot;)</span><br><span class="hljs-meta">@GetMapping(&quot;/test/&#123;name&#125;&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">test</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;name&quot;)</span> String name)</span> </span>&#123;<br>User user = <span class="hljs-keyword">new</span> User();<br> <br>user.setId(<span class="hljs-number">1</span>);<br>user.setUsername(name);<br>user.setPassword(<span class="hljs-string">&quot;jack123&quot;</span>);<br>user.setBirthday(<span class="hljs-keyword">new</span> Date());<br> <br><span class="hljs-keyword">return</span> user;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œä¸Šè¾¹çš„æ–¹æ³•æ˜¯ç”¨ @GetMapping æ³¨è§£ï¼Œå¦‚æœåªæ˜¯ä½¿ç”¨ @RequestMapping æ³¨è§£ï¼Œä¸é…ç½® method å±æ€§ï¼Œé‚£ä¹ˆ API æ–‡æ¡£ä¼šç”Ÿæˆ 7 ç§è¯·æ±‚æ–¹å¼ã€‚</p><p>å¯åŠ¨é¡¹ç›®ï¼Œæ‰“å¼€æµè§ˆå™¨è®¿é—® <a href="http://localhost:8080/swagger-ui.html![WX20190906-173719@2x](https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/WX20190906-173719@2x_1567762664793.png)">http://localhost:8080/swagger-ui.html![WX20190906-173719@2x](https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/WX20190906-173719@2x_1567762664793.png)</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>SpringBoot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBootæ•´åˆ</title>
    <link href="/blog/2021/02/01/SpringBoot%E6%95%B4%E5%90%88/"/>
    <url>/blog/2021/02/01/SpringBoot%E6%95%B4%E5%90%88/</url>
    
    <content type="html"><![CDATA[<h1 id="é…ç½®-AOP-åˆ‡é¢"><a href="#é…ç½®-AOP-åˆ‡é¢" class="headerlink" title="é…ç½® AOP åˆ‡é¢"></a>é…ç½® AOP åˆ‡é¢</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java">æ·»åŠ ä¾èµ–<br>&lt;dependency&gt;<br>&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>&lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br> <br>ç¼–å†™åˆ‡é¢ç±»<br>ä½¿ç”¨ <span class="hljs-meta">@Component</span>ï¼Œ<span class="hljs-meta">@Aspect</span> æ ‡è®°åˆ°åˆ‡é¢ç±»ä¸Šï¼š<br><span class="hljs-meta">@Aspect</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TimeAspect</span> </span>&#123;<br> <br><span class="hljs-meta">@Around(&quot;execution(* com.light.springboot.controller.FastJsonController..*(..))&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">method</span><span class="hljs-params">(ProceedingJoinPoint pjp)</span> <span class="hljs-keyword">throws</span> Throwable </span>&#123;<br> <br>System.out.println(<span class="hljs-string">&quot;=====Aspectå¤„ç†=======&quot;</span>);<br>Object[] args = pjp.getArgs();<br><span class="hljs-keyword">for</span> (Object arg : args) &#123;<br>System.out.println(<span class="hljs-string">&quot;å‚æ•°ä¸º:&quot;</span> + arg);<br>&#125;<br> <br><span class="hljs-keyword">long</span> start = System.currentTimeMillis();<br> <br>Object object = pjp.proceed();<br> <br>System.out.println(<span class="hljs-string">&quot;Aspect è€—æ—¶:&quot;</span> + (System.currentTimeMillis() - start));<br> <br><span class="hljs-keyword">return</span> object;<br>&#125;<br>&#125;<br> <br></code></pre></td></tr></table></figure><p>è¯·æ±‚ FastJsonController æ§åˆ¶å™¨çš„æ–¹æ³•ï¼Œç»“æœå¦‚ä¸‹ï¼š<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/springboot-web-08_1567733306478.jpg" alt="springboot-web-08"></p><h1 id="é”™è¯¯å¤„ç†"><a href="#é”™è¯¯å¤„ç†" class="headerlink" title="é”™è¯¯å¤„ç†"></a>é”™è¯¯å¤„ç†</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs java">å‹å¥½é¡µé¢<br>å…ˆæ¼”ç¤ºéå‹å¥½é¡µé¢ï¼Œä¿®æ”¹ FastJsonController ç±»ä¸­çš„ test æ–¹æ³•ï¼š<br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;fastjson&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FastJsonController</span> </span>&#123;<br> <br><span class="hljs-meta">@RequestMapping(&quot;/test&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>&#123;<br>User user = <span class="hljs-keyword">new</span> User();<br><br>user.setId(<span class="hljs-number">1</span>);<br>user.setUsername(<span class="hljs-string">&quot;jack&quot;</span>);<br>user.setPassword(<span class="hljs-string">&quot;jack123&quot;</span>);<br>user.setBirthday(<span class="hljs-keyword">new</span> Date());<br><br><span class="hljs-comment">// æ¨¡æ‹Ÿå¼‚å¸¸</span><br><span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>/<span class="hljs-number">0</span>;<br><br><span class="hljs-keyword">return</span> user;<br>&#125;<br>&#125;<br> <br>å½“ç³»ç»ŸæŠ¥é”™æ—¶ï¼Œè¿”å›åˆ°é¡µé¢çš„å†…å®¹é€šå¸¸æ˜¯ä¸€äº›æ‚ä¹±çš„ä»£ç æ®µï¼Œè¿™ç§æ˜¾ç¤ºå¯¹ç”¨æˆ·æ¥è¯´ä¸å‹å¥½ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªå‹å¥½çš„æç¤ºç³»ç»Ÿå¼‚å¸¸çš„é¡µé¢ã€‚<br> <br>åœ¨ src/main/resources ä¸‹åˆ›å»º /<span class="hljs-keyword">public</span>/errorï¼Œåœ¨è¯¥ç›®å½•ä¸‹å†åˆ›å»ºä¸€ä¸ªåä¸º 5xx.html æ–‡ä»¶ï¼Œè¯¥é¡µé¢çš„å†…å®¹å°±æ˜¯å½“ç³»ç»ŸæŠ¥é”™æ—¶è¿”å›ç»™ç”¨æˆ·æµè§ˆçš„å†…å®¹ï¼š<br>&lt;!DOCTYPE html&gt;<br>&lt;html lang=<span class="hljs-string">&quot;zh&quot;</span>&gt;<br>&lt;head&gt;<br>    &lt;meta charset=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;<br>    &lt;title&gt;ç³»ç»Ÿé”™è¯¯&lt;/title&gt;<br>    &lt;link href=<span class="hljs-string">&quot;/css/index.css&quot;</span> rel=<span class="hljs-string">&quot;stylesheet&quot;</span>/&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>    &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;container&quot;</span>&gt;<br>    &lt;h2&gt;ç³»ç»Ÿå†…éƒ¨é”™è¯¯&lt;/h2&gt;<br>    &lt;/div&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br>è·¯å¾„æ—¶å›ºå®šçš„ï¼ŒSpring Boot ä¼šåœ¨ç³»ç»ŸæŠ¥é”™æ—¶å°†è¿”å›è§†å›¾æŒ‡å‘è¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚<br>ä¸Šè¾¹å¤„ç†çš„ 5xx çŠ¶æ€ç çš„é—®é¢˜ï¼Œæ¥ä¸‹æ¥è§£å†³ <span class="hljs-number">404</span> çŠ¶æ€ç çš„é—®é¢˜ã€‚<br> <br>å½“å‡ºç° <span class="hljs-number">404</span> çš„æƒ…å†µæ—¶ï¼Œç”¨æˆ·æµè§ˆçš„é¡µé¢ä¹Ÿä¸å¤Ÿå‹å¥½ï¼Œå› æ­¤æˆ‘ä»¬ä¹Ÿéœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªå‹å¥½çš„é¡µé¢ç»™ç”¨æˆ·å±•ç¤ºã€‚<br> <br>åœ¨ /<span class="hljs-keyword">public</span>/error ç›®å½•ä¸‹å†åˆ›å»ºä¸€ä¸ªåä¸º <span class="hljs-number">404.</span>html çš„æ–‡ä»¶ï¼š<br> <br>&lt;!DOCTYPE html&gt;<br>&lt;html lang=<span class="hljs-string">&quot;zh&quot;</span>&gt;<br>&lt;head&gt;<br>    &lt;meta charset=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;<br>    &lt;title&gt;è®¿é—®å¼‚å¸¸&lt;/title&gt;<br>    &lt;link href=<span class="hljs-string">&quot;/css/index.css&quot;</span> rel=<span class="hljs-string">&quot;stylesheet&quot;</span>/&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>    &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;container&quot;</span>&gt;<br>    &lt;h2&gt;æ‰¾ä¸åˆ°é¡µé¢&lt;/h2&gt;<br>    &lt;/div&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br> <br>å…¨å±€å¼‚å¸¸æ•è·<br>å¦‚æœé¡¹ç›®å‰åç«¯æ˜¯é€šè¿‡ JSON è¿›è¡Œæ•°æ®é€šä¿¡ï¼Œåˆ™å½“å‡ºç°å¼‚å¸¸æ—¶å¯ä»¥å¸¸ç”¨å¦‚ä¸‹æ–¹å¼å¤„ç†å¼‚å¸¸ä¿¡æ¯ã€‚<br> <br>ç¼–å†™ä¸€ä¸ªç±»å……å½“å…¨å±€å¼‚å¸¸çš„å¤„ç†ç±»ï¼Œéœ€è¦ä½¿ç”¨ <span class="hljs-meta">@ControllerAdvice</span> å’Œ <span class="hljs-meta">@ExceptionHandler</span> æ³¨è§£ï¼š<br><span class="hljs-meta">@ControllerAdvice</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GlobalDefaultExceptionHandler</span> </span>&#123;<br> <br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å¤„ç† Exception ç±»å‹çš„å¼‚å¸¸</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> e</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@ExceptionHandler(Exception.class)</span><br><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String,Object&gt; <span class="hljs-title">defaultExceptionHandler</span><span class="hljs-params">(Exception e)</span> </span>&#123;<br><br>Map&lt;String,Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;String,Object&gt;();<br>map.put(<span class="hljs-string">&quot;code&quot;</span>, <span class="hljs-number">500</span>);<br>map.put(<span class="hljs-string">&quot;msg&quot;</span>, e.getMessage());<br><span class="hljs-keyword">return</span> map;<br>&#125;<br>&#125;<br>å…¶ä¸­ï¼Œæ–¹æ³•åä¸ºä»»æ„åï¼Œå…¥å‚ä¸€èˆ¬ä½¿ç”¨ Exception å¼‚å¸¸ç±»ï¼Œæ–¹æ³•è¿”å›å€¼å¯è‡ªå®šä¹‰ã€‚<br> <br></code></pre></td></tr></table></figure><h1 id="æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½"><a href="#æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½"></a>æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs java">æ·»åŠ ä¾èµ–<br>&lt;dependency&gt;<br>&lt;groupId&gt;commons-io&lt;/groupId&gt;<br>&lt;artifactId&gt;commons-io&lt;/artifactId&gt;<br>&lt;version&gt;2.4&lt;/version&gt;<br>&lt;/dependency&gt;<br> <br>ç¼–å†™ä¸€ä¸ªå®ä½“ç±»ï¼Œç”¨äºå°è£…è¿”å›ä¿¡æ¯ï¼š<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileInfo</span> </span>&#123;<br> <br><span class="hljs-keyword">private</span> String path;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">FileInfo</span><span class="hljs-params">(String path)</span> </span>&#123;<br><span class="hljs-keyword">this</span>.path = path;<br>&#125;<br> <br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getPath</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">return</span> path;<br>&#125;<br> <br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPath</span><span class="hljs-params">(String path)</span> </span>&#123;<br><span class="hljs-keyword">this</span>.path = path;<br>&#125;<br><br>&#125;<br>ç¼–å†™ Controllerï¼Œç”¨äºå¤„ç†æ–‡ä»¶ä¸Šä¼ ä¸‹è½½ï¼š<br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/file&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileController</span> </span>&#123;<br> <br><span class="hljs-keyword">private</span> String path = <span class="hljs-string">&quot;d:\\&quot;</span>;<br> <br><span class="hljs-meta">@PostMapping</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> FileInfo <span class="hljs-title">upload</span><span class="hljs-params">(MultipartFile file)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br> <br>System.out.println(file.getName());<br>System.out.println(file.getOriginalFilename());<br>System.out.println(file.getSize());<br> <br>File localFile = <span class="hljs-keyword">new</span> File(path, file.getOriginalFilename());<br> <br>file.transferTo(localFile);<br> <br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FileInfo(localFile.getAbsolutePath());<br>&#125;<br> <br><span class="hljs-meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">download</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String id, HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;<br><span class="hljs-keyword">try</span> (InputStream inputStream = <span class="hljs-keyword">new</span> FileInputStream(<span class="hljs-keyword">new</span> File(path, id + <span class="hljs-string">&quot;.jpg&quot;</span>));<br>OutputStream outputStream = response.getOutputStream();) &#123;<br> <br>response.setContentType(<span class="hljs-string">&quot;application/x-download&quot;</span>);<br>response.addHeader(<span class="hljs-string">&quot;Content-Disposition&quot;</span>, <span class="hljs-string">&quot;attachment;filename=&quot;</span> + id + <span class="hljs-string">&quot;.jpg&quot;</span>);<br> <br>IOUtils.copy(inputStream, outputStream);<br>&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>e.printStackTrace();<br>&#125;<br>&#125;<br>&#125;<br> <br></code></pre></td></tr></table></figure><h1 id="CORS-æ”¯æŒ"><a href="#CORS-æ”¯æŒ" class="headerlink" title="CORS æ”¯æŒ"></a>CORS æ”¯æŒ</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs java">å‰ç«¯é¡µé¢<br>&lt;!DOCTYPE html&gt;<br>&lt;html lang=<span class="hljs-string">&quot;en&quot;</span>&gt;<br> <br>&lt;head&gt;<br>    &lt;meta charset=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;<br>    &lt;title&gt;è·¨åŸŸæµ‹è¯•&lt;/title&gt;<br>&lt;/head&gt;<br> <br>&lt;body&gt;<br>    &lt;button id=&quot;test&quot;&gt;æµ‹è¯•&lt;/button&gt;<br>    &lt;script type=&quot;text/javascript&quot; src=&quot;jquery-1.12.3.min.js&quot;&gt;&lt;/script&gt;<br>    &lt;script type=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;<br>    $(function() &#123;<br>        $(<span class="hljs-string">&quot;#test&quot;</span>).on(<span class="hljs-string">&quot;click&quot;</span>, function() &#123;<br>            $.ajax(&#123;<br>                <span class="hljs-string">&quot;url&quot;</span>: <span class="hljs-string">&quot;http://localhost:8080/fastjson/test&quot;</span>,<br>                <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;get&quot;</span>,<br>                <span class="hljs-string">&quot;dataType&quot;</span>: <span class="hljs-string">&quot;json&quot;</span>,<br>                <span class="hljs-string">&quot;success&quot;</span>: function(data) &#123;<br>                    console.log(data);<br>                &#125;<br>            &#125;)<br>        &#125;);<br>    &#125;);<br>    &lt;/script&gt;<br>&lt;/body&gt;<br> <br>&lt;/html&gt;<br> <br>å‰ç«¯æœåŠ¡å™¨å¯åŠ¨ç«¯å£ä¸º <span class="hljs-number">8088</span> ä¸åç«¯æœåŠ¡å™¨ <span class="hljs-number">8080</span> ä¸åŒæºï¼Œå› æ­¤å‡ºç°è·¨åŸŸçš„é—®é¢˜ã€‚<br> <br>ç°åœ¨å¼€å§‹è§£å†³è·¨åŸŸé—®é¢˜ï¼Œå¯ä»¥ä¸¤ç§ç»´åº¦æ§åˆ¶å®¢æˆ·ç«¯è¯·æ±‚ã€‚<br>ç²—ç²’åº¦æ§åˆ¶ï¼š<br> <br>æ–¹å¼ä¸€<br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebConfig</span> </span>&#123;<br>    <br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> WebMvcConfigurer <span class="hljs-title">corsConfigurer</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> WebMvcConfigurerAdapter() &#123;<br>          <span class="hljs-meta">@Override</span><br>          <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addCorsMappings</span><span class="hljs-params">(CorsRegistry registry)</span> </span>&#123;<br>              registry.addMapping(<span class="hljs-string">&quot;/fastjson/**&quot;</span>)<br>                      .allowedOrigins(<span class="hljs-string">&quot;http://localhost:8088&quot;</span>);<span class="hljs-comment">// å…è®¸ 8088 ç«¯å£è®¿é—®</span><br>          &#125;<br>        &#125;;<br>    &#125;<br>&#125;<br> <br>æ–¹å¼äºŒ<br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebMvcConfigurerAdapter</span></span>&#123;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addCorsMappings</span><span class="hljs-params">(CorsRegistry registry)</span> </span>&#123;<br>        registry.addMapping(<span class="hljs-string">&quot;/fastjson/**&quot;</span>)<br>              .allowedOrigins(<span class="hljs-string">&quot;http://localhost:8088&quot;</span>);<span class="hljs-comment">// å…è®¸ 8088 ç«¯å£è®¿é—®</span><br>    &#125;<br>&#125;<br>ç»†ç²’åº¦æ§åˆ¶ï¼š<br>åœ¨ FastJsonController ç±»ä¸­çš„æ–¹æ³•ä¸Šæ·»åŠ  <span class="hljs-meta">@CrossOrigin(origins=&quot;xx&quot;)</span> æ³¨è§£ï¼š<br><span class="hljs-meta">@RequestMapping(&quot;/test&quot;)</span><br><span class="hljs-meta">@CrossOrigin(origins=&quot;http://localhost:8088&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>&#123;<br>User user = <span class="hljs-keyword">new</span> User();<br><br>user.setId(<span class="hljs-number">1</span>);<br>user.setUsername(<span class="hljs-string">&quot;jack&quot;</span>);<br>user.setPassword(<span class="hljs-string">&quot;jack123&quot;</span>);<br>user.setBirthday(<span class="hljs-keyword">new</span> Date());<br><br><span class="hljs-keyword">return</span> user;<br>&#125;<br>åœ¨ä½¿ç”¨è¯¥æ³¨è§£æ—¶ï¼Œéœ€è¦æ³¨æ„ <span class="hljs-meta">@RequestMapping</span> ä½¿ç”¨çš„è¯·æ±‚æ–¹å¼ç±»å‹ï¼Œå³ GET æˆ– POSTã€‚<br> <br> <br> <br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>SpringBoot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBootè‡ªå®šä¹‰</title>
    <link href="/blog/2021/01/31/SpringBoot%E8%87%AA%E5%AE%9A%E4%B9%89/"/>
    <url>/blog/2021/01/31/SpringBoot%E8%87%AA%E5%AE%9A%E4%B9%89/</url>
    
    <content type="html"><![CDATA[<h1 id="è‡ªå®šä¹‰-Servlet"><a href="#è‡ªå®šä¹‰-Servlet" class="headerlink" title="è‡ªå®šä¹‰ Servlet"></a>è‡ªå®šä¹‰ Servlet</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"> ç¼–å†™ Servlet<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ServletTest</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>&#123;<br> <br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>doPost(req, resp);<br>&#125;<br> <br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doPost</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>resp.setContentType(<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>);<br>resp.getWriter().write(<span class="hljs-string">&quot;è‡ªå®šä¹‰ Servlet&quot;</span>);<br>&#125;<br><br>&#125;<br> <br>æ³¨å†Œ Servlet<br>å°† Servelt æ³¨å†Œæˆ Beanã€‚åœ¨ä¸Šæ–‡åˆ›å»ºçš„ WebConfig ç±»ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š<br><span class="hljs-meta">@Bean</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> ServletRegistrationBean <span class="hljs-title">servletRegistrationBean</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ServletRegistrationBean(<span class="hljs-keyword">new</span> ServletTest(),<span class="hljs-string">&quot;/servletTest&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹:<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/springboot-web-04_1567661032166.jpg" alt="springboot-web-04"></p><h1 id="è‡ªå®šä¹‰è¿‡æ»¤å™¨-ç¬¬ä¸‰æ–¹è¿‡æ»¤å™¨"><a href="#è‡ªå®šä¹‰è¿‡æ»¤å™¨-ç¬¬ä¸‰æ–¹è¿‡æ»¤å™¨" class="headerlink" title="è‡ªå®šä¹‰è¿‡æ»¤å™¨/ç¬¬ä¸‰æ–¹è¿‡æ»¤å™¨"></a>è‡ªå®šä¹‰è¿‡æ»¤å™¨/ç¬¬ä¸‰æ–¹è¿‡æ»¤å™¨</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java">ç¼–å†™è¿‡æ»¤å™¨<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TimeFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Filter</span> </span>&#123;<br> <br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">(FilterConfig filterConfig)</span> <span class="hljs-keyword">throws</span> ServletException </span>&#123;<br>System.out.println(<span class="hljs-string">&quot;=======åˆå§‹åŒ–è¿‡æ»¤å™¨=========&quot;</span>);<br>&#125;<br> <br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doFilter</span><span class="hljs-params">(ServletRequest request, ServletResponse response, FilterChain filterChain)</span></span><br><span class="hljs-function"><span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;<br> <br><span class="hljs-keyword">long</span> start = System.currentTimeMillis();<br> <br>filterChain.doFilter(request, response);<br> <br>System.out.println(<span class="hljs-string">&quot;filter è€—æ—¶ï¼š&quot;</span> + (System.currentTimeMillis() - start));<br> <br>&#125;<br> <br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">destroy</span><span class="hljs-params">()</span> </span>&#123;<br>System.out.println(<span class="hljs-string">&quot;=======é”€æ¯è¿‡æ»¤å™¨=========&quot;</span>);<br>&#125;<br> <br>&#125;<br> <br> æ³¨å†Œè¿‡æ»¤å™¨<br>è¦æ˜¯è¯¥è¿‡æ»¤å™¨ç”Ÿæ•ˆï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š<br><span class="hljs-number">1.</span>ä½¿ç”¨ <span class="hljs-meta">@Component</span> æ³¨è§£<br><span class="hljs-number">2.</span>æ·»åŠ åˆ°è¿‡æ»¤å™¨é“¾ä¸­ï¼Œæ­¤æ–¹å¼é€‚ç”¨äºä½¿ç”¨ç¬¬ä¸‰æ–¹çš„è¿‡æ»¤å™¨ã€‚å°†è¿‡æ»¤å™¨å†™åˆ° WebConfig ç±»ä¸­ï¼Œå¦‚ä¸‹ï¼š<br><span class="hljs-meta">@Bean</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> FilterRegistrationBean <span class="hljs-title">timeFilter</span><span class="hljs-params">()</span> </span>&#123;<br>FilterRegistrationBean registrationBean = <span class="hljs-keyword">new</span> FilterRegistrationBean();<br><br>TimeFilter timeFilter = <span class="hljs-keyword">new</span> TimeFilter();<br>registrationBean.setFilter(timeFilter);<br><br>List&lt;String&gt; urls = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>urls.add(<span class="hljs-string">&quot;/*&quot;</span>);<br>registrationBean.setUrlPatterns(urls);<br><br><span class="hljs-keyword">return</span> registrationBean;<br>&#125;<br> <br></code></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹:<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/springboot-web-05_1567661159541.jpg" alt="springboot-web-05"></p><h1 id="è‡ªå®šä¹‰ç›‘å¬å™¨"><a href="#è‡ªå®šä¹‰ç›‘å¬å™¨" class="headerlink" title="è‡ªå®šä¹‰ç›‘å¬å™¨"></a>è‡ªå®šä¹‰ç›‘å¬å™¨</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java">ç¼–å†™ç›‘å¬å™¨<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ListenerTest</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ServletContextListener</span> </span>&#123;<br> <br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">contextInitialized</span><span class="hljs-params">(ServletContextEvent sce)</span> </span>&#123;<br>System.out.println(<span class="hljs-string">&quot;ç›‘å¬å™¨åˆå§‹åŒ–...&quot;</span>);<br>&#125;<br> <br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">contextDestroyed</span><span class="hljs-params">(ServletContextEvent sce)</span> </span>&#123;<br> <br>&#125;<br> <br>&#125;<br> <br>æ³¨å†Œç›‘å¬å™¨<br>æ³¨å†Œç›‘å¬å™¨ä¸º Beanï¼Œåœ¨ WebConfig é…ç½®ç±»ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š<br><span class="hljs-meta">@Bean</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> ServletListenerRegistrationBean&lt;ListenerTest&gt; <span class="hljs-title">servletListenerRegistrationBean</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ServletListenerRegistrationBean&lt;ListenerTest&gt;(<span class="hljs-keyword">new</span> ListenerTest());<br>&#125;<br> <br>é’ˆå¯¹è‡ªå®šä¹‰ Servletã€Filter å’Œ Listener çš„é…ç½®ï¼Œè¿˜æœ‰å¦ä¸€ç§æ–¹å¼ï¼š<br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringbootWebApplication</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ServletContextInitializer</span> </span>&#123;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onStartup</span><span class="hljs-params">(ServletContext servletContext)</span> <span class="hljs-keyword">throws</span> ServletException </span>&#123;<br>    <span class="hljs-comment">// é…ç½® Servlet</span><br>        servletContext.addServlet(<span class="hljs-string">&quot;servletTest&quot;</span>,<span class="hljs-keyword">new</span> ServletTest())<br>          .addMapping(<span class="hljs-string">&quot;/servletTest&quot;</span>);<br>        <span class="hljs-comment">// é…ç½®è¿‡æ»¤å™¨</span><br>        servletContext.addFilter(<span class="hljs-string">&quot;timeFilter&quot;</span>,<span class="hljs-keyword">new</span> TimeFilter())<br>          .addMappingForUrlPatterns(EnumSet.of(DispatcherType.REQUEST),<span class="hljs-keyword">true</span>,<span class="hljs-string">&quot;/*&quot;</span>);<br>        <span class="hljs-comment">// é…ç½®ç›‘å¬å™¨</span><br>        servletContext.addListener(<span class="hljs-keyword">new</span> ListenerTest());<br>    &#125;<br> <br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>SpringApplication.run(SpringbootWebApplication.class, args);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹:<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/springboot-web-06_1567661262946.jpg" alt="springboot-web-06"></p><h1 id="è‡ªå®šä¹‰æ‹¦æˆªå™¨"><a href="#è‡ªå®šä¹‰æ‹¦æˆªå™¨" class="headerlink" title="è‡ªå®šä¹‰æ‹¦æˆªå™¨"></a>è‡ªå®šä¹‰æ‹¦æˆªå™¨</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs java">ç¼–å†™æ‹¦æˆªå™¨<br>ä½¿ç”¨ <span class="hljs-meta">@Component</span> è®© Spring ç®¡ç†å…¶ç”Ÿå‘½å‘¨æœŸï¼š<br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TimeInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">HandlerInterceptor</span> </span>&#123;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br><br>System.out.println(<span class="hljs-string">&quot;========preHandle=========&quot;</span>);<br>System.out.println(((HandlerMethod)handler).getBean().getClass().getName());<br>System.out.println(((HandlerMethod)handler).getMethod().getName());<br><br>request.setAttribute(<span class="hljs-string">&quot;startTime&quot;</span>, System.currentTimeMillis());<br><br><span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">postHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span></span><br><span class="hljs-function"><span class="hljs-keyword">throws</span> Exception </span>&#123;<br> <br>System.out.println(<span class="hljs-string">&quot;========postHandle=========&quot;</span>);<br>Long start = (Long) request.getAttribute(<span class="hljs-string">&quot;startTime&quot;</span>);<br>System.out.println(<span class="hljs-string">&quot;è€—æ—¶:&quot;</span>+(System.currentTimeMillis() - start));<br>&#125;<br> <br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">afterCompletion</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception exception)</span></span><br><span class="hljs-function"><span class="hljs-keyword">throws</span> Exception </span>&#123;<br> <br>System.out.println(<span class="hljs-string">&quot;========afterCompletion=========&quot;</span>);<br>Long start = (Long) request.getAttribute(<span class="hljs-string">&quot;startTime&quot;</span>);<br>System.out.println(<span class="hljs-string">&quot;è€—æ—¶:&quot;</span>+(System.currentTimeMillis() - start));<br><br>System.out.println(exception);<br>&#125;<br> <br>&#125;<br> <br>æ³¨å†Œæ‹¦æˆªå™¨<br>ç¼–å†™æ‹¦æˆªå™¨åï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†å…¶æ³¨å†Œåˆ°æ‹¦æˆªå™¨é“¾ä¸­ï¼Œå¦‚ä¸‹é…ç½®ï¼š<br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebMvcConfigurerAdapter</span></span>&#123;<br><br><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> TimeInterceptor timeInterceptor;<br><br> <br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addInterceptors</span><span class="hljs-params">(InterceptorRegistry registry)</span> </span>&#123;<br>registry.addInterceptor(timeInterceptor);<br>&#125;<br> <br>&#125;<br> <br></code></pre></td></tr></table></figure><p>è¯·æ±‚ä¸€ä¸ª controller ï¼Œç»“æœå¦‚ä¸‹ï¼š<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/springboot-web-07_1567661364759.jpg" alt="springboot-web-07"></p>]]></content>
    
    
    
    <tags>
      
      <tag>SpringBoot</tag>
      
      <tag>å…¥é—¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBoot-Web-Fastjson</title>
    <link href="/blog/2021/01/31/SpringBoot-Web-Fastjson/"/>
    <url>/blog/2021/01/31/SpringBoot-Web-Fastjson/</url>
    
    <content type="html"><![CDATA[<h1 id="æ•´åˆæ¨¡æ¿å¼•æ“"><a href="#æ•´åˆæ¨¡æ¿å¼•æ“" class="headerlink" title="æ•´åˆæ¨¡æ¿å¼•æ“"></a>æ•´åˆæ¨¡æ¿å¼•æ“</h1><p>ç”±äº jsp ä¸è¢« SpringBoot æ¨èä½¿ç”¨ï¼Œæ‰€ä»¥æ¨¡æ¿å¼•æ“ä¸»è¦ä»‹ç» Freemarker å’Œ Thymeleafã€‚</p><h2 id="Freemarker"><a href="#Freemarker" class="headerlink" title="Freemarker"></a>Freemarker</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java">æ·»åŠ  Freemarker ä¾èµ–<br>&lt;dependency&gt;<br>    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>    &lt;artifactId&gt;spring-boot-starter-freemarker&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br> <br>æ·»åŠ  Freemarker æ¨¡æ¿é…ç½®<br>åœ¨ application.properties ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š<br>spring.freemarker.allow-request-override=<span class="hljs-keyword">false</span><br>spring.freemarker.cache=<span class="hljs-keyword">true</span><br>spring.freemarker.check-template-location=<span class="hljs-keyword">true</span><br>spring.freemarker.charset=UTF-<span class="hljs-number">8</span><br>spring.freemarker.content-type=text/html<br>spring.freemarker.expose-request-attributes=<span class="hljs-keyword">false</span><br>spring.freemarker.expose-session-attributes=<span class="hljs-keyword">false</span><br>spring.freemarker.expose-spring-macro-helpers=<span class="hljs-keyword">false</span><br>spring.freemarker.prefix=<br>spring.freemarker.suffix=.ftl<br> <br>Freemarker æ¡ˆä¾‹æ¼”ç¤º<br>åœ¨ controller åŒ…ä¸­åˆ›å»º FreemarkerControllerï¼š<br><span class="hljs-meta">@Controller</span><br><span class="hljs-meta">@RequestMapping(&quot;freemarker&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FreemarkerController</span> </span>&#123;<br> <br><span class="hljs-meta">@RequestMapping(&quot;hello&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello</span><span class="hljs-params">(Map&lt;String,Object&gt; map)</span> </span>&#123;<br><br>map.put(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;Hello Freemarker&quot;</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello&quot;</span>;<br>&#125;<br>&#125;<br>åœ¨ templates ç›®å½•ä¸­åˆ›å»ºåä¸º hello.ftl æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š<br>&lt;!DOCTYPE html&gt;<br>&lt;html lang=<span class="hljs-string">&quot;zh&quot;</span>&gt;<br>&lt;head&gt;<br>    &lt;meta charset=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;<br>    &lt;title&gt;Document&lt;/title&gt;<br>    &lt;link href=<span class="hljs-string">&quot;/css/index.css&quot;</span> rel=<span class="hljs-string">&quot;stylesheet&quot;</span>/&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>    &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;container&quot;</span>&gt;<br>    &lt;h2&gt;$&#123;msg&#125;&lt;/h2&gt;<br>    &lt;/div&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br> <br></code></pre></td></tr></table></figure><h3 id="ç»“æœå¦‚ä¸‹ï¼š"><a href="#ç»“æœå¦‚ä¸‹ï¼š" class="headerlink" title="ç»“æœå¦‚ä¸‹ï¼š"></a>ç»“æœå¦‚ä¸‹ï¼š</h3><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/springboog-5-1_1567562182671.jpg" alt="springboog-5-1"></p><h2 id="æ•´åˆ-Thymeleaf"><a href="#æ•´åˆ-Thymeleaf" class="headerlink" title="æ•´åˆ Thymeleaf"></a>æ•´åˆ Thymeleaf</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java">æ·»åŠ  Thymeleaf ä¾èµ–<br>åœ¨ pom.xml æ–‡ä»¶ä¸­æ·»åŠ ï¼š<br>&lt;dependency&gt;<br>    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>    &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br> <br>æ·»åŠ  Thymeleaf æ¨¡æ¿é…ç½®<br>åœ¨ application.properties ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š<br>spring.thymeleaf.cache=<span class="hljs-keyword">true</span><br>spring.thymeleaf.prefix=classpath:/templates/<br>spring.thymeleaf.suffix=.html<br>spring.thymeleaf.mode=HTML5<br>spring.thymeleaf.encoding=UTF-<span class="hljs-number">8</span><br>spring.thymeleaf.content-type=text/html<br>ä¸Šè¿°é…ç½®éƒ½æ˜¯é»˜è®¤å€¼ã€‚<br> <br>Thymeleaf æ¡ˆä¾‹æ¼”ç¤º<br>åœ¨ controller åŒ…ä¸­åˆ›å»º ThymeleafController:<br><span class="hljs-meta">@Controller</span><br><span class="hljs-meta">@RequestMapping(&quot;thymeleaf&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThymeleafController</span> </span>&#123;<br> <br><span class="hljs-meta">@RequestMapping(&quot;hello&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello</span><span class="hljs-params">(Map&lt;String,Object&gt; map)</span> </span>&#123;<br>map.put(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;Hello Thymeleaf&quot;</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello&quot;</span>;<br>&#125;<br>&#125;<br> <br>åœ¨ template ç›®å½•ä¸‹åˆ›å»ºåä¸º hello.html çš„æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š<br>&lt;!DOCTYPE html&gt;<br>&lt;html lang=<span class="hljs-string">&quot;zh&quot;</span>&gt;<br>&lt;head&gt;<br>    &lt;meta charset=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;<br>    &lt;title&gt;Document&lt;/title&gt;<br>    &lt;link href=<span class="hljs-string">&quot;/css/index.css&quot;</span> rel=<span class="hljs-string">&quot;stylesheet&quot;</span>/&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>    &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;container&quot;</span>&gt;<br>    &lt;h2 th:text=&quot;$&#123;msg&#125;&quot;&gt;&lt;/h2&gt;<br>    &lt;/div&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br> <br></code></pre></td></tr></table></figure><h3 id="ç»“æœå¦‚ä¸‹ï¼š-1"><a href="#ç»“æœå¦‚ä¸‹ï¼š-1" class="headerlink" title="ç»“æœå¦‚ä¸‹ï¼š"></a>ç»“æœå¦‚ä¸‹ï¼š</h3><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/springboog-5-2_1567562330507.jpg" alt="springboog-5-2"></p><h2 id="æ•´åˆ-Fastjson"><a href="#æ•´åˆ-Fastjson" class="headerlink" title="æ•´åˆ Fastjson"></a>æ•´åˆ Fastjson</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs java">æ·»åŠ ä¾èµ–<br>&lt;dependency&gt;<br>    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;<br>    &lt;artifactId&gt;fastjson&lt;/artifactId&gt;<br>    &lt;version&gt;1.2.35&lt;/version&gt;<br>&lt;/dependency&gt;<br> <br>æ•´åˆ Fastjson<br>åˆ›å»ºä¸€ä¸ªé…ç½®ç®¡ç†ç±» WebConfig ï¼Œå¦‚ä¸‹ï¼š<br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebConfig</span> </span>&#123;<br> <br><span class="hljs-meta">@Bean</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> HttpMessageConverters <span class="hljs-title">fastJsonHttpMessageConverters</span><span class="hljs-params">()</span> </span>&#123;<br>FastJsonHttpMessageConverter fastJsonHttpMessageConverter = <span class="hljs-keyword">new</span> FastJsonHttpMessageConverter();<br> <br>FastJsonConfig fastJsonConfig = <span class="hljs-keyword">new</span> FastJsonConfig();<br>fastJsonConfig.setSerializerFeatures(SerializerFeature.PrettyFormat);<br><br>fastJsonHttpMessageConverter.setFastJsonConfig(fastJsonConfig);<br><br>HttpMessageConverter&lt;?&gt; converter = fastJsonHttpMessageConverter;<br><br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> HttpMessageConverters(converter);<br> <br>&#125;<br>&#125;<br> <br>æ¼”ç¤ºæ¡ˆä¾‹ï¼š<br>åˆ›å»ºä¸€ä¸ªå®ä½“ç±» Userï¼š è®°å¾—get set<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;<br> <br><span class="hljs-keyword">private</span> Integer id;<br><br><span class="hljs-keyword">private</span> String username;<br><br><span class="hljs-keyword">private</span> String password;<br><br><span class="hljs-meta">@JSONField(format=&quot;yyyy-MM-dd&quot;)</span><br><span class="hljs-keyword">private</span> Date birthday;<br> <br>&#125;<br> <br>åˆ›å»ºæ§åˆ¶å™¨ç±» FastjsonController :<br><span class="hljs-meta">@Controller</span><br><span class="hljs-meta">@RequestMapping(&quot;fastjson&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FastJsonController</span> </span>&#123;<br> <br><span class="hljs-meta">@RequestMapping(&quot;/test&quot;)</span><br><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>&#123;<br>User user = <span class="hljs-keyword">new</span> User();<br><br>user.setId(<span class="hljs-number">1</span>);<br>user.setUsername(<span class="hljs-string">&quot;jack&quot;</span>);<br>user.setPassword(<span class="hljs-string">&quot;jack123&quot;</span>);<br>user.setBirthday(<span class="hljs-keyword">new</span> Date());<br><br><span class="hljs-keyword">return</span> user;<br>&#125;<br>&#125;<br> <br></code></pre></td></tr></table></figure><h3 id="ç»“æœå¦‚ä¸‹å›¾ï¼š"><a href="#ç»“æœå¦‚ä¸‹å›¾ï¼š" class="headerlink" title="ç»“æœå¦‚ä¸‹å›¾ï¼š"></a>ç»“æœå¦‚ä¸‹å›¾ï¼š</h3><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/springboot-06-1_1567562545811.jpg" alt="springboot-06-1">æ—¥æœŸæ ¼å¼ä¸æˆ‘ä»¬ä¿®æ”¹çš„å†…å®¹æ ¼å¼ä¸€è‡´ï¼Œè¯´æ˜ Fastjson æ•´åˆæˆåŠŸã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>SpringBoot</tag>
      
      <tag>Fastjson</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBooté…ç½®logback</title>
    <link href="/blog/2021/01/31/SpringBoot%E9%85%8D%E7%BD%AElogback/"/>
    <url>/blog/2021/01/31/SpringBoot%E9%85%8D%E7%BD%AElogback/</url>
    
    <content type="html"><![CDATA[<h1 id="é…ç½®æ—¥å¿—æ–‡ä»¶"><a href="#é…ç½®æ—¥å¿—æ–‡ä»¶" class="headerlink" title="é…ç½®æ—¥å¿—æ–‡ä»¶"></a>é…ç½®æ—¥å¿—æ–‡ä»¶</h1><p>spring boot é»˜è®¤ä¼šåŠ è½½ classpath:logback-spring.xml æˆ–è€… classpath:logback-spring.groovyã€‚</p><p>å¦‚éœ€è¦è‡ªå®šä¹‰æ–‡ä»¶åç§°ï¼Œåœ¨ application.properties ä¸­é…ç½® logging.config é€‰é¡¹å³å¯ã€‚</p><p>åœ¨ src/main/resources ä¸‹åˆ›å»º logback-spring.xml æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;<br>&lt;configuration&gt;<br>    &lt;!-- æ–‡ä»¶è¾“å‡ºæ ¼å¼ --&gt;<br>    &lt;property name=<span class="hljs-string">&quot;PATTERN&quot;</span> value=<span class="hljs-string">&quot;%-12(%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;) |-%-5level [%thread] %c [%L] -| %msg%n&quot;</span> /&gt;<br>    &lt;!-- testæ–‡ä»¶è·¯å¾„ --&gt;<br>    &lt;property name=<span class="hljs-string">&quot;TEST_FILE_PATH&quot;</span> value=<span class="hljs-string">&quot;d:/test.log&quot;</span> /&gt;<br>    &lt;!-- proæ–‡ä»¶è·¯å¾„ --&gt;<br>    &lt;property name=<span class="hljs-string">&quot;PRO_FILE_PATH&quot;</span> value=<span class="hljs-string">&quot;/opt/test/log&quot;</span> /&gt;<br> <br>    &lt;!-- å¼€å‘ç¯å¢ƒ --&gt;<br>    &lt;springProfile name=<span class="hljs-string">&quot;dev&quot;</span>&gt;<br>        &lt;appender name=<span class="hljs-string">&quot;CONSOLE&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;<br>            &lt;encoder&gt;<br>                &lt;pattern&gt;$&#123;PATTERN&#125;&lt;/pattern&gt;<br>            &lt;/encoder&gt;<br>        &lt;/appender&gt;<br>        &lt;logger name=<span class="hljs-string">&quot;com.light.springboot&quot;</span> level=<span class="hljs-string">&quot;debug&quot;</span> /&gt;<br>        &lt;root level=<span class="hljs-string">&quot;info&quot;</span>&gt;<br>            &lt;appender-ref ref=<span class="hljs-string">&quot;CONSOLE&quot;</span> /&gt;<br>        &lt;/root&gt;<br>    &lt;/springProfile&gt;<br> <br>    &lt;!-- æµ‹è¯•ç¯å¢ƒ --&gt;<br>    &lt;springProfile name=<span class="hljs-string">&quot;test&quot;</span>&gt;<br>        &lt;!-- æ¯å¤©äº§ç”Ÿä¸€ä¸ªæ–‡ä»¶ --&gt;<br>        &lt;appender name=<span class="hljs-string">&quot;TEST-FILE&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;<br>            &lt;!-- æ–‡ä»¶è·¯å¾„ --&gt;<br>            &lt;file&gt;$&#123;TEST_FILE_PATH&#125;&lt;/file&gt;<br>            &lt;rollingPolicy <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;<br>                &lt;!-- æ–‡ä»¶åç§° --&gt;<br>                &lt;fileNamePattern&gt;$&#123;TEST_FILE_PATH&#125;/info.%d&#123;yyyy-MM-dd&#125;.log&lt;/fileNamePattern&gt;<br>                &lt;!-- æ–‡ä»¶æœ€å¤§ä¿å­˜å†å²æ•°é‡ --&gt;<br>                &lt;MaxHistory&gt;100&lt;/MaxHistory&gt;<br>            &lt;/rollingPolicy&gt;<br>            &lt;layout <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;ch.qos.logback.classic.PatternLayout&quot;</span>&gt;<br>                &lt;pattern&gt;$&#123;PATTERN&#125;&lt;/pattern&gt;<br>            &lt;/layout&gt;<br>        &lt;/appender&gt;<br>        &lt;logger name=<span class="hljs-string">&quot;com.light.springboot&quot;</span> level=<span class="hljs-string">&quot;debug&quot;</span> /&gt;<br>        &lt;root level=<span class="hljs-string">&quot;info&quot;</span>&gt;<br>            &lt;appender-ref ref=<span class="hljs-string">&quot;TEST-FILE&quot;</span> /&gt;<br>        &lt;/root&gt;<br>    &lt;/springProfile&gt;<br> <br>    &lt;!-- ç”Ÿäº§ç¯å¢ƒ --&gt;<br>    &lt;springProfile name=<span class="hljs-string">&quot;prod&quot;</span>&gt;<br>        &lt;appender name=<span class="hljs-string">&quot;PROD_FILE&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;<br>            &lt;file&gt;$&#123;PRO_FILE_PATH&#125;&lt;/file&gt;<br>            &lt;rollingPolicy <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;<br>                &lt;fileNamePattern&gt;$&#123;PRO_FILE_PATH&#125;/warn.%d&#123;yyyy-MM-dd&#125;.log&lt;/fileNamePattern&gt;<br>                &lt;MaxHistory&gt;100&lt;/MaxHistory&gt;<br>            &lt;/rollingPolicy&gt;<br>            &lt;layout <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;ch.qos.logback.classic.PatternLayout&quot;</span>&gt;<br>                &lt;pattern&gt;$&#123;PATTERN&#125;&lt;/pattern&gt;<br>            &lt;/layout&gt;<br>        &lt;/appender&gt;<br>        &lt;root level=<span class="hljs-string">&quot;warn&quot;</span>&gt;<br>            &lt;appender-ref ref=<span class="hljs-string">&quot;PROD_FILE&quot;</span> /&gt;<br>        &lt;/root&gt;<br>    &lt;/springProfile&gt;<br>&lt;/configuration&gt;<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ï¼ŒspringProfile æ ‡ç­¾çš„ name å±æ€§å¯¹åº” application.properties ä¸­çš„ spring.profiles.active çš„é…ç½®ã€‚</p><p>å³ spring.profiles.active çš„å€¼å¯ä»¥çœ‹ä½œæ˜¯æ—¥å¿—é…ç½®æ–‡ä»¶ä¸­å¯¹åº”çš„ springProfile æ˜¯å¦ç”Ÿæ•ˆçš„å¼€å…³ã€‚</p><h1 id="æ³¨è§£ä»‹ç»"><a href="#æ³¨è§£ä»‹ç»" class="headerlink" title="æ³¨è§£ä»‹ç»"></a>æ³¨è§£ä»‹ç»</h1><p>ä¸‹é¢åˆ—å‡º Spring Boot å¼€å‘ä¸­å¸¸ç”¨çš„æ³¨è§£ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java">@Configuration                 # ä½œç”¨äºç±»ä¸Šï¼Œç›¸å½“äºä¸€ä¸ª xml é…ç½®æ–‡ä»¶<br>@Bean                          # ä½œç”¨äºæ–¹æ³•ä¸Šï¼Œç›¸å½“äº xml é…ç½®ä¸­çš„ &lt;bean&gt;<br>@SpringBootApplication         # Spring Bootçš„æ ¸å¿ƒæ³¨è§£ï¼Œæ˜¯ä¸€ä¸ªç»„åˆæ³¨è§£ï¼Œç”¨äºå¯åŠ¨ç±»ä¸Š<br>@EnableAutoConfiguration       # å¯ç”¨è‡ªåŠ¨é…ç½®ï¼Œå…è®¸åŠ è½½ç¬¬ä¸‰æ–¹ Jar åŒ…çš„é…ç½®<br>@ComponentScan                 # é»˜è®¤æ‰«æ @SpringBootApplication æ‰€åœ¨ç±»çš„åŒçº§ç›®å½•ä»¥åŠå®ƒçš„å­ç›®å½•<br>@PropertySource                # åŠ è½½ properties æ–‡ä»¶<br>@Value                         # å°†é…ç½®æ–‡ä»¶çš„å±æ€§æ³¨å…¥åˆ° Bean ä¸­ç‰¹å®šçš„æˆå‘˜å˜é‡<br>@EnableConfigurationProperties # å¼€å¯ä¸€ä¸ªç‰¹æ€§ï¼Œè®©é…ç½®æ–‡ä»¶çš„å±æ€§å¯ä»¥æ³¨å…¥åˆ° Bean ä¸­ï¼Œä¸ @ConfigurationProperties ç»“åˆä½¿ç”¨<br>@ConfigurationProperties       # å…³è”é…ç½®æ–‡ä»¶ä¸­çš„å±æ€§åˆ° Bean ä¸­<br>@Import                        # åŠ è½½æŒ‡å®š Class æ–‡ä»¶ï¼Œå…¶ç”Ÿå‘½å‘¨æœŸè¢« Spring ç®¡ç†<br>@ImportResource                # åŠ è½½ xml æ–‡ä»¶<br></code></pre></td></tr></table></figure><h1 id="è¯»å–é…ç½®æ–‡ä»¶"><a href="#è¯»å–é…ç½®æ–‡ä»¶" class="headerlink" title="è¯»å–é…ç½®æ–‡ä»¶"></a>è¯»å–é…ç½®æ–‡ä»¶</h1><h2 id="å±æ€§è£…é…"><a href="#å±æ€§è£…é…" class="headerlink" title="å±æ€§è£…é…"></a>å±æ€§è£…é…</h2><p>æœ‰ä¸¤ç§æ–¹å¼ï¼šä½¿ç”¨ @Value æ³¨è§£å’Œ Environment å¯¹è±¡ã€‚ åœ¨ application.properties ä¸­æ·»åŠ ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java">ds.userName=root<br>ds.password=tiger<br>ds.url=jdbc:mysql:<span class="hljs-comment">//localhost:3306/test</span><br>ds.driverClassName=com.mysql.jdbc.Driver<br> <br>ä»¥ä¸Šæ˜¯è‡ªå®šä¹‰çš„é…ç½®ã€‚<br>åˆ›å»ºä¸€ä¸ªé…ç½®ç±»ï¼Œå¦‚ä¸‹ï¼š<br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebConfig</span> </span>&#123;<br> <br>    <span class="hljs-meta">@Value(&quot;$&#123;ds.userName&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String userName;<br> <br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> Environment environment;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">show</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;ds.userName:&quot;</span> + <span class="hljs-keyword">this</span>.userName);<br>        System.out.println(<span class="hljs-string">&quot;ds.password:&quot;</span> + <span class="hljs-keyword">this</span>.environment.getProperty(<span class="hljs-string">&quot;ds.password&quot;</span>));<br>    &#125;<br>&#125;<br> <br>é€šè¿‡ <span class="hljs-meta">@Value</span> è·å– config.userName é…ç½®ï¼›é€šè¿‡ environment è·å– config.password é…ç½®ã€‚<br> <br>æµ‹è¯•ï¼š<br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringbootApplication</span> </span>&#123;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        ConfigurableApplicationContext context = SpringApplication.run(SpringbootApplication.class, args);<br>        context.getBean(WebConfig.class).show();<br>    &#125;<br>&#125;<br> <br>æ‰“å°ç»“æœï¼š<br>userName:root<br>password:tiger<br></code></pre></td></tr></table></figure><h2 id="å¯¹è±¡è£…é…"><a href="#å¯¹è±¡è£…é…" class="headerlink" title="å¯¹è±¡è£…é…"></a>å¯¹è±¡è£…é…</h2><p>åˆ›å»ºä¸€ä¸ªå°è£…ç±»ï¼š çœç•¥ get set</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@ConfigurationProperties(prefix=&quot;ds&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DataSourceProperties</span> </span>&#123;<br> <br>    <span class="hljs-keyword">private</span> String url;<br> <br>    <span class="hljs-keyword">private</span> String driverClassName;<br> <br>    <span class="hljs-keyword">private</span> String userName;<br> <br>    <span class="hljs-keyword">private</span> String password;<br> <br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">show</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;ds.url=&quot;</span> + <span class="hljs-keyword">this</span>.url);<br>        System.out.println(<span class="hljs-string">&quot;ds.driverClassName=&quot;</span> + <span class="hljs-keyword">this</span>.driverClassName);<br>        System.out.println(<span class="hljs-string">&quot;ds.userName=&quot;</span> + <span class="hljs-keyword">this</span>.userName);<br>        System.out.println(<span class="hljs-string">&quot;ds.password=&quot;</span> +<span class="hljs-keyword">this</span>.password);<br>    &#125;<br> <br>&#125;<br>æµ‹è¯•ï¼š<br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringbootApplication</span> </span>&#123;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        ConfigurableApplicationContext context = SpringApplication.run(SpringbootApplication.class, args);<br>        context.getBean(DataSourceProperties.class).show();<br>    &#125;<br>&#125;<br> <br>æ‰“å°ç»“æœ<br>ds.url=jdbc:mysql:<span class="hljs-comment">//localhost:3306/test</span><br>ds.driverClassName=com.mysql.jdbc.Driver<br>ds.userName=root<br>ds.password=tiger<br></code></pre></td></tr></table></figure><h1 id="æ‰“åŒ…è¿è¡Œ"><a href="#æ‰“åŒ…è¿è¡Œ" class="headerlink" title="æ‰“åŒ…è¿è¡Œ"></a>æ‰“åŒ…è¿è¡Œ</h1><p>æ‰“åŒ…çš„å½¢å¼æœ‰ä¸¤ç§ï¼šjar å’Œ warã€‚</p><h2 id="jar"><a href="#jar" class="headerlink" title="jar"></a>jar</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œé€šè¿‡ maven æ‰§è¡Œ package å‘½ä»¤åï¼Œä¼šç”Ÿæˆ jar åŒ…ï¼Œä¸”è¯¥ jar åŒ…ä¼šå†…ç½®äº† tomcat å®¹å™¨ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡ java -jar å°±å¯ä»¥è¿è¡Œé¡¹ç›®</p><h2 id="war"><a href="#war" class="headerlink" title="war"></a>war</h2><p>è®© SpringbootApplication ç±»ç»§æ‰¿ SpringBootServletInitializer å¹¶é‡å†™ configure æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringbootApplication</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SpringBootServletInitializer</span> </span>&#123;<br> <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> SpringApplicationBuilder <span class="hljs-title">configure</span><span class="hljs-params">(SpringApplicationBuilder application)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> application.sources(SpringbootApplication.class);<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        SpringApplication.run(SpringbootApplication.class, args);<br>    &#125;<br>&#125;<br>ä¿®æ”¹ pom.xml æ–‡ä»¶ï¼Œå°† jar æ”¹æˆ warï¼Œå¦‚ä¸‹ï¼š<br>&lt;packaging&gt;war&lt;/packaging&gt;<br>ç§»é™¤å†…ç½® tomcatï¼š<br>&lt;dependency&gt;<br>&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;<br>&lt;exclusions&gt;<br>&lt;exclusion&gt;<br>&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>&lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt;<br>&lt;/exclusion&gt;<br>&lt;/exclusions&gt;<br>&lt;/dependency&gt;<br>&lt;!-- Servlet API --&gt;<br>&lt;dependency&gt;<br>&lt;groupId&gt;javax.servlet&lt;/groupId&gt;<br>&lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;<br>&lt;version&gt;3.1.0&lt;/version&gt;<br>&lt;scope&gt;provided&lt;/scope&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure><p>æ‰“åŒ…æˆåŠŸåï¼Œå°† war åŒ…éƒ¨ç½²åˆ° tomcat å®¹å™¨ä¸­è¿è¡Œå³å¯ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>SpringBoot</tag>
      
      <tag>logback</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>DockeråŸºæœ¬å‘½ä»¤åŠ RabbitMqå®‰è£…</title>
    <link href="/blog/2021/01/25/Docker%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4%E5%8A%A0RabbitMq%E5%AE%89%E8%A3%85/"/>
    <url>/blog/2021/01/25/Docker%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4%E5%8A%A0RabbitMq%E5%AE%89%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<ol><li>æŸ¥çœ‹å®‰è£…çš„Dockerä¿¡æ¯ docker info</li><li>æŸ¥çœ‹Dockerç‰ˆæœ¬ docker version</li></ol><h1 id="é•œåƒç±»å‘½ä»¤"><a href="#é•œåƒç±»å‘½ä»¤" class="headerlink" title="é•œåƒç±»å‘½ä»¤"></a>é•œåƒç±»å‘½ä»¤</h1><ol><li>æŸ¥çœ‹é•œåƒ docker images</li><li>åˆ é™¤é•œåƒ æ ¹æ®imageIdæˆ–è€…imageName:tagåˆ é™¤æœ¬åœ°é•œåƒ docker rmi &lt;imageId|imageName:tag&gt;</li><li>æ‹‰å–é•œåƒ docker pull <a href="imagename:tag">imageName:tag</a></li><li>ä¸Šä¼ é•œåƒåˆ°ä»“åº“ docker push <a href="imagename:tag">imageName:tag</a></li><li>ä¿å­˜é•œåƒä¸ºtaråŒ… docker save registry:latest &gt; /data/registry.tar</li><li>æœç´¢é•œåƒ docker search</li><li>å¯¼å…¥é•œåƒï¼ˆç”¨æœ¬åœ°çš„taråŒ…å¯¼å…¥é•œåƒï¼‰ docker load â€“i</li><li>ç»™é•œåƒé‡æ–°æ‰“tag docker tag <a href="imagename:tag">imageName:tag</a></li><li>æ„å»ºé•œåƒ docker build -t<img src="" alt="img">&lt;&gt;</li></ol><h1 id="å®¹å™¨ç±»å‘½ä»¤"><a href="#å®¹å™¨ç±»å‘½ä»¤" class="headerlink" title="å®¹å™¨ç±»å‘½ä»¤"></a>å®¹å™¨ç±»å‘½ä»¤</h1><ol><li>æŸ¥è¯¢æ­£åœ¨è¿è¡Œçš„å®¹å™¨ æŸ¥è¯¢æ‰€æœ‰å®¹å™¨ docker ps docker ps -a</li><li>åˆ é™¤å®¹å™¨ åˆ é™¤çš„å®¹å™¨åªèƒ½æ˜¯åœæ­¢çš„ï¼Œéæ­£åœ¨è¿è¡Œçš„å®¹å™¨ docker rm &lt;containerId|containerName&gt;</li><li>å¼€å¯åœæ­¢çš„å®¹å™¨ docker start &lt;containerId|containerName&gt;</li><li>åœæ­¢å®¹å™¨ docker stop &lt;containerId|containerName&gt;</li><li>æ€æ­»å®¹å™¨ docker kill &lt;containerId|containerName&gt;</li><li>ä»å®¹å™¨ä¸­å–æ—¥å¿— docker logs &lt;containerId|containerName&gt;</li><li>æ˜¾ç¤ºä¸€ä¸ªè¿è¡Œçš„å®¹å™¨é‡Œé¢çš„è¿›ç¨‹ä¿¡æ¯ docker top &lt;containerId|containerName&gt;</li><li>é‡å¯å®¹å™¨ docker restart &lt;containerId|containerName&gt;</li><li>ä»å®¹å™¨é‡Œé¢æ‹·è´æ–‡ä»¶/ç›®å½•åˆ°æœ¬åœ°ä¸€ä¸ªè·¯å¾„ docker cp &lt;containerId|containerName&gt;:/container_path to_path</li><li>å¯åŠ¨å®¹å™¨ åœ¨å®¹å™¨ä¸­è¿è¡Œâ€echoâ€å‘½ä»¤ï¼Œè¾“å‡ºâ€hellowordâ€ docker run image_name echo â€œhello wordâ€</li><li>äº¤äº’å¼è¿›å…¥å®¹å™¨ä¸­ docker run -i -t image_name /bin/bash</li><li>åå°è¿è¡Œå®¹å™¨ä½¿ç”¨â€“då‚æ•°(åå°è¿è¡Œ) docker run -d image_name</li></ol><h1 id="Dockerä¸‹å®‰è£…rabbitmq"><a href="#Dockerä¸‹å®‰è£…rabbitmq" class="headerlink" title="Dockerä¸‹å®‰è£…rabbitmq"></a>Dockerä¸‹å®‰è£…rabbitmq</h1><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs routeros">æ‹‰å–é•œåƒ <br>docker pull rabbitmq:3-management<br> <br>å¯åŠ¨é•œåƒ<br>docker <span class="hljs-builtin-name">run</span> -d --hostname my-rabbit --name rabbit -v /data/rabbitmq:/var/lib/rabbitmq -e <span class="hljs-attribute">RABBITMQ_DEFAULT_USER</span>=admin -e <span class="hljs-attribute">RABBITMQ_DEFAULT_PASS</span>=admin -p 15672:15672 -p 5672:5672 rabbitmq:3-management<br></code></pre></td></tr></table></figure><p>å®Œæˆåè®¿é—®ï¼š<a href="http://ip:15672/">http://ip:15672</a> ç”¨æˆ·åadmin å¯†ç  admin ä¹Ÿå¯ä»¥è‡ªå·±è®¾ç½®å¯†ç </p><p>æ˜¯ä¸æ˜¯å¾ˆç®€å• æˆ‘è‡ªå·±åœ¨ç‰©ç†æœºä¸Šè£…äº†å¥½å‡ æ¬¡ è¿˜æ˜¯æ²¡æœ‰æˆåŠŸ docker ä¸¤å¥å‘½ä»¤</p>]]></content>
    
    
    
    <tags>
      
      <tag>docker</tag>
      
      <tag>mq</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBootå…¥é—¨è®¾ç½®</title>
    <link href="/blog/2021/01/25/SpringBoot%E5%85%A5%E9%97%A8%E8%AE%BE%E7%BD%AE/"/>
    <url>/blog/2021/01/25/SpringBoot%E5%85%A5%E9%97%A8%E8%AE%BE%E7%BD%AE/</url>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>Spring Boot æ˜¯ç”± Pivotal å›¢é˜Ÿæä¾›çš„å…¨æ–°æ¡†æ¶ï¼Œå…¶è®¾è®¡ç›®çš„æ˜¯ç”¨æ¥ç®€åŒ–æ–° Spring åº”ç”¨çš„åˆå§‹æ­å»ºä»¥åŠå¼€å‘è¿‡ç¨‹ã€‚è¯¥æ¡†æ¶ä½¿ç”¨äº†ç‰¹å®šçš„æ–¹å¼æ¥è¿›è¡Œé…ç½®ï¼Œä»è€Œä½¿å¼€å‘äººå‘˜ä¸å†éœ€è¦å®šä¹‰æ ·æ¿åŒ–çš„é…ç½®ã€‚å¥½å°±å¯¹äº†</p><h1 id="ç¯å¢ƒæ­å»ºmavené¡¹ç›®"><a href="#ç¯å¢ƒæ­å»ºmavené¡¹ç›®" class="headerlink" title="ç¯å¢ƒæ­å»ºmavené¡¹ç›®"></a>ç¯å¢ƒæ­å»ºmavené¡¹ç›®</h1><h2 id="pom-xml-ä¸­"><a href="#pom-xml-ä¸­" class="headerlink" title="pom.xml ä¸­"></a>pom.xml ä¸­</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;!-- å®šä¹‰å…¬å…±èµ„æºç‰ˆæœ¬ --&gt;<br>&lt;parent&gt;<br>    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;<br>    &lt;version&gt;1.5.6.RELEASE&lt;/version&gt;<br>    &lt;relativePath /&gt;<br>&lt;/parent&gt;<br> <br>&lt;properties&gt;<br>    &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;<br>    &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt;<br>    &lt;java.version&gt;1.8&lt;/java.version&gt;<br>&lt;/properties&gt;<br> <br>&lt;dependencies&gt;<br>    &lt;!-- ä¸Šè¾¹å¼•å…¥ parentï¼Œå› æ­¤ ä¸‹è¾¹æ— éœ€æŒ‡å®šç‰ˆæœ¬ --&gt;<br>    &lt;!-- åŒ…å« mvc,aop ç­‰jarèµ„æº --&gt;<br>    &lt;dependency&gt;<br>        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;<br>    &lt;/dependency&gt;<br>&lt;/dependencies&gt;<br> <br>&lt;build&gt;<br>    &lt;plugins&gt;<br>        &lt;plugin&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;<br>        &lt;/plugin&gt;<br>    &lt;/plugins&gt;<br>&lt;/build&gt;<br></code></pre></td></tr></table></figure><h2 id="åˆ›å»ºç›®å½•å’Œé…ç½®æ–‡ä»¶"><a href="#åˆ›å»ºç›®å½•å’Œé…ç½®æ–‡ä»¶" class="headerlink" title="åˆ›å»ºç›®å½•å’Œé…ç½®æ–‡ä»¶"></a>åˆ›å»ºç›®å½•å’Œé…ç½®æ–‡ä»¶</h2><p>åˆ›å»º src/main/resources æºæ–‡ä»¶ç›®å½•ï¼Œå¹¶åœ¨è¯¥ç›®å½•ä¸‹åˆ›å»º application.properties æ–‡ä»¶ã€static å’Œ templates çš„æ–‡ä»¶å¤¹ã€‚</p><p>application.propertiesï¼šç”¨äºé…ç½®é¡¹ç›®è¿è¡Œæ‰€éœ€çš„é…ç½®æ•°æ®ã€‚</p><p>staticï¼šç”¨äºå­˜æ”¾é™æ€èµ„æºï¼Œå¦‚ï¼šcssã€jsã€å›¾ç‰‡ç­‰ã€‚</p><p>templatesï¼šç”¨äºå­˜æ”¾æ¨¡æ¿æ–‡ä»¶ã€‚<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/WX20190902-094158@2x_1567388546384.png" alt="WX20190902-094158@2x"></p><h2 id="åˆ›å»ºå¯åŠ¨ç±»"><a href="#åˆ›å»ºå¯åŠ¨ç±»" class="headerlink" title="åˆ›å»ºå¯åŠ¨ç±»"></a>åˆ›å»ºå¯åŠ¨ç±»</h2><p>æ”¾åœ¨åŒ…ä¸‹ com.cxy.template ä¸ç”¨å•ç‹¬å»ºæ–‡ä»¶å¤¹æ”¾ ä¿æŒåŒçº§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> è¯¥æ³¨è§£æŒ‡å®šé¡¹ç›®ä¸ºspringbootï¼Œç”±æ­¤ç±»å½“ä½œç¨‹åºå…¥å£</span><br><span class="hljs-comment"> è‡ªåŠ¨è£…é… web ä¾èµ–çš„ç¯å¢ƒ</span><br><span class="hljs-comment"> </span><br><span class="hljs-comment">**/</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringbootApplication</span> </span>&#123;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        SpringApplication.run(SpringbootApplication.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æ¡ˆä¾‹æ¼”ç¤º"><a href="#æ¡ˆä¾‹æ¼”ç¤º" class="headerlink" title="æ¡ˆä¾‹æ¼”ç¤º"></a>æ¡ˆä¾‹æ¼”ç¤º</h2><p>åœ¨com.cxy.template ä¸‹åˆ›å»ºä¸€ä¸ªControllerç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestController</span> </span>&#123;<br> <br>    <span class="hljs-meta">@GetMapping(&quot;/helloworld&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">helloworld</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;helloworld&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰“å¼€æµè§ˆå™¨è®¿é—® <a href="http://localhost:8080/helloworld">http://localhost:8080/helloworld</a> è¿™é‡Œå»ºè®®å¢åŠ çƒ­éƒ¨ç½²æ’ä»¶ <a href="https://bk.cuixiaoyan.xyz/archives/jrebel">idea æ¿€æ´» jrebel</a></p><h2 id="å¤šç¯å¢ƒåˆ‡æ¢"><a href="#å¤šç¯å¢ƒåˆ‡æ¢" class="headerlink" title="å¤šç¯å¢ƒåˆ‡æ¢"></a>å¤šç¯å¢ƒåˆ‡æ¢</h2><p>pplication.properties æ˜¯ springboot åœ¨è¿è¡Œä¸­æ‰€éœ€è¦çš„é…ç½®ä¿¡æ¯ã€‚</p><p>å½“æˆ‘ä»¬åœ¨å¼€å‘é˜¶æ®µï¼Œä½¿ç”¨è‡ªå·±çš„æœºå™¨å¼€å‘ï¼Œæµ‹è¯•çš„æ—¶å€™éœ€è¦ç”¨çš„æµ‹è¯•æœåŠ¡å™¨æµ‹è¯•ï¼Œä¸Šçº¿æ—¶ä½¿ç”¨æ­£å¼ç¯å¢ƒçš„æœåŠ¡å™¨ã€‚</p><p>è¿™ä¸‰ç§ç¯å¢ƒéœ€è¦çš„é…ç½®ä¿¡æ¯éƒ½ä¸ä¸€æ ·ï¼Œå½“æˆ‘ä»¬åˆ‡æ¢ç¯å¢ƒè¿è¡Œé¡¹ç›®æ—¶ï¼Œéœ€è¦æ‰‹åŠ¨çš„ä¿®æ”¹å¤šå‡ºé…ç½®ä¿¡æ¯ï¼Œéå¸¸å®¹æ˜“å‡ºé”™ã€‚</p><p>ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œspringboot æä¾›å¤šç¯å¢ƒé…ç½®çš„æœºåˆ¶ï¼Œè®©å¼€å‘è€…éå¸¸å®¹æ˜“çš„æ ¹æ®éœ€æ±‚è€Œåˆ‡æ¢ä¸åŒçš„é…ç½®ç¯å¢ƒã€‚</p><p>åœ¨ src/main/resources ç›®å½•ä¸‹åˆ›å»ºä¸‰ä¸ªé…ç½®æ–‡ä»¶:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">application-dev.propertiesï¼šç”¨äºå¼€å‘ç¯å¢ƒ<br>application-test.propertiesï¼šç”¨äºæµ‹è¯•ç¯å¢ƒ<br>application-prod.propertiesï¼šç”¨äºç”Ÿäº§ç¯å¢ƒ<br> <br>æˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªä¸‰ä¸ªé…ç½®æ–‡ä»¶ä¸­è®¾ç½®ä¸åŒçš„ä¿¡æ¯ï¼Œapplication.properties é…ç½®å…¬å…±çš„ä¿¡æ¯ã€‚<br> <br>åœ¨ application.properties ä¸­é…ç½®ï¼š<br>spring.profiles.active=dev<br> <br></code></pre></td></tr></table></figure><p>åˆ‡æ¢é¡¹ç›®å¯åŠ¨çš„ç¯å¢ƒä¸ä»…å¯¹è¯»å–é…ç½®æ–‡ä»¶ä¿¡æ¯æœ‰æ•ˆï¼Œä¹Ÿå¯ä»¥å¯¹ Bean æœ‰æ•ˆã€‚</p><p>å½“æˆ‘ä»¬éœ€è¦å¯¹ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒçš„ Bean æ—¶ï¼Œå¯ä»¥é€šè¿‡ @Profile æ³¨è§£è¿›è¡ŒåŒºåˆ†ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BeanConfiguration</span> </span>&#123;<br> <br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@Profile(&quot;dev&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Runnable <span class="hljs-title">test1</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;å¼€å‘ç¯å¢ƒä½¿ç”¨çš„ Bean&quot;</span>);<br>        <span class="hljs-keyword">return</span> () -&gt; &#123;&#125;;<br>    &#125;<br> <br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@Profile(&quot;test&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Runnable <span class="hljs-title">test2</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;æµ‹è¯•ç¯å¢ƒä½¿ç”¨çš„ Bean&quot;</span>);<br>        <span class="hljs-keyword">return</span> () -&gt; &#123;&#125;;<br>    &#125;<br> <br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@Profile(&quot;pro&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Runnable <span class="hljs-title">test3</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;ç”Ÿæˆç¯å¢ƒä½¿ç”¨çš„ Bean&quot;</span>);<br>        <span class="hljs-keyword">return</span> () -&gt; &#123;&#125;;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å½“å¯åŠ¨é¡¹ç›®åï¼ŒSpring ä¼šæ ¹æ® spring.profiles.active çš„å€¼å®ä¾‹åŒ–å¯¹åº”çš„ Beanã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>SpringBoot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>centos7å®‰è£…Docker</title>
    <link href="/blog/2021/01/25/centos7%E5%AE%89%E8%A3%85Docker/"/>
    <url>/blog/2021/01/25/centos7%E5%AE%89%E8%A3%85Docker/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸ºä»€ä¹ˆè¦ç”¨Docker"><a href="#ä¸ºä»€ä¹ˆè¦ç”¨Docker" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ç”¨Docker"></a>ä¸ºä»€ä¹ˆè¦ç”¨Docker</h1><p>å…¨å‡­è‡ªå·±ç†è§£ æˆ‘åˆä¸æ˜¯ä¸“ä¸šçš„è¿ç»´ æè¿™ä¸ªå¹²å˜› è¿™ç§æƒ³æ³•å¯ä¸è¡Œå“¦</p><ol><li>å®‰è£…è½¯ä»¶æ–¹ä¾¿å¿«æ· ä¾‹å¦‚rabbitmq ä¹‹å‰åœ¨æœ¬åœ°æ€ä¹ˆå®‰è£…éƒ½è®¿é—®ä¸åˆ°webç®¡ç†é¡µé¢ ä½†æ˜¯dockerå°±ä¸¤å¥è¯ æœ€åçš„æ•ˆæœæ˜¯ä¸€æ ·çš„</li><li>èƒ½èŠ‚çœæœåŠ¡å™¨ä¸€éƒ¨åˆ†èµ„æº æˆ‘çš„æœåŠ¡å™¨ç¡®å®å¤ªå°äº†</li><li>è€Œä¸”åƒæˆ‘è¿™ç§å°ç™½ç™½ å®‰è£…é”™äº† ç›´æ¥åœæ­¢ åˆ é™¤é•œåƒå°±å¯ä»¥äº†</li><li>å®‰è£…åœ¨æœåŠ¡å™¨ä¸Š ææ€•è¦å»è°·æ­Œ å¦‚ä½•å®Œå…¨å¸è½½xxxå•¦</li></ol><h1 id="å‰ææ¡ä»¶"><a href="#å‰ææ¡ä»¶" class="headerlink" title="å‰ææ¡ä»¶"></a>å‰ææ¡ä»¶</h1><p>ç›®å‰ï¼ŒCentOS ä»…å‘è¡Œç‰ˆæœ¬ä¸­çš„å†…æ ¸æ”¯æŒ Dockerã€‚ Docker è¿è¡Œåœ¨ CentOS 7 ä¸Šï¼Œè¦æ±‚ç³»ç»Ÿä¸º64ä½ã€ç³»ç»Ÿå†…æ ¸ç‰ˆæœ¬ä¸º 3.10 ä»¥ä¸Šã€‚ Docker è¿è¡Œåœ¨ CentOS-6.5 æˆ–æ›´é«˜çš„ç‰ˆæœ¬çš„ CentOS ä¸Šï¼Œè¦æ±‚ç³»ç»Ÿä¸º64ä½ã€ç³»ç»Ÿå†…æ ¸ç‰ˆæœ¬ä¸º 2.6.32-431 æˆ–è€…æ›´é«˜ç‰ˆæœ¬ã€‚</p><p><strong>ä¸¤ç§æ–¹å¼ äºŒé€‰ä¸€</strong></p><h2 id="ä½¿ç”¨-yum-å®‰è£…"><a href="#ä½¿ç”¨-yum-å®‰è£…" class="headerlink" title="ä½¿ç”¨ yum å®‰è£…"></a>ä½¿ç”¨ yum å®‰è£…</h2><p>Docker è¦æ±‚ CentOS ç³»ç»Ÿçš„å†…æ ¸ç‰ˆæœ¬é«˜äº 3.10 ï¼ŒæŸ¥çœ‹æœ¬é¡µé¢çš„å‰ææ¡ä»¶æ¥éªŒè¯ä½ çš„CentOS ç‰ˆæœ¬æ˜¯å¦æ”¯æŒ Docker ã€‚</p><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs vala"><span class="hljs-meta">#æŸ¥çœ‹ä½ å½“å‰çš„å†…æ ¸ç‰ˆæœ¬</span><br>uname -r<br><br><span class="hljs-meta">#å®‰è£… Docker</span><br>yum -y install docker<br><br><span class="hljs-meta">#å¯åŠ¨ Docker åå°æœåŠ¡</span><br>service docker start<br><br><span class="hljs-meta">#æµ‹è¯•è¿è¡Œ hello-world,ç”±äºæœ¬åœ°æ²¡æœ‰hello-worldè¿™ä¸ªé•œåƒï¼Œæ‰€ä»¥ä¼šä¸‹è½½ä¸€ä¸ªhello-worldçš„é•œåƒï¼Œå¹¶åœ¨å®¹å™¨å†…è¿è¡Œã€‚</span><br>docker run hello-world<br></code></pre></td></tr></table></figure><h1 id="ä½¿ç”¨è„šæœ¬å®‰è£…-Docker"><a href="#ä½¿ç”¨è„šæœ¬å®‰è£…-Docker" class="headerlink" title="ä½¿ç”¨è„šæœ¬å®‰è£… Docker"></a>ä½¿ç”¨è„šæœ¬å®‰è£… Docker</h1><p>1ã€ä½¿ç”¨ sudo æˆ– root æƒé™ç™»å½• Centosã€‚ 2ã€ç¡®ä¿ yum åŒ…æ›´æ–°åˆ°æœ€æ–°ã€‚</p><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs vala"><span class="hljs-meta">#ç¡®ä¿ yum åŒ…æ›´æ–°åˆ°æœ€æ–°</span><br>sudo yum update<br><br><span class="hljs-meta">#æ‰§è¡Œ Docker å®‰è£…è„šæœ¬,æ‰§è¡Œè¿™ä¸ªè„šæœ¬ä¼šæ·»åŠ  docker.repo æºå¹¶å®‰è£… Dockerã€‚</span><br>curl -fsSL https:<span class="hljs-comment">//get.docker.com/ | sh</span><br><br><span class="hljs-meta">#å¯åŠ¨ Docker è¿›ç¨‹</span><br>sudo service docker start<br><br><span class="hljs-meta">#éªŒè¯ docker æ˜¯å¦å®‰è£…æˆåŠŸå¹¶åœ¨å®¹å™¨ä¸­æ‰§è¡Œä¸€ä¸ªæµ‹è¯•çš„é•œåƒ</span><br>sudo docker run hello-world<br></code></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹Dockerç‰ˆæœ¬"><a href="#æŸ¥çœ‹Dockerç‰ˆæœ¬" class="headerlink" title="æŸ¥çœ‹Dockerç‰ˆæœ¬"></a>æŸ¥çœ‹Dockerç‰ˆæœ¬</h2><p>docker version<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/WX20190828-091709@2x_1566955051972.png" alt="WX20190828-091709@2x"></p><p>åˆ°æ­¤å®‰è£…æˆåŠŸ æœ€åæ¨èä¸€æ¬¾ ç®¡ç†ç•Œé¢ ä¸ªäººä½¿ç”¨æ˜¯å…è´¹çš„ è¶³å¤Ÿå•¦<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/WX20190828-092421@2x_1566955505633.png" alt="WX20190828-092421@2x"></p><p><a href="https://bk.cuixiaoyan.xyz/archives/docker#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E7%94%A8docker">ä¸ºä»€ä¹ˆè¦ç”¨Docker</a><a href="https://bk.cuixiaoyan.xyz/archives/docker#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6">å‰ææ¡ä»¶</a><a href="https://bk.cuixiaoyan.xyz/archives/docker#%E4%BD%BF%E7%94%A8%E8%84%9A%E6%9C%AC%E5%AE%89%E8%A3%85-docker">ä½¿ç”¨è„šæœ¬å®‰è£… Docker</a><a href="https://bk.cuixiaoyan.xyz/archives/docker#%E6%9F%A5%E7%9C%8Bdocker%E7%89%88%E6%9C%AC">æŸ¥çœ‹Dockerç‰ˆæœ¬</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>docker</tag>
      
      <tag>centos</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>javaä¸­çš„æ•°å­¦å·¥å…·ç±»Math</title>
    <link href="/blog/2021/01/24/java%E4%B8%AD%E7%9A%84%E6%95%B0%E5%AD%A6%E5%B7%A5%E5%85%B7%E7%B1%BBMath/"/>
    <url>/blog/2021/01/24/java%E4%B8%AD%E7%9A%84%E6%95%B0%E5%AD%A6%E5%B7%A5%E5%85%B7%E7%B1%BBMath/</url>
    
    <content type="html"><![CDATA[<h1 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h1><p>java.util.Mathç±»æ˜¯æ•°å­¦ç›¸å…³çš„å·¥å…·ç±»ï¼Œé‡Œé¢æä¾›äº†å¤§é‡çš„é™æ€æ–¹æ³•ï¼Œå®Œæˆä¸æ•°å­¦è¿ç®—ç›¸å…³çš„æ“ä½œã€‚</p><h2 id="åŸºæœ¬çš„æ–¹æ³•"><a href="#åŸºæœ¬çš„æ–¹æ³•" class="headerlink" title="åŸºæœ¬çš„æ–¹æ³•"></a>åŸºæœ¬çš„æ–¹æ³•</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">double</span> <span class="hljs-title">abs</span><span class="hljs-params">(<span class="hljs-keyword">double</span> num)</span></span>;è·å–ç»å¯¹å€¼ã€‚æœ‰å¤šç§é‡è½½ï¼Œabsolutelyç»å¯¹åœ°<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">double</span> <span class="hljs-title">ceil</span><span class="hljs-params">(<span class="hljs-keyword">double</span> num)</span></span>;å‘ä¸Šå–æ•´ï¼Œceilæ˜¯å¤©èŠ±æ¿çš„æ„æ€<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">double</span> <span class="hljs-title">floor</span><span class="hljs-params">(<span class="hljs-keyword">double</span> num)</span></span>;å‘ä¸‹å–æ•´ï¼Œflooræ˜¯åœ°æ¿çš„æ„æ€<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">long</span> <span class="hljs-title">round</span><span class="hljs-params">(<span class="hljs-keyword">double</span> num)</span></span>;å››èˆå…­å…¥äº”æˆåŒï¼ˆçœ‹ä¸‹é¢ä»£ç çš„æ³¨é‡Šï¼‰ï¼Œroundæœ‰å¤§çº¦ï¼Œå®Œæ•´çš„æ„æ€<br> <br></code></pre></td></tr></table></figure><h2 id="å››ç§æ–¹æ³•ä¸€èµ·é€šè¿‡ä»£ç æ¼”ç¤ºä¸€é"><a href="#å››ç§æ–¹æ³•ä¸€èµ·é€šè¿‡ä»£ç æ¼”ç¤ºä¸€é" class="headerlink" title="å››ç§æ–¹æ³•ä¸€èµ·é€šè¿‡ä»£ç æ¼”ç¤ºä¸€é"></a>å››ç§æ–¹æ³•ä¸€èµ·é€šè¿‡ä»£ç æ¼”ç¤ºä¸€é</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MathMethod</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-comment">//absæ–¹æ³•ï¼Œå–ç»å¯¹å€¼</span><br>        System.out.println(Math.abs(<span class="hljs-number">3.14</span>)); <span class="hljs-comment">//3.14</span><br>        System.out.println(Math.abs(<span class="hljs-number">0</span>));    <span class="hljs-comment">//0</span><br>        System.out.println(Math.abs(-<span class="hljs-number">2.2</span>)); <span class="hljs-comment">//2.2</span><br> <br>        System.out.println(<span class="hljs-string">&quot;---------------------&quot;</span>);<br> <br>        <span class="hljs-comment">//ceilæ–¹æ³•ï¼Œå‘ä¸Šå–æ•´ï¼Œå¾€å¤§çš„é </span><br>        System.out.println(Math.ceil(<span class="hljs-number">3.2</span>));  <span class="hljs-comment">//4.0</span><br>        System.out.println(Math.ceil(<span class="hljs-number">3.8</span>));  <span class="hljs-comment">//4.0</span><br>        System.out.println(Math.ceil(-<span class="hljs-number">3.2</span>)); <span class="hljs-comment">//-3.0</span><br>        System.out.println(Math.ceil(-<span class="hljs-number">3.8</span>)); <span class="hljs-comment">//-3.0</span><br> <br>        System.out.println(<span class="hljs-string">&quot;---------------------&quot;</span>);<br>        <br>        <span class="hljs-comment">//flooræ–¹æ³•ï¼Œå‘ä¸‹å–æ•´ï¼Œå¾€å°çš„é </span><br>        System.out.println(Math.floor(<span class="hljs-number">3.2</span>));  <span class="hljs-comment">//3.0</span><br>        System.out.println(Math.floor(<span class="hljs-number">3.8</span>));  <span class="hljs-comment">//3.0</span><br>        System.out.println(Math.floor(-<span class="hljs-number">3.2</span>)); <span class="hljs-comment">//-4.0</span><br>        System.out.println(Math.floor(-<span class="hljs-number">3.8</span>)); <span class="hljs-comment">//-4.0</span><br> <br>        System.out.println(<span class="hljs-string">&quot;---------------------&quot;</span>);<br> <br>        <span class="hljs-comment">//ã€æ³¨æ„ï¼Œé¢è¯•é«˜é¢‘ã€‘roundæ–¹æ³•ï¼Œå››èˆ å…­å…¥ äº”æˆåŒ</span><br>        <span class="hljs-comment">//å…ˆçœ‹çœ‹å››èˆå…­å…¥ï¼Œå¦‚æœå‡ºç°è´Ÿæ•°ï¼Œå…ˆè½¬æˆæ­£æ•°ï¼Œå†å››èˆå…­å…¥ï¼Œæœ€ååŠ ä¸Šè´Ÿå·</span><br>        System.out.println(Math.round(<span class="hljs-number">3.4</span>));  <span class="hljs-comment">//3</span><br>        System.out.println(Math.round(<span class="hljs-number">3.6</span>));  <span class="hljs-comment">//4</span><br>        System.out.println(Math.round(-<span class="hljs-number">3.4</span>)); <span class="hljs-comment">//-3</span><br>        System.out.println(Math.round(-<span class="hljs-number">3.6</span>)); <span class="hljs-comment">//-4</span><br>        <span class="hljs-comment">//äº”æˆåŒæ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå½“å‡ºç°0.5ç»“å°¾çš„æ—¶å€™ï¼Œå°±ç»™å®ƒå†åŠ ä¸Š+0.5ï¼Œ5ä¸å°±æˆåŒäº†</span><br>        <span class="hljs-comment">//æ¥ç€å†å¯¹ç›¸åŠ çš„ç»“æœè¿›è¡Œfloorè¿ç®—</span><br>        System.out.println(Math.round(-<span class="hljs-number">2.5</span>));  <span class="hljs-comment">//-2</span><br>        System.out.println(Math.floor(-<span class="hljs-number">2.5</span> + <span class="hljs-number">0.5</span>));  <span class="hljs-comment">//ä¸Math.round(-2.5)ç»“æœä¸€è‡´</span><br> <br>System.out.println(Math.round(<span class="hljs-number">2.5</span>));  <span class="hljs-comment">//3</span><br>        System.out.println(Math.floor(<span class="hljs-number">2.5</span> + <span class="hljs-number">0.5</span>));  <span class="hljs-comment">//ä¸Math.round(2.5)ç»“æœä¸€è‡´</span><br>    &#125;<br>&#125;<br> <br></code></pre></td></tr></table></figure><h2 id="åœ†å‘¨ç‡Math-PI"><a href="#åœ†å‘¨ç‡Math-PI" class="headerlink" title="åœ†å‘¨ç‡Math.PI"></a>åœ†å‘¨ç‡Math.PI</h2><p>åœ¨Mathç±»çš„æºç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå®ƒè‡ªå®šä¹‰çš„åœ†å‘¨ç‡ PI = 3.14159265358979323846</p><p>ä»¥åçš„è®¡ç®—å¦‚æœéœ€è¦ç”¨åˆ°PIï¼Œå°½é‡ç”¨å·²ç»å®šä¹‰å¥½çš„åœ†å‘¨ç‡ï¼Œéå¸¸ç²¾ç¡®</p>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>å·¥å…·ç±»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>mysqlå…¥é—¨</title>
    <link href="/blog/2021/01/24/mysql%E5%85%A5%E9%97%A8/"/>
    <url>/blog/2021/01/24/mysql%E5%85%A5%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="ç´¢å¼•çš„æ¦‚å¿µ"><a href="#ç´¢å¼•çš„æ¦‚å¿µ" class="headerlink" title="ç´¢å¼•çš„æ¦‚å¿µ"></a>ç´¢å¼•çš„æ¦‚å¿µ</h1><p>æ˜¯æ•°æ®åº“å¯¹è±¡ï¼Œå®ç°æ•°æ®åº“çš„å¿«é€ŸæŸ¥è¯¢</p><p>ä½¿ç”¨ç´¢å¼•çš„åŸå› ï¼šå®ç°æ•°æ®åº“çš„å¿«é€ŸæŸ¥è¯¢ï¼Œæé«˜æŸ¥è¯¢é€Ÿåº¦</p><h1 id="ç´¢å¼•çš„åˆ†ç±»"><a href="#ç´¢å¼•çš„åˆ†ç±»" class="headerlink" title="ç´¢å¼•çš„åˆ†ç±»"></a>ç´¢å¼•çš„åˆ†ç±»</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs sql"> <br><span class="hljs-number">1</span>ï¼Œæ™®é€šç´¢å¼•<br>æœ€åŸºæœ¬çš„ç´¢å¼•ï¼Œå¯¹å­—æ®µæ•°æ®çš„ç±»å‹å’Œå€¼æ²¡æœ‰ä»»ä½•é™åˆ¶ï¼Œæ•°æ®ç±»å‹å¯ä»¥ä»»æ„ï¼Œå­—æ®µçš„å€¼å¯ä»¥ä¸ºç©ºä¹Ÿå¯ä»¥é‡å¤ã€‚<br> <br><span class="hljs-number">2</span>ï¼Œä¸»é”®ç´¢å¼•<br>ç»™ä¸»é”®å­—æ®µæ·»åŠ çš„ç´¢å¼•ã€<br>ä¸»é”®ç‰¹ç‚¹ï¼šå”¯ä¸€ä¸”éç©º<br> <br><span class="hljs-number">3</span>ï¼Œå”¯ä¸€ç´¢å¼•<br>ç»™å”¯ä¸€å­—æ®µæ·»åŠ çš„ç´¢å¼•<br>å”¯ä¸€ç´¢å¼•å’Œä¸»é”®ç´¢å¼•çš„åŒºåˆ«ï¼š<br>å”¯ä¸€ç´¢å¼•ï¼šåªæœ‰å”¯ä¸€ï¼Œå¯ä»¥æœ‰ç©ºå€¼<br>ä¸»é”®ç´¢å¼•ï¼šå”¯ä¸€ä¸”éç©º<br><br><span class="hljs-number">4</span>ï¼Œå…¨æ–‡ç´¢å¼•<br>é€‚ç”¨äºç»™ä¸€å¤§ä¸²æ–‡æœ¬æ·»åŠ çš„ç´¢å¼•ï¼Œåªå¯ä»¥ç»™å­—ç¬¦ä¸²æ•°æ®ç±»å‹æ·»åŠ <br>å­—ç¬¦ä¸²æ•°æ®ç±»å‹ï¼ˆ<span class="hljs-type">char</span> <span class="hljs-type">varchar</span> textï¼‰<br><br><span class="hljs-number">5</span>ï¼Œç©ºé—´ç´¢å¼•<br>å­—æ®µçš„æ•°æ®ç±»å‹åªèƒ½æ˜¯ç©ºé—´æ•°æ®ç±»å‹ï¼Œä¸”æ”¹å­—æ®µçš„å€¼å¿…é¡»ä¸º éç©º <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span><br>ç©ºé—´æ•°æ®ç±»å‹ geometry point linestring polygon<br><br><span class="hljs-number">6</span>ï¼Œå¤åˆç´¢å¼•<br>ç»™å¤šä¸ªå­—æ®µæ·»åŠ çš„ç´¢å¼•<br>æ³¨æ„ï¼šå¦‚æœä½¿ç”¨äº†å¤åˆç´¢å¼•ï¼ŒæŸ¥è¯¢æ¡ä»¶ä¸­åªæœ‰ä½¿ç”¨äº†ç¬¬ä¸€ä¸ªå­—æ®µï¼Œè¯¥ç´¢å¼•æ‰ä¼šè¢«è§¦å‘<br>ä¾‹å¦‚ï¼ˆid nameï¼‰åªæœ‰æŸ¥è¯¢æ¡ä»¶ä¸­ä½¿ç”¨äº†idå­—æ®µï¼Œç´¢å¼•æ‰ä¼šè¢«ä½¿ç”¨<br>å¦‚æœæŸ¥è¯¢æ¡ä»¶åªæœ‰nameå­—æ®µï¼Œåˆ™ç´¢å¼•ä¸ä¼šè¢«è§¦å‘<br> <br></code></pre></td></tr></table></figure><h1 id="åˆ›å»ºç´¢å¼•"><a href="#åˆ›å»ºç´¢å¼•" class="headerlink" title="åˆ›å»ºç´¢å¼•"></a>åˆ›å»ºç´¢å¼•</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span>ï¼Œè‡ªåŠ¨åˆ›å»ºç´¢å¼•<br>åœ¨åˆ›å»ºè¡¨çš„æ—¶å€™ï¼Œç»™è¡¨æ·»åŠ äº†ä¸»é”®å’Œå”¯ä¸€çº¦æŸæ—¶ï¼Œæ•°æ®åº“ç»™è‡ªåŠ¨çš„ç»™ä¸»é”®çº¦æŸå’Œå”¯ä¸€çº¦æŸåˆ›å»ºå¯¹åº”çš„ä¸»é”®ç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> index_student(<br>sno <span class="hljs-type">int</span>(<span class="hljs-number">8</span>) <span class="hljs-keyword">primary</span> <span class="hljs-keyword">key</span> auto_increment,<br>sname <span class="hljs-type">varchar</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">unique</span>,<br>age <span class="hljs-type">int</span>(<span class="hljs-number">2</span>)<br>);<br>æŸ¥è¯¢è¡¨ä¸­çš„ç´¢å¼•è¯­æ³•ä¸ºï¼š<span class="hljs-keyword">show</span> index <span class="hljs-keyword">from</span> è¡¨å<br><span class="hljs-keyword">show</span> index <span class="hljs-keyword">from</span> index_student;<br><br><span class="hljs-number">2</span>ï¼Œæ‰‹åŠ¨åˆ›å»ºç´¢å¼•<br> <br>aï¼Œåˆ›å»ºè¡¨æ—¶åˆ›å»ºç´¢å¼•<br><br><br><span class="hljs-number">1</span>ï¼Œåˆ›å»ºæ™®é€šç´¢å¼•ã€<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> è¡¨å(<br>å­—æ®µå<span class="hljs-number">1</span> å­—æ®µç±»å‹<span class="hljs-number">1</span>,<br>....,<br>index<span class="hljs-operator">|</span>key [ç´¢å¼•å] [ç´¢å¼•ç±»å‹] (å­—æ®µå[(é•¿åº¦)] [<span class="hljs-keyword">asc</span><span class="hljs-operator">|</span><span class="hljs-keyword">desc</span>])<br>);<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> index_student(<br>sno <span class="hljs-type">int</span>(<span class="hljs-number">8</span>),<br>sname <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>),<br>age <span class="hljs-type">int</span>(<span class="hljs-number">2</span>),<br>index (sno)<br>);<br><span class="hljs-keyword">show</span> index <span class="hljs-keyword">from</span> index_student;<br> <br><br><span class="hljs-number">2</span>ï¼Œå”¯ä¸€ç´¢å¼•çš„åˆ›å»º<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> è¡¨å(<br>å­—æ®µå<span class="hljs-number">1</span> å­—æ®µç±»å‹<span class="hljs-number">1</span>,<br>....,<br><span class="hljs-keyword">unique</span> index<span class="hljs-operator">|</span>key [ç´¢å¼•å] [ç´¢å¼•ç±»å‹] (å­—æ®µå[(é•¿åº¦)] [<span class="hljs-keyword">asc</span><span class="hljs-operator">|</span><span class="hljs-keyword">desc</span>])<br>);<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> index_student(<br>sno <span class="hljs-type">int</span>(<span class="hljs-number">8</span>),<br>sname <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>),<br>age <span class="hljs-type">int</span>(<span class="hljs-number">2</span>),<br><span class="hljs-keyword">unique</span> index (sno)<br>);<br><span class="hljs-keyword">show</span> index <span class="hljs-keyword">from</span> index_student;<br> <br> <br><span class="hljs-number">3</span>ï¼Œåˆ›å»ºä¸»é”®ç´¢å¼•<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span>è¡¨å(<br>å­—æ®µå<span class="hljs-number">1</span> å­—æ®µç±»å‹<span class="hljs-number">1</span>,<br>....,<br><span class="hljs-keyword">primary</span> index<span class="hljs-operator">|</span>key [ç´¢å¼•å] [ç´¢å¼•ç±»å‹] (å­—æ®µå[(é•¿åº¦)] [<span class="hljs-keyword">asc</span><span class="hljs-operator">|</span><span class="hljs-keyword">desc</span>])<br>);<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> index_student(<br>sno <span class="hljs-type">int</span>(<span class="hljs-number">8</span>),<br>sname <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>),<br>age <span class="hljs-type">int</span>(<span class="hljs-number">2</span>),<br><span class="hljs-keyword">primary</span> <span class="hljs-keyword">key</span> (sno)<br>);<br><span class="hljs-keyword">show</span> index <span class="hljs-keyword">from</span> index_student;<br> <br> <br> <br><span class="hljs-number">4</span>ï¼Œåˆ›å»ºå…¨æ–‡ç´¢å¼•ã€åªæœ‰ï¼šåªèƒ½ç»™å­—ç¬¦ä¸²æ•°æ®ç±»å‹æ·»åŠ <br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> è¡¨å(<br>å­—æ®µå<span class="hljs-number">1</span> å­—æ®µç±»å‹<span class="hljs-number">1</span>,<br>....,<br>fulltext index<span class="hljs-operator">|</span>key [ç´¢å¼•å] [ç´¢å¼•ç±»å‹] (å­—æ®µå[(é•¿åº¦)] [<span class="hljs-keyword">asc</span><span class="hljs-operator">|</span><span class="hljs-keyword">desc</span>])<br>);<br><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> index_student(<br>sno <span class="hljs-type">int</span>(<span class="hljs-number">8</span>),<br>sname <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>),<br>age <span class="hljs-type">int</span>(<span class="hljs-number">2</span>),<br>sinfo <span class="hljs-type">varchar</span>(<span class="hljs-number">200</span>),<br>fulltext key (sinfo)<br>);<br><span class="hljs-keyword">show</span> index <span class="hljs-keyword">from</span> index_student;<br> <br> <br> <br><span class="hljs-number">5</span>ï¼Œåˆ›å»ºå¤åˆç´¢å¼•<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> è¡¨å(<br>å­—æ®µå<span class="hljs-number">1</span> å­—æ®µç±»å‹<span class="hljs-number">1</span>,<br>....,<br>index<span class="hljs-operator">|</span>key [ç´¢å¼•å] [ç´¢å¼•ç±»å‹] (å­—æ®µå<span class="hljs-number">1</span>[(é•¿åº¦)] [<span class="hljs-keyword">asc</span><span class="hljs-operator">|</span><span class="hljs-keyword">desc</span>], å­—æ®µå<span class="hljs-number">2</span>[(é•¿åº¦)] [<span class="hljs-keyword">asc</span><span class="hljs-operator">|</span><span class="hljs-keyword">desc</span>], å­—æ®µå<span class="hljs-number">3</span>[(é•¿åº¦)] [<span class="hljs-keyword">asc</span><span class="hljs-operator">|</span><span class="hljs-keyword">desc</span>])<br>);<br><br><span class="hljs-comment">---åˆ›å»ºè¡¨index_student,ç»™sno å’Œ sname æ·»åŠ å¤åˆç´¢å¼•</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> index_student(<br>sno <span class="hljs-type">int</span>(<span class="hljs-number">8</span>),<br>sname <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>),<br>age <span class="hljs-type">int</span>(<span class="hljs-number">2</span>),<br>sinfo <span class="hljs-type">varchar</span>(<span class="hljs-number">200</span>),<br>index (sno,sname)<br>);<br> <br><span class="hljs-keyword">show</span> index <span class="hljs-keyword">from</span> index_student;<br> <br> <br><span class="hljs-number">6</span>ï¼Œåˆ›å»ºç©ºé—´ç´¢å¼•<br>æ³¨æ„ï¼šåªèƒ½ç»™ç©ºé—´æ•°æ®ç±»å‹æ·»åŠ ï¼Œä¸”è¯¥å­—æ®µçš„å€¼ä¸èƒ½ä¸ºç©º <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> è¡¨å(<br>å­—æ®µå<span class="hljs-number">1</span> å­—æ®µç±»å‹<span class="hljs-number">1</span>,<br>....,<br>spatial index<span class="hljs-operator">|</span>key [ç´¢å¼•å] [ç´¢å¼•ç±»å‹] (å­—æ®µå[(é•¿åº¦)] [<span class="hljs-keyword">asc</span><span class="hljs-operator">|</span><span class="hljs-keyword">desc</span>])<br>);<br><br><span class="hljs-comment">---åˆ›å»ºè¡¨index_student,ç»™slocå­—æ®µï¼ˆæ˜¯pointå­—æ®µç±»å‹ï¼‰æ·»åŠ ç©ºé—´ç´¢å¼•</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> index_student(<br>sno <span class="hljs-type">int</span>(<span class="hljs-number">8</span>),<br>sname <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>),<br>age <span class="hljs-type">int</span>(<span class="hljs-number">2</span>),<br>sinfo <span class="hljs-type">varchar</span>(<span class="hljs-number">200</span>),<br>sloc point <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,<br>spatial index (sloc)<br>);<br><br><span class="hljs-keyword">show</span> index <span class="hljs-keyword">from</span> index_student;<br> <br><br>bï¼Œåˆ›å»ºè¡¨åä½¿ç”¨â€œ<span class="hljs-keyword">create</span> index â€åˆ›å»ºç´¢å¼•<br><span class="hljs-keyword">create</span> [ <span class="hljs-keyword">unique</span><span class="hljs-operator">|</span>fulltext<span class="hljs-operator">|</span>spatial ] index ç´¢å¼•åç§° [ç´¢å¼•çš„ç±»å‹] <span class="hljs-keyword">on</span> è¡¨å (å­—æ®µå<span class="hljs-number">1</span>[(é•¿åº¦)] [<span class="hljs-keyword">asc</span><span class="hljs-operator">|</span><span class="hljs-keyword">desc</span>], å­—æ®µå<span class="hljs-number">2</span>[(é•¿åº¦)] [<span class="hljs-keyword">asc</span><span class="hljs-operator">|</span><span class="hljs-keyword">desc</span>])<br> <br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šä½¿ç”¨<span class="hljs-keyword">create</span> indexè¿™ç§åˆ›å»ºç´¢å¼•çš„æ–¹å¼ä¸èƒ½åˆ›å»ºä¸»é”®ç´¢å¼•<br> <br>(<span class="hljs-number">1</span>)ï¼Œåˆ›å»ºæ™®é€šç´¢å¼•<br><span class="hljs-comment">---åˆ›å»ºè¡¨index_student,ç»™è¡¨snoæ·»åŠ æ™®é€šç´¢å¼•</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> index_student(<br>sname <span class="hljs-type">varchar</span>(<span class="hljs-number">8</span>),<br>sno <span class="hljs-type">int</span>(<span class="hljs-number">5</span>),<br>age <span class="hljs-type">int</span>(<span class="hljs-number">2</span>)<br>);<br><span class="hljs-keyword">create</span> index index_student_sno <span class="hljs-keyword">on</span> index_student (sno);<br><span class="hljs-keyword">show</span> index <span class="hljs-keyword">from</span> index_student;<br> <br> <br>(<span class="hljs-number">2</span>)ï¼Œåˆ›å»ºå”¯ä¸€ç´¢å¼•<br><span class="hljs-comment">---åˆ›å»ºè¡¨index_student,ç»™è¡¨snameæ·»åŠ å”¯ä¸€ç´¢å¼•</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> index_student(<br>sname <span class="hljs-type">varchar</span>(<span class="hljs-number">8</span>),<br>sno <span class="hljs-type">int</span>(<span class="hljs-number">5</span>),<br>age <span class="hljs-type">int</span>(<span class="hljs-number">2</span>)<br>);<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">unique</span> index index_student_sname <span class="hljs-keyword">on</span> index_student (sname);<br><span class="hljs-keyword">show</span> index <span class="hljs-keyword">from</span> index_student;<br> <br> <br>(<span class="hljs-number">3</span>)ï¼Œåˆ›å»ºå…¨æ–‡ç´¢å¼• fulltext<br><span class="hljs-comment">---åˆ›å»ºè¡¨index_student,ç»™è¡¨sinfoæ·»åŠ å…¨æ–‡ç´¢å¼•</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> index_student(<br>sname <span class="hljs-type">varchar</span>(<span class="hljs-number">8</span>),<br>sno <span class="hljs-type">int</span>(<span class="hljs-number">5</span>),<br>age <span class="hljs-type">int</span>(<span class="hljs-number">2</span>),<br>sinfo <span class="hljs-type">varchar</span>(<span class="hljs-number">200</span>)<br>);<br><span class="hljs-keyword">create</span> fulltext index index_student_sinfo <span class="hljs-keyword">on</span> index_student (sinfo);<br><span class="hljs-keyword">show</span> index <span class="hljs-keyword">from</span> index_student;<br><br> <br>(<span class="hljs-number">4</span>)ï¼Œåˆ›å»ºç©ºé—´ç´¢å¼•<br><span class="hljs-comment">---åˆ›å»ºè¡¨index_student,ç»™è¡¨slocæ·»åŠ ç©ºé—´ç´¢å¼•</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> index_student(<br>sname <span class="hljs-type">varchar</span>(<span class="hljs-number">8</span>),<br>sno <span class="hljs-type">int</span>(<span class="hljs-number">5</span>),<br>age <span class="hljs-type">int</span>(<span class="hljs-number">2</span>),<br>sloc point <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span><br>);<br><span class="hljs-keyword">create</span> spatial index index_student_sloc <span class="hljs-keyword">on</span> index_student (sloc);<br><span class="hljs-keyword">show</span> index <span class="hljs-keyword">from</span> index_student;<br> <br> <br>(<span class="hljs-number">5</span>)ï¼Œåˆ›å»ºå¤åˆç´¢å¼•<br><span class="hljs-comment">---åˆ›å»ºè¡¨index_student,ç»™è¡¨snoå’Œsnameæ·»åŠ å¤åˆç´¢å¼•</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> index_student(<br>sname <span class="hljs-type">varchar</span>(<span class="hljs-number">8</span>),<br>sno <span class="hljs-type">int</span>(<span class="hljs-number">5</span>),<br>age <span class="hljs-type">int</span>(<span class="hljs-number">2</span>)<br>);<br><span class="hljs-keyword">create</span> index index_student_sno_sname <span class="hljs-keyword">on</span> index_student (sno, sname);<br><span class="hljs-keyword">show</span> index <span class="hljs-keyword">from</span> index_student;<br> <br> <br>cï¼Œç»™å·²æœ‰è¡¨æ·»åŠ ç´¢å¼•â€œ<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span>â€<br><br>(<span class="hljs-number">1</span>)æ·»åŠ æ™®é€šç´¢å¼•<br>è¯­æ³•ä¸ºï¼š<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> è¡¨å <span class="hljs-keyword">add</span> index<span class="hljs-operator">|</span>key [ç´¢å¼•å] [ç´¢å¼•ç±»å‹] (å­—æ®µå [é•¿åº¦] [<span class="hljs-keyword">asc</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">desc</span>])<br><span class="hljs-comment">---åˆ›å»ºè¡¨index_student,ç»™è¡¨snoæ·»åŠ æ™®é€šç´¢å¼•</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> index_student(<br>sname <span class="hljs-type">varchar</span>(<span class="hljs-number">8</span>),<br>sno <span class="hljs-type">int</span>(<span class="hljs-number">5</span>),<br>age <span class="hljs-type">int</span>(<span class="hljs-number">2</span>)<br>);<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> index_student <span class="hljs-keyword">add</span> index (sno)<br><span class="hljs-keyword">show</span> index <span class="hljs-keyword">from</span> index_student;<br> <br> <br>(<span class="hljs-number">2</span>)æ·»åŠ å”¯ä¸€ç´¢å¼•<br>è¯­æ³•ä¸ºï¼š<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> è¡¨å <span class="hljs-keyword">add</span> <span class="hljs-keyword">unique</span> [index<span class="hljs-operator">|</span>key] [ç´¢å¼•å] [ç´¢å¼•ç±»å‹] (å­—æ®µå [é•¿åº¦] [<span class="hljs-keyword">asc</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">desc</span>])<br><span class="hljs-comment">---åˆ›å»ºè¡¨index_student,ç»™è¡¨snameæ·»åŠ å”¯ä¸€ç´¢å¼•</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> index_student(<br>sname <span class="hljs-type">varchar</span>(<span class="hljs-number">8</span>),<br>sno <span class="hljs-type">int</span>(<span class="hljs-number">5</span>),<br>age <span class="hljs-type">int</span>(<span class="hljs-number">2</span>)<br>);<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> index_student <span class="hljs-keyword">add</span> <span class="hljs-keyword">unique</span> index (sname);<br><span class="hljs-keyword">show</span> index <span class="hljs-keyword">from</span> index_student;<br> <br> <br>(<span class="hljs-number">3</span>)æ·»åŠ ä¸»é”®ç´¢å¼•<br>è¯­æ³•ä¸ºï¼š<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> è¡¨å <span class="hljs-keyword">add</span> <span class="hljs-keyword">primary</span> <span class="hljs-keyword">key</span> [index<span class="hljs-operator">|</span>key] [ç´¢å¼•å] [ç´¢å¼•ç±»å‹] (å­—æ®µå [é•¿åº¦] [<span class="hljs-keyword">asc</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">desc</span>])<br><span class="hljs-comment">---åˆ›å»ºè¡¨index_student,ç»™è¡¨snoæ·»åŠ ä¸»é”®ç´¢å¼•</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> index_student(<br>sname <span class="hljs-type">varchar</span>(<span class="hljs-number">8</span>),<br>sno <span class="hljs-type">int</span>(<span class="hljs-number">5</span>),<br>age <span class="hljs-type">int</span>(<span class="hljs-number">2</span>)<br>);<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> index_student <span class="hljs-keyword">add</span> <span class="hljs-keyword">primary</span> <span class="hljs-keyword">key</span> (sno);<br><span class="hljs-keyword">show</span> index <span class="hljs-keyword">from</span> index_student;<br><br><br>(<span class="hljs-number">4</span>)æ·»åŠ å…¨æ–‡ç´¢å¼•<br>è¯­æ³•ä¸ºï¼š<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> è¡¨å <span class="hljs-keyword">add</span> fulltext [index<span class="hljs-operator">|</span>key] [ç´¢å¼•å] [ç´¢å¼•ç±»å‹] (å­—æ®µå [é•¿åº¦] [<span class="hljs-keyword">asc</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">desc</span>])<br><span class="hljs-comment">---åˆ›å»ºè¡¨index_student,ç»™è¡¨sinfoæ·»åŠ å…¨æ–‡ç´¢å¼•</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> index_student(<br>sname <span class="hljs-type">varchar</span>(<span class="hljs-number">8</span>),<br>sno <span class="hljs-type">int</span>(<span class="hljs-number">5</span>),<br>age <span class="hljs-type">int</span>(<span class="hljs-number">2</span>),<br>sinfo <span class="hljs-type">varchar</span>(<span class="hljs-number">200</span>)<br>);<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> index_student <span class="hljs-keyword">add</span> fulltext index(sinfo);<br><span class="hljs-keyword">show</span> index <span class="hljs-keyword">from</span> index_student;<br> <br> <br>(<span class="hljs-number">5</span>)æ·»åŠ ç©ºé—´ç´¢å¼•<br>è¯­æ³•ä¸ºï¼š<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> è¡¨å <span class="hljs-keyword">add</span> spatial [index<span class="hljs-operator">|</span>key] [ç´¢å¼•å] [ç´¢å¼•ç±»å‹] (å­—æ®µå [é•¿åº¦] [<span class="hljs-keyword">asc</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">desc</span>])<br><span class="hljs-comment">---åˆ›å»ºè¡¨index_student,ç»™è¡¨slocæ·»åŠ ç©ºé—´ç´¢å¼•</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> index_student(<br>sname <span class="hljs-type">varchar</span>(<span class="hljs-number">8</span>),<br>sno <span class="hljs-type">int</span>(<span class="hljs-number">5</span>),<br>age <span class="hljs-type">int</span>(<span class="hljs-number">2</span>),<br>sloc point <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span><br>);<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> index_student <span class="hljs-keyword">add</span> spatial index (sloc);<br><span class="hljs-keyword">show</span> index <span class="hljs-keyword">from</span> index_student;<br> <br> <br>(<span class="hljs-number">6</span>)æ·»åŠ å¤åˆç´¢å¼•<br>è¯­æ³•ä¸ºï¼š<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> è¡¨å <span class="hljs-keyword">add</span> index<span class="hljs-operator">|</span>key [ç´¢å¼•å] [ç´¢å¼•ç±»å‹] (å­—æ®µå<span class="hljs-number">1</span> [é•¿åº¦] [<span class="hljs-keyword">asc</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">desc</span>], å­—æ®µå<span class="hljs-number">2</span> [é•¿åº¦] [<span class="hljs-keyword">asc</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">desc</span>])<br><span class="hljs-comment">---åˆ›å»ºè¡¨index_student,ç»™è¡¨snoå’Œsnameæ·»åŠ å¤åˆç´¢å¼•</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> index_student(<br>sname <span class="hljs-type">varchar</span>(<span class="hljs-number">8</span>),<br>sno <span class="hljs-type">int</span>(<span class="hljs-number">5</span>),<br>age <span class="hljs-type">int</span>(<span class="hljs-number">2</span>)<br>);<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> index_student <span class="hljs-keyword">add</span> index (sno,sname);<br><span class="hljs-keyword">show</span> index <span class="hljs-keyword">from</span> index_student;<br> <br> <br></code></pre></td></tr></table></figure><h1 id="åˆ é™¤ç´¢å¼•"><a href="#åˆ é™¤ç´¢å¼•" class="headerlink" title="åˆ é™¤ç´¢å¼•"></a>åˆ é™¤ç´¢å¼•</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span>ï¼Œä½¿ç”¨<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> åˆ é™¤<br>è¯­æ³•ä¸º<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> è¡¨å <span class="hljs-keyword">drop</span> index<span class="hljs-operator">|</span>key ç´¢å¼•åç§°<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> index_student <span class="hljs-keyword">drop</span> index sno;<br><br><span class="hljs-number">2</span>ï¼Œä½¿ç”¨<span class="hljs-keyword">drop</span> index åˆ é™¤<br>è¯­æ³•ä¸º<span class="hljs-keyword">drop</span> index ç´¢å¼•åç§° <span class="hljs-keyword">on</span> è¡¨å<br><br>æ³¨æ„ï¼šä½¿ç”¨<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> æ–¹å¼ä¸èƒ½åˆ é™¤ä¸»é”®ç´¢å¼•<br>  åˆ é™¤ä¸»é”®ç´¢å¼•çš„æ–¹å¼ä¸ºï¼š<br>  a,<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> è¡¨å <span class="hljs-keyword">drop</span> <span class="hljs-keyword">primary</span> <span class="hljs-keyword">key</span><br>  b,ä½¿ç”¨<span class="hljs-keyword">drop</span> indexè¿›è¡Œåˆ é™¤<br> <br></code></pre></td></tr></table></figure><h1 id="æ•°æ®çš„æ’å…¥"><a href="#æ•°æ®çš„æ’å…¥" class="headerlink" title="æ•°æ®çš„æ’å…¥"></a>æ•°æ®çš„æ’å…¥</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><code class="hljs sql">(<span class="hljs-number">1</span>)ä¸ºæ‰€æœ‰å­—æ®µæ’å…¥æ•°æ®<br>è¯­æ³•ä¸ºï¼š<span class="hljs-keyword">insert</span> [<span class="hljs-keyword">into</span>] è¡¨å [(å­—æ®µå<span class="hljs-number">1</span>,å­—æ®µå<span class="hljs-number">2</span>,å­—æ®µå<span class="hljs-number">3</span>,....)] <span class="hljs-keyword">values</span><span class="hljs-operator">|</span><span class="hljs-keyword">value</span> (å€¼<span class="hljs-number">1</span>,å€¼<span class="hljs-number">2</span>,å€¼<span class="hljs-number">3.</span>...)<br><br><span class="hljs-comment">---åˆ›å»ºä¸€å¼ è¡¨studentï¼ˆsnoä¸»é”® è‡ªåŠ¨å¢é•¿ sname éç©º age sexé»˜è®¤ç”· emailå”¯ä¸€ï¼‰</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> student(<br>sno <span class="hljs-type">int</span>(<span class="hljs-number">8</span>) <span class="hljs-keyword">primary</span> <span class="hljs-keyword">key</span> auto_increment,<br>sname <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,<br>age <span class="hljs-type">int</span>(<span class="hljs-number">8</span>),<br>sex <span class="hljs-type">varchar</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">default</span> &quot;ç”·&quot;,<br>email <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">unique</span><br>);<br><span class="hljs-comment">---ä¸ºè¡¨ä¸­æ‰€æœ‰å­—æ®µæ’å…¥æ•°æ®</span><br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> student (sno,sname,age,sex,email) <span class="hljs-keyword">values</span> (<span class="hljs-number">1</span>,&quot;å¼ ä¸‰&quot;, <span class="hljs-number">20</span>, &quot;ç”·&quot;, &quot;zhangsan@163.com&quot;);<br><br><span class="hljs-comment">---å¦ä¸€ç§å†™æ³•è¡¨åé¢ä¸å†™å­—æ®µåï¼Œåˆ™æ’å…¥å€¼çš„é¡ºåºè¦ä¸è¡¨ç»“æ„ç›¸åŒ</span><br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> student <span class="hljs-keyword">values</span> (<span class="hljs-number">2</span>,&quot;æå››&quot;, <span class="hljs-number">21</span>, &quot;å¥³&quot;, &quot;lisi@163.com&quot;);<br><span class="hljs-comment">---æŸ¥è¯¢è¡¨studentä¸­çš„æ•°æ®</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> student;<br> <br> <br> <br>(<span class="hljs-number">2</span>)ä¸ºæŒ‡å®šå­—æ®µæ’å…¥æ•°æ®<br>è¯­æ³•ä¸ºï¼š<span class="hljs-keyword">insert</span> [<span class="hljs-keyword">into</span>] è¡¨å (å­—æ®µå<span class="hljs-number">1</span>,å­—æ®µå<span class="hljs-number">2</span>,å­—æ®µå<span class="hljs-number">3</span>,....) <span class="hljs-keyword">values</span><span class="hljs-operator">|</span><span class="hljs-keyword">value</span> (å€¼<span class="hljs-number">1</span>,å€¼<span class="hljs-number">2</span>,å€¼<span class="hljs-number">3.</span>...)<br><br><span class="hljs-comment">---åˆ›å»ºä¸€å¼ è¡¨studentï¼ˆsnoä¸»é”® è‡ªåŠ¨å¢é•¿ sname éç©º age sexé»˜è®¤ç”· emailå”¯ä¸€ï¼‰</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> student(<br>sno <span class="hljs-type">int</span>(<span class="hljs-number">8</span>) <span class="hljs-keyword">primary</span> <span class="hljs-keyword">key</span> auto_increment,<br>sname <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,<br>age <span class="hljs-type">int</span>(<span class="hljs-number">8</span>),<br>sex <span class="hljs-type">varchar</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">default</span> &quot;ç”·&quot;,<br>email <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">unique</span><br>);<br><span class="hljs-comment">---ç»™è¡¨ä¸­snameå’Œageæ’å…¥æ•°æ®</span><br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> student (sname,age) <span class="hljs-keyword">values</span> (&quot;ç‹äº”&quot;, <span class="hljs-number">18</span>);<br><br><span class="hljs-comment">---æŸ¥è¯¢è¡¨studentä¸­çš„æ•°æ®</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> student;<br> <br> <br>(<span class="hljs-number">3</span>)ä½¿ç”¨<span class="hljs-keyword">SET</span>æ–¹å¼æ’å…¥æ•°æ®<br>è¯­æ³•ä¸ºï¼š<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> è¡¨å <span class="hljs-keyword">set</span> å­—æ®µå<span class="hljs-number">1</span><span class="hljs-operator">=</span>å­—æ®µå€¼<span class="hljs-number">1</span>,å­—æ®µå<span class="hljs-number">2</span><span class="hljs-operator">=</span>å­—æ®µå€¼<span class="hljs-number">2</span>,....;<br><br><span class="hljs-comment">---åˆ›å»ºä¸€å¼ è¡¨studentï¼ˆsnoä¸»é”® è‡ªåŠ¨å¢é•¿ sname éç©º age sexé»˜è®¤ç”· emailå”¯ä¸€ï¼‰</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> student(<br>sno <span class="hljs-type">int</span>(<span class="hljs-number">8</span>) <span class="hljs-keyword">primary</span> <span class="hljs-keyword">key</span> auto_increment,<br>sname <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,<br>age <span class="hljs-type">int</span>(<span class="hljs-number">8</span>),<br>sex <span class="hljs-type">varchar</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">default</span> &quot;ç”·&quot;,<br>email <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">unique</span><br>);<br><span class="hljs-comment">---ä½¿ç”¨setæ–¹å¼ç»™è¡¨ä¸­æ‰€æœ‰å­—æ®µæ’å…¥æ•°æ®</span><br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> student <span class="hljs-keyword">set</span> sno<span class="hljs-operator">=</span><span class="hljs-number">4</span>,sname<span class="hljs-operator">=</span>&quot;çš®çš®&quot;,age<span class="hljs-operator">=</span><span class="hljs-number">17</span>,sex<span class="hljs-operator">=</span>&quot;ç”·&quot;,email<span class="hljs-operator">=</span>&quot;pipi@16.com&quot;;<br><br><span class="hljs-comment">---ä½¿ç”¨setæ–¹å¼ç»™æŒ‡å®šçš„å­—æ®µæ’å…¥æ•°æ®</span><br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> student <span class="hljs-keyword">set</span> sname<span class="hljs-operator">=</span>&quot;å½¬å½¬&quot;,age<span class="hljs-operator">=</span><span class="hljs-number">2</span>,email<span class="hljs-operator">=</span>&quot;binbin@163.com&quot;;<br><br><span class="hljs-comment">---æŸ¥è¯¢è¡¨studentä¸­çš„æ•°æ®</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> student;<br><br> <br>(<span class="hljs-number">4</span>)åŒæ—¶æ’å…¥å¤šæ¡æ•°æ®<br>è¯­æ³•ä¸ºï¼š<span class="hljs-keyword">insert</span> [<span class="hljs-keyword">into</span>] è¡¨å [(å­—æ®µå<span class="hljs-number">1</span>,å­—æ®µå<span class="hljs-number">2</span>,å­—æ®µå<span class="hljs-number">3</span>,....)] <span class="hljs-keyword">values</span><span class="hljs-operator">|</span><span class="hljs-keyword">value</span> (å€¼<span class="hljs-number">1</span>,å€¼<span class="hljs-number">2</span>,å€¼<span class="hljs-number">3.</span>...),(å€¼<span class="hljs-number">1</span>,å€¼<span class="hljs-number">2</span>,å€¼<span class="hljs-number">3.</span>...),....;<br><br><span class="hljs-comment">---åˆ›å»ºä¸€å¼ è¡¨studentï¼ˆsnoä¸»é”® è‡ªåŠ¨å¢é•¿ sname éç©º age sexé»˜è®¤ç”· emailå”¯ä¸€ï¼‰</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> student(<br>sno <span class="hljs-type">int</span>(<span class="hljs-number">8</span>) <span class="hljs-keyword">primary</span> <span class="hljs-keyword">key</span> auto_increment,<br>sname <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,<br>age <span class="hljs-type">int</span>(<span class="hljs-number">8</span>),<br>sex <span class="hljs-type">varchar</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">default</span> &quot;ç”·&quot;,<br>email <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">unique</span><br>);<br><br><span class="hljs-comment">---ç»™æ‰€æœ‰å­—æ®µæ’å…¥å¤šæ¡æ•°æ®</span><br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> student (sno,sname,age,sex,email) <br><span class="hljs-keyword">values</span> (<span class="hljs-number">6</span>,&quot;å°çº¢&quot;,<span class="hljs-number">15</span>,&quot;å¥³&quot;,&quot;xiaohong@163.com&quot;),(<span class="hljs-number">7</span>,&quot;å°äºŒ&quot;,<span class="hljs-number">17</span>,&quot;ç”·&quot;,&quot;xiaoer@163.com&quot;);<br><br><span class="hljs-comment">---ç»™æŒ‡å®šå­—æ®µæ’å…¥å¤šæ¡æ•°æ®</span><br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> student (sname,age,email) <br><span class="hljs-keyword">values</span> (&quot;å°èŠ±&quot;,<span class="hljs-number">14</span>,&quot;xiaohua@163.com&quot;),(&quot;å°å¼º&quot;,<span class="hljs-number">11</span>,&quot;xiaoqiang@163.com&quot;);<br><br><span class="hljs-comment">---æŸ¥è¯¢è¡¨studentä¸­çš„æ•°æ®</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> student;<br> <br> <br> <br>(<span class="hljs-number">5</span>)æ’å…¥æŸ¥è¯¢ç»“æœ<br>è¯­æ³•ä¸ºï¼š<span class="hljs-keyword">insert</span> [<span class="hljs-keyword">into</span>] è¡¨å (å­—æ®µå<span class="hljs-number">1</span>,å­—æ®µå<span class="hljs-number">2</span>,å­—æ®µå<span class="hljs-number">3</span>,....) <span class="hljs-keyword">select</span> å­—æ®µå<span class="hljs-number">1</span>,å­—æ®µå<span class="hljs-number">2</span>,å­—æ®µå<span class="hljs-number">3.</span>....<span class="hljs-keyword">from</span> è¡¨ <span class="hljs-keyword">where</span> æ¡ä»¶;<br>æ³¨æ„ï¼šæ’å…¥è¡¨çš„å­—æ®µå’ŒæŸ¥è¯¢çš„å­—æ®µä¸ªæ•°å’Œç±»å‹è¦ä¿æŒä¸€è‡´<br><br><span class="hljs-comment">---åˆ›å»ºä¸€å¼ è¡¨studentï¼ˆsnoä¸»é”® è‡ªåŠ¨å¢é•¿ sname éç©º age sexé»˜è®¤ç”· emailå”¯ä¸€ï¼‰</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> student(<br>sno <span class="hljs-type">int</span>(<span class="hljs-number">8</span>) <span class="hljs-keyword">primary</span> <span class="hljs-keyword">key</span> auto_increment,<br>sname <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,<br>age <span class="hljs-type">int</span>(<span class="hljs-number">8</span>),<br>sex <span class="hljs-type">varchar</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">default</span> &quot;ç”·&quot;,<br>email <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">unique</span><br>);<br><br><span class="hljs-comment">---åˆ›å»ºt_studentè¡¨</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> t_student(<br>sno <span class="hljs-type">int</span>(<span class="hljs-number">8</span>) <span class="hljs-keyword">primary</span> <span class="hljs-keyword">key</span> auto_increment,<br>sname <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,<br>age <span class="hljs-type">int</span>(<span class="hljs-number">8</span>),<br>sex <span class="hljs-type">varchar</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">default</span> &quot;å¥³&quot;,<br>email <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">unique</span><br>);<br><br><span class="hljs-comment">---å°†studentè¡¨ä¸­çš„æ•°æ®æŸ¥è¯¢ç»“æœæ’å…¥åˆ°t_studentè¡¨ä¸­</span><br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t_student <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> student;<br><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t_student;<br> <br> <br></code></pre></td></tr></table></figure><h1 id="æ•°æ®çš„æ›´æ–°"><a href="#æ•°æ®çš„æ›´æ–°" class="headerlink" title="æ•°æ®çš„æ›´æ–°"></a>æ•°æ®çš„æ›´æ–°</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span>ï¼Œæ›´æ–°æŒ‡å®šæ•°æ®<br>è¯­æ³•ä¸ºï¼š<span class="hljs-keyword">update</span> è¡¨å <span class="hljs-keyword">set</span> å­—æ®µå<span class="hljs-number">1</span><span class="hljs-operator">=</span>å€¼<span class="hljs-number">1</span>[,å­—æ®µå<span class="hljs-number">2</span><span class="hljs-operator">=</span>å€¼<span class="hljs-number">2</span>,....] <span class="hljs-keyword">where</span> æ¡ä»¶<br><br><span class="hljs-comment">---åˆ›å»ºä¸€å¼ è¡¨studentï¼ˆsnoä¸»é”® è‡ªåŠ¨å¢é•¿ sname éç©º age sexé»˜è®¤ç”· emailå”¯ä¸€ï¼‰</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> student(<br>sno <span class="hljs-type">int</span>(<span class="hljs-number">8</span>) <span class="hljs-keyword">primary</span> <span class="hljs-keyword">key</span> auto_increment,<br>sname <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,<br>age <span class="hljs-type">int</span>(<span class="hljs-number">8</span>),<br>sex <span class="hljs-type">varchar</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">default</span> &quot;ç”·&quot;,<br>email <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">unique</span><br>);<br><br><span class="hljs-comment">---æ›´æ–°æŒ‡å®šæ•°æ®</span><br><span class="hljs-keyword">update</span> student <span class="hljs-keyword">set</span> sname<span class="hljs-operator">=</span>&quot;å¼ è€å¤§&quot; <span class="hljs-keyword">where</span> sname<span class="hljs-operator">=</span>&quot;å¼ ä¸‰&quot;;<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> student;<br><br> <br><span class="hljs-number">2</span>ï¼Œæ›´æ–°å…¨éƒ¨æ•°æ®<br>è¯­æ³•ä¸ºï¼š<span class="hljs-keyword">update</span> è¡¨å <span class="hljs-keyword">set</span> å­—æ®µå<span class="hljs-number">1</span><span class="hljs-operator">=</span>å€¼<span class="hljs-number">1</span>[,å­—æ®µå<span class="hljs-number">2</span><span class="hljs-operator">=</span>å€¼<span class="hljs-number">2</span>,....] <br> <br><span class="hljs-comment">---æ›´æ–°å…¨éƒ¨æ•°æ® å°†è¡¨ä¸­å¹´é¾„éƒ½ä¿®æ”¹ä¸º18</span><br><span class="hljs-keyword">update</span> student <span class="hljs-keyword">set</span> age<span class="hljs-operator">=</span><span class="hljs-number">18</span>;<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> student;<br> <br></code></pre></td></tr></table></figure><h1 id="æ•°æ®çš„åˆ é™¤"><a href="#æ•°æ®çš„åˆ é™¤" class="headerlink" title="æ•°æ®çš„åˆ é™¤"></a>æ•°æ®çš„åˆ é™¤</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span>ï¼Œåˆ é™¤æŒ‡å®šæ•°æ®<br>è¯­æ³•ä¸ºï¼š<span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> è¡¨å <span class="hljs-keyword">where</span> æ¡ä»¶<br><br><span class="hljs-comment">---åˆ é™¤studentè¡¨ä¸­snoå¤§äº2çš„å­¦ç”Ÿä¿¡æ¯</span><br><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> student <span class="hljs-keyword">where</span> sno<span class="hljs-operator">&gt;</span><span class="hljs-number">2</span>;<br> <br> <br><span class="hljs-number">2</span>ï¼Œåˆ é™¤å…¨éƒ¨æ•°æ®<br>è¯­æ³•ä¸ºï¼š<span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> è¡¨å <span class="hljs-keyword">where</span> æ¡ä»¶<br><br><span class="hljs-comment">---åˆ é™¤studentè¡¨çš„å…¨éƒ¨æ•°æ®</span><br><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> student;<br> <br> <br><span class="hljs-number">3</span>ï¼Œ<span class="hljs-keyword">truncate</span>å…³é”®å­—åˆ é™¤æ•°æ®<br>è¯­æ³•ä¸ºï¼š<span class="hljs-keyword">truncate</span> è¡¨å<br> <br><span class="hljs-number">4</span>ï¼Œ<span class="hljs-keyword">truncate</span>ä¸<span class="hljs-keyword">delete</span>åˆ é™¤å…¨éƒ¨è®°å½•çš„åŒºåˆ«ï¼š<br> <br>aï¼Œ<span class="hljs-keyword">delete</span>æ˜¯æ•°æ®æ“çºµè¯­è¨€DML è€Œ<span class="hljs-keyword">truncate</span>æ˜¯æ•°æ®å®šä¹‰è¯­è¨€DDL<br><br>bï¼Œ<span class="hljs-keyword">delete</span>åˆ é™¤æ•°æ®æ˜¯ä¸€æ¡ä¸€æ¡åˆ é™¤<br><span class="hljs-keyword">truncate</span>åˆ é™¤æ•°æ®æ˜¯ä¿ç•™è¡¨ç»“æ„ï¼Œç›´æ¥åˆ é™¤æ•°æ®ï¼Œåˆ é™¤åè¡¨çš„çŠ¶æ€ç›¸å½“äºæ–°è¡¨<br><span class="hljs-keyword">truncate</span>çš„æ•ˆç‡æ¯”<span class="hljs-keyword">delete</span>é«˜<br><br>cï¼Œ<span class="hljs-keyword">delete</span>åˆ é™¤æ•°æ®ï¼Œä¼šæ˜¾ç¤ºåˆ é™¤è¡Œæ•°<br><span class="hljs-keyword">truncate</span>ä¸ä¼šæ˜¾ç¤º<br><br>dï¼Œåˆ é™¤è®°å½•åï¼Œå†æ¬¡å‘è¡¨æ·»åŠ æ•°æ®ï¼Œè‡ªå¢çš„å€¼ä¼šåœ¨åŸæ¥æœ€å¤§å€¼<span class="hljs-operator">+</span><span class="hljs-number">1</span><br><span class="hljs-keyword">truncate</span>åˆ é™¤è®°å½•åï¼Œä¼šä»<span class="hljs-number">1</span>å¼€å§‹è‡ªå¢<br><br>eï¼Œ<span class="hljs-keyword">delete</span>æ“ä½œå¯ä»¥å›æ»šå³åˆ é™¤çš„æ•°æ®å¯ä»¥æ¢å¤<br><span class="hljs-keyword">truncate</span>æ“ä½œéšå£«æäº¤ï¼Œåˆ é™¤çš„æ•°æ®ä¸èƒ½æ¢å¤<br> <br> <br></code></pre></td></tr></table></figure><h1 id="åˆ›å»ºempè¡¨"><a href="#åˆ›å»ºempè¡¨" class="headerlink" title="åˆ›å»ºempè¡¨"></a>åˆ›å»ºempè¡¨</h1><h2 id="å•è¡¨æŸ¥è¯¢"><a href="#å•è¡¨æŸ¥è¯¢" class="headerlink" title="å•è¡¨æŸ¥è¯¢"></a>å•è¡¨æŸ¥è¯¢</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs sql"> <br> <br>ç”¨æˆ·ç”¨ä¸åŒçš„æ–¹å¼ä»æ•°æ®åº“ä¸­è·å–è‡ªå·±æ‰€éœ€è¦çš„æ•°æ®<br>æ˜¯æ•°æ®åº“æ“ä½œä¸­éå¸¸é‡è¦ä¸”é¢‘ç¹çš„æ“ä½œ<br> <br><span class="hljs-comment">---åˆ›å»ºæ–°åº“test</span><br><span class="hljs-comment">---åœ¨teståº“ä¸­åˆ›å»ºemp(é›‡å‘˜è¡¨)</span><br>emp(é›‡å‘˜ç¼–å·empno<br>é›‡å‘˜åç§°ename<br>é›‡å‘˜èŒä½job<br>é›‡å‘˜é¢†å¯¼mgr<br>é›‡å‘˜å…¥èŒæ—¥æœŸhiredate<br>é›‡å‘˜æœˆè–ªsal<br>é›‡å‘˜æ´¥è´´comm<br>é›‡å‘˜éƒ¨é—¨ç¼–å·deptno<br><br><span class="hljs-keyword">create</span> database test;<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> emp(<br>empno <span class="hljs-type">int</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">primary</span> <span class="hljs-keyword">key</span>,<br>ename <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>),<br>job <span class="hljs-type">varchar</span>(<span class="hljs-number">9</span>),<br>mgr <span class="hljs-type">int</span>(<span class="hljs-number">4</span>),<br>hiredate <span class="hljs-type">date</span>,<br>sal <span class="hljs-type">decimal</span>(<span class="hljs-number">7</span>,<span class="hljs-number">2</span>),<br>comm <span class="hljs-type">decimal</span>(<span class="hljs-number">7</span>,<span class="hljs-number">2</span>),<br>deptno <span class="hljs-type">int</span>(<span class="hljs-number">2</span>)<br>);<br> <br><span class="hljs-comment">---åŒæ—¶æ’å…¥å¤šæ¡æ•°æ®</span><br> <br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> emp <span class="hljs-keyword">values</span><br>(<span class="hljs-number">7369</span>, <span class="hljs-string">&#x27;Smith&#x27;</span>, <span class="hljs-string">&#x27;clerk&#x27;</span>, <span class="hljs-number">7902</span>, <span class="hljs-string">&#x27;1980-12-17&#x27;</span>, <span class="hljs-number">800</span>, <span class="hljs-keyword">null</span>, <span class="hljs-number">20</span>), (<span class="hljs-number">7499</span>, <span class="hljs-string">&#x27;Allen&#x27;</span>, <span class="hljs-string">&#x27;salesman&#x27;</span>, <span class="hljs-number">7698</span>, <span class="hljs-string">&#x27;1981-02-20&#x27;</span>, <span class="hljs-number">1600</span>, <span class="hljs-number">300</span>, <span class="hljs-number">30</span>), (<span class="hljs-number">7521</span>, <span class="hljs-string">&#x27;Ward&#x27;</span>, <span class="hljs-string">&#x27;salesman&#x27;</span>, <span class="hljs-number">7698</span>, <span class="hljs-string">&#x27;1981-02-22&#x27;</span>, <span class="hljs-number">1250</span>, <span class="hljs-number">500</span>, <span class="hljs-number">30</span>), (<span class="hljs-number">7566</span>, <span class="hljs-string">&#x27;Jones&#x27;</span>, <span class="hljs-string">&#x27;manager&#x27;</span>, <span class="hljs-number">7839</span>, <span class="hljs-string">&#x27;1981-04-02&#x27;</span>, <span class="hljs-number">2975</span>, <span class="hljs-keyword">null</span>, <span class="hljs-number">20</span>), (<span class="hljs-number">7654</span>, <span class="hljs-string">&#x27;Maritn&#x27;</span>, <span class="hljs-string">&#x27;salesman&#x27;</span>, <span class="hljs-number">7698</span>, <span class="hljs-string">&#x27;1981-09-28&#x27;</span>, <span class="hljs-number">1250</span>, <span class="hljs-number">1400</span>, <span class="hljs-number">30</span>), (<span class="hljs-number">7698</span>, <span class="hljs-string">&#x27;Blake&#x27;</span>, <span class="hljs-string">&#x27;manager&#x27;</span>, <span class="hljs-number">7839</span>, <span class="hljs-string">&#x27;1981-05-01&#x27;</span>, <span class="hljs-number">2850</span>, <span class="hljs-keyword">null</span>, <span class="hljs-number">30</span>), (<span class="hljs-number">7782</span>, <span class="hljs-string">&#x27;Clark&#x27;</span>, <span class="hljs-string">&#x27;manager&#x27;</span>, <span class="hljs-number">7839</span>, <span class="hljs-string">&#x27;1981-06-09&#x27;</span>, <span class="hljs-number">2450</span>, <span class="hljs-keyword">null</span>, <span class="hljs-number">10</span>), (<span class="hljs-number">7788</span>, <span class="hljs-string">&#x27;Scott&#x27;</span>, <span class="hljs-string">&#x27;analyst&#x27;</span>, <span class="hljs-number">7566</span>, <span class="hljs-string">&#x27;1987-04-19&#x27;</span>, <span class="hljs-number">3000</span>, <span class="hljs-keyword">null</span>, <span class="hljs-number">20</span>), (<span class="hljs-number">7839</span>, <span class="hljs-string">&#x27;King&#x27;</span>, <span class="hljs-string">&#x27;president&#x27;</span>, <span class="hljs-keyword">null</span>, <span class="hljs-string">&#x27;1981-11-17&#x27;</span>, <span class="hljs-number">5000</span>, <span class="hljs-keyword">null</span>, <span class="hljs-number">10</span>), (<span class="hljs-number">7844</span>, <span class="hljs-string">&#x27;Turner&#x27;</span>, <span class="hljs-string">&#x27;salesman&#x27;</span>, <span class="hljs-number">7698</span>, <span class="hljs-string">&#x27;1981-09-08&#x27;</span>, <span class="hljs-number">1500</span>, <span class="hljs-number">0</span>, <span class="hljs-number">30</span>), (<span class="hljs-number">7876</span>, <span class="hljs-string">&#x27;Adams&#x27;</span>, <span class="hljs-string">&#x27;clerk&#x27;</span>, <span class="hljs-number">7788</span>, <span class="hljs-string">&#x27;1987-05-23&#x27;</span>, <span class="hljs-number">1100</span>, <span class="hljs-keyword">null</span>, <span class="hljs-number">20</span>), (<span class="hljs-number">7900</span>, <span class="hljs-string">&#x27;James&#x27;</span>, <span class="hljs-string">&#x27;clerk&#x27;</span>, <span class="hljs-number">7698</span>, <span class="hljs-string">&#x27;1981-12-03&#x27;</span>, <span class="hljs-number">950</span>, <span class="hljs-keyword">null</span>, <span class="hljs-number">30</span>), (<span class="hljs-number">7902</span>, <span class="hljs-string">&#x27;Ford&#x27;</span>, <span class="hljs-string">&#x27;analyst&#x27;</span>, <span class="hljs-number">7566</span>, <span class="hljs-string">&#x27;1981-12-03&#x27;</span>, <span class="hljs-number">3000</span>, <span class="hljs-keyword">null</span>, <span class="hljs-number">20</span>), (<span class="hljs-number">7934</span>, <span class="hljs-string">&#x27;Miller&#x27;</span>, <span class="hljs-string">&#x27;clerk&#x27;</span>, <span class="hljs-number">7782</span>, <span class="hljs-string">&#x27;1982-01-23&#x27;</span>, <span class="hljs-number">1300</span>, <span class="hljs-keyword">null</span>, <span class="hljs-number">10</span>);<br> <br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp;<br> <br> <br> <br><span class="hljs-number">2</span>ï¼Œä»¥ä¸Šè¡¨åˆ›å»ºå®Œæˆä¹‹åè¿›è¡Œå•è¡¨æŸ¥è¯¢<br> <br>aï¼ŒæŸ¥è¯¢æ‰€æœ‰å­—æ®µ<br>è¯­æ³•<span class="hljs-number">1</span>ä¸ºï¼š<span class="hljs-keyword">select</span> å­—æ®µå<span class="hljs-number">1</span>,å­—æ®µå<span class="hljs-number">2</span>,å­—æ®µå<span class="hljs-number">3</span>,....<span class="hljs-keyword">from</span> è¡¨å<br>è¯­æ³•<span class="hljs-number">2</span>ä¸ºï¼š<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> è¡¨å<br> <br>bï¼ŒæŸ¥è¯¢æŒ‡å®šå­—æ®µ<br>è¯­æ³•ä¸ºï¼š<span class="hljs-keyword">select</span> å­—æ®µå<span class="hljs-number">1</span>,å­—æ®µå<span class="hljs-number">2</span>,å­—æ®µå<span class="hljs-number">3</span>,....<span class="hljs-keyword">from</span> è¡¨å<br><span class="hljs-comment">---æŸ¥è¯¢é›‡å‘˜è¡¨ä¸­é›‡å‘˜å§“åï¼ŒèŒä½ï¼Œéƒ¨é—¨å·ï¼Œè–ªèµ„</span><br><span class="hljs-keyword">select</span> ename,job,deptno,sal <span class="hljs-keyword">from</span> emp;<br> <br>cï¼Œå»é‡<span class="hljs-keyword">distinct</span>çš„ä½¿ç”¨<br>è¯­æ³•ä¸ºï¼š<span class="hljs-keyword">select</span> <span class="hljs-keyword">distinct</span> å­—æ®µå<span class="hljs-number">1</span>,å­—æ®µå<span class="hljs-number">2</span>,å­—æ®µå<span class="hljs-number">3</span>,....<span class="hljs-keyword">from</span> è¡¨å<br><span class="hljs-comment">---æŸ¥è¯¢é›‡å‘˜åœ¨å“ªä¸ªéƒ¨é—¨å·ä¸­</span><br><span class="hljs-keyword">select</span> <span class="hljs-keyword">distinct</span> deptno <span class="hljs-keyword">from</span> emp;<br><span class="hljs-comment">---æŸ¥è¯¢é›‡å‘˜éƒ¨é—¨å·åŠèŒä½</span><br><span class="hljs-keyword">select</span> <span class="hljs-keyword">distinct</span> deptno,job <span class="hljs-keyword">from</span> emp;<br>æ³¨æ„ï¼š<span class="hljs-keyword">distinct</span>ä½¿ç”¨åˆ°å¤šä¸ªå­—æ®µä¸Šæ—¶ï¼Œåªæœ‰å¤šä¸ªå­—æ®µçš„å€¼éƒ½ç›¸åŒæ—¶æ‰å»é‡<br> <br><br>dï¼ŒæŸ¥è¯¢æ—¶ç®—æœ¯è¿ç®—ç¬¦çš„ä½¿ç”¨<br> <span class="hljs-operator">+</span>   <span class="hljs-operator">-</span>   <span class="hljs-operator">*</span>  <span class="hljs-operator">/</span>(div)   v<span class="hljs-operator">%</span>(mod)<br><span class="hljs-comment">---æŸ¥è¯¢æ¯ä¸ªé›‡å‘˜çš„å¹´è–ª</span><br><span class="hljs-keyword">select</span> ename,sal<span class="hljs-operator">*</span><span class="hljs-number">12</span> <span class="hljs-keyword">from</span> emp;<br> <br>eï¼Œç»™å­—æ®µèµ·åˆ«å<br>è¯­æ³•ä¸ºï¼š<span class="hljs-keyword">select</span> å­—æ®µå<span class="hljs-number">1</span> [<span class="hljs-keyword">as</span>] åˆ«å,å­—æ®µå<span class="hljs-number">2</span>,å­—æ®µå<span class="hljs-number">3</span>,....<span class="hljs-keyword">from</span> è¡¨å;<br><span class="hljs-comment">---æŸ¥è¯¢æ¯ä¸ªé›‡å‘˜çš„å¹´è–ªï¼Œåˆ«åä¸ºyearsal</span><br><span class="hljs-keyword">select</span> ename,sal<span class="hljs-operator">*</span><span class="hljs-number">12</span> <span class="hljs-keyword">as</span> yearsal <span class="hljs-keyword">from</span> emp;<br>æ³¨æ„ï¼šå¦‚æœåˆ«åä¸­æœ‰ç©ºæ ¼ç‰¹æ®Šç¬¦å·ï¼Œéœ€è¦ä½¿ç”¨å•å¼•å·æ‹¬èµ·æ¥<br><span class="hljs-comment">---æŸ¥è¯¢æ¯ä¸ªé›‡å‘˜çš„å¹´è–ªï¼Œåˆ«åä¸ºyearsal&amp;å¹´è–ª æˆ–è€…åˆ«åä¸º yearsal å¹´è–ª</span><br><span class="hljs-keyword">select</span> ename,sal<span class="hljs-operator">*</span><span class="hljs-number">12</span> <span class="hljs-keyword">as</span> <span class="hljs-string">&#x27;yearsal&amp;å¹´è–ª&#x27;</span> <span class="hljs-keyword">from</span> emp;<br><span class="hljs-keyword">select</span> ename,sal<span class="hljs-operator">*</span><span class="hljs-number">12</span> <span class="hljs-keyword">as</span> <span class="hljs-string">&#x27;yearsal å¹´è–ª&#x27;</span> <span class="hljs-keyword">from</span> emp;<br> <br></code></pre></td></tr></table></figure><h2 id="æŸ¥è¯¢ç»“æœæ’åº"><a href="#æŸ¥è¯¢ç»“æœæ’åº" class="headerlink" title="æŸ¥è¯¢ç»“æœæ’åº"></a>æŸ¥è¯¢ç»“æœæ’åº</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql">é»˜è®¤å‡åº <span class="hljs-keyword">asc</span><br>é™åº <span class="hljs-keyword">desc</span><br> <br><span class="hljs-number">1</span>ï¼Œåœ¨å•ä¸ªå­—æ®µä¸­æ’åº<br>è¯­æ³•ä¸ºï¼š<span class="hljs-keyword">select</span> æŸ¥è¯¢å†…å®¹ <span class="hljs-keyword">from</span> è¡¨å <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> å­—æ®µ  <span class="hljs-keyword">asc</span><span class="hljs-operator">|</span><span class="hljs-keyword">desc</span><br><span class="hljs-comment">---æŸ¥è¯¢é›‡å‘˜ä¿¡æ¯æŒ‰é›‡å‘˜è–ªèµ„å‡åºæ’åº</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> sal <span class="hljs-keyword">asc</span>;<br><span class="hljs-comment">---ç”±äºé»˜è®¤çš„æ’åºæ–¹å¼æ˜¯å‡åºï¼Œæ‰€ä»¥ascå¯ä»¥çœç•¥</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> sal;<br><br><span class="hljs-number">2</span>ï¼Œåœ¨å¤šä¸ªå­—æ®µä¸­ä½¿ç”¨æ’åº<br>è¯­æ³•ä¸ºï¼š<span class="hljs-keyword">select</span> æŸ¥è¯¢å†…å®¹ <span class="hljs-keyword">from</span> è¡¨å <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> å­—æ®µå<span class="hljs-number">1</span>  <span class="hljs-keyword">asc</span><span class="hljs-operator">|</span><span class="hljs-keyword">desc</span>,å­—æ®µå<span class="hljs-number">2</span>  <span class="hljs-keyword">asc</span><span class="hljs-operator">|</span>desc....<br><span class="hljs-comment">---æŸ¥è¯¢é›‡å‘˜ä¿¡æ¯ï¼Œå…ˆæŒ‰é›‡å‘˜è–ªèµ„å‡åºæ’ï¼Œå¦‚è–ªèµ„ç›¸åŒåˆ™æŒ‰å…¥èŒæ—¥æœŸé™åºæ’åº</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> sal,hiredate <span class="hljs-keyword">desc</span>;<br>æ³¨æ„ï¼šæ’åºå¯ä»¥èµ·åˆ«å<br><span class="hljs-comment">---æŸ¥è¯¢é›‡å‘˜çš„å¹´è–ªç»™å¹´è–ªèµ·ä¸ªåˆ«åyearsal,æŒ‰å¹´è–ªé™åºæ’åº</span><br><span class="hljs-keyword">select</span> ename,sal<span class="hljs-operator">*</span><span class="hljs-number">12</span> <span class="hljs-keyword">as</span> yearsal <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> yearsal <span class="hljs-keyword">desc</span>;<br> <br></code></pre></td></tr></table></figure><h2 id="æ¡ä»¶æŸ¥è¯¢"><a href="#æ¡ä»¶æŸ¥è¯¢" class="headerlink" title="æ¡ä»¶æŸ¥è¯¢"></a>æ¡ä»¶æŸ¥è¯¢</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs sql">æ˜¯ç”¨æˆ·æŒ‰ç…§ä¸€å®šæ¡ä»¶æŸ¥è¯¢ï¼ŒæŸ¥è¯¢æ»¡è¶³æ¡ä»¶çš„éƒ¨åˆ†è®°å½•<br>è¯­æ³•æ ¼å¼ï¼š<span class="hljs-keyword">select</span> æŸ¥è¯¢å†…å®¹ <span class="hljs-keyword">from</span> è¡¨ <span class="hljs-keyword">where</span> æ¡ä»¶<br> <br>(<span class="hljs-number">1</span>)æ¯”è¾ƒè¿ç®—ç¬¦çš„ä½¿ç”¨   <span class="hljs-operator">=</span>    <span class="hljs-operator">&gt;</span>    <span class="hljs-operator">&lt;</span>      <span class="hljs-operator">&gt;=</span>      <span class="hljs-operator">&lt;=</span>      <span class="hljs-operator">!=</span>       <span class="hljs-operator">&lt;&gt;</span><br><span class="hljs-comment">---æŸ¥è¯¢éƒ¨é—¨å·ä¸º20çš„é›‡å‘˜ä¿¡æ¯</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> deptno<span class="hljs-operator">=</span><span class="hljs-number">20</span>;<br><span class="hljs-comment">---æŸ¥è¯¢è–ªèµ„å¤§äºç­‰äº3000çš„é›‡å‘˜ä¿¡æ¯</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> sal<span class="hljs-operator">&gt;=</span><span class="hljs-number">3000</span>;<br><span class="hljs-comment">---æŸ¥è¯¢è–ªèµ„å°äº3000çš„é›‡å‘˜åç§°ï¼Œè–ªèµ„ï¼ŒèŒä½</span><br><span class="hljs-keyword">select</span> ename,sal,job <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> sal<span class="hljs-operator">&lt;</span><span class="hljs-number">3000</span>;<br><span class="hljs-comment">---æŸ¥è¯¢åä¸ºSmithçš„é›‡å‘˜ä¿¡æ¯</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> ename<span class="hljs-operator">=</span>&quot;Smith&quot;;<br>æ³¨æ„ï¼šMySQLé»˜è®¤ä¸åŒºåˆ†å¤§å°å†™ï¼Œå¦‚æœè¦åŒºåˆ†å¤§å°å†™åˆ™å¯ä»¥ä½¿ç”¨<span class="hljs-type">binary</span>å…³é”®å­—<br><span class="hljs-comment">---binaryçš„ä½¿ç”¨</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> <span class="hljs-type">binary</span> ename<span class="hljs-operator">=</span>&quot;Smith&quot;;<br><br>(<span class="hljs-number">2</span>) [<span class="hljs-keyword">not</span>] <span class="hljs-keyword">between</span> <span class="hljs-keyword">and</span>çš„ä½¿ç”¨ <br>å¯ä»¥æŸ¥è¯¢æŸåŒºé—´èŒƒå›´çš„è®°å½•<br><span class="hljs-comment">---æŸ¥è¯¢è–ªèµ„åœ¨1200-3000ä¹‹é—´çš„é›‡å‘˜ä¿¡æ¯</span><br><span class="hljs-comment">---betweenåé¢æ˜¯å¼€å§‹å€¼ï¼Œandåé¢æ˜¯ç»“æŸå€¼ï¼Œä¸èƒ½é¢ å€’ã€‚åŒ…æ‹¬è¾¹ç•Œ</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> sal <span class="hljs-keyword">between</span> <span class="hljs-number">1200</span> <span class="hljs-keyword">and</span> <span class="hljs-number">3000</span>;<br><span class="hljs-comment">---æŸ¥è¯¢è–ªèµ„ä¸åœ¨1200-3000èŒƒå›´ä¹‹å†…çš„é›‡å‘˜å§“åï¼Œè–ªèµ„</span><br><span class="hljs-keyword">select</span> ename,sal <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> sal <span class="hljs-keyword">not</span> <span class="hljs-keyword">between</span> <span class="hljs-number">1200</span> <span class="hljs-keyword">and</span> <span class="hljs-number">3000</span>;<br> <br>(<span class="hljs-number">3</span>)[<span class="hljs-keyword">not</span>] <span class="hljs-keyword">in</span>çš„ä½¿ç”¨<br>è¯­æ³•æ ¼å¼ä¸ºï¼š<span class="hljs-keyword">select</span> æŸ¥è¯¢å†…å®¹ <span class="hljs-keyword">from</span> è¡¨å <span class="hljs-keyword">where</span> å­—æ®µå <span class="hljs-keyword">in</span>(å€¼<span class="hljs-number">1</span>,å€¼<span class="hljs-number">2</span>,å€¼<span class="hljs-number">3</span>,...)<br><span class="hljs-comment">---æŸ¥è¯¢é›‡å‘˜å§“åæ˜¯smith,scott,kingçš„é›‡å‘˜ä¿¡æ¯</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> ename <span class="hljs-keyword">in</span>(&quot;smith&quot;,&quot;scott&quot;,&quot;king&quot;);<br><span class="hljs-comment">---æŸ¥è¯¢é›‡å‘˜å§“åä¸æ˜¯smith,scott,kingçš„é›‡å‘˜ä¿¡æ¯</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> ename <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span>(&quot;smith&quot;,&quot;scott&quot;,&quot;king&quot;);<br> <br>(<span class="hljs-number">4</span>)<span class="hljs-keyword">is</span> <span class="hljs-keyword">null</span> æˆ–è€… <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>  åˆ¤æ–­æŸä¸ªå­—æ®µæ˜¯å¦ä¸ºç©º<br><span class="hljs-comment">---æŸ¥è¯¢é›‡å‘˜ä¸­ï¼Œæœ‰æ´¥è´´çš„é›‡å‘˜ä¿¡æ¯</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> comm <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>;<br><span class="hljs-comment">---æŸ¥è¯¢é›‡å‘˜ä¸­ï¼Œæ²¡æœ‰æ´¥è´´çš„é›‡å‘˜ä¿¡æ¯</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> comm <span class="hljs-keyword">is</span> <span class="hljs-keyword">null</span>;<br> <br>(<span class="hljs-number">5</span>)æ¨¡ç³ŠæŸ¥è¯¢<br>å¯æŸ¥è¯¢ä»¥XXå¼€å¤´ï¼Œä»¥XXç»“å°¾ï¼ŒåŒ…å«XXï¼Œç¬¬å‡ ä¸ªæ˜¯X<br><span class="hljs-operator">%</span>ï¼šæŒ‡ä»»æ„é•¿åº¦çš„å­—ç¬¦<br>_ï¼šåŒ¹é…ä¸€ä¸ªå­—ç¬¦<br>è¯­æ³•ä¸ºï¼š<span class="hljs-keyword">select</span> æŸ¥è¯¢å†…å®¹<span class="hljs-keyword">from</span>è¡¨å<span class="hljs-keyword">where</span>å­—æ®µå<span class="hljs-keyword">like</span><br><span class="hljs-comment">---æŸ¥è¯¢é›‡å‘˜å§“åä»¥Så¼€å¤´çš„é›‡å‘˜ä¿¡æ¯</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> ename <span class="hljs-keyword">like</span>&quot;S%&quot;;<br><span class="hljs-comment">---æŸ¥è¯¢é›‡å‘˜å§“åä»¥Sç»“å°¾çš„é›‡å‘˜ä¿¡æ¯</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> ename <span class="hljs-keyword">like</span>&quot;%S&quot;;<br><span class="hljs-comment">---æŸ¥è¯¢é›‡å‘˜å§“ååŒ…å«Sçš„é›‡å‘˜ä¿¡æ¯</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> ename <span class="hljs-keyword">like</span>&quot;%S%&quot;;<br><span class="hljs-comment">---æŸ¥è¯¢é›‡å‘˜å§“åç¬¬äºŒä¸ªå­—ç¬¦æ˜¯Lçš„é›‡å‘˜ä¿¡æ¯</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> ename <span class="hljs-keyword">like</span>&quot;_L%&quot;;<br><span class="hljs-comment">---æŸ¥è¯¢é›‡å‘˜å§“åé•¿åº¦æ˜¯5çš„é›‡å‘˜ä¿¡æ¯</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> ename <span class="hljs-keyword">like</span>&quot;_____&quot;;<br> <br>(<span class="hljs-number">6</span>)æ¡ä»¶ä¸­çš„é€»è¾‘è¿ç®—ç¬¦<br><span class="hljs-keyword">and</span>ï¼šæŸ¥è¯¢æ—¶ï¼Œåªæœ‰æ»¡è¶³æ‰€æœ‰æ¡ä»¶çš„è®°å½•æ‰ä¼šè¢«æŸ¥è¯¢å‡ºæ¥<br><span class="hljs-keyword">select</span> æŸ¥è¯¢å†…å®¹<span class="hljs-keyword">from</span>è¡¨å<span class="hljs-keyword">where</span> æ¡ä»¶<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> æ¡ä»¶<span class="hljs-number">2</span> and....<br><span class="hljs-comment">---æŸ¥è¯¢é›‡å‘˜è¡¨ä¸­éƒ¨é—¨å·ä¸º20 èŒä½æ˜¯clerkçš„é›‡å‘˜å§“å éƒ¨é—¨ç¼–å· èŒä½</span><br><span class="hljs-keyword">select</span> ename,deptno,job <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> deptno<span class="hljs-operator">=</span><span class="hljs-number">20</span> <span class="hljs-keyword">and</span> job<span class="hljs-operator">=</span>&quot;clerk&quot;;<br><span class="hljs-comment">---æŸ¥è¯¢éƒ¨é—¨å·ä¸º30ï¼Œè–ªèµ„åœ¨1500-3000ä¹‹é—´çš„é›‡å‘˜ä¿¡æ¯</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> deptno<span class="hljs-operator">=</span><span class="hljs-number">30</span> <span class="hljs-keyword">and</span> sal <span class="hljs-keyword">between</span> <span class="hljs-number">1500</span> <span class="hljs-keyword">and</span> <span class="hljs-number">3000</span>;<br><br><span class="hljs-keyword">or</span>ï¼šæŸ¥è¯¢æ—¶ï¼Œåªè¦æ»¡è¶³ä»»ä¸€æ¡ä»¶è®°å½•å°±èƒ½è¢«æŸ¥è¯¢å‡ºæ¥<br><span class="hljs-keyword">select</span> æŸ¥è¯¢å†…å®¹<span class="hljs-keyword">from</span>è¡¨å<span class="hljs-keyword">where</span> æ¡ä»¶<span class="hljs-number">1</span> <span class="hljs-keyword">or</span> æ¡ä»¶<span class="hljs-number">2</span> or....<br><span class="hljs-comment">---æŸ¥è¯¢é›‡å‘˜è¡¨ä¸­éƒ¨é—¨å·ä¸º20 æˆ–è€…èŒä½æ˜¯clerkçš„é›‡å‘˜å§“å éƒ¨é—¨ç¼–å· èŒä½</span><br><span class="hljs-keyword">select</span> ename,deptno,job <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> deptno<span class="hljs-operator">=</span><span class="hljs-number">20</span> <span class="hljs-keyword">or</span> job<span class="hljs-operator">=</span>&quot;clerk&quot;;<br> <br> <br></code></pre></td></tr></table></figure><h2 id="åˆ†é¡µæŸ¥è¯¢"><a href="#åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="åˆ†é¡µæŸ¥è¯¢"></a>åˆ†é¡µæŸ¥è¯¢</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> æŸ¥è¯¢å†…å®¹ <span class="hljs-keyword">from</span> è¡¨å <span class="hljs-keyword">where</span> æ¡ä»¶ <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> å­—æ®µå <span class="hljs-keyword">asc</span><span class="hljs-operator">|</span><span class="hljs-keyword">desc</span> limit a,b <br>æ³¨æ„ï¼š<br>(aä»£è¡¨ä»å“ªæ¡è®°å½•å¼€å§‹ï¼Œbä»£è¡¨æ¯é¡µæ˜¾ç¤ºçš„æ¡æ•°) ä¸”é»˜è®¤ç¬¬ä¸€æ¡æ•°æ®çš„å€¼ä¸º<span class="hljs-number">0</span><br>å¦‚æœlimitä¸<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> è¿ç”¨çš„æ—¶å€™ï¼Œå…ˆæ’åºå†åˆ†é¡µ<br><span class="hljs-comment">---æ˜¾ç¤ºç¬¬ä¸€é¡µé›‡å‘˜ä¿¡æ¯ ä¾‹å¦‚æ¯é¡µæ˜¾ç¤º4æ¡</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp limit <span class="hljs-number">0</span>,<span class="hljs-number">4</span>;<br><span class="hljs-comment">---æ˜¾ç¤ºç¬¬äºŒé¡µé›‡å‘˜ä¿¡æ¯ æ¯é¡µæ˜¾ç¤º4æ¡</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp limit <span class="hljs-number">4</span>,<span class="hljs-number">4</span>;<br><span class="hljs-comment">---æ˜¾ç¤ºç¬¬ä¸‰é¡µé›‡å‘˜ä¿¡æ¯ æ¯é¡µæ˜¾ç¤º4æ¡</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp limit <span class="hljs-number">8</span>,<span class="hljs-number">4</span>;<br><span class="hljs-comment">---æ˜¾ç¤ºç¬¬né¡µé›‡å‘˜ä¿¡æ¯ æ¯é¡µæ˜¾ç¤º4æ¡</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp limit (n<span class="hljs-number">-1</span>)<span class="hljs-operator">*</span><span class="hljs-number">4</span>,<span class="hljs-number">4</span>;<br> <br> <br></code></pre></td></tr></table></figure><h1 id="å‡½æ•°çš„ä½¿ç”¨"><a href="#å‡½æ•°çš„ä½¿ç”¨" class="headerlink" title="å‡½æ•°çš„ä½¿ç”¨"></a>å‡½æ•°çš„ä½¿ç”¨</h1><h2 id="å•è¡Œå‡½æ•°"><a href="#å•è¡Œå‡½æ•°" class="headerlink" title="å•è¡Œå‡½æ•°"></a>å•è¡Œå‡½æ•°</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><code class="hljs sql">aï¼Œå­—ç¬¦å‡½æ•° <br>(<span class="hljs-number">1</span>)concat() æ‹¼æ¥å­—ç¬¦ä¸²<br><span class="hljs-comment">---æŸ¥è¯¢é›‡å‘˜ä¿¡æ¯ï¼Œä»¥æŒ‡å®šæ ¼å¼è¾“å‡º</span><br>é›‡å‘˜å§“åï¼šXX,è–ªèµ„ï¼šXX,èŒä½ï¼šXX,å…¥èŒæ—¥æœŸï¼šXX,å¹´è–ªï¼šXX,<br><span class="hljs-keyword">select</span> concat(&quot;é›‡å‘˜å§“åï¼š&quot;,ename,&quot;ï¼Œè–ªèµ„ï¼š&quot;,sal,&quot;ï¼ŒèŒä½ï¼š&quot;,job,&quot;ï¼Œå…¥èŒæ—¥æœŸï¼š&quot;,hiredate,&quot;ï¼Œå¹´è–ªï¼š&quot;,sal<span class="hljs-operator">*</span><span class="hljs-number">12</span>) <span class="hljs-keyword">from</span> emp;<br><br>(<span class="hljs-number">2</span>)length()è®¡ç®—å­—ç¬¦ä¸²çš„é•¿åº¦<br><span class="hljs-comment">---æŸ¥è¯¢é›‡å‘˜å§“åé•¿åº¦æ˜¯5çš„é›‡å‘˜ä¿¡æ¯</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> length(ename)<span class="hljs-operator">=</span><span class="hljs-number">5</span>;<br><br>(<span class="hljs-number">3</span>)<span class="hljs-built_in">lower</span>()  <span class="hljs-built_in">upper</span>()è½¬æ¢å¤§å°å†™<br><span class="hljs-comment">---æŸ¥è¯¢é›‡å‘˜å§“å å¤§å†™çš„é›‡å‘˜å§“å å°å†™çš„é›‡å‘˜å§“å</span><br><span class="hljs-keyword">select</span> ename,<span class="hljs-built_in">lower</span>(ename),<span class="hljs-built_in">upper</span>(ename) <span class="hljs-keyword">from</span> emp;<br><br>(<span class="hljs-number">4</span>)replace()åœ¨æŒ‡å®šçš„å­—ç¬¦ä¸²ä¸­ï¼Œå°†æŸå­ä¸²æ›¿æ¢ä¸ºæ–°çš„å­—ç¬¦ä¸²<br>replace(ç›®æ ‡å­—ç¬¦ä¸²,æŸ¥æ‰¾çš„å­ä¸²,æ–°å­—ç¬¦ä¸²)<br><span class="hljs-comment">---å°†helloWordå­—ç¬¦ä¸²ä¸­çš„helloæ›¿æ¢ä¸ºhi</span><br><span class="hljs-keyword">select</span> replace(&quot;helloworld&quot;,&quot;hello&quot;,&quot;hi&quot;) <span class="hljs-keyword">from</span> dual;<br><span class="hljs-comment">---å¦ä¸€ç§å†™æ³•ä¸º</span><br><span class="hljs-keyword">select</span> replace(&quot;helloworld&quot;,&quot;hello&quot;,&quot;hi&quot;);<br><br>(<span class="hljs-number">5</span>)<span class="hljs-built_in">substring</span>()æˆªå–å­ä¸²<br><span class="hljs-built_in">substring</span>(ç›®æ ‡å­—ç¬¦ä¸²,å¼€å§‹ä½ç½®,é•¿åº¦)  æ³¨æ„å¼€å§‹ç´¢å¼•æ˜¯ä»<span class="hljs-number">1</span>å¼€å§‹çš„ã€‚<br><span class="hljs-comment">---æˆªå–é›‡å‘˜å§“åçš„å‰4ä¸ªå­—ç¬¦</span><br><span class="hljs-keyword">select</span> <span class="hljs-built_in">substring</span>(ename,<span class="hljs-number">1</span>,<span class="hljs-number">4</span>) <span class="hljs-keyword">from</span> emp;<br> <br> <br>bï¼Œæ•°å€¼å‡½æ•°<br><span class="hljs-number">1</span>ï¼Œ<span class="hljs-built_in">abs</span>()  ä½œç”¨æ˜¯ï¼šå–ç»å¯¹å€¼<br><span class="hljs-keyword">select</span>(<span class="hljs-number">1</span>),(<span class="hljs-number">-1</span>);<br> <br><span class="hljs-number">2</span>ï¼Œpi()  ä½œç”¨æ˜¯ï¼šè·å–åœ†å‘¨ç‡<br><span class="hljs-keyword">select</span> pi();<br> <br><span class="hljs-number">3</span>ï¼Œ<span class="hljs-built_in">mod</span>() ä½œç”¨æ˜¯ï¼šå–ä½™<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">mod</span>(<span class="hljs-number">3</span>,<span class="hljs-number">2</span>);<br><br><span class="hljs-number">5</span>ï¼Œpow() ä½œç”¨æ˜¯ï¼šæ±‚ä¸€ä¸ªæ•°çš„næ¬¡æ–¹<br><span class="hljs-keyword">select</span> pow(<span class="hljs-number">3</span>,<span class="hljs-number">2</span>)<br> <br><span class="hljs-number">6</span>ï¼Œ<span class="hljs-built_in">ceil</span>() å‘ä¸Šå–æ•´  <span class="hljs-built_in">floor</span>()å‘ä¸‹å–æ•´<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">ceil</span>(<span class="hljs-number">5.43</span>),<span class="hljs-built_in">floor</span>(<span class="hljs-number">5.7</span>);<br> <br><span class="hljs-number">7</span>ï¼Œround(num) ä»£è¡¨è¿”å›å››èˆäº”å…¥çš„æ•´æ•°<br>round(num,n)è¿”å›å››èˆäº”å…¥nä½å°æ•°<br><span class="hljs-keyword">select</span> round(<span class="hljs-number">5.4</span>),round(<span class="hljs-number">6.8</span>),round(<span class="hljs-number">5.34</span>,<span class="hljs-number">1</span>),round(<span class="hljs-number">6.789</span>,<span class="hljs-number">2</span>);<br><br><span class="hljs-number">8</span>ï¼Œ<span class="hljs-keyword">truncate</span>(num,n) nçš„å€¼å¯ä»¥ä¸º<span class="hljs-number">0</span>,<span class="hljs-number">1</span>ï¼Œ<span class="hljs-number">2</span>,<span class="hljs-number">3</span>ï¼Œ<span class="hljs-number">4.</span>..å…¶ä¸­nä¸º<span class="hljs-number">0</span>æ—¶ä»£è¡¨æˆªå–æ•´æ•°<br><span class="hljs-keyword">select</span> <span class="hljs-keyword">truncate</span>(<span class="hljs-number">5.3</span>,<span class="hljs-number">0</span>),<span class="hljs-keyword">truncate</span>(<span class="hljs-number">5.67</span>,<span class="hljs-number">1</span>),<span class="hljs-keyword">truncate</span>(<span class="hljs-number">5.789</span>,<span class="hljs-number">2</span>);<br><br><span class="hljs-number">9</span>ï¼Œrand() è·å–æµ®ç‚¹ç±»å‹çš„éšæœºæ•°ï¼ŒèŒƒå›´æ˜¯<span class="hljs-number">0</span><span class="hljs-number">-1.0</span>ã€‚åŒ…æ‹¬<span class="hljs-number">0</span>ä½†ä¸åŒ…å«<span class="hljs-number">1</span><br><span class="hljs-keyword">select</span> rand(),rand(),rand();<br> <br> <br>cï¼Œæ—¶é—´æ—¥æœŸå‡½æ•°<br><span class="hljs-number">1</span>ï¼Œnow() è·å–<span class="hljs-keyword">SQL</span>æ‰§è¡Œæ—¶å½“å‰æ—¥æœŸå’Œæ—¶é—´ åŒ…æ‹¬å¹´æœˆæ—¥ æ—¶åˆ†ç§’<br><span class="hljs-keyword">select</span> now();<br> <br><span class="hljs-number">2</span>ï¼Œcurdate()è·å–å½“å‰æ—¥æœŸ åªåŒ…æ‹¬å¹´æœˆæ—¥<br><span class="hljs-keyword">select</span> curdate()<br><br><span class="hljs-number">3</span>ï¼Œcurtime()è·å–å½“å‰æ—¶é—´ åªåŒ…æ‹¬æ—¶åˆ†ç§’<br><span class="hljs-keyword">select</span> curtime();<br><br><span class="hljs-number">4</span>ï¼Œsysdate()è·å–å‡½æ•°æ‰§è¡Œæ—¶çš„æ—¥æœŸå’Œæ—¶é—´<br><span class="hljs-keyword">select</span> sysdate(),now(),sleep(<span class="hljs-number">3</span>),sysdate(),now();<br><br><span class="hljs-number">5</span>ï¼Œdayofyear()è·å–æŸä¸ªæ—¥æœŸæ˜¯æ‰€åœ¨å¹´ä»½çš„ç¬¬å‡ å¤©<br> week()è·å–æŸä¸ªæ—¥æœŸæ˜¯æ‰€åœ¨å¹´ä»½çš„ç¬¬å‡ å‘¨<br> <span class="hljs-keyword">select</span> dayofyear(now()),week(now());<br><br><span class="hljs-number">6</span>ï¼Œdatediff()è®¡ç®—ä¸¤ä¸ªæ—¥æœŸä¹‹é—´çš„æ—¶é—´é—´éš”<br><span class="hljs-comment">---è®¡ç®—2019.1.1æ—¥è·ç¦»ç°åœ¨æ—¶é—´é—´éš”</span><br><span class="hljs-keyword">select</span> datediff(&quot;2019-12-30&quot;,now());<br> <br><span class="hljs-number">7</span>ï¼Œdate_add(),date_sub() å®ç°æ—¥æœŸçš„åŠ å‡è¿ç®—<br>date_add(æ—¥æœŸ, æ—¶é—´é—´éš”ç±»å‹å…³é”®å­—<span class="hljs-type">interval</span>, æ—¶é—´é—´éš”ç±»å‹å¯¹åº”çš„è¡¨è¾¾å¼, æ—¶é—´é—´éš”ç±»å‹)<br> day_hour  <span class="hljs-number">1</span>_12 ä»£è¡¨<span class="hljs-number">1</span>å¤©<span class="hljs-number">12</span>ä¸ªå°æ—¶<br> year_month <span class="hljs-number">2</span>_1 ä»£è¡¨<span class="hljs-number">2</span>å¹´<span class="hljs-number">1</span>ä¸ªæœˆ<br> <br> <span class="hljs-keyword">select</span> date_add(now(), <span class="hljs-type">interval</span> &quot;2_1&quot; year_month)<br> <span class="hljs-keyword">select</span> date_sub(now(), <span class="hljs-type">interval</span> <span class="hljs-number">10</span> <span class="hljs-keyword">day</span>);<br> <br>eï¼Œæµç¨‹æ§åˆ¶å‡½æ•°<br><span class="hljs-number">1</span>ï¼Œif(æ¡ä»¶,t,f) å¦‚æœæ¡ä»¶æˆç«‹è¿”å›tï¼Œå¦åˆ™è¿”å›f<br><span class="hljs-keyword">select</span> if(<span class="hljs-number">1</span><span class="hljs-operator">&gt;</span><span class="hljs-number">2</span>,&quot;1å¤§äº2&quot;,&quot;1å°äº2&quot;);<br><span class="hljs-comment">---æŸ¥è¯¢é›‡å‘˜çš„è–ªèµ„ï¼Œå¦‚æœè–ªèµ„&gt;=3000ï¼Œè¾“å…¥â€œé«˜è–ªâ€ï¼Œå¦åˆ™â€œä½è–ªâ€</span><br><span class="hljs-keyword">select</span> sal,if(sal<span class="hljs-operator">&gt;=</span><span class="hljs-number">3000</span>,&quot;é«˜è–ª&quot;,&quot;ä½è–ª&quot;) &quot;è–ªèµ„æ°´å¹³&quot; <span class="hljs-keyword">from</span> emp;<br><br><span class="hljs-number">2</span>ï¼Œifnull(å€¼<span class="hljs-number">1</span>,å€¼<span class="hljs-number">2</span>) å¦‚æœå€¼<span class="hljs-number">1</span>ä¸ä¸ºç©ºåˆ™è¿”å›å€¼<span class="hljs-number">1</span>ï¼Œå¦åˆ™è¿”å›å€¼<span class="hljs-number">2</span><br><span class="hljs-comment">---æŸ¥è¯¢é›‡å‘˜çš„å¹´è–ª</span><br><span class="hljs-keyword">select</span> sal,comm,(sal<span class="hljs-operator">+</span>comm)<span class="hljs-operator">*</span><span class="hljs-number">12</span> <span class="hljs-keyword">from</span> emp; æ­¤è¯­å¥è¾¾ä¸åˆ°æƒ³è¦çš„æ•ˆæœ<br><span class="hljs-keyword">select</span> (sal<span class="hljs-operator">+</span>ifnull(comm,<span class="hljs-number">0</span>))<span class="hljs-operator">*</span><span class="hljs-number">12</span> <span class="hljs-keyword">from</span> emp;<br><span class="hljs-keyword">select</span> sal,comm,(sal<span class="hljs-operator">+</span>ifnull(comm,<span class="hljs-number">0</span>))<span class="hljs-operator">*</span><span class="hljs-number">12</span> <span class="hljs-keyword">from</span> emp;<br><span class="hljs-number">3</span>ï¼Œ<span class="hljs-built_in">nullif</span>(å€¼<span class="hljs-number">1</span>,å€¼<span class="hljs-number">2</span>) å¦‚æœå€¼<span class="hljs-number">1</span>ç­‰äºå€¼<span class="hljs-number">2</span>è¿”å›<span class="hljs-keyword">null</span>ï¼Œå¦åˆ™è¿”å›å€¼<span class="hljs-number">1</span><br><span class="hljs-keyword">select</span> <span class="hljs-built_in">nullif</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>),<span class="hljs-built_in">nullif</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>);<br><br><span class="hljs-number">4</span>ï¼Œ   <span class="hljs-keyword">case</span> å€¼<br><span class="hljs-keyword">when</span> å€¼<span class="hljs-number">1</span> <span class="hljs-keyword">then</span> ç»“æœ<span class="hljs-number">1</span><br><span class="hljs-keyword">when</span> å€¼<span class="hljs-number">2</span> <span class="hljs-keyword">then</span> ç»“æœ<span class="hljs-number">2</span><br>...<br><span class="hljs-keyword">else</span> å…¶ä»–ç»“æœ<br><span class="hljs-keyword">end</span><br> <span class="hljs-keyword">select</span> <span class="hljs-keyword">case</span> <span class="hljs-number">1</span> <span class="hljs-keyword">when</span> <span class="hljs-number">1</span> <span class="hljs-keyword">then</span> &quot;è¿™æ˜¯ç»“æœ1&quot; <span class="hljs-keyword">when</span> <span class="hljs-number">2</span> <span class="hljs-keyword">then</span> &quot;è¿™æ˜¯ç»“æœ2&quot; <span class="hljs-keyword">else</span> &quot;è¿™æ˜¯å…¶ä»–ç»“æœ&quot; <span class="hljs-keyword">end</span>;<br> <br><span class="hljs-number">5</span>ï¼Œ   <span class="hljs-keyword">case</span> <br><span class="hljs-keyword">when</span> æ¡ä»¶ <span class="hljs-keyword">then</span> ç»“æœ<span class="hljs-number">1</span><br><span class="hljs-keyword">when</span> æ¡ä»¶ <span class="hljs-keyword">then</span> ç»“æœ<span class="hljs-number">2</span><br>...<br><span class="hljs-keyword">else</span> å…¶ä»–ç»“æœ<br><span class="hljs-keyword">end</span><br>ç¤ºä¾‹ä¸ºï¼š<span class="hljs-comment">---æŸ¥è¯¢é›‡å‘˜è–ªèµ„ï¼Œå¦‚æœè–ªèµ„&gt;=3000è¿”å›â€œé«˜è–ªâ€ï¼Œå¦åˆ™â€œä½è–ªâ€</span><br><span class="hljs-keyword">select</span> sal,<span class="hljs-keyword">case</span><br><span class="hljs-keyword">when</span> sal<span class="hljs-operator">&gt;=</span><span class="hljs-number">3000</span> <span class="hljs-keyword">then</span> &quot;é«˜è–ª&quot;<br><span class="hljs-keyword">else</span> &quot;ä½è–ª&quot;<br><span class="hljs-keyword">end</span> &quot;è–ªèµ„æ°´å¹³&quot;<br><span class="hljs-keyword">from</span> emp;<br> <br></code></pre></td></tr></table></figure><h2 id="å¤šè¡Œå‡½æ•°"><a href="#å¤šè¡Œå‡½æ•°" class="headerlink" title="å¤šè¡Œå‡½æ•°"></a>å¤šè¡Œå‡½æ•°</h2><p>å®šä¹‰ï¼šæ“ä½œä¸€ç»„æ•°æ®(å¤šè¡Œè®°å½•)è¿”å›ä¸€ä¸ªç»“æœï¼Œä¹Ÿå«åˆ†ç»„å‡½æ•° å¤§å¤šç”¨äºç»Ÿè®¡ ä¾‹å¦‚ï¼šç»Ÿè®¡å„éƒ¨é—¨ä¸­é›‡å‘˜çš„äººæ•°ã€‚ç»Ÿè®¡å„éƒ¨é—¨ä¸­æœ€é«˜å’Œæœ€ä½è–ªèµ„</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span>ï¼Œ<span class="hljs-built_in">count</span>()ç»Ÿè®¡è¡¨ä¸­è®°å½•çš„æ•°ç›®<br><span class="hljs-comment">---æŸ¥è¯¢empè¡¨ä¸­æœ‰å¤šå°‘æ¡è®°å½•</span><br><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> emp;<br> <br>å¦ä¸€æ¡è¯­æ³•æ˜¯<span class="hljs-built_in">count</span>(exp)ç»Ÿè®¡expå€¼éç©ºçš„è®°å½•æ•°ç›®<br><span class="hljs-comment">---æŸ¥è¯¢é›‡å‘˜è¡¨ä¸­ï¼Œæœ‰å¤šå°‘ä½é›‡å‘˜æœ‰æ´¥è´´</span><br><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(comm) <span class="hljs-keyword">from</span> emp;<br> <br>å¦ä¸€æ¡è¯­æ³•æ˜¯<span class="hljs-built_in">count</span>(<span class="hljs-keyword">distinct</span>(exp)) è¿”å›è¡¨è¾¾å¼expçš„å€¼ä¸é‡å¤ä¸”éç©ºçš„æ€»è®°å½•æ•°ç›®<br><span class="hljs-comment">---ç»Ÿè®¡é›‡å‘˜è¡¨ä¸­æœ‰å¤šå°‘ä½é›‡å‘˜æ˜¯é¢†å¯¼</span><br><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-keyword">distinct</span>(mgr)) <span class="hljs-keyword">from</span> emp;<span class="hljs-comment">--ç»Ÿè®¡çš„æ˜¯é™¤è‘£äº‹é•¿å¤–çš„é¢†å¯¼äººæ•°</span><br><span class="hljs-comment">---ç»Ÿè®¡é›‡å‘˜è¡¨ä¸­åŒ…å«è‘£äº‹é•¿çš„é¢†å¯¼æ•° éœ€è¦ç”¨åˆ°ifnullå‡½æ•°</span><br><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-keyword">distinct</span>(ifnull(mgr,<span class="hljs-number">1</span>))) <span class="hljs-keyword">from</span> emp;<br> <br><span class="hljs-number">2</span>ï¼Œ<span class="hljs-built_in">sum</span>(exp) è¿”å›è¡¨è¾¾å¼å€¼çš„æ€»å’Œ<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">sum</span>(sal) <span class="hljs-keyword">from</span> emp;<br><br>å¦ä¸€æ¡è¯­æ³•æ˜¯<span class="hljs-built_in">sum</span>(<span class="hljs-keyword">distinct</span>(exp))è¿”å›ä¸é‡å¤çš„è¡¨è¾¾å¼expçš„æ€»å’Œ<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">sum</span>(sal),<span class="hljs-built_in">sum</span>(<span class="hljs-keyword">distinct</span>(sal)) <span class="hljs-keyword">from</span> emp;<br> <br><span class="hljs-number">3</span>ï¼Œ<span class="hljs-built_in">avg</span>(exp)è¿”å›è¡¨è¾¾å¼å€¼çš„å¹³å‡å€¼<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">avg</span>(sal) <span class="hljs-keyword">from</span> emp;<br> <br>å¦ä¸€æ¡è¯­æ³•æ˜¯<span class="hljs-built_in">avg</span>(<span class="hljs-keyword">distinct</span>(exp))è¿”å›ä¸é‡å¤çš„è¡¨è¾¾å¼expçš„å¹³å‡å€¼<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">avg</span>(<span class="hljs-keyword">distinct</span>(sal)) <span class="hljs-keyword">from</span> emp;<br> <br><span class="hljs-number">4</span>ï¼Œ<span class="hljs-built_in">max</span>()  <span class="hljs-built_in">min</span>() <br><span class="hljs-built_in">max</span>(emp)è¿”å›è¡¨è¾¾å¼å€¼çš„æœ€å¤§å€¼<br><span class="hljs-built_in">min</span>(emp)è¿”å›è¡¨è¾¾å¼å€¼çš„æœ€å°å€¼<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">min</span>(sal),<span class="hljs-built_in">max</span>(sal) <span class="hljs-keyword">from</span> emp;<br> <br></code></pre></td></tr></table></figure><h2 id="åˆ†ç»„ç»Ÿè®¡"><a href="#åˆ†ç»„ç»Ÿè®¡" class="headerlink" title="åˆ†ç»„ç»Ÿè®¡"></a>åˆ†ç»„ç»Ÿè®¡</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs sql">è¯­æ³•ä¸ºï¼š<br><span class="hljs-keyword">select</span> æŸ¥è¯¢å†…å®¹<br><span class="hljs-keyword">from</span> è¡¨å<br>[<span class="hljs-keyword">where</span> æ¡ä»¶]<br>[<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> åˆ†ç»„å­—æ®µå<span class="hljs-number">1</span>,åˆ†ç»„å­—æ®µå<span class="hljs-number">2</span>,...]<br>[<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> å­—æ®µå <span class="hljs-keyword">asc</span><span class="hljs-operator">|</span><span class="hljs-keyword">desc</span>]<br>[limit]<br> <br>ç¤ºä¾‹å¦‚ä¸‹ï¼š<br> <span class="hljs-comment">---æ±‚æ¯ä¸ªéƒ¨é—¨çš„äººæ•°</span><br> <span class="hljs-keyword">select</span> deptno,<span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> emp  <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> deptno;<br> <span class="hljs-comment">---æ±‚æ¯ä¸ªéƒ¨é—¨çš„å¹³å‡å·¥èµ„</span><br> <span class="hljs-keyword">select</span> deptno,<span class="hljs-built_in">avg</span>(sal) <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> deptno;<br> <span class="hljs-comment">---æ±‚æ¯ä¸ªéƒ¨é—¨ä¸­æœ€é«˜å·¥èµ„å’Œäººæ•°</span><br> <span class="hljs-keyword">select</span> deptno,<span class="hljs-built_in">max</span>(sal),<span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> deptno;<br> <span class="hljs-comment">---æ±‚æ¯ä¸ªå²—ä½çš„äººæ•°</span><br> <span class="hljs-keyword">select</span> job,<span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> job;<br> <span class="hljs-comment">---æ˜¾ç¤ºæ¯ä¸ªéƒ¨é—¨ä¸åŒå²—ä½çš„äººæ•°</span><br> <span class="hljs-keyword">select</span> deptno,job,<span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> deptno,job;<br> <br>æ³¨æ„äº‹é¡¹<span class="hljs-number">1</span>ï¼šå¦‚æœæŸ¥è¯¢å­—æ®µï¼Œæ²¡æœ‰åœ¨å¤šè¡Œå‡½æ•°ä¸­ï¼Œåˆ™å¿…é¡»æ˜¯åˆ†ç»„å­—æ®µ<br><span class="hljs-keyword">select</span> ename,job,<span class="hljs-built_in">sum</span>(sal) <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> job; æ­¤è¯­å¥è¿è¡Œåä¼šæŠ¥é”™<br> <br>æ³¨æ„äº‹é¡¹<span class="hljs-number">2</span>ï¼šå¦‚æœæ²¡æœ‰<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> åˆ™æŸ¥è¯¢å­—æ®µä¸èƒ½ä¸å¤šè¡Œå‡½æ•°ä¸€èµ·æŸ¥è¯¢<br><span class="hljs-keyword">select</span> sal,empto <span class="hljs-keyword">from</span> emp; åˆæ³•<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">sum</span>(sal),empto <span class="hljs-keyword">from</span> emp;ä¸åˆæ³•<br> <br>æ³¨æ„äº‹é¡¹<span class="hljs-number">3</span>ï¼šä¸å…è®¸åœ¨<span class="hljs-keyword">where</span>æ¡ä»¶ä¸­ä½¿ç”¨å¤šè¡Œå‡½æ•°<br> <br></code></pre></td></tr></table></figure><h2 id="havingå­å¥"><a href="#havingå­å¥" class="headerlink" title="havingå­å¥"></a>havingå­å¥</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sql">è¯­æ³•ä¸ºï¼š<br><span class="hljs-keyword">select</span> æŸ¥è¯¢å†…å®¹<br><span class="hljs-keyword">from</span> è¡¨å<br>[<span class="hljs-keyword">where</span> æ¡ä»¶]<br>[<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> åˆ†ç»„å­—æ®µ]<br>[<span class="hljs-keyword">having</span> æ¡ä»¶]<br>[<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span>]<br><span class="hljs-keyword">select</span> <span class="hljs-keyword">from</span> <span class="hljs-comment">---whereè¿‡æ»¤---group by---havingè¿‡æ»¤</span><br>ç¤ºä¾‹å¦‚ä¸‹ï¼š<br><span class="hljs-comment">---æ¯ä¸ªéƒ¨é—¨ä¸åŒå²—ä½çš„äººæ•°ï¼Œä¸”äººæ•°å¤§äº2</span><br><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>),deptno,job <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> deptno,job <span class="hljs-keyword">having</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>)<span class="hljs-operator">&gt;</span><span class="hljs-number">2</span>;<br><span class="hljs-comment">---åœ¨empè¡¨ä¸­åˆ—å‡ºå·¥èµ„æœ€å°å€¼å°äº2000çš„èŒä½</span><br><span class="hljs-keyword">select</span> job,<span class="hljs-built_in">min</span>(sal) <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> job <span class="hljs-keyword">having</span> <span class="hljs-built_in">min</span>(sal)<span class="hljs-operator">&lt;</span><span class="hljs-number">2000</span>;<br><span class="hljs-comment">---æŸ¥è¯¢æ¯ä¸ªèŒä½çš„æœ€ä½è–ªèµ„</span><br><span class="hljs-keyword">select</span> job,<span class="hljs-built_in">min</span>(sal) <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> job;<br><span class="hljs-comment">---åˆ—å‡ºå¹³å‡å·¥èµ„å¤§äº1200çš„éƒ¨é—¨å’ŒèŒä½æ­é…ç»„åˆ</span><br><span class="hljs-keyword">select</span> <span class="hljs-built_in">avg</span>(avg) <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> deptno,job <span class="hljs-keyword">having</span> <span class="hljs-built_in">avg</span>(sal)<span class="hljs-operator">&gt;</span><span class="hljs-number">1200</span>;<br><span class="hljs-comment">---æ±‚æ¯ä¸ªéƒ¨é—¨ä¸åŒèŒä½çš„å¹³å‡å·¥èµ„</span><br><span class="hljs-keyword">select</span> <span class="hljs-built_in">avg</span>(sal) <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> deptno,job;<br> <br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>æ•°æ®åº“</tag>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>mysqlå­æŸ¥è¯¢</title>
    <link href="/blog/2021/01/24/mysql%E5%AD%90%E6%9F%A5%E8%AF%A2/"/>
    <url>/blog/2021/01/24/mysql%E5%AD%90%E6%9F%A5%E8%AF%A2/</url>
    
    <content type="html"><![CDATA[<p>æˆ‘çš„åšå®¢å³å°†åŒæ­¥è‡³è…¾è®¯äº‘+ç¤¾åŒºï¼Œé‚€è¯·å¤§å®¶ä¸€åŒå…¥é©»ï¼š<a href="https://cloud.tencent.com/developer/support-plan?invite_code=1g8kqx5e1oouz">https://cloud.tencent.com/developer/support-plan?invite_code=1g8kqx5e1oouz</a></p><h1 id="å­æŸ¥è¯¢å®šä¹‰"><a href="#å­æŸ¥è¯¢å®šä¹‰" class="headerlink" title="å­æŸ¥è¯¢å®šä¹‰"></a>å­æŸ¥è¯¢å®šä¹‰</h1><p>åœ¨ä¸€ä¸ªè¡¨è¡¨è¾¾ä¸­å¯ä»¥è°ƒç”¨å¦ä¸€ä¸ªè¡¨è¡¨è¾¾å¼ï¼Œè¿™ä¸ªè¢«è°ƒç”¨çš„è¡¨è¡¨è¾¾å¼å«åšå­æŸ¥è¯¢ï¼ˆsubqueryï¼‰ï¼Œæˆ‘ä¹ˆä¹Ÿç§°ä½œå­é€‰æ‹©ï¼ˆsubselectï¼‰æˆ–å†…åµŒé€‰æ‹©ï¼ˆinner selectï¼‰ã€‚å­æŸ¥è¯¢çš„ç»“æœä¼ é€’ç»™è°ƒç”¨å®ƒçš„è¡¨è¡¨è¾¾å¼ç»§ç»­å¤„ç†ã€‚</p><h1 id="å­æŸ¥è¯¢åˆ†ç±»"><a href="#å­æŸ¥è¯¢åˆ†ç±»" class="headerlink" title="å­æŸ¥è¯¢åˆ†ç±»"></a>å­æŸ¥è¯¢åˆ†ç±»</h1><h2 id="æŒ‰è¿”å›ç»“æœé›†åˆ†ç±»"><a href="#æŒ‰è¿”å›ç»“æœé›†åˆ†ç±»" class="headerlink" title="æŒ‰è¿”å›ç»“æœé›†åˆ†ç±»"></a>æŒ‰è¿”å›ç»“æœé›†åˆ†ç±»</h2><p>å­æŸ¥è¯¢æŒ‰è¿”å›ç»“æœé›†çš„ä¸åŒåˆ†ä¸º4ç§ï¼šè¡¨å­æŸ¥è¯¢ï¼Œè¡Œå­æŸ¥è¯¢ï¼Œåˆ—å­æŸ¥è¯¢å’Œæ ‡é‡å­æŸ¥è¯¢ã€‚ è¡¨å­æŸ¥è¯¢ï¼šè¿”å›çš„ç»“æœé›†æ˜¯ä¸€ä¸ªè¡Œçš„é›†åˆï¼ŒNè¡ŒNåˆ—ï¼ˆN&gt;=1ï¼‰ã€‚è¡¨å­æŸ¥è¯¢ç»å¸¸ç”¨äºçˆ¶æŸ¥è¯¢çš„FROMå­å¥ä¸­ã€‚ è¡Œå­æŸ¥è¯¢ï¼šè¿”å›çš„ç»“æœé›†æ˜¯ä¸€ä¸ªåˆ—çš„é›†åˆï¼Œä¸€è¡ŒNåˆ—ï¼ˆN&gt;=1ï¼‰ã€‚è¡Œå­æŸ¥è¯¢å¯ä»¥ç”¨äºç¦æŸ¥è¯¢çš„FROMå­å¥å’ŒWHEREå­å¥ä¸­ã€‚ åˆ—å­æŸ¥è¯¢ï¼šè¿”å›çš„ç»“æœé›†æ˜¯ä¸€ä¸ªè¡Œçš„é›†åˆï¼ŒNè¡Œä¸€åˆ—ï¼ˆN&gt;=1ï¼‰ã€‚ æ ‡é‡å­æŸ¥è¯¢ï¼šè¿”å›çš„ç»“æœé›†æ˜¯ä¸€ä¸ªæ ‡é‡é›†åˆï¼Œä¸€è¡Œä¸€åˆ—ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªæ ‡é‡å€¼ã€‚å¯ä»¥æŒ‡å®šä¸€ä¸ªæ ‡é‡è¡¨è¾¾å¼çš„ä»»ä½•åœ°æ–¹ï¼Œéƒ½å¯ä»¥ç”¨ä¸€ä¸ªæ ‡é‡å­æŸ¥è¯¢ã€‚</p><p>ä»å®šä¹‰ä¸Šè®²ï¼Œæ¯ä¸ªæ ‡é‡å­æŸ¥è¯¢ä¹Ÿæ˜¯ä¸€ä¸ªè¡Œå­æŸ¥è¯¢å’Œä¸€ä¸ªåˆ—å­æŸ¥è¯¢ï¼Œåä¹‹åˆ™ä¸æ˜¯ï¼›æ¯ä¸ªè¡Œå­æŸ¥è¯¢å’Œåˆ—å­æŸ¥è¯¢ä¹Ÿæ˜¯ä¸€ä¸ªè¡¨å­æŸ¥è¯¢ï¼Œåä¹‹ä¹Ÿä¸æ˜¯ã€‚</p><h2 id="æŒ‰ç…§å¯¹è¿”å›ç»“æœçš„è°ƒç”¨æ–¹æ³•"><a href="#æŒ‰ç…§å¯¹è¿”å›ç»“æœçš„è°ƒç”¨æ–¹æ³•" class="headerlink" title="æŒ‰ç…§å¯¹è¿”å›ç»“æœçš„è°ƒç”¨æ–¹æ³•"></a>æŒ‰ç…§å¯¹è¿”å›ç»“æœçš„è°ƒç”¨æ–¹æ³•</h2><p>å­æŸ¥è¯¢æŒ‰å¯¹è¿”å›ç»“æœé›†çš„è°ƒç”¨æ–¹æ³•ï¼Œå¯åˆ†ä¸ºwhereå‹å­æŸ¥è¯¢ï¼Œfromå‹å­æŸ¥è¯¢åŠexistså‹å­æŸ¥è¯¢ã€‚</p><p>whereå‹å­æŸ¥è¯¢ï¼šï¼ˆæŠŠå†…å±‚æŸ¥è¯¢ç»“æœå½“ä½œå¤–å±‚æŸ¥è¯¢çš„æ¯”è¾ƒæ¡ä»¶ï¼‰å®šä¹‰ï¼šwhereå‹çš„å­æŸ¥è¯¢å°±æ˜¯æŠŠå†…å±‚æŸ¥è¯¢çš„ç»“æœå½“ä½œå¤–å±‚æŸ¥è¯¢çš„æ¡ä»¶ã€‚ fromå‹å­æŸ¥è¯¢ï¼šï¼ˆæŠŠå†…å±‚çš„æŸ¥è¯¢ç»“æœä¾›å¤–å±‚å†æ¬¡æŸ¥è¯¢ï¼‰å®šä¹‰ï¼šfromå­æŸ¥è¯¢å°±æ˜¯æŠŠå­æŸ¥è¯¢çš„ç»“æœ(å†…å­˜é‡Œçš„ä¸€å¼ è¡¨)å½“ä½œä¸€å¼ ä¸´æ—¶è¡¨ï¼Œç„¶åå†å¯¹å®ƒè¿›è¡Œå¤„ç†ã€‚ existså‹å­æŸ¥è¯¢ï¼šï¼ˆæŠŠå¤–å±‚æŸ¥è¯¢ç»“æœæ‹¿åˆ°å†…å±‚ï¼Œçœ‹å†…å±‚çš„æŸ¥è¯¢æ˜¯å¦æˆç«‹ï¼‰å®šä¹‰ï¼šexistså­æŸ¥è¯¢å°±æ˜¯å¯¹å¤–å±‚è¡¨è¿›è¡Œå¾ªç¯ï¼Œå†å¯¹å†…è¡¨è¿›è¡Œå†…å±‚æŸ¥è¯¢ã€‚å’Œin ()å·®ä¸å¤šï¼Œä½†æ˜¯å®ƒä»¬è¿˜æ˜¯æœ‰åŒºåˆ«çš„ã€‚ä¸»è¦æ˜¯çœ‹ä¸¤ä¸ªå¼ è¡¨å¤§å°å·®çš„ç¨‹åº¦ã€‚è‹¥å­æŸ¥è¯¢è¡¨å¤§åˆ™ç”¨existsï¼ˆå†…å±‚ç´¢å¼•ï¼‰ï¼Œå­æŸ¥è¯¢è¡¨å°åˆ™ç”¨inï¼ˆå¤–å±‚ç´¢å¼•ï¼‰ï¼›</p><h1 id="ä½¿ç”¨å­æŸ¥è¯¢åŸåˆ™"><a href="#ä½¿ç”¨å­æŸ¥è¯¢åŸåˆ™" class="headerlink" title="ä½¿ç”¨å­æŸ¥è¯¢åŸåˆ™"></a>ä½¿ç”¨å­æŸ¥è¯¢åŸåˆ™</h1><p>1.ä¸€ä¸ªå­æŸ¥è¯¢å¿…é¡»æ”¾åœ¨åœ†æ‹¬å·ä¸­ã€‚ 2.å°†å­æŸ¥è¯¢æ”¾åœ¨æ¯”è¾ƒæ¡ä»¶çš„å³è¾¹ä»¥å¢åŠ å¯è¯»æ€§ã€‚å­æŸ¥è¯¢ä¸åŒ…å« ORDER BY å­å¥ã€‚å¯¹ä¸€ä¸ª SELECT è¯­å¥åªèƒ½ç”¨ä¸€ä¸ª ORDER BY å­å¥ï¼Œå¹¶ä¸”å¦‚æœæŒ‡å®šäº†å®ƒå°±å¿…é¡»æ”¾åœ¨ä¸» SELECT è¯­å¥çš„æœ€åã€‚ 3.åœ¨å­æŸ¥è¯¢ä¸­å¯ä»¥ä½¿ç”¨ä¸¤ç§æ¯”è¾ƒæ¡ä»¶ï¼šå•è¡Œè¿ç®—ç¬¦(&gt;, =, &gt;=, &lt;, &lt;&gt;, &lt;=) å’Œå¤šè¡Œè¿ç®—ç¬¦(IN, ANY, ALL)ã€‚</p><h1 id="å®ä¾‹åˆ†æ"><a href="#å®ä¾‹åˆ†æ" class="headerlink" title="å®ä¾‹åˆ†æ"></a>å®ä¾‹åˆ†æ</h1><h2 id="åˆ›å»ºæµ‹è¯•è¡¨"><a href="#åˆ›å»ºæµ‹è¯•è¡¨" class="headerlink" title="åˆ›å»ºæµ‹è¯•è¡¨"></a>åˆ›å»ºæµ‹è¯•è¡¨</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> PLAYERS<br>    (PLAYERNO      <span class="hljs-type">INTEGER</span>      <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    NAME           <span class="hljs-type">CHAR</span>(<span class="hljs-number">15</span>)     <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    INITIALS       <span class="hljs-type">CHAR</span>(<span class="hljs-number">3</span>)      <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    BIRTH_DATE     <span class="hljs-type">DATE</span>                 ,<br>    SEX            <span class="hljs-type">CHAR</span>(<span class="hljs-number">1</span>)      <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    JOINED         <span class="hljs-type">SMALLINT</span>     <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    STREET         <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">30</span>)  <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    HOUSENO        <span class="hljs-type">CHAR</span>(<span class="hljs-number">4</span>)              ,<br>    POSTCODE       <span class="hljs-type">CHAR</span>(<span class="hljs-number">6</span>)              ,<br>    TOWN           <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">30</span>)  <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    PHONENO        <span class="hljs-type">CHAR</span>(<span class="hljs-number">13</span>)             ,<br>    LEAGUENO       <span class="hljs-type">CHAR</span>(<span class="hljs-number">4</span>)              ,<br>    <span class="hljs-keyword">PRIMARY</span> <span class="hljs-keyword">KEY</span>    (PLAYERNO));<br> <br><span class="hljs-keyword">CREATE</span>   <span class="hljs-keyword">TABLE</span> PENALTIES<br>        (PAYMENTNO      <span class="hljs-type">INTEGER</span>      <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>         PLAYERNO       <span class="hljs-type">INTEGER</span>      <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>         PAYMENT_DATE   <span class="hljs-type">DATE</span>         <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>         AMOUNT         <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">7</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>         <span class="hljs-keyword">PRIMARY</span> <span class="hljs-keyword">KEY</span>    (PAYMENTNO));<br></code></pre></td></tr></table></figure><p>æ³¨ï¼šè¡¨playersä¸ºçƒå‘˜ä¿¡æ¯åŸºæœ¬è¡¨ï¼Œè¡¨penaltiesä¸ºæœ‰è¿‡ç½šæ¬¾è®°å½•çš„çƒå‘˜ä¿¡æ¯åˆ—è¡¨ã€‚</p><h2 id="æ’å…¥æµ‹è¯•æ•°æ®"><a href="#æ’å…¥æµ‹è¯•æ•°æ®" class="headerlink" title="æ’å…¥æµ‹è¯•æ•°æ®"></a>æ’å…¥æµ‹è¯•æ•°æ®</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> PLAYERS <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">2</span>, <span class="hljs-string">&#x27;Everett&#x27;</span>, <span class="hljs-string">&#x27;R&#x27;</span>, <span class="hljs-string">&#x27;1948-09-01&#x27;</span>, <span class="hljs-string">&#x27;M&#x27;</span>, <span class="hljs-number">1975</span>, <span class="hljs-string">&#x27;Stoney Road&#x27;</span>,<span class="hljs-string">&#x27;43&#x27;</span>, <span class="hljs-string">&#x27;3575NH&#x27;</span>, <span class="hljs-string">&#x27;Stratford&#x27;</span>, <span class="hljs-string">&#x27;070-237893&#x27;</span>, <span class="hljs-string">&#x27;2411&#x27;</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> PLAYERS <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">6</span>, <span class="hljs-string">&#x27;Parmenter&#x27;</span>, <span class="hljs-string">&#x27;R&#x27;</span>, <span class="hljs-string">&#x27;1964-06-25&#x27;</span>, <span class="hljs-string">&#x27;M&#x27;</span>, <span class="hljs-number">1977</span>, <span class="hljs-string">&#x27;Haseltine Lane&#x27;</span>,<span class="hljs-string">&#x27;80&#x27;</span>, <span class="hljs-string">&#x27;1234KK&#x27;</span>, <span class="hljs-string">&#x27;Stratford&#x27;</span>, <span class="hljs-string">&#x27;070-476537&#x27;</span>, <span class="hljs-string">&#x27;8467&#x27;</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> PLAYERS <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">7</span>, <span class="hljs-string">&#x27;Wise&#x27;</span>, <span class="hljs-string">&#x27;GWS&#x27;</span>, <span class="hljs-string">&#x27;1963-05-11&#x27;</span>, <span class="hljs-string">&#x27;M&#x27;</span>, <span class="hljs-number">1981</span>, <span class="hljs-string">&#x27;Edgecombe Way&#x27;</span>,<span class="hljs-string">&#x27;39&#x27;</span>, <span class="hljs-string">&#x27;9758VB&#x27;</span>, <span class="hljs-string">&#x27;Stratford&#x27;</span>, <span class="hljs-string">&#x27;070-347689&#x27;</span>, <span class="hljs-keyword">NULL</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> PLAYERS <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;Newcastle&#x27;</span>, <span class="hljs-string">&#x27;B&#x27;</span>, <span class="hljs-string">&#x27;1962-07-08&#x27;</span>, <span class="hljs-string">&#x27;F&#x27;</span>, <span class="hljs-number">1980</span>, <span class="hljs-string">&#x27;Station Road&#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>, <span class="hljs-string">&#x27;6584WO&#x27;</span>, <span class="hljs-string">&#x27;Inglewood&#x27;</span>, <span class="hljs-string">&#x27;070-458458&#x27;</span>, <span class="hljs-string">&#x27;2983&#x27;</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> PLAYERS <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">27</span>, <span class="hljs-string">&#x27;Collins&#x27;</span>, <span class="hljs-string">&#x27;DD&#x27;</span>, <span class="hljs-string">&#x27;1964-12-28&#x27;</span>, <span class="hljs-string">&#x27;F&#x27;</span>, <span class="hljs-number">1983</span>, <span class="hljs-string">&#x27;Long Drive&#x27;</span>,<span class="hljs-string">&#x27;804&#x27;</span>, <span class="hljs-string">&#x27;8457DK&#x27;</span>, <span class="hljs-string">&#x27;Eltham&#x27;</span>, <span class="hljs-string">&#x27;079-234857&#x27;</span>, <span class="hljs-string">&#x27;2513&#x27;</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> PLAYERS <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">28</span>, <span class="hljs-string">&#x27;Collins&#x27;</span>, <span class="hljs-string">&#x27;C&#x27;</span>, <span class="hljs-string">&#x27;1963-06-22&#x27;</span>, <span class="hljs-string">&#x27;F&#x27;</span>, <span class="hljs-number">1983</span>, <span class="hljs-string">&#x27;Old Main Road&#x27;</span>,<span class="hljs-string">&#x27;10&#x27;</span>, <span class="hljs-string">&#x27;1294QK&#x27;</span>, <span class="hljs-string">&#x27;Midhurst&#x27;</span>, <span class="hljs-string">&#x27;010-659599&#x27;</span>, <span class="hljs-keyword">NULL</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> PLAYERS <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">39</span>, <span class="hljs-string">&#x27;Bishop&#x27;</span>, <span class="hljs-string">&#x27;D&#x27;</span>, <span class="hljs-string">&#x27;1956-10-29&#x27;</span>, <span class="hljs-string">&#x27;M&#x27;</span>, <span class="hljs-number">1980</span>, <span class="hljs-string">&#x27;Eaton Square&#x27;</span>,<span class="hljs-string">&#x27;78&#x27;</span>, <span class="hljs-string">&#x27;9629CD&#x27;</span>, <span class="hljs-string">&#x27;Stratford&#x27;</span>, <span class="hljs-string">&#x27;070-393435&#x27;</span>, <span class="hljs-keyword">NULL</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> PLAYERS <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">44</span>, <span class="hljs-string">&#x27;Baker&#x27;</span>, <span class="hljs-string">&#x27;E&#x27;</span>, <span class="hljs-string">&#x27;1963-01-09&#x27;</span>, <span class="hljs-string">&#x27;M&#x27;</span>, <span class="hljs-number">1980</span>, <span class="hljs-string">&#x27;Lewis Street&#x27;</span>,<span class="hljs-string">&#x27;23&#x27;</span>, <span class="hljs-string">&#x27;4444LJ&#x27;</span>, <span class="hljs-string">&#x27;Inglewood&#x27;</span>, <span class="hljs-string">&#x27;070-368753&#x27;</span>, <span class="hljs-string">&#x27;1124&#x27;</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> PLAYERS <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">57</span>, <span class="hljs-string">&#x27;Brown&#x27;</span>, <span class="hljs-string">&#x27;M&#x27;</span>, <span class="hljs-string">&#x27;1971-08-17&#x27;</span>, <span class="hljs-string">&#x27;M&#x27;</span>, <span class="hljs-number">1985</span>, <span class="hljs-string">&#x27;Edgecombe Way&#x27;</span>,<span class="hljs-string">&#x27;16&#x27;</span>, <span class="hljs-string">&#x27;4377CB&#x27;</span>, <span class="hljs-string">&#x27;Stratford&#x27;</span>, <span class="hljs-string">&#x27;070-473458&#x27;</span>, <span class="hljs-string">&#x27;6409&#x27;</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> PLAYERS <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">83</span>, <span class="hljs-string">&#x27;Hope&#x27;</span>, <span class="hljs-string">&#x27;PK&#x27;</span>, <span class="hljs-string">&#x27;1956-11-11&#x27;</span>, <span class="hljs-string">&#x27;M&#x27;</span>, <span class="hljs-number">1982</span>, <span class="hljs-string">&#x27;Magdalene Road&#x27;</span>,<span class="hljs-string">&#x27;16A&#x27;</span>, <span class="hljs-string">&#x27;1812UP&#x27;</span>, <span class="hljs-string">&#x27;Stratford&#x27;</span>, <span class="hljs-string">&#x27;070-353548&#x27;</span>, <span class="hljs-string">&#x27;1608&#x27;</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> PLAYERS <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">95</span>, <span class="hljs-string">&#x27;Miller&#x27;</span>, <span class="hljs-string">&#x27;P&#x27;</span>, <span class="hljs-string">&#x27;1963-05-14&#x27;</span>, <span class="hljs-string">&#x27;M&#x27;</span>, <span class="hljs-number">1972</span>, <span class="hljs-string">&#x27;High Street&#x27;</span>,<span class="hljs-string">&#x27;33A&#x27;</span>, <span class="hljs-string">&#x27;5746OP&#x27;</span>, <span class="hljs-string">&#x27;Douglas&#x27;</span>, <span class="hljs-string">&#x27;070-867564&#x27;</span>, <span class="hljs-keyword">NULL</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> PLAYERS <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">100</span>, <span class="hljs-string">&#x27;Parmenter&#x27;</span>, <span class="hljs-string">&#x27;P&#x27;</span>, <span class="hljs-string">&#x27;1963-02-28&#x27;</span>, <span class="hljs-string">&#x27;M&#x27;</span>, <span class="hljs-number">1979</span>, <span class="hljs-string">&#x27;Haseltine Lane&#x27;</span>,<span class="hljs-string">&#x27;80&#x27;</span>, <span class="hljs-string">&#x27;6494SG&#x27;</span>, <span class="hljs-string">&#x27;Stratford&#x27;</span>, <span class="hljs-string">&#x27;070-494593&#x27;</span>, <span class="hljs-string">&#x27;6524&#x27;</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> PLAYERS <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">104</span>, <span class="hljs-string">&#x27;Moorman&#x27;</span>, <span class="hljs-string">&#x27;D&#x27;</span>, <span class="hljs-string">&#x27;1970-05-10&#x27;</span>, <span class="hljs-string">&#x27;F&#x27;</span>, <span class="hljs-number">1984</span>, <span class="hljs-string">&#x27;Stout Street&#x27;</span>,<span class="hljs-string">&#x27;65&#x27;</span>, <span class="hljs-string">&#x27;9437AO&#x27;</span>, <span class="hljs-string">&#x27;Eltham&#x27;</span>, <span class="hljs-string">&#x27;079-987571&#x27;</span>, <span class="hljs-string">&#x27;7060&#x27;</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> PLAYERS <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">112</span>, <span class="hljs-string">&#x27;Bailey&#x27;</span>, <span class="hljs-string">&#x27;IP&#x27;</span>, <span class="hljs-string">&#x27;1963-10-01&#x27;</span>, <span class="hljs-string">&#x27;F&#x27;</span>, <span class="hljs-number">1984</span>, <span class="hljs-string">&#x27;Vixen Road&#x27;</span>,<span class="hljs-string">&#x27;8&#x27;</span>, <span class="hljs-string">&#x27;6392LK&#x27;</span>, <span class="hljs-string">&#x27;Plymouth&#x27;</span>, <span class="hljs-string">&#x27;010-548745&#x27;</span>, <span class="hljs-string">&#x27;1319&#x27;</span>);<br> <br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> PENALTIES <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>,  <span class="hljs-number">6</span>, <span class="hljs-string">&#x27;1980-12-08&#x27;</span>,<span class="hljs-number">100</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> PENALTIES <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">2</span>, <span class="hljs-number">44</span>, <span class="hljs-string">&#x27;1981-05-05&#x27;</span>, <span class="hljs-number">75</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> PENALTIES <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">3</span>, <span class="hljs-number">27</span>, <span class="hljs-string">&#x27;1983-09-10&#x27;</span>,<span class="hljs-number">100</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> PENALTIES <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">4</span>,<span class="hljs-number">104</span>, <span class="hljs-string">&#x27;1984-12-08&#x27;</span>, <span class="hljs-number">50</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> PENALTIES <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">5</span>, <span class="hljs-number">44</span>, <span class="hljs-string">&#x27;1980-12-08&#x27;</span>, <span class="hljs-number">25</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> PENALTIES <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">6</span>,  <span class="hljs-number">8</span>, <span class="hljs-string">&#x27;1980-12-08&#x27;</span>, <span class="hljs-number">25</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> PENALTIES <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">7</span>, <span class="hljs-number">44</span>, <span class="hljs-string">&#x27;1982-12-30&#x27;</span>, <span class="hljs-number">30</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> PENALTIES <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">8</span>, <span class="hljs-number">27</span>, <span class="hljs-string">&#x27;1984-11-12&#x27;</span>, <span class="hljs-number">75</span>);<br></code></pre></td></tr></table></figure><h2 id="è¡¨å­æŸ¥è¯¢å®ä¾‹"><a href="#è¡¨å­æŸ¥è¯¢å®ä¾‹" class="headerlink" title="è¡¨å­æŸ¥è¯¢å®ä¾‹"></a>è¡¨å­æŸ¥è¯¢å®ä¾‹</h2><p>å¦‚ï¼šè·å–ç¼–å·å°äº10çš„ç”·æ€§çƒå‘˜çš„å·ç </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> playerno <span class="hljs-keyword">from</span> (<br>    <span class="hljs-keyword">select</span> playerno, sex <br>    <span class="hljs-keyword">from</span> players <br>    <span class="hljs-keyword">where</span> playerno <span class="hljs-operator">&lt;</span> <span class="hljs-number">10</span>) <br><span class="hljs-keyword">as</span> players10 <span class="hljs-keyword">where</span> sex<span class="hljs-operator">=</span><span class="hljs-string">&#x27;M&#x27;</span>;<br></code></pre></td></tr></table></figure><h2 id="è¡Œå­æŸ¥è¯¢å®ä¾‹"><a href="#è¡Œå­æŸ¥è¯¢å®ä¾‹" class="headerlink" title="è¡Œå­æŸ¥è¯¢å®ä¾‹"></a>è¡Œå­æŸ¥è¯¢å®ä¾‹</h2><p>å¦‚ï¼šè·å–å’Œ100å·çƒå‘˜æ€§åˆ«ç›¸åŒå¹¶ä¸”å±…ä½åœ¨åŒä¸€åŸå¸‚çš„çƒå‘˜å·ç ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> playerno <br><span class="hljs-keyword">from</span> players <br><span class="hljs-keyword">where</span> (sex, town) <span class="hljs-operator">=</span> (<br>    <span class="hljs-keyword">select</span> sex, town <br>    <span class="hljs-keyword">from</span> players <br>    <span class="hljs-keyword">where</span> playerno <span class="hljs-operator">=</span> <span class="hljs-number">100</span>);<br></code></pre></td></tr></table></figure><p>è¯´æ˜ï¼šå­æŸ¥è¯¢çš„ç»“æœæ˜¯å¸¦æœ‰ä¸¤ä¸ªå€¼çš„ä¸€è¡Œï¼šï¼ˆâ€™Mâ€™,â€™stratfordâ€™ï¼‰ã€‚è¿™ä¸ªå€¼å’Œä¸€ä¸ªè¡Œè¡¨è¾¾å¼ï¼ˆsex,townï¼‰è¿›è¡Œæ¯”è¾ƒã€‚</p><h2 id="æ ‡é‡å­æŸ¥è¯¢å®ä¾‹"><a href="#æ ‡é‡å­æŸ¥è¯¢å®ä¾‹" class="headerlink" title="æ ‡é‡å­æŸ¥è¯¢å®ä¾‹"></a>æ ‡é‡å­æŸ¥è¯¢å®ä¾‹</h2><p>å¯ä»¥æŒ‡å®šä¸€ä¸ªæ ‡é‡è¡¨è¾¾å¼çš„ä»»ä½•åœ°æ–¹ï¼Œå‡ ä¹éƒ½å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ ‡é‡å­æŸ¥è¯¢ã€‚ å¦‚ï¼šè·å–å’Œ27å·çƒå‘˜å‡ºç”Ÿåœ¨åŒä¸€å¹´çš„çƒå‘˜çš„å·ç </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> playerno <br><span class="hljs-keyword">from</span> players <br><span class="hljs-keyword">where</span> <span class="hljs-keyword">year</span>(birth_date) <span class="hljs-operator">=</span> <br>    (<span class="hljs-keyword">select</span> <span class="hljs-keyword">year</span>(birth_date) <br>    <span class="hljs-keyword">from</span> players <br>    <span class="hljs-keyword">where</span> playerno <span class="hljs-operator">=</span> <span class="hljs-number">27</span>) <br><span class="hljs-keyword">and</span> playerno <span class="hljs-operator">&lt;&gt;</span> <span class="hljs-number">27</span>;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢è¯­å¥ç­‰åŒäºï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> playerno <span class="hljs-keyword">from</span> players <span class="hljs-keyword">where</span> <span class="hljs-keyword">year</span>(birth_date) <span class="hljs-operator">=</span> <span class="hljs-number">1964</span> <span class="hljs-keyword">and</span> playerno <span class="hljs-operator">&lt;&gt;</span> <span class="hljs-number">27</span>;<br></code></pre></td></tr></table></figure><h2 id="åˆ—å­æŸ¥è¯¢å®ä¾‹"><a href="#åˆ—å­æŸ¥è¯¢å®ä¾‹" class="headerlink" title="åˆ—å­æŸ¥è¯¢å®ä¾‹"></a>åˆ—å­æŸ¥è¯¢å®ä¾‹</h2><p> ç”±äºåˆ—å­æŸ¥è¯¢è¿”å›çš„ç»“æœé›†æ˜¯ N è¡Œä¸€åˆ—ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥ä½¿ç”¨ =  &gt;  &lt;  &gt;=  &lt;=  &lt;&gt; è¿™äº›æ¯”è¾ƒæ ‡é‡ç»“æœçš„æ“ä½œç¬¦ã€‚åœ¨åˆ—å­æŸ¥è¯¢ä¸­å¯ä»¥ä½¿ç”¨ INã€ANYï¼ˆSOMEï¼‰å’ŒALLæ“ä½œç¬¦ï¼š   INï¼šåœ¨æŒ‡å®šé¡¹å†…ï¼ŒåŒ IN(é¡¹1,é¡¹2,â€¦)ã€‚   ANYï¼šä¸æ¯”è¾ƒæ“ä½œç¬¦è”åˆä½¿ç”¨ï¼ŒANYå…³é”®å­—å¿…é¡»æ¥åœ¨ä¸€ä¸ªæ¯”è¾ƒæ“ä½œç¬¦çš„åé¢ï¼Œè¡¨ç¤ºä¸å­æŸ¥è¯¢è¿”å›çš„ä»»ä½•å€¼æ¯”è¾ƒä¸º TRUE ï¼Œåˆ™è¿”å› TRUE ã€‚   SOMEï¼šANY çš„åˆ«åï¼Œè¾ƒå°‘ä½¿ç”¨ã€‚   ALLï¼šä¸æ¯”è¾ƒæ“ä½œç¬¦è”åˆä½¿ç”¨ï¼ŒALLå…³é”®å­—å¿…é¡»æ¥åœ¨ä¸€ä¸ªæ¯”è¾ƒæ“ä½œç¬¦çš„åé¢ï¼Œè¡¨ç¤ºä¸å­æŸ¥è¯¢è¿”å›çš„æ‰€æœ‰å€¼æ¯”è¾ƒéƒ½ä¸º TRUE ï¼Œåˆ™è¿”å› TRUE ã€‚</p><p>  å®ä¾‹1ï¼ˆinï¼‰ï¼šè·å–çƒå‘˜æ€§åˆ«ä¸ºå¥³çš„æ‰€æœ‰çƒå‘˜çš„çƒå‘˜å·ï¼Œåå­—åŠæ‰€åœ¨åŸå¸‚ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> playerno, name, town <br><span class="hljs-keyword">from</span> players <br><span class="hljs-keyword">where</span> playerno <span class="hljs-keyword">in</span> <br>    (<span class="hljs-keyword">select</span> playerno <br>    <span class="hljs-keyword">from</span> players <br>    <span class="hljs-keyword">where</span> sex <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;F&#x27;</span>);<br></code></pre></td></tr></table></figure><p>å®ä¾‹2ï¼ˆanyï¼‰ï¼šè·å–è‡³å°‘æ¯”åŒåŸçš„å¦ä¸€çƒå‘˜å¹´è½»çš„æ‰€æœ‰çƒå‘˜çš„å·ç ï¼Œæ—¥æœŸå’Œå±…ä½åŸå¸‚ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> playerno, birth_date, town <br><span class="hljs-keyword">from</span> players <span class="hljs-keyword">as</span> p1 <br><span class="hljs-keyword">where</span> birth_date <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">any</span> <br>    (<span class="hljs-keyword">select</span> birth_date <br>    <span class="hljs-keyword">from</span> players <span class="hljs-keyword">as</span> p2 <br>    <span class="hljs-keyword">where</span> p1.town <span class="hljs-operator">=</span> p2.town);<br></code></pre></td></tr></table></figure><p>å®ä¾‹3ï¼ˆallï¼‰ï¼šè·å–æœ€è€çƒå‘˜çš„å·ç ï¼Œåå­—åŠç”Ÿæ—¥ã€‚ï¼ˆå³å‡ºç”Ÿæ—¥æœŸæ•°å€¼å°äºæˆ–ç­‰äºæ‰€æœ‰å…¶å®ƒçƒå‘˜çš„çƒå‘˜ï¼‰</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> playerno, name, birth_date <br><span class="hljs-keyword">from</span> players <br><span class="hljs-keyword">where</span> birth_date <span class="hljs-operator">&lt;=</span> <span class="hljs-keyword">all</span> <br>    (<span class="hljs-keyword">select</span> birth_date <br>    <span class="hljs-keyword">from</span> players);<br></code></pre></td></tr></table></figure><p>XISTSå…³é”®å­—è¡¨ç¤ºå­˜åœ¨ã€‚ä½¿ç”¨EXISTSå…³é”®å­—æ—¶ï¼Œå†…å±‚æŸ¥è¯¢è¯­å¥ä¸è¿”å›æŸ¥è¯¢çš„è®°å½•ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªçœŸå‡å€¼ï¼Œå¦‚æœå†…å±‚æŸ¥è¯¢è¯­å¥æŸ¥è¯¢åˆ°æ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼Œåªè¦å­æŸ¥è¯¢ä¸­è‡³å°‘è¿”å›ä¸€ä¸ªå€¼ï¼Œåˆ™EXISTSè¯­å¥çš„å€¼å°±ä¸ºTrueã€‚å°±è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚å½“è¿”å›çš„å€¼ä¸ºtrueæ—¶ï¼Œå¤–å±‚æŸ¥è¯¢è¯­å¥å°†è¿›è¡ŒæŸ¥è¯¢ï¼Œå¦åˆ™ä¸è¿›è¡ŒæŸ¥è¯¢ã€‚NOT EXISTSåˆšå¥½ä¸ä¹‹ç›¸åã€‚existsçš„ç”¨æ³•å’Œin ()å·®ä¸å¤šï¼Œä½†æ˜¯å®ƒä»¬è¿˜æ˜¯æœ‰åŒºåˆ«çš„ã€‚ä¸»è¦æ˜¯çœ‹ä¸¤ä¸ªå¼ è¡¨å¤§å°å·®çš„ç¨‹åº¦ã€‚è‹¥å­æŸ¥è¯¢è¡¨å¤§åˆ™ç”¨existsï¼ˆå†…å±‚ç´¢å¼•ï¼‰ï¼Œå­æŸ¥è¯¢è¡¨å°åˆ™ç”¨inï¼ˆå¤–å±‚ç´¢å¼•ï¼‰;</p><p>  å®ä¾‹1ï¼ˆexistsï¼‰ï¼šè·å–é‚£äº›è‡³å°‘æ”¯ä»˜äº†ä¸€æ¬¡ç½šæ¬¾çš„çƒå‘˜çš„åå­—å’Œé¦–å­—æ¯ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> name, initials <br><span class="hljs-keyword">from</span> players <br><span class="hljs-keyword">where</span> <span class="hljs-keyword">exists</span> <br>    (<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> penalties <br>    <span class="hljs-keyword">where</span> playerno <span class="hljs-operator">=</span> players.playerno);<br></code></pre></td></tr></table></figure><p>å®ä¾‹2ï¼ˆnot existsï¼‰ï¼šè·å–é‚£äº›ä»æ¥æ²¡æœ‰ç½šæ¬¾çš„çƒå‘˜çš„åå­—å’Œé¦–å­—æ¯ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> name, initials <br><span class="hljs-keyword">from</span> players <br><span class="hljs-keyword">where</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> <br>    (<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> penalties <br>    <span class="hljs-keyword">where</span> playerno <span class="hljs-operator">=</span> players.playerno);<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>æ•°æ®åº“</tag>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>javaè¯­è¨€æè¿°æ•°æ®ç»“æ„ä¸ç®—æ³•</title>
    <link href="/blog/2021/01/20/java%E8%AF%AD%E8%A8%80%E6%8F%8F%E8%BF%B0%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"/>
    <url>/blog/2021/01/20/java%E8%AF%AD%E8%A8%80%E6%8F%8F%E8%BF%B0%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<p>å†’æ³¡æ’åº æ’å…¥æ’åº é€‰æ‹©æ’åº å¸Œå°”æ’åº å¿«é€Ÿæ’åº å½’å¹¶æ’åº äºŒåˆ†æŸ¥æ‰¾</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br></pre></td><td class="code"><pre><code class="hljs java"> <br><span class="hljs-keyword">package</span> com.demo.test;<br> <br><span class="hljs-keyword">import</span> java.util.Arrays;<br><span class="hljs-keyword">import</span> java.util.Scanner;<br> <br> <br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestDemo</span></span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>    <span class="hljs-comment">//éšæœºè¾“å…¥nä¸ªæ•°,å­˜æ”¾åœ¨æ•°ç»„aä¸­</span><br>    Scanner scanner=<span class="hljs-keyword">new</span> Scanner(System.in);<br>    <span class="hljs-keyword">int</span> n=scanner.nextInt();<br>    <span class="hljs-keyword">int</span> a[]=<span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[n];<br>    <span class="hljs-comment">//è¿™æ˜¯ç¬¬ä¸€ç§è¾“å…¥æ–¹æ³•</span><br>    <span class="hljs-comment">/*for (int i=0;i&lt;n;i++) &#123;</span><br><span class="hljs-comment">    a[i]=scanner.nextInt();</span><br><span class="hljs-comment">    &#125;*/</span><br>    <span class="hljs-comment">//è¿™æ˜¯ç¬¬äºŒç§è¾“å…¥æ–¹æ³•</span><br>    <span class="hljs-keyword">int</span> k=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span>(<span class="hljs-keyword">true</span>) &#123;<br>    <span class="hljs-keyword">if</span>(k&lt;n) &#123;<br>    a[k]=scanner.nextInt();<br>    k++;<br>    &#125;<span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">break</span>;<br>    &#125;<br>    &#125;<br>    <br>    <span class="hljs-keyword">int</span>[] b=choicSort(a);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j=<span class="hljs-number">0</span>;j&lt;b.length;j++) &#123;<br>    System.out.print(b[j]+<span class="hljs-string">&quot;  &quot;</span>);<br>    &#125;<br>    &#125;<br>    <br><br><span class="hljs-comment">//å†’æ³¡æ’åº</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span>[] bubbleSort(<span class="hljs-keyword">int</span>[] array) &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;array.length;i++) &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j=<span class="hljs-number">0</span>;j&lt;array.length-i;j++) &#123;<br><span class="hljs-keyword">if</span> (array[j]&gt;array[j+<span class="hljs-number">1</span>]) &#123;<br><span class="hljs-keyword">int</span> temp=array[j];<br>array[j]=array[j+<span class="hljs-number">1</span>];<br>array[j+<span class="hljs-number">1</span>]=temp;<br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> array;<br>&#125;<br><br><span class="hljs-comment">//æ’å…¥æ’åº</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span>[] insertSort(<span class="hljs-keyword">int</span>[] array) &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;array.length;i++) &#123;<br><span class="hljs-keyword">int</span> j=i;<br><span class="hljs-keyword">int</span> temp=array[i];<br><span class="hljs-keyword">while</span> (j&gt;<span class="hljs-number">0</span>&amp;&amp;array[j-<span class="hljs-number">1</span>]&gt;temp) &#123;<br>array[j]=array[j-<span class="hljs-number">1</span>];<br>j--;<br>&#125;<br>array[j]=temp;<br>&#125;<br><span class="hljs-keyword">return</span> array;<br>&#125;<br><br><span class="hljs-comment">//é€‰æ‹©æ’åº</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span>[] choicSort(<span class="hljs-keyword">int</span>[] array) &#123;<br><br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;array.length-<span class="hljs-number">1</span>;i++) &#123;<br><span class="hljs-keyword">int</span> min=i;<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j=i+<span class="hljs-number">1</span>;j&lt;array.length;j++) &#123;<br><span class="hljs-keyword">if</span> (array[j]&lt;array[min]) &#123;<br>min=j;<br>&#125;<br>&#125;<br><span class="hljs-keyword">if</span> (min!=i) &#123;<br><span class="hljs-keyword">int</span> temp=array[i];<br>array[i]=array[min];<br>array[min]=temp;<br>&#125;<br>&#125;<br><br><span class="hljs-keyword">return</span> array;<br>&#125;<br><br><span class="hljs-comment">//å¸Œå°”æ’åº</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span>[] shellSort(<span class="hljs-keyword">int</span>[] array) &#123;<br><span class="hljs-keyword">int</span> step=(array.length-<span class="hljs-number">1</span>)/<span class="hljs-number">2</span>;<br><span class="hljs-keyword">while</span> (step&gt;<span class="hljs-number">0</span>) &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=step;i&lt;array.length;i++) &#123;<br><span class="hljs-keyword">int</span> j=i;<br><span class="hljs-keyword">int</span> temp=array[i];<br><span class="hljs-keyword">while</span>(j&gt;(step-<span class="hljs-number">1</span>)&amp;&amp;array[j-step]&gt;=temp) &#123;<br>array[j]=array[j-step];<br>j=j-step;<br>&#125;<br>array[j]=temp;<br>&#125;<br>step=step/<span class="hljs-number">2</span>;<br>&#125;<br><span class="hljs-keyword">return</span> array;<br>&#125;<br><br><span class="hljs-comment">//å¿«é€Ÿæ’åº</span><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">quickSort</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] array)</span> </span>&#123;<br>reQuickSort(array,<span class="hljs-number">0</span>,array.length-<span class="hljs-number">1</span>);<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">reQuickSort</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] array,<span class="hljs-keyword">int</span> left,<span class="hljs-keyword">int</span> right)</span> </span>&#123;<br><span class="hljs-keyword">if</span> (left&gt;=right) &#123;<br><span class="hljs-keyword">return</span> ;<br>&#125;<span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">int</span> partition=partitionIt(array,left,right);<br>reQuickSort(array,left,partition-<span class="hljs-number">1</span>);<br>reQuickSort(array,partition+<span class="hljs-number">1</span>,right);<br>&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">partitionIt</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] array,<span class="hljs-keyword">int</span> left,<span class="hljs-keyword">int</span> right)</span> </span>&#123;<br><span class="hljs-keyword">int</span> i=left;<br><span class="hljs-keyword">int</span> j=right+<span class="hljs-number">1</span>;<br><span class="hljs-keyword">int</span> povit=array[left];<br><span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;<br><span class="hljs-keyword">while</span> (i&lt;right&amp;&amp;array[++i]&lt;povit) &#123;&#125;<br><span class="hljs-keyword">while</span> (j&gt;<span class="hljs-number">0</span>&amp;&amp;array[--j]&gt;povit) &#123;&#125;<br><span class="hljs-keyword">if</span> (i&lt;j) &#123;<br>swap(array,i,j);<br>&#125;<span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">break</span>;<br>&#125;<br>&#125;<br>swap(array,left,j);<br><span class="hljs-keyword">return</span> j;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">swap</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] array,<span class="hljs-keyword">int</span> i,<span class="hljs-keyword">int</span> j)</span> </span>&#123;<br><span class="hljs-keyword">int</span> temp=array[i];<br>array[i]=array[j];<br>array[j]=temp;<br>&#125;<br> <br> <br><span class="hljs-comment">//å½’å¹¶æ’åº</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span>[] sort(<span class="hljs-keyword">int</span>[] a,<span class="hljs-keyword">int</span> low,<span class="hljs-keyword">int</span> high)&#123;<br>        <span class="hljs-keyword">int</span> mid = (low+high)/<span class="hljs-number">2</span>;<br>        <span class="hljs-keyword">if</span>(low&lt;high)&#123;<br>            sort(a,low,mid);<br>            sort(a,mid+<span class="hljs-number">1</span>,high);<br>            <span class="hljs-comment">//å·¦å³å½’å¹¶</span><br>            merge(a,low,mid,high);<br>        &#125;<br>        <span class="hljs-keyword">return</span> a;<br>    &#125;<br>     <br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">merge</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] a, <span class="hljs-keyword">int</span> low, <span class="hljs-keyword">int</span> mid, <span class="hljs-keyword">int</span> high)</span> </span>&#123;<br>        <span class="hljs-keyword">int</span>[] temp = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[high-low+<span class="hljs-number">1</span>];<br>        <span class="hljs-keyword">int</span> i= low;<br>        <span class="hljs-keyword">int</span> j = mid+<span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">int</span> k=<span class="hljs-number">0</span>;<br>        <span class="hljs-comment">// æŠŠè¾ƒå°çš„æ•°å…ˆç§»åˆ°æ–°æ•°ç»„ä¸­</span><br>        <span class="hljs-keyword">while</span>(i&lt;=mid &amp;&amp; j&lt;=high)&#123;<br>            <span class="hljs-keyword">if</span>(a[i]&lt;a[j])&#123;<br>                temp[k++] = a[i++];<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                temp[k++] = a[j++];<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">// æŠŠå·¦è¾¹å‰©ä½™çš„æ•°ç§»å…¥æ•°ç»„ </span><br>        <span class="hljs-keyword">while</span>(i&lt;=mid)&#123;<br>            temp[k++] = a[i++];<br>        &#125;<br>        <span class="hljs-comment">// æŠŠå³è¾¹è¾¹å‰©ä½™çš„æ•°ç§»å…¥æ•°ç»„</span><br>        <span class="hljs-keyword">while</span>(j&lt;=high)&#123;<br>            temp[k++] = a[j++];<br>        &#125;<br>        <span class="hljs-comment">// æŠŠæ–°æ•°ç»„ä¸­çš„æ•°è¦†ç›–numsæ•°ç»„</span><br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> x=<span class="hljs-number">0</span>;x&lt;temp.length;x++)&#123;<br>            a[x+low] = temp[x];<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">//äºŒåˆ†æŸ¥æ‰¾</span><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">binarySerach</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] array,<span class="hljs-keyword">int</span> left,<span class="hljs-keyword">int</span> right,<span class="hljs-keyword">int</span> value)</span> </span>&#123;<br><span class="hljs-keyword">int</span> i=left;<br><span class="hljs-keyword">int</span> j=right;<br><span class="hljs-keyword">int</span> mid=(i+j)/<span class="hljs-number">2</span>;<br><span class="hljs-keyword">if</span> (i&gt;j) &#123;<br><span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br>&#125;<br><span class="hljs-keyword">if</span> (array[mid]&gt;value) &#123;<br><span class="hljs-keyword">return</span> binarySerach(array,<span class="hljs-number">0</span>,mid-<span class="hljs-number">1</span>,value);<br>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(array[mid]&lt;value)&#123;<br><span class="hljs-keyword">return</span> binarySerach(array,mid+<span class="hljs-number">1</span>,right,value);<br>&#125;<span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">return</span> mid;<br>&#125;<br><br>&#125;<br><br>&#125;<br> <br> <br> <br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>é¢è¯•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>mysqlè¡Œåˆ—è½¬æ¢</title>
    <link href="/blog/2021/01/20/mysql%E8%A1%8C%E5%88%97%E8%BD%AC%E6%8D%A2/"/>
    <url>/blog/2021/01/20/mysql%E8%A1%8C%E5%88%97%E8%BD%AC%E6%8D%A2/</url>
    
    <content type="html"><![CDATA[<p>éœ€æ±‚æ˜¯å°†ä»¥ä¸‹ä¸¤ç§è¡¨æ ·å¼äº’ç›¸è½¬æ¢ï¼š<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/WX20190821-153724@2x_1566373118554.png" alt="WX20190821-153724@2x"></p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/WX20190821-153732@2x_1566373118567.png" alt="WX20190821-153732@2x">score_1è½¬score_2ï¼Œå¦‚ä¸‹ï¼š è¿™é‡Œä¹Ÿå¯ä»¥ç”¨æ¥ç»Ÿè®¡æ•°æ®</p><p>å¦‚æœç­‰äº1 å°±åŠ ä¸€ ä¸ç„¶å°±ä¸åŠ  SUM(IF(C.question_type = â€˜1â€™, 1, 0)) AS â€˜è®ºè¿°â€™</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> ID<br>    ,<span class="hljs-built_in">max</span>(<span class="hljs-keyword">case</span> <span class="hljs-keyword">when</span> course<span class="hljs-operator">=</span><span class="hljs-string">&#x27;æ•°å­¦&#x27;</span> <span class="hljs-keyword">then</span> score <span class="hljs-keyword">end</span>) <span class="hljs-keyword">as</span> <span class="hljs-string">&#x27;æ•°å­¦&#x27;</span><br>    ,<span class="hljs-built_in">max</span>(<span class="hljs-keyword">case</span> <span class="hljs-keyword">when</span> course<span class="hljs-operator">=</span><span class="hljs-string">&#x27;è‹±è¯­&#x27;</span> <span class="hljs-keyword">then</span> score <span class="hljs-keyword">end</span>) <span class="hljs-keyword">as</span> <span class="hljs-string">&#x27;è‹±è¯­&#x27;</span><br>    ,<span class="hljs-built_in">max</span>(<span class="hljs-keyword">case</span> <span class="hljs-keyword">when</span> course<span class="hljs-operator">=</span><span class="hljs-string">&#x27;æ³•å¾‹&#x27;</span> <span class="hljs-keyword">then</span> score <span class="hljs-keyword">end</span>) <span class="hljs-keyword">as</span> <span class="hljs-string">&#x27;æ³•å¾‹&#x27;</span><br><span class="hljs-keyword">from</span> score_1<br><span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> id;<br></code></pre></td></tr></table></figure><p>score_2è½¬score_1ï¼šä¸¤ç§å¼•å·ä¸åŒ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> id <br>    ,<span class="hljs-string">&#x27;æ•°å­¦&#x27;</span> <span class="hljs-keyword">as</span> course<br>    ,`æ•°å­¦` <span class="hljs-keyword">as</span> score<br><span class="hljs-keyword">from</span> score_2<br><span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span> <br><span class="hljs-keyword">select</span> id <br>    ,<span class="hljs-string">&#x27;è‹±è¯­&#x27;</span> <span class="hljs-keyword">as</span> course<br>    ,`è‹±è¯­` <span class="hljs-keyword">as</span> score<br><span class="hljs-keyword">from</span> score_2<br><span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span> <br><span class="hljs-keyword">select</span> id <br>    ,<span class="hljs-string">&#x27;æ³•å¾‹&#x27;</span> <span class="hljs-keyword">as</span> course<br>    ,`æ³•å¾‹` <span class="hljs-keyword">as</span> score<br><span class="hljs-keyword">from</span> score_2<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>æ•°æ®åº“</tag>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å·¦è¿æ¥-å³è¿æ¥-å†…è¿æ¥-å…¨å¤–è¿æ¥çš„4è€…åŒºåˆ«</title>
    <link href="/blog/2021/01/20/%E5%B7%A6%E8%BF%9E%E6%8E%A5-%E5%8F%B3%E8%BF%9E%E6%8E%A5-%E5%86%85%E8%BF%9E%E6%8E%A5-%E5%85%A8%E5%A4%96%E8%BF%9E%E6%8E%A5%E7%9A%844%E8%80%85%E5%8C%BA%E5%88%AB/"/>
    <url>/blog/2021/01/20/%E5%B7%A6%E8%BF%9E%E6%8E%A5-%E5%8F%B3%E8%BF%9E%E6%8E%A5-%E5%86%85%E8%BF%9E%E6%8E%A5-%E5%85%A8%E5%A4%96%E8%BF%9E%E6%8E%A5%E7%9A%844%E8%80%85%E5%8C%BA%E5%88%AB/</url>
    
    <content type="html"><![CDATA[<h1 id="åŸºæœ¬å®šä¹‰ï¼š"><a href="#åŸºæœ¬å®šä¹‰ï¼š" class="headerlink" title="åŸºæœ¬å®šä¹‰ï¼š"></a>åŸºæœ¬å®šä¹‰ï¼š</h1><p>ã€€ã€€left join ï¼ˆå·¦è¿æ¥ï¼‰ï¼šè¿”å›åŒ…æ‹¬å·¦è¡¨ä¸­çš„æ‰€æœ‰è®°å½•å’Œå³è¡¨ä¸­è¿æ¥å­—æ®µç›¸ç­‰çš„è®°å½•ã€‚</p><p>ã€€ã€€right join ï¼ˆå³è¿æ¥ï¼‰ï¼šè¿”å›åŒ…æ‹¬å³è¡¨ä¸­çš„æ‰€æœ‰è®°å½•å’Œå·¦è¡¨ä¸­è¿æ¥å­—æ®µç›¸ç­‰çš„è®°å½•ã€‚</p><p>ã€€ã€€inner join ï¼ˆç­‰å€¼è¿æ¥æˆ–è€…å«å†…è¿æ¥ï¼‰ï¼šåªè¿”å›ä¸¤ä¸ªè¡¨ä¸­è¿æ¥å­—æ®µç›¸ç­‰çš„è¡Œã€‚</p><p>ã€€ã€€full join ï¼ˆå…¨å¤–è¿æ¥ï¼‰ï¼šè¿”å›å·¦å³è¡¨ä¸­æ‰€æœ‰çš„è®°å½•å’Œå·¦å³è¡¨ä¸­è¿æ¥å­—æ®µç›¸ç­‰çš„è®°å½•ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sql">ã€€Aè¡¨ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€<br> <br>ã€€ã€€idã€€  nameã€€ã€€<br> <br>ã€€ã€€<span class="hljs-number">1</span>ã€€ã€€å°ç‹<br> <br>ã€€ã€€<span class="hljs-number">2</span>ã€€ã€€å°æ<br> <br>ã€€ã€€<span class="hljs-number">3</span>ã€€ã€€å°åˆ˜<br> <br>ã€€ã€€Bè¡¨<br> <br>ã€€ã€€idã€€ã€€A_idã€€ã€€job<br> <br>ã€€ã€€<span class="hljs-number">1</span>ã€€ã€€<span class="hljs-number">2</span>ã€€ã€€ã€€ã€€è€å¸ˆ<br> <br>ã€€ã€€<span class="hljs-number">2</span>ã€€ã€€<span class="hljs-number">4</span>ã€€ã€€ã€€ã€€ç¨‹åºå‘˜<br></code></pre></td></tr></table></figure><h2 id="å†…è¿æ¥ï¼šï¼ˆåªæœ‰2å¼ è¡¨åŒ¹é…çš„è¡Œæ‰èƒ½æ˜¾ç¤ºï¼‰"><a href="#å†…è¿æ¥ï¼šï¼ˆåªæœ‰2å¼ è¡¨åŒ¹é…çš„è¡Œæ‰èƒ½æ˜¾ç¤ºï¼‰" class="headerlink" title="å†…è¿æ¥ï¼šï¼ˆåªæœ‰2å¼ è¡¨åŒ¹é…çš„è¡Œæ‰èƒ½æ˜¾ç¤ºï¼‰"></a>å†…è¿æ¥ï¼šï¼ˆåªæœ‰2å¼ è¡¨åŒ¹é…çš„è¡Œæ‰èƒ½æ˜¾ç¤ºï¼‰</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> a.name,b.job <span class="hljs-keyword">from</span> A a  <span class="hljs-keyword">inner</span> <span class="hljs-keyword">join</span> B b <span class="hljs-keyword">on</span> a.id<span class="hljs-operator">=</span>b.A_id<br> <br>ã€€ã€€åªèƒ½å¾—åˆ°ä¸€æ¡è®°å½•<br> <br>ã€€ã€€å°æã€€ã€€è€å¸ˆ<br></code></pre></td></tr></table></figure><h2 id="å·¦è¿æ¥ï¼šï¼ˆå·¦è¾¹çš„è¡¨ä¸åŠ é™åˆ¶ï¼‰"><a href="#å·¦è¿æ¥ï¼šï¼ˆå·¦è¾¹çš„è¡¨ä¸åŠ é™åˆ¶ï¼‰" class="headerlink" title="å·¦è¿æ¥ï¼šï¼ˆå·¦è¾¹çš„è¡¨ä¸åŠ é™åˆ¶ï¼‰"></a>å·¦è¿æ¥ï¼šï¼ˆå·¦è¾¹çš„è¡¨ä¸åŠ é™åˆ¶ï¼‰</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> a.name,b.job <span class="hljs-keyword">from</span> A a  <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> B b <span class="hljs-keyword">on</span> a.id<span class="hljs-operator">=</span>b.A_id<br> <br>ã€€ã€€ä¸‰æ¡è®°å½•<br> <br>ã€€ã€€å°ç‹ã€€ã€€<span class="hljs-keyword">null</span><br> <br>ã€€ã€€å°æã€€ã€€è€å¸ˆ<br> <br>ã€€ã€€å°åˆ˜ã€€ã€€<span class="hljs-keyword">null</span><br></code></pre></td></tr></table></figure><h2 id="å³è¿æ¥ï¼šï¼ˆå³è¾¹çš„è¡¨ä¸åŠ é™åˆ¶ï¼‰"><a href="#å³è¿æ¥ï¼šï¼ˆå³è¾¹çš„è¡¨ä¸åŠ é™åˆ¶ï¼‰" class="headerlink" title="å³è¿æ¥ï¼šï¼ˆå³è¾¹çš„è¡¨ä¸åŠ é™åˆ¶ï¼‰"></a>å³è¿æ¥ï¼šï¼ˆå³è¾¹çš„è¡¨ä¸åŠ é™åˆ¶ï¼‰</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> a.name,b.job <span class="hljs-keyword">from</span> A a  <span class="hljs-keyword">right</span> <span class="hljs-keyword">join</span> B b <span class="hljs-keyword">on</span> a.id<span class="hljs-operator">=</span>b.A_id<br> <br>ã€€ã€€ä¸¤æ¡è®°å½•<br> <br>ã€€ã€€å°æã€€ã€€è€å¸ˆ<br> <br>ã€€ã€€<span class="hljs-keyword">null</span>ã€€ã€€ç¨‹åºå‘˜<br></code></pre></td></tr></table></figure><h2 id="å…¨å¤–è¿æ¥ï¼š-å·¦å³2å¼ è¡¨éƒ½ä¸åŠ é™åˆ¶ï¼‰"><a href="#å…¨å¤–è¿æ¥ï¼š-å·¦å³2å¼ è¡¨éƒ½ä¸åŠ é™åˆ¶ï¼‰" class="headerlink" title="å…¨å¤–è¿æ¥ï¼š(å·¦å³2å¼ è¡¨éƒ½ä¸åŠ é™åˆ¶ï¼‰"></a>å…¨å¤–è¿æ¥ï¼š(å·¦å³2å¼ è¡¨éƒ½ä¸åŠ é™åˆ¶ï¼‰</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> a.name,b.job <span class="hljs-keyword">from</span> A a  <span class="hljs-keyword">full</span> <span class="hljs-keyword">join</span> B b <span class="hljs-keyword">on</span> a.id<span class="hljs-operator">=</span>b.A_id<br> <br>ã€€ã€€å››æ¡æ•°æ®<br> <br>ã€€ã€€å°ç‹ã€€ã€€<span class="hljs-keyword">null</span><br> <br>ã€€ã€€å°æã€€ã€€è€å¸ˆ<br> <br>ã€€ã€€å°åˆ˜ã€€ã€€<span class="hljs-keyword">null</span><br> <br>ã€€ã€€<span class="hljs-keyword">null</span>ã€€ã€€ç¨‹åºå‘˜<br></code></pre></td></tr></table></figure><p>æ³¨ï¼šåœ¨sqlä¸­lå¤–è¿æ¥åŒ…æ‹¬å·¦è¿æ¥ï¼ˆleft join ï¼‰å’Œå³è¿æ¥ï¼ˆright joinï¼‰ï¼Œå…¨å¤–è¿æ¥ï¼ˆfull joinï¼‰ï¼Œç­‰å€¼è¿æ¥ï¼ˆinner joinï¼‰åˆå«å†…è¿æ¥ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>æ•°æ®åº“</tag>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>mysqlåŸºæœ¬æ“ä½œå‘½ä»¤æ±‡æ€»</title>
    <link href="/blog/2021/01/19/mysql%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4%E6%B1%87%E6%80%BB/"/>
    <url>/blog/2021/01/19/mysql%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4%E6%B1%87%E6%80%BB/</url>
    
    <content type="html"><![CDATA[<h1 id="åŸºæœ¬æ“ä½œ"><a href="#åŸºæœ¬æ“ä½œ" class="headerlink" title="åŸºæœ¬æ“ä½œ"></a>åŸºæœ¬æ“ä½œ</h1><h2 id="å…³äºæ•°æ®åº“"><a href="#å…³äºæ•°æ®åº“" class="headerlink" title="å…³äºæ•°æ®åº“"></a>å…³äºæ•°æ®åº“</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">/</span><span class="hljs-operator">/</span>åˆ›å»ºæ•°æ®åº“<br><span class="hljs-keyword">create</span> database h_test;        <br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>æŸ¥çœ‹æ•°æ®åº“<br><span class="hljs-keyword">show</span> databases;  <br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>æŸ¥çœ‹æ•°æ®åº“ä¿¡æ¯    <br><span class="hljs-keyword">show</span> <span class="hljs-keyword">create</span> database h_test;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>ä¿®æ”¹æ•°æ®åº“çš„ç¼–ç ï¼Œå¯ä½¿ç”¨ä¸Šä¸€æ¡è¯­å¥æŸ¥çœ‹æ˜¯å¦ä¿®æ”¹æˆåŠŸ<br><span class="hljs-keyword">alter</span> database h_test <span class="hljs-keyword">default</span> <span class="hljs-type">character</span> <span class="hljs-keyword">set</span> gbk <span class="hljs-keyword">collate</span> gbk_bin;      <br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>åˆ é™¤æ•°æ®åº“<br><span class="hljs-keyword">drop</span> database h_test;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>ç»¼ä¸Šï¼Œå¯ä»¥ç›´æ¥åˆ›å»ºæ•°æ®åº“ä¸”è®¾ç½®ç¼–ç æ–¹å¼<br><span class="hljs-keyword">CREATE</span> DATABASE h_test <span class="hljs-keyword">DEFAULT</span> <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>é¦–å…ˆé€‰å®šæ“ä½œçš„æ•°æ®åº“<br>use h_test;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>åˆ›å»ºè¡¨student<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> student(<br>  id  <span class="hljs-type">int</span>(<span class="hljs-number">11</span>),<br>  name  <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>),<br>  age <span class="hljs-type">int</span>(<span class="hljs-number">11</span>)<br>);<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>æŸ¥çœ‹æ•°æ®è¡¨<br><span class="hljs-keyword">show</span> tables;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>æŸ¥çœ‹æ•°æ®è¡¨ä¿¡æ¯ï¼Œåé¢åŠ ä¸Šå‚æ•°<span class="hljs-operator">/</span>Gå¯ä½¿ç»“æœæ›´åŠ ç¾è§‚<br><span class="hljs-keyword">show</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> student;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>æŸ¥çœ‹è¡¨çš„çš„å­—æ®µä¿¡æ¯<br><span class="hljs-keyword">desc</span> student;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>ä¿®æ”¹è¡¨å<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> student rename [<span class="hljs-keyword">to</span>] h_student;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>ä¿®æ”¹å­—æ®µå<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> h_student change name stu_name <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>);<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>ä¿®æ”¹å­—æ®µçš„æ•°æ®ç±»å‹<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> h_student modify id <span class="hljs-type">int</span>(<span class="hljs-number">20</span>);<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>æ·»åŠ å­—æ®µ<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> h_student <span class="hljs-keyword">add</span> grade <span class="hljs-type">float</span>;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>åˆ é™¤å­—æ®µ<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> h_student <span class="hljs-keyword">drop</span> grade;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>ä¿®æ”¹å­—æ®µçš„ä½ç½®<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> h_student modify stu_name <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">first</span>;<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> h_student modify id <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) after age;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>åˆ é™¤æ•°æ®è¡¨<br><span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> h_student;<br></code></pre></td></tr></table></figure><h2 id="è¡¨çš„çº¦æŸ"><a href="#è¡¨çš„çº¦æŸ" class="headerlink" title="è¡¨çš„çº¦æŸ"></a>è¡¨çš„çº¦æŸ</h2><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/WX20190820-155510@2x_1566287798018.png" alt="WX20190820-155510@2x"></p><h2 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h2><p>ä½œç”¨ï¼šæé«˜è¡¨ä¸­æ•°æ®çš„æŸ¥è¯¢é€Ÿåº¦ 1.æ™®é€šç´¢å¼• 2.å”¯ä¸€æ€§ç´¢å¼• 3.å…¨æ–‡ç´¢å¼• 4.å•åˆ—ç´¢å¼• 5.å¤šåˆ—ç´¢å¼• 6.ç©ºé—´ç´¢å¼•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">/</span><span class="hljs-operator">/</span>åˆ›å»ºç´¢å¼•<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>ä¸€.åˆ›å»ºè¡¨çš„æ—¶å€™åˆ›å»ºç´¢å¼•<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> è¡¨å(<br>        å­—æ®µå æ•°æ®ç±»å‹[å®Œæ•´æ€§çº¦æŸæ¡ä»¶],<br>        ...<br>        å­—æ®µå æ•°æ®ç±»å‹,<br>        [<span class="hljs-keyword">UNIQUE</span><span class="hljs-operator">|</span>FULLTEXT<span class="hljs-operator">|</span>SPATIAL] INDEX<span class="hljs-operator">|</span>KEY<br>  );<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-number">1</span><span class="hljs-number">-1.</span>åˆ›å»ºæ™®é€šç´¢å¼•<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> test1(<br>  id  <span class="hljs-type">INT</span>,<br>  name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),<br>  age <span class="hljs-type">INT</span>,<br>  INDEX (id)<br>);<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>å¯ä»¥æ’å…¥ä¸€æ¡æ•°æ®,æŸ¥çœ‹ç´¢å¼•æ˜¯å¦è¢«ä½¿ç”¨<br>explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> test1 <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span> \G;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-number">1</span><span class="hljs-number">-2.</span>åˆ›å»ºå”¯ä¸€æ€§ç´¢å¼•<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> test2(<br>  id  <span class="hljs-type">INT</span>,<br>  name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),<br>  age <span class="hljs-type">INT</span>,<br>  <span class="hljs-keyword">UNIQUE</span> INDEX unique_id(id <span class="hljs-keyword">asc</span>)<br>);<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-number">1</span><span class="hljs-number">-3.</span>åˆ›å»ºå…¨æ–‡ç´¢å¼•<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> test3(<br>  id  <span class="hljs-type">INT</span>,<br>  name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),<br>  age <span class="hljs-type">INT</span>,<br>  FULLTEXT INDEX fulltext_name(name)<br>)ENGINE<span class="hljs-operator">=</span>MyISAM;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-number">1</span><span class="hljs-number">-4.</span>åˆ›å»ºå•åˆ—ç´¢å¼•<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> test4(<br>  id  <span class="hljs-type">INT</span>,<br>  name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),<br>  age <span class="hljs-type">INT</span>,<br>  INDEX single_name(name(<span class="hljs-number">20</span>))<br>);<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-number">1</span><span class="hljs-number">-5.</span>åˆ›å»ºå¤šåˆ—ç´¢å¼•<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> test5(<br>  id  <span class="hljs-type">INT</span>,<br>  name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),<br>  age <span class="hljs-type">INT</span>,<br>  INDEX multi(id,name(<span class="hljs-number">20</span>))<br>);<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-number">1</span><span class="hljs-number">-6.</span>åˆ›å»ºç©ºé—´ç´¢å¼•<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> test6(<br>  id  <span class="hljs-type">INT</span>,<br>  space GEOMETRY <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  SPATIAL INDEX sp(space)<br>)ENGINE<span class="hljs-operator">=</span>MyISAM;<br><span class="hljs-comment">---------------------------------------------------</span><br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>äºŒ.ä½¿ç”¨<span class="hljs-keyword">create</span> indexè¯­å¥åœ¨å·²ç»å­˜åœ¨çš„è¡¨ä¸Šåˆ›å»ºç´¢å¼•<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>é¦–å…ˆæ–°å»ºä¸€ä¸ªè¡¨,è¿™ä¸ªè¡¨æ²¡æœ‰ç´¢å¼•<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> student(<br>  id <span class="hljs-type">int</span>,<br>  age <span class="hljs-type">int</span>,<br>  name <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>),<br>  intro <span class="hljs-type">varchar</span>(<span class="hljs-number">40</span>),<br>  g GEOMETRY <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span><br>)ENGINE<span class="hljs-operator">=</span>MyISAM;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-number">2</span><span class="hljs-number">-1.</span>åˆ›å»ºæ™®é€šç´¢å¼•<br><span class="hljs-keyword">create</span> index index_id <span class="hljs-keyword">on</span> student(id);<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-number">2</span><span class="hljs-number">-2.</span>åˆ›å»ºå”¯ä¸€æ€§ç´¢å¼•<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">unique</span> index uniqueidx <span class="hljs-keyword">on</span> student(id);<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-number">2</span><span class="hljs-number">-3.</span>åˆ›å»ºå•åˆ—ç´¢å¼•<br><span class="hljs-keyword">create</span> index singleidx <span class="hljs-keyword">on</span> student(age);<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-number">2</span><span class="hljs-number">-4.</span>åˆ›å»ºå¤šåˆ—ç´¢å¼•<br><span class="hljs-keyword">create</span> index mulitidx <span class="hljs-keyword">on</span> student(name(<span class="hljs-number">20</span>),intro(<span class="hljs-number">40</span>));<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-number">2</span><span class="hljs-number">-5.</span>åˆ›å»ºå…¨æ–‡ç´¢å¼•<br><span class="hljs-keyword">create</span> fulltext index fulltextidx <span class="hljs-keyword">on</span> student(name);<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-number">2</span><span class="hljs-number">-6.</span>åˆ›å»ºç©ºé—´ç´¢å¼•<br><span class="hljs-keyword">create</span> spatial index spatidx <span class="hljs-keyword">on</span> student(g); <br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>ä¸‰.ä½¿ç”¨<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span>è¯­å¥åœ¨å·²ç»å­˜åœ¨çš„è¡¨ä¸Šåˆ›å»ºç´¢å¼•<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>åˆ é™¤studentè¡¨ï¼Œé‡æ–°åˆ›å»º<br><span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> student;<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> student(<br>  id <span class="hljs-type">int</span>,<br>  age <span class="hljs-type">int</span>,<br>  name <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>),<br>  intro <span class="hljs-type">varchar</span>(<span class="hljs-number">40</span>),<br>  space GEOMETRY <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span><br>)ENGINE<span class="hljs-operator">=</span>MyISAM;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-number">3</span><span class="hljs-number">-1.</span>åˆ›å»ºæ™®é€šç´¢å¼•<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> student <span class="hljs-keyword">add</span> index index_id(id);<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-number">3</span><span class="hljs-number">-2.</span>åˆ›å»ºå”¯ä¸€æ€§ç´¢å¼•<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> student <span class="hljs-keyword">add</span> <span class="hljs-keyword">unique</span> uniqueidx(id);<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-number">3</span><span class="hljs-number">-3.</span>åˆ›å»ºå•åˆ—ç´¢å¼•<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> student <span class="hljs-keyword">add</span> index singleidx (age);<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-number">3</span><span class="hljs-number">-4.</span>åˆ›å»ºå¤šåˆ—ç´¢å¼•<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> student <span class="hljs-keyword">add</span> index multidx(name(<span class="hljs-number">20</span>),intro(<span class="hljs-number">40</span>));<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-number">3</span><span class="hljs-number">-5.</span>åˆ›å»ºå…¨æ–‡ç´¢å¼•<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> student <span class="hljs-keyword">add</span> fulltext index fulltextidx(name);<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-number">3</span><span class="hljs-number">-6.</span>åˆ›å»ºç©ºé—´ç´¢å¼•<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> student <span class="hljs-keyword">add</span> spatial index spatidx(space);<br> <br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>åˆ é™¤ç´¢å¼•ï¼Œæœ‰ä¸‹é¢ä¸¤ç§æ–¹å¼<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-number">1.</span>ä½¿ç”¨<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span>åˆ é™¤ç´¢å¼•fulltextidx<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> student <span class="hljs-keyword">drop</span> index fulltextidx;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-number">2.</span>ä½¿ç”¨<span class="hljs-keyword">drop</span> indexåˆ é™¤ç´¢å¼•spatidx<br><span class="hljs-keyword">drop</span> index spatidx <span class="hljs-keyword">on</span> student;<br> <br></code></pre></td></tr></table></figure><h2 id="æ·»åŠ æ•°æ®"><a href="#æ·»åŠ æ•°æ®" class="headerlink" title="æ·»åŠ æ•°æ®"></a>æ·»åŠ æ•°æ®</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">/</span><span class="hljs-operator">/</span>é‡æ–°å»ºç«‹è¡¨student<br><span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> student;<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> student(<br>  id <span class="hljs-type">int</span>,<br>  name <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,<br>  grade <span class="hljs-type">float</span><br>);<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>æ’å…¥ä¸€æ¡æ•°æ®ï¼Œä¹Ÿå¯ä»¥å°‘æŸä¸ªå­—æ®µçš„åŒæ—¶ä¹Ÿå°‘å¯¹åº”çš„æ•°æ®<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> student(id,name,grade) <span class="hljs-keyword">values</span>(<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;howie&#x27;</span>,<span class="hljs-number">70</span>);<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>ä¹Ÿå¯ä»¥ä¸æŒ‡å®šå­—æ®µåï¼Œä½†è¦æ³¨æ„é¡ºåº<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> student <span class="hljs-keyword">values</span>(<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;howie&#x27;</span>,<span class="hljs-number">80</span>);<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>ä¹Ÿå¯ä»¥è¿™æ ·æ·»åŠ æ•°æ®<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> student <span class="hljs-keyword">set</span> id<span class="hljs-operator">=</span><span class="hljs-number">3</span>,name<span class="hljs-operator">=</span>&quot;howie&quot;,grade<span class="hljs-operator">=</span><span class="hljs-number">90</span>;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>åŒæ—¶æ·»åŠ å¤šæ¡æ•°æ®<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> student <span class="hljs-keyword">values</span><br>(<span class="hljs-number">4</span>,<span class="hljs-string">&#x27;howie&#x27;</span>,<span class="hljs-number">80</span>),<br>(<span class="hljs-number">5</span>,<span class="hljs-string">&#x27;howie&#x27;</span>,<span class="hljs-number">80</span>),<br>(<span class="hljs-number">6</span>,<span class="hljs-string">&#x27;howie&#x27;</span>,<span class="hljs-number">80</span>);<br></code></pre></td></tr></table></figure><h2 id="æ›´æ–°æ•°æ®"><a href="#æ›´æ–°æ•°æ®" class="headerlink" title="æ›´æ–°æ•°æ®"></a>æ›´æ–°æ•°æ®</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">/</span><span class="hljs-operator">/</span>æ›´æ–°id<span class="hljs-operator">=</span><span class="hljs-number">1</span>çš„æ•°æ®<br><span class="hljs-keyword">update</span> student <span class="hljs-keyword">set</span> name<span class="hljs-operator">=</span>&quot;howie1&quot;,grade<span class="hljs-operator">=</span><span class="hljs-number">60</span> <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span>;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>æ‰¹é‡æ›´æ–°,å¦‚æœæ²¡æœ‰<span class="hljs-keyword">where</span>å­å¥ï¼Œä¼šæ›´æ–°è¡¨ä¸­æ‰€æœ‰å¯¹åº”æ•°æ®<br><span class="hljs-keyword">update</span> student <span class="hljs-keyword">set</span> grade<span class="hljs-operator">=</span><span class="hljs-number">100</span> <span class="hljs-keyword">where</span> id<span class="hljs-operator">&lt;</span><span class="hljs-number">4</span>;<br> <br></code></pre></td></tr></table></figure><h2 id="åˆ é™¤æ•°æ®"><a href="#åˆ é™¤æ•°æ®" class="headerlink" title="åˆ é™¤æ•°æ®"></a>åˆ é™¤æ•°æ®</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">/</span><span class="hljs-operator">/</span>åˆ é™¤id<span class="hljs-operator">=</span><span class="hljs-number">6</span>çš„æ•°æ®<br><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> student <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">6</span>;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>æ‰¹é‡åˆ é™¤æ•°æ®<br><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> student <span class="hljs-keyword">where</span> id<span class="hljs-operator">&gt;</span><span class="hljs-number">3</span>;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>åˆ é™¤æ‰€æœ‰æ•°æ®,DDL(æ•°æ®å®šä¹‰è¯­è¨€)è¯­å¥ <span class="hljs-keyword">truncate</span> <span class="hljs-keyword">table</span> studentä¹Ÿå¯ä»¥åˆ é™¤è¡¨å†…æ‰€æœ‰æ•°æ®<br><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> student;<br></code></pre></td></tr></table></figure><h2 id="å•è¡¨æŸ¥è¯¢å’Œå¤šè¡¨æ“ä½œ"><a href="#å•è¡¨æŸ¥è¯¢å’Œå¤šè¡¨æ“ä½œ" class="headerlink" title="å•è¡¨æŸ¥è¯¢å’Œå¤šè¡¨æ“ä½œ"></a>å•è¡¨æŸ¥è¯¢å’Œå¤šè¡¨æ“ä½œ</h2><p>å•è¡¨æŸ¥è¯¢ï¼šå¦‚ä½•ä»æ•°æ®åº“ä¸­è·å–ä½ éœ€è¦çš„æ•°æ® å¤šè¡¨æŸ¥è¯¢ï¼šå®é™…å¼€å‘ä¸­ï¼Œéœ€è¦è¿›è¡Œ2å¼ è¡¨ä»¥ä¸Šè¿›è¡Œæ“ä½œ</p><h2 id="å•è¡¨æŸ¥è¯¢"><a href="#å•è¡¨æŸ¥è¯¢" class="headerlink" title="å•è¡¨æŸ¥è¯¢"></a>å•è¡¨æŸ¥è¯¢</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">/</span><span class="hljs-operator">/</span>å»ºç«‹è¡¨student<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> student(<br>  id <span class="hljs-type">int</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> auto_increment,<br>  name <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,<br>  grade <span class="hljs-type">float</span>,<br>  <span class="hljs-keyword">primary</span> <span class="hljs-keyword">key</span>(id)<br>);<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>æ’å…¥æ•°æ®<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> student (name,grade) <span class="hljs-keyword">values</span><br>(&quot;howie1&quot;,<span class="hljs-number">40</span>),<br>(&quot;howie1&quot;,<span class="hljs-number">50</span>),<br>(&quot;howie2&quot;,<span class="hljs-number">50</span>),<br>(&quot;howie3&quot;,<span class="hljs-number">60</span>),<br>(&quot;howie4&quot;,<span class="hljs-number">70</span>),<br>(&quot;howie5&quot;,<span class="hljs-number">80</span>),<br>(&quot;howie6&quot;,<span class="hljs-keyword">null</span>);<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>æŸ¥è¯¢å…¨éƒ¨<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> student;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>æŸ¥è¯¢æŸä¸ªå­—æ®µ<br><span class="hljs-keyword">select</span> name <span class="hljs-keyword">from</span> student;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>æ¡ä»¶æŸ¥è¯¢,æŸ¥è¯¢id<span class="hljs-operator">=</span><span class="hljs-number">2</span>å­¦ç”Ÿçš„ä¿¡æ¯<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> student <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">2</span>;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-keyword">in</span>å…³é”®å­—æŸ¥è¯¢,ä¹Ÿå¯ä»¥ä½¿ç”¨<span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> student <span class="hljs-keyword">where</span> id <span class="hljs-keyword">IN</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>);<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-keyword">between</span> <span class="hljs-keyword">and</span>å…³é”®å­—æŸ¥è¯¢<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> student <span class="hljs-keyword">where</span> id <span class="hljs-keyword">between</span> <span class="hljs-number">2</span> <span class="hljs-keyword">and</span> <span class="hljs-number">5</span>;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>ç©ºå€¼(<span class="hljs-keyword">NULL</span>)æŸ¥è¯¢ï¼Œä½¿ç”¨<span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span>æ¥åˆ¤æ–­<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> student <span class="hljs-keyword">where</span> grade <span class="hljs-keyword">is</span> <span class="hljs-keyword">null</span>;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-keyword">distinct</span>å…³é”®å­—æŸ¥è¯¢<br><span class="hljs-keyword">select</span> <span class="hljs-keyword">distinct</span> name <span class="hljs-keyword">from</span> student;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-keyword">like</span>å…³é”®å­—æŸ¥è¯¢,æŸ¥è¯¢ä»¥hå¼€å¤´ï¼Œeç»“å°¾çš„æ•°æ®<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> student <span class="hljs-keyword">where</span> name <span class="hljs-keyword">like</span> &quot;h%e&quot;;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-keyword">and</span>å…³é”®å­—å¤šæ¡ä»¶æŸ¥è¯¢,<span class="hljs-keyword">or</span>å…³é”®å­—çš„ä½¿ç”¨ä¹Ÿæ˜¯ç±»ä¼¼<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> student <span class="hljs-keyword">where</span> id<span class="hljs-operator">&gt;</span><span class="hljs-number">5</span> <span class="hljs-keyword">and</span> grade<span class="hljs-operator">&gt;</span><span class="hljs-number">60</span>;<br></code></pre></td></tr></table></figure><h2 id="é«˜çº§æŸ¥è¯¢"><a href="#é«˜çº§æŸ¥è¯¢" class="headerlink" title="é«˜çº§æŸ¥è¯¢"></a>é«˜çº§æŸ¥è¯¢</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">/</span><span class="hljs-operator">/</span>èšåˆå‡½æ•°<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-built_in">count</span>()å‡½æ•°,<span class="hljs-built_in">sum</span>()å‡½æ•°,<span class="hljs-built_in">avg</span>()å‡½æ•°,<span class="hljs-built_in">max</span>()å‡½æ•°,<span class="hljs-built_in">min</span>()å‡½æ•°<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> student;<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">sum</span>(grade) <span class="hljs-keyword">from</span> student;<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">avg</span>(grade) <span class="hljs-keyword">from</span> student;<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">max</span>(grade) <span class="hljs-keyword">from</span> student;<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">min</span>(grade) <span class="hljs-keyword">from</span> student;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>å¯¹æŸ¥è¯¢ç»“æœè¿›è¡Œæ’åº<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> student <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> grade;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>åˆ†ç»„æŸ¥è¯¢<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-number">1.</span>å•ç‹¬ä½¿ç”¨<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span>åˆ†ç»„<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> student <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> grade;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-number">2.</span>å’Œèšåˆå‡½æ•°ä¸€èµ·ä½¿ç”¨<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>),grade <span class="hljs-keyword">from</span> student <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> grade;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-number">3.</span>å’Œ<span class="hljs-keyword">having</span>å…³é”®å­—ä¸€èµ·ä½¿ç”¨<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">sum</span>(grade),name <span class="hljs-keyword">from</span> student <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> grade <span class="hljs-keyword">having</span> <span class="hljs-built_in">sum</span>(grade) <span class="hljs-operator">&gt;</span><span class="hljs-number">100</span>;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>ä½¿ç”¨limité™åˆ¶æŸ¥è¯¢ç»“æœçš„æ•°é‡<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> student limit <span class="hljs-number">5</span>;<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> student limit <span class="hljs-number">2</span>,<span class="hljs-number">2</span>;<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> student <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> grade <span class="hljs-keyword">desc</span> limit <span class="hljs-number">2</span>,<span class="hljs-number">2</span>;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>å‡½æ•°,mysqlæä¾›äº†è®¸å¤šå‡½æ•°<br><span class="hljs-keyword">select</span> concat(id,<span class="hljs-string">&#x27;:&#x27;</span>,name,<span class="hljs-string">&#x27;:&#x27;</span>,grade) <span class="hljs-keyword">from</span> student;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>ä¸ºè¡¨å–åˆ«å<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> student <span class="hljs-keyword">as</span> stu <span class="hljs-keyword">where</span> stu.name<span class="hljs-operator">=</span>&quot;howie&quot;;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>ä¸ºå­—æ®µå–åˆ«å,<span class="hljs-keyword">as</span>å…³é”®å­—ä¹Ÿå¯ä»¥ä¸å†™<br><span class="hljs-keyword">select</span> name <span class="hljs-keyword">as</span> stu_name,grade stu_grade <span class="hljs-keyword">from</span> student;<br></code></pre></td></tr></table></figure><h2 id="å¤šè¡¨æ“ä½œ"><a href="#å¤šè¡¨æ“ä½œ" class="headerlink" title="å¤šè¡¨æ“ä½œ"></a>å¤šè¡¨æ“ä½œ</h2><p>1.äº†è§£å¤–é”® 2.äº†è§£å…³è”å…³ç³» 3.äº†è§£å„ç§è¿æ¥æŸ¥è¯¢å¤šè¡¨çš„æ•°æ® 4.äº†è§£å­æŸ¥è¯¢ï¼Œä¼šä½¿ç”¨å„ç§å…³é”®å­—ä»¥åŠæ¯”è¾ƒè¿ç®—ç¬¦æŸ¥è¯¢å¤šè¡¨ä¸­çš„æ•°æ®</p><p>å¤–é”® å¤–é”®æ˜¯æŒ‡å¼•ç”¨å¦ä¸€ä¸ªè¡¨ä¸­çš„ä¸€åˆ—æˆ–è€…å¤šåˆ—ï¼Œè¢«å¼•ç”¨çš„åˆ—åº”è¯¥å…·æœ‰ä¸»é”®çº¦æŸæˆ–è€…å”¯ä¸€æ€§çº¦æŸï¼Œç”¨äºå»ºç«‹å’ŒåŠ å¼ºä¸¤ä¸ªæ•°æ®è¡¨ä¹‹é—´çš„è¿æ¥ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">/</span><span class="hljs-operator">/</span>åˆ›å»ºè¡¨class,student<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> class(<br>   id <span class="hljs-type">int</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">primary</span> <span class="hljs-keyword">key</span>,<br>   classname <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span><br>)ENGINE<span class="hljs-operator">=</span>InnoDB;<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> student(<br>   stu_id <span class="hljs-type">int</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">primary</span> <span class="hljs-keyword">key</span>,<br>   stu_name <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,<br>   cid <span class="hljs-type">int</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>      <span class="hljs-comment">-- è¡¨ç¤ºç­çº§idï¼Œå®ƒå°±æ˜¯classè¡¨çš„å¤–é”®</span><br>)ENGINE<span class="hljs-operator">=</span>InnoDB;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>æ·»åŠ å¤–é”®çº¦æŸ<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> student <span class="hljs-keyword">add</span> <span class="hljs-keyword">constraint</span> FK_ID <span class="hljs-keyword">foreign</span> <span class="hljs-keyword">key</span>(cid) <span class="hljs-keyword">references</span> class(id);<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>åˆ é™¤å¤–é”®çº¦æŸ<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> student <span class="hljs-keyword">drop</span> <span class="hljs-keyword">foreign</span> <span class="hljs-keyword">key</span> FK_ID;<br></code></pre></td></tr></table></figure><h2 id="æ“ä½œå…³è”è¡¨"><a href="#æ“ä½œå…³è”è¡¨" class="headerlink" title="æ“ä½œå…³è”è¡¨"></a>æ“ä½œå…³è”è¡¨</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">/</span><span class="hljs-operator">/</span>æ•°æ®è¡¨æœ‰ä¸‰ç§å…³è”å…³ç³»ï¼Œå¤šå¯¹ä¸€ã€å¤šå¯¹å¤šã€ä¸€å¯¹ä¸€<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>å­¦ç”Ÿ(student)å’Œç­çº§(class)æ˜¯å¤šå¯¹ä¸€å…³ç³»ï¼Œæ·»åŠ æ•°æ®<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>é¦–é€‰æ·»åŠ å¤–é”®çº¦æŸ<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> student <span class="hljs-keyword">add</span> <span class="hljs-keyword">constraint</span> FK_ID <span class="hljs-keyword">foreign</span> <span class="hljs-keyword">key</span>(cid) <span class="hljs-keyword">references</span> class(id);<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>æ·»åŠ æ•°æ®,è¿™ä¸¤ä¸ªè¡¨ä¾¿æœ‰äº†å…³è”è‹¥æ’å…¥ä¸­æ–‡åœ¨ç»ˆç«¯æ˜¾ç¤ºç©ºç™½ï¼Œå¯è®¾ç½®<span class="hljs-keyword">set</span> names <span class="hljs-string">&#x27;gbk&#x27;</span>;<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> class <span class="hljs-keyword">values</span>(<span class="hljs-number">1</span>,&quot;è½¯ä»¶ä¸€ç­&quot;),(<span class="hljs-number">2</span>,&quot;è½¯ä»¶äºŒç­&quot;);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> student <span class="hljs-keyword">values</span>(<span class="hljs-number">1</span>,&quot;howie&quot;,<span class="hljs-number">1</span>),(<span class="hljs-number">2</span>,&quot;howie1&quot;,<span class="hljs-number">2</span>),(<span class="hljs-number">3</span>,&quot;howie2&quot;,<span class="hljs-number">1</span>),(<span class="hljs-number">4</span>,&quot;howie3&quot;,<span class="hljs-number">2</span>);<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>äº¤å‰è¿æ¥<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> student <span class="hljs-keyword">cross</span> <span class="hljs-keyword">join</span> class;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>å†…è¿æ¥ï¼Œè¯¥åŠŸèƒ½ä¹Ÿå¯ä»¥ä½¿ç”¨<span class="hljs-keyword">where</span>è¯­å¥å®ç°<br><span class="hljs-keyword">select</span> student.stu_name,class.classname <span class="hljs-keyword">from</span> student <span class="hljs-keyword">join</span> class <span class="hljs-keyword">on</span> class.id<span class="hljs-operator">=</span>student.cid;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>å¤–è¿æ¥<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>é¦–å…ˆåœ¨student,classè¡¨ä¸­æ’å…¥æ•°æ®<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> class <span class="hljs-keyword">values</span>(<span class="hljs-number">3</span>,&quot;è½¯ä»¶ä¸‰ç­&quot;);<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>å·¦è¿æ¥ï¼Œå³è¿æ¥<br><span class="hljs-keyword">select</span> s.stu_id,s.stu_name,c.classname <span class="hljs-keyword">from</span> student s <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> class c <span class="hljs-keyword">on</span> c.id<span class="hljs-operator">=</span>s.cid;<br><span class="hljs-keyword">select</span> s.stu_id,s.stu_name,c.classname <span class="hljs-keyword">from</span> student s <span class="hljs-keyword">right</span> <span class="hljs-keyword">join</span> class c <span class="hljs-keyword">on</span> c.id<span class="hljs-operator">=</span>s.cid;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>å¤åˆæ¡ä»¶è¿æ¥æŸ¥è¯¢å°±æ˜¯æ·»åŠ è¿‡æ»¤æ¡ä»¶<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>å­æŸ¥è¯¢<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-keyword">in</span>å…³é”®å­—å­æŸ¥è¯¢è·Ÿä¸Šé¢çš„<span class="hljs-keyword">in</span>å…³é”®å­—æŸ¥è¯¢ç±»ä¼¼<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> student <span class="hljs-keyword">where</span> cid <span class="hljs-keyword">in</span>(<span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> class <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">2</span>);<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-keyword">exists</span>å…³é”®å­—æŸ¥è¯¢,ç›¸å½“äºæµ‹è¯•ï¼Œä¸äº§ç”Ÿæ•°æ®ï¼Œåªè¿”å›<span class="hljs-literal">true</span>æˆ–è€…<span class="hljs-literal">false</span>ï¼Œåªæœ‰è¿”å›<span class="hljs-literal">true</span>ï¼Œå¤–å±‚æ‰ä¼šæ‰§è¡Œï¼Œå…·ä½“çœ‹ä¸‹å›¾<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> student <span class="hljs-keyword">where</span> <span class="hljs-keyword">exists</span>(<span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> class <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">12</span>);   <span class="hljs-comment">-- å¤–å±‚ä¸ä¼šæ‰§è¡Œ</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> student <span class="hljs-keyword">where</span> <span class="hljs-keyword">exists</span>(<span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> class <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span>);    <span class="hljs-comment">-- å¤–å±‚ä¼šæ‰§è¡Œ</span><br><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-keyword">any</span>å…³é”®å­—æŸ¥è¯¢<br> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> student <span class="hljs-keyword">where</span> cid<span class="hljs-operator">&gt;</span><span class="hljs-keyword">any</span>(<span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> class);<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-keyword">all</span>å…³é”®å­—æŸ¥è¯¢<br> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> student <span class="hljs-keyword">where</span> cid<span class="hljs-operator">=</span><span class="hljs-keyword">any</span>(<span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> class);<br></code></pre></td></tr></table></figure><h1 id="äº‹åŠ¡ä¸å­˜å‚¨è¿‡ç¨‹"><a href="#äº‹åŠ¡ä¸å­˜å‚¨è¿‡ç¨‹" class="headerlink" title="äº‹åŠ¡ä¸å­˜å‚¨è¿‡ç¨‹"></a>äº‹åŠ¡ä¸å­˜å‚¨è¿‡ç¨‹</h1><p>äº‹åŠ¡çš„æ¦‚å¿µï¼Œä¼šå¼€å¯ã€æäº¤å’Œå›æ»šäº‹åŠ¡ äº‹åŠ¡çš„å››ç§éš”ç¦»çº§åˆ« åˆ›å»ºå­˜å‚¨è¿‡ç¨‹ è°ƒç”¨ã€æŸ¥çœ‹ã€ä¿®æ”¹å’Œåˆ é™¤å­˜å‚¨è¿‡ç¨‹</p><h2 id="äº‹åŠ¡ç®¡ç†"><a href="#äº‹åŠ¡ç®¡ç†" class="headerlink" title="äº‹åŠ¡ç®¡ç†"></a>äº‹åŠ¡ç®¡ç†</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">start</span> transaction;  <span class="hljs-comment">-- å¼€å¯äº‹åŠ¡</span><br><span class="hljs-keyword">commit</span>;             <span class="hljs-comment">-- æäº¤äº‹åŠ¡</span><br><span class="hljs-keyword">rollback</span>;           <span class="hljs-comment">-- å–æ¶ˆäº‹åŠ¡(å›æ»š)</span><br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>åˆ›å»ºè¡¨accountï¼Œæ’å…¥æ•°æ®<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> account(<br>  id <span class="hljs-type">int</span> <span class="hljs-keyword">primary</span> <span class="hljs-keyword">key</span> auto_increment,<br>  name <span class="hljs-type">varchar</span>(<span class="hljs-number">40</span>),<br>  money <span class="hljs-type">float</span><br>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> account(name,money) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-number">1000</span>),(<span class="hljs-string">&#x27;b&#x27;</span>,<span class="hljs-number">2000</span>),(<span class="hljs-string">&#x27;c&#x27;</span>,<span class="hljs-number">3000</span>);<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>åˆ©ç”¨äº‹åŠ¡å®ç°è½¬è´¦åŠŸèƒ½ï¼Œé¦–å…ˆå¼€å¯äº‹åŠ¡ï¼Œç„¶åæ‰§è¡Œè¯­å¥ï¼Œæäº¤äº‹åŠ¡<br><span class="hljs-keyword">start</span> transaction;<br><span class="hljs-keyword">update</span> account <span class="hljs-keyword">set</span> money<span class="hljs-operator">=</span>money<span class="hljs-number">-100</span> <span class="hljs-keyword">where</span> name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;a&#x27;</span>;<br><span class="hljs-keyword">update</span> account <span class="hljs-keyword">set</span> money<span class="hljs-operator">=</span>money<span class="hljs-operator">+</span><span class="hljs-number">100</span> <span class="hljs-keyword">where</span> name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;b&#x27;</span>;<br><span class="hljs-keyword">commit</span>;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>äº‹åŠ¡çš„æäº¤ï¼Œé€šè¿‡è¿™ä¸ªå‘½ä»¤æŸ¥çœ‹mysqlæäº¤æ–¹å¼<br><span class="hljs-keyword">select</span> @<span class="hljs-variable">@autocommit</span>; <span class="hljs-comment">-- è‹¥ä¸º1ï¼Œè¡¨ç¤ºè‡ªåŠ¨æäº¤ï¼Œä¸º0ï¼Œå°±è¦æ‰‹åŠ¨æäº¤</span><br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>è‹¥äº‹åŠ¡çš„æäº¤æ–¹å¼ä¸ºæ‰‹åŠ¨æäº¤<br><span class="hljs-keyword">set</span> @<span class="hljs-variable">@autocommit</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; <span class="hljs-comment">-- è®¾ç½®ä¸ºæ‰‹åŠ¨æäº¤</span><br><span class="hljs-keyword">start</span> transaction;<br><span class="hljs-keyword">update</span> account <span class="hljs-keyword">set</span> money<span class="hljs-operator">=</span>money<span class="hljs-operator">+</span><span class="hljs-number">100</span> <span class="hljs-keyword">where</span> name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;a&#x27;</span>;<br><span class="hljs-keyword">update</span> account <span class="hljs-keyword">set</span> money<span class="hljs-operator">=</span>money<span class="hljs-number">-100</span> <span class="hljs-keyword">where</span> name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;b&#x27;</span>;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>ç°åœ¨æ‰§è¡Œ<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> account å¯ä»¥çœ‹åˆ°è½¬è´¦æˆåŠŸï¼Œè‹¥æ­¤æ—¶é€€å‡ºæ•°æ®åº“é‡æ–°ç™»å½•ï¼Œä¼šçœ‹åˆ°å„è´¦æˆ·ä½™é¢æ²¡æœ‰æ”¹å˜ï¼Œæ‰€ä»¥ä¸€å®šè¦ç”¨<span class="hljs-keyword">commit</span>è¯­å¥æäº¤äº‹åŠ¡ï¼Œå¦åˆ™ä¼šå¤±è´¥<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>äº‹åŠ¡çš„å›æ»šï¼Œåˆ«å¿˜è®°è®¾ç½®ä¸ºæ‰‹åŠ¨æäº¤çš„æ¨¡å¼<br><span class="hljs-keyword">start</span> transaction;<br><span class="hljs-keyword">update</span> account <span class="hljs-keyword">set</span> money<span class="hljs-operator">=</span>money<span class="hljs-number">-100</span> <span class="hljs-keyword">where</span> name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;a&#x27;</span>;<br><span class="hljs-keyword">update</span> account <span class="hljs-keyword">set</span> money<span class="hljs-operator">=</span>money<span class="hljs-operator">+</span><span class="hljs-number">100</span> <span class="hljs-keyword">where</span> name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;b&#x27;</span>;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>è‹¥æ­¤æ—¶aä¸æƒ³è½¬è´¦ç»™bï¼Œå¯ä»¥ä½¿ç”¨äº‹åŠ¡çš„å›æ»š<br><span class="hljs-keyword">rollback</span>;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>äº‹åŠ¡çš„éš”ç¦»çº§åˆ«<br>read uncommitted;<br>read committed;<br>repeatable read;<br>serializable;<br></code></pre></td></tr></table></figure><h2 id="å­˜å‚¨è¿‡ç¨‹"><a href="#å­˜å‚¨è¿‡ç¨‹" class="headerlink" title="å­˜å‚¨è¿‡ç¨‹"></a>å­˜å‚¨è¿‡ç¨‹</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">/</span><span class="hljs-operator">/</span>åˆ›å»ºæŸ¥çœ‹studentè¡¨çš„å­˜å‚¨è¿‡ç¨‹<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>åˆ›å»ºstudentè¡¨<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> student( <br>  id <span class="hljs-type">int</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">primary</span> <span class="hljs-keyword">key</span> auto_increment, <br>  name <span class="hljs-type">varchar</span>(<span class="hljs-number">4</span>), <br>  grade <span class="hljs-type">float</span> <br>)ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">default</span> <span class="hljs-type">character</span> <span class="hljs-keyword">set</span> utf8;<br>delimiter <span class="hljs-operator">/</span><span class="hljs-operator">/</span>  <span class="hljs-comment">-- å°†mysqlçš„ç»“æŸç¬¦è®¾ç½®ä¸º//</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">procedure</span> Proc()<br>  <span class="hljs-keyword">begin</span><br>  <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> student;<br>  <span class="hljs-keyword">end</span> <span class="hljs-operator">/</span><span class="hljs-operator">/</span><br>delimiter ;   <span class="hljs-comment">-- å°†mysqlçš„ç»“æŸç¬¦è®¾ç½®ä¸º;</span><br><span class="hljs-keyword">call</span> Proc();  <span class="hljs-comment">-- è¿™æ ·å°±å¯ä»¥è°ƒç”¨è¯¥å­˜å‚¨è¿‡ç¨‹</span><br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>å˜é‡çš„ä½¿ç”¨,mysqlä¸­å˜é‡ä¸ç”¨äº‹å‰ç”³æ˜ï¼Œåœ¨ç”¨çš„æ—¶å€™ç›´æ¥ç”¨â€œ@å˜é‡åâ€ä½¿ç”¨å°±å¯ä»¥<br><span class="hljs-keyword">set</span> <span class="hljs-variable">@number</span><span class="hljs-operator">=</span><span class="hljs-number">100</span>; <span class="hljs-comment">-- æˆ–set @num:=1;</span><br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>å®šä¹‰æ¡ä»¶å’Œå¤„ç†ç¨‹åº<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>å…‰æ ‡çš„ä½¿ç”¨<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-number">1.</span>å£°æ˜å…‰æ ‡<br><span class="hljs-keyword">DECLARE</span> <span class="hljs-operator">*</span> cursor_name<span class="hljs-operator">*</span> <span class="hljs-keyword">CURSOR</span> <span class="hljs-keyword">FOR</span> select_statement<br><span class="hljs-number">2.</span> å…‰æ ‡<span class="hljs-keyword">OPEN</span>è¯­å¥<br><span class="hljs-keyword">OPEN</span> cursor_name<br><span class="hljs-number">3.</span> å…‰æ ‡<span class="hljs-keyword">FETCH</span>è¯­å¥<br><span class="hljs-keyword">FETCH</span> cursor_name <span class="hljs-keyword">INTO</span> var_name [, var_name] ...<br><span class="hljs-number">4.</span> å…‰æ ‡<span class="hljs-keyword">CLOSE</span>è¯­å¥<br><span class="hljs-keyword">CLOSE</span> cursor_name<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>æµç¨‹æ§åˆ¶çš„ä½¿ç”¨  ä¸åšä»‹ç»<br> <br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>å®šä¹‰å­˜å‚¨è¿‡ç¨‹<br>delimiter <span class="hljs-operator">/</span><span class="hljs-operator">/</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">procedure</span> proc1(<span class="hljs-keyword">in</span> name <span class="hljs-type">varchar</span>(<span class="hljs-number">4</span>),<span class="hljs-keyword">out</span> num <span class="hljs-type">int</span>)<br><span class="hljs-keyword">begin</span><br><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">into</span> num <span class="hljs-keyword">from</span> student <span class="hljs-keyword">where</span> name<span class="hljs-operator">=</span>name;<br><span class="hljs-keyword">end</span><span class="hljs-operator">/</span><span class="hljs-operator">/</span><br>delimiter ;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>è°ƒç”¨å­˜å‚¨è¿‡ç¨‹<br><span class="hljs-keyword">call</span> proc1(&quot;tom&quot;,<span class="hljs-variable">@num</span>) <span class="hljs-comment">-- æŸ¥æ‰¾åä¸ºtomå­¦ç”Ÿäººæ•°</span><br> <br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹<br> <span class="hljs-keyword">show</span> <span class="hljs-keyword">procedure</span> status <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;p%&#x27;</span> \G <span class="hljs-comment">-- è·å¾—ä»¥på¼€å¤´çš„å­˜å‚¨è¿‡ç¨‹ä¿¡æ¯</span><br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>ä¿®æ”¹å­˜å‚¨è¿‡ç¨‹<br>alter &#123;procedure|function&#125; sp_name[characteristic...]<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>åˆ é™¤å­˜å‚¨è¿‡ç¨‹<br><span class="hljs-keyword">drop</span> <span class="hljs-keyword">procedure</span> proc1;<br></code></pre></td></tr></table></figure><h1 id="è§†å›¾"><a href="#è§†å›¾" class="headerlink" title="è§†å›¾"></a>è§†å›¾</h1><p>å¦‚ä½•åˆ›å»ºè§†å›¾ æŸ¥çœ‹ã€ä¿®æ”¹ã€æ›´æ–°ã€åˆ é™¤è§†å›¾</p><h2 id="è§†å›¾çš„åŸºæœ¬æ“ä½œ"><a href="#è§†å›¾çš„åŸºæœ¬æ“ä½œ" class="headerlink" title="è§†å›¾çš„åŸºæœ¬æ“ä½œ"></a>è§†å›¾çš„åŸºæœ¬æ“ä½œ</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">/</span><span class="hljs-operator">/</span>åœ¨å•è¡¨ä¸Šåˆ›å»ºè§†å›¾,é‡æ–°åˆ›å»ºstudentè¡¨ï¼Œæ’å…¥æ•°æ®<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> student(<br>  id <span class="hljs-type">int</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">primary</span> <span class="hljs-keyword">key</span> auto_increment,<br>  name <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,<br>  math <span class="hljs-type">float</span>,<br>  chinese <span class="hljs-type">float</span><br>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> student(name,math,chinese) <span class="hljs-keyword">values</span><br>(<span class="hljs-string">&#x27;howie1&#x27;</span>,<span class="hljs-number">66</span>,<span class="hljs-number">77</span>),<br>(<span class="hljs-string">&#x27;howie2&#x27;</span>,<span class="hljs-number">66</span>,<span class="hljs-number">77</span>),<br>(<span class="hljs-string">&#x27;howie3&#x27;</span>,<span class="hljs-number">66</span>,<span class="hljs-number">77</span>);<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>å¼€å§‹åˆ›å»ºè§†å›¾<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">view</span> stu_view <span class="hljs-keyword">as</span> <span class="hljs-keyword">select</span> math,chinese,math<span class="hljs-operator">+</span>chinese <span class="hljs-keyword">from</span> student;  <span class="hljs-comment">-- ä¸‹å›¾å¯çœ‹å‡ºåˆ›å»ºæˆåŠŸ</span><br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>ä¹Ÿå¯ä»¥åˆ›å»ºè‡ªå®šä¹‰å­—æ®µåç§°çš„è§†å›¾<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">view</span> stu_view2(math,chin,sum) <span class="hljs-keyword">as</span> <span class="hljs-keyword">select</span> math,chinese,math<span class="hljs-operator">+</span>chinese <span class="hljs-keyword">from</span> student;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>åœ¨å¤šè¡¨ä¸Šåˆ›å»ºè§†å›¾ï¼Œåˆ›å»ºè¡¨stu_infoï¼Œæ’å…¥æ•°æ®<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> stu_info(<br>  id <span class="hljs-type">int</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">primary</span> <span class="hljs-keyword">key</span> auto_increment,<br>  class <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,<br>  addr <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>)<br>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> stu_info(class,addr) <span class="hljs-keyword">values</span><br>(<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;anhui&#x27;</span>),<br>(<span class="hljs-string">&#x27;2&#x27;</span>,<span class="hljs-string">&#x27;fujian&#x27;</span>),<br>(<span class="hljs-string">&#x27;3&#x27;</span>,<span class="hljs-string">&#x27;guangdong&#x27;</span>);<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>åˆ›å»ºè§†å›¾stu_class<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">view</span> stu_class(id,name,class) <span class="hljs-keyword">as</span> <br><span class="hljs-keyword">select</span> student.id,student.name,stu_info.class <span class="hljs-keyword">from</span> <br>student,stu_info <span class="hljs-keyword">where</span> student.id<span class="hljs-operator">=</span>stu_info.id;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>æŸ¥çœ‹è§†å›¾<br><span class="hljs-keyword">desc</span> stu_class;<br><span class="hljs-keyword">show</span> <span class="hljs-keyword">table</span> status <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;stu_class&#x27;</span>\G<br><span class="hljs-keyword">show</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">view</span> stu_class\G<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>ä¿®æ”¹è§†å›¾<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">or</span> replace <span class="hljs-keyword">view</span> stu_view <span class="hljs-keyword">as</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> student;<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">view</span> stu_view <span class="hljs-keyword">as</span> <span class="hljs-keyword">select</span> chinese <span class="hljs-keyword">from</span> student;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>æ›´æ–°è§†å›¾<br><span class="hljs-keyword">update</span> stu_view <span class="hljs-keyword">set</span> chinese<span class="hljs-operator">=</span><span class="hljs-number">100</span>;<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> student <span class="hljs-keyword">values</span>(<span class="hljs-keyword">null</span>,<span class="hljs-string">&#x27;haha&#x27;</span>,<span class="hljs-number">100</span>,<span class="hljs-number">100</span>);<br><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> stu_view2 <span class="hljs-keyword">where</span> math<span class="hljs-operator">=</span><span class="hljs-number">100</span>;<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>åˆ é™¤è§†å›¾<br><span class="hljs-keyword">drop</span> <span class="hljs-keyword">view</span> if <span class="hljs-keyword">exists</span> stu_view2;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>æ•°æ®åº“</tag>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringAOPåŸç†åˆ†æ</title>
    <link href="/blog/2021/01/19/SpringAOP%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/"/>
    <url>/blog/2021/01/19/SpringAOP%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h1 id="Springæ ¸å¿ƒçŸ¥è¯†"><a href="#Springæ ¸å¿ƒçŸ¥è¯†" class="headerlink" title="Springæ ¸å¿ƒçŸ¥è¯†"></a>Springæ ¸å¿ƒçŸ¥è¯†</h1><p>Springæ˜¯ä¸€ä¸ªå¼€æºæ¡†æ¶ï¼ŒSpringæ˜¯äº2003å¹´å…´èµ·çš„ä¸€ä¸ªè½»é‡çº§çš„Javaå¼€å‘æ¡†æ¶ï¼Œç”±Rod Johnsonåœ¨å…¶è‘—ä½œExpert One-On-One J2EE Development and Designä¸­é˜è¿°çš„éƒ¨åˆ†ç†å¿µå’ŒåŸå‹è¡ç”Ÿè€Œæ¥ã€‚å®ƒæ˜¯ä¸ºäº†è§£å†³ä¼ä¸šåº”ç”¨å¼€å‘çš„å¤æ‚æ€§è€Œåˆ›å»ºçš„ã€‚æ¡†æ¶çš„ä¸»è¦ä¼˜åŠ¿ä¹‹ä¸€å°±æ˜¯å…¶åˆ†å±‚æ¶æ„ï¼Œåˆ†å±‚æ¶æ„å…è®¸ä½¿ç”¨è€…é€‰æ‹©ä½¿ç”¨å“ªä¸€ä¸ªç»„ä»¶ï¼ŒåŒæ—¶ä¸ºJ2EEåº”ç”¨ç¨‹åºå¼€å‘æä¾›é›†æˆçš„æ¡†æ¶ã€‚Springä½¿ç”¨åŸºæœ¬çš„JavaBeanæ¥å®Œæˆä»¥å‰åªå¯èƒ½ç”±EJBå®Œæˆçš„äº‹æƒ…ã€‚ç„¶è€Œï¼ŒSpringçš„ç”¨é€”ä¸ä»…é™äºæœåŠ¡å™¨ç«¯çš„å¼€å‘ã€‚ä»ç®€å•æ€§ã€å¯æµ‹è¯•æ€§å’Œæ¾è€¦åˆçš„è§’åº¦è€Œè¨€ï¼Œä»»ä½•Javaåº”ç”¨éƒ½å¯ä»¥ä»Springä¸­å—ç›Šã€‚Springçš„æ ¸å¿ƒæ˜¯æ§åˆ¶åè½¬(IoC)å’Œé¢å‘åˆ‡é¢(AOP)ã€‚ç®€å•æ¥è¯´ï¼ŒSpringæ˜¯ä¸€ä¸ªåˆ†å±‚çš„JavaSE/EEfull-stack(ä¸€ç«™å¼)è½»é‡çº§å¼€æºæ¡†æ¶ã€‚</p><p>ä¸ºä»€ä¹ˆè¯´Springæ˜¯ä¸€ä¸ªä¸€ç«™å¼çš„è½»é‡çº§å¼€æºæ¡†æ¶å‘¢ï¼ŸEEå¼€å‘å¯åˆ†æˆä¸‰å±‚æ¶æ„ï¼Œé’ˆå¯¹JavaEEçš„ä¸‰å±‚ç»“æ„ï¼Œæ¯ä¸€å±‚Springéƒ½æä¾›äº†ä¸åŒçš„è§£å†³æŠ€æœ¯ã€‚</p><p>â€¢ WEBå±‚ï¼šSpringMVC</p><p>â€¢ ä¸šåŠ¡å±‚ï¼šSpringçš„IoC</p><p>â€¢ æŒä¹…å±‚ï¼šSpringçš„JDBCTemplate(Springçš„JDBCæ¨¡æ¿ï¼ŒORMæ¨¡æ¿ç”¨äºæ•´åˆå…¶ä»–çš„æŒä¹…å±‚æ¡†æ¶)</p><p>ä»ä¸Šé¢çš„ç®€è¦ä»‹ç»ä¸­ï¼Œæˆ‘ä»¬è¦çŸ¥é“Springçš„æ ¸å¿ƒæœ‰ä¸¤éƒ¨åˆ†ï¼š</p><p>â€¢ IoCï¼šæ§åˆ¶åè½¬ã€‚</p><p>ä¸¾ä¾‹æ¥è¯´ï¼Œåœ¨ä¹‹å‰çš„æ“ä½œä¸­ï¼Œæ¯”æ–¹è¯´æœ‰ä¸€ä¸ªç±»ï¼Œæˆ‘ä»¬æƒ³è¦è°ƒç”¨ç±»é‡Œé¢çš„æ–¹æ³•(ä¸æ˜¯é™æ€æ–¹æ³•)ï¼Œå°±è¦åˆ›å»ºç±»çš„å¯¹è±¡ï¼Œä½¿ç”¨å¯¹è±¡è°ƒç”¨æ–¹æ³•å®ç°ã€‚å¯¹äºSpringæ¥è¯´ï¼ŒSpringåˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹ï¼Œä¸æ˜¯åœ¨ä»£ç é‡Œé¢å®ç°çš„ï¼Œè€Œæ˜¯äº¤ç»™Springæ¥è¿›è¡Œé…ç½®å®ç°çš„ã€‚</p><p>AOPï¼šé¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚</p><h1 id="SpringAOPåŸç†"><a href="#SpringAOPåŸç†" class="headerlink" title="SpringAOPåŸç†"></a>SpringAOPåŸç†</h1><p>AOPç¼–ç¨‹æŠ€æœ¯ ä»€ä¹ˆæ˜¯AOPç¼–ç¨‹ AOP: Aspect Oriented Programming é¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚ ã€€ã€€é¢å‘åˆ‡é¢ç¼–ç¨‹(ä¹Ÿå«é¢å‘æ–¹é¢)ï¼šAspect Oriented Programming(AOP),æ˜¯ç›®å‰è½¯ä»¶å¼€å‘ä¸­çš„ä¸€ä¸ªçƒ­ç‚¹ã€‚åˆ©ç”¨AOPå¯ä»¥å¯¹ä¸šåŠ¡é€»è¾‘çš„å„ä¸ªéƒ¨åˆ†è¿›è¡Œéš”ç¦»ï¼Œä»è€Œä½¿å¾—ä¸šåŠ¡é€»è¾‘å„éƒ¨åˆ†ä¹‹é—´çš„è€¦åˆåº¦é™ä½ï¼Œæé«˜ç¨‹åºçš„å¯é‡ç”¨æ€§ï¼ŒåŒæ—¶æé«˜äº†å¼€å‘çš„æ•ˆç‡ã€‚ ã€€ã€€AOPæ˜¯OOPçš„å»¶ç»­ï¼Œæ˜¯ï¼ˆAspect Oriented Programmingï¼‰çš„ç¼©å†™ï¼Œæ„æ€æ˜¯é¢å‘åˆ‡é¢ï¼ˆæ–¹é¢ï¼‰ç¼–ç¨‹ã€‚ ã€€ã€€ä¸»è¦çš„åŠŸèƒ½æ˜¯ï¼šæ—¥å¿—è®°å½•ï¼Œæ€§èƒ½ç»Ÿè®¡ï¼Œå®‰å…¨æ§åˆ¶ï¼Œäº‹åŠ¡å¤„ç†ï¼Œå¼‚å¸¸å¤„ç†ç­‰ç­‰ã€‚ ã€€ã€€ä¸»è¦çš„æ„å›¾æ˜¯ï¼šå°†æ—¥å¿—è®°å½•ï¼Œæ€§èƒ½ç»Ÿè®¡ï¼Œå®‰å…¨æ§åˆ¶ï¼Œäº‹åŠ¡å¤„ç†ï¼Œå¼‚å¸¸å¤„ç†ç­‰ä»£ç ä»ä¸šåŠ¡é€»è¾‘ä»£ç ä¸­åˆ’åˆ†å‡ºæ¥ï¼Œé€šè¿‡å¯¹è¿™äº›è¡Œä¸ºçš„åˆ†ç¦»ï¼Œæˆ‘ä»¬å¸Œæœ›å¯ä»¥å°†å®ƒä»¬ç‹¬ç«‹åˆ°éæŒ‡å¯¼ä¸šåŠ¡é€»è¾‘çš„æ–¹æ³•ä¸­ï¼Œè¿›è€Œæ”¹ å˜è¿™äº›è¡Œä¸ºçš„æ—¶å€™ä¸å½±å“ä¸šåŠ¡é€»è¾‘çš„ä»£ç ã€‚</p><p>ã€€ã€€å¯ä»¥é€šè¿‡é¢„ç¼–è¯‘æ–¹å¼å’Œè¿è¡ŒæœŸåŠ¨æ€ä»£ç†å®ç°åœ¨ä¸ä¿®æ”¹æºä»£ç çš„æƒ…å†µä¸‹ç»™ç¨‹åºåŠ¨æ€ç»Ÿä¸€æ·»åŠ åŠŸèƒ½çš„ä¸€ç§æŠ€æœ¯ã€‚AOPå®é™…æ˜¯GoFè®¾è®¡æ¨¡å¼çš„å»¶ç»­ï¼Œè®¾è®¡æ¨¡å¼å­œå­œä¸å€¦è¿½æ±‚çš„æ˜¯è°ƒç”¨è€…å’Œè¢«è°ƒç”¨è€…ä¹‹é—´çš„è§£è€¦ï¼ŒAOPå¯ä»¥è¯´ä¹Ÿæ˜¯è¿™ç§ç›®æ ‡çš„ä¸€ç§å®ç°ã€‚</p><p>å‡è®¾æŠŠåº”ç”¨ç¨‹åºæƒ³æˆä¸€ä¸ªç«‹ä½“ç»“æ„çš„è¯ï¼ŒOOPçš„åˆ©åˆƒæ˜¯çºµå‘åˆ‡å…¥ç³»ç»Ÿï¼ŒæŠŠç³»ç»Ÿåˆ’åˆ†ä¸ºå¾ˆå¤šä¸ªæ¨¡å—ï¼ˆå¦‚ï¼šç”¨æˆ·æ¨¡å—ï¼Œæ–‡ç« æ¨¡å—ç­‰ç­‰ï¼‰ï¼Œè€ŒAOPçš„åˆ©åˆƒæ˜¯æ¨ªå‘åˆ‡å…¥ç³»ç»Ÿï¼Œæå–å„ä¸ªæ¨¡å—å¯èƒ½éƒ½è¦é‡å¤æ“ä½œçš„éƒ¨åˆ†ï¼ˆå¦‚ï¼šæƒé™æ£€æŸ¥ï¼Œæ—¥å¿—è®°å½•ç­‰ç­‰ï¼‰ã€‚ç”±æ­¤å¯è§ï¼ŒAOPæ˜¯OOPçš„ä¸€ä¸ªæœ‰æ•ˆè¡¥å……ã€‚</p><p>æ³¨æ„ï¼šAOPä¸æ˜¯ä¸€ç§æŠ€æœ¯ï¼Œå®é™…ä¸Šæ˜¯ç¼–ç¨‹æ€æƒ³ã€‚å‡¡æ˜¯ç¬¦åˆAOPæ€æƒ³çš„æŠ€æœ¯ï¼Œéƒ½å¯ä»¥çœ‹æˆæ˜¯AOPçš„å®ç°ã€‚</p><p>Aopï¼Œ aspect object programming é¢å‘åˆ‡é¢ç¼–ç¨‹</p><p>åŠŸèƒ½ï¼š è®©å…³æ³¨ç‚¹ä»£ç ä¸ä¸šåŠ¡ä»£ç åˆ†ç¦»ï¼</p><p>å…³æ³¨ç‚¹</p><p>å…³æ³¨ç‚¹,é‡å¤ä»£ç å°±å«åšå…³æ³¨ç‚¹ï¼›</p><p>åˆ‡é¢</p><p>å…³æ³¨ç‚¹å½¢æˆçš„ç±»ï¼Œå°±å«åˆ‡é¢(ç±»)ï¼</p><p>é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œå°±æ˜¯æŒ‡ å¯¹å¾ˆå¤šåŠŸèƒ½éƒ½æœ‰çš„é‡å¤çš„ä»£ç æŠ½å–ï¼Œå†åœ¨è¿è¡Œçš„æ—¶å€™ç½‘ä¸šåŠ¡æ–¹æ³•ä¸ŠåŠ¨æ€æ¤å…¥â€œåˆ‡é¢ç±»ä»£ç â€ã€‚</p><p>åˆ‡å…¥ç‚¹</p><p>æ‰§è¡Œç›®æ ‡å¯¹è±¡æ–¹æ³•ï¼ŒåŠ¨æ€æ¤å…¥åˆ‡é¢ä»£ç ã€‚</p><p>å¯ä»¥é€šè¿‡åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼ŒæŒ‡å®šæ‹¦æˆªå“ªäº›ç±»çš„å“ªäº›æ–¹æ³•ï¼› ç»™æŒ‡å®šçš„ç±»åœ¨è¿è¡Œçš„æ—¶å€™æ¤å…¥åˆ‡é¢ç±»ä»£ç ã€‚</p><h1 id="AOPåº•å±‚å®ç°åŸç†"><a href="#AOPåº•å±‚å®ç°åŸç†" class="headerlink" title="AOPåº•å±‚å®ç°åŸç†"></a>AOPåº•å±‚å®ç°åŸç†</h1><p>ä»£ç†è®¾è®¡æ¨¡å¼</p><p>ä»€ä¹ˆæ˜¯ä»£ç†æ¨¡å¼</p><p>é€šè¿‡ä»£ç†æ§åˆ¶å¯¹è±¡çš„è®¿é—®,å¯ä»¥è¯¦ç»†è®¿é—®æŸä¸ªå¯¹è±¡çš„æ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•è°ƒç”¨å¤„ç†ï¼Œæˆ–è°ƒç”¨åå¤„ç†ã€‚æ—¢(AOPå¾®å®ç°) ,AOPæ ¸å¿ƒæŠ€æœ¯é¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚</p><p>ä»£ç†æ¨¡å¼åº”ç”¨åœºæ™¯</p><p>SpringAOPã€äº‹ç‰©åŸç†ã€æ—¥å¿—æ‰“å°ã€æƒé™æ§åˆ¶ã€è¿œç¨‹è°ƒç”¨ã€å®‰å…¨ä»£ç† å¯ä»¥éšè”½çœŸå®è§’è‰²</p><p>ä»£ç†çš„åˆ†ç±»</p><p>é™æ€ä»£ç†(é™æ€å®šä¹‰ä»£ç†ç±»)</p><p>åŠ¨æ€ä»£ç†(åŠ¨æ€ç”Ÿæˆä»£ç†ç±»)</p><p>Jdkè‡ªå¸¦åŠ¨æ€ä»£ç†</p><p>Cglib ã€javaassistï¼ˆå­—èŠ‚ç æ“ä½œåº“ï¼‰</p><p>é™æ€ä»£ç†</p><p>ä»€ä¹ˆæ˜¯é™æ€ä»£ç†</p><p>ç”±ç¨‹åºå‘˜åˆ›å»ºæˆ–å·¥å…·ç”Ÿæˆä»£ç†ç±»çš„æºç ï¼Œå†ç¼–è¯‘ä»£ç†ç±»ã€‚æ‰€è°“é™æ€ä¹Ÿå°±æ˜¯åœ¨ç¨‹åºè¿è¡Œå‰å°±å·²ç»å­˜åœ¨ä»£ç†ç±»çš„å­—èŠ‚ç æ–‡ä»¶ï¼Œä»£ç†ç±»å’Œå§”æ‰˜ç±»çš„å…³ç³»åœ¨è¿è¡Œå‰å°±ç¡®å®šäº†ã€‚</p><p>é™æ€ä»£ç†ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">IUserDao</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">()</span></span>;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserDao</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">IUserDao</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;å·²ç»ä¿å­˜æ•°æ®...&quot;</span>);<br>    &#125;<br>&#125;<br>ä»£ç†ç±»<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserDaoProxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">IUserDao</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> IUserDao target;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">UserDaoProxy</span><span class="hljs-params">(IUserDao iuserDao)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.target = iuserDao;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;å¼€å¯äº‹ç‰©...&quot;</span>);<br>        target.save();<br>        System.out.println(<span class="hljs-string">&quot;å…³é—­äº‹ç‰©...&quot;</span>);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>åŠ¨æ€ä»£ç†</p><p>ä»€ä¹ˆæ˜¯åŠ¨æ€ä»£ç†</p><p>1.ä»£ç†å¯¹è±¡,ä¸éœ€è¦å®ç°æ¥å£</p><p>2.ä»£ç†å¯¹è±¡çš„ç”Ÿæˆ,æ˜¯åˆ©ç”¨JDKçš„API,åŠ¨æ€çš„åœ¨å†…å­˜ä¸­æ„å»ºä»£ç†å¯¹è±¡(éœ€è¦æˆ‘ä»¬æŒ‡å®šåˆ›å»ºä»£ç†å¯¹è±¡/ç›®æ ‡å¯¹è±¡å®ç°çš„æ¥å£çš„ç±»å‹)</p><p>3.åŠ¨æ€ä»£ç†ä¹Ÿå«åš:JDKä»£ç†,æ¥å£ä»£ç†</p><p>JDKåŠ¨æ€ä»£ç†</p><p>1)åŸç†ï¼šæ˜¯æ ¹æ®ç±»åŠ è½½å™¨å’Œæ¥å£åˆ›å»ºä»£ç†ç±»ï¼ˆæ­¤ä»£ç†ç±»æ˜¯æ¥å£çš„å®ç°ç±»ï¼Œæ‰€ä»¥å¿…é¡»ä½¿ç”¨æ¥å£ é¢å‘æ¥å£ç”Ÿæˆä»£ç†ï¼Œä½äºjava.lang.reflectåŒ…ä¸‹ï¼‰</p><p>2)å®ç°æ–¹å¼ï¼š</p><p>é€šè¿‡å®ç°InvocationHandleræ¥å£åˆ›å»ºè‡ªå·±çš„è°ƒç”¨å¤„ç†å™¨ IvocationHandler handler = new InvocationHandlerImpl(â€¦);</p><p>é€šè¿‡ä¸ºProxyç±»æŒ‡å®šClassLoaderå¯¹è±¡å’Œä¸€ç»„interfaceåˆ›å»ºåŠ¨æ€ä»£ç†ç±»Class clazz = Proxy.getProxyClass(classLoader,new Class[]{â€¦});</p><p>é€šè¿‡åå°„æœºåˆ¶è·å–åŠ¨æ€ä»£ç†ç±»çš„æ„é€ å‡½æ•°ï¼Œå…¶å‚æ•°ç±»å‹æ˜¯è°ƒç”¨å¤„ç†å™¨æ¥å£ç±»å‹Constructor constructor = clazz.getConstructor(new Class[]);</p><p>é€šè¿‡æ„é€ å‡½æ•°åˆ›å»ºä»£ç†ç±»å®ä¾‹ï¼Œæ­¤æ—¶éœ€å°†è°ƒç”¨å¤„ç†å™¨å¯¹è±¡ä½œä¸ºå‚æ•°è¢«ä¼ å…¥Interface Proxy = (Interface)constructor.newInstance(new Object[] (handler));</p><p>ç¼ºç‚¹ï¼šjdkåŠ¨æ€ä»£ç†ï¼Œå¿…é¡»æ˜¯é¢å‘æ¥å£ï¼Œç›®æ ‡ä¸šåŠ¡ç±»å¿…é¡»å®ç°æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æ¯æ¬¡ç”ŸæˆåŠ¨æ€ä»£ç†ç±»å¯¹è±¡æ—¶,å®ç°äº†InvocationHandleræ¥å£çš„è°ƒç”¨å¤„ç†å™¨å¯¹è±¡ </span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">InvocationHandlerImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">InvocationHandler</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> Object target;<span class="hljs-comment">// è¿™å…¶å®ä¸šåŠ¡å®ç°ç±»å¯¹è±¡ï¼Œç”¨æ¥è°ƒç”¨å…·ä½“çš„ä¸šåŠ¡æ–¹æ³•</span><br>    <span class="hljs-comment">// é€šè¿‡æ„é€ å‡½æ•°ä¼ å…¥ç›®æ ‡å¯¹è±¡</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">InvocationHandlerImpl</span><span class="hljs-params">(Object target)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.target = target;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable </span>&#123;<br>        Object result = <span class="hljs-keyword">null</span>;<br>        System.out.println(<span class="hljs-string">&quot;è°ƒç”¨å¼€å§‹å¤„ç†&quot;</span>);<br>        result = method.invoke(target, args);<br>        System.out.println(<span class="hljs-string">&quot;è°ƒç”¨ç»“æŸå¤„ç†&quot;</span>);<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> NoSuchMethodException, SecurityException, InstantiationException,</span><br><span class="hljs-function">            IllegalAccessException, IllegalArgumentException, InvocationTargetException </span>&#123;<br>        <span class="hljs-comment">// è¢«ä»£ç†å¯¹è±¡</span><br>        IUserDao userDao = <span class="hljs-keyword">new</span> UserDao();<br>        InvocationHandlerImpl invocationHandlerImpl = <span class="hljs-keyword">new</span> InvocationHandlerImpl(userDao);<br>        ClassLoader loader = userDao.getClass().getClassLoader();<br>        Class&lt;?&gt;[] interfaces = userDao.getClass().getInterfaces();<br>        <span class="hljs-comment">// ä¸»è¦è£…è½½å™¨ã€ä¸€ç»„æ¥å£åŠè°ƒç”¨å¤„ç†åŠ¨æ€ä»£ç†å®ä¾‹</span><br>        IUserDao newProxyInstance = (IUserDao) Proxy.newProxyInstance(loader, interfaces, invocationHandlerImpl);<br>        newProxyInstance.save();<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>CGLIBåŠ¨æ€ä»£ç†ä¸JDKåŠ¨æ€åŒºåˆ«</p><p>javaåŠ¨æ€ä»£ç†æ˜¯åˆ©ç”¨åå°„æœºåˆ¶ç”Ÿæˆä¸€ä¸ªå®ç°ä»£ç†æ¥å£çš„åŒ¿åç±»ï¼Œåœ¨è°ƒç”¨å…·ä½“æ–¹æ³•å‰è°ƒç”¨InvokeHandleræ¥å¤„ç†ã€‚</p><p>è€ŒcglibåŠ¨æ€ä»£ç†æ˜¯åˆ©ç”¨asmå¼€æºåŒ…ï¼Œå¯¹ä»£ç†å¯¹è±¡ç±»çš„classæ–‡ä»¶åŠ è½½è¿›æ¥ï¼Œé€šè¿‡ä¿®æ”¹å…¶å­—èŠ‚ç ç”Ÿæˆå­ç±»æ¥å¤„ç†ã€‚</p><p>Springä¸­ã€‚</p><p>1ã€å¦‚æœç›®æ ‡å¯¹è±¡å®ç°äº†æ¥å£ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šé‡‡ç”¨JDKçš„åŠ¨æ€ä»£ç†å®ç°AOP</p><p>2ã€å¦‚æœç›®æ ‡å¯¹è±¡å®ç°äº†æ¥å£ï¼Œå¯ä»¥å¼ºåˆ¶ä½¿ç”¨CGLIBå®ç°AOP</p><p>3ã€å¦‚æœç›®æ ‡å¯¹è±¡æ²¡æœ‰å®ç°äº†æ¥å£ï¼Œå¿…é¡»é‡‡ç”¨CGLIBåº“ï¼Œspringä¼šè‡ªåŠ¨åœ¨JDKåŠ¨æ€ä»£ç†å’ŒCGLIBä¹‹é—´è½¬æ¢</p><p>JDKåŠ¨æ€ä»£ç†åªèƒ½å¯¹å®ç°äº†æ¥å£çš„ç±»ç”Ÿæˆä»£ç†ï¼Œè€Œä¸èƒ½é’ˆå¯¹ç±» ã€‚ CGLIBæ˜¯é’ˆå¯¹ç±»å®ç°ä»£ç†ï¼Œä¸»è¦æ˜¯å¯¹æŒ‡å®šçš„ç±»ç”Ÿæˆä¸€ä¸ªå­ç±»ï¼Œè¦†ç›–å…¶ä¸­çš„æ–¹æ³• ã€‚ å› ä¸ºæ˜¯ç»§æ‰¿ï¼Œæ‰€ä»¥è¯¥ç±»æˆ–æ–¹æ³•æœ€å¥½ä¸è¦å£°æ˜æˆfinal ï¼Œfinalå¯ä»¥é˜»æ­¢ç»§æ‰¿å’Œå¤šæ€ã€‚</p><h1 id="AOPç¼–ç¨‹ä½¿ç”¨"><a href="#AOPç¼–ç¨‹ä½¿ç”¨" class="headerlink" title="AOPç¼–ç¨‹ä½¿ç”¨"></a>AOPç¼–ç¨‹ä½¿ç”¨</h1><p>æ³¨è§£ç‰ˆæœ¬å®ç°AOP</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;aop:aspectj-autoproxy&gt;&lt;/aop:aspectj-autoproxy&gt;  å¼€å¯äº‹ç‰©æ³¨è§£æƒé™<br><span class="hljs-meta">@Aspect</span>                         æŒ‡å®šä¸€ä¸ªç±»ä¸ºåˆ‡é¢ç±»       <br><span class="hljs-meta">@Pointcut(&quot;execution(* com.service.UserService.add(..))&quot;)</span>  æŒ‡å®šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼<br><span class="hljs-meta">@Before(&quot;pointCut_()&quot;)</span>              å‰ç½®é€šçŸ¥: ç›®æ ‡æ–¹æ³•ä¹‹å‰æ‰§è¡Œ<br><span class="hljs-meta">@After(&quot;pointCut_()&quot;)</span>               åç½®é€šçŸ¥ï¼šç›®æ ‡æ–¹æ³•ä¹‹åæ‰§è¡Œï¼ˆå§‹ç»ˆæ‰§è¡Œï¼‰<br><span class="hljs-meta">@AfterReturning(&quot;pointCut_()&quot;)</span>       è¿”å›åé€šçŸ¥ï¼š æ‰§è¡Œæ–¹æ³•ç»“æŸå‰æ‰§è¡Œ(å¼‚å¸¸ä¸æ‰§è¡Œ)<br><span class="hljs-meta">@AfterThrowing(&quot;pointCut_()&quot;)</span>           å¼‚å¸¸é€šçŸ¥:  å‡ºç°å¼‚å¸¸æ—¶å€™æ‰§è¡Œ<br><span class="hljs-meta">@Around(&quot;pointCut_()&quot;)</span>              ç¯ç»•é€šçŸ¥ï¼š ç¯ç»•ç›®æ ‡æ–¹æ³•æ‰§è¡Œ<br><br><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Aspect</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AopLog</span> </span>&#123;<br><br>    <span class="hljs-comment">// å‰ç½®é€šçŸ¥</span><br>    <span class="hljs-meta">@Before(&quot;execution(* com.service.UserService.add(..))&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">begin</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;å‰ç½®é€šçŸ¥&quot;</span>);<br>    &#125;<br><br><br>    <span class="hljs-comment">// åç½®é€šçŸ¥</span><br>    <span class="hljs-meta">@After(&quot;execution(* com.service.UserService.add(..))&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">commit</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;åç½®é€šçŸ¥&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// è¿è¡Œé€šçŸ¥</span><br>    <span class="hljs-meta">@AfterReturning(&quot;execution(* com.service.UserService.add(..))&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">returning</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;è¿è¡Œé€šçŸ¥&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// å¼‚å¸¸é€šçŸ¥</span><br>    <span class="hljs-meta">@AfterThrowing(&quot;execution(* com.service.UserService.add(..))&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">afterThrowing</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;å¼‚å¸¸é€šçŸ¥&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// ç¯ç»•é€šçŸ¥</span><br>    <span class="hljs-meta">@Around(&quot;execution(* com.service.UserService.add(..))&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">around</span><span class="hljs-params">(ProceedingJoinPoint proceedingJoinPoint)</span> <span class="hljs-keyword">throws</span> Throwable </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;ç¯ç»•é€šçŸ¥å¼€å§‹&quot;</span>);<br>        proceedingJoinPoint.proceed();<br>        System.out.println(<span class="hljs-string">&quot;ç¯ç»•é€šçŸ¥ç»“æŸ&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>XMLæ–¹å¼å®ç°AOP</p><p>Xmlå®ç°aopç¼–ç¨‹ï¼š 1ï¼‰ å¼•å…¥jaræ–‡ä»¶ ã€aop ç›¸å…³jarï¼Œ 4ä¸ªã€‘ 2ï¼‰ å¼•å…¥aopåç§°ç©ºé—´ 3ï¼‰aop é…ç½® * é…ç½®åˆ‡é¢ç±» ï¼ˆé‡å¤æ‰§è¡Œä»£ç å½¢æˆçš„ç±»ï¼‰ * aopé…ç½® æ‹¦æˆªå“ªäº›æ–¹æ³• / æ‹¦æˆªåˆ°æ–¹æ³•ååº”ç”¨é€šçŸ¥ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;beans xmlns=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span><br>    xmlns:xsi=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> xmlns:p=<span class="hljs-string">&quot;http://www.springframework.org/schema/p&quot;</span><br>    xmlns:context=<span class="hljs-string">&quot;http://www.springframework.org/schema/context&quot;</span><br>    xmlns:aop=<span class="hljs-string">&quot;http://www.springframework.org/schema/aop&quot;</span><br>    xsi:schemaLocation=<span class="hljs-string">&quot;</span><br><span class="hljs-string">        http://www.springframework.org/schema/beans</span><br><span class="hljs-string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span><br><span class="hljs-string">        http://www.springframework.org/schema/context</span><br><span class="hljs-string">        http://www.springframework.org/schema/context/spring-context.xsd</span><br><span class="hljs-string">        http://www.springframework.org/schema/aop</span><br><span class="hljs-string">        http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;<br><br>    &lt;!-- dao å®ä¾‹ --&gt;<br><br>    &lt;bean id=&quot;userService&quot; class=&quot;com.service.UserService&quot;&gt;&lt;/bean&gt;<br>    &lt;!-- åˆ‡é¢ç±» --&gt;<br>    &lt;bean id=&quot;aop&quot; class=&quot;com.aop2.AopLog2&quot;&gt;&lt;/bean&gt;<br>    &lt;!-- Aopé…ç½® --&gt;<br>    &lt;aop:config&gt;<br>        &lt;!-- å®šä¹‰ä¸€ä¸ªåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼š æ‹¦æˆªå“ªäº›æ–¹æ³• --&gt;<br>        &lt;aop:pointcut expression=<span class="hljs-string">&quot;execution(* com.service.UserService.*(..))&quot;</span><br>            id=<span class="hljs-string">&quot;pt&quot;</span> /&gt;<br>        &lt;!-- åˆ‡é¢ --&gt;<br>        &lt;aop:aspect ref=<span class="hljs-string">&quot;aop&quot;</span>&gt;<br>            &lt;!-- ç¯ç»•é€šçŸ¥ --&gt;<br>            &lt;aop:around method=<span class="hljs-string">&quot;around&quot;</span> pointcut-ref=<span class="hljs-string">&quot;pt&quot;</span> /&gt;<br>            &lt;!-- å‰ç½®é€šçŸ¥ï¼š åœ¨ç›®æ ‡æ–¹æ³•è°ƒç”¨å‰æ‰§è¡Œ --&gt;<br>            &lt;aop:before method=<span class="hljs-string">&quot;begin&quot;</span> pointcut-ref=<span class="hljs-string">&quot;pt&quot;</span> /&gt;<br>            &lt;!-- åç½®é€šçŸ¥ï¼š --&gt;<br>            &lt;aop:after method=<span class="hljs-string">&quot;after&quot;</span> pointcut-ref=<span class="hljs-string">&quot;pt&quot;</span> /&gt;<br>            &lt;!-- è¿”å›åé€šçŸ¥ --&gt;<br>            &lt;aop:after-returning method=<span class="hljs-string">&quot;afterReturning&quot;</span><br>                pointcut-ref=<span class="hljs-string">&quot;pt&quot;</span> /&gt;<br>            &lt;!-- å¼‚å¸¸é€šçŸ¥ --&gt;<br>            &lt;aop:after-throwing method=<span class="hljs-string">&quot;afterThrowing&quot;</span><br>                pointcut-ref=<span class="hljs-string">&quot;pt&quot;</span> /&gt;<br>        &lt;/aop:aspect&gt;<br>    &lt;/aop:config&gt;<br><br>&lt;/beans&gt;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AopLog2</span> </span>&#123;<br><br>    <span class="hljs-comment">// å‰ç½®é€šçŸ¥</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">begin</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;å‰ç½®é€šçŸ¥&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//</span><br>    <span class="hljs-comment">// åç½®é€šçŸ¥</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">commit</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;åç½®é€šçŸ¥&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// è¿è¡Œé€šçŸ¥</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">returning</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;è¿è¡Œé€šçŸ¥&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// å¼‚å¸¸é€šçŸ¥</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">afterThrowing</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;å¼‚å¸¸é€šçŸ¥&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// ç¯ç»•é€šçŸ¥</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">around</span><span class="hljs-params">(ProceedingJoinPoint proceedingJoinPoint)</span> <span class="hljs-keyword">throws</span> Throwable </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;ç¯ç»•é€šçŸ¥å¼€å§‹&quot;</span>);<br>        proceedingJoinPoint.proceed();<br>        System.out.println(<span class="hljs-string">&quot;ç¯ç»•é€šçŸ¥ç»“æŸ&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><a href="https://bk.cuixiaoyan.xyz/archives/aop#spring%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86">Springæ ¸å¿ƒçŸ¥è¯†</a><a href="https://bk.cuixiaoyan.xyz/archives/aop#springaop%E5%8E%9F%E7%90%86">SpringAOPåŸç†</a><a href="https://bk.cuixiaoyan.xyz/archives/aop#aop%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86">AOPåº•å±‚å®ç°åŸç†</a><a href="https://bk.cuixiaoyan.xyz/archives/aop#aop%E7%BC%96%E7%A8%8B%E4%BD%BF%E7%94%A8">AOPç¼–ç¨‹ä½¿ç”¨</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>spring</tag>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å®ç°å¤šçº¿ç¨‹çš„ä¸‰ç§æ–¹æ³•</title>
    <link href="/blog/2021/01/19/%E5%AE%9E%E7%8E%B0%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9A%84%E4%B8%89%E7%A7%8D%E6%96%B9%E6%B3%95/"/>
    <url>/blog/2021/01/19/%E5%AE%9E%E7%8E%B0%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9A%84%E4%B8%89%E7%A7%8D%E6%96%B9%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<p>Javaè™šæ‹Ÿæœºï¼ˆJVMï¼Œæ˜¯è¿è¡Œæ‰€æœ‰Javaç¨‹åºçš„æŠ½è±¡è®¡ç®—æœºï¼Œæ˜¯Javaè¯­è¨€çš„è¿è¡Œç¯å¢ƒï¼‰å…è®¸åº”ç”¨ç¨‹åºå¹¶å‘åœ°è¿è¡Œå¤šä¸ªçº¿ç¨‹ã€‚åœ¨Javaè¯­è¨€ä¸­ï¼Œå¤šçº¿ç¨‹çš„å®ç°ä¸€èˆ¬æœ‰ä»¥ä¸‹ä¸‰ç§æ–¹æ³•ï¼š</p><p>1ã€å®ç°Runnableæ¥å£ï¼Œå¹¶å®ç°è¯¥æ¥å£çš„run()æ–¹æ³•ã€‚</p><p>ã€€ã€€â‘ è‡ªå®šä¹‰ç±»å¹¶å®ç°Runnableæ¥å£ï¼Œå®ç°run()æ–¹æ³•ã€‚</p><p>ã€€ã€€â‘¡åˆ›å»ºThreadå¯¹è±¡ï¼Œç”¨å®ç°Runnableæ¥å£çš„å¯¹è±¡ä½œä¸ºå‚æ•°å®ä¾‹åŒ–è¯¥Threadå¯¹è±¡ã€‚</p><p>ã€€ã€€â‘¢è°ƒç”¨Threadçš„start()æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyThread</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Runnable</span></span>&#123;ã€€ã€€<span class="hljs-comment">//åˆ›å»ºçº¿ç¨‹ç±»</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;Thread body&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        MyThread thread = <span class="hljs-keyword">new</span> MyThread();<br>        Thread t = <span class="hljs-keyword">new</span> Thread(thread);<br>        t.run();ã€€ã€€<span class="hljs-comment">//å¼€å¯çº¿ç¨‹</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>2ã€ç»§æ‰¿Threadç±»ï¼Œé‡å†™run()æ–¹æ³•ã€‚</p><p>ã€€ã€€Threadæœ¬è´¨ä¸Šä¹Ÿæ˜¯å®ç°äº†Runnableæ¥å£çš„ä¸€ä¸ªå®ä¾‹ï¼Œå®ƒä»£è¡¨ä¸€ä¸ªçº¿ç¨‹çš„å®ä¾‹ï¼Œå¹¶ä¸”ï¼Œå¯åŠ¨çº¿ç¨‹çš„å”¯ä¸€æ–¹æ³•å°±æ˜¯é€šè¿‡Threadç±»çš„start()æ–¹æ³•ã€‚start()æ–¹æ³•æ˜¯ä¸€ä¸ªnativeï¼ˆæœ¬åœ°ï¼‰æ–¹æ³•ï¼Œå®ƒå°†å¯åŠ¨ä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œå¹¶æ‰§è¡Œrun()æ–¹æ³•ï¼ˆThreadä¸­æä¾›çš„run()æ–¹æ³•æ˜¯ä¸€ä¸ªç©ºæ–¹æ³•ï¼‰ã€‚è¿™ç§æ–¹å¼é€šè¿‡è‡ªå®šä¹‰ç±»ç›´æ¥extends Threadï¼Œå¹¶é‡å†™run()æ–¹æ³•ï¼Œå°±å¯ä»¥å¯åŠ¨æ–°çº¿ç¨‹å¹¶æ‰§è¡Œè‡ªå·±å®šä¹‰çš„run()æ–¹æ³•ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“start()æ–¹æ³•è°ƒç”¨åå¹¶ä¸æ˜¯ç«‹å³æ‰§è¡Œå¤šçº¿ç¨‹ä»£ç ï¼Œè€Œæ˜¯ä½¿å¾—è¯¥çº¿ç¨‹å˜ä¸ºå¯è¿è¡Œæ€ï¼ˆRunnableï¼‰ï¼Œä»€ä¹ˆæ—¶å€™è¿è¡Œå¤šçº¿ç¨‹ä»£ç æ˜¯ç”±æ“ä½œç³»ç»Ÿå†³å®šçš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyThread</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Thread</span> </span>&#123;    <span class="hljs-comment">//åˆ›å»ºçº¿ç¨‹ç±»</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;Thread body&quot;</span>);    <span class="hljs-comment">//çº¿ç¨‹çš„æ–¹æ³•ä½“</span><br>    &#125;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        MyThread thread = <span class="hljs-keyword">new</span> MyThread();<br>        thread.run();    <span class="hljs-comment">//å¼€å¯çº¿ç¨‹</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>3ã€å®ç°Callableæ¥å£ï¼Œé‡å†™call()æ–¹æ³•ã€‚</p><p>ã€€ã€€Callableå¯¹è±¡å®é™…æ˜¯å±äºExecutoræ¡†æ¶ä¸­çš„åŠŸèƒ½ç±»ï¼ŒCallableæ¥å£ä¸Runnableæ¥å£ç±»ä¼¼ï¼Œä½†æ˜¯æä¾›äº†æ¯”Runnableæ›´å¼ºå¤§ çš„åŠŸèƒ½ï¼Œä¸»è¦è¡¨ç°ä¸ºä»¥ä¸‹ä¸‰ç‚¹ï¼š</p><p>ã€€ã€€â‘ Callableå¯ä»¥åœ¨ä»»åŠ¡ç»“æŸåæä¾›ä¸€ä¸ªè¿”å›å€¼ï¼ŒRunnableæ— æ³•æä¾›è¿™ä¸ªåŠŸèƒ½ã€‚</p><p>ã€€ã€€â‘¡Callableä¸­çš„callæ–¹æ³•å¯ä»¥æŠ›å‡ºå¼‚å¸¸ï¼Œè€ŒRunnableçš„run()æ–¹æ³•ä¸èƒ½æŠ›å‡ºå¼‚å¸¸ã€‚</p><p>ã€€ã€€â‘¢è¿è¡ŒCallableå¯ä»¥æ‹¿åˆ°ä¸€ä¸ªFutureå¯¹è±¡ï¼ŒFutureå¯¹è±¡è¡¨ç¤ºå¼‚æ­¥è®¡ç®—çš„ç»“æœã€‚å®ƒæä¾›äº†æ£€æŸ¥è®¡ç®—æ˜¯å¦å®Œæˆçš„æ–¹æ³•ã€‚ç”±äºçº¿ç¨‹å±äºå¼‚æ­¥è®¡ç®—æ¨¡å‹ï¼Œæ‰€ä»¥æ— æ³•ä»å…¶ä»–çº¿ç¨‹ä¸­å¾—åˆ°æ–¹æ³•çš„è¿”å›å€¼ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°±å¯ä»¥ä½¿ç”¨Futureæ¥ç›‘è§†ç›®æ ‡çº¿ç¨‹è°ƒç”¨call()æ–¹æ³•çš„æƒ…å†µï¼Œå½“è°ƒç”¨Futureçš„get()æ–¹æ³•ä»¥è·å–ç»“æœæ—¶ï¼Œå½“å‰çº¿ç¨‹å°±ä¼šé˜»å¡ï¼Œç›´åˆ°call()æ–¹æ³•ç»“æŸè¿”å›ç»“æœã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.concurrent.*;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CallableAndFuture</span></span>&#123;ã€€ã€€<span class="hljs-comment">//åˆ›å»ºçº¿ç¨‹ç±»</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CallableTest</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Callable</span>&lt;<span class="hljs-title">String</span>&gt;</span>&#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">call</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello World!&quot;</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        ExecutorService threadPool = Executors.newSingleThreadExecutor();<br>        <span class="hljs-comment">//å¯åŠ¨çº¿ç¨‹</span><br>        Future&lt;String&gt; future = threadPool.submit(<span class="hljs-keyword">new</span> CallableTest());<br>        <span class="hljs-keyword">try</span>&#123;<br>            System.out.println(<span class="hljs-string">&quot;waiting thread to finish&quot;</span>);<br>            System.out.println(future.get());ã€€ã€€<span class="hljs-comment">//ç­‰å¾…çº¿ç¨‹ç»“æŸï¼Œå¹¶è·å–è¿”å›ç»“æœ</span><br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ã€€ã€€åœ¨ä»¥ä¸Šä¸‰ç§æ–¹å¼ä¸­ï¼Œå‰ä¸¤ç§æ–¹å¼çº¿ç¨‹æ‰§è¡Œå®Œåéƒ½æ²¡æœ‰è¿”å›å€¼ï¼Œåªæœ‰æœ€åä¸€ç§æ˜¯å¸¦è¿”å›å€¼çš„ã€‚å½“éœ€è¦å®ç°å¤šçº¿ç¨‹æ—¶ï¼Œä¸€èˆ¬æ¨èå®ç°Runnableæ¥å£çš„æ–¹å¼ï¼ŒåŸå› å¦‚ä¸‹ï¼šé¦–å…ˆï¼ŒThreadç±»å®šä¹‰äº†å¤šç§æ–¹æ³•å¯ä»¥è¢«æ´¾ç”Ÿç±»ä½¿ç”¨æˆ–é‡å†™ï¼Œä½†æ˜¯åªæœ‰runæ–¹æ³•æ˜¯å¿…é¡»è¢«é‡å†™çš„ï¼Œåœ¨runæ–¹æ³•ä¸­å®ç°è¿™ä¸ªçº¿ç¨‹çš„ä¸»è¦åŠŸèƒ½ã€‚è¿™å½“ç„¶æ˜¯å®ç°Runnableæ¥å£æ‰€éœ€çš„åŒæ ·çš„æ–¹æ³•ã€‚è€Œä¸”ï¼Œå¾ˆå¤šJavaå¼€å‘äººå‘˜è®¤ä¸ºï¼Œä¸€ä¸ªäººä»…åœ¨å®ƒä»¬éœ€è¦è¢«åŠ å¼ºæˆ–ä¿®æ”¹æ—¶æ‰ä¼šè¢«ç»§æ‰¿ã€‚å› æ­¤ï¼Œå¦‚æœæ²¡æœ‰å¿…è¦é‡å†™Threadç±»ä¸­çš„å…¶ä»–æ–¹æ³•ï¼Œé‚£ä¹ˆé€šè¿‡ç»§æ‰¿Threadçš„å®ç°æ–¹å¼å’Œå®ç°Runnableæ¥å£çš„æ•ˆæœç›¸åŒï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æœ€å¥½é€šè¿‡Runnableæ¥å£çš„æ–¹å¼æ¥åˆ›å»ºçº¿ç¨‹ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>çº¿ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>javaé›†åˆé¢è¯•20é—®</title>
    <link href="/blog/2021/01/18/java%E9%9B%86%E5%90%88%E9%9D%A2%E8%AF%9520%E9%97%AE/"/>
    <url>/blog/2021/01/18/java%E9%9B%86%E5%90%88%E9%9D%A2%E8%AF%9520%E9%97%AE/</url>
    
    <content type="html"><![CDATA[<ol><li>HashMapçš„å†…éƒ¨å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</li></ol><p>HashMapå†…éƒ¨å®ç°åŸç†æ˜¯æ•°ç»„+é“¾è¡¨ï¼Œé€šè¿‡æ•£åˆ—ç®—æ³•å°†keyå€¼æ•£åˆ—åˆ°æ•°ç»„ä¸­ï¼Œå¦‚æœåˆ°ç›¸åŒçš„ä½ç½®ï¼Œåˆ™é€šè¿‡æ‹‰é“¾æ³•è§£å†³æ•£åˆ—å†²çªã€‚åœ¨JDK8ä¸­æ–°å¢äº†çº¢é»‘æ ‘ç»“æ„ï¼Œå½“HashMapä¸­çš„æ•£åˆ—å†²çªé“¾è¡¨ç»“æ„è¶…è¿‡8ä¸ªæ•°æ®æ—¶ï¼Œä¼šä»é“¾è¡¨ç»“æ„è½¬æ¢ä¸ºçº¢é»‘æ ‘ç»“æ„ã€‚</p><ol><li>HashMapçš„keyå€¼èƒ½å¦æ˜¯nullï¼Œå¦‚æœèƒ½ï¼Œkey=nullå¦‚ä½•å­˜å‚¨ä»¥åŠå¦‚ä½•è¯»å–çš„ï¼Ÿå¦‚æœä¸èƒ½ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</li></ol><p>HashMapçš„keyå€¼å¯ä»¥æ˜¯nullã€‚å¦‚æœkey=nullï¼Œåˆ™ä¼šå°†å®ƒæ”¾ç½®åœ¨æ•°ç»„ä¸‹æ ‡ä¸º0çš„ä½ç½®ã€‚</p><ol><li>HashMapå¦‚ä½•å®ç°æ‰©å®¹ï¼Ÿ</li></ol><p>HashMapæ‰©å®¹å’Œåˆå§‹å®¹å™¨å¤§å°ä¸è´Ÿè½½å› å­æœ‰å…³ã€‚HashMapçš„åˆå§‹å®¹å™¨å¤§å°ä¸º16ï¼Œé»˜è®¤çš„è´Ÿè½½å› å­ä¸º0.75ï¼Œå½“å®é™…å®¹é‡è¶…è¿‡16*0.75=12ä¸ªå…ƒç´ æ—¶ä¼šè¿›è¡Œæ‰©å®¹ã€‚æ‰©å®¹åçš„å®¹å™¨å¤§å°æ˜¯æ‰©å®¹å‰çš„2å€ï¼Œç¬¬ä¸€æ¬¡æ‰©å®¹åçš„å®¹å™¨å¤§å°ä¸º32ã€‚</p><ol><li>è®¾ç½®HashMapçš„å®¹é‡æœ‰æ²¡æœ‰æ³¨æ„çš„åœ°æ–¹ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</li></ol><p>æŒ‡å®šHashMapçš„å®¹é‡æ—¶ï¼Œå»ºè®®æ˜¯2çš„å¹‚æ¬¡æ–¹ã€‚</p><p>HashMapåœ¨å¯»å€æ˜¯ä¼škeyçš„hashå€¼ä¸å®¹å™¨é•¿åº¦åšä¸è¿ç®—ï¼Œ(n - 1) &amp; hashã€‚å½“nçš„é•¿åº¦ä¸º2çš„å¹‚æ¬¡æ–¹æ—¶ï¼Œn-1çš„äºŒè¿›åˆ¶å½¢å¼å°±ä¼šæ˜¯111111ï¼Œè¿™æ ·ä¸æ“ä½œæ•ˆç‡ä¼šéå¸¸çš„å¿«ã€‚</p><ol><li>HashMapæ˜¯å¦æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿå¦‚æœä¸æ˜¯ï¼Œå¤šçº¿ç¨‹ä¸‹å¹¶å‘æ“ä½œå®ƒå¯èƒ½ä¼šå¸¦æ¥ä»€ä¹ˆé—®é¢˜ï¼Ÿå¦‚æœæ˜¯ï¼Œå®ƒæ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</li></ol><p>HashMapä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å¦‚æœåœ¨å¤šçº¿ç¨‹ä¸‹å¹¶å‘æ“ä½œä¸ä»…ä¼šå¯¼è‡´è„æ•°æ®ï¼Œç”šè‡³å¯èƒ½ä¼šé€ æˆæ­»å¾ªç¯ã€‚ï¼ˆå…³äºæ­»å¾ªç¯äº§ç”Ÿçš„åŸå› å‚è€ƒ<a href="https://www.cnblogs.com/yulinfeng/p/8558983.html%EF%BC%89">https://www.cnblogs.com/yulinfeng/p/8558983.htmlï¼‰</a></p><ol><li>LinkedHashMapçš„å†…éƒ¨å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿå®ƒæ˜¯å¦æ”¯æŒkey=nullï¼Ÿ</li></ol><p>LinkedHashMapæ˜¯æ’å…¥æœ‰åºçš„Mapé›†åˆã€‚å®ƒç›´æ¥ç»§æ‰¿äº†HashMapï¼Œæ‰€ä»¥å¾ˆå¤šéƒ½ç›´æ¥å¤ç”¨äº†HashMapæ–¹æ³•ï¼Œæ‰€ä»¥ä¹Ÿæ”¯æŒkey=nullã€‚å®ƒåœ¨å†…éƒ¨é™¤äº†æ²¿ç”¨HashMapçš„åº•å±‚ç»“æ„ï¼Œè¿˜å•ç‹¬ç»´æŠ¤äº†ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œåœ¨å¯¹Mapè¿›è¡Œputæ“ä½œæ—¶ï¼ŒåŒæ—¶è¿˜ä¼šå°†æ•°æ®å†™åˆ°äº†é“¾è¡¨çš„å°¾éƒ¨ï¼Œä¿è¯äº†æ’å…¥æœ‰åºã€‚</p><ol><li>TreeMapçš„å†…éƒ¨å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿå®ƒæ˜¯å¦æ”¯æŒkey=nullï¼Ÿ</li></ol><p>TreeMapç»“æ„ä¹Ÿæ˜¯æœ‰åºçš„ï¼Œä¸åŒçš„æ˜¯å®ƒæ˜¯å­—å…¸æœ‰åºï¼Œç”±äºå®ƒåº•å±‚æ˜¯çº¢é»‘æ ‘ç»“æ„ï¼Œæ’å…¥æ—¶ä¼šè¿›è¡Œæ¯”è¾ƒkeyå€¼çš„é¡ºåºï¼Œæ‰€ä»¥ä¸å…è®¸key=nullçš„æƒ…å†µã€‚</p><ol><li>ä»‹ç»ä¸‹Hashtable</li></ol><p>Hashtableæ˜¯çº¿ç¨‹å®‰å…¨çš„Mapç±»å‹ï¼Œä½†å®ƒçš„çº¿ç¨‹å®‰å…¨ä»£ä»·æ˜¯ä¸ºæ•´ä¸ªæ•£åˆ—è¡¨åŠ é”ï¼Œæ•ˆç‡å¾ˆä½ï¼Œå‡ ä¹å·²ç»åºŸå¼ƒã€‚å¦‚æœè¦ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„Mapï¼Œåº”è¯¥ä½¿ç”¨ConcurrentHashMapï¼Œå®ƒçš„å®ç°æ˜¯åˆ†æ®µé”ï¼Œèƒ½æœ€å¤§çš„æé«˜æ•ˆç‡ã€‚</p><ol><li>ä»¥ä¸Šä¸‰ç§Mapç±»å‹åˆ†åˆ«å¯ä»¥åº”ç”¨åˆ°å“ªäº›åœºæ™¯ï¼Ÿä½ åœ¨å“ªäº›åœºæ™¯ä¸‹ä½¿ç”¨è¿‡ï¼Ÿ</li></ol><p>HashMapçš„ä½¿ç”¨åœºæ™¯å¾ˆå¤šï¼Œè¿™ä¸ªä½¿ç”¨åœºæ™¯å°±å¤ªå¤šäº†ï¼Œæ¯”å¦‚ç”¨ä½œæœ¬åœ°ç¼“å­˜ã€‚</p><p>LinkedHashMapå› ä¸ºå®ƒçš„é“¾è¡¨ç»“æ„å¯ä»¥å®ç°LRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰ï¼Œå³ç¼“å­˜ç©ºé—´æœ‰é™ï¼Œå½“å…ƒç´ å¤šä½™ç¼“å­˜ç©ºé—´ï¼Œå¯æ·˜æ±°æ‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„å…ƒç´ ã€‚åœ¨LinkedHashMapç»´æŠ¤äº†ä¸€ä¸ªaccessOrderå­—æ®µï¼Œé»˜è®¤ä¸ºfalseï¼Œå½“è®¾ç½®ä¸ºtrueæ—¶ï¼Œå¦‚æœè®¿é—®ä¸€ä¸ªkeyå€¼ï¼Œå°±ä¼šå°†è¿™ä¸ªå…ƒç´ æ”¾ç½®é“¾è¡¨å¤´éƒ¨ï¼Œè¿™æ ·åœ¨é“¾è¡¨å°¾éƒ¨çš„å…ƒç´ å°±æ˜¯ä¸å¸¸ç”¨çš„å…ƒç´ ï¼Œç©ºé—´ä¸è¶³ç›´æ¥removeæœ«å°¾çš„å…ƒç´ å³å¯ã€‚æ‰€ä»¥å½“è¦å®ç°LRUç¼“å­˜æ—¶ï¼Œå°±å¯ä»¥å°†accessOrderè®¾ç½®ä¸ºtrueå®ç°ã€‚</p><p>TreeMapæ²¡æœ‰å®é™…åº”ç”¨è¿‡ï¼Œå¦‚æœæœ‰éœ€è¦æ’åºçš„åœºæ™¯åˆ™ä½¿ç”¨TreeMap</p><p>Set 10. HashSetçš„å†…éƒ¨å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Œå®ƒæœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ</p><p>HashSeté›†åˆçš„ç‰¹ç‚¹æ˜¯ä¸å…è®¸æœ‰é‡å¤çš„å…ƒç´ ï¼Œä¸”æ— åºçš„ï¼Œå…è®¸nullå€¼ã€‚å®ƒåœ¨å†…éƒ¨ç»´æŠ¤ä¸€ä¸ªHashMapï¼Œå­˜å‚¨åœ¨HashSetä¸­çš„å…ƒç´ å®é™…ä¸Šå­˜å‚¨åœ¨HashMapçš„keyä¸­ã€‚</p><ol><li>LinkedHashSetçš„å†…éƒ¨å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Œå®ƒæœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ</li></ol><p>LinkedHashSetç»§æ‰¿è‡ªHashMapï¼Œåœ¨å†…éƒ¨ç»´æŠ¤ä¸€ä¸ªåŒå‘é“¾è¡¨ä¿è¯æ’å…¥æœ‰åºï¼Œå…è®¸nullå€¼ã€‚</p><ol><li>TreeSetçš„å†…éƒ¨å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Œå®ƒæœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ</li></ol><p>TreeSetæ˜¯ä¸€ä¸ªæœ‰åºçš„é›†åˆï¼Œå®ƒçš„ä½œç”¨æ˜¯æä¾›æœ‰åºçš„Seté›†åˆï¼ŒTreeSetæ˜¯åŸºäºTreeMapå®ç°çš„ã€‚ä¸å…è®¸æœ‰nullå€¼ã€‚</p><ol><li>ä»¥ä¸Šä¸‰ç§Setç±»å‹åˆ†åˆ«å¯ä»¥åº”ç”¨åˆ°å“ªäº›åœºæ™¯ï¼Ÿä½ åœ¨å“ªäº›åœºæ™¯ä¸‹ä½¿ç”¨è¿‡ï¼Ÿ</li></ol><p>HashSetå¯åº”ç”¨äºæ‰¹é‡æŸ¥è¯¢æ—¶å»é‡ã€‚</p><p>å¦‚æœéœ€è¦è¿”å›çš„æ•°æ®å’Œå…¥å‚çš„æ•°æ®é¡ºåºä¸€è‡´åˆ™å¯ä»¥ä½¿ç”¨LinkedHashSetã€‚</p><p>List 14. ArrayListçš„å†…éƒ¨å®ç°åŸç†ä»€ä¹ˆï¼Ÿ</p><p>åº•å±‚é€šè¿‡æ•°ç»„å®ç°ï¼Œåˆ›å»ºä¸€ä¸ªArrayListå¯¹è±¡å®ä¾‹æ—¶ä¸ä¼šåˆå§‹åŒ–æ•°ç»„ï¼Œå½“æ’å…¥ç¬¬ä¸€æ¡æ•°æ®æ—¶ä¼šåˆ›å»ºä¸€ä¸ªå¤§å°ä¸º10çš„æ•°ç»„ã€‚</p><ol><li>æ—¢ç„¶ArrayListçš„åº•å±‚å®ç°æ˜¯æ•°ç»„ï¼Œé‚£å®šä¹‰ArrayListæ—¶ï¼Œéœ€è¦å®šä¹‰å®ƒçš„å¤§å°å—ï¼Ÿ</li></ol><p>å¯ä»¥ä¸ç”¨å®šä¹‰å®¹å™¨çš„å¤§å°ï¼Œé»˜è®¤å¤§å°ä¸º10ï¼Œå½“å®¹é‡å¤§å°ä¸è¶³æ—¶æ­¤æ—¶å°†ä¼šè¿›è¡Œæ‰©å®¹ã€‚</p><ol><li>ArrayListçš„æ‰©å®¹æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿ</li></ol><p>æ¯æ¬¡æ–°å¢çš„å®¹é‡æ˜¯æ—§å®¹é‡çš„ä¸€åŠï¼Œæ‰©å®¹åè°ƒç”¨System.arraycopyæ–¹æ³•æ‹·è´åˆ°æ–°çš„æ•°ç»„ã€‚</p><ol><li>å¦‚æœåˆå§‹åŒ–ArrayListæ—¶ï¼Œå®šä¹‰ä¸€ä¸ªå®¹é‡å¤§å°ä¸º11ï¼Œæ­¤æ—¶æ‰©å®¹äº†å‡ æ¬¡ï¼Œå®¹é‡å¤§å°ä¸º16å‘¢ï¼Ÿ</li></ol><p>ä¸è¿›è¡Œæ‰©å®¹ã€‚</p><ol><li>LinkedListçš„å†…éƒ¨å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</li></ol><p>åº•å±‚é€šè¿‡é“¾è¡¨å®ç°ï¼Œæ‰€ä»¥ä¸å­˜åœ¨æ‰©å®¹ã€‚</p><ol><li>Vectorå’ŒArrayListã€LinkedListçš„åŒºåˆ«ï¼Ÿ</li></ol><p>Vectoræ˜¯çº¿ç¨‹å®‰å…¨çš„é¢ï¼ŒArrayListã€LinkedListä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚Vectorçš„çº¿ç¨‹å®‰å…¨æ˜¯ä¸ºæ¯ä¸ªæ–¹æ³•åŠ ä¸Šsynchronizedå…³é”®å­—ï¼Œæ•ˆç‡ä¸é«˜ï¼Œä¸å¸¸ç”¨ã€‚</p><ol><li>ArrayListä¸LinkedListåˆ†åˆ«å¯ä»¥åº”ç”¨åˆ°å“ªäº›åœºæ™¯ï¼Ÿ</li></ol><p>å¤§å¤šæ•°æƒ…å†µä¸‹ä½¿ç”¨ArrayListï¼Œå› ä¸ºArrayListæ˜¯æ•°ç»„å®ç°ï¼Œå®ƒéšæœºè¯»å–çš„é€Ÿåº¦æ›´å¿«ï¼Œä½†æ’å…¥æŒ‡å®šä½ç½®æ…¢ï¼›LinkedListç”±äºæ˜¯é“¾è¡¨å®ç°ï¼Œæ‰€ä»¥éšæœºè¯»å–çš„é€Ÿåº¦æ…¢ï¼Œä½†æ’å…¥æŒ‡å®šä½ç½®å¿«ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>é¢è¯•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>centos7å®‰è£…ElasticSearch6</title>
    <link href="/blog/2021/01/18/centos7%E5%AE%89%E8%A3%85ElasticSearch6/"/>
    <url>/blog/2021/01/18/centos7%E5%AE%89%E8%A3%85ElasticSearch6/</url>
    
    <content type="html"><![CDATA[<h1 id="ä»€ä¹ˆæ˜¯-ElasticSearch"><a href="#ä»€ä¹ˆæ˜¯-ElasticSearch" class="headerlink" title="ä»€ä¹ˆæ˜¯ ElasticSearch"></a>ä»€ä¹ˆæ˜¯ ElasticSearch</h1><p>ElasticSearchæ˜¯ä¸€ä¸ªåŸºäº Lucene çš„æœç´¢æœåŠ¡å™¨ã€‚å®ƒæä¾›äº†ä¸€ä¸ªåˆ†å¸ƒå¼å¤šç”¨æˆ·èƒ½åŠ›çš„å…¨æ–‡æœç´¢å¼•æ“ï¼ŒåŸºäº RESTful web æ¥å£ã€‚Elasticsearch æ˜¯ç”¨ Java å¼€å‘çš„ï¼Œå¹¶ä½œä¸º Apache è®¸å¯æ¡æ¬¾ä¸‹çš„å¼€æ”¾æºç å‘å¸ƒï¼Œæ˜¯å½“å‰æµè¡Œçš„ä¼ä¸šçº§æœç´¢å¼•æ“ã€‚è®¾è®¡ç”¨äºäº‘è®¡ç®—ä¸­ï¼Œèƒ½å¤Ÿè¾¾åˆ°å®æ—¶æœç´¢ï¼Œç¨³å®šï¼Œå¯é ï¼Œå¿«é€Ÿï¼Œå®‰è£…ä½¿ç”¨æ–¹ä¾¿ã€‚</p><h1 id="åŸºç¡€æ¦‚å¿µ"><a href="#åŸºç¡€æ¦‚å¿µ" class="headerlink" title="åŸºç¡€æ¦‚å¿µ"></a>åŸºç¡€æ¦‚å¿µ</h1><p>ç´¢å¼•ï¼šå«æœ‰ç›¸åŒå±æ€§çš„æ–‡æ¡£é›†åˆ</p><p>ç±»å‹ï¼šç´¢å¼•å¯ä»¥å®šä¹‰ä¸€ä¸ªæˆ–å¤šä¸ªç±»å‹ï¼Œæ–‡æ¡£å¿…é¡»å±äºä¸€ä¸ªç±»å‹</p><p>æ–‡æ¡£ï¼šå¯ä»¥è¢«ç´¢å¼•çš„åŸºç¡€æ•°æ®å•ä½</p><p>åˆ†ç‰‡ï¼šæ¯ä¸ªç´¢å¼•éƒ½æœ‰å¤šä¸ªåˆ†ç‰‡ï¼Œæ¯ä¸ªåˆ†ç‰‡éƒ½æ˜¯ Lucene ç´¢å¼•</p><p>å¤‡ä»½ï¼šæ‹·è´ä¸€ä»½åˆ†ç‰‡å°±å®Œæˆåˆ†ç‰‡çš„å¤‡ä»½</p><h2 id="å½¢è±¡æ¯”å–»ï¼š"><a href="#å½¢è±¡æ¯”å–»ï¼š" class="headerlink" title="å½¢è±¡æ¯”å–»ï¼š"></a>å½¢è±¡æ¯”å–»ï¼š</h2><p>ç™¾è´§å¤§æ¥¼é‡Œæœ‰å„å¼å„æ ·çš„å•†å“ï¼Œä¾‹å¦‚ä¹¦ç±ã€ç¬”ã€æ°´æœç­‰ã€‚ä¹¦ç±å¯ä»¥æ ¹æ®å†…å®¹åˆ’åˆ†æˆä¸åŒç§ç±»ï¼Œå¦‚ç§‘æŠ€ç±»ã€æ•™è‚²ç±»ã€æ‚¬ç–‘æ¨ç†ç­‰ã€‚æ‚¬ç–‘æ¨ç†ç±»çš„å°è¯´ä¸­æ¯”è¾ƒæœ‰åæ°”çš„æœ‰ã€Šç¦å°”æ‘©æ–¯æ¢æ¡ˆé›†ã€‹ã€ã€Šç™½å¤œè¡Œã€‹ç­‰ã€‚</p><p>ç™¾è´§å¤§æ¥¼ â€“&gt; ElasticSearch æ•°æ®åº“</p><p>ä¹¦ç± â€“&gt; ç´¢å¼•</p><p>æ‚¬ç–‘æ¨ç† â€“&gt; ç±»å‹</p><p>ç™½å¤œè¡Œ â€“&gt; æ–‡æ¡£</p><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><p>éœ€è¦JDK1.8 å’Œ NodeJS æœ€æ–°ç‰ˆçš„7 æ…é‡è€ƒè™‘éœ€è¦éœ€è¦JDK 11 ç™»é™†<a href="https://www.elastic.co/cn/downloads/past-releases">è€ç‰ˆæœ¬ä¸‹è½½</a> å®˜ç½‘ä¸‹è½½æ–‡ä»¶ã€‚<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/WX20190816-094122@2x_1565919762389.png" alt="WX20190816-094122@2x">è§£å‹åˆ° /use ç›®å½•ä¸‹<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/WX20190816-094419@2x_1565919900521.png" alt="WX20190816-094419@2x"></p><p>å› ä¸º Elasticsearch å¯ä»¥æ‰§è¡Œè„šæœ¬æ–‡ä»¶ï¼Œä¸ºäº†å®‰å…¨æ€§ï¼Œé»˜è®¤ä¸å…è®¸é€šè¿‡ root ç”¨æˆ·å¯åŠ¨æœåŠ¡ã€‚æˆ‘ä»¬éœ€è¦æ–°åˆ›å»ºç”¨æˆ·åå’Œç”¨æˆ·ç»„å¯åŠ¨æœåŠ¡</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs vim">#å¢åŠ  es ç»„<br>groupadd es<br><br>#å¢åŠ  es ç”¨æˆ·å¹¶é™„åŠ åˆ° es ç»„<br>useradd es -g es -<span class="hljs-keyword">p</span> es<br><br>#ç»™ç›®å½•æƒé™ è¿›å…¥åˆ°ä½ è§£å‹çš„ä½ç½® è¾“å…¥<span class="hljs-keyword">pwd</span> å°†è·¯å¾„æ‹·è´åˆ° es åé¢<br>chown -R <span class="hljs-keyword">e</span><span class="hljs-variable">s:es</span> /usr/elasticsearch-<span class="hljs-number">5.6</span>.<span class="hljs-number">1</span><br><br>#ä½¿ç”¨esç”¨æˆ·<br>su es<br></code></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒElasticsearch åªå…è®¸æœ¬æœºè®¿é—®ï¼Œå¦‚æœéœ€è¦è¿œç¨‹è®¿é—®ï¼Œéœ€è¦ä¿®æ”¹å…¶é…ç½®æ–‡ä»¶ ç‰¹åˆ«æ³¨æ„ è¦å’Œä¸Šä¸‹æ–‡å¯¹é½ ä¸è¦å¤šç©ºæ ¼ å’Œå°‘ç©ºæ ¼</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">vim</span> config/elasticsearch.yml<br><br># å»æ‰ network.host å‰è¾¹çš„æ³¨é‡Šï¼Œå°†å®ƒçš„å€¼æ”¹æˆ<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span><br>network.hos<span class="hljs-variable">t:</span> <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span><br><br><br><br># åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ  <span class="hljs-number">2</span> æ®µé…ç½® è¿™é‡Œæ˜¯ä¸ºäº†è§£å†³è·¨åŸŸé—®é¢˜ webç®¡ç†ç•Œé¢<br><br>http.cors.enabled: true<br>http.cors.allow-origin: <span class="hljs-string">&quot;*&quot;</span><br></code></pre></td></tr></table></figure><p>å¯åŠ¨æœåŠ¡</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">bin/elasticsearch æˆ– bin/elasticsearch -d # -d è¡¨ç¤ºåå°å¯åŠ¨<br></code></pre></td></tr></table></figure><h1 id="æŠ¥é”™è§£å†³"><a href="#æŠ¥é”™è§£å†³" class="headerlink" title="æŠ¥é”™è§£å†³"></a>æŠ¥é”™è§£å†³</h1><p>å…ˆä¸åå°å¯åŠ¨ é”™è¯¯ä¼šç›´æ¥æ‰“å° è°ƒè¯•æ²¡æœ‰é—®é¢˜ä¹‹å åå°å¯åŠ¨ å¯èƒ½ä¼šå‡ºç°çš„é—®é¢˜ 6ä¹Ÿä¼šé‡åˆ°</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs vim">elasticsearch5.<span class="hljs-number">0</span>å¯åŠ¨å¤±è´¥ï¼Œå‡ºç°å¦‚ä¸‹æç¤ºï¼š<br><br>1ã€Java HotSpot(TM) 64-Bit Server VM warning: INFO: os::commit_memory(0x0000000085330000, 2060255232, 0) failed; error=&#x27;Cannot allocate memory&#x27; (errno=12)<br><br>ç”±äºelasticsearch5.<span class="hljs-number">0</span>é»˜è®¤åˆ†é…jvmç©ºé—´å¤§å°ä¸º<span class="hljs-number">2</span>gï¼Œä¿®æ”¹jvmç©ºé—´åˆ†é…<br><br># <span class="hljs-keyword">vim</span> config/jvm.<span class="hljs-keyword">options</span><br>-Xms2g<br>-Xmx2g<br>ä¿®æ”¹ä¸º  è¿˜æ˜¯åŒæ ·çš„é”™è¯¯çš„è¯ ç»§ç»­å¾€ä¸‹è°ƒ <br>-Xms512m<br>-Xmx512m<br><br><br><span class="hljs-number">2</span>ã€<span class="hljs-built_in">max</span> <span class="hljs-keyword">number</span> of threads [<span class="hljs-number">1024</span>] <span class="hljs-keyword">for</span> user [elasticsearch] <span class="hljs-keyword">is</span> too low, increase <span class="hljs-keyword">to</span> at least [<span class="hljs-number">2048</span>]<br>ä¿®æ”¹ /etc/security/limits.d/<span class="hljs-number">90</span>-nproc.<span class="hljs-keyword">conf</span> <br><br>*          soft    nproc     <span class="hljs-number">1024</span><br><br>*          soft    nproc     <span class="hljs-number">2048</span><br><br><br><br><span class="hljs-number">3</span>ã€<span class="hljs-built_in">max</span> virtual memory areas <span class="hljs-keyword">vm</span>.max_map_count [<span class="hljs-number">65530</span>] <span class="hljs-keyword">is</span> too low, increase <span class="hljs-keyword">to</span> at least [<span class="hljs-number">262144</span>]<br><br>ä¿®æ”¹/etc/sysctl.<span class="hljs-keyword">conf</span>é…ç½®æ–‡ä»¶ï¼Œ<br><br><span class="hljs-keyword">cat</span> /etc/sysctl.<span class="hljs-keyword">conf</span> | <span class="hljs-keyword">grep</span> <span class="hljs-keyword">vm</span>.max_map_count<br><span class="hljs-keyword">vm</span>.max_map_count=<span class="hljs-number">262144</span><br><br>å¦‚æœä¸å­˜åœ¨åˆ™æ·»åŠ <br><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;vm.max_map_count=262144&quot;</span> &gt;&gt;/etc/sysctl.<span class="hljs-keyword">conf</span><br><br><br><br><span class="hljs-number">4</span>ã€<span class="hljs-built_in">max</span> <span class="hljs-keyword">file</span> descriptors [<span class="hljs-number">65535</span>] <span class="hljs-keyword">for</span> elasticsearch process likely too low, increase <span class="hljs-keyword">to</span> at least [<span class="hljs-number">65536</span>]<br><br><br><br>ulimit -n <span class="hljs-number">65536</span><br><br><br><br><br><br>ä»¥ä¸‹æ˜¯åœ¨<span class="hljs-number">5.5</span>.<span class="hljs-number">1</span>æ˜¯è¸©è¿‡çš„å‘<br><br><br><br><span class="hljs-number">5</span>ã€å¯åŠ¨å¼‚å¸¸ï¼šERROR: bootstrap checks failed<br><br>system call filters failed to install; check the logs and fix your configuration or disable system call filters at your own risk<br><br><br><br>é—®é¢˜åŸå› ï¼šå› ä¸ºCentos6ä¸æ”¯æŒSecCompï¼Œè€ŒESé»˜è®¤bootstrap.system_call_filterä¸ºtrueè¿›è¡Œæ£€æµ‹ï¼Œæ‰€ä»¥å¯¼è‡´æ£€æµ‹å¤±è´¥ï¼Œå¤±è´¥åç›´æ¥å¯¼è‡´ESä¸èƒ½å¯åŠ¨ã€‚è¯¦è§ ï¼šhttp<span class="hljs-variable">s:</span>//github.<span class="hljs-keyword">com</span>/elastic/elasticsearch/issues/<span class="hljs-number">22899</span><br><br><br><br>è§£å†³æ–¹æ³•ï¼šåœ¨elasticsearch.ymlä¸­é…ç½®bootstrap.system_call_filterä¸ºfalseï¼Œæ³¨æ„è¦åœ¨Memoryä¸‹é¢:<br>bootstrap.memory_lock: false<br>bootstrap.system_call_filter: false<br><br><br><br><span class="hljs-number">6</span>ã€logstashä½¿ç”¨rpmåŒ…å®‰è£…çš„æ—¶å€™æ²¡æœ‰é…ç½®initçš„å¯åŠ¨è„šæœ¬<br><br>é»˜è®¤æƒ…å†µä½¿ç”¨rpmåŒ…å®‰è£…å®Œlogstashä¹‹åæ²¡æœ‰å¯åŠ¨è„šæœ¬ã€‚å®˜ç½‘ç»™äº†ä¸€ä¸ªè„šæœ¬ï¼Œéœ€è¦æ ¹æ®ä¸åŒçš„ç³»ç»Ÿç‰ˆæœ¬ç”Ÿæˆå¯¹åº”çš„å¯åŠ¨è„šæœ¬ï¼Œè€Œä¸”å®˜ç½‘æ²¡æœ‰ç»™æ˜ä½¿ç”¨æ–¹æ³•ï¼Œå¯¹äºæ–°ç”¨æˆ·æ¥è¯´ç®—æ˜¯ä¸ªå‘ï¼Œä¸è¿‡åœ¨ç»ˆç«¯å¯ä»¥æŸ¥çœ‹åˆ°è„šæœ¬çš„ä½¿ç”¨å¸®åŠ©# /usr/share/logstash/bin/<span class="hljs-built_in">system</span>-install --<span class="hljs-keyword">help</span><br><br>ç”Ÿæˆå¯åŠ¨è„šæœ¬ï¼Œcentos6ä½¿ç”¨sysvå‚æ•°ï¼Œcentos7ä½¿ç”¨systemd<br><br># /usr/share/logstash/bin/<span class="hljs-built_in">system</span>-install /etc/logstash/startup.<span class="hljs-keyword">options</span> sysv<br><br>Successfully created <span class="hljs-built_in">system</span> startup script <span class="hljs-keyword">for</span> Logstash<br></code></pre></td></tr></table></figure><p>å¯åŠ¨æˆåŠŸ ä½ çš„ip 9200 é»˜è®¤ç«¯å£<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/WX20190816-100353@2x_1565921056554.png" alt="WX20190816-100353@2x"></p><h1 id="headæ’ä»¶"><a href="#headæ’ä»¶" class="headerlink" title="headæ’ä»¶"></a>headæ’ä»¶</h1><p>æŸ¥çœ‹å†…å®¹æ˜¾ç¤ºæ•ˆæœä¸å‹å¥½ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…ä¸€ä¸ªåä¸º elasticsearch-head çš„æ’ä»¶ï¼Œè®©å†…å®¹æ˜¾ç¤ºæ•ˆæœæ¯”è¾ƒèˆ’é€‚ã€‚éœ€è¦å®‰è£…nodejs githupä¸‹è½½ ç«¯å£9100</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">cd</span> elasticsearch-head-master<br><br>npm install<br><br>npm run start<br></code></pre></td></tr></table></figure><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/WX20190816-100733@2x_1565921326422.png" alt="WX20190816-100733@2x"></p><p>åé¢æ˜¯æˆ‘æ•´åˆå•¦spring boot</p>]]></content>
    
    
    
    <tags>
      
      <tag>centos7</tag>
      
      <tag>es</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MongoDB ä¸ MySQL çš„åŒºåˆ«</title>
    <link href="/blog/2021/01/18/MongoDB%E4%B8%8E%20MySQL%E7%9A%84%E5%8C%BA%E5%88%AB/"/>
    <url>/blog/2021/01/18/MongoDB%E4%B8%8E%20MySQL%E7%9A%84%E5%8C%BA%E5%88%AB/</url>
    
    <content type="html"><![CDATA[<p>æ¦‚å¿µåŒºåˆ«<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/WX20190815-134731@2x_1565848087636.png" alt="WX20190815-134731@2x">å…³é”®å­—å’Œå‡½æ•°åŒºåˆ«<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/WX20190815-134744@2x_1565848087719.png" alt="WX20190815-134744@2x">è¯­å¥åŒºåˆ« åˆ›å»ºè¡¨/é›†åˆ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql">db.people.insertOne( &#123;<br>    user_id: &quot;abc123&quot;,<br>    age: <span class="hljs-number">55</span>,<br>    status: &quot;A&quot;<br> &#125; )<br> <br>ç›¸å½“äº <br> <br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> people (<br>    id MEDIUMINT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>    user_id <span class="hljs-type">Varchar</span>(<span class="hljs-number">30</span>),<br>    age Number,<br>    status <span class="hljs-type">char</span>(<span class="hljs-number">1</span>),<br>    <span class="hljs-keyword">PRIMARY</span> <span class="hljs-keyword">KEY</span> (id)<br>)<br></code></pre></td></tr></table></figure><p>æ–°å¢å­—æ®µ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">db.people.updateMany(<br>    &#123; &#125;,<br>    &#123; $set: &#123; join_date: new Date() &#125; &#125;<br>)<br> <br>ç›¸å½“äº <span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> people <span class="hljs-keyword">ADD</span> join_date DATETIME<br></code></pre></td></tr></table></figure><p>åˆ é™¤å­—æ®µ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">db.people.updateMany(<br>    &#123; &#125;,<br>    &#123; $unset: &#123; &quot;join_date&quot;: &quot;&quot; &#125; &#125;<br>)<br> <br>ç›¸å½“äº <span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> people <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">COLUMN</span> join_date<br></code></pre></td></tr></table></figure><p>åˆ›å»ºç´¢å¼•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">db.people.createIndex( &#123; user_id: 1 &#125; )<br> <br>ç›¸å½“äº <span class="hljs-keyword">CREATE</span> INDEX idx_user_id_asc <span class="hljs-keyword">ON</span> people(user_id)<br></code></pre></td></tr></table></figure><p>åˆ é™¤è¡¨/é›†åˆ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">db.people.drop()<br> <br>ç›¸å½“äº <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> people<br></code></pre></td></tr></table></figure><p>æ–°å¢è®°å½•/æ–‡æ¡£</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">db.people.insertOne(<br>   &#123; user_id: &quot;bcd001&quot;, age: 45, status: &quot;A&quot; &#125;<br>)<br> <br>ç›¸å½“äº <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> people(user_id,age,status) <span class="hljs-keyword">VALUES</span> (&quot;bcd001&quot;,<span class="hljs-number">45</span>,&quot;A&quot;)<br></code></pre></td></tr></table></figure><p>ç®€å•æŸ¥è¯¢</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sql">db.people.find()<br> <br>ç›¸å½“äº <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> people<br> <br>db.people.find(<br>    &#123; &#125;,<br>    &#123; user_id: 1, status: 1 &#125;<br>)<br> <br>ç›¸å½“äº <span class="hljs-keyword">SELECT</span> id,user_id,status <span class="hljs-keyword">FROM</span> people<br> <br>db.people.find(<br>    &#123; &#125;,<br>    &#123; user_id: 1, status: 1, _id: 0 &#125;<br>)<br> <br>ç›¸å½“äº <span class="hljs-keyword">SELECT</span> user_id, status <span class="hljs-keyword">FROM</span> people<br></code></pre></td></tr></table></figure><p>æ¡ä»¶æŸ¥è¯¢</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql">db.people.find(<br>    &#123; status: &quot;A&quot; &#125;<br>)<br> <br>ç›¸å½“äº <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> people <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> &quot;A&quot;<br> <br>db.people.find(<br>    &#123; status: &quot;A&quot; &#125;,<br>    &#123; user_id: 1, status: 1, _id: 0 &#125;<br>)<br> <br>ç›¸å½“äº <span class="hljs-keyword">SELECT</span> user_id, status <span class="hljs-keyword">FROM</span> people <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> &quot;A&quot;<br></code></pre></td></tr></table></figure><p>éæŸ¥è¯¢</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">db.people.find(<br>    &#123; status: &#123; $ne: &quot;A&quot; &#125; &#125;<br>)<br> <br>ç›¸å½“äº <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> people <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">!=</span> &quot;A&quot;<br></code></pre></td></tr></table></figure><p>ä¸”æŸ¥è¯¢</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">db.people.find(<br>    &#123; status: &quot;A&quot;,<br>      age: 50 &#125;<br>)<br> <br>ç›¸å½“äº <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> people <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> &quot;A&quot; <span class="hljs-keyword">AND</span> age <span class="hljs-operator">=</span> <span class="hljs-number">50</span><br></code></pre></td></tr></table></figure><p>æˆ–æŸ¥è¯¢</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">db.people.find(<br>    &#123; $or: [ &#123; status: &quot;A&quot; &#125; ,<br>             &#123; age: 50 &#125; ] &#125;<br>)<br> <br>ç›¸å½“äº <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> people <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> &quot;A&quot; <span class="hljs-keyword">OR</span> age <span class="hljs-operator">=</span> <span class="hljs-number">50</span><br></code></pre></td></tr></table></figure><p>å¤§äºæŸ¥è¯¢</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">db.people.find(<br>    &#123; age: &#123; $gt: 25 &#125; &#125;<br>)<br> <br>ç›¸å½“äº <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> people <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">25</span><br></code></pre></td></tr></table></figure><p>å°äºæŸ¥è¯¢</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">db.people.find(<br>   &#123; age: &#123; $lt: 25 &#125; &#125;<br>)<br> <br>ç›¸å½“äº <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> people <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&lt;</span> <span class="hljs-number">25</span><br></code></pre></td></tr></table></figure><p>èŒƒå›´æŸ¥è¯¢</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">db.people.find(<br>   &#123; age: &#123; $gt: 25, $lte: 50 &#125; &#125;<br>)<br> <br>ç›¸å½“äº <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> people <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">25</span> <span class="hljs-keyword">AND</span>   age <span class="hljs-operator">&lt;=</span> <span class="hljs-number">50</span><br></code></pre></td></tr></table></figure><p>æ¨¡ç³ŠæŸ¥è¯¢</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">db.people.find( &#123; user_id: /bc/ &#125; ) æˆ– db.people.find( &#123; user_id: &#123; $regex: /bc/ &#125; &#125; )<br> <br>ç›¸å½“äº <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> people <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-keyword">like</span> &quot;%bc%&quot;<br> <br>db.people.find( &#123; user_id: /^bc/ &#125; ) æˆ– db.people.find( &#123; user_id: &#123; $regex: /^bc/ &#125; &#125; )<br> <br>ç›¸å½“äº <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> people <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-keyword">like</span> &quot;bc%&quot;<br></code></pre></td></tr></table></figure><p>æ’åºæŸ¥è¯¢</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">db.people.find( &#123; status: &quot;A&quot; &#125; ).sort( &#123; user_id: 1 &#125; )<br> <br>ç›¸å½“äº <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> people <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> &quot;A&quot; <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> user_id <span class="hljs-keyword">ASC</span><br> <br>db.people.find( &#123; status: &quot;A&quot; &#125; ).sort( &#123; user_id: -1 &#125; )<br> <br>ç›¸å½“äº <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> people <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> &quot;A&quot; <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> user_id <span class="hljs-keyword">DESC</span><br></code></pre></td></tr></table></figure><p>ç»Ÿè®¡æŸ¥è¯¢</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">db.people.<span class="hljs-built_in">count</span>() æˆ– db.people.find().<span class="hljs-built_in">count</span>()<br> <br>ç›¸å½“äº <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> people<br> <br>db.people.count( &#123; user_id: &#123; $exists: true &#125; &#125; ) æˆ– db.people.find( &#123; user_id: &#123; $exists: true &#125; &#125; ).count()<br> <br>ç›¸å½“äº <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(user_id) <span class="hljs-keyword">FROM</span> people<br> <br>db.people.count( &#123; age: &#123; $gt: 30 &#125; &#125; ) æˆ– db.people.find( &#123; age: &#123; $gt: 30 &#125; &#125; ).count()<br> <br>ç›¸å½“äº <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> people <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">30</span><br></code></pre></td></tr></table></figure><p>å»é‡æŸ¥è¯¢</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">db.people.distinct( &quot;status&quot; )<br> <br>ç›¸å½“äº <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span>(status) <span class="hljs-keyword">FROM</span> people<br></code></pre></td></tr></table></figure><p>åˆ†é¡µæŸ¥è¯¢</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">db.people.findOne() æˆ– db.people.find().limit(<span class="hljs-number">1</span>)<br> <br>ç›¸å½“äº <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> people LIMIT <span class="hljs-number">1</span><br> <br>db.people.find().limit(<span class="hljs-number">5</span>).<span class="hljs-keyword">skip</span>(<span class="hljs-number">10</span>)<br> <br>ç›¸å½“äº <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> people LIMIT <span class="hljs-number">5</span> <span class="hljs-keyword">SKIP</span> <span class="hljs-number">10</span><br></code></pre></td></tr></table></figure><p>æŸ¥è¯¢è®¡åˆ’</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">db.people.find( &#123; status: &quot;A&quot; &#125; ).explain()<br> <br>ç›¸å½“äº EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> people <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> &quot;A&quot;<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹è®°å½•/æ–‡æ¡£</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql">db.people.updateMany(<br>   &#123; age: &#123; $gt: 25 &#125; &#125;,<br>   &#123; $set: &#123; status: &quot;C&quot; &#125; &#125;<br>);<br> <br>ç›¸å½“äº <span class="hljs-keyword">UPDATE</span> people <span class="hljs-keyword">SET</span> status <span class="hljs-operator">=</span> &quot;C&quot; <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">25</span>;<br> <br>db.people.updateMany(<br>   &#123; status: &quot;A&quot; &#125; ,<br>   &#123; $inc: &#123; age: 3 &#125; &#125;<br>);<br> <br>ç›¸å½“äº <span class="hljs-keyword">UPDATE</span> people <span class="hljs-keyword">SET</span> age <span class="hljs-operator">=</span> age <span class="hljs-operator">+</span> <span class="hljs-number">3</span> <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> &quot;A&quot;;<br></code></pre></td></tr></table></figure><p>åˆ é™¤è®°å½•/æ–‡æ¡£</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">db.people.deleteMany( &#123; status: &quot;D&quot; &#125; );<br> <br>ç›¸å½“äº <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> people <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> &quot;D&quot;;<br> <br>db.people.deleteMany(&#123;&#125;);<br> <br>ç›¸å½“äº <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> people;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>MongoDB</tag>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>gradleä½¿ç”¨æœ¬åœ°jaråŒ…</title>
    <link href="/blog/2021/01/16/gradle%E4%BD%BF%E7%94%A8%E6%9C%AC%E5%9C%B0jar%E5%8C%85/"/>
    <url>/blog/2021/01/16/gradle%E4%BD%BF%E7%94%A8%E6%9C%AC%E5%9C%B0jar%E5%8C%85/</url>
    
    <content type="html"><![CDATA[<p>æœ‰å¾ˆå¤šæ—¶å€™ æˆ‘ä»¬éœ€è¦ç”¨åˆ°è‡ªå·±çš„jaråŒ… ç‰¹æ®ŠåŸå›  ä½ æ˜ç™½çš„</p><p>1.åœ¨é¡¹ç›®æ ¹ç›®å½•(ä¸srcåŒçº§ç›®å½•)åˆ›å»ºlibæ–‡ä»¶å¤¹ï¼Œå¹¶å°†jaråŒ…æ‹·è´è¿›å»ã€‚</p><p>2.åœ¨build.gradleæ–‡ä»¶ä¸­çš„dependenciesä¸­æ·»åŠ å¦‚ä¸‹è„šæœ¬ï¼š compile fileTree(dir: â€˜libâ€™, include: [ â€˜*.jarâ€™])</p><p>3.è¿è¡Œgradle buildå³å¯å°†jaræ–‡ä»¶æ‰“åˆ°å·¥ç¨‹JaråŒ…ä¸­ã€‚<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/WX20190815-103617@2x_1565836606994.png" alt="WX20190815-103617@2x"></p>]]></content>
    
    
    
    <tags>
      
      <tag>å·¥å…·</tag>
      
      <tag>gradle</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pdf è½¬ å›¾ç‰‡</title>
    <link href="/blog/2021/01/16/pdf%E8%BD%AC%E5%9B%BE%E7%89%87/"/>
    <url>/blog/2021/01/16/pdf%E8%BD%AC%E5%9B%BE%E7%89%87/</url>
    
    <content type="html"><![CDATA[<p>è¿™é‡Œä½¿ç”¨åˆ°çš„jaråŒ… æ˜¯ // <a href="https://mvnrepository.com/artifact/org.apache.pdfbox/fontbox">https://mvnrepository.com/artifact/org.apache.pdfbox/fontbox</a> compile group: â€˜org.apache.pdfboxâ€™, name: â€˜fontboxâ€™, version: â€˜1.8.16â€™ // <a href="https://mvnrepository.com/artifact/org.apache.pdfbox/pdfbox">https://mvnrepository.com/artifact/org.apache.pdfbox/pdfbox</a> compile group: â€˜org.apache.pdfboxâ€™, name: â€˜pdfboxâ€™, version: â€˜1.8.16â€™</p><p>pdfè½¬å•é¡µå›¾ç‰‡ åˆå¹¶ä¸€å¼ çš„å·¥å…·åº“ å‰å¾€<a href="https://bk.cuixiaoyan.xyz/archives/zhuantupian">aspose-words wordè½¬å›¾ç‰‡</a> ä¸‹è½½ä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å°†pdfè½¬æˆä¸€å¼ å›¾ç‰‡</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> pdffile</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@throws</span> IOException</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">getPDFBinary</span><span class="hljs-params">(String pdffile)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br><span class="hljs-comment">//æ–‡ä»¶æµ</span><br>InputStream inputStream = <span class="hljs-keyword">new</span> FileInputStream(pdffile);<br><span class="hljs-comment">//æ–‡ä»¶ è·å–æ–‡ä»¶åå­—</span><br>File file = <span class="hljs-keyword">new</span> File(pdffile);<br>String name = file.getName();<br><span class="hljs-comment">//æˆªå–ä¸å¸¦åç¼€åçš„å­—æ®µ</span><br>String fileName = name.substring(<span class="hljs-number">0</span>, name.lastIndexOf(<span class="hljs-string">&quot;.&quot;</span>));<br> <br><span class="hljs-comment">//æ–‡ä»¶ä¸Šä¼ è·¯å¾„</span><br>String parent = file.getParent();<br> <br>PDDocument doc = PDDocument.load(inputStream);<br><span class="hljs-comment">//è·å–pdfæ–‡ä»¶ é¡µæ•°</span><br>List&lt;PDPage&gt; pages = doc.getDocumentCatalog().getAllPages();<br> <br>List&lt;BufferedImage&gt; imageList = <span class="hljs-keyword">new</span> ArrayList&lt;BufferedImage&gt;();<br>BufferedImage image = <span class="hljs-keyword">null</span>;<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; pages.size(); i++) &#123;<br>PDPage page = (PDPage)pages.get(i); <span class="hljs-comment">// è·å–ç¬¬ié¡µ</span><br>image = page.convertToImage();<br>imageList.add(image);<br><span class="hljs-comment">//åˆå¹¶ä¸€å¼ </span><br>image = MergeImage.mergeImage(<span class="hljs-keyword">false</span>, imageList);<br>&#125;<br> <br><span class="hljs-keyword">boolean</span> png = ImageIO.write(image, <span class="hljs-string">&quot;png&quot;</span>, <span class="hljs-keyword">new</span> File(parent +<span class="hljs-string">&quot;/&quot;</span>+ fileName + <span class="hljs-string">&quot;.png&quot;</span>));<br><span class="hljs-keyword">if</span>(png == <span class="hljs-keyword">false</span>)&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;è½¬æ¢å¤±è´¥&quot;</span>;<br>&#125;<br> <br><span class="hljs-comment">//å…³é—­æµ</span><br>inputStream.close();<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;è½¬æ¢æˆåŠŸ&quot;</span>;<br> <br> <br>&#125;<br></code></pre></td></tr></table></figure><p>pdf æ¯é¡µè½¬å›¾ç‰‡ æ”¾åˆ°æ–‡ä»¶å¤¹å†… è½¬æ¢æˆå‹ç¼©åŒ… ä¹Ÿå¯ä»¥ä¸æ”¾å‹ç¼©åŒ… éšæ„ å‹ç¼©åŒ…å·¥å…·ç±» <a href="https://bk.cuixiaoyan.xyz/archives/yasuo">javaå®ç°æ–‡ä»¶å‹ç¼©ï¼Œæ–‡ä»¶å¤¹å‹ç¼©ï¼Œä»¥åŠæ–‡ä»¶å’Œæ–‡ä»¶å¤¹çš„æ··åˆå‹ç¼©</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å°†pdf è½¬åŒ–ä¸º å›¾ç‰‡åˆ†é¡µ å‹ç¼©åŒ…</span><br> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">getPDFBinarys</span><span class="hljs-params">(String pdffile)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br><span class="hljs-comment">//æ–‡ä»¶æµ</span><br>InputStream inputStream = <span class="hljs-keyword">new</span> FileInputStream(pdffile);<br>PDDocument doc = PDDocument.load(inputStream);<br> <br><span class="hljs-comment">//æ–‡ä»¶ è·å–æ–‡ä»¶åå­—</span><br>File file = <span class="hljs-keyword">new</span> File(pdffile);<br>String name = file.getName();<br><span class="hljs-comment">//æˆªå–ä¸å¸¦åç¼€åçš„å­—æ®µ</span><br>String fileName = name.substring(<span class="hljs-number">0</span>, name.lastIndexOf(<span class="hljs-string">&quot;.&quot;</span>));<br><span class="hljs-comment">//æ–‡ä»¶ä¸Šä¼ è·¯å¾„</span><br>String parent = file.getParent();<br> <br><span class="hljs-comment">//è·å–pdfæ–‡ä»¶ é¡µæ•°</span><br>List&lt;PDPage&gt; pages = doc.getDocumentCatalog().getAllPages();<br> <br>BufferedImage image = <span class="hljs-keyword">null</span>;<br> <br><span class="hljs-comment">//åˆ›å»ºåŒåæ–‡ä»¶å¤¹</span><br><span class="hljs-keyword">new</span> File(parent+<span class="hljs-string">&quot;/&quot;</span>+ fileName).mkdir();<br> <br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; pages.size(); i++) &#123;<br>PDPage page = (PDPage) pages.get(i); <span class="hljs-comment">// è·å–ç¬¬ié¡µ</span><br>image = page.convertToImage();<br>ImageIO.write(image, <span class="hljs-string">&quot;png&quot;</span>, <span class="hljs-keyword">new</span> File(parent +<span class="hljs-string">&quot;/&quot;</span>+ fileName +<span class="hljs-string">&quot;/&quot;</span>+ <span class="hljs-string">&quot;ç¬¬&quot;</span>+ i +<span class="hljs-string">&quot;é¡µ&quot;</span> + fileName + <span class="hljs-string">&quot;.png&quot;</span>));<br> <br>&#125;<br> <br><span class="hljs-comment">//å‹ç¼©åŒåæ–‡ä»¶å¤¹</span><br>    File f = <span class="hljs-keyword">new</span> File(parent  +<span class="hljs-string">&quot;/&quot;</span> + fileName );<br>            <span class="hljs-keyword">new</span> CompactAlgorithm(<span class="hljs-keyword">new</span> File( parent+ <span class="hljs-string">&quot;/&quot;</span>,f.getName()+<span class="hljs-string">&quot;.zip&quot;</span>)).zipFiles(f);<br> <br><span class="hljs-comment">//å…³é—­æµ</span><br>inputStream.close();<br> <br> <br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;è½¬æ¢æˆåŠŸ&quot;</span>+pages.size()+<span class="hljs-string">&quot;é¡µ&quot;</span>;<br> <br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>pdf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>aspose-words java word è½¬æ¢ æœåŠ¡å™¨ä¹±ç è§£å†³</title>
    <link href="/blog/2021/01/16/aspose-words-java-word%E8%BD%AC%E6%8D%A2%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B9%B1%E7%A0%81%E8%A7%A3%E5%86%B3/"/>
    <url>/blog/2021/01/16/aspose-words-java-word%E8%BD%AC%E6%8D%A2%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B9%B1%E7%A0%81%E8%A7%A3%E5%86%B3/</url>
    
    <content type="html"><![CDATA[<p>åœ¨æœ¬æœºæµ‹è¯•æ˜¯å¥½çš„ ä½†æ˜¯åˆ°æœåŠ¡å™¨å°±ä¹±ç  æƒ³åˆ°pdfæ˜¯ä¸€ç§ä¸ºæ‰“å°è®¾è®¡çš„æ–‡æ¡£æ ¼å¼ï¼Œå¯èƒ½è·Ÿå­—ä½“ç›¸å…³ã€‚è€Œä¸”è½¬å‡ºæ¥çš„pdfä¸­æ–‡éƒ½æ˜¯ç©ºå¿ƒæ–¹æ¡†ï¼Œä¸æ˜¯å•çº¯çš„ä¹±ç ï¼Œå¾ˆæœ‰å¯èƒ½æ˜¯ç¼ºå°‘å­—ä½“æ¸²æŸ“ä¸å‡ºæ¥é€ æˆçš„ã€‚ æœåŠ¡å™¨ä¸Šç”¨fc-listå‘½ä»¤æŸ¥çœ‹å­—ä½“ï¼Œæœç„¶æ²¡æœ‰ä¸­æ–‡å­—ä½“ æ¥ä¸‹æ¥å°†æœ¬æœºWindowsçš„å­—ä½“ä¸Šä¼ åˆ°CentOSæœåŠ¡å™¨ä¸Šã€‚ å…·ä½“æ“ä½œï¼š ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨æˆ‘çš„å­—ä½“ ç»æµ‹è¯•æ²¡é—®é¢˜ æœ‰çš„ç³»ç»Ÿç‰ˆæœ¬çš„åŸå›  ä¹Ÿä¼šå¯¼è‡´ä¹±ç  é“¾æ¥: <a href="https://pan.baidu.com/s/1Fj6pqfNDi__sdBJthdFCFg">https://pan.baidu.com/s/1Fj6pqfNDi__sdBJthdFCFg</a> æå–ç : k35v å°†Windowsä¸Šå­—ä½“æ–‡ä»¶ C:\Windows\Fontsç›®å½•ï¼Œå¤åˆ¶åˆ°CentOSçš„/usr/share/fontsç›®å½• é‡å¯æœåŠ¡å™¨</p><p>å¦‚æœä½ è½¬æ¢çš„æ–‡æ¡£ä¸­æœ‰ å…¬å¼ç³»åˆ—çš„è¯ é‚£ä¹ˆè¿˜éœ€è¦å†å¯¼å…¥ä¸€ç§å…¬å¼å­—ä½“ è¿™é‡Œå·²ç»å‡†å¤‡å¥½å•¦ é“¾æ¥: <a href="https://pan.baidu.com/s/1c8WYZMcqVeRHc23vVe3xrQ">https://pan.baidu.com/s/1c8WYZMcqVeRHc23vVe3xrQ</a> æå–ç : c329<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/WX20190809-100929@2x_1565316592563.png" alt="WX20190809-100929@2x">åŒæ ·éœ€è¦é‡å¯æœåŠ¡å™¨</p><p><strong>å·²çŸ¥é—®é¢˜ ç€é‡å·æ— æ³•è½¬æ¢ å®˜ç½‘ä¹Ÿä¸ºç»™å‡ºè§£å†³æ–¹æ¡ˆ</strong><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/%E6%9C%AA%E5%91%BD%E5%90%8D%E6%96%87%E4%BB%B6_1565316729182.jpg" alt="æœªå‘½åæ–‡ä»¶"></p><h1 id="aspose-words-wordè½¬å›¾ç‰‡"><a href="#aspose-words-wordè½¬å›¾ç‰‡" class="headerlink" title="aspose-words wordè½¬å›¾ç‰‡"></a>aspose-words wordè½¬å›¾ç‰‡</h1><p>è¿™é‡Œæ‰€ç”¨åˆ°çš„jaråŒ… å’Œè¿™é‡Œæ‰€ç”¨çš„çš„ä¸€æ · <a href="https://bk.cuixiaoyan.xyz/archives/wordpdf">jaråŒ…ä¸‹è½½ å’Œè°æ–‡ä»¶</a> å°†wordè½¬æ¢ä¸ºå•å¼ å›¾ç‰‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><code class="hljs java"> <br><span class="hljs-comment">// å°†word è½¬åŒ–ä¸ºå›¾ç‰‡ä¸€å¼ </span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">parseFileToBase64_PNG</span><span class="hljs-params">(String wordfile)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br> <br><span class="hljs-comment">//æ–‡ä»¶æµ</span><br>InputStream inputStream = <span class="hljs-keyword">new</span> FileInputStream(wordfile);<br><span class="hljs-comment">//æ–‡ä»¶ è·å–æ–‡ä»¶åå­—</span><br>File file = <span class="hljs-keyword">new</span> File(wordfile);<br>String name = file.getName();<br><span class="hljs-comment">//æˆªå–ä¸å¸¦åç¼€åçš„å­—æ®µ</span><br>String fileName = name.substring(<span class="hljs-number">0</span>, name.lastIndexOf(<span class="hljs-string">&quot;.&quot;</span>));<br> <br><span class="hljs-comment">//æ–‡ä»¶ä¸Šä¼ è·¯å¾„</span><br>String parent = file.getParent();<br> <br>List&lt;BufferedImage&gt; bufferedImages = <span class="hljs-keyword">new</span> ArrayList&lt;BufferedImage&gt;();<br>BufferedImage image = <span class="hljs-keyword">null</span>;<br>bufferedImages = wordToImg(inputStream);<br>image = MergeImage.mergeImage(<span class="hljs-keyword">false</span>, bufferedImages);<br> <br><span class="hljs-keyword">boolean</span> png = ImageIO.write(image, <span class="hljs-string">&quot;png&quot;</span>, <span class="hljs-keyword">new</span> File(parent + <span class="hljs-string">&quot;/&quot;</span> + fileName + <span class="hljs-string">&quot;.png&quot;</span>));<span class="hljs-comment">// å†™å…¥æµä¸­</span><br> <br> <br><span class="hljs-keyword">if</span>(png == <span class="hljs-keyword">false</span>)&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;è½¬æ¢å¤±è´¥&quot;</span>;<br>&#125;<br> <br><span class="hljs-comment">//å…³é—­æµ</span><br>inputStream.close();<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;è½¬æ¢æˆåŠŸ&quot;</span>;<br>&#125;<br> <br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Description</span>: wordå’Œtxtæ–‡ä»¶è½¬æ¢å›¾ç‰‡</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> List&lt;BufferedImage&gt; <span class="hljs-title">wordToImg</span><span class="hljs-params">(InputStream inputStream)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br><span class="hljs-keyword">if</span> (!isWordLicense()) &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>&#125;<br> <br><span class="hljs-keyword">try</span> &#123;<br> <br>Document doc = <span class="hljs-keyword">new</span> Document(inputStream);<br>ImageSaveOptions options = <span class="hljs-keyword">new</span> ImageSaveOptions(SaveFormat.PNG);<br>options.setPrettyFormat(<span class="hljs-keyword">true</span>);<br>options.setUseAntiAliasing(<span class="hljs-keyword">true</span>);<br>options.setUseHighQualityRendering(<span class="hljs-keyword">true</span>);<br><span class="hljs-keyword">int</span> pageCount = doc.getPageCount();<br> <br>List&lt;BufferedImage&gt; imageList = <span class="hljs-keyword">new</span> ArrayList&lt;BufferedImage&gt;();<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; pageCount; i++) &#123;<br>OutputStream output = <span class="hljs-keyword">new</span> ByteArrayOutputStream();<br>options.setPageIndex(i);<br> <br>doc.save(output, options);<br>ImageInputStream imageInputStream = ImageIO.createImageInputStream(parse(output));<br>imageList.add(ImageIO.read(imageInputStream));<br>&#125;<br><span class="hljs-keyword">return</span> imageList;<br> <br>&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>e.printStackTrace();<br><span class="hljs-keyword">throw</span> e;<br>&#125;<br>&#125;<br> <br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Description</span>: éªŒè¯aspose.wordç»„ä»¶æ˜¯å¦æˆæƒï¼šæ— æˆæƒçš„æ–‡ä»¶æœ‰æ°´å°å’Œè¯•ç”¨æ ‡è®°</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isWordLicense</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">boolean</span> result = <span class="hljs-keyword">false</span>;<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-comment">// InputStream inputStream = new</span><br><span class="hljs-comment">// FileInputStream(&quot;D:\\Workspaces\\TestFilters\\lib\\license.xml&quot;);</span><br><span class="hljs-comment">// é¿å…æ–‡ä»¶é—æ¼</span><br>String licensexml = <span class="hljs-string">&quot;&lt;License&gt;\n&quot;</span> + <span class="hljs-string">&quot;&lt;Data&gt;\n&quot;</span> + <span class="hljs-string">&quot;&lt;Products&gt;\n&quot;</span><br>+ <span class="hljs-string">&quot;&lt;Product&gt;Aspose.Total for Java&lt;/Product&gt;\n&quot;</span> + <span class="hljs-string">&quot;&lt;Product&gt;Aspose.Words for Java&lt;/Product&gt;\n&quot;</span><br>+ <span class="hljs-string">&quot;&lt;/Products&gt;\n&quot;</span> + <span class="hljs-string">&quot;&lt;EditionType&gt;Enterprise&lt;/EditionType&gt;\n&quot;</span><br>+ <span class="hljs-string">&quot;&lt;SubscriptionExpiry&gt;20991231&lt;/SubscriptionExpiry&gt;\n&quot;</span><br>+ <span class="hljs-string">&quot;&lt;LicenseExpiry&gt;20991231&lt;/LicenseExpiry&gt;\n&quot;</span><br>+ <span class="hljs-string">&quot;&lt;SerialNumber&gt;23dcc79f-44ec-4a23-be3a-03c1632404e9&lt;/SerialNumber&gt;\n&quot;</span> + <span class="hljs-string">&quot;&lt;/Data&gt;\n&quot;</span><br>+ <span class="hljs-string">&quot;&lt;Signature&gt;\n&quot;</span><br>+ <span class="hljs-string">&quot;sNLLKGMUdF0r8O1kKilWAGdgfs2BvJb/2Xp8p5iuDVfZXmhppo+d0Ran1P9TKdjV4ABwAgKXxJ3jcQTqE/2IRfqwnPf8itN8aFZlV3TJPYeD3yWE7IT55Gz6EijUpC7aKeoohTb4w2fpox58wWoF3SNp6sK6jDfiAUGEHYJ9pjU=\n&quot;</span><br>+ <span class="hljs-string">&quot;&lt;/Signature&gt;\n&quot;</span> + <span class="hljs-string">&quot;&lt;/License&gt;&quot;</span>;<br>InputStream inputStream = <span class="hljs-keyword">new</span> ByteArrayInputStream(licensexml.getBytes());<br>com.aspose.words.License license = <span class="hljs-keyword">new</span> com.aspose.words.License();<br>license.setLicense(inputStream);<br>result = <span class="hljs-keyword">true</span>;<br>&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>e.printStackTrace();<br>&#125;<br><span class="hljs-keyword">return</span> result;<br>&#125;<br> <br><span class="hljs-comment">// outputStreamè½¬inputStream</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ByteArrayInputStream <span class="hljs-title">parse</span><span class="hljs-params">(OutputStream out)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>ByteArrayOutputStream baos = <span class="hljs-keyword">new</span> ByteArrayOutputStream();<br>baos = (ByteArrayOutputStream) out;<br>ByteArrayInputStream swapStream = <span class="hljs-keyword">new</span> ByteArrayInputStream(baos.toByteArray());<br><span class="hljs-keyword">return</span> swapStream;<br>&#125;<br> <br></code></pre></td></tr></table></figure><p>æ–°å»ºä¸€ä¸ªå·¥å…·ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> util;<br> <br><span class="hljs-keyword">import</span> java.awt.image.BufferedImage;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.util.List;<br> <br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@program</span>: transformation</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@description</span>: å¤šå¼ å›¾ç‰‡åˆæˆ</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span>: cuixy</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@create</span>: 2019-07-26 17:10</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MergeImage</span> </span>&#123;<br> <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆå¹¶ä»»æ•°é‡çš„å›¾ç‰‡æˆä¸€å¼ å›¾ç‰‡</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> isHorizontal</span><br><span class="hljs-comment">     *            trueä»£è¡¨æ°´å¹³åˆå¹¶ï¼Œfasleä»£è¡¨å‚ç›´åˆå¹¶</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> imgs</span><br><span class="hljs-comment">     *            å¾…åˆå¹¶çš„å›¾ç‰‡æ•°ç»„</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> BufferedImage <span class="hljs-title">mergeImage</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> isHorizontal, List&lt;BufferedImage&gt; imgs)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        <span class="hljs-comment">// ç”Ÿæˆæ–°å›¾ç‰‡</span><br>        BufferedImage destImage = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-comment">// è®¡ç®—æ–°å›¾ç‰‡çš„é•¿å’Œé«˜</span><br>        <span class="hljs-keyword">int</span> allw = <span class="hljs-number">0</span>, allh = <span class="hljs-number">0</span>, allwMax = <span class="hljs-number">0</span>, allhMax = <span class="hljs-number">0</span>;<br>        <span class="hljs-comment">// è·å–æ€»é•¿ã€æ€»å®½ã€æœ€é•¿ã€æœ€å®½</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; imgs.size(); i++) &#123;<br>            BufferedImage img = imgs.get(i);<br>            allw += img.getWidth();<br> <br>            <span class="hljs-keyword">if</span> (imgs.size() != i + <span class="hljs-number">1</span>) &#123;<br>                allh += img.getHeight() + <span class="hljs-number">2</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                allh += img.getHeight();<br>            &#125;<br> <br>            <span class="hljs-keyword">if</span> (img.getWidth() &gt; allwMax) &#123;<br>                allwMax = img.getWidth();<br>            &#125;<br> <br>            <span class="hljs-keyword">if</span> (img.getHeight() &gt; allhMax) &#123;<br>                allhMax = img.getHeight();<br>            &#125;<br>        &#125;<br> <br>        <span class="hljs-comment">// åˆ›å»ºæ–°å›¾ç‰‡</span><br>        <span class="hljs-keyword">if</span> (isHorizontal) &#123;<br>            destImage = <span class="hljs-keyword">new</span> BufferedImage(allw, allhMax, BufferedImage.TYPE_INT_RGB);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            destImage = <span class="hljs-keyword">new</span> BufferedImage(allwMax, allh, BufferedImage.TYPE_INT_RGB);<br>        &#125;<br> <br>        <span class="hljs-comment">// æ³¨é‡Šï¼Œåˆ†éš”çº¿ä»ç°è‰²å˜æˆçº¯é»‘</span><br>        <span class="hljs-comment">// Graphics2D g2 = (Graphics2D) destImage.getGraphics();</span><br>        <span class="hljs-comment">// g2.setBackground(Color.LIGHT_GRAY);</span><br>        <span class="hljs-comment">// g2.clearRect(0, 0, allw, allh);</span><br>        <span class="hljs-comment">// g2.setPaint(Color.RED);</span><br> <br>        <span class="hljs-comment">// åˆå¹¶æ‰€æœ‰å­å›¾ç‰‡åˆ°æ–°å›¾ç‰‡</span><br>        <span class="hljs-keyword">int</span> wx = <span class="hljs-number">0</span>, wy = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; imgs.size(); i++) &#123;<br>            BufferedImage img = imgs.get(i);<br>            <span class="hljs-keyword">int</span> w1 = img.getWidth();<br>            <span class="hljs-keyword">int</span> h1 = img.getHeight();<br>            <span class="hljs-comment">// ä»å›¾ç‰‡ä¸­è¯»å–RGB</span><br>            <span class="hljs-keyword">int</span>[] ImageArrayOne = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[w1 * h1];<br>            ImageArrayOne = img.getRGB(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, w1, h1, ImageArrayOne, <span class="hljs-number">0</span>, w1); <span class="hljs-comment">// é€è¡Œæ‰«æå›¾åƒä¸­å„ä¸ªåƒç´ çš„RGBåˆ°æ•°ç»„ä¸­</span><br>            <span class="hljs-keyword">if</span> (isHorizontal) &#123; <span class="hljs-comment">// æ°´å¹³æ–¹å‘åˆå¹¶</span><br>                destImage.setRGB(wx, <span class="hljs-number">0</span>, w1, h1, ImageArrayOne, <span class="hljs-number">0</span>, w1); <span class="hljs-comment">// è®¾ç½®ä¸ŠåŠéƒ¨åˆ†æˆ–å·¦åŠéƒ¨åˆ†çš„RGB</span><br>            &#125; <span class="hljs-keyword">else</span> &#123; <span class="hljs-comment">// å‚ç›´æ–¹å‘åˆå¹¶</span><br>                destImage.setRGB(<span class="hljs-number">0</span>, wy, w1, h1, ImageArrayOne, <span class="hljs-number">0</span>, w1); <span class="hljs-comment">// è®¾ç½®ä¸ŠåŠéƒ¨åˆ†æˆ–å·¦åŠéƒ¨åˆ†çš„RGB</span><br>            &#125;<br> <br>            wx += w1;<br>            wy += h1 + <span class="hljs-number">2</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> destImage;<br>    &#125;<br> <br> <br> <br>&#125;<br></code></pre></td></tr></table></figure><p>å°†wordè½¬æ¢ä¸ºå•é¡µ æ¯é¡µä¸ºä¸€å¼ å›¾ç‰‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * word è½¬æ¯é¡µpdf</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> wordfile</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@throws</span> Exception</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">parseFileToBase64_PNG1</span><span class="hljs-params">(String wordfile)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br> <br><span class="hljs-keyword">if</span> (!isWordLicense()) &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>&#125;<br> <br><span class="hljs-comment">// å£°æ˜ä¸€ä¸ª</span><br>InputStream inputStream = <span class="hljs-keyword">new</span> FileInputStream(wordfile);<br> <br> <br> <br><span class="hljs-comment">//æ–‡ä»¶ è·å–æ–‡ä»¶åå­—</span><br>File file = <span class="hljs-keyword">new</span> File(wordfile);<br>String name = file.getName();<br><span class="hljs-comment">//æˆªå–ä¸å¸¦åç¼€åçš„å­—æ®µ</span><br>String fileName = name.substring(<span class="hljs-number">0</span>, name.lastIndexOf(<span class="hljs-string">&quot;.&quot;</span>));<br><span class="hljs-comment">//æ–‡ä»¶ä¸Šä¼ è·¯å¾„</span><br>String parent = file.getParent();<br> <br><span class="hljs-comment">//åˆ›å»ºåŒåæ–‡ä»¶å¤¹</span><br><span class="hljs-keyword">new</span> File(parent+<span class="hljs-string">&quot;/&quot;</span>+ fileName).mkdir();<br> <br>List&lt;BufferedImage&gt; bufferedImages = wordToImg1(inputStream);<br> <br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; bufferedImages.size(); i++)&#123;<br>ImageIO.write(bufferedImages.get(i), <span class="hljs-string">&quot;png&quot;</span>, <span class="hljs-keyword">new</span> File(parent +<span class="hljs-string">&quot;/&quot;</span>+ fileName +<span class="hljs-string">&quot;/&quot;</span>+ <span class="hljs-string">&quot;ç¬¬&quot;</span>+ i +<span class="hljs-string">&quot;é¡µ&quot;</span> + fileName + <span class="hljs-string">&quot;.png&quot;</span>));<br>&#125;<br> <br> <br><br> <br><span class="hljs-comment">//å…³é—­æµ</span><br>inputStream.close();<br> <br> <br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;è½¬æ¢æˆåŠŸ&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="å›¾ç‰‡è½¬æ¢ä¸ºbase64-å‰å°é¢„è§ˆ"><a href="#å›¾ç‰‡è½¬æ¢ä¸ºbase64-å‰å°é¢„è§ˆ" class="headerlink" title="å›¾ç‰‡è½¬æ¢ä¸ºbase64 å‰å°é¢„è§ˆ"></a>å›¾ç‰‡è½¬æ¢ä¸ºbase64 å‰å°é¢„è§ˆ</h1><p>ä¸šåŠ¡éœ€æ±‚ wordè½¬æ¢æˆåœ¨çº¿é¢„è§ˆ ç»“åˆ<a href="https://bk.cuixiaoyan.xyz/archives/zhuantupian">è¿™é‡Œæ˜¯wordè½¬å›¾ç‰‡</a> ä¹Ÿå¯ä»¥ç›´æ¥è½¬æ¢ä¸ºåœ¨çº¿é¢„è§ˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">parseFileToBase64_PNG1</span><span class="hljs-params">(InputStream inputStream, <span class="hljs-keyword">int</span> pageNum)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br><span class="hljs-comment">// String png_base64 = &quot;&quot;;</span><br>List&lt;BufferedImage&gt; bufferedImages = <span class="hljs-keyword">new</span> ArrayList&lt;BufferedImage&gt;();<br>BufferedImage image = <span class="hljs-keyword">null</span>;<br>ByteArrayOutputStream baos = <span class="hljs-keyword">new</span> ByteArrayOutputStream();<span class="hljs-comment">// ioæµ</span><br>bufferedImages = wordToImg1(inputStream, pageNum);<br>image = mergeImage(<span class="hljs-keyword">false</span>, bufferedImages);<br>ImageIO.write(image, <span class="hljs-string">&quot;png&quot;</span>, baos);<span class="hljs-comment">// å†™å…¥æµä¸­</span><br> <br><span class="hljs-keyword">byte</span>[] bytes = baos.toByteArray();<span class="hljs-comment">// è½¬æ¢æˆå­—èŠ‚</span><br>BASE64Encoder encoder = <span class="hljs-keyword">new</span> BASE64Encoder();<br>String png_base64 = encoder.encodeBuffer(bytes).trim();<span class="hljs-comment">// è½¬æ¢æˆbase64ä¸²</span><br>png_base64 = png_base64.replaceAll(<span class="hljs-string">&quot;\n&quot;</span>, <span class="hljs-string">&quot;&quot;</span>).replaceAll(<span class="hljs-string">&quot;\r&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);<span class="hljs-comment">// åˆ é™¤</span><br><br><span class="hljs-keyword">return</span> png_base64;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>aspose</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>aspose-words java word è½¬pdf</title>
    <link href="/blog/2021/01/15/aspose-words-java-word%E8%BD%ACpdf/"/>
    <url>/blog/2021/01/15/aspose-words-java-word%E8%BD%ACpdf/</url>
    
    <content type="html"><![CDATA[<p>å’Œè°ç‰ˆjaråŒ… åŠ æ¿€æ´» å»é™¤æ°´å° è½¬æ¢ä»æ­¤æ— é™åˆ¶ å°±ç®—æ˜¯åœ¨æœåŠ¡å™¨ä¸Šä¹Ÿä¸éœ€è¦å®‰è£…å…¶ä»–å·¥å…· ç›®å‰æœ€å¥½ ä½¿ç”¨ æ–¹ä¾¿å¿«æ· jaråŒ…ä¸‹è½½åœ°å€ é“¾æ¥: <a href="https://pan.baidu.com/s/1tlbueAQq5bxPNgncS7GgoA">https://pan.baidu.com/s/1tlbueAQq5bxPNgncS7GgoA</a> æå–ç : p35p</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * word to pdf</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> inPath  word å…¨è·¯å¾„</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> outPath ç”Ÿæˆçš„pdf å…¨è·¯å¾„</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> an</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@throws</span> Exception</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">docPdf</span><span class="hljs-params">(String inPath, String outPath)</span>   </span>&#123;<br> <br><span class="hljs-keyword">if</span> (!isWordLicense()) &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>&#125;<br> <br><span class="hljs-keyword">try</span> &#123;<br>String path = outPath.substring(<span class="hljs-number">0</span>, outPath.lastIndexOf(File.separator));<br>File file = <span class="hljs-keyword">null</span>;<br>file = <span class="hljs-keyword">new</span> File(path);<br><span class="hljs-keyword">if</span> (!file.exists()) &#123;<span class="hljs-comment">//åˆ›å»ºæ–‡ä»¶å¤¹</span><br>file.mkdirs();<br>&#125;<br>file = <span class="hljs-keyword">new</span> File(outPath);<span class="hljs-comment">// æ–°å»ºä¸€ä¸ªç©ºç™½pdfæ–‡æ¡£</span><br>FileOutputStream os = <span class="hljs-keyword">new</span> FileOutputStream(file);<br>Document doc = <span class="hljs-keyword">new</span> Document(inPath); <span class="hljs-comment">// Addressæ˜¯å°†è¦è¢«è½¬åŒ–çš„wordæ–‡æ¡£</span><br>doc.save(os, SaveFormat.PDF);<span class="hljs-comment">// å…¨é¢æ”¯æŒDOC, DOCX, OOXML, RTF HTML, OpenDocument, PDF,</span><br>&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>e.printStackTrace();<br>&#125;<br><span class="hljs-comment">// EPUB, XPS, SWF ç›¸äº’è½¬æ¢</span><br><span class="hljs-keyword">return</span> outPath;<br>&#125;<br> <br> <br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Description</span>: éªŒè¯aspose.wordç»„ä»¶æ˜¯å¦æˆæƒï¼šæ— æˆæƒçš„æ–‡ä»¶æœ‰æ°´å°å’Œè¯•ç”¨æ ‡è®°</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isWordLicense</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">boolean</span> result = <span class="hljs-keyword">false</span>;<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-comment">// InputStream inputStream = new</span><br><span class="hljs-comment">// FileInputStream(&quot;D:\\Workspaces\\TestFilters\\lib\\license.xml&quot;);</span><br><span class="hljs-comment">// é¿å…æ–‡ä»¶é—æ¼</span><br>String licensexml = <span class="hljs-string">&quot;&lt;License&gt;\n&quot;</span> + <span class="hljs-string">&quot;&lt;Data&gt;\n&quot;</span> + <span class="hljs-string">&quot;&lt;Products&gt;\n&quot;</span><br>+ <span class="hljs-string">&quot;&lt;Product&gt;Aspose.Total for Java&lt;/Product&gt;\n&quot;</span> + <span class="hljs-string">&quot;&lt;Product&gt;Aspose.Words for Java&lt;/Product&gt;\n&quot;</span><br>+ <span class="hljs-string">&quot;&lt;/Products&gt;\n&quot;</span> + <span class="hljs-string">&quot;&lt;EditionType&gt;Enterprise&lt;/EditionType&gt;\n&quot;</span><br>+ <span class="hljs-string">&quot;&lt;SubscriptionExpiry&gt;20991231&lt;/SubscriptionExpiry&gt;\n&quot;</span><br>+ <span class="hljs-string">&quot;&lt;LicenseExpiry&gt;20991231&lt;/LicenseExpiry&gt;\n&quot;</span><br>+ <span class="hljs-string">&quot;&lt;SerialNumber&gt;23dcc79f-44ec-4a23-be3a-03c1632404e9&lt;/SerialNumber&gt;\n&quot;</span> + <span class="hljs-string">&quot;&lt;/Data&gt;\n&quot;</span><br>+ <span class="hljs-string">&quot;&lt;Signature&gt;\n&quot;</span><br>+ <span class="hljs-string">&quot;sNLLKGMUdF0r8O1kKilWAGdgfs2BvJb/2Xp8p5iuDVfZXmhppo+d0Ran1P9TKdjV4ABwAgKXxJ3jcQTqE/2IRfqwnPf8itN8aFZlV3TJPYeD3yWE7IT55Gz6EijUpC7aKeoohTb4w2fpox58wWoF3SNp6sK6jDfiAUGEHYJ9pjU=\n&quot;</span><br>+ <span class="hljs-string">&quot;&lt;/Signature&gt;\n&quot;</span> + <span class="hljs-string">&quot;&lt;/License&gt;&quot;</span>;<br>InputStream inputStream = <span class="hljs-keyword">new</span> ByteArrayInputStream(licensexml.getBytes());<br>com.aspose.words.License license = <span class="hljs-keyword">new</span> com.aspose.words.License();<br>license.setLicense(inputStream);<br>result = <span class="hljs-keyword">true</span>;<br>&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>e.printStackTrace();<br>&#125;<br><span class="hljs-keyword">return</span> result;<br>&#125;<br> <br><span class="hljs-comment">// outputStreamè½¬inputStream</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ByteArrayInputStream <span class="hljs-title">parse</span><span class="hljs-params">(OutputStream out)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>ByteArrayOutputStream baos = <span class="hljs-keyword">new</span> ByteArrayOutputStream();<br>baos = (ByteArrayOutputStream) out;<br>ByteArrayInputStream swapStream = <span class="hljs-keyword">new</span> ByteArrayInputStream(baos.toByteArray());<br><span class="hljs-keyword">return</span> swapStream;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>aspose</tag>
      
      <tag>word</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å°†æ•°å­—é‡‘é¢è½¬ä¸ºå¤§å†™ä¸­æ–‡é‡‘é¢</title>
    <link href="/blog/2021/01/13/%E5%B0%86%E6%95%B0%E5%AD%97%E9%87%91%E9%A2%9D%E8%BD%AC%E4%B8%BA%E5%A4%A7%E5%86%99%E4%B8%AD%E6%96%87%E9%87%91%E9%A2%9D/"/>
    <url>/blog/2021/01/13/%E5%B0%86%E6%95%B0%E5%AD%97%E9%87%91%E9%A2%9D%E8%BD%AC%E4%B8%BA%E5%A4%A7%E5%86%99%E4%B8%AD%E6%96%87%E9%87%91%E9%A2%9D/</url>
    
    <content type="html"><![CDATA[<p>è¾“å…¥æ•°å­—é‡‘é¢å‚æ•°ï¼Œè¿è¡Œç¨‹åºå¾—åˆ°å…¶å¯¹åº”çš„å¤§å†™ä¸­æ–‡é‡‘é¢ï¼›ä¾‹å¦‚ï¼šè¾“å…¥â€” 12.56ï¼Œè¾“å‡ºâ€” 12.56:å£¹æ‹¾è´°å…ƒä¼è§’é™†åˆ†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *<span class="hljs-doctag">@Title</span>: ConvertUpMoney </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Description</span>:  å°†æ•°å­—é‡‘é¢è½¬ä¸ºå¤§å†™æ±‰å­—é‡‘é¢</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span>: 2019å¹´6æœˆ18æ—¥ ä¸‹åˆ10:52:27</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ConvertUpMoney</span> </span>&#123;<br><br><span class="hljs-comment">//å¤§å†™æ•°å­—</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String[] NUMBERS = &#123;<span class="hljs-string">&quot;é›¶&quot;</span>,<span class="hljs-string">&quot;å£¹&quot;</span>,<span class="hljs-string">&quot;è´°&quot;</span>,<span class="hljs-string">&quot;å&quot;</span>,<span class="hljs-string">&quot;è‚†&quot;</span>,<span class="hljs-string">&quot;ä¼&quot;</span>,<span class="hljs-string">&quot;é™†&quot;</span>,<span class="hljs-string">&quot;æŸ’&quot;</span>,<span class="hljs-string">&quot;æŒ&quot;</span>,<span class="hljs-string">&quot;ç–&quot;</span>&#125;;<br><span class="hljs-comment">// æ•´æ•°éƒ¨åˆ†çš„å•ä½</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String[] IUNIT = &#123;<span class="hljs-string">&quot;å…ƒ&quot;</span>,<span class="hljs-string">&quot;æ‹¾&quot;</span>,<span class="hljs-string">&quot;ä½°&quot;</span>,<span class="hljs-string">&quot;ä»Ÿ&quot;</span>,<span class="hljs-string">&quot;ä¸‡&quot;</span>,<span class="hljs-string">&quot;æ‹¾&quot;</span>,<span class="hljs-string">&quot;ä½°&quot;</span>,<span class="hljs-string">&quot;ä»Ÿ&quot;</span>,<span class="hljs-string">&quot;äº¿&quot;</span>,<span class="hljs-string">&quot;æ‹¾&quot;</span>,<span class="hljs-string">&quot;ä½°&quot;</span>,<span class="hljs-string">&quot;ä»Ÿ&quot;</span>,<span class="hljs-string">&quot;ä¸‡&quot;</span>,<span class="hljs-string">&quot;æ‹¾&quot;</span>,<span class="hljs-string">&quot;ä½°&quot;</span>,<span class="hljs-string">&quot;ä»Ÿ&quot;</span>&#125;;<br>    <span class="hljs-comment">//å°æ•°éƒ¨åˆ†çš„å•ä½</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String[] DUNIT = &#123;<span class="hljs-string">&quot;è§’&quot;</span>,<span class="hljs-string">&quot;åˆ†&quot;</span>,<span class="hljs-string">&quot;å˜&quot;</span>&#125;;<br><br><span class="hljs-comment">//è½¬æˆä¸­æ–‡çš„å¤§å†™é‡‘é¢</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">toChinese</span><span class="hljs-params">(String str)</span> </span>&#123;<br><span class="hljs-comment">//åˆ¤æ–­è¾“å…¥çš„é‡‘é¢å­—ç¬¦ä¸²æ˜¯å¦ç¬¦åˆè¦æ±‚</span><br><span class="hljs-keyword">if</span> (StringUtils.isBlank(str) || !str.matches(<span class="hljs-string">&quot;(-)?[\\d]*(.)?[\\d]*&quot;</span>)) &#123;<br>System.out.println(<span class="hljs-string">&quot;æŠ±æ­‰ï¼Œè¯·è¾“å…¥æ•°å­—ï¼&quot;</span>);<br><span class="hljs-keyword">return</span> str;<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;0&quot;</span>.equals(str) || <span class="hljs-string">&quot;0.00&quot;</span>.equals(str) || <span class="hljs-string">&quot;0.0&quot;</span>.equals(str)) &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;é›¶å…ƒ&quot;</span>;<br>&#125;<br><br><span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦å­˜åœ¨è´Ÿå·&quot;-&quot;</span><br><span class="hljs-keyword">boolean</span> flag = <span class="hljs-keyword">false</span>;<br><span class="hljs-keyword">if</span>(str.startsWith(<span class="hljs-string">&quot;-&quot;</span>))&#123;<br>flag = <span class="hljs-keyword">true</span>;<br>str = str.replaceAll(<span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);<br>&#125;<br><br>str = str.replaceAll(<span class="hljs-string">&quot;,&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);<span class="hljs-comment">//å»æ‰&quot;,&quot;</span><br>String integerStr;<span class="hljs-comment">//æ•´æ•°éƒ¨åˆ†æ•°å­—</span><br>String decimalStr;<span class="hljs-comment">//å°æ•°éƒ¨åˆ†æ•°å­—</span><br><br><br><span class="hljs-comment">//åˆå§‹åŒ–ï¼šåˆ†ç¦»æ•´æ•°éƒ¨åˆ†å’Œå°æ•°éƒ¨åˆ†</span><br><span class="hljs-keyword">if</span>(str.indexOf(<span class="hljs-string">&quot;.&quot;</span>)&gt;<span class="hljs-number">0</span>) &#123;<br>integerStr = str.substring(<span class="hljs-number">0</span>,str.indexOf(<span class="hljs-string">&quot;.&quot;</span>));<br>decimalStr = str.substring(str.indexOf(<span class="hljs-string">&quot;.&quot;</span>)+<span class="hljs-number">1</span>);<br>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(str.indexOf(<span class="hljs-string">&quot;.&quot;</span>)==<span class="hljs-number">0</span>) &#123;<br>integerStr = <span class="hljs-string">&quot;&quot;</span>;<br>decimalStr = str.substring(<span class="hljs-number">1</span>);<br>&#125;<span class="hljs-keyword">else</span> &#123;<br>integerStr = str;<br>decimalStr = <span class="hljs-string">&quot;&quot;</span>;<br>&#125;<br><br><span class="hljs-comment">//beyondè¶…å‡ºè®¡ç®—èƒ½åŠ›ï¼Œç›´æ¥è¿”å›</span><br><span class="hljs-keyword">if</span>(integerStr.length()&gt;IUNIT.length) &#123;<br>System.out.println(str+<span class="hljs-string">&quot;ï¼šè¶…å‡ºè®¡ç®—èƒ½åŠ›&quot;</span>);<br><span class="hljs-keyword">return</span> str;<br>&#125;<br><br><span class="hljs-keyword">int</span>[] integers = toIntArray(integerStr);<span class="hljs-comment">//æ•´æ•°éƒ¨åˆ†æ•°å­—</span><br><span class="hljs-comment">//åˆ¤æ–­æ•´æ•°éƒ¨åˆ†æ˜¯å¦å­˜åœ¨è¾“å…¥012çš„æƒ…å†µ</span><br><span class="hljs-keyword">if</span> (integers.length&gt;<span class="hljs-number">1</span> &amp;&amp; integers[<span class="hljs-number">0</span>] == <span class="hljs-number">0</span>) &#123;<br>System.out.println(<span class="hljs-string">&quot;æŠ±æ­‰ï¼Œè¯·è¾“å…¥æ•°å­—ï¼&quot;</span>);<br><span class="hljs-keyword">if</span> (flag) &#123;<br>str = <span class="hljs-string">&quot;-&quot;</span>+str;<br>&#125;<br><span class="hljs-keyword">return</span> str;<br>&#125;<br><span class="hljs-keyword">boolean</span> isWan = isWan5(integerStr);<span class="hljs-comment">//è®¾ç½®ä¸‡å•ä½</span><br><span class="hljs-keyword">int</span>[] decimals = toIntArray(decimalStr);<span class="hljs-comment">//å°æ•°éƒ¨åˆ†æ•°å­—</span><br>String result = getChineseInteger(integers,isWan)+getChineseDecimal(decimals);<span class="hljs-comment">//è¿”å›æœ€ç»ˆçš„å¤§å†™é‡‘é¢</span><br><span class="hljs-keyword">if</span>(flag)&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;è´Ÿ&quot;</span>+result;<span class="hljs-comment">//å¦‚æœæ˜¯è´Ÿæ•°ï¼ŒåŠ ä¸Š&quot;è´Ÿ&quot;</span><br>&#125;<span class="hljs-keyword">else</span>&#123;<br><span class="hljs-keyword">return</span> result;<br>&#125;<br>&#125;<br><br><span class="hljs-comment">//å°†å­—ç¬¦ä¸²è½¬ä¸ºintæ•°ç»„</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span>[] toIntArray(String number) &#123;<br><span class="hljs-keyword">int</span>[] array = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[number.length()];<br><span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;i&lt;number.length();i++) &#123;<br>array[i] = Integer.parseInt(number.substring(i,i+<span class="hljs-number">1</span>));<br>&#125;<br><span class="hljs-keyword">return</span> array;<br>&#125;<br><span class="hljs-comment">//å°†æ•´æ•°éƒ¨åˆ†è½¬ä¸ºå¤§å†™çš„é‡‘é¢</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">getChineseInteger</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] integers,<span class="hljs-keyword">boolean</span> isWan)</span> </span>&#123;<br>StringBuffer chineseInteger = <span class="hljs-keyword">new</span> StringBuffer(<span class="hljs-string">&quot;&quot;</span>);<br><span class="hljs-keyword">int</span> length = integers.length;<br><span class="hljs-keyword">if</span> (length == <span class="hljs-number">1</span> &amp;&amp; integers[<span class="hljs-number">0</span>] == <span class="hljs-number">0</span>) &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>&#125;<br><span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;length;i++) &#123;<br>String key = <span class="hljs-string">&quot;&quot;</span>;<br><span class="hljs-keyword">if</span>(integers[i] == <span class="hljs-number">0</span>) &#123;<br><span class="hljs-keyword">if</span>((length - i) == <span class="hljs-number">13</span>)<span class="hljs-comment">//ä¸‡ï¼ˆäº¿ï¼‰</span><br>key = IUNIT[<span class="hljs-number">4</span>];<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>((length - i) == <span class="hljs-number">9</span>) &#123;<span class="hljs-comment">//äº¿</span><br>key = IUNIT[<span class="hljs-number">8</span>];<br>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>((length - i) == <span class="hljs-number">5</span> &amp;&amp; isWan) &#123;<span class="hljs-comment">//ä¸‡</span><br>key = IUNIT[<span class="hljs-number">4</span>];<br>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>((length - i) == <span class="hljs-number">1</span>) &#123;<span class="hljs-comment">//å…ƒ</span><br>key = IUNIT[<span class="hljs-number">0</span>];<br>&#125;<br><span class="hljs-keyword">if</span>((length - i)&gt;<span class="hljs-number">1</span> &amp;&amp; integers[i+<span class="hljs-number">1</span>]!=<span class="hljs-number">0</span>) &#123;<br>key += NUMBERS[<span class="hljs-number">0</span>];<br>&#125;<br>&#125;<br>chineseInteger.append(integers[i]==<span class="hljs-number">0</span>?key:(NUMBERS[integers[i]]+IUNIT[length - i -<span class="hljs-number">1</span>]));<br>&#125;<br><span class="hljs-keyword">return</span> chineseInteger.toString();<br>&#125;<br><span class="hljs-comment">//å°†å°æ•°éƒ¨åˆ†è½¬ä¸ºå¤§å†™çš„é‡‘é¢</span><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">getChineseDecimal</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] decimals)</span> </span>&#123;<br>StringBuffer chineseDecimal = <span class="hljs-keyword">new</span> StringBuffer(<span class="hljs-string">&quot;&quot;</span>);<br><span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;i&lt;decimals.length;i++) &#123;<br><span class="hljs-keyword">if</span>(i == <span class="hljs-number">3</span>) &#123;<br><span class="hljs-keyword">break</span>;<br>&#125;<br>chineseDecimal.append(decimals[i]==<span class="hljs-number">0</span>?<span class="hljs-string">&quot;&quot;</span>:(NUMBERS[decimals[i]]+DUNIT[i]));<br>&#125;<br><span class="hljs-keyword">return</span> chineseDecimal.toString();<br>&#125;<br><span class="hljs-comment">//åˆ¤æ–­å½“å‰æ•´æ•°éƒ¨åˆ†æ˜¯å¦å·²ç»æ˜¯è¾¾åˆ°ã€ä¸‡ã€‘</span><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isWan5</span><span class="hljs-params">(String integerStr)</span> </span>&#123;<br><span class="hljs-keyword">int</span> length = integerStr.length();<br><span class="hljs-keyword">if</span>(length &gt; <span class="hljs-number">4</span>) &#123;<br>String subInteger = <span class="hljs-string">&quot;&quot;</span>;<br><span class="hljs-keyword">if</span>(length &gt; <span class="hljs-number">8</span>) &#123;<br>subInteger = integerStr.substring(length- <span class="hljs-number">8</span>,length -<span class="hljs-number">4</span>);<br>&#125;<span class="hljs-keyword">else</span> &#123;<br>subInteger = integerStr.substring(<span class="hljs-number">0</span>,length - <span class="hljs-number">4</span>);<br>&#125;<br><span class="hljs-keyword">return</span> Integer.parseInt(subInteger) &gt; <span class="hljs-number">0</span>;<br>&#125;<span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>&#125;<br>&#125;<br><br><span class="hljs-comment">//Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>String number = <span class="hljs-string">&quot;12.56&quot;</span>;<br>System.out.println(number+<span class="hljs-string">&quot;: &quot;</span>+ConvertUpMoney.toChinese(number));<br><br>number = <span class="hljs-string">&quot;1234567890563886.123&quot;</span>;<br>System.out.println(number+<span class="hljs-string">&quot;: &quot;</span>+ConvertUpMoney.toChinese(number));<br><br>number = <span class="hljs-string">&quot;1600&quot;</span>;<br>System.out.println(number+<span class="hljs-string">&quot;: &quot;</span>+ConvertUpMoney.toChinese(number));<br><br>number = <span class="hljs-string">&quot;156,0&quot;</span>;<br>System.out.println(number+<span class="hljs-string">&quot;: &quot;</span>+ConvertUpMoney.toChinese(number));<br><br>number = <span class="hljs-string">&quot;-156,0&quot;</span>;<br>System.out.println(number+<span class="hljs-string">&quot;: &quot;</span>+ConvertUpMoney.toChinese(number));<br><br>number = <span class="hljs-string">&quot;0.12&quot;</span>;<br>System.out.println(number+<span class="hljs-string">&quot;: &quot;</span>+ConvertUpMoney.toChinese(number));<br><br>number = <span class="hljs-string">&quot;0.0&quot;</span>;<br>System.out.println(number+<span class="hljs-string">&quot;: &quot;</span>+ConvertUpMoney.toChinese(number));<br><br>number = <span class="hljs-string">&quot;01.12&quot;</span>;<br>System.out.println(number+<span class="hljs-string">&quot;: &quot;</span>+ConvertUpMoney.toChinese(number));<br><br>number = <span class="hljs-string">&quot;0125&quot;</span>;<br>System.out.println(number+<span class="hljs-string">&quot;: &quot;</span>+ConvertUpMoney.toChinese(number));<br><br>number = <span class="hljs-string">&quot;-0125&quot;</span>;<br>System.out.println(number+<span class="hljs-string">&quot;: &quot;</span>+ConvertUpMoney.toChinese(number));<br><br>number = <span class="hljs-string">&quot;sdw5655&quot;</span>;<br>System.out.println(number+<span class="hljs-string">&quot;: &quot;</span>+ConvertUpMoney.toChinese(number));<br><br>System.out.println(<span class="hljs-keyword">null</span>+<span class="hljs-string">&quot;: &quot;</span>+ConvertUpMoney.toChinese(<span class="hljs-keyword">null</span>));<br>&#125;<br> <br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>å·¥å…·</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaå¸¸ç”¨å·¥å…·ç±»3</title>
    <link href="/blog/2021/01/13/Java%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E7%B1%BB3/"/>
    <url>/blog/2021/01/13/Java%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E7%B1%BB3/</url>
    
    <content type="html"><![CDATA[<p>åœ¨Javaä¸­ï¼Œå·¥å…·ç±»å®šä¹‰äº†ä¸€ç»„å…¬å…±æ–¹æ³•ï¼Œè¿™ç¯‡æ–‡ç« å°†ä»‹ç»Javaä¸­ä½¿ç”¨æœ€é¢‘ç¹åŠæœ€é€šç”¨çš„Javaå·¥å…·ç±»ã€‚ä»¥ä¸‹å·¥å…·ç±»ã€æ–¹æ³•æŒ‰ä½¿ç”¨æµè¡Œåº¦æ’åï¼Œå‚è€ƒæ•°æ®æ¥æºäºGithubä¸Šéšæœºé€‰å–çš„5ä¸‡ä¸ªå¼€æºé¡¹ç›®æºç ã€‚</p><p>ä¸€. org.apache.commons.io.IOUtils</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">closeQuietlyï¼šå…³é—­ä¸€ä¸ªIOæµã€socketã€æˆ–è€…selectorä¸”ä¸æŠ›å‡ºå¼‚å¸¸ï¼Œé€šå¸¸æ”¾åœ¨<span class="hljs-keyword">finally</span>å—<br>toStringï¼šè½¬æ¢IOæµã€ Uriã€ <span class="hljs-keyword">byte</span>[]ä¸ºString<br>copyï¼šIOæµæ•°æ®å¤åˆ¶ï¼Œä»è¾“å…¥æµå†™åˆ°è¾“å‡ºæµä¸­ï¼Œæœ€å¤§æ”¯æŒ2GB<br>toByteArrayï¼šä»è¾“å…¥æµã€URIè·å–<span class="hljs-keyword">byte</span>[]<br>writeï¼šæŠŠå­—èŠ‚. å­—ç¬¦ç­‰å†™å…¥è¾“å‡ºæµ<br>toInputStreamï¼šæŠŠå­—ç¬¦è½¬æ¢ä¸ºè¾“å…¥æµ<br>readLinesï¼šä»è¾“å…¥æµä¸­è¯»å–å¤šè¡Œæ•°æ®ï¼Œè¿”å›List&lt;String&gt;<br>copyLargeï¼šåŒcopyï¼Œæ”¯æŒ2GBä»¥ä¸Šæ•°æ®çš„å¤åˆ¶<br>lineIteratorï¼šä»è¾“å…¥æµè¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼Œæ ¹æ®å‚æ•°è¦æ±‚è¯»å–çš„æ•°æ®é‡ï¼Œå…¨éƒ¨è¯»å–ï¼Œå¦‚æœæ•°æ®ä¸å¤Ÿï¼Œåˆ™å¤±è´¥<br></code></pre></td></tr></table></figure><p>äºŒ. org.apache.commons.io.FileUtils</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">deleteDirectoryï¼šåˆ é™¤æ–‡ä»¶å¤¹<br>readFileToStringï¼šä»¥å­—ç¬¦å½¢å¼è¯»å–æ–‡ä»¶å†…å®¹<br>deleteQueitlyï¼šåˆ é™¤æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ä¸”ä¸ä¼šæŠ›å‡ºå¼‚å¸¸<br>copyFileï¼šå¤åˆ¶æ–‡ä»¶<br>writeStringToFileï¼šæŠŠå­—ç¬¦å†™åˆ°ç›®æ ‡æ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»º<br>forceMkdirï¼šå¼ºåˆ¶åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œå¦‚æœè¯¥æ–‡ä»¶å¤¹çˆ¶çº§ç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºçˆ¶çº§<br>writeï¼šæŠŠå­—ç¬¦å†™åˆ°æŒ‡å®šæ–‡ä»¶ä¸­<br>listFilesï¼šåˆ—ä¸¾æŸä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶(æ ¹æ®è¿‡æ»¤å™¨)<br>copyDirectoryï¼šå¤åˆ¶æ–‡ä»¶å¤¹<br>forceDeleteï¼šå¼ºåˆ¶åˆ é™¤æ–‡ä»¶<br></code></pre></td></tr></table></figure><p>ä¸‰. org.apache.commons.lang.StringUtils</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">isBlankï¼šå­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©º (trimååˆ¤æ–­)<br>isEmptyï¼šå­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©º (ä¸trimå¹¶åˆ¤æ–­)<br>equalsï¼šå­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰<br>joinï¼šåˆå¹¶æ•°ç»„ä¸ºå•ä¸€å­—ç¬¦ä¸²ï¼Œå¯ä¼ åˆ†éš”ç¬¦<br>splitï¼šåˆ†å‰²å­—ç¬¦ä¸²<br>EMPTYï¼šè¿”å›ç©ºå­—ç¬¦ä¸²<br>trimToNullï¼štrimåä¸ºç©ºå­—ç¬¦ä¸²åˆ™è½¬æ¢ä¸º<span class="hljs-keyword">null</span><br>replaceï¼šæ›¿æ¢å­—ç¬¦ä¸²<br></code></pre></td></tr></table></figure><p>å››. org.apache.http.util.EntityUtils</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">toStringï¼šæŠŠEntityè½¬æ¢ä¸ºå­—ç¬¦ä¸²<br>consumeï¼šç¡®ä¿Entityä¸­çš„å†…å®¹å…¨éƒ¨è¢«æ¶ˆè´¹ã€‚å¯ä»¥çœ‹åˆ°æºç é‡Œåˆä¸€æ¬¡æ¶ˆè´¹äº†Entityçš„å†…å®¹ï¼Œå‡å¦‚ç”¨æˆ·æ²¡æœ‰æ¶ˆè´¹ï¼Œé‚£è°ƒç”¨Entityæ—¶å€™å°†ä¼šæŠŠå®ƒæ¶ˆè´¹æ‰<br>toByteArrayï¼šæŠŠEntityè½¬æ¢ä¸ºå­—èŠ‚æµ<br>consumeQuietlyï¼šå’Œconsumeä¸€æ ·ï¼Œä½†ä¸æŠ›å¼‚å¸¸<br>getContentCharsetï¼šè·å–å†…å®¹çš„ç¼–ç <br></code></pre></td></tr></table></figure><p>äº”. org.apache.commons.lang3.StringUtils</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">isBlankï¼šå­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©º (trimååˆ¤æ–­)<br>isEmptyï¼šå­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©º (ä¸trimå¹¶åˆ¤æ–­)<br>equalsï¼šå­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰<br>joinï¼šåˆå¹¶æ•°ç»„ä¸ºå•ä¸€å­—ç¬¦ä¸²ï¼Œå¯ä¼ åˆ†éš”ç¬¦<br>splitï¼šåˆ†å‰²å­—ç¬¦ä¸²<br>EMPTYï¼šè¿”å›ç©ºå­—ç¬¦ä¸²<br>replaceï¼šæ›¿æ¢å­—ç¬¦ä¸²<br>capitalizeï¼šé¦–å­—ç¬¦å¤§å†™<br></code></pre></td></tr></table></figure><p>å…­. org.apache.commons.io.FilenameUtils</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">getExtensionï¼šè¿”å›æ–‡ä»¶åç¼€å<br>getBaseNameï¼šè¿”å›æ–‡ä»¶åï¼Œä¸åŒ…å«åç¼€å<br>getNameï¼šè¿”å›æ–‡ä»¶å…¨å<br>concatï¼šæŒ‰å‘½ä»¤è¡Œé£æ ¼ç»„åˆæ–‡ä»¶è·¯å¾„(è¯¦è§æ–¹æ³•æ³¨é‡Š)<br>removeExtensionï¼šåˆ é™¤åç¼€å<br>normalizeï¼šä½¿è·¯å¾„æ­£å¸¸åŒ–<br>wildcardMatchï¼šåŒ¹é…é€šé…ç¬¦<br>seperatorToUnixï¼šè·¯å¾„åˆ†éš”ç¬¦æ”¹æˆunixç³»ç»Ÿæ ¼å¼çš„ï¼Œå³/<br>getFullPathï¼šè·å–æ–‡ä»¶è·¯å¾„ï¼Œä¸åŒ…æ‹¬æ–‡ä»¶å<br>isExtensionï¼šæ£€æŸ¥æ–‡ä»¶åç¼€åæ˜¯ä¸æ˜¯ä¼ å…¥å‚æ•°(List&lt;String&gt;)ä¸­çš„ä¸€ä¸ª<br></code></pre></td></tr></table></figure><p>ä¸ƒ. org.springframework.util.StringUtils</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">hasTextï¼šæ£€æŸ¥å­—ç¬¦ä¸²ä¸­æ˜¯å¦åŒ…å«æ–‡æœ¬<br>hasLengthï¼šæ£€æµ‹å­—ç¬¦ä¸²æ˜¯å¦é•¿åº¦å¤§äº<span class="hljs-number">0</span><br>isEmptyï¼šæ£€æµ‹å­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©ºï¼ˆè‹¥ä¼ å…¥ä¸ºå¯¹è±¡ï¼Œåˆ™åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸º<span class="hljs-keyword">null</span>ï¼‰<br>commaDelimitedStringToArrayï¼šé€—å·åˆ†éš”çš„Stringè½¬æ¢ä¸ºæ•°ç»„<br>collectionToDelimitedStringï¼šæŠŠé›†åˆè½¬ä¸ºCSVæ ¼å¼å­—ç¬¦ä¸²<br>replace æ›¿æ¢å­—ç¬¦ä¸²<br><span class="hljs-number">7.</span> delimitedListToStringArrayï¼šç›¸å½“äºsplit<br>uncapitalizeï¼šé¦–å­—æ¯å°å†™<br>collectionToDelimitedCommaStringï¼šæŠŠé›†åˆè½¬ä¸ºCSVæ ¼å¼å­—ç¬¦ä¸²<br>tokenizeToStringArrayï¼šå’ŒsplitåŸºæœ¬ä¸€æ ·ï¼Œä½†èƒ½è‡ªåŠ¨å»æ‰ç©ºç™½çš„å•è¯<br></code></pre></td></tr></table></figure><p>å…«. org.apache.commons.lang.ArrayUtils</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">containsï¼šæ˜¯å¦åŒ…å«æŸå­—ç¬¦ä¸²<br>addAllï¼šæ·»åŠ æ•´ä¸ªæ•°ç»„<br>cloneï¼šå…‹éš†ä¸€ä¸ªæ•°ç»„<br>isEmptyï¼šæ˜¯å¦ç©ºæ•°ç»„<br>addï¼šå‘æ•°ç»„æ·»åŠ å…ƒç´ <br>subarrayï¼šæˆªå–æ•°ç»„<br>indexOfï¼šæŸ¥æ‰¾æŸä¸ªå…ƒç´ çš„ä¸‹æ ‡<br>isEqualsï¼šæ¯”è¾ƒæ•°ç»„æ˜¯å¦ç›¸ç­‰<br>toObjectï¼šåŸºç¡€ç±»å‹æ•°æ®æ•°ç»„è½¬æ¢ä¸ºå¯¹åº”çš„Objectæ•°ç»„<br></code></pre></td></tr></table></figure><p>ä¹. org.apache.commons.lang.StringEscapeUtils</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">å‚è€ƒåäº”ï¼šorg.apache.commons.lang3.StringEscapeUtils<br></code></pre></td></tr></table></figure><p>å. org.apache.http.client.utils.URLEncodedUtils</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">formatï¼šæ ¼å¼åŒ–å‚æ•°ï¼Œè¿”å›ä¸€ä¸ªHTTP POSTæˆ–è€…HTTP PUTå¯ç”¨application/x-www-form-urlencodedå­—ç¬¦ä¸²<br>parseï¼šæŠŠStringæˆ–è€…URIç­‰è½¬æ¢ä¸ºList&lt;NameValuePair&gt;<br></code></pre></td></tr></table></figure><p>åä¸€. org.apache.commons.codec.digest.DigestUtils</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">md5Hexï¼šMD5åŠ å¯†ï¼Œè¿”å›<span class="hljs-number">32</span>ä½å­—ç¬¦ä¸²<br>sha1Hexï¼šSHA-<span class="hljs-number">1</span>åŠ å¯†<br>sha256Hexï¼šSHA-<span class="hljs-number">256</span>åŠ å¯†<br>sha512Hexï¼šSHA-<span class="hljs-number">512</span>åŠ å¯†<br>md5ï¼šMD5åŠ å¯†ï¼Œè¿”å›<span class="hljs-number">16</span>ä½å­—ç¬¦ä¸²<br></code></pre></td></tr></table></figure><p>åäºŒ. org.apache.commons.collections.CollectionUtils</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">isEmptyï¼šæ˜¯å¦ä¸ºç©º<br>selectï¼šæ ¹æ®æ¡ä»¶ç­›é€‰é›†åˆå…ƒç´ <br>transformï¼šæ ¹æ®æŒ‡å®šæ–¹æ³•å¤„ç†é›†åˆå…ƒç´ ï¼Œç±»ä¼¼Listçš„map()<br>filterï¼šè¿‡æ»¤å…ƒç´ ï¼Œé›·ç‘ŸListçš„filter()<br>findï¼šåŸºæœ¬å’Œselectä¸€æ ·<br>collectï¼šå’Œtransform å·®ä¸å¤šä¸€æ ·ï¼Œä½†æ˜¯è¿”å›æ–°æ•°ç»„<br>forAllDoï¼šè°ƒç”¨æ¯ä¸ªå…ƒç´ çš„æŒ‡å®šæ–¹æ³•<br>isEqualCollectionï¼šåˆ¤æ–­ä¸¤ä¸ªé›†åˆæ˜¯å¦ä¸€è‡´<br></code></pre></td></tr></table></figure><p>åä¸‰. org.apache.commons.lang3.ArrayUtils</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">containsï¼šæ˜¯å¦åŒ…å«æŸä¸ªå­—ç¬¦ä¸²<br>addAllï¼šæ·»åŠ æ•´ä¸ªæ•°ç»„<br>cloneï¼šå…‹éš†ä¸€ä¸ªæ•°ç»„<br>isEmptyï¼šæ˜¯å¦ç©ºæ•°ç»„<br>addï¼šå‘æ•°ç»„æ·»åŠ å…ƒç´ <br>subarrayï¼šæˆªå–æ•°ç»„<br>indexOfï¼šæŸ¥æ‰¾æŸä¸ªå…ƒç´ çš„ä¸‹æ ‡<br>isEqualsï¼šæ¯”è¾ƒæ•°ç»„æ˜¯å¦ç›¸ç­‰<br>toObjectï¼šåŸºç¡€ç±»å‹æ•°æ®æ•°ç»„è½¬æ¢ä¸ºå¯¹åº”çš„Objectæ•°ç»„<br></code></pre></td></tr></table></figure><p>åå››. org.apache.commons.beanutils.PropertyUtils</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">getPropertyï¼šè·å–å¯¹è±¡å±æ€§å€¼<br>setPropertyï¼šè®¾ç½®å¯¹è±¡å±æ€§å€¼<br>getPropertyDiscriptorï¼šè·å–å±æ€§æè¿°å™¨<br>isReadableï¼šæ£€æŸ¥å±æ€§æ˜¯å¦å¯è®¿é—®<br>copyPropertiesï¼šå¤åˆ¶å±æ€§å€¼ï¼Œä»ä¸€ä¸ªå¯¹è±¡åˆ°å¦ä¸€ä¸ªå¯¹è±¡<br>getPropertyDiscriptorsï¼šè·å–æ‰€æœ‰å±æ€§æè¿°å™¨<br>isWriteableï¼šæ£€æŸ¥å±æ€§æ˜¯å¦å¯å†™<br>getPropertyTypeï¼šè·å–å¯¹è±¡å±æ€§ç±»å‹<br></code></pre></td></tr></table></figure><p>åäº”. org.apache.commons.lang3.StringEscapeUtils</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">unescapeHtml4ï¼šè½¬ä¹‰html<br>escapeHtml4ï¼šåè½¬ä¹‰html<br>escapeXmlï¼šè½¬ä¹‰xml<br>unescapeXmlï¼šåè½¬ä¹‰xml<br>escapeJavaï¼šè½¬ä¹‰unicodeç¼–ç <br>escapeEcmaScriptï¼šè½¬ä¹‰EcmaScriptå­—ç¬¦<br>unescapeJavaï¼šåè½¬ä¹‰unicodeç¼–ç <br>escapeJsonï¼šè½¬ä¹‰jsonå­—ç¬¦<br>escapeXml10ï¼šè½¬ä¹‰Xml10<br>è¿™ä¸ªç°åœ¨å·²ç»åºŸå¼ƒäº†ï¼Œå»ºè®®ä½¿ç”¨commons-textåŒ…é‡Œé¢çš„æ–¹æ³•ã€‚<br></code></pre></td></tr></table></figure><p>åå…­. org.apache.commons.beanutils.BeanUtils</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">copyPeopertiesï¼šå¤åˆ¶å±æ€§å€¼ï¼Œä»ä¸€ä¸ªå¯¹è±¡åˆ°å¦ä¸€ä¸ªå¯¹è±¡<br>getPropertyï¼šè·å–å¯¹è±¡å±æ€§å€¼<br>setPropertyï¼šè®¾ç½®å¯¹è±¡å±æ€§å€¼<br>populateï¼šæ ¹æ®Mapç»™å±æ€§å¤åˆ¶<br>copyPeopertyï¼šå¤åˆ¶å•ä¸ªå€¼ï¼Œä»ä¸€ä¸ªå¯¹è±¡åˆ°å¦ä¸€ä¸ªå¯¹è±¡<br>cloneBeanï¼šå…‹éš†beanå®ä¾‹<br></code></pre></td></tr></table></figure><p>ç°åœ¨ä½ åªè¦äº†è§£äº†ä»¥ä¸Š16ç§æœ€æµè¡Œçš„å·¥å…·ç±»æ–¹æ³•ï¼Œä½ å°±ä¸å¿…è¦å†è‡ªå·±å†™å·¥å…·ç±»äº†ï¼Œä¸å¿…é‡å¤é€ è½®å­ã€‚å¤§éƒ¨åˆ†å·¥å…·ç±»æ–¹æ³•é€šè¿‡å…¶åå­—å°±èƒ½æ˜ç™½å…¶ç”¨é€”ï¼Œå¦‚æœä¸æ¸…æ¥šçš„ï¼Œå¯ä»¥çœ‹ä¸‹åˆ«äººæ˜¯æ€ä¹ˆç”¨çš„ï¼Œæˆ–è€…å»ç½‘ä¸ŠæŸ¥è¯¢å…¶ç”¨æ³•ã€‚</p><p>å¦å¤–ï¼Œå·¥å…·ç±»ï¼Œæ ¹æ®é˜¿é‡Œå¼€å‘æ‰‹å†Œï¼ŒåŒ…åå¦‚æœè¦ä½¿ç”¨utilä¸èƒ½å¸¦sï¼Œå·¥å…·ç±»å‘½åä¸º XxxUtils</p>]]></content>
    
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>å·¥å…·ç±»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaå¸¸ç”¨å·¥å…·ç±»2</title>
    <link href="/blog/2021/01/13/Java%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E7%B1%BB2/"/>
    <url>/blog/2021/01/13/Java%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E7%B1%BB2/</url>
    
    <content type="html"><![CDATA[<p>ä¸€ã€å½“ç›¸åŒå…ƒç´ ä¸ºStringæ—¶ æ–¹æ³•ä¸€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Listå»é‡</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">private</span> List&lt;String&gt; <span class="hljs-title">removeDuplicate</span><span class="hljs-params">(List&lt;String&gt; list)</span> </span>&#123;<br>    LinkedHashSet&lt;String&gt; set = <span class="hljs-keyword">new</span> LinkedHashSet&lt;String&gt;(list.size());<br>    set.addAll(list);<br>    list.clear();<br>    list.addAll(set);<br>    <span class="hljs-keyword">return</span> list;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ–¹æ³•äºŒ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;String&gt; list= list.stream().distinct().collect(Collectors.toList());<br></code></pre></td></tr></table></figure><p>äºŒã€å½“ç›¸åŒå…ƒç´ ä¸ºå¯¹è±¡æ—¶ æ–¹æ³•ä¸€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æ³¨æ„Comparator.comparingè¦æ ¹æ®å‚æ•°çš„ç±»å‹è¿›è¡Œé€‰æ‹©</span><br><span class="hljs-function"><span class="hljs-keyword">private</span> List&lt;GroupVO&gt; <span class="hljs-title">removeDuplicateGroupVO</span><span class="hljs-params">(List&lt;GroupVO&gt; groupVOS)</span></span>&#123;<br>    <span class="hljs-keyword">return</span> groupVOS.stream().collect(<br>            Collectors.collectingAndThen(<br>                    Collectors.toCollection(<br>                            () -&gt; <span class="hljs-keyword">new</span> TreeSet&lt;&gt;(Comparator.comparing(GroupVO::getId))<br>                    ), ArrayList::<span class="hljs-keyword">new</span><br>            )<br>    );<br>&#125;<br></code></pre></td></tr></table></figure><p>æ–¹æ³•äºŒ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;Person&gt; <span class="hljs-title">removeDupliById</span><span class="hljs-params">(List&lt;Person&gt; persons)</span> </span>&#123;<br>      Set&lt;Person&gt; personSet = <span class="hljs-keyword">new</span> TreeSet&lt;&gt;((o1, o2) -&gt; o1.getId().compareTo(o2.getId()));<br>      personSet.addAll(persons);<br> <br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ArrayList&lt;&gt;(personSet);<br>  &#125;<br></code></pre></td></tr></table></figure><p>æ–¹æ³•ä¸‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; <span class="hljs-function">Predicate&lt;T&gt; <span class="hljs-title">distinctByKey</span><span class="hljs-params">(Function&lt;? <span class="hljs-keyword">super</span> T, Object&gt; keyExtractor)</span> </span>&#123;<br>      Map&lt;Object, Boolean&gt; map = <span class="hljs-keyword">new</span> ConcurrentHashMap&lt;&gt;();<br>      <span class="hljs-keyword">return</span> t -&gt; map.putIfAbsent(keyExtractor.apply(t), Boolean.TRUE) == <span class="hljs-keyword">null</span>;<br>  &#125;<br> <br><span class="hljs-comment">// remove duplicate</span><br>persons.stream().filter(distinctByKey(p -&gt; p.getId())).forEach(p -&gt; System.out.println(p));<br></code></pre></td></tr></table></figure><p>æ–¹æ³•ä¸€ï¼šç®€å•ç²—æš´ï¼Œç›´æ¥ä½¿ç”¨copy()ï¼Œå¦‚æœç›®æ ‡å­˜åœ¨ï¼Œå…ˆä½¿ç”¨delete()åˆ é™¤ï¼Œå†å¤åˆ¶ï¼›</p><p>æ–¹æ³•äºŒï¼šä½¿ç”¨è¾“å…¥è¾“å‡ºæµã€‚ï¼ˆä»£ç æ³¨é‡Šéƒ¨åˆ†ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> eg2;<br> <br><span class="hljs-keyword">import</span> java.io.File;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.nio.file.Files;<br><span class="hljs-keyword">import</span> java.util.Scanner;<br> <br><span class="hljs-comment">/******************</span><br><span class="hljs-comment"> * æ–‡ä»¶çš„å¤åˆ¶</span><br><span class="hljs-comment"> *******************/</span><br> <br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test2_3</span> </span>&#123;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        <span class="hljs-comment">// TODO Auto-generated method stub</span><br>        <span class="hljs-meta">@SuppressWarnings(&quot;resource&quot;)</span><br>        Scanner sc = <span class="hljs-keyword">new</span> Scanner(System.in);<br>        System.out.println(<span class="hljs-string">&quot;è¯·è¾“å…¥æŒ‡å®šæ–‡ä»¶å¤¹è·¯å¾„ï¼š&quot;</span>);<br>        String oldpath = sc.next();<br>        System.out.println(<span class="hljs-string">&quot;è¯·è¾“å…¥ç›®æ ‡æ–‡ä»¶å¤¹è·¯å¾„ï¼š&quot;</span>);<br>        String newpath = sc.next();<br>        System.out.println(<span class="hljs-string">&quot;è¯·è¾“å…¥è¦å¤åˆ¶çš„æ–‡ä»¶åï¼š&quot;</span>);<br>        String filename = sc.next();<br>        copy(filename, oldpath, newpath);<br>        System.out.println(<span class="hljs-string">&quot;å¤åˆ¶å®Œæˆï¼&quot;</span>);<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">copy</span><span class="hljs-params">(String filename, String oldpath, String newpath)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        <span class="hljs-comment">// TODO Auto-generated method stub</span><br>        File oldpaths = <span class="hljs-keyword">new</span> File(oldpath + <span class="hljs-string">&quot;/&quot;</span> + filename);<br>        File newpaths = <span class="hljs-keyword">new</span> File(newpath + <span class="hljs-string">&quot;/&quot;</span> + filename);<br>        <span class="hljs-keyword">if</span> (!newpaths.exists()) &#123;<br>            Files.copy(oldpaths.toPath(), newpaths.toPath());<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            newpaths.delete();<br>            Files.copy(oldpaths.toPath(), newpaths.toPath());<br>        &#125;<br> <br>        <span class="hljs-comment">// String newfile = &quot;&quot;;</span><br>        <span class="hljs-comment">// newfile += newpaths;</span><br>        <span class="hljs-comment">// FileInputStream in = new FileInputStream(oldpaths);</span><br>        <span class="hljs-comment">// File file = new File(newfile);</span><br>        <span class="hljs-comment">// if (!file.exists()) &#123;</span><br>        <span class="hljs-comment">// file.createNewFile();</span><br>        <span class="hljs-comment">// &#125;</span><br>        <span class="hljs-comment">// FileOutputStream out = new FileOutputStream(newpaths);</span><br>        <span class="hljs-comment">// byte[] buffer = new byte[1024];</span><br>        <span class="hljs-comment">// int c;</span><br>        <span class="hljs-comment">// while ((c = in.read(buffer)) != -1) &#123;</span><br>        <span class="hljs-comment">// for (int i = 0; i &lt; c; i++) &#123;</span><br>        <span class="hljs-comment">// out.write(buffer[i]);</span><br>        <span class="hljs-comment">// &#125;</span><br>        <span class="hljs-comment">// &#125;</span><br>        <span class="hljs-comment">// in.close();</span><br>        <span class="hljs-comment">// out.close();</span><br>    &#125;<br> <br>&#125;<br></code></pre></td></tr></table></figure><h2 id="javaå®ç°æ–‡ä»¶å‹ç¼©ï¼Œæ–‡ä»¶å¤¹å‹ç¼©ï¼Œä»¥åŠæ–‡ä»¶å’Œæ–‡ä»¶å¤¹çš„æ··åˆå‹ç¼©"><a href="#javaå®ç°æ–‡ä»¶å‹ç¼©ï¼Œæ–‡ä»¶å¤¹å‹ç¼©ï¼Œä»¥åŠæ–‡ä»¶å’Œæ–‡ä»¶å¤¹çš„æ··åˆå‹ç¼©" class="headerlink" title="javaå®ç°æ–‡ä»¶å‹ç¼©ï¼Œæ–‡ä»¶å¤¹å‹ç¼©ï¼Œä»¥åŠæ–‡ä»¶å’Œæ–‡ä»¶å¤¹çš„æ··åˆå‹ç¼©"></a>javaå®ç°æ–‡ä»¶å‹ç¼©ï¼Œæ–‡ä»¶å¤¹å‹ç¼©ï¼Œä»¥åŠæ–‡ä»¶å’Œæ–‡ä»¶å¤¹çš„æ··åˆå‹ç¼©</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> util;<br> <br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@program</span>: transformation</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@description</span>:</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span>: cuixy</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@create</span>: 2019-07-26 14:30</span><br><span class="hljs-comment"> **/</span><br> <br><span class="hljs-keyword">import</span> java.io.File;<br><span class="hljs-keyword">import</span> java.io.FileInputStream;<br><span class="hljs-keyword">import</span> java.io.FileOutputStream;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.util.zip.ZipEntry;<br><span class="hljs-keyword">import</span> java.util.zip.ZipOutputStream;<br> <br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å‹ç¼©ç®—æ³•ç±»</span><br><span class="hljs-comment"> * å®ç°æ–‡ä»¶å‹ç¼©ï¼Œæ–‡ä»¶å¤¹å‹ç¼©ï¼Œä»¥åŠæ–‡ä»¶å’Œæ–‡ä»¶å¤¹çš„æ··åˆå‹ç¼©</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> ljheee</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CompactAlgorithm</span> </span>&#123;<br> <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å®Œæˆçš„ç»“æœæ–‡ä»¶--è¾“å‡ºçš„å‹ç¼©æ–‡ä»¶</span><br><span class="hljs-comment">     */</span><br>    File targetFile;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CompactAlgorithm</span><span class="hljs-params">()</span> </span>&#123;&#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CompactAlgorithm</span><span class="hljs-params">(File target)</span> </span>&#123;<br>        targetFile = target;<br>        <span class="hljs-keyword">if</span> (targetFile.exists())<br>            targetFile.delete();<br>    &#125;<br> <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å‹ç¼©æ–‡ä»¶</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> srcfile</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">zipFiles</span><span class="hljs-params">(File srcfile)</span> </span>&#123;<br> <br>        ZipOutputStream out = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            out = <span class="hljs-keyword">new</span> ZipOutputStream(<span class="hljs-keyword">new</span> FileOutputStream(targetFile));<br> <br>            <span class="hljs-keyword">if</span>(srcfile.isFile())&#123;<br>                zipFile(srcfile, out, <span class="hljs-string">&quot;&quot;</span>);<br>            &#125; <span class="hljs-keyword">else</span>&#123;<br>                File[] list = srcfile.listFiles();<br>                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; list.length; i++) &#123;<br>                    compress(list[i], out, <span class="hljs-string">&quot;&quot;</span>);<br>                &#125;<br>            &#125;<br> <br>            System.out.println(<span class="hljs-string">&quot;å‹ç¼©å®Œæ¯•&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-keyword">if</span> (out != <span class="hljs-keyword">null</span>)<br>                    out.close();<br>            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br> <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å‹ç¼©æ–‡ä»¶å¤¹é‡Œçš„æ–‡ä»¶</span><br><span class="hljs-comment">     * èµ·åˆä¸çŸ¥é“æ˜¯æ–‡ä»¶è¿˜æ˜¯æ–‡ä»¶å¤¹--- ç»Ÿä¸€è°ƒç”¨è¯¥æ–¹æ³•</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> file</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> out</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> basedir</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">compress</span><span class="hljs-params">(File file, ZipOutputStream out, String basedir)</span> </span>&#123;<br>        <span class="hljs-comment">/* åˆ¤æ–­æ˜¯ç›®å½•è¿˜æ˜¯æ–‡ä»¶ */</span><br>        <span class="hljs-keyword">if</span> (file.isDirectory()) &#123;<br>            <span class="hljs-keyword">this</span>.zipDirectory(file, out, basedir);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">this</span>.zipFile(file, out, basedir);<br>        &#125;<br>    &#125;<br> <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å‹ç¼©å•ä¸ªæ–‡ä»¶</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> srcfile</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">zipFile</span><span class="hljs-params">(File srcfile, ZipOutputStream out, String basedir)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (!srcfile.exists())<br>            <span class="hljs-keyword">return</span>;<br> <br>        <span class="hljs-keyword">byte</span>[] buf = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">1024</span>];<br>        FileInputStream in = <span class="hljs-keyword">null</span>;<br> <br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">int</span> len;<br>            in = <span class="hljs-keyword">new</span> FileInputStream(srcfile);<br>            out.putNextEntry(<span class="hljs-keyword">new</span> ZipEntry(basedir + srcfile.getName()));<br> <br>            <span class="hljs-keyword">while</span> ((len = in.read(buf)) &gt; <span class="hljs-number">0</span>) &#123;<br>                out.write(buf, <span class="hljs-number">0</span>, len);<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-keyword">if</span> (out != <span class="hljs-keyword">null</span>)<br>                    out.closeEntry();<br>                <span class="hljs-keyword">if</span> (in != <span class="hljs-keyword">null</span>)<br>                    in.close();<br>            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br> <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å‹ç¼©æ–‡ä»¶å¤¹</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> dir</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> out</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> basedir</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">zipDirectory</span><span class="hljs-params">(File dir, ZipOutputStream out, String basedir)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (!dir.exists())<br>            <span class="hljs-keyword">return</span>;<br> <br>        File[] files = dir.listFiles();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; files.length; i++) &#123;<br>            <span class="hljs-comment">/* é€’å½’ */</span><br>            compress(files[i], out, basedir + dir.getName() + <span class="hljs-string">&quot;/&quot;</span>);<br>        &#125;<br>    &#125;<br> <br> <br> <br>&#125;<br> <br></code></pre></td></tr></table></figure><p>è¿è¡Œæµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å‹ç¼©æµ‹è¯•</span><br>File f = <span class="hljs-keyword">new</span> File(<span class="hljs-string">&quot;/Users/cuixiaoyan/Downloads/æµè§ˆå™¨ä¸‹è½½&quot;</span>);<br><span class="hljs-keyword">new</span> CompactAlgorithm(<span class="hljs-keyword">new</span> File( <span class="hljs-string">&quot;/Users/cuixiaoyan/Downloads/&quot;</span>,f.getName()+<span class="hljs-string">&quot;.zip&quot;</span>)).zipFiles(f);<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>å·¥å…·</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaä¸­å®ç°Listè‡ªå®šä¹‰æ’åº</title>
    <link href="/blog/2021/01/11/Java%E4%B8%AD%E5%AE%9E%E7%8E%B0List%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%92%E5%BA%8F/"/>
    <url>/blog/2021/01/11/Java%E4%B8%AD%E5%AE%9E%E7%8E%B0List%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%92%E5%BA%8F/</url>
    
    <content type="html"><![CDATA[<p>å®ä½“ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.whty.entity;<br> <br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> id;<br><span class="hljs-keyword">private</span> String name;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> age;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">User</span><span class="hljs-params">(<span class="hljs-keyword">int</span> id, String name, <span class="hljs-keyword">int</span> age)</span> </span>&#123;<br><span class="hljs-keyword">super</span>();<br><span class="hljs-keyword">this</span>.id = id;<br><span class="hljs-keyword">this</span>.name = name;<br><span class="hljs-keyword">this</span>.age = age;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getId</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">return</span> id;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setId</span><span class="hljs-params">(<span class="hljs-keyword">int</span> id)</span> </span>&#123;<br><span class="hljs-keyword">this</span>.id = id;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">return</span> name;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setName</span><span class="hljs-params">(String name)</span> </span>&#123;<br><span class="hljs-keyword">this</span>.name = name;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getAge</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">return</span> age;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setAge</span><span class="hljs-params">(<span class="hljs-keyword">int</span> age)</span> </span>&#123;<br><span class="hljs-keyword">this</span>.age = age;<br>&#125;<br> <br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;User [id=&quot;</span> + id + <span class="hljs-string">&quot;, name=&quot;</span> + name + <span class="hljs-string">&quot;, age=&quot;</span> + age + <span class="hljs-string">&quot;]&quot;</span>;<br>&#125;<br>&#125;<br> <br></code></pre></td></tr></table></figure><p>æµ‹è¯•ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">package</span> com.whty.test;<br> <br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.Collections;<br><span class="hljs-keyword">import</span> java.util.Comparator;<br><span class="hljs-keyword">import</span> java.util.List;<br> <br><span class="hljs-keyword">import</span> com.whty.entity.User;<br> <br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>List&lt;User&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>list.add(<span class="hljs-keyword">new</span> User(<span class="hljs-number">1</span>, <span class="hljs-string">&quot;java&quot;</span>, <span class="hljs-number">20</span>));<br>list.add(<span class="hljs-keyword">new</span> User(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;spark&quot;</span>, <span class="hljs-number">19</span>));<br>list.add(<span class="hljs-keyword">new</span> User(<span class="hljs-number">3</span>, <span class="hljs-string">&quot;hive&quot;</span>, <span class="hljs-number">21</span>));<br><br><span class="hljs-keyword">for</span>(User user :list) &#123;<br>System.out.println(<span class="hljs-string">&quot;æ’åºå‰ï¼š&quot;</span> + user.toString());<br>&#125;<br><span class="hljs-comment">//å®ç°æ’åº</span><br>Collections.sort(list, <span class="hljs-keyword">new</span> Comparator&lt;User&gt;() &#123;<br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">compare</span><span class="hljs-params">(User u1, User u2)</span> </span>&#123;<br><span class="hljs-keyword">if</span>(u1.getAge() &gt; u2.getAge()) &#123;<br><span class="hljs-comment">//return -1:å³ä¸ºæ­£åºæ’åº</span><br><span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (u1.getAge() == u2.getAge()) &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<span class="hljs-keyword">else</span> &#123;<br><span class="hljs-comment">//return 1: å³ä¸ºå€’åºæ’åº</span><br><span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;<br>&#125;<br>&#125;);<br><br><span class="hljs-keyword">for</span>(User user :list) &#123;<br>System.out.println(<span class="hljs-string">&quot;æ’åºåï¼š&quot;</span> + user.toString());<br>&#125;<br>&#125;<br>&#125;<br> <br> <br></code></pre></td></tr></table></figure><p>è¿è¡Œç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">æ’åºå‰ï¼šUser [id=<span class="hljs-number">1</span>, name=java, age=<span class="hljs-number">20</span>]<br>æ’åºå‰ï¼šUser [id=<span class="hljs-number">2</span>, name=spark, age=<span class="hljs-number">19</span>]<br>æ’åºå‰ï¼šUser [id=<span class="hljs-number">3</span>, name=hive, age=<span class="hljs-number">21</span>]<br>æ’åºåï¼šUser [id=<span class="hljs-number">3</span>, name=hive, age=<span class="hljs-number">21</span>]<br>æ’åºåï¼šUser [id=<span class="hljs-number">1</span>, name=java, age=<span class="hljs-number">20</span>]<br>æ’åºåï¼šUser [id=<span class="hljs-number">2</span>, name=spark, age=<span class="hljs-number">19</span>]<br> <br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>å·¥å…·</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaå¸¸ç”¨å·¥å…·ç±»</title>
    <link href="/blog/2021/01/11/Java%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E7%B1%BB/"/>
    <url>/blog/2021/01/11/Java%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E7%B1%BB/</url>
    
    <content type="html"><![CDATA[<p>javaä¸­ï¼ŒStringUtilsç±»ä¸­çš„ä¸€äº›å¸¸ç”¨æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isBlank</span><span class="hljs-params">(String str)</span></span><br><span class="hljs-function"><span class="hljs-comment">//åˆ¤æ–­æŸå­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©ºæˆ–é•¿åº¦ä¸º0æˆ–ç”±ç©ºç™½ç¬¦(whitespace)æ„æˆ</span></span><br><span class="hljs-function">StringUtils.<span class="hljs-title">isBlank</span><span class="hljs-params">(<span class="hljs-keyword">null</span>)</span> </span>= <span class="hljs-keyword">true</span><br>StringUtils.isBlank(<span class="hljs-string">&quot;&quot;</span>) = <span class="hljs-keyword">true</span><br>StringUtils.isBlank(<span class="hljs-string">&quot; &quot;</span>) = <span class="hljs-keyword">true</span><br>StringUtils.isBlank(<span class="hljs-string">&quot; &quot;</span>) = <span class="hljs-keyword">true</span><br>StringUtils.isBlank(<span class="hljs-string">&quot;\t \n \f \r&quot;</span>) = <span class="hljs-keyword">true</span> <span class="hljs-comment">//å¯¹äºåˆ¶è¡¨ç¬¦ã€æ¢è¡Œç¬¦ã€æ¢é¡µç¬¦å’Œå›è½¦ç¬¦StringUtils.isBlank()å‡è¯†ä¸ºç©ºç™½ç¬¦</span><br>StringUtils.isBlank(<span class="hljs-string">&quot;\b&quot;</span>) = <span class="hljs-keyword">false</span> <span class="hljs-comment">//&quot;\b&quot;ä¸ºå•è¯è¾¹ç•Œç¬¦</span><br>StringUtils.isBlank(<span class="hljs-string">&quot;bob&quot;</span>) = <span class="hljs-keyword">false</span><br>StringUtils.isBlank(<span class="hljs-string">&quot; bob &quot;</span>) = <span class="hljs-keyword">false</span><br> <br> <br><span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isNotBlank</span><span class="hljs-params">(String str)</span></span><br><span class="hljs-function"><span class="hljs-comment">//åˆ¤æ–­æŸå­—ç¬¦ä¸²æ˜¯å¦ä¸ä¸ºç©ºä¸”é•¿åº¦ä¸ä¸º0ä¸”ä¸ç”±ç©ºç™½ç¬¦(whitespace)æ„æˆï¼Œç­‰äº!isBlank(String str)</span></span><br><span class="hljs-function">StringUtils.<span class="hljs-title">isNotBlank</span><span class="hljs-params">(<span class="hljs-keyword">null</span>)</span> </span>= <span class="hljs-keyword">false</span><br>StringUtils.isNotBlank(<span class="hljs-string">&quot;&quot;</span>) = <span class="hljs-keyword">false</span><br>StringUtils.isNotBlank(<span class="hljs-string">&quot; &quot;</span>) = <span class="hljs-keyword">false</span><br>StringUtils.isNotBlank(<span class="hljs-string">&quot; &quot;</span>) = <span class="hljs-keyword">false</span><br>StringUtils.isNotBlank(<span class="hljs-string">&quot;\t \n \f \r&quot;</span>) = <span class="hljs-keyword">false</span><br>StringUtils.isNotBlank(<span class="hljs-string">&quot;\b&quot;</span>) = <span class="hljs-keyword">true</span><br>StringUtils.isNotBlank(<span class="hljs-string">&quot;bob&quot;</span>) = <span class="hljs-keyword">true</span><br>StringUtils.isNotBlank(<span class="hljs-string">&quot; bob &quot;</span>) = <span class="hljs-keyword">true</span><br> <br> <br><span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isEmpty</span><span class="hljs-params">(String str)</span></span><br><span class="hljs-function"><span class="hljs-comment">//åˆ¤æ–­æŸå­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºçš„æ ‡å‡†æ˜¯str==nullæˆ–str.length()==0</span></span><br><span class="hljs-function">StringUtils.<span class="hljs-title">isEmpty</span><span class="hljs-params">(<span class="hljs-keyword">null</span>)</span> </span>= <span class="hljs-keyword">true</span><br>StringUtils.isEmpty(<span class="hljs-string">&quot;&quot;</span>) = <span class="hljs-keyword">true</span><br>StringUtils.isEmpty(<span class="hljs-string">&quot; &quot;</span>) = <span class="hljs-keyword">false</span> <span class="hljs-comment">//æ³¨æ„åœ¨StringUtilsä¸­ç©ºæ ¼ä½œéç©ºå¤„ç†</span><br>StringUtils.isEmpty(<span class="hljs-string">&quot; &quot;</span>) = <span class="hljs-keyword">false</span><br>StringUtils.isEmpty(<span class="hljs-string">&quot;bob&quot;</span>) = <span class="hljs-keyword">false</span><br>StringUtils.isEmpty(<span class="hljs-string">&quot; bob &quot;</span>) = <span class="hljs-keyword">false</span><br> <br> <br><span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isNotEmpty</span><span class="hljs-params">(String str)</span></span><br><span class="hljs-function"><span class="hljs-comment">//åˆ¤æ–­æŸå­—ç¬¦ä¸²æ˜¯å¦éç©ºï¼Œç­‰äº!isEmpty(String str)</span></span><br><span class="hljs-function">StringUtils.<span class="hljs-title">isNotEmpty</span><span class="hljs-params">(<span class="hljs-keyword">null</span>)</span> </span>= <span class="hljs-keyword">false</span><br>StringUtils.isNotEmpty(<span class="hljs-string">&quot;&quot;</span>) = <span class="hljs-keyword">false</span><br>StringUtils.isNotEmpty(<span class="hljs-string">&quot; &quot;</span>) = <span class="hljs-keyword">true</span><br>StringUtils.isNotEmpty(<span class="hljs-string">&quot; &quot;</span>) = <span class="hljs-keyword">true</span><br>StringUtils.isNotEmpty(<span class="hljs-string">&quot;bob&quot;</span>) = <span class="hljs-keyword">true</span><br>StringUtils.isNotEmpty(<span class="hljs-string">&quot; bob &quot;</span>) = <span class="hljs-keyword">true</span><br> <br> <br><span class="hljs-function">String <span class="hljs-title">trim</span><span class="hljs-params">(String str)</span></span><br><span class="hljs-function"><span class="hljs-comment">//å»æ‰å­—ç¬¦ä¸²ä¸¤ç«¯çš„æ§åˆ¶ç¬¦(control characters, char &lt;= 32),å¦‚æœè¾“å…¥ä¸ºnullåˆ™è¿”å›null</span></span><br><span class="hljs-function">StringUtils.<span class="hljs-title">trim</span><span class="hljs-params">(<span class="hljs-keyword">null</span>)</span> </span>= <span class="hljs-keyword">null</span><br>StringUtils.trim(<span class="hljs-string">&quot;&quot;</span>) = <span class="hljs-string">&quot;&quot;</span><br>StringUtils.trim(<span class="hljs-string">&quot; &quot;</span>) = <span class="hljs-string">&quot;&quot;</span><br>StringUtils.trim(<span class="hljs-string">&quot; \b \t \n \f \r &quot;</span>) = <span class="hljs-string">&quot;&quot;</span><br>StringUtils.trim(<span class="hljs-string">&quot; \n\tss \b&quot;</span>) = <span class="hljs-string">&quot;ss&quot;</span><br>StringUtils.trim(<span class="hljs-string">&quot; d d dd &quot;</span>) = <span class="hljs-string">&quot;d d dd&quot;</span><br>StringUtils.trim(<span class="hljs-string">&quot;dd &quot;</span>) = <span class="hljs-string">&quot;dd&quot;</span><br>StringUtils.trim(<span class="hljs-string">&quot; dd &quot;</span>) = <span class="hljs-string">&quot;dd&quot;</span><br> <br> <br><span class="hljs-function">String <span class="hljs-title">trimToNull</span><span class="hljs-params">(String str)</span></span><br><span class="hljs-function"><span class="hljs-comment">//å»æ‰å­—ç¬¦ä¸²ä¸¤ç«¯çš„æ§åˆ¶ç¬¦(control characters, char &lt;= 32),å¦‚æœå˜ä¸ºnullæˆ–&quot;&quot;ï¼Œåˆ™è¿”å›null</span></span><br><span class="hljs-function">StringUtils.<span class="hljs-title">trimToNull</span><span class="hljs-params">(<span class="hljs-keyword">null</span>)</span> </span>= <span class="hljs-keyword">null</span><br>StringUtils.trimToNull(<span class="hljs-string">&quot;&quot;</span>) = <span class="hljs-keyword">null</span><br>StringUtils.trimToNull(<span class="hljs-string">&quot; &quot;</span>) = <span class="hljs-keyword">null</span><br>StringUtils.trimToNull(<span class="hljs-string">&quot; \b \t \n \f \r &quot;</span>) = <span class="hljs-keyword">null</span><br>StringUtils.trimToNull(<span class="hljs-string">&quot; \n\tss \b&quot;</span>) = <span class="hljs-string">&quot;ss&quot;</span><br>StringUtils.trimToNull(<span class="hljs-string">&quot; d d dd &quot;</span>) = <span class="hljs-string">&quot;d d dd&quot;</span><br>StringUtils.trimToNull(<span class="hljs-string">&quot;dd &quot;</span>) = <span class="hljs-string">&quot;dd&quot;</span><br>StringUtils.trimToNull(<span class="hljs-string">&quot; dd &quot;</span>) = <span class="hljs-string">&quot;dd&quot;</span><br> <br> <br><span class="hljs-function">String <span class="hljs-title">trimToEmpty</span><span class="hljs-params">(String str)</span></span><br><span class="hljs-function"><span class="hljs-comment">//å»æ‰å­—ç¬¦ä¸²ä¸¤ç«¯çš„æ§åˆ¶ç¬¦(control characters, char &lt;= 32),å¦‚æœå˜ä¸ºnullæˆ–&quot;&quot;ï¼Œåˆ™è¿”å›&quot;&quot;</span></span><br><span class="hljs-function">StringUtils.<span class="hljs-title">trimToEmpty</span><span class="hljs-params">(<span class="hljs-keyword">null</span>)</span> </span>= <span class="hljs-string">&quot;&quot;</span><br>StringUtils.trimToEmpty(<span class="hljs-string">&quot;&quot;</span>) = <span class="hljs-string">&quot;&quot;</span><br>StringUtils.trimToEmpty(<span class="hljs-string">&quot; &quot;</span>) = <span class="hljs-string">&quot;&quot;</span><br>StringUtils.trimToEmpty(<span class="hljs-string">&quot; \b \t \n \f \r &quot;</span>) = <span class="hljs-string">&quot;&quot;</span><br>StringUtils.trimToEmpty(<span class="hljs-string">&quot; \n\tss \b&quot;</span>) = <span class="hljs-string">&quot;ss&quot;</span><br>StringUtils.trimToEmpty(<span class="hljs-string">&quot; d d dd &quot;</span>) = <span class="hljs-string">&quot;d d dd&quot;</span><br>StringUtils.trimToEmpty(<span class="hljs-string">&quot;dd &quot;</span>) = <span class="hljs-string">&quot;dd&quot;</span><br>StringUtils.trimToEmpty(<span class="hljs-string">&quot; dd &quot;</span>) = <span class="hljs-string">&quot;dd&quot;</span><br> <br> <br><span class="hljs-function">String <span class="hljs-title">strip</span><span class="hljs-params">(String str)</span></span><br><span class="hljs-function"><span class="hljs-comment">//å»æ‰å­—ç¬¦ä¸²ä¸¤ç«¯çš„ç©ºç™½ç¬¦(whitespace)ï¼Œå¦‚æœè¾“å…¥ä¸ºnullåˆ™è¿”å›null(æ³¨æ„å’Œtrim()çš„åŒºåˆ«)ï¼š</span></span><br><span class="hljs-function">StringUtils.<span class="hljs-title">strip</span><span class="hljs-params">(<span class="hljs-keyword">null</span>)</span> </span>= <span class="hljs-keyword">null</span><br>StringUtils.strip(<span class="hljs-string">&quot;&quot;</span>) = <span class="hljs-string">&quot;&quot;</span><br>StringUtils.strip(<span class="hljs-string">&quot; &quot;</span>) = <span class="hljs-string">&quot;&quot;</span><br>StringUtils.strip(<span class="hljs-string">&quot; \b \t \n \f \r &quot;</span>) = <span class="hljs-string">&quot;\b&quot;</span><br>StringUtils.strip(<span class="hljs-string">&quot; \n\tss \b&quot;</span>) = <span class="hljs-string">&quot;ss \b&quot;</span><br>StringUtils.strip(<span class="hljs-string">&quot; d d dd &quot;</span>) = <span class="hljs-string">&quot;d d dd&quot;</span><br>StringUtils.strip(<span class="hljs-string">&quot;dd &quot;</span>) = <span class="hljs-string">&quot;dd&quot;</span><br>StringUtils.strip(<span class="hljs-string">&quot; dd &quot;</span>) = <span class="hljs-string">&quot;dd&quot;</span><br> <br> <br><span class="hljs-function">String <span class="hljs-title">stripToNull</span><span class="hljs-params">(String str)</span></span><br><span class="hljs-function"><span class="hljs-comment">//å»æ‰å­—ç¬¦ä¸²ä¸¤ç«¯çš„ç©ºç™½ç¬¦(whitespace)ï¼Œå¦‚æœå˜ä¸ºnullæˆ–&quot;&quot;ï¼Œåˆ™è¿”å›null(æ³¨æ„å’ŒtrimToNull()çš„åŒºåˆ«)ï¼š</span></span><br><span class="hljs-function">StringUtils.<span class="hljs-title">stripToNull</span><span class="hljs-params">(<span class="hljs-keyword">null</span>)</span> </span>= <span class="hljs-keyword">null</span><br>StringUtils.stripToNull(<span class="hljs-string">&quot;&quot;</span>) = <span class="hljs-keyword">null</span><br>StringUtils.stripToNull(<span class="hljs-string">&quot; &quot;</span>) = <span class="hljs-keyword">null</span><br>StringUtils.stripToNull(<span class="hljs-string">&quot; \b \t \n \f \r &quot;</span>) = <span class="hljs-string">&quot;\b&quot;</span><br>StringUtils.stripToNull(<span class="hljs-string">&quot; \n\tss \b&quot;</span>) = <span class="hljs-string">&quot;ss \b&quot;</span><br>StringUtils.stripToNull(<span class="hljs-string">&quot; d d dd &quot;</span>) = <span class="hljs-string">&quot;d d dd&quot;</span><br>StringUtils.stripToNull(<span class="hljs-string">&quot;dd &quot;</span>) = <span class="hljs-string">&quot;dd&quot;</span><br>StringUtils.stripToNull(<span class="hljs-string">&quot; dd &quot;</span>) = <span class="hljs-string">&quot;dd&quot;</span><br> <br> <br><span class="hljs-function">String <span class="hljs-title">stripToEmpty</span><span class="hljs-params">(String str)</span></span><br><span class="hljs-function"><span class="hljs-comment">//å»æ‰å­—ç¬¦ä¸²ä¸¤ç«¯çš„ç©ºç™½ç¬¦(whitespace)ï¼Œå¦‚æœå˜ä¸ºnullæˆ–&quot;&quot;ï¼Œåˆ™è¿”å›&quot;&quot;(æ³¨æ„å’ŒtrimToEmpty()çš„åŒºåˆ«)ï¼š</span></span><br><span class="hljs-function">StringUtils.<span class="hljs-title">stripToNull</span><span class="hljs-params">(<span class="hljs-keyword">null</span>)</span> </span>= <span class="hljs-string">&quot;&quot;</span><br>StringUtils.stripToNull(<span class="hljs-string">&quot;&quot;</span>) = <span class="hljs-string">&quot;&quot;</span><br>StringUtils.stripToNull(<span class="hljs-string">&quot; &quot;</span>) = <span class="hljs-string">&quot;&quot;</span><br>StringUtils.stripToNull(<span class="hljs-string">&quot; \b \t \n \f \r &quot;</span>) = <span class="hljs-string">&quot;\b&quot;</span><br>StringUtils.stripToNull(<span class="hljs-string">&quot; \n\tss \b&quot;</span>) = <span class="hljs-string">&quot;ss \b&quot;</span><br>StringUtils.stripToNull(<span class="hljs-string">&quot; d d dd &quot;</span>) = <span class="hljs-string">&quot;d d dd&quot;</span><br>StringUtils.stripToNull(<span class="hljs-string">&quot;dd &quot;</span>) = <span class="hljs-string">&quot;dd&quot;</span><br>StringUtils.stripToNull(<span class="hljs-string">&quot; dd &quot;</span>) = <span class="hljs-string">&quot;dd&quot;</span><br> <br></code></pre></td></tr></table></figure><p>javaä¸­æˆ‘ä»¬ä¼šå¸¸ç”¨ä¸€äº›åˆ¤æ–­å¦‚IPã€ç”µå­é‚®ç®±ã€ç”µè¯å·ç çš„æ˜¯ä¸æ˜¯åˆæ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆæ¥åˆ¤æ–­å‘¢ï¼Œç­”æ¡ˆå°±æ˜¯åˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥åˆ¤æ–­äº†ï¼ŒåºŸè¯ä¸å¤šè¯´ï¼Œä¸‹é¢å°±æ˜¯ä¸Šä»£ç ã€‚</p><p>1:åˆ¤æ–­æ˜¯å¦æ˜¯æ­£ç¡®çš„IP</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">         * ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œåˆ¤æ–­</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isIPAddressByRegex</span><span class="hljs-params">(String str)</span> </span>&#123;<br>            String regex = <span class="hljs-string">&quot;\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;&quot;</span>;<br>            <span class="hljs-comment">// åˆ¤æ–­ipåœ°å€æ˜¯å¦ä¸æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</span><br>            <span class="hljs-keyword">if</span> (str.matches(regex)) &#123;<br>                String[] arr = str.split(<span class="hljs-string">&quot;\\.&quot;</span>);<br>                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) &#123;<br>                    <span class="hljs-keyword">int</span> temp = Integer.parseInt(arr[i]);<br>                    <span class="hljs-comment">//å¦‚æœæŸä¸ªæ•°å­—ä¸æ˜¯0åˆ°255ä¹‹é—´çš„æ•° å°±è¿”å›false</span><br>                    <span class="hljs-keyword">if</span> (temp &lt; <span class="hljs-number">0</span> || temp &gt; <span class="hljs-number">255</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>                &#125;<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br></code></pre></td></tr></table></figure><p>2:åˆ¤æ–­æ˜¯å¦æ˜¯æ­£ç¡®çš„é‚®ç®±åœ°å€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">*æ­£åˆ™è¡¨è¾¾å¼éªŒè¯é‚®ç®±</span><br><span class="hljs-comment">*/</span><br> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isEmail</span><span class="hljs-params">(String email)</span> </span>&#123;<br>       <span class="hljs-keyword">if</span> (email == <span class="hljs-keyword">null</span> || <span class="hljs-string">&quot;&quot;</span>.equals(email)) <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>            String regex = <span class="hljs-string">&quot;\\w+([-+.]\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*&quot;</span>;<br>           <span class="hljs-keyword">return</span> email.matches(regex);<br>  &#125;<br></code></pre></td></tr></table></figure><p>3:åˆ¤æ–­æ˜¯å¦æ˜¯æ‰‹æœºå·ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">*æ­£åˆ™è¡¨è¾¾å¼éªŒè¯æ‰‹æœº</span><br><span class="hljs-comment">*/</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">orPhoneNumber</span><span class="hljs-params">(String phoneNumber)</span> </span>&#123;<br>       <span class="hljs-keyword">if</span> (phoneNumber == <span class="hljs-keyword">null</span> || <span class="hljs-string">&quot;&quot;</span>.equals(phoneNumber))<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>           String regex = <span class="hljs-string">&quot;^1[3|4|5|8][0-9]\\d&#123;8&#125;$&quot;</span>;<br>           <span class="hljs-keyword">return</span> phoneNumber.matches(regex);<br>    &#125;<br></code></pre></td></tr></table></figure><p>ä»£ç å¦‚ä¸‹ æ”¶è—å¤‡ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.Arrays;<br><span class="hljs-keyword">import</span> java.util.Date;<br><span class="hljs-keyword">import</span> java.util.GregorianCalendar;<br> <br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å·¥å…·ç±»ï¼Œå®ç°é˜´é˜³å†äº’è½¬</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> luohao</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LunarCalendar</span> </span>&#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ”¯æŒè½¬æ¢çš„æœ€å°å†œå†å¹´ä»½</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> MIN_YEAR = <span class="hljs-number">1900</span>;<br> <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ”¯æŒè½¬æ¢çš„æœ€å¤§å†œå†å¹´ä»½</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> MAX_YEAR = <span class="hljs-number">2099</span>;<br> <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å…¬å†æ¯æœˆå‰çš„å¤©æ•°</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span>[] DAYS_BEFORE_MONTH = &#123;<span class="hljs-number">0</span>, <span class="hljs-number">31</span>, <span class="hljs-number">59</span>, <span class="hljs-number">90</span>, <span class="hljs-number">120</span>, <span class="hljs-number">151</span>, <span class="hljs-number">181</span>, <span class="hljs-number">212</span>, <span class="hljs-number">243</span>, <span class="hljs-number">273</span>, <span class="hljs-number">304</span>, <span class="hljs-number">334</span>, <span class="hljs-number">365</span>&#125;;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç”¨æ¥è¡¨ç¤º1900å¹´åˆ°2099å¹´é—´å†œå†å¹´ä»½çš„ç›¸å…³ä¿¡æ¯ï¼Œå…±24ä½bitçš„16è¿›åˆ¶è¡¨ç¤ºï¼Œå…¶ä¸­ï¼š</span><br><span class="hljs-comment">     * 1. å‰4ä½è¡¨ç¤ºè¯¥å¹´é—°å“ªä¸ªæœˆï¼›</span><br><span class="hljs-comment">     * 2. 5-17ä½è¡¨ç¤ºå†œå†å¹´ä»½13ä¸ªæœˆçš„å¤§å°æœˆåˆ†å¸ƒï¼Œ0è¡¨ç¤ºå°ï¼Œ1è¡¨ç¤ºå¤§ï¼›</span><br><span class="hljs-comment">     * 3. æœ€å7ä½è¡¨ç¤ºå†œå†å¹´é¦–ï¼ˆæ­£æœˆåˆä¸€ï¼‰å¯¹åº”çš„å…¬å†æ—¥æœŸã€‚</span><br><span class="hljs-comment">     * ä»¥2014å¹´çš„æ•°æ®0x955ABFä¸ºä¾‹è¯´æ˜ï¼š</span><br><span class="hljs-comment">     *                  1001 0101 0101 1010 1011 1111</span><br><span class="hljs-comment">     *                é—°ä¹æœˆ                                  å†œå†æ­£æœˆåˆä¸€å¯¹åº”å…¬å†1æœˆ31å·</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span>[] LUNAR_INFO = &#123;<br>            <span class="hljs-comment">/*1900*/</span><br>            <span class="hljs-number">0x84B6BF</span>,<br>            <span class="hljs-comment">/*1901-1910*/</span><br>            <span class="hljs-number">0x04AE53</span>, <span class="hljs-number">0x0A5748</span>, <span class="hljs-number">0x5526BD</span>, <span class="hljs-number">0x0D2650</span>, <span class="hljs-number">0x0D9544</span>, <span class="hljs-number">0x46AAB9</span>, <span class="hljs-number">0x056A4D</span>, <span class="hljs-number">0x09AD42</span>, <span class="hljs-number">0x24AEB6</span>, <span class="hljs-number">0x04AE4A</span>,<br>            <span class="hljs-comment">/*1911-1920*/</span><br>            <span class="hljs-number">0x6A4DBE</span>, <span class="hljs-number">0x0A4D52</span>, <span class="hljs-number">0x0D2546</span>, <span class="hljs-number">0x5D52BA</span>, <span class="hljs-number">0x0B544E</span>, <span class="hljs-number">0x0D6A43</span>, <span class="hljs-number">0x296D37</span>, <span class="hljs-number">0x095B4B</span>, <span class="hljs-number">0x749BC1</span>, <span class="hljs-number">0x049754</span>,<br>            <span class="hljs-comment">/*1921-1930*/</span><br>            <span class="hljs-number">0x0A4B48</span>, <span class="hljs-number">0x5B25BC</span>, <span class="hljs-number">0x06A550</span>, <span class="hljs-number">0x06D445</span>, <span class="hljs-number">0x4ADAB8</span>, <span class="hljs-number">0x02B64D</span>, <span class="hljs-number">0x095742</span>, <span class="hljs-number">0x2497B7</span>, <span class="hljs-number">0x04974A</span>, <span class="hljs-number">0x664B3E</span>,<br>            <span class="hljs-comment">/*1931-1940*/</span><br>            <span class="hljs-number">0x0D4A51</span>, <span class="hljs-number">0x0EA546</span>, <span class="hljs-number">0x56D4BA</span>, <span class="hljs-number">0x05AD4E</span>, <span class="hljs-number">0x02B644</span>, <span class="hljs-number">0x393738</span>, <span class="hljs-number">0x092E4B</span>, <span class="hljs-number">0x7C96BF</span>, <span class="hljs-number">0x0C9553</span>, <span class="hljs-number">0x0D4A48</span>,<br>            <span class="hljs-comment">/*1941-1950*/</span><br>            <span class="hljs-number">0x6DA53B</span>, <span class="hljs-number">0x0B554F</span>, <span class="hljs-number">0x056A45</span>, <span class="hljs-number">0x4AADB9</span>, <span class="hljs-number">0x025D4D</span>, <span class="hljs-number">0x092D42</span>, <span class="hljs-number">0x2C95B6</span>, <span class="hljs-number">0x0A954A</span>, <span class="hljs-number">0x7B4ABD</span>, <span class="hljs-number">0x06CA51</span>,<br>            <span class="hljs-comment">/*1951-1960*/</span><br>            <span class="hljs-number">0x0B5546</span>, <span class="hljs-number">0x555ABB</span>, <span class="hljs-number">0x04DA4E</span>, <span class="hljs-number">0x0A5B43</span>, <span class="hljs-number">0x352BB8</span>, <span class="hljs-number">0x052B4C</span>, <span class="hljs-number">0x8A953F</span>, <span class="hljs-number">0x0E9552</span>, <span class="hljs-number">0x06AA48</span>, <span class="hljs-number">0x6AD53C</span>,<br>            <span class="hljs-comment">/*1961-1970*/</span><br>            <span class="hljs-number">0x0AB54F</span>, <span class="hljs-number">0x04B645</span>, <span class="hljs-number">0x4A5739</span>, <span class="hljs-number">0x0A574D</span>, <span class="hljs-number">0x052642</span>, <span class="hljs-number">0x3E9335</span>, <span class="hljs-number">0x0D9549</span>, <span class="hljs-number">0x75AABE</span>, <span class="hljs-number">0x056A51</span>, <span class="hljs-number">0x096D46</span>,<br>            <span class="hljs-comment">/*1971-1980*/</span><br>            <span class="hljs-number">0x54AEBB</span>, <span class="hljs-number">0x04AD4F</span>, <span class="hljs-number">0x0A4D43</span>, <span class="hljs-number">0x4D26B7</span>, <span class="hljs-number">0x0D254B</span>, <span class="hljs-number">0x8D52BF</span>, <span class="hljs-number">0x0B5452</span>, <span class="hljs-number">0x0B6A47</span>, <span class="hljs-number">0x696D3C</span>, <span class="hljs-number">0x095B50</span>,<br>            <span class="hljs-comment">/*1981-1990*/</span><br>            <span class="hljs-number">0x049B45</span>, <span class="hljs-number">0x4A4BB9</span>, <span class="hljs-number">0x0A4B4D</span>, <span class="hljs-number">0xAB25C2</span>, <span class="hljs-number">0x06A554</span>, <span class="hljs-number">0x06D449</span>, <span class="hljs-number">0x6ADA3D</span>, <span class="hljs-number">0x0AB651</span>, <span class="hljs-number">0x095746</span>, <span class="hljs-number">0x5497BB</span>,<br>            <span class="hljs-comment">/*1991-2000*/</span><br>            <span class="hljs-number">0x04974F</span>, <span class="hljs-number">0x064B44</span>, <span class="hljs-number">0x36A537</span>, <span class="hljs-number">0x0EA54A</span>, <span class="hljs-number">0x86B2BF</span>, <span class="hljs-number">0x05AC53</span>, <span class="hljs-number">0x0AB647</span>, <span class="hljs-number">0x5936BC</span>, <span class="hljs-number">0x092E50</span>, <span class="hljs-number">0x0C9645</span>,<br>            <span class="hljs-comment">/*2001-2010*/</span><br>            <span class="hljs-number">0x4D4AB8</span>, <span class="hljs-number">0x0D4A4C</span>, <span class="hljs-number">0x0DA541</span>, <span class="hljs-number">0x25AAB6</span>, <span class="hljs-number">0x056A49</span>, <span class="hljs-number">0x7AADBD</span>, <span class="hljs-number">0x025D52</span>, <span class="hljs-number">0x092D47</span>, <span class="hljs-number">0x5C95BA</span>, <span class="hljs-number">0x0A954E</span>,<br>            <span class="hljs-comment">/*2011-2020*/</span><br>            <span class="hljs-number">0x0B4A43</span>, <span class="hljs-number">0x4B5537</span>, <span class="hljs-number">0x0AD54A</span>, <span class="hljs-number">0x955ABF</span>, <span class="hljs-number">0x04BA53</span>, <span class="hljs-number">0x0A5B48</span>, <span class="hljs-number">0x652BBC</span>, <span class="hljs-number">0x052B50</span>, <span class="hljs-number">0x0A9345</span>, <span class="hljs-number">0x474AB9</span>,<br>            <span class="hljs-comment">/*2021-2030*/</span><br>            <span class="hljs-number">0x06AA4C</span>, <span class="hljs-number">0x0AD541</span>, <span class="hljs-number">0x24DAB6</span>, <span class="hljs-number">0x04B64A</span>, <span class="hljs-number">0x6a573D</span>, <span class="hljs-number">0x0A4E51</span>, <span class="hljs-number">0x0D2646</span>, <span class="hljs-number">0x5E933A</span>, <span class="hljs-number">0x0D534D</span>, <span class="hljs-number">0x05AA43</span>,<br>            <span class="hljs-comment">/*2031-2040*/</span><br>            <span class="hljs-number">0x36B537</span>, <span class="hljs-number">0x096D4B</span>, <span class="hljs-number">0xB4AEBF</span>, <span class="hljs-number">0x04AD53</span>, <span class="hljs-number">0x0A4D48</span>, <span class="hljs-number">0x6D25BC</span>, <span class="hljs-number">0x0D254F</span>, <span class="hljs-number">0x0D5244</span>, <span class="hljs-number">0x5DAA38</span>, <span class="hljs-number">0x0B5A4C</span>,<br>            <span class="hljs-comment">/*2041-2050*/</span><br>            <span class="hljs-number">0x056D41</span>, <span class="hljs-number">0x24ADB6</span>, <span class="hljs-number">0x049B4A</span>, <span class="hljs-number">0x7A4BBE</span>, <span class="hljs-number">0x0A4B51</span>, <span class="hljs-number">0x0AA546</span>, <span class="hljs-number">0x5B52BA</span>, <span class="hljs-number">0x06D24E</span>, <span class="hljs-number">0x0ADA42</span>, <span class="hljs-number">0x355B37</span>,<br>            <span class="hljs-comment">/*2051-2060*/</span><br>            <span class="hljs-number">0x09374B</span>, <span class="hljs-number">0x8497C1</span>, <span class="hljs-number">0x049753</span>, <span class="hljs-number">0x064B48</span>, <span class="hljs-number">0x66A53C</span>, <span class="hljs-number">0x0EA54F</span>, <span class="hljs-number">0x06AA44</span>, <span class="hljs-number">0x4AB638</span>, <span class="hljs-number">0x0AAE4C</span>, <span class="hljs-number">0x092E42</span>,<br>            <span class="hljs-comment">/*2061-2070*/</span><br>            <span class="hljs-number">0x3C9735</span>, <span class="hljs-number">0x0C9649</span>, <span class="hljs-number">0x7D4ABD</span>, <span class="hljs-number">0x0D4A51</span>, <span class="hljs-number">0x0DA545</span>, <span class="hljs-number">0x55AABA</span>, <span class="hljs-number">0x056A4E</span>, <span class="hljs-number">0x0A6D43</span>, <span class="hljs-number">0x452EB7</span>, <span class="hljs-number">0x052D4B</span>,<br>            <span class="hljs-comment">/*2071-2080*/</span><br>            <span class="hljs-number">0x8A95BF</span>, <span class="hljs-number">0x0A9553</span>, <span class="hljs-number">0x0B4A47</span>, <span class="hljs-number">0x6B553B</span>, <span class="hljs-number">0x0AD54F</span>, <span class="hljs-number">0x055A45</span>, <span class="hljs-number">0x4A5D38</span>, <span class="hljs-number">0x0A5B4C</span>, <span class="hljs-number">0x052B42</span>, <span class="hljs-number">0x3A93B6</span>,<br>            <span class="hljs-comment">/*2081-2090*/</span><br>            <span class="hljs-number">0x069349</span>, <span class="hljs-number">0x7729BD</span>, <span class="hljs-number">0x06AA51</span>, <span class="hljs-number">0x0AD546</span>, <span class="hljs-number">0x54DABA</span>, <span class="hljs-number">0x04B64E</span>, <span class="hljs-number">0x0A5743</span>, <span class="hljs-number">0x452738</span>, <span class="hljs-number">0x0D264A</span>, <span class="hljs-number">0x8E933E</span>,<br>            <span class="hljs-comment">/*2091-2099*/</span><br>            <span class="hljs-number">0x0D5252</span>, <span class="hljs-number">0x0DAA47</span>, <span class="hljs-number">0x66B53B</span>, <span class="hljs-number">0x056D4F</span>, <span class="hljs-number">0x04AE45</span>, <span class="hljs-number">0x4A4EB9</span>, <span class="hljs-number">0x0A4D4C</span>, <span class="hljs-number">0x0D1541</span>, <span class="hljs-number">0x2D92B5</span><br>    &#125;;<br> <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å°†å†œå†æ—¥æœŸè½¬æ¢ä¸ºå…¬å†æ—¥æœŸ</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> year                               å†œå†å¹´ä»½</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> month                              å†œå†æœˆ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> monthDay                   å†œå†æ—¥</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> isLeapMonth        è¯¥æœˆæ˜¯å¦æ˜¯é—°æœˆ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> è¿”å›å†œå†æ—¥æœŸå¯¹åº”çš„å…¬å†æ—¥æœŸï¼Œyear0, month1, day2.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span>[] lunarToSolar(<span class="hljs-keyword">int</span> year, <span class="hljs-keyword">int</span> month, <span class="hljs-keyword">int</span> monthDay, <span class="hljs-keyword">boolean</span> isLeapMonth) &#123;<br> <br>        <span class="hljs-keyword">int</span> dayOffset;<br> <br>        <span class="hljs-keyword">int</span> leapMonth;<br> <br>        <span class="hljs-keyword">int</span> i;<br> <br>        <span class="hljs-keyword">if</span> (year &lt; MIN_YEAR || year &gt; MAX_YEAR || month &lt; <span class="hljs-number">1</span> || month &gt; <span class="hljs-number">12</span><br>                || monthDay &lt; <span class="hljs-number">1</span> || monthDay &gt; <span class="hljs-number">30</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<br>                    <span class="hljs-string">&quot;Illegal lunar date, must be like that:\n\t&quot;</span> +<br>                            <span class="hljs-string">&quot;year : 1900~2099\n\t&quot;</span> +<br>                            <span class="hljs-string">&quot;month : 1~12\n\t&quot;</span> +<br>                            <span class="hljs-string">&quot;day : 1~30&quot;</span>);<br>        &#125;<br>        dayOffset = (LUNAR_INFO[year - MIN_YEAR] &amp; <span class="hljs-number">0x001F</span>) - <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">if</span> (((LUNAR_INFO[year - MIN_YEAR] &amp; <span class="hljs-number">0x0060</span>) &gt;&gt; <span class="hljs-number">5</span>) == <span class="hljs-number">2</span>) &#123;<br>            dayOffset += <span class="hljs-number">31</span>;<br>        &#125;<br>        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">1</span>; i &lt; month; i++) &#123;<br>            <span class="hljs-keyword">if</span> ((LUNAR_INFO[year - MIN_YEAR] &amp; (<span class="hljs-number">0x80000</span> &gt;&gt; (i - <span class="hljs-number">1</span>))) == <span class="hljs-number">0</span>) &#123;<br>                dayOffset += <span class="hljs-number">29</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                dayOffset += <span class="hljs-number">30</span>;<br>            &#125;<br>        &#125;<br>        dayOffset += monthDay;<br> <br>        leapMonth = (LUNAR_INFO[year - MIN_YEAR] &amp; <span class="hljs-number">0xf00000</span>) &gt;&gt; <span class="hljs-number">20</span>;<br> <br>        <span class="hljs-comment">// è¿™ä¸€å¹´æœ‰é—°æœˆ</span><br> <br>        <span class="hljs-keyword">if</span> (leapMonth != <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">if</span> (month &gt; leapMonth || (month == leapMonth &amp;&amp; isLeapMonth)) &#123;<br> <br>                <span class="hljs-keyword">if</span> ((LUNAR_INFO[year - MIN_YEAR] &amp; (<span class="hljs-number">0x80000</span> &gt;&gt; (month - <span class="hljs-number">1</span>))) == <span class="hljs-number">0</span>) &#123;<br>                    dayOffset += <span class="hljs-number">29</span>;<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    dayOffset += <span class="hljs-number">30</span>;<br>                &#125;<br>            &#125;<br>        &#125;<br> <br>        <span class="hljs-keyword">if</span> (dayOffset &gt; <span class="hljs-number">366</span> || (year % <span class="hljs-number">4</span> != <span class="hljs-number">0</span> &amp;&amp; dayOffset &gt; <span class="hljs-number">365</span>)) &#123;<br>            year += <span class="hljs-number">1</span>;<br> <br>            <span class="hljs-keyword">if</span> (year % <span class="hljs-number">4</span> == <span class="hljs-number">1</span>) &#123;<br>                dayOffset -= <span class="hljs-number">366</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                dayOffset -= <span class="hljs-number">365</span>;<br>            &#125;<br>        &#125;<br> <br>        <span class="hljs-keyword">int</span>[] solarInfo = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[<span class="hljs-number">3</span>];<br>        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">13</span>; i++) &#123;<br>            <span class="hljs-keyword">int</span> iPos = DAYS_BEFORE_MONTH[i];<br> <br>            <span class="hljs-keyword">if</span> (year % <span class="hljs-number">4</span> == <span class="hljs-number">0</span> &amp;&amp; i &gt; <span class="hljs-number">2</span>) &#123;<br> <br>                iPos += <span class="hljs-number">1</span>;<br>            &#125;<br> <br>            <span class="hljs-keyword">if</span> (year % <span class="hljs-number">4</span> == <span class="hljs-number">0</span> &amp;&amp; i == <span class="hljs-number">2</span> &amp;&amp; iPos + <span class="hljs-number">1</span> == dayOffset) &#123;<br> <br>                solarInfo[<span class="hljs-number">1</span>] = i;<br> <br>                solarInfo[<span class="hljs-number">2</span>] = dayOffset - <span class="hljs-number">31</span>;<br> <br>                <span class="hljs-keyword">break</span>;<br> <br>            &#125;<br>            <span class="hljs-keyword">if</span> (iPos &gt;= dayOffset) &#123;<br>                solarInfo[<span class="hljs-number">1</span>] = i;<br>                iPos = DAYS_BEFORE_MONTH[i - <span class="hljs-number">1</span>];<br>                <span class="hljs-keyword">if</span> (year % <span class="hljs-number">4</span> == <span class="hljs-number">0</span> &amp;&amp; i &gt; <span class="hljs-number">2</span>) &#123;<br>                    iPos += <span class="hljs-number">1</span>;<br>                &#125;<br>                <span class="hljs-keyword">if</span> (dayOffset &gt; iPos) &#123;<br>                    solarInfo[<span class="hljs-number">2</span>] = dayOffset - iPos;<br>                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (dayOffset == iPos) &#123;<br>                    <span class="hljs-keyword">if</span> (year % <span class="hljs-number">4</span> == <span class="hljs-number">0</span> &amp;&amp; i == <span class="hljs-number">2</span>) &#123;<br>                        solarInfo[<span class="hljs-number">2</span>] = DAYS_BEFORE_MONTH[i] - DAYS_BEFORE_MONTH[i - <span class="hljs-number">1</span>] + <span class="hljs-number">1</span>;<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        solarInfo[<span class="hljs-number">2</span>] = DAYS_BEFORE_MONTH[i] - DAYS_BEFORE_MONTH[i - <span class="hljs-number">1</span>];<br>                    &#125;<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    solarInfo[<span class="hljs-number">2</span>] = dayOffset;<br>                &#125;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>        solarInfo[<span class="hljs-number">0</span>] = year;<br>        <span class="hljs-keyword">return</span> solarInfo;<br>    &#125;<br> <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å°†å…¬å†æ—¥æœŸè½¬æ¢ä¸ºå†œå†æ—¥æœŸï¼Œä¸”æ ‡è¯†æ˜¯å¦æ˜¯é—°æœˆ</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> year</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> month</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> monthDay</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> è¿”å›å…¬å†æ—¥æœŸå¯¹åº”çš„å†œå†æ—¥æœŸï¼Œyear0ï¼Œmonth1ï¼Œday2ï¼Œleap3</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span>[] solarToLunar(<span class="hljs-keyword">int</span> year, <span class="hljs-keyword">int</span> month, <span class="hljs-keyword">int</span> monthDay) &#123;<br>        <span class="hljs-keyword">int</span>[] lunarDate = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[<span class="hljs-number">4</span>];<br>        Date baseDate = <span class="hljs-keyword">new</span> GregorianCalendar(<span class="hljs-number">1900</span>, <span class="hljs-number">0</span>, <span class="hljs-number">31</span>).getTime();<br>        Date objDate = <span class="hljs-keyword">new</span> GregorianCalendar(year, month - <span class="hljs-number">1</span>, monthDay).getTime();<br>        <span class="hljs-keyword">int</span> offset = (<span class="hljs-keyword">int</span>) ((objDate.getTime() - baseDate.getTime()) / <span class="hljs-number">86400000L</span>);<br>        <span class="hljs-comment">// ç”¨offsetå‡å»æ¯å†œå†å¹´çš„å¤©æ•°è®¡ç®—å½“å¤©æ˜¯å†œå†ç¬¬å‡ å¤©</span><br>        <span class="hljs-comment">// iYearæœ€ç»ˆç»“æœæ˜¯å†œå†çš„å¹´ä»½, offsetæ˜¯å½“å¹´çš„ç¬¬å‡ å¤©</span><br>        <span class="hljs-keyword">int</span> iYear, daysOfYear = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (iYear = MIN_YEAR; iYear &lt;= MAX_YEAR &amp;&amp; offset &gt; <span class="hljs-number">0</span>; iYear++) &#123;<br>            daysOfYear = daysInLunarYear(iYear);<br>            offset -= daysOfYear;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (offset &lt; <span class="hljs-number">0</span>) &#123;<br>            offset += daysOfYear;<br>            iYear--;<br>        &#125;<br>        <span class="hljs-comment">// å†œå†å¹´ä»½</span><br>        lunarDate[<span class="hljs-number">0</span>] = iYear;<br>        <span class="hljs-keyword">int</span> leapMonth = leapMonth(iYear);<br>        <span class="hljs-comment">// é—°å“ªä¸ªæœˆ,1-12</span><br>        <span class="hljs-keyword">boolean</span> isLeap = <span class="hljs-keyword">false</span>;<br>        <span class="hljs-comment">// ç”¨å½“å¹´çš„å¤©æ•°offset,é€ä¸ªå‡å»æ¯æœˆï¼ˆå†œå†ï¼‰çš„å¤©æ•°ï¼Œæ±‚å‡ºå½“å¤©æ˜¯æœ¬æœˆçš„ç¬¬å‡ å¤©</span><br>        <span class="hljs-keyword">int</span> iMonth, daysOfMonth = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (iMonth = <span class="hljs-number">1</span>; iMonth &lt;= <span class="hljs-number">13</span> &amp;&amp; offset &gt; <span class="hljs-number">0</span>; iMonth++) &#123;<br>            daysOfMonth = daysInLunarMonth(iYear, iMonth);<br>            offset -= daysOfMonth;<br>        &#125;<br>        <span class="hljs-comment">// å½“å‰æœˆè¶…è¿‡é—°æœˆï¼Œè¦æ ¡æ­£</span><br>        <span class="hljs-keyword">if</span> (leapMonth != <span class="hljs-number">0</span> &amp;&amp; iMonth &gt; leapMonth) &#123;<br>            --iMonth;<br>            <span class="hljs-keyword">if</span> (iMonth == leapMonth) &#123;<br>                isLeap = <span class="hljs-keyword">true</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">// offsetå°äº0æ—¶ï¼Œä¹Ÿè¦æ ¡æ­£</span><br>        <span class="hljs-keyword">if</span> (offset &lt; <span class="hljs-number">0</span>) &#123;<br>            offset += daysOfMonth;<br>            --iMonth;<br>        &#125;<br>        lunarDate[<span class="hljs-number">1</span>] = iMonth;<br>        lunarDate[<span class="hljs-number">2</span>] = offset + <span class="hljs-number">1</span>;<br>        lunarDate[<span class="hljs-number">3</span>] = isLeap ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">return</span> lunarDate;<br>    &#125;<br> <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä¼ å›å†œå†yearå¹´monthæœˆçš„æ€»å¤©æ•°</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> year   è¦è®¡ç®—çš„å¹´ä»½</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> month        è¦è®¡ç®—çš„æœˆ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> ä¼ å›å¤©æ•°</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">final</span> <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">daysInMonth</span><span class="hljs-params">(<span class="hljs-keyword">int</span> year, <span class="hljs-keyword">int</span> month)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> daysInMonth(year, month, <span class="hljs-keyword">false</span>);<br>    &#125;<br> <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä¼ å›å†œå†yearå¹´monthæœˆçš„æ€»å¤©æ•°</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> year   è¦è®¡ç®—çš„å¹´ä»½</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> month        è¦è®¡ç®—çš„æœˆ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> leap   å½“æœˆæ˜¯å¦æ˜¯é—°æœˆ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> ä¼ å›å¤©æ•°ï¼Œå¦‚æœé—°æœˆæ˜¯é”™è¯¯çš„ï¼Œè¿”å›0.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> <span class="hljs-title">daysInMonth</span><span class="hljs-params">(<span class="hljs-keyword">int</span> year, <span class="hljs-keyword">int</span> month, <span class="hljs-keyword">boolean</span> leap)</span> </span>&#123;<br>        <span class="hljs-keyword">int</span> leapMonth = leapMonth(year);<br>        <span class="hljs-keyword">int</span> offset = <span class="hljs-number">0</span>;<br>        <span class="hljs-comment">// å¦‚æœæœ¬å¹´æœ‰é—°æœˆä¸”monthå¤§äºé—°æœˆæ—¶ï¼Œéœ€è¦æ ¡æ­£</span><br>        <span class="hljs-keyword">if</span> (leapMonth != <span class="hljs-number">0</span> &amp;&amp; month &gt; leapMonth) &#123;<br>            offset = <span class="hljs-number">1</span>;<br>        &#125;<br>        <span class="hljs-comment">// ä¸è€ƒè™‘é—°æœˆ</span><br>        <span class="hljs-keyword">if</span> (!leap) &#123;<br>            <span class="hljs-keyword">return</span> daysInLunarMonth(year, month + offset);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// ä¼ å…¥çš„é—°æœˆæ˜¯æ­£ç¡®çš„æœˆä»½</span><br>            <span class="hljs-keyword">if</span> (leapMonth != <span class="hljs-number">0</span> &amp;&amp; leapMonth == month) &#123;<br>                <span class="hljs-keyword">return</span> daysInLunarMonth(year, month + <span class="hljs-number">1</span>);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br> <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä¼ å›å†œå† yearå¹´çš„æ€»å¤©æ•°</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> year å°†è¦è®¡ç®—çš„å¹´ä»½</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> è¿”å›ä¼ å…¥å¹´ä»½çš„æ€»å¤©æ•°</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">daysInLunarYear</span><span class="hljs-params">(<span class="hljs-keyword">int</span> year)</span> </span>&#123;<br>        <span class="hljs-keyword">int</span> i, sum = <span class="hljs-number">348</span>;<br>        <span class="hljs-keyword">if</span> (leapMonth(year) != <span class="hljs-number">0</span>) &#123;<br>            sum = <span class="hljs-number">377</span>;<br>        &#125;<br>        <span class="hljs-keyword">int</span> monthInfo = LUNAR_INFO[year - MIN_YEAR] &amp; <span class="hljs-number">0x0FFF80</span>;<br>        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0x80000</span>; i &gt; <span class="hljs-number">0x7</span>; i &gt;&gt;= <span class="hljs-number">1</span>) &#123;<br>            <span class="hljs-keyword">if</span> ((monthInfo &amp; i) != <span class="hljs-number">0</span>) &#123;<br>                sum += <span class="hljs-number">1</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> sum;<br>    &#125;<br> <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä¼ å›å†œå† yearå¹´monthæœˆçš„æ€»å¤©æ•°ï¼Œæ€»å…±æœ‰13ä¸ªæœˆåŒ…æ‹¬é—°æœˆ</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> year  å°†è¦è®¡ç®—çš„å¹´ä»½</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> month å°†è¦è®¡ç®—çš„æœˆä»½</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> ä¼ å›å†œå† yearå¹´monthæœˆçš„æ€»å¤©æ•°</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">daysInLunarMonth</span><span class="hljs-params">(<span class="hljs-keyword">int</span> year, <span class="hljs-keyword">int</span> month)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> ((LUNAR_INFO[year - MIN_YEAR] &amp; (<span class="hljs-number">0x100000</span> &gt;&gt; month)) == <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">29</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">30</span>;<br>        &#125;<br>    &#125;<br> <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä¼ å›å†œå† yearå¹´é—°å“ªä¸ªæœˆ 1-12 , æ²¡é—°ä¼ å› 0</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> year å°†è¦è®¡ç®—çš„å¹´ä»½</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> ä¼ å›å†œå† yearå¹´é—°å“ªä¸ªæœˆ1-12, æ²¡é—°ä¼ å› 0</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">leapMonth</span><span class="hljs-params">(<span class="hljs-keyword">int</span> year)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> ((LUNAR_INFO[year - MIN_YEAR] &amp; <span class="hljs-number">0xF00000</span>)) &gt;&gt; <span class="hljs-number">20</span>;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        System.out.println(Arrays.toString(solarToLunar(<span class="hljs-number">2019</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>)));<br>    &#125;<br>&#125;<br> <br></code></pre></td></tr></table></figure><p>åœ¨åšé¡¹ç›®çš„æ—¶å€™é‡åˆ°ä¸€ä¸ªä¸šåŠ¡éœ€è¦å¯¹å›¾ç‰‡è¿›è¡Œæ—‹è½¬ï¼Œäºæ˜¯æ‰¾åˆ°ä¸€ä¸ªå·¥å…·ç±»ï¼Œäº²æµ‹æœ‰æ•ˆï¼›åœ¨æ­¤ä¸å¤§å®¶å…±äº«ï¼Œéœ€è¦ç”¨æ—¶å¯ä»¥ç›´æ¥ç”¨å“ˆï¼ ä¸€ã€æ—‹è½¬å·¥å…·ç±»ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> zh.test.utils;<br> <br><span class="hljs-keyword">import</span> java.awt.*;<br><span class="hljs-keyword">import</span> java.awt.image.BufferedImage;<br> <br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å›¾ç‰‡æ—‹è½¬å·¥å…·ç±»</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RotateImage</span> </span>&#123;<br> <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¯¹å›¾ç‰‡è¿›è¡Œæ—‹è½¬</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> src   è¢«æ—‹è½¬å›¾ç‰‡</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> angel æ—‹è½¬è§’åº¦</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> æ—‹è½¬åçš„å›¾ç‰‡</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> BufferedImage <span class="hljs-title">Rotate</span><span class="hljs-params">(Image src, <span class="hljs-keyword">int</span> angel)</span> </span>&#123;<br>        <span class="hljs-keyword">int</span> src_width = src.getWidth(<span class="hljs-keyword">null</span>);<br>        <span class="hljs-keyword">int</span> src_height = src.getHeight(<span class="hljs-keyword">null</span>);<br>        <span class="hljs-comment">// è®¡ç®—æ—‹è½¬åå›¾ç‰‡çš„å°ºå¯¸</span><br>        Rectangle rect_des = CalcRotatedSize(<span class="hljs-keyword">new</span> Rectangle(<span class="hljs-keyword">new</span> Dimension(<br>                src_width, src_height)), angel);<br>        BufferedImage res = <span class="hljs-keyword">null</span>;<br>        res = <span class="hljs-keyword">new</span> BufferedImage(rect_des.width, rect_des.height,<br>                BufferedImage.TYPE_INT_RGB);<br>        Graphics2D g2 = res.createGraphics();<br>        <span class="hljs-comment">// è¿›è¡Œè½¬æ¢</span><br>        g2.translate((rect_des.width - src_width) / <span class="hljs-number">2</span>,<br>                (rect_des.height - src_height) / <span class="hljs-number">2</span>);<br>        g2.rotate(Math.toRadians(angel), src_width / <span class="hljs-number">2</span>, src_height / <span class="hljs-number">2</span>);<br> <br>        g2.drawImage(src, <span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>);<br>        <span class="hljs-keyword">return</span> res;<br>    &#125;<br> <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è®¡ç®—æ—‹è½¬åçš„å›¾ç‰‡</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> src   è¢«æ—‹è½¬çš„å›¾ç‰‡</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> angel æ—‹è½¬è§’åº¦</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> æ—‹è½¬åçš„å›¾ç‰‡</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Rectangle <span class="hljs-title">CalcRotatedSize</span><span class="hljs-params">(Rectangle src, <span class="hljs-keyword">int</span> angel)</span> </span>&#123;<br>        <span class="hljs-comment">// å¦‚æœæ—‹è½¬çš„è§’åº¦å¤§äº90åº¦åšç›¸åº”çš„è½¬æ¢</span><br>        <span class="hljs-keyword">if</span> (angel &gt;= <span class="hljs-number">90</span>) &#123;<br>            <span class="hljs-keyword">if</span> (angel / <span class="hljs-number">90</span> % <span class="hljs-number">2</span> == <span class="hljs-number">1</span>) &#123;<br>                <span class="hljs-keyword">int</span> temp = src.height;<br>                src.height = src.width;<br>                src.width = temp;<br>            &#125;<br>            angel = angel % <span class="hljs-number">90</span>;<br>        &#125;<br> <br>        <span class="hljs-keyword">double</span> r = Math.sqrt(src.height * src.height + src.width * src.width) / <span class="hljs-number">2</span>;<br>        <span class="hljs-keyword">double</span> len = <span class="hljs-number">2</span> * Math.sin(Math.toRadians(angel) / <span class="hljs-number">2</span>) * r;<br>        <span class="hljs-keyword">double</span> angel_alpha = (Math.PI - Math.toRadians(angel)) / <span class="hljs-number">2</span>;<br>        <span class="hljs-keyword">double</span> angel_dalta_width = Math.atan((<span class="hljs-keyword">double</span>) src.height / src.width);<br>        <span class="hljs-keyword">double</span> angel_dalta_height = Math.atan((<span class="hljs-keyword">double</span>) src.width / src.height);<br> <br>        <span class="hljs-keyword">int</span> len_dalta_width = (<span class="hljs-keyword">int</span>) (len * Math.cos(Math.PI - angel_alpha<br>                - angel_dalta_width));<br>        <span class="hljs-keyword">int</span> len_dalta_height = (<span class="hljs-keyword">int</span>) (len * Math.cos(Math.PI - angel_alpha<br>                - angel_dalta_height));<br>        <span class="hljs-keyword">int</span> des_width = src.width + len_dalta_width * <span class="hljs-number">2</span>;<br>        <span class="hljs-keyword">int</span> des_height = src.height + len_dalta_height * <span class="hljs-number">2</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Rectangle(<span class="hljs-keyword">new</span> Dimension(des_width, des_height));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>äºŒã€è°ƒç”¨å·¥å…·ç±»çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> zh.test.controller;<br> <br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><span class="hljs-keyword">import</span> org.springframework.web.multipart.MultipartFile;<br><span class="hljs-keyword">import</span> zh.test.utils.RotateImage;<br> <br><span class="hljs-keyword">import</span> javax.imageio.ImageIO;<br><span class="hljs-keyword">import</span> java.awt.image.BufferedImage;<br><span class="hljs-keyword">import</span> java.io.File;<br> <br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æµ‹è¯•å›¾ç‰‡æ—‹è½¬</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(value = &quot;/test&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestController</span> </span>&#123;<br> <br>    <span class="hljs-meta">@RequestMapping(method = RequestMethod.POST)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testImgRotate</span><span class="hljs-params">(MultipartFile multipartFile)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        BufferedImage src = ImageIO.read(multipartFile.getInputStream());<br>        <span class="hljs-comment">//é¡ºæ—¶é’ˆæ—‹è½¬90åº¦</span><br>        BufferedImage des1 = RotateImage.Rotate(src, <span class="hljs-number">90</span>);<br>        ImageIO.write(des1, <span class="hljs-string">&quot;jpg&quot;</span>, <span class="hljs-keyword">new</span> File(<span class="hljs-string">&quot;e:/90.jpg&quot;</span>));<br>        <span class="hljs-comment">//é¡ºæ—¶é’ˆæ—‹è½¬180åº¦</span><br>        BufferedImage des2 = RotateImage.Rotate(src, <span class="hljs-number">180</span>);<br>        ImageIO.write(des2, <span class="hljs-string">&quot;jpg&quot;</span>, <span class="hljs-keyword">new</span> File(<span class="hljs-string">&quot;c:/180.jpg&quot;</span>));<br>        <span class="hljs-comment">//é¡ºæ—¶é’ˆæ—‹è½¬270åº¦</span><br>        BufferedImage des3 = RotateImage.Rotate(src, <span class="hljs-number">270</span>);<br>        ImageIO.write(des3, <span class="hljs-string">&quot;jpg&quot;</span>, <span class="hljs-keyword">new</span> File(<span class="hljs-string">&quot;c:/270.jpg&quot;</span>));<br> <br>    &#125;<br> <br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>å·¥å…·</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ideaå–æ¶ˆè­¦å‘Š</title>
    <link href="/blog/2021/01/11/idea%E5%8F%96%E6%B6%88%E8%AD%A6%E5%91%8A/"/>
    <url>/blog/2021/01/11/idea%E5%8F%96%E6%B6%88%E8%AD%A6%E5%91%8A/</url>
    
    <content type="html"><![CDATA[<p>å³è¾¹é‚£äº”é¢œå…­è‰²çš„ä¸€å †ä¸œè¥¿ æ˜¯è­¦å‘Š å¦‚æœæ˜¯æŠ¥é”™è¿˜æ˜¯ä¼šæé†’çš„å“¦<br>æ‰“å¼€è®¾ç½® æœç´¢ inspections<br><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/BC0B365A-0200-45E5-B6E9-0DD5A2E557DA_1564123100369.png" alt="BC0B365A-0200-45E5-B6E9-0DD5A2E557DA"></p><h1 id="javaåˆ¤æ–­ä¸­æ–‡æ±‰å­—å·¥å…·ç±»"><a href="#javaåˆ¤æ–­ä¸­æ–‡æ±‰å­—å·¥å…·ç±»" class="headerlink" title="javaåˆ¤æ–­ä¸­æ–‡æ±‰å­—å·¥å…·ç±»"></a>javaåˆ¤æ–­ä¸­æ–‡æ±‰å­—å·¥å…·ç±»</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.wlkj.util;<br><br><span class="hljs-keyword">import</span> java.util.regex.Matcher;<br><span class="hljs-keyword">import</span> java.util.regex.Pattern;<br><br><span class="hljs-keyword">import</span> net.sourceforge.pinyin4j.PinyinHelper;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ChineseUtil</span> </span>&#123;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * åˆ¤æ–­ä¸­æ–‡å­—ç¬¦</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> c</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isChinese</span><span class="hljs-params">(<span class="hljs-keyword">char</span> c)</span></span>&#123;<br>    Character.UnicodeBlock ub = Character.UnicodeBlock.of(c);<br>    <span class="hljs-keyword">if</span>(ub == Character.UnicodeBlock.CJK_UNIFIED_IDEOGRAPHS ||<br>       ub == Character.UnicodeBlock.CJK_COMPATIBILITY_IDEOGRAPHS ||<br>       ub == Character.UnicodeBlock.CJK_UNIFIED_IDEOGRAPHS_EXTENSION_A ||<br>       ub == Character.UnicodeBlock.CJK_UNIFIED_IDEOGRAPHS_EXTENSION_B ||<br>       ub == Character.UnicodeBlock.CJK_SYMBOLS_AND_PUNCTUATION ||<br>       ub == Character.UnicodeBlock.HALFWIDTH_AND_FULLWIDTH_FORMS ||<br>       ub == Character.UnicodeBlock.GENERAL_PUNCTUATION)&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>&#125;<br> <br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * åŒ…å«ä¸­æ–‡å­—ç¬¦</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> str</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">containsChinese</span><span class="hljs-params">(String str)</span></span>&#123;<br>    <span class="hljs-keyword">char</span>[] ch = str.toCharArray();<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">char</span> c : ch)&#123;<br>        <span class="hljs-keyword">if</span>(isChinese(c))&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ˜¯å¦ä¸­æ–‡ï¼ˆéæ ‡ç‚¹ç¬¦å·ï¼‰</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> c</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isChineseWord</span><span class="hljs-params">(<span class="hljs-keyword">char</span> c)</span> </span>&#123;<br><span class="hljs-keyword">char</span>[] ch = &#123;c&#125;;<br>Pattern pattern = Pattern.compile(<span class="hljs-string">&quot;([\u4E00-\uFA29]|[\uE7C7-\uE7F3])&quot;</span>);<br>Matcher matcher = pattern.matcher(<span class="hljs-keyword">new</span> String(ch));<br><span class="hljs-keyword">return</span> matcher.find();<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * åŒ…å«æ±‰å­—ï¼ˆéæ ‡ç‚¹ç¬¦å·ï¼‰</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> name</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">containsChineseWords</span><span class="hljs-params">(String name)</span> </span>&#123;<br>Pattern pattern = Pattern.compile(<span class="hljs-string">&quot;^.*([\u4E00-\uFA29]|[\uE7C7-\uE7F3])+.*$&quot;</span>);<br>Matcher matcher = pattern.matcher(name);<br><span class="hljs-keyword">return</span> matcher.find();<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è½¬æ¢æˆæ‹¼éŸ³å­—æ¯ç¼©å†™</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> str</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> abbr</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">toPinyinAbbr</span><span class="hljs-params">(String str)</span></span>&#123;<br>String abbr = <span class="hljs-string">&quot;&quot;</span>;<br><span class="hljs-keyword">for</span>(<span class="hljs-keyword">char</span> c : str.toCharArray())&#123;<br><span class="hljs-keyword">if</span>(ChineseUtil.isChineseWord(c))&#123;<br>abbr += PinyinHelper.toHanyuPinyinStringArray(c)[<span class="hljs-number">0</span>].substring(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>).toUpperCase();<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> abbr;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>System.out.println(isChinese(<span class="hljs-string">&#x27;ã‚&#x27;</span>));<span class="hljs-comment">// false</span><br>System.out.println(isChineseWord(<span class="hljs-string">&#x27;æˆ‘&#x27;</span>));<span class="hljs-comment">// true</span><br>System.out.println(containsChinese(<span class="hljs-string">&quot;aæˆ‘b&quot;</span>));<span class="hljs-comment">// true</span><br>System.out.println(containsChineseWords(<span class="hljs-string">&quot;aï¼Œb&quot;</span>)); <span class="hljs-comment">// false</span><br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>å·¥å…·</tag>
      
      <tag>idea</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Mysqlç³»ç»ŸçŸ¥è¯†æ¢³ç†</title>
    <link href="/blog/2021/01/10/Mysql%E7%B3%BB%E7%BB%9F%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/"/>
    <url>/blog/2021/01/10/Mysql%E7%B3%BB%E7%BB%9F%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/</url>
    
    <content type="html"><![CDATA[<p>1 æ•°æ®åº“åˆ†ç±»</p><p>ã€€ã€€MySQL Oracle redis</p><p>2 MySQL å­˜å‚¨å¼•æ“æœ‰å“ªäº›</p><p>ã€€ã€€ENGINE=InnoDB æä¾›äº‹åŠ¡å®‰å…¨è¡¨ï¼Œæ”¯æŒå¤–é”®ã€‚</p><p>ã€€ã€€MyISAM</p><p>ã€€ã€€Memoryæ•°æ®å­˜å…¥å†…å­˜ä¸­ï¼Œå¦‚æœå†…å­˜å‡ºç°å¼‚å¸¸æˆ–äº‹é‡å¯å…³æœºï¼Œæ‰€æœ‰æ•°æ®éƒ½ä¼šæ¶ˆå¤±</p><p>3 äº‹åŠ¡</p><p>ã€€ã€€æ¦‚å¿µï¼šé€»è¾‘ä¸Šçš„ä¸€ç»„sqlè¯­å¥ï¼Œç»„æˆè¿™ç»„æ“ä½œçš„sqlè¯­å¥ï¼Œè¦ä¹ˆæˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥ã€‚</p><p>3.1 äº‹åŠ¡å››å¤§ç‰¹æ€§ACID</p><p>ã€€ã€€åŸå­æ€§(Atomicity)ï¼šäº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å•ä½ï¼Œäº‹åŠ¡ä¸­çš„sqlè¯­å¥ï¼Œè¦ä¹ˆå…¨éƒ½å‘ç”Ÿï¼Œè¦ä¹ˆéƒ½ä¸å‘ç”Ÿã€‚</p><p>ã€€ã€€ä¸€è‡´æ€§(Consistency)ï¼šäº‹åŠ¡å‘ç”Ÿå‰åï¼Œæ•°æ®çš„å®Œæ•´æ€§å¿…é¡»ä¿æŒä¸€è‡´ã€‚</p><p>ã€€ã€€éš”ç¦»æ€§(Isolation)ï¼šå½“å¹¶å‘è®¿é—®æ•°æ®åº“çš„æ—¶å€™ï¼Œä¸€ä¸ªæ­£åœ¨æ‰§è¡Œçš„äº‹åŠ¡åœ¨æ‰§è¡Œå®Œå‰ï¼Œå¯¹äºå…¶ä»–çš„ä¼šè¯æ˜¯ä¸å¯è§çš„ï¼Œå¤šä¸ªå¹¶å‘çš„äº‹åŠ¡ä¹‹é—´çš„æ•°æ®åº“ç›¸äº’éš”ç¦»ã€‚</p><p>ã€€ã€€æŒä¹…æ€§(Durability)ï¼šä¸€ä¸ªäº‹åŠ¡ä¸€æ—¦è¢«æäº¤ï¼Œæ•°æ®åº“ä¸­çš„æ•°æ®æ”¹å˜å°±æ˜¯æŒä¹…æ€§çš„ã€‚å¦‚æœå‡ºäº†é”™è¯¯ä¹Ÿä¸èƒ½æ’¤é”€ã€‚</p><p>3.2 äº‹åŠ¡éš”ç¦»çº§åˆ«</p><p>ã€€ã€€å¯¹äºåŒæ—¶è¿è¡Œçš„å‡ ä¸ªäº‹åŠ¡ï¼Œå½“è¿™äº›äº‹åŠ¡åŒæ—¶è®¿é—®æ•°æ®åº“æ—¶ï¼Œå¦‚æœä¸é‡‡å–éš”ç¦»æªæ–½å°±ä¼šå¯¼è‡´å„ç§å¹¶å‘é—®é¢˜ã€‚ç”±æ­¤å¼•å‡ºéš”ç¦»çº§åˆ«çš„æ¦‚å¿µï¼Œæ€»æœ‰4ä¸ªï¼Œç”±ä½åˆ°é«˜ï¼Œå¯é€æ­¥è§£å†³è„è¯»ï¼Œä¸å¯é‡å¤è¯»ï¼Œå¹»è¯»ç­‰é—®é¢˜ã€‚</p><p>ã€€ã€€Default springï¼šé»˜è®¤éš”ç¦»çº§åˆ«ï¼Œä½¿ç”¨æ•°æ®åº“é»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«</p><p>ã€€ã€€read_uncommitiedï¼šè¯»æœªæäº¤ï¼Œä¸€ä¸ªä¼šè¯å¯ä»¥è¯»å–å…¶ä»–äº‹åŠ¡æœªæäº¤çš„æ›´æ–°ç»“æœï¼Œä¸€æ—¦è¿™ä¸ªäº‹åŠ¡è¢«å›æ»šäº†ï¼Œå¯¼è‡´è¿™ä¸ªä¼šè¯çš„ç»“æœä¸æ­£ç¡®äº†ã€‚</p><p>ã€€ã€€read_commitedï¼šè¯»å·²æäº¤ï¼Œä¸€ä¸ªä¼šè¯åªèƒ½è¯»å–å…¶ä»–äº‹åŠ¡å·²ç»æäº¤çš„æ›´æ–°ç»“æœï¼Œå¦åˆ™ï¼Œç­‰å¾…ã€‚ä½†æ˜¯å…¶ä»–ä¼šè¯å¯ä»¥ä¿®æ”¹è¿™ä¸ªäº‹åŠ¡ä¸­è¢«è¯»å–çš„è®°å½•ï¼Œè€Œä¸å¿…ç­‰å¾…äº‹åŠ¡ç»“æŸã€‚å¯¼è‡´äº†ï¼Œä¸€ä¸ªäº‹åŠ¡ä¸­ä¸¤ä¸ªç›¸åŒçš„è¯»å–æ“ä½œï¼Œå…¶ç»“æœå¯èƒ½ä¸åŒã€‚</p><p>ã€€ã€€repeatable_readï¼šé‡å¤è¯»å–ï¼Œåœ¨æ•°æ®è¯»å–å‡ºæ¥ååŠ é”ï¼Œç›´åˆ°è¿™ä¸ªäº‹åŠ¡æ‰§è¡Œç»“æŸã€‚</p><p>ã€€ã€€serlalizableï¼šä¸²è¡ŒåŒ–ï¼Œä¸ç®¡å¤šå°‘äº‹åŠ¡ï¼Œåªæœ‰æ‰§è¡Œå®Œä¸€ä¸ªäº‹åŠ¡çš„æ‰€æœ‰å­äº‹åŠ¡åï¼Œæ‰å¯ä»¥æ‰§è¡Œå¦å¤–ä¸€ä¸ªäº‹åŠ¡é‡Œçš„æ‰€æœ‰å­äº‹åŠ¡ã€‚</p><p>3.3 æ•°æ®åº“è®¾ç½®çš„éš”ç¦»çº§åˆ«read_commited</p><p>ã€€ã€€å¯ä»¥é¿å…è„è¯»ï¼Œä¸”å…·æœ‰è¾ƒå¥½çš„å¹¶å‘æ€§èƒ½ï¼Œå¯èƒ½å‡ºç°çš„é—®é¢˜åœºæ™¯ï¼Œå¯ä»¥ä½¿ç”¨æ‚²è§‚é”æˆ–ä¹è§‚é”æ§åˆ¶ã€‚</p><p>4 æ‚²è§‚é”å’Œä¹è§‚é”ï¼Œä»¥åŠä½¿ç”¨åœºæ™¯</p><p>ã€€ã€€æ‚²è§‚æ’ä»–åï¼Œä¸èƒ½ä¿®æ”¹æ•°æ®ï¼Œå³åœ¨æ•°æ®è¢«æ“ä½œçš„æ—¶å€™ï¼Œé”å®šæ•°æ®ä¸è¢«è®¿é—®ã€‚</p><p>ã€€ã€€ä¹è§‚æ’ä»–åï¼Œå¯ä»¥ä¿®æ”¹æ•°æ®ï¼Œå³å‡è®¾æ•°æ®ä¸€èˆ¬æƒ…å†µä¸‹ä¸ä¼šé€ æˆå†²çªã€‚</p><p>5 å¦‚ä½•å®ç°åˆ†é¡µ</p><p>ã€€ã€€ä½¿ç”¨sqlè¯­å¥å…³é”®å­—limit</p><p>6 æ•°æ®åº“ä¸‰å¤§èŒƒå¼</p><p>1NFï¼šå¯¹å±æ€§çš„åŸå­æ€§çº¦æŸï¼Œè¦æ±‚å±æ€§å…·æœ‰åŸå­æ€§ï¼Œä¸å¯å†åˆ†è§£ã€‚</p><p>2NFï¼šå¯¹è®°å½•çš„æƒŸä¸€æ€§çº¦æŸï¼Œè¦æ±‚è®°å½•æœ‰æƒŸä¸€æ ‡è¯†ï¼Œå³å®ä½“çš„æƒŸä¸€æ€§ã€‚</p><p>3NFï¼šå¯¹å­—æ®µå†—ä½™æ€§çš„çº¦æŸï¼Œå³ä»»ä½•å­—æ®µä¸èƒ½ç”±å…¶ä»–å­—æ®µæ´¾ç”Ÿå‡ºæ¥ï¼Œå®ƒè¦æ±‚å­—æ®µæ²¡æœ‰å†—ä½™ã€‚</p><p>7 Mysqlæœ‰å“ªäº›ç´¢å¼•ï¼šfulltextã€hashã€btreeã€rtree</p><p>8 ä»€ä¹ˆæ—¶å€™è¯¥å»ºç«‹ç´¢å¼•</p><p>ã€€ã€€1ï¼‰è¡¨çš„ä¸»é”®ã€å¤–é”®å¿…é¡»æœ‰ç´¢å¼•</p><p>ã€€ã€€2ï¼‰æ•°æ®é‡è¶…è¿‡300çš„è¡¨åº”è¯¥æœ‰ç´¢å¼•</p><p>ã€€ã€€3ï¼‰ç»å¸¸ä¸å…¶ä»–è¡¨è¿›è¡Œè¿æ¥çš„è¡¨ï¼Œåœ¨è¿æ¥å­—æ®µä¸Šåº”è¯¥å»ºç«‹ç´¢å¼•</p><p>ã€€ã€€4ï¼‰ç»å¸¸å‡ºç°åœ¨whereå­å¥ä¸­çš„å­—æ®µï¼Œç‰¹åˆ«æ˜¯å¤§è¡¨çš„å­—æ®µï¼Œåº”è¯¥å»ºç«‹ç´¢å¼•</p><p>9 sqlå…³é”®å­—æ‰§è¡Œé¡ºåºï¼šselect-&gt;from-&gt;where-&gt;group by-&gt;having-&gt;order by</p><p>10 explainåŒ…å«å“ªäº›åˆ—</p>]]></content>
    
    
    
    <tags>
      
      <tag>æ•°æ®åº“</tag>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Centos7Nginxçš„SSlè¯ä¹¦å®‰è£…</title>
    <link href="/blog/2021/01/10/Centos7Nginx%E7%9A%84SSl%E8%AF%81%E4%B9%A6%E5%AE%89%E8%A3%85/"/>
    <url>/blog/2021/01/10/Centos7Nginx%E7%9A%84SSl%E8%AF%81%E4%B9%A6%E5%AE%89%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<p>æ³¨æ„è·¯å¾„</p><p>å¯è§ï¼Œnginxç¼ºå°‘SSLæ¨¡å—æ”¯æŒã€‚è¿™æ˜¯å› ä¸ºæˆ‘å½“å¹´å»ºç«™çš„æ—¶å€™æ ¹æœ¬æ²¡ç”¨åˆ°SSLå•Šï¼Œæ‰€ä»¥ä»¥å‰ç¼–è¯‘nginxçš„æ—¶å€™ä½¿ç”¨äº†ä¸å¸¦SSLæ”¯æŒçš„é»˜è®¤ç¼–è¯‘å‚æ•°ã€‚ ä¸ºäº†è®©nginxæ·»åŠ SSLæ¨¡å—ï¼Œåªèƒ½é‡æ–°ç¼–è¯‘å®ƒã€‚ä½†æ˜¯ï¼Œå¦‚ä½•åœ¨ç°æœ‰nginxçš„åŸºç¡€ä¸Šï¼Œæ·»åŠ ä¸€ä¸ªæ”¯æŒSSLçš„ç¼–è¯‘å‚æ•°å‘¢ï¼Ÿé¦–å…ˆè¦æ‰¾å›åŸæ¥ç¼–è¯‘nginxæ—¶çš„ç¼–è¯‘å‚æ•°ï¼Œç„¶åå†åŠ ä¸Šæ”¯æŒSSLçš„ç¼–è¯‘å‚æ•°ã€‚å¦‚æœä¸è¿™æ ·åšï¼Œé‚£ä¹ˆç¼–è¯‘å‡ºæ¥çš„nginxå¯èƒ½å°±ä¼šæœ‰é—®é¢˜ï¼ˆæŸäº›æ—§çš„ç¼–è¯‘å‚æ•°è¢«å»æ‰äº†ï¼Œä½¿å¾—nginxä¸èƒ½æ”¯æŒæŸäº›åŠŸèƒ½ï¼‰ã€‚ æ‰€ä»¥å…ˆæŸ¥çœ‹æ—§çš„nginxçš„ç¼–è¯‘å‚æ•°ï¼šnginx -V å¤§å†™V è¾“å‡ºçš„ä¿¡æ¯ä¸­ï¼Œæœ€é‡è¦çš„ä¸€å¥æ˜¯ï¼š configure arguments: â€“prefix=/usr/local/nginx å¯è§ï¼Œå½“æ—¶æˆ‘ç¼–è¯‘nginxçš„æ—¶å€™ï¼Œåªæ˜¯æŒ‡å®šäº†ä¸€ä¸ªå®‰è£…è·¯å¾„ï¼Œæ²¡æœ‰å…¶ä»–ç‰¹æ®Šçš„ç¼–è¯‘å‚æ•°ã€‚é‚£ä¹ˆç°åœ¨äº‹æƒ…å°±å¥½åŠäº†ï¼šå›åˆ°nginxçš„æºç ç›®å½•ä¸‹ï¼ŒåŠ ä¸ŠSSLæ”¯æŒå‚æ•°é‡æ–°ç¼–è¯‘ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">./configure --prefix=/usr/local/nginx --with-http_ssl_module<br>make<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œæ­¤æ—¶åƒä¸‡ä¸èƒ½æ‰‹å¿«ç›´æ¥ make installï¼å› ä¸ºæˆ‘åŸæ¥çš„nginxè¿˜æœ‰ä¸€å †çš„é…ç½®æ–‡ä»¶ï¼Œä¸èƒ½è¢«è¦†ç›–ã€‚æˆ‘ä»¬åº”è¯¥åªè¦†ç›–ç¼–è¯‘å‡ºæ¥çš„nginxå¯æ‰§è¡Œç¨‹åºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">cp /usr/local/nginx/sbin/nginx ~/<br>cp objs/nginx /usr/local/nginx/sbin/<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œobjs/nginx æ˜¯æ–°ç¼–è¯‘å‡ºæ¥çš„nginxå¯æ‰§è¡Œç¨‹åºã€‚ è¦†ç›–ä¹‹åï¼Œå†å°è¯•é‡æ–°å¯åŠ¨nginxï¼Œå°±æ²¡æœ‰é—®é¢˜äº†ã€‚</p><p>æ¥ä¸‹æ¥å®‰è£…è¯ä¹¦<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/WX20190724-133740@2x_1563946759206.png" alt="WX20190724-133740@2x">ä¸€ä¸ªè¯ä¹¦ é’ˆå¯¹ä¸€ä¸ªåŸŸå<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/WX20190724-133807@2x_1563946759366.png" alt="WX20190724-133807@2x">è¿›å…¥nginx ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª mkdir cert å°†ä¸¤ä¸ªæ–‡ä»¶ä¸Šä¼ åˆ°è¿™ä¸ªç›®å½•ä¸‹ å»ºè®®å°†æ–‡ä»¶é‡å‘½åä¸º zhzq.pem å’Œ zhzq.key</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java">ç¼–è¾‘ vim nginx.conf<br> <br>server &#123;<br>    listen <span class="hljs-number">80</span>;<br>    listen <span class="hljs-number">443</span> ssl;<br>    server_name ; ä½ çš„åŸŸå<br>    ssl off;<br>    ssl_certificate ../cert/zhzq.pem;<br>    ssl_certificate_key ../cert/zhzq.key;<br>    ssl_session_timeout 5m;<br>    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;<br>    ssl_protocols TLSv1 TLSv1<span class="hljs-number">.1</span> TLSv1<span class="hljs-number">.2</span>;<br>    ssl_prefer_server_ciphers on;<br>  <br>&#125;<br> <br></code></pre></td></tr></table></figure><p>é‡æ–°è½½å…¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">../sbin/nginx -s reload<br># å¦‚æœä¸Šé¢çš„å‘½ä»¤ä¸èµ·ä½œç”¨ï¼Œä¹Ÿå¯ä»¥é‡å¯<br>../sbin/nginx -s stop<br>../sbin/nginx<br></code></pre></td></tr></table></figure><p>https 443 å¼€æ”¾å¯¹åº”çš„ç«¯å£ è®¿é—®å°±å¯ä»¥äº†</p>]]></content>
    
    
    
    <tags>
      
      <tag>éƒ¨ç½²</tag>
      
      <tag>Nginx</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>javaå°†PDFè½¬ä¸ºWordã€å›¾ç‰‡ã€SVGã€XPSã€Htmlã€PDFã€‚</title>
    <link href="/blog/2021/01/10/java%E5%B0%86PDF%E8%BD%AC%E4%B8%BAWord%E3%80%81%E5%9B%BE%E7%89%87%E3%80%81SVG%E3%80%81XPS%E3%80%81Html%E3%80%81PDF%E3%80%82/"/>
    <url>/blog/2021/01/10/java%E5%B0%86PDF%E8%BD%AC%E4%B8%BAWord%E3%80%81%E5%9B%BE%E7%89%87%E3%80%81SVG%E3%80%81XPS%E3%80%81Html%E3%80%81PDF%E3%80%82/</url>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡å°†ä»‹ç»é€šè¿‡Javaç¼–ç¨‹æ¥å®ç°PDFæ–‡æ¡£è½¬æ¢çš„æ–¹æ³•ã€‚åŒ…æ‹¬ï¼š</p><ol><li><p>PDFè½¬ä¸ºWord</p></li><li><p>PDFè½¬ä¸ºå›¾ç‰‡</p></li><li><p>PDFè½¬ä¸ºHtml</p></li><li><p>PDFè½¬ä¸ºSVG</p><p>4.1 å°†PDFæ¯ä¸€é¡µè½¬ä¸ºå•ä¸ªçš„SVG</p><p>4.2 å°†ä¸€ä¸ªåŒ…å«å¤šé¡µçš„PDFæ–‡æ¡£è½¬ä¸ºä¸€ä¸ªSVG</p></li><li><p>PDFè½¬ä¸ºXPS</p></li><li><p>PDFè½¬ä¸ºPDF/A</p></li></ol><p>ä½¿ç”¨å·¥å…·ï¼šFree Spire.PDF for Javaï¼ˆå…è´¹ç‰ˆï¼‰</p><p>Jaræ–‡ä»¶è·å–åŠå¯¼å…¥ï¼š</p><p>æ–¹æ³•1ï¼šé€šè¿‡å®˜ç½‘ä¸‹è½½<a href="https://www.e-iceblue.cn/Downloads/Free-Spire-PDF-JAVA.html">ä¸‹è½½jaråŒ…</a>ã€‚ä¸‹è½½åï¼Œè§£å‹æ–‡ä»¶ï¼Œå¹¶å°†libæ–‡ä»¶å¤¹ä¸‹çš„Spire.Pdf.jaræ–‡ä»¶å¯¼å…¥Javaç¨‹åºã€‚</p><p>æ–¹æ³•2ï¼šå¯é€šè¿‡mavenä»“åº“å®‰è£…å¯¼å…¥ã€‚å‚è€ƒ<a href="https://www.e-iceblue.cn/licensing/install-spirepdf-for-java-from-maven-repository.html">å¯¼å…¥æ–¹æ³•</a></p><h2 id="PDF-è½¬Word"><a href="#PDF-è½¬Word" class="headerlink" title="PDF è½¬Word"></a>PDF è½¬Word</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">PdfDocument pdf = <span class="hljs-keyword">new</span> PdfDocument(<span class="hljs-string">&quot;test.pdf&quot;</span>);<br>pdf.saveToFile(<span class="hljs-string">&quot;ToWord.docx&quot;</span>,FileFormat.DOCX);<br></code></pre></td></tr></table></figure><h2 id="PDFè½¬å›¾ç‰‡"><a href="#PDFè½¬å›¾ç‰‡" class="headerlink" title="PDFè½¬å›¾ç‰‡"></a>PDFè½¬å›¾ç‰‡</h2><p>æ”¯æŒçš„å›¾ç‰‡æ ¼å¼åŒ…æ‹¬Jpeg, Jpg, Png, Bmp, Tiff, Gif, EMFç­‰ã€‚è¿™é‡Œä»¥ä¿å­˜ä¸ºPngæ ¼å¼ä¸ºä¾‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.spire.pdf.*;<br> <br><span class="hljs-keyword">import</span> javax.imageio.ImageIO;<br><span class="hljs-keyword">import</span> java.awt.image.BufferedImage;<br><span class="hljs-keyword">import</span> java.io.File;<br><span class="hljs-keyword">import</span> java.io.IOException;<br> <br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PDFtoimage</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br> <br>PdfDocument pdf = <span class="hljs-keyword">new</span> PdfDocument(<span class="hljs-string">&quot;test.pdf&quot;</span>);<br>BufferedImage image;<br><span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i&lt; pdf.getPages().getCount();i++)&#123;<br>    image = pdf.saveAsImage(i);<br>    File file = <span class="hljs-keyword">new</span> File( String.format(<span class="hljs-string">&quot;ToImage-img-%d.png&quot;</span>, i));<br>    ImageIO.write(image, <span class="hljs-string">&quot;PNG&quot;</span>, file);<br>&#125;<br>pdf.close();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="PDFè½¬Html"><a href="#PDFè½¬Html" class="headerlink" title="PDFè½¬Html"></a>PDFè½¬Html</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">PdfDocument pdf = <span class="hljs-keyword">new</span> PdfDocument(<span class="hljs-string">&quot;test.pdf&quot;</span>);<br>pdf.saveToFile(<span class="hljs-string">&quot;ToHTML.html&quot;</span>, FileFormat.HTML);<br></code></pre></td></tr></table></figure><h2 id="PDFè½¬SVG"><a href="#PDFè½¬SVG" class="headerlink" title="PDFè½¬SVG"></a>PDFè½¬SVG</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//è½¬ä¸ºå•ä¸ªsvg</span><br>PdfDocument pdf = <span class="hljs-keyword">new</span> PdfDocument(<span class="hljs-string">&quot;test.pdf&quot;</span>);<br>pdf.saveToFile(<span class="hljs-string">&quot;ToSVG.svg&quot;</span>, FileFormat.SVG);<br><span class="hljs-comment">//å¤šé¡µpdfè½¬ä¸ºä¸€ä¸ªsvg</span><br>PdfDocument pdf = <span class="hljs-keyword">new</span> PdfDocument(<span class="hljs-string">&quot;sampe.pdf&quot;</span>);<br>pdf.getConvertOptions().setOutputToOneSvg(<span class="hljs-keyword">true</span>);<br>pdf.saveToFile(<span class="hljs-string">&quot;ToOneSvg.svg&quot;</span>,FileFormat.SVG);<br></code></pre></td></tr></table></figure><h2 id="PDF-è½¬XPS"><a href="#PDF-è½¬XPS" class="headerlink" title="PDF è½¬XPS"></a>PDF è½¬XPS</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">PdfDocument pdf = <span class="hljs-keyword">new</span> PdfDocument(<span class="hljs-string">&quot;test.pdf&quot;</span>);<br>pdf.saveToFile(<span class="hljs-string">&quot;ToXPS.xps&quot;</span>, FileFormat.XPS);<br></code></pre></td></tr></table></figure><h2 id="PDFè½¬PDF-A"><a href="#PDFè½¬PDF-A" class="headerlink" title="PDFè½¬PDF/A"></a>PDFè½¬PDF/A</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.spire.pdf.*;<br><span class="hljs-keyword">import</span> com.spire.pdf.graphics.PdfMargins;<br><span class="hljs-keyword">import</span> java.awt.geom.Dimension2D;<br> <br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PDFtoPDFA</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[]args)</span></span>&#123;<br>        <span class="hljs-comment">//åŠ è½½æµ‹è¯•æ–‡æ¡£</span><br>        PdfDocument pdf = <span class="hljs-keyword">new</span> PdfDocument();<br>        pdf.loadFromFile(<span class="hljs-string">&quot;test.pdf&quot;</span>);<br> <br>        <span class="hljs-comment">//è½¬æ¢ä¸ºPdf_A_1_Bæ ¼å¼</span><br>        PdfNewDocument newDoc = <span class="hljs-keyword">new</span> PdfNewDocument();<br>        newDoc.setConformance(PdfConformanceLevel.Pdf_A_1_B);<br>        PdfPageBase page;<br>        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt; pdf.getPages().getCount();i++) &#123;<br>            page = pdf.getPages().get(i);<br>            Dimension2D size = page.getSize();<br>            PdfPageBase p = newDoc.getPages().add(size, <span class="hljs-keyword">new</span> PdfMargins(<span class="hljs-number">0</span>));<br>            page.createTemplate().draw(p, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>        &#125;<br> <br>        <span class="hljs-comment">//ä¿å­˜ç»“æœæ–‡ä»¶</span><br>        newDoc.save(<span class="hljs-string">&quot;ToPDFA.pdf&quot;</span>);<br>        newDoc.close();<br> <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><a href="https://bk.cuixiaoyan.xyz/archives/PDF#pdf-%E8%BD%ACword">PDF è½¬Word</a><a href="https://bk.cuixiaoyan.xyz/archives/PDF#pdf%E8%BD%AC%E5%9B%BE%E7%89%87">PDFè½¬å›¾ç‰‡</a><a href="https://bk.cuixiaoyan.xyz/archives/PDF#pdf%E8%BD%AChtml">PDFè½¬Html</a><a href="https://bk.cuixiaoyan.xyz/archives/PDF#pdf%E8%BD%ACsvg">PDFè½¬SVG</a><a href="https://bk.cuixiaoyan.xyz/archives/PDF#pdf-%E8%BD%ACxps">PDF è½¬XPS</a><a href="https://bk.cuixiaoyan.xyz/archives/PDF#pdf%E8%BD%ACpdfa">PDFè½¬PDF/A</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>å·¥å…·</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è§£å†³IntellijIDEAéƒ¨ç½²JavaWebé¡¹ç›®404é—®é¢˜</title>
    <link href="/blog/2021/01/10/%E8%A7%A3%E5%86%B3IntellijIDEA%E9%83%A8%E7%BD%B2JavaWeb%E9%A1%B9%E7%9B%AE404%E9%97%AE%E9%A2%98/"/>
    <url>/blog/2021/01/10/%E8%A7%A3%E5%86%B3IntellijIDEA%E9%83%A8%E7%BD%B2JavaWeb%E9%A1%B9%E7%9B%AE404%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<p>é¦–å…ˆä½ è¦ä¿è¯ ä½ å’ŒåŒäº‹çš„ç‰ˆæœ¬ä¿æŒä¸€è‡´ jdk å’Œ tomcat é‡ä¸­ä¹‹é‡ æ£€æŸ¥ä¸€ä¸‹Project Structureçš„é…ç½®ï¼Œé¦–å…ˆæ˜¯projectï¼š<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/2_1563416756399.png" alt="2">Modules-Sourceså¦‚ä¸‹å›¾ï¼š<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/3_1563416756457.png" alt="3">Modules-Pathsä¸­æ²¡ä»€ä¹ˆéœ€è¦ç‰¹åˆ«ä¿®æ”¹çš„åœ°æ–¹ã€‚ Modules-Dependenciså¦‚ä¸‹å›¾ï¼š ä¸ç”¨å‹¾é€‰<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/4_1563416756561.png" alt="4">Liraireså¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/5_1563416756527.png" alt="5">Facetså¦‚ä¸‹ï¼Œè·¯å¾„ä¸€å®šä¸è¦é…é”™ï¼Œä¸å¦‚ä¸€å®š404ï¼Œå¦‚ä¸‹å›¾ï¼š å°¤å…¶æ˜¯ä»eclipse å¯¼å…¥å°¤å…¶æ³¨æ„<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/6_1563416756587.png" alt="6">æœ€åå°±æ˜¯Artifacts:<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/7_1563416756592.png" alt="7">é¡¹ç›®åˆ°è¿™å°±é…ç½®å®Œäº†ï¼Œæœ‰äº›è·¯å¾„ä¸€å®šè¦ç»“åˆè‡ªå·±çš„é¡¹ç›®æ¥é…ç½®ã€‚</p><p>æ¥ä¸‹æ¥é…ç½®tomcatï¼š<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/8_1563416765804.png" alt="8">ä¸åŠ å°±æ˜¯/ç›®å½•<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/9_1563416765774.png" alt="9"></p>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>IDEA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Postmançš„åŸºç¡€åŠŸèƒ½</title>
    <link href="/blog/2021/01/10/Postman%E7%9A%84%E5%9F%BA%E7%A1%80%E5%8A%9F%E8%83%BD/"/>
    <url>/blog/2021/01/10/Postman%E7%9A%84%E5%9F%BA%E7%A1%80%E5%8A%9F%E8%83%BD/</url>
    
    <content type="html"><![CDATA[<p>å‰åç«¯åˆ†ç¦» æ¥å£è°ƒè¯•å·¥å…·<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/20180523232921542_1563331603653.png" alt="20180523232921542"></p><p>1.è¡¨å•æäº¤<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/WX20190717-104908@2x_1563331761801.png" alt="WX20190717-104908@2x"></p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/WX20190717-104757@2x_1563331703420.png" alt="WX20190717-104757@2x">2.jsonæäº¤ ä¸‹å›¾ä¸­ï¼Œå½“æˆ‘ä»¬é€‰æ‹©JSON(application/json) æ˜¯ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬è®¾ç½® headers ä¸º application/json<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/2018052400054291_1563331856704.png" alt="2018052400054291"></p><h2 id="ä¸‹é¢å°±æ˜¯å¾ˆå¤šç³»ç»Ÿä¼šéœ€è¦ç™»é™†ä¹‹å-æ‰èƒ½æ¨¡æ‹Ÿæ•ˆæœ"><a href="#ä¸‹é¢å°±æ˜¯å¾ˆå¤šç³»ç»Ÿä¼šéœ€è¦ç™»é™†ä¹‹å-æ‰èƒ½æ¨¡æ‹Ÿæ•ˆæœ" class="headerlink" title="ä¸‹é¢å°±æ˜¯å¾ˆå¤šç³»ç»Ÿä¼šéœ€è¦ç™»é™†ä¹‹å æ‰èƒ½æ¨¡æ‹Ÿæ•ˆæœ"></a>ä¸‹é¢å°±æ˜¯å¾ˆå¤šç³»ç»Ÿä¼šéœ€è¦ç™»é™†ä¹‹å æ‰èƒ½æ¨¡æ‹Ÿæ•ˆæœ</h2><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/WX20190717-105157@2x_1563331933756.png" alt="WX20190717-105157@2x"></p>]]></content>
    
    
    
    <tags>
      
      <tag>å·¥å…·</tag>
      
      <tag>Postman</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>jså®ç°ä¸‹é›ªç‰¹æ•ˆ</title>
    <link href="/blog/2021/01/06/js%E5%AE%9E%E7%8E%B0%E4%B8%8B%E9%9B%AA%E7%89%B9%E6%95%88/"/>
    <url>/blog/2021/01/06/js%E5%AE%9E%E7%8E%B0%E4%B8%8B%E9%9B%AA%E7%89%B9%E6%95%88/</url>
    
    <content type="html"><![CDATA[<p>ç›´æ¥ä¸Šä»£ç  æ”¾åˆ°ä½ çš„script æ ‡ç­¾ä¸­ å…·ä½“æ•ˆæœå‚è€ƒåšå®¢é¡µé¢</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs js">(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$</span>)</span>&#123;<br>$.fn.snow = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">options</span>)</span>&#123;<br><span class="hljs-keyword">var</span> $flake = $(<span class="hljs-string">&#x27;&lt;div id=&quot;snowbox&quot; /&gt;&#x27;</span>).css(&#123;<span class="hljs-string">&#x27;position&#x27;</span>: <span class="hljs-string">&#x27;absolute&#x27;</span>,<span class="hljs-string">&#x27;z-index&#x27;</span>:<span class="hljs-string">&#x27;9999&#x27;</span>, <span class="hljs-string">&#x27;top&#x27;</span>: <span class="hljs-string">&#x27;-50px&#x27;</span>&#125;).html(<span class="hljs-string">&#x27;&amp;#10052;&#x27;</span>),<br>documentHeight = $(<span class="hljs-built_in">document</span>).height(),<br>documentWidth= $(<span class="hljs-built_in">document</span>).width(),<br>defaults = &#123;<br>minSize: <span class="hljs-number">10</span>,<br>maxSize: <span class="hljs-number">20</span>,<br>newOn: <span class="hljs-number">1000</span>,<br>flakeColor: <span class="hljs-string">&quot;#AFDAEF&quot;</span> <span class="hljs-comment">/* æ­¤å¤„å¯ä»¥å®šä¹‰é›ªèŠ±é¢œè‰²ï¼Œè‹¥è¦ç™½è‰²å¯ä»¥æ”¹ä¸º#FFFFFF */</span><br>&#125;,<br>options= $.extend(&#123;&#125;, defaults, options);<br><span class="hljs-keyword">var</span> interval= <span class="hljs-built_in">setInterval</span>( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-keyword">var</span> startPositionLeft = <span class="hljs-built_in">Math</span>.random() * documentWidth - <span class="hljs-number">100</span>,<br>startOpacity = <span class="hljs-number">0.5</span> + <span class="hljs-built_in">Math</span>.random(),<br>sizeFlake = options.minSize + <span class="hljs-built_in">Math</span>.random() * options.maxSize,<br>endPositionTop = documentHeight - <span class="hljs-number">200</span>,<br>endPositionLeft = startPositionLeft - <span class="hljs-number">500</span> + <span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">500</span>,<br>durationFall = documentHeight * <span class="hljs-number">10</span> + <span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">5000</span>;<br>$flake.clone().appendTo(<span class="hljs-string">&#x27;body&#x27;</span>).css(&#123;<br>left: startPositionLeft,<br>opacity: startOpacity,<br><span class="hljs-string">&#x27;font-size&#x27;</span>: sizeFlake,<br>color: options.flakeColor<br>&#125;).animate(&#123;<br>top: endPositionTop,<br>left: endPositionLeft,<br>opacity: <span class="hljs-number">0.2</span><br>&#125;,durationFall,<span class="hljs-string">&#x27;linear&#x27;</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<br>$(<span class="hljs-built_in">this</span>).remove()<br>&#125;);<br>&#125;, options.newOn);<br>    &#125;;<br>&#125;)(jQuery);<br>$(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<br>    $.fn.snow(&#123; <br>    minSize: <span class="hljs-number">5</span>, <span class="hljs-comment">/* å®šä¹‰é›ªèŠ±æœ€å°å°ºå¯¸ */</span><br>    maxSize: <span class="hljs-number">30</span>,<span class="hljs-comment">/* å®šä¹‰é›ªèŠ±æœ€å¤§å°ºå¯¸ */</span><br>    newOn: <span class="hljs-number">300</span>  <span class="hljs-comment">/* å®šä¹‰å¯†é›†ç¨‹åº¦ï¼Œæ•°å­—è¶Šå°è¶Šå¯†é›† */</span><br>    &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>éƒ¨ç½²</tag>
      
      <tag>å‰ç«¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Centos7å®‰è£…redis</title>
    <link href="/blog/2021/01/06/Centos7%E5%AE%89%E8%A3%85redis/"/>
    <url>/blog/2021/01/06/Centos7%E5%AE%89%E8%A3%85redis/</url>
    
    <content type="html"><![CDATA[<p>åœ¨CentOSå’ŒRed Hatç³»ç»Ÿä¸­ï¼Œé¦–å…ˆæ·»åŠ EPELä»“åº“ï¼Œç„¶åæ›´æ–°yumæºï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">sudo yum install epel-<span class="hljs-keyword">release</span><br>sudo yum <span class="hljs-keyword">update</span><br></code></pre></td></tr></table></figure><p>ç„¶åå®‰è£…Redisæ•°æ®åº“ï¼š</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">sudo yum -y <span class="hljs-keyword">install</span> redis<br></code></pre></td></tr></table></figure><p>å®‰è£…å¥½åå¯åŠ¨RedisæœåŠ¡å³å¯ï¼š</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">sudo systemctl <span class="hljs-literal">start</span> redis<br></code></pre></td></tr></table></figure><p>è¿™é‡ŒåŒæ ·å¯ä»¥ä½¿ç”¨redis-cliè¿›å…¥Rediså‘½ä»¤è¡Œæ¨¡å¼æ“ä½œã€‚</p><p>å¦å¤–ï¼Œä¸ºäº†å¯ä»¥ä½¿Redisèƒ½è¢«è¿œç¨‹è¿æ¥ï¼Œéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œè·¯å¾„ä¸º/etc/redis.conf</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">vi <span class="hljs-regexp">/etc/</span>redis.conf<br></code></pre></td></tr></table></figure><p>éœ€è¦ä¿®æ”¹çš„åœ°æ–¹ï¼š ç›´æ¥æœç´¢ requirepass</p><p>é¦–å…ˆï¼Œæ³¨é‡Šè¿™ä¸€è¡Œï¼š å¦å¤–ï¼Œæ¨èç»™Redisè®¾ç½®å¯†ç ï¼Œå–æ¶ˆæ³¨é‡Šè¿™ä¸€è¡Œï¼š</p><p>#requirepass foobared</p><p>foobaredå³å½“å‰å¯†ç ï¼Œå¯ä»¥è‡ªè¡Œä¿®æ”¹ä¸º è¿™é‡Œæˆ‘è®¾ç½®æˆroot</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-comment">#bind 127.0.0.1</span><br> <br><span class="hljs-attribute">requirepass</span> root <br></code></pre></td></tr></table></figure><p>ç„¶åé‡å¯RedisæœåŠ¡ï¼Œä½¿ç”¨çš„å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">sudo systemctl restart redis</span><br></code></pre></td></tr></table></figure><p>ps: å…¶ä»–å‘½ä»¤</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs gauss">systemctl start redis.service <span class="hljs-meta">#å¯åŠ¨redisæœåŠ¡å™¨</span><br> <br>systemctl <span class="hljs-keyword">stop</span> redis.service <span class="hljs-meta">#åœæ­¢redisæœåŠ¡å™¨</span><br> <br>systemctl restart redis.service <span class="hljs-meta">#é‡æ–°å¯åŠ¨redisæœåŠ¡å™¨</span><br> <br>systemctl status redis.service <span class="hljs-meta">#è·å–redisæœåŠ¡å™¨çš„è¿è¡ŒçŠ¶æ€</span><br> <br>systemctl <span class="hljs-keyword">enable</span> redis.service <span class="hljs-meta">#å¼€æœºå¯åŠ¨redisæœåŠ¡å™¨</span><br> <br>systemctl <span class="hljs-keyword">disable</span> redis.service <span class="hljs-meta">#å¼€æœºç¦ç”¨redisæœåŠ¡å™¨</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>éƒ¨ç½²</tag>
      
      <tag>æœåŠ¡å™¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Centos7å®‰è£…Nginx</title>
    <link href="/blog/2021/01/06/Centos7%E5%AE%89%E8%A3%85Nginx/"/>
    <url>/blog/2021/01/06/Centos7%E5%AE%89%E8%A3%85Nginx/</url>
    
    <content type="html"><![CDATA[<h1 id="Nginx-æ˜¯Cè¯­è¨€å¼€å‘çš„-æ‰€ä»¥è¦å®‰è£…gccç¼–è¯‘å™¨ã€‚"><a href="#Nginx-æ˜¯Cè¯­è¨€å¼€å‘çš„-æ‰€ä»¥è¦å®‰è£…gccç¼–è¯‘å™¨ã€‚" class="headerlink" title="Nginx æ˜¯Cè¯­è¨€å¼€å‘çš„,æ‰€ä»¥è¦å®‰è£…gccç¼–è¯‘å™¨ã€‚"></a>Nginx æ˜¯Cè¯­è¨€å¼€å‘çš„,æ‰€ä»¥è¦å®‰è£…gccç¼–è¯‘å™¨ã€‚</h1><ol><li>å®‰è£… nginx éœ€è¦å…ˆå°†å®˜ç½‘ä¸‹è½½çš„æºç è¿›è¡Œç¼–è¯‘ï¼Œç¼–è¯‘ä¾èµ– gcc ç¯å¢ƒï¼Œå¦‚æœæ²¡æœ‰ gcc ç¯å¢ƒï¼Œåˆ™éœ€è¦å®‰è£…ï¼š</li></ol><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-comment">yum</span> <span class="hljs-comment">install</span> <span class="hljs-literal">-</span><span class="hljs-comment">y</span> <span class="hljs-comment">gcc</span><span class="hljs-literal">-</span><span class="hljs-comment">c</span>++<br></code></pre></td></tr></table></figure><ol><li>PCRE(Perl Compatible Regular Expressions) æ˜¯ä¸€ä¸ªPerlåº“ï¼ŒåŒ…æ‹¬ perl å…¼å®¹çš„æ­£åˆ™è¡¨è¾¾å¼åº“ã€‚nginx çš„ http æ¨¡å—ä½¿ç”¨ pcre æ¥è§£ææ­£åˆ™è¡¨è¾¾å¼ï¼Œæ‰€ä»¥éœ€è¦åœ¨ linux ä¸Šå®‰è£… pcre åº“ï¼Œpcre-devel æ˜¯ä½¿ç”¨ pcre å¼€å‘çš„ä¸€ä¸ªäºŒæ¬¡å¼€å‘åº“ã€‚</li></ol><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">yum <span class="hljs-keyword">install</span> -y pcre pcre-devel<br></code></pre></td></tr></table></figure><p>3.zlib åº“æä¾›äº†å¾ˆå¤šç§å‹ç¼©å’Œè§£å‹ç¼©çš„æ–¹å¼ï¼Œ nginx ä½¿ç”¨ zlib å¯¹ http åŒ…çš„å†…å®¹è¿›è¡Œ gzip ï¼Œæ‰€ä»¥éœ€è¦åœ¨ Centos ä¸Šå®‰è£… zlib åº“ã€‚</p><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nsis">yum install -y <span class="hljs-literal">zlib</span> <span class="hljs-literal">zlib</span>-devel<br></code></pre></td></tr></table></figure><p>4.OpenSSL æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å®‰å…¨å¥—æ¥å­—å±‚å¯†ç åº“ï¼Œå›Šæ‹¬ä¸»è¦çš„å¯†ç ç®—æ³•ã€å¸¸ç”¨çš„å¯†é’¥å’Œè¯ä¹¦å°è£…ç®¡ç†åŠŸèƒ½åŠ SSL åè®®ï¼Œå¹¶æä¾›ä¸°å¯Œçš„åº”ç”¨ç¨‹åºä¾›æµ‹è¯•æˆ–å…¶å®ƒç›®çš„ä½¿ç”¨ã€‚</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">yum <span class="hljs-keyword">install</span> -y openssl openssl-devel<br></code></pre></td></tr></table></figure><p>ä¸‹è½½nginx åˆ°ä¸€ä¸ªè‡ªå·±åˆ›å»ºåˆ°æ–‡ä»¶å¤¹ä¸­ éšæ„</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs awk">ä¸‹è½½ wget https:<span class="hljs-regexp">//</span>nginx.org<span class="hljs-regexp">/download/</span>nginx-<span class="hljs-number">1.13</span>.<span class="hljs-number">0</span>.tar.gz<br>è§£å‹ tar -zxvf nginx-<span class="hljs-number">1.10</span>.<span class="hljs-number">1</span>.tar.gz<br>è¿›å…¥ cd nginx-<span class="hljs-number">1.10</span>.<span class="hljs-number">1</span><br>é…ç½® ./configure<br>ç¼–è¯‘ make<br>å®‰è£… make install<br>ä¸€æ¬¡å®Œæˆä¹Ÿå¯ä»¥ .<span class="hljs-regexp">/configure --prefix=/</span>opt<span class="hljs-regexp">/software/</span>nginx &amp;&amp; make install<br>é…ç½®ç¯å¢ƒå˜é‡ï¼šï¼ˆæ³¨æ„æ˜¯sbinä¸æ˜¯binï¼‰ <br>echo <span class="hljs-string">&#x27;export PATH=$PATH:/opt/software/nginx/sbin&#x27;</span> &gt; <span class="hljs-regexp">/etc/</span>profile.d/nginx.sh<br></code></pre></td></tr></table></figure><p>ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ source /etc/profile æŸ¥çœ‹å®‰è£…è·¯å¾„ whereis nginx</p><p>å‰æè¿›å…¥å®‰è£…è·¯å¾„é‡Œé¢ sbin ç›®å½•ä¸‹ cd /opt/software/nginx/sbin/ å¯åŠ¨ ./nginx æŸ¥çœ‹è¿›ç¨‹ ps aux|grep nginx é‡å¯ å…ˆåœæ­¢å†å¯åŠ¨ï¼ˆæ¨èï¼‰ï¼š</p><p>./nginx -s quit ./nginx</p><p>æœ‰å¾ˆå¤šæ—¶å€™åªæ”¹é…ç½® ä¸ç”¨é‡å¯äº†å°± å½“ ngin xçš„é…ç½®æ–‡ä»¶ nginx.conf ä¿®æ”¹åï¼Œè¦æƒ³è®©é…ç½®ç”Ÿæ•ˆéœ€è¦é‡å¯ nginxï¼Œå³å¯å°†é…ç½®ä¿¡æ¯åœ¨ nginx ä¸­ç”Ÿæ•ˆï¼Œå¦‚ä¸‹ï¼š</p><p>./nginx -s reload</p><p>é»˜è®¤ç«¯å£ä¸º80 ä¸ç”¨åŠ  ç›´æ¥å¤–éƒ¨IP è®¿é—® å°±èƒ½è®¿é—®åˆ°é¡µé¢</p>]]></content>
    
    
    
    <tags>
      
      <tag>éƒ¨ç½²</tag>
      
      <tag>è½¯ä»¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Centos7å®‰è£…mysql5.7</title>
    <link href="/blog/2021/01/05/Centos7%E5%AE%89%E8%A3%85mysql/"/>
    <url>/blog/2021/01/05/Centos7%E5%AE%89%E8%A3%85mysql/</url>
    
    <content type="html"><![CDATA[<h2 id="å…ˆæ£€æŸ¥ç³»ç»Ÿæ˜¯å¦è£…æœ‰mysql"><a href="#å…ˆæ£€æŸ¥ç³»ç»Ÿæ˜¯å¦è£…æœ‰mysql" class="headerlink" title="å…ˆæ£€æŸ¥ç³»ç»Ÿæ˜¯å¦è£…æœ‰mysql"></a>å…ˆæ£€æŸ¥ç³»ç»Ÿæ˜¯å¦è£…æœ‰mysql</h2><p>rpm -qa | grep mysql è¿™é‡Œæ‰§è¡Œå®‰è£…å‘½ä»¤æ˜¯æ— æ•ˆçš„ï¼Œå› ä¸ºcentos-7é»˜è®¤æ˜¯Mariadbï¼Œæ‰€ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åªæ˜¯æ›´æ–°Mariadbæ•°æ®åº“ yum install mysql åˆ é™¤ yum remove mysql</p><h2 id="ä¸‹è½½mysqlçš„repoæº"><a href="#ä¸‹è½½mysqlçš„repoæº" class="headerlink" title="ä¸‹è½½mysqlçš„repoæº"></a>ä¸‹è½½mysqlçš„repoæº</h2><p>wget <a href="http://repo.mysql.com/mysql-community-release-el7-5.noarch.rpm">http://repo.mysql.com/mysql-community-release-el7-5.noarch.rpm</a></p><h2 id="å®‰è£…mysql-community-release-el7-5-noarch-rpmåŒ…"><a href="#å®‰è£…mysql-community-release-el7-5-noarch-rpmåŒ…" class="headerlink" title="å®‰è£…mysql-community-release-el7-5.noarch.rpmåŒ…"></a>å®‰è£…mysql-community-release-el7-5.noarch.rpmåŒ…</h2><p>sudo rpm -ivh mysql-community-release-el7-5.noarch.rpm</p><h2 id="å®‰è£…mysql"><a href="#å®‰è£…mysql" class="headerlink" title="å®‰è£…mysql"></a>å®‰è£…mysql</h2><p>sudo yum install mysql-server</p><h3 id="è¿™é‡Œå¯èƒ½ä¼šæŠ¥é”™-è¯·æ³¨æ„"><a href="#è¿™é‡Œå¯èƒ½ä¼šæŠ¥é”™-è¯·æ³¨æ„" class="headerlink" title="è¿™é‡Œå¯èƒ½ä¼šæŠ¥é”™ è¯·æ³¨æ„"></a>è¿™é‡Œå¯èƒ½ä¼šæŠ¥é”™ è¯·æ³¨æ„</h3><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs subunit"><span class="hljs-keyword">Error: </span>Package: mysql-community-libs<span class="hljs-string">-5</span>.6.35<span class="hljs-string">-2</span>.el7.x86_64 (mysql56-community)<br>           Requires: libc.so.6(GLIBC_2.17)(64bit)<br><span class="hljs-keyword">Error: </span>Package: mysql-community-server<span class="hljs-string">-5</span>.6.35<span class="hljs-string">-2</span>.el7.x86_64 (mysql56-community)<br>           Requires: libc.so.6(GLIBC_2.17)(64bit)<br><span class="hljs-keyword">Error: </span>Package: mysql-community-server<span class="hljs-string">-5</span>.6.35<span class="hljs-string">-2</span>.el7.x86_64 (mysql56-community)<br>           Requires: systemd<br><span class="hljs-keyword">Error: </span>Package: mysql-community-server<span class="hljs-string">-5</span>.6.35<span class="hljs-string">-2</span>.el7.x86_64 (mysql56-community)<br>           Requires: libstdc++.so.6(GLIBCXX_3.4.15)(64bit)<br><span class="hljs-keyword">Error: </span>Package: mysql-community-client<span class="hljs-string">-5</span>.6.35<span class="hljs-string">-2</span>.el7.x86_64 (mysql56-community)<br>           Requires: libc.so.6(GLIBC_2.17)(64bit)<br> You could try using --skip-broken to work around the problem<br> You could try running: rpm -Va --nofiles --nodigest<br> <br></code></pre></td></tr></table></figure><h3 id="è§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š"><a href="#è§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š" class="headerlink" title="è§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š"></a>è§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š</h3><p>yum install glibc.i686 yum list libstdc++*</p><p>ç„¶åç™»é™† æ²¡æœ‰å¯†ç ç›´æ¥å›è½¦è·³è¿‡ mysql -u root -p</p><h3 id="ç™»å½•æ—¶æœ‰å¯èƒ½æŠ¥è¿™æ ·çš„é”™ï¼šERROR-2002-HY000-Canâ€™t-connect-to-local-MySQL-server-through-socket-â€˜-var-lib-mysql-mysql-sockâ€™-2-ï¼ŒåŸå› æ˜¯-var-lib-mysqlçš„è®¿é—®æƒé™é—®é¢˜ã€‚ä¸‹é¢çš„å‘½ä»¤æŠŠ-var-lib-mysqlçš„æ‹¥æœ‰è€…æ”¹ä¸ºå½“å‰ç”¨æˆ·ï¼š"><a href="#ç™»å½•æ—¶æœ‰å¯èƒ½æŠ¥è¿™æ ·çš„é”™ï¼šERROR-2002-HY000-Canâ€™t-connect-to-local-MySQL-server-through-socket-â€˜-var-lib-mysql-mysql-sockâ€™-2-ï¼ŒåŸå› æ˜¯-var-lib-mysqlçš„è®¿é—®æƒé™é—®é¢˜ã€‚ä¸‹é¢çš„å‘½ä»¤æŠŠ-var-lib-mysqlçš„æ‹¥æœ‰è€…æ”¹ä¸ºå½“å‰ç”¨æˆ·ï¼š" class="headerlink" title="ç™»å½•æ—¶æœ‰å¯èƒ½æŠ¥è¿™æ ·çš„é”™ï¼šERROR 2002 (HY000): Canâ€™t connect to local MySQL server through socket â€˜/var/lib/mysql/mysql.sockâ€™ (2)ï¼ŒåŸå› æ˜¯/var/lib/mysqlçš„è®¿é—®æƒé™é—®é¢˜ã€‚ä¸‹é¢çš„å‘½ä»¤æŠŠ/var/lib/mysqlçš„æ‹¥æœ‰è€…æ”¹ä¸ºå½“å‰ç”¨æˆ·ï¼š"></a>ç™»å½•æ—¶æœ‰å¯èƒ½æŠ¥è¿™æ ·çš„é”™ï¼šERROR 2002 (HY000): Canâ€™t connect to local MySQL server through socket â€˜/var/lib/mysql/mysql.sockâ€™ (2)ï¼ŒåŸå› æ˜¯/var/lib/mysqlçš„è®¿é—®æƒé™é—®é¢˜ã€‚ä¸‹é¢çš„å‘½ä»¤æŠŠ/var/lib/mysqlçš„æ‹¥æœ‰è€…æ”¹ä¸ºå½“å‰ç”¨æˆ·ï¼š</h3><p>sudo chown -R openscanner:openscanner /var/lib/mysql</p><p>é‡å¯mysql service mysqld restart</p><p>è¿™é‡Œå¯†ç è®¾ç½®çš„ä¸ºroot</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">mysql &gt; use mysql;<br>mysql &gt; update user set password=password(<span class="hljs-string">&#x27;root&#x27;</span>) where user=<span class="hljs-string">&#x27;root&#x27;</span>;<br>mysql &gt; <span class="hljs-keyword">exit</span>;<br> <br></code></pre></td></tr></table></figure><p>å†é‡å¯ ç™»é™†mysql åŠ ä¸Šè¿œç¨‹è®¿é—®æƒé™ ä¸ºrootæ·»åŠ è¿œç¨‹è¿æ¥çš„èƒ½åŠ›ã€‚é“¾æ¥å¯†ç ä¸º â€œrootâ€ï¼ˆä¸åŒ…æ‹¬åŒå¼•å·ï¼‰</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">mysql&gt; <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">PRIVILEGES</span> <span class="hljs-keyword">ON</span> *.* <span class="hljs-keyword">TO</span> root@&quot;%&quot; IDENTIFIED <span class="hljs-keyword">BY</span> &quot;root&quot;;ã€€ã€€<br></code></pre></td></tr></table></figure><h1 id="æœ€åæœ€å-éå¸¸é‡è¦-æŸ¥è¯¢ä¸åŒºåˆ†å¤§å°å†™è¡¨å"><a href="#æœ€åæœ€å-éå¸¸é‡è¦-æŸ¥è¯¢ä¸åŒºåˆ†å¤§å°å†™è¡¨å" class="headerlink" title="æœ€åæœ€å éå¸¸é‡è¦ æŸ¥è¯¢ä¸åŒºåˆ†å¤§å°å†™è¡¨å"></a>æœ€åæœ€å éå¸¸é‡è¦ æŸ¥è¯¢ä¸åŒºåˆ†å¤§å°å†™è¡¨å</h1><p>vim /etc/my.cnf åœ¨[mysqld]èŠ‚ç‚¹ä¸‹ï¼ŒåŠ å…¥ä¸€è¡Œï¼š lower_case_table_names=1<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/WX20190710-151220@2x_1562742772778.png" alt="WX20190710-151220@2x">é‡å¯æ•°æ®åº“ è¿æ¥å·¥å…·æµ‹è¯•è¿æ¥<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/5E7E7FBB-4F4B-4C82-83E0-F98203469C7A_1562742912107.png" alt="5E7E7FBB-4F4B-4C82-83E0-F98203469C7A"></p>]]></content>
    
    
    
    <tags>
      
      <tag>éƒ¨ç½²</tag>
      
      <tag>æœåŠ¡å™¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Centos7å®‰è£…tomcat9</title>
    <link href="/blog/2021/01/05/Centos7%E5%AE%89%E8%A3%85tomcat9/"/>
    <url>/blog/2021/01/05/Centos7%E5%AE%89%E8%A3%85tomcat9/</url>
    
    <content type="html"><![CDATA[<h2 id="é¦–å…ˆæ£€æŸ¥æ˜¯å¦å®‰è£…å¥½jdk-å’Œé…ç½®å¥½è¿è¡Œç¯å¢ƒ-è¿˜æœ‰å°±æ˜¯åå­—å’Œè·¯å¾„"><a href="#é¦–å…ˆæ£€æŸ¥æ˜¯å¦å®‰è£…å¥½jdk-å’Œé…ç½®å¥½è¿è¡Œç¯å¢ƒ-è¿˜æœ‰å°±æ˜¯åå­—å’Œè·¯å¾„" class="headerlink" title="é¦–å…ˆæ£€æŸ¥æ˜¯å¦å®‰è£…å¥½jdk å’Œé…ç½®å¥½è¿è¡Œç¯å¢ƒ è¿˜æœ‰å°±æ˜¯åå­—å’Œè·¯å¾„"></a>é¦–å…ˆæ£€æŸ¥æ˜¯å¦å®‰è£…å¥½jdk å’Œé…ç½®å¥½è¿è¡Œç¯å¢ƒ è¿˜æœ‰å°±æ˜¯åå­—å’Œè·¯å¾„</h2><p>è¾“å…¥å‘½ä»¤ï¼šJava -versionï¼Œå¦‚æœæ˜¾ç¤ºJDKç‰ˆæœ¬å·ï¼Œåˆ™è¯æ˜å·²ç»å®‰è£…äº†JDKã€‚</p><p>è¾“å…¥å‘½ä»¤ï¼šecho $JAVA_HOMEï¼Œå¦‚æœæ˜¾ç¤ºè·¯å¾„ï¼Œåˆ™è¯æ˜é…ç½®äº†ç¯å¢ƒå˜é‡ã€‚</p><p>å¦‚æœæ²¡æœ‰å‚è€ƒ <a href="http://47.100.236.144:888/archives/centos7-jdk">å®‰è£…jdk</a> tomcat ä¸‹è½½åœ°å€ [tomcat9]( <a href="https://pan.baidu.com/s/171M_rXvsyKNI5jAY8nwd1Q">https://pan.baidu.com/s/171M_rXvsyKNI5jAY8nwd1Q</a> æå–ç : 3r8q )</p><ol><li>cd /usr/local/ è¿›å…¥æ­¤ç›®å½•ä¸‹é¢ åˆ›å»º mkdir tomcat</li><li>è¿›å…¥tomcat æ–‡ä»¶å¤¹ä¸‹é¢ å°†äº‘ç›˜å®‰è£…åŒ…æ”¾å…¥ è§£å‹</li><li>tar -zxvf apache-tomcat-9.0.21.tar.gz</li><li>å†è¿›å…¥ cd apache-tomcat-9.0.21/bin/startup.sh å¯åŠ¨tomcat</li><li>å¯åŠ¨ /usr/local/tomcat/apache-tomcat-9.0.21/bin/startup.sh</li><li>å…³é—­ /usr/local/tomcat/apache-tomcat-9.0.21/bin/shutdown.sh</li><li>é‡å¯ å»ºè®® ps -ef | grep tomcat æŸ¥è¯¢ tomcat å ç”¨çš„pid</li><li>kill -9 pid å†å¯åŠ¨</li><li>ip åŠ ç«¯å£èƒ½è®¿é—®åˆ° å°±æˆåŠŸäº†</li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>éƒ¨ç½²</tag>
      
      <tag>æœåŠ¡å™¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Centos7å®‰è£…jdk</title>
    <link href="/blog/2021/01/05/Centos7%E5%AE%89%E8%A3%85jdk/"/>
    <url>/blog/2021/01/05/Centos7%E5%AE%89%E8%A3%85jdk/</url>
    
    <content type="html"><![CDATA[<p>è¯·æ³¨æ„ç‰ˆæœ¬å’Œæ–‡ä»¶å æ˜¯å¦ä¸€è‡´ æŒ‰ç…§ä½ çš„åœ°å€æ¥!</p><ol><li>å…ˆè¿›å…¥ cd /usr/local/</li><li>åˆ›å»ºä¸€ä¸ªæ”¾jdkçš„æ–‡ä»¶å¤¹ mkdir java</li><li>è¿›å…¥ cd java</li><li>é€šè¿‡å·¥å…· finalshell ç›´æ¥æŠŠå®‰è£…åŒ…æ”¾åˆ°Javaæ–‡ä»¶å¤¹ä¸‹</li><li>tar -zxv -f jdk-8u211-linux-x64.tar.gz è§£å‹å‡ºæ¥ [jdk ä¸‹è½½åœ°å€](é“¾æ¥: <a href="https://pan.baidu.com/s/1KjBBvHRxj4QHWkAnsIQGbQ">https://pan.baidu.com/s/1KjBBvHRxj4QHWkAnsIQGbQ</a> æå–ç : n1bp å¤åˆ¶è¿™æ®µå†…å®¹åæ‰“å¼€ç™¾åº¦ç½‘ç›˜æ‰‹æœºAppï¼Œæ“ä½œæ›´æ–¹ä¾¿å“¦)</li></ol><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/1562571285905_1562571317802.jpg" alt="1562571285905"></p><h2 id="ä¸Šé¢æ­¥éª¤å·²ç»å®‰è£…å®Œæˆäº†-ä¸‹é¢é…ç½®ç¯å¢ƒå˜é‡"><a href="#ä¸Šé¢æ­¥éª¤å·²ç»å®‰è£…å®Œæˆäº†-ä¸‹é¢é…ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="ä¸Šé¢æ­¥éª¤å·²ç»å®‰è£…å®Œæˆäº† ä¸‹é¢é…ç½®ç¯å¢ƒå˜é‡"></a>ä¸Šé¢æ­¥éª¤å·²ç»å®‰è£…å®Œæˆäº† ä¸‹é¢é…ç½®ç¯å¢ƒå˜é‡</h2><p>vim /etc/profile æ‰“å¼€ä¹‹åæŒ‰é”®ç›˜ã€iã€‘é”®è¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼Œå°†ä¸‹é¢çš„å†…å®¹å¤åˆ¶åˆ°åº•éƒ¨ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">JAVA_HOME=<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/java/</span>jdk1.<span class="hljs-number">8.0</span>_211<br>PATH=<span class="hljs-variable">$JAVA_HOME</span>/bin:<span class="hljs-variable">$PATH</span><br>CLASSPATH=<span class="hljs-variable">$JAVA_HOME</span><span class="hljs-regexp">/jre/</span>lib<span class="hljs-regexp">/ext:$JAVA_HOME/</span>lib/tools.jar<br>export PATH JAVA_HOME CLASSPATH<br> <br></code></pre></td></tr></table></figure><p>é…ç½®å®Œæˆåï¼Œæœ€é‡è¦çš„ä¸€æ­¥å°±æ˜¯ä½¿æ–‡ä»¶ç«‹å³ç”Ÿæ•ˆã€‚å‘½ä»¤å¦‚ä¸‹ï¼š source /etc/profile</p><h2 id="éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ"><a href="#éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ" class="headerlink" title="éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ"></a>éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ</h2><p>java -version echo $JAVA_HOME<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/WX20190708-154036@2x_1562571647150.png" alt="WX20190708-154036@2x">è¯´æ˜å®‰è£…æˆåŠŸï¼Œç¯å¢ƒå˜é‡ä¹Ÿé…ç½®æˆåŠŸï¼</p>]]></content>
    
    
    
    <tags>
      
      <tag>éƒ¨ç½²</tag>
      
      <tag>æœåŠ¡å™¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é˜¿é‡Œäº‘æœåŠ¡å™¨</title>
    <link href="/blog/2021/01/05/%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    <url>/blog/2021/01/05/%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<p>24å²ä»¥ä¸‹è‡ªåŠ¨è·å–å­¦ç”Ÿèº«ä»½ æ‰€ä»¥å…¥æ‰‹ä¸€å¹´ç”¨æ¥éƒ¨ç½²è‡ªå·±çš„åšå®¢å’Œé¡¹ç›® ç»è¿‡æ¯”è¾ƒå‡ ä¸ªå¤§å‚çš„vps æ¨èé˜¿é‡Œäº‘ <a href="https://promotion.aliyun.com/ntms/act/campus2018.html">è´­ä¹°åœ°å€</a></p><p>è¿™é‡Œæˆ‘ä¹°çš„æ˜¯ç¬¬äºŒæ¬¾<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/WX20190707-140757@2x_1562479700993.png" alt="WX20190707-140757@2x">è´­ä¹°å®Œæˆä¹‹ååœ¨æ§åˆ¶å° æŸ¥çœ‹è‡ªå·±çš„ECS äº‘æœåŠ¡å™¨<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/WX20190707-141000@2x_1562479814153.png" alt="WX20190707-141000@2x">åœ¨ç½‘ç»œä¸å®‰å…¨ä¸­ å®‰å…¨ç»„ é…ç½® ä¸‹é¢è¿˜éœ€è¦æ·»åŠ å®‰å…¨ç»„ ç”¨æ¥åé¢åœ¨å¤–éƒ¨è®¿é—®å„ç§ç«¯å£ è¿™é‡Œæˆ‘æ¯”è¾ƒæ‡’ å°±ç›´æ¥å°†å…¨éƒ¨ç«¯å£å¼€æ”¾ å½“ç„¶è¿™æ˜¯ä¸å¤ªå®‰å…¨çš„<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/WX20190707-141206@2x_1562480012754.png" alt="WX20190707-141206@2x"></p><p>å†å›åˆ°å®ä¾‹ åŠ å…¥å®‰å…¨ç»„<img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/WX20190707-141549@2x_1562480182400.png" alt="WX20190707-141549@2x"></p><p>æœ€åç”¨è¿œç¨‹è¿æ¥å·¥å…·è¿æ¥ä¸Šä¹‹å å°±å¼€å§‹äº‘æœåŠ¡ä¹‹æ—…å•¦</p>]]></content>
    
    
    
    <tags>
      
      <tag>éƒ¨ç½²</tag>
      
      <tag>æœåŠ¡å™¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Mybatisç»å…¸9ç§è®¾è®¡æ¨¡å¼</title>
    <link href="/blog/2021/01/04/Mybatis%E7%BB%8F%E5%85%B89%E7%A7%8D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    <url>/blog/2021/01/04/Mybatis%E7%BB%8F%E5%85%B89%E7%A7%8D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è™½ç„¶æˆ‘ä»¬éƒ½çŸ¥é“æœ‰26ä¸ªè®¾è®¡æ¨¡å¼ï¼Œä½†æ˜¯å¤§å¤šåœç•™åœ¨æ¦‚å¿µå±‚é¢ï¼ŒçœŸå®å¼€å‘ä¸­å¾ˆå°‘é‡åˆ°ï¼ŒMybatisæºç ä¸­ä½¿ç”¨äº†å¤§é‡çš„è®¾è®¡æ¨¡å¼ï¼Œé˜…è¯»æºç å¹¶è§‚å¯Ÿè®¾è®¡æ¨¡å¼åœ¨å…¶ä¸­çš„åº”ç”¨ï¼Œèƒ½å¤Ÿæ›´æ·±å…¥çš„ç†è§£è®¾è®¡æ¨¡å¼ã€‚</p><h2 id="Mybatisè‡³å°‘é‡åˆ°äº†ä»¥ä¸‹çš„è®¾è®¡æ¨¡å¼çš„ä½¿ç”¨"><a href="#Mybatisè‡³å°‘é‡åˆ°äº†ä»¥ä¸‹çš„è®¾è®¡æ¨¡å¼çš„ä½¿ç”¨" class="headerlink" title="Mybatisè‡³å°‘é‡åˆ°äº†ä»¥ä¸‹çš„è®¾è®¡æ¨¡å¼çš„ä½¿ç”¨"></a>Mybatisè‡³å°‘é‡åˆ°äº†ä»¥ä¸‹çš„è®¾è®¡æ¨¡å¼çš„ä½¿ç”¨</h2><h2 id="1ã€Builderæ¨¡å¼"><a href="#1ã€Builderæ¨¡å¼" class="headerlink" title="1ã€Builderæ¨¡å¼"></a>1ã€Builderæ¨¡å¼</h2><p>ä¾‹å¦‚SqlSessionFactoryBuilderã€XMLConfigBuilderã€XMLMapperBuilderã€XMLStatementBuilderã€CacheBuilderã€‚</p><h2 id="2ã€å·¥å‚æ¨¡å¼"><a href="#2ã€å·¥å‚æ¨¡å¼" class="headerlink" title="2ã€å·¥å‚æ¨¡å¼"></a>2ã€å·¥å‚æ¨¡å¼</h2><p>ä¾‹å¦‚SqlSessionFactoryã€ObjectFactoryã€MapperProxyFactoryã€‚</p><h2 id="3ã€å•ä¾‹æ¨¡å¼"><a href="#3ã€å•ä¾‹æ¨¡å¼" class="headerlink" title="3ã€å•ä¾‹æ¨¡å¼"></a>3ã€å•ä¾‹æ¨¡å¼</h2><p>ä¾‹å¦‚ErrorContextå’ŒLogFactoryã€‚</p><h2 id="4ã€ä»£ç†æ¨¡å¼"><a href="#4ã€ä»£ç†æ¨¡å¼" class="headerlink" title="4ã€ä»£ç†æ¨¡å¼"></a>4ã€ä»£ç†æ¨¡å¼</h2><p>Mybatiså®ç°çš„æ ¸å¿ƒï¼Œæ¯”å¦‚MapperProxyã€ConnectionLoggerï¼Œç”¨çš„jdkçš„åŠ¨æ€ä»£ç†ï¼›è¿˜æœ‰executor.loaderåŒ…ä½¿ç”¨äº†cglibæˆ–è€…javassistè¾¾åˆ°å»¶è¿ŸåŠ è½½çš„æ•ˆæœã€‚</p><h2 id="5ã€ç»„åˆæ¨¡å¼"><a href="#5ã€ç»„åˆæ¨¡å¼" class="headerlink" title="5ã€ç»„åˆæ¨¡å¼"></a>5ã€ç»„åˆæ¨¡å¼</h2><p>ä¾‹å¦‚SqlNodeå’Œå„ä¸ªå­ç±»ChooseSqlNodeç­‰ã€‚</p><h2 id="6ã€æ¨¡æ¿æ–¹æ³•æ¨¡å¼"><a href="#6ã€æ¨¡æ¿æ–¹æ³•æ¨¡å¼" class="headerlink" title="6ã€æ¨¡æ¿æ–¹æ³•æ¨¡å¼"></a>6ã€æ¨¡æ¿æ–¹æ³•æ¨¡å¼</h2><p>ä¾‹å¦‚BaseExecutorå’ŒSimpleExecutorï¼Œè¿˜æœ‰BaseTypeHandlerå’Œæ‰€æœ‰çš„å­ç±»ä¾‹å¦‚IntegerTypeHandlerã€‚</p><h2 id="7ã€é€‚é…å™¨æ¨¡å¼"><a href="#7ã€é€‚é…å™¨æ¨¡å¼" class="headerlink" title="7ã€é€‚é…å™¨æ¨¡å¼"></a>7ã€é€‚é…å™¨æ¨¡å¼</h2><p>ä¾‹å¦‚Logçš„Mybatisæ¥å£å’Œå®ƒå¯¹jdbcã€log4jç­‰å„ç§æ—¥å¿—æ¡†æ¶çš„é€‚é…å®ç°ã€‚</p><h2 id="8ã€è£…é¥°è€…æ¨¡å¼"><a href="#8ã€è£…é¥°è€…æ¨¡å¼" class="headerlink" title="8ã€è£…é¥°è€…æ¨¡å¼"></a>8ã€è£…é¥°è€…æ¨¡å¼</h2><p>ä¾‹å¦‚CacheåŒ…ä¸­çš„cache.decoratorså­åŒ…ä¸­ç­‰å„ä¸ªè£…é¥°è€…çš„å®ç°ã€‚</p><h2 id="9ã€è¿­ä»£å™¨æ¨¡å¼"><a href="#9ã€è¿­ä»£å™¨æ¨¡å¼" class="headerlink" title="9ã€è¿­ä»£å™¨æ¨¡å¼"></a>9ã€è¿­ä»£å™¨æ¨¡å¼</h2><p>ä¾‹å¦‚è¿­ä»£å™¨æ¨¡å¼PropertyTokenizerã€‚</p><p><strong>æ¥ä¸‹æ¥æŒ¨ä¸ªæ¨¡å¼è¿›è¡Œè§£è¯»ï¼Œå…ˆä»‹ç»æ¨¡å¼è‡ªèº«çš„çŸ¥è¯†ï¼Œç„¶åè§£è¯»åœ¨Mybatisä¸­æ€æ ·åº”ç”¨äº†è¯¥æ¨¡å¼ã€‚</strong></p><h2 id="ä¸€ã€Builderæ¨¡å¼"><a href="#ä¸€ã€Builderæ¨¡å¼" class="headerlink" title="ä¸€ã€Builderæ¨¡å¼"></a>ä¸€ã€Builderæ¨¡å¼</h2><p>Builderæ¨¡å¼çš„å®šä¹‰æ˜¯â€œå°†ä¸€ä¸ªå¤æ‚å¯¹è±¡çš„æ„å»ºä¸å®ƒçš„è¡¨ç¤ºåˆ†ç¦»ï¼Œä½¿å¾—åŒæ ·çš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºã€‚â€ï¼Œå®ƒå±äºåˆ›å»ºç±»æ¨¡å¼ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡çš„æ„å»ºæ¯”è¾ƒå¤æ‚ï¼Œè¶…å‡ºäº†æ„é€ å‡½æ•°æ‰€èƒ½åŒ…å«çš„èŒƒå›´ï¼Œå°±å¯ä»¥ä½¿ç”¨å·¥å‚æ¨¡å¼å’ŒBuilderæ¨¡å¼ï¼Œç›¸å¯¹äºå·¥å‚æ¨¡å¼ä¼šäº§å‡ºä¸€ä¸ªå®Œæ•´çš„äº§å“ï¼ŒBuilderåº”ç”¨äºæ›´åŠ å¤æ‚çš„å¯¹è±¡çš„æ„å»ºï¼Œç”šè‡³åªä¼šæ„å»ºäº§å“çš„ä¸€ä¸ªéƒ¨åˆ†ã€‚</p><p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p><p>åœ¨Mybatisç¯å¢ƒçš„åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼ŒSqlSessionFactoryBuilderä¼šè°ƒç”¨XMLConfigBuilderè¯»å–æ‰€æœ‰çš„MybatisMapConfig.xmlå’Œæ‰€æœ‰çš„Mapper.xmlæ–‡ä»¶ï¼Œæ„å»ºMybatisè¿è¡Œçš„æ ¸å¿ƒå¯¹è±¡Configurationå¯¹è±¡ï¼Œç„¶åå°†è¯¥Configurationå¯¹è±¡ä½œä¸ºå‚æ•°æ„å»ºä¸€ä¸ªSqlSessionFactoryå¯¹è±¡ã€‚</p><p>å…¶ä¸­XMLConfigBuilderåœ¨æ„å»ºConfigurationå¯¹è±¡æ—¶ï¼Œä¹Ÿä¼šè°ƒç”¨XMLMapperBuilderç”¨äºè¯»å–*Mapperæ–‡ä»¶ï¼Œè€ŒXMLMapperBuilderä¼šä½¿ç”¨XMLStatementBuilderæ¥è¯»å–å’Œbuildæ‰€æœ‰çš„SQLè¯­å¥ã€‚</p><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸€ä¸ªç›¸ä¼¼çš„ç‰¹ç‚¹ï¼Œå°±æ˜¯è¿™äº›Builderä¼šè¯»å–æ–‡ä»¶æˆ–è€…é…ç½®ï¼Œç„¶ååšå¤§é‡çš„XpathParserè§£æã€é…ç½®æˆ–è¯­æ³•çš„è§£æã€åå°„ç”Ÿæˆå¯¹è±¡ã€å­˜å…¥ç»“æœç¼“å­˜ç­‰æ­¥éª¤ï¼Œè¿™ä¹ˆå¤šçš„å·¥ä½œéƒ½ä¸æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°æ‰€èƒ½åŒ…æ‹¬çš„ï¼Œå› æ­¤å¤§é‡é‡‡ç”¨äº†Builderæ¨¡å¼æ¥è§£å†³ã€‚</p><p><strong>å¯¹äºbuilderçš„å…·ä½“ç±»ï¼Œæ–¹æ³•éƒ½å¤§éƒ½ç”¨build*å¼€å¤´ï¼Œæ¯”å¦‚SqlSessionFactoryBuilderä¸ºä¾‹ï¼Œå®ƒåŒ…å«ä»¥ä¸‹æ–¹æ³•ï¼š</strong></p><p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p><p>å³æ ¹æ®ä¸åŒçš„è¾“å…¥å‚æ•°æ¥æ„å»ºSqlSessionFactoryè¿™ä¸ªå·¥å‚å¯¹è±¡ã€‚</p><h2 id="äºŒã€å·¥å‚æ¨¡å¼"><a href="#äºŒã€å·¥å‚æ¨¡å¼" class="headerlink" title="äºŒã€å·¥å‚æ¨¡å¼"></a>äºŒã€å·¥å‚æ¨¡å¼</h2><p>åœ¨Mybatisä¸­æ¯”å¦‚SqlSessionFactoryä½¿ç”¨çš„æ˜¯å·¥å‚æ¨¡å¼ï¼Œè¯¥å·¥å‚æ²¡æœ‰é‚£ä¹ˆå¤æ‚çš„é€»è¾‘ï¼Œæ˜¯ä¸€ä¸ªç®€å•å·¥å‚æ¨¡å¼ã€‚</p><p>ç®€å•å·¥å‚æ¨¡å¼(Simple Factory Pattern)ï¼šåˆç§°ä¸ºé™æ€å·¥å‚æ–¹æ³•(Static Factory Method)æ¨¡å¼ï¼Œå®ƒå±äºç±»åˆ›å»ºå‹æ¨¡å¼ã€‚åœ¨ç®€å•å·¥å‚æ¨¡å¼ä¸­ï¼Œå¯ä»¥æ ¹æ®å‚æ•°çš„ä¸åŒè¿”å›ä¸åŒç±»çš„å®ä¾‹ã€‚ç®€å•å·¥å‚æ¨¡å¼ä¸“é—¨å®šä¹‰ä¸€ä¸ªç±»æ¥è´Ÿè´£åˆ›å»ºå…¶ä»–ç±»çš„å®ä¾‹ï¼Œè¢«åˆ›å»ºçš„å®ä¾‹é€šå¸¸éƒ½å…·æœ‰å…±åŒçš„çˆ¶ç±»ã€‚</p><p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p><p>SqlSessionå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªMybatiså·¥ä½œçš„æ ¸å¿ƒçš„æ¥å£ï¼Œé€šè¿‡è¿™ä¸ªæ¥å£å¯ä»¥æ‰§è¡Œæ‰§è¡ŒSQLè¯­å¥ã€è·å–Mappersã€ç®¡ç†äº‹åŠ¡ã€‚ç±»ä¼¼äºè¿æ¥MySQLçš„Connectionå¯¹è±¡ã€‚</p><p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¯¥Factoryçš„openSessionæ–¹æ³•é‡è½½äº†å¾ˆå¤šä¸ªï¼Œåˆ†åˆ«æ”¯æŒautoCommitã€Executorã€Transactionç­‰å‚æ•°çš„è¾“å…¥ï¼Œæ¥æ„å»ºæ ¸å¿ƒçš„SqlSessionå¯¹è±¡ã€‚</p><p><strong>åœ¨DefaultSqlSessionFactoryçš„é»˜è®¤å·¥å‚å®ç°é‡Œï¼Œæœ‰ä¸€ä¸ªæ–¹æ³•å¯ä»¥çœ‹å‡ºå·¥å‚æ€ä¹ˆäº§å‡ºä¸€ä¸ªäº§å“ï¼š</strong></p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">private</span> SqlSession openSessionFromDataSource(ExecutorType execType, TransactionIsolationLevel level,<br><span class="hljs-keyword">boolean</span> autoCommit) &#123;<br>Transaction tx = <span class="hljs-keyword">null</span>;<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-keyword">final</span> Environment environment = configuration.getEnvironment();<br><span class="hljs-keyword">final</span> TransactionFactory transactionFactory = getTransactionFactoryFromEnvironment(environment);<br>tx = transactionFactory.newTransaction(environment.getDataSource(), level, autoCommit);<br><span class="hljs-keyword">final</span> Executor executor = configuration.newExecutor(tx, execType);<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DefaultSqlSession(configuration, executor, autoCommit);<br>&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>closeTransaction(tx); <span class="hljs-comment">// may have fetched a connection so lets call</span><br><span class="hljs-comment">// close()</span><br><span class="hljs-keyword">throw</span> ExceptionFactory.wrapException(<span class="hljs-string">&quot;Error opening session.  Cause: &quot;</span> + e, e);<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>ErrorContext.instance().reset();<br>&#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªopenSessionè°ƒç”¨çš„åº•å±‚æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å…ˆä»configurationè¯»å–å¯¹åº”çš„ç¯å¢ƒé…ç½®ï¼Œç„¶ååˆå§‹åŒ–TransactionFactoryè·å¾—ä¸€ä¸ªTransactionå¯¹è±¡ï¼Œç„¶åé€šè¿‡Transactionè·å–ä¸€ä¸ªExecutorå¯¹è±¡ï¼Œæœ€åé€šè¿‡configurationã€Executorã€æ˜¯å¦autoCommitä¸‰ä¸ªå‚æ•°æ„å»ºäº†SqlSessionã€‚</p><p>åœ¨è¿™é‡Œå…¶å®ä¹Ÿå¯ä»¥çœ‹åˆ°ç«¯å€ªï¼ŒSqlSessionçš„æ‰§è¡Œï¼Œå…¶å®æ˜¯å§”æ‰˜ç»™å¯¹åº”çš„Executoræ¥è¿›è¡Œçš„ã€‚</p><p><strong>è€Œå¯¹äºLogFactoryï¼Œå®ƒçš„å®ç°ä»£ç ï¼š</strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> final <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LogFactory</span> </span>&#123;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Constructor&lt;? <span class="hljs-keyword">extends</span> Log&gt; logConstructor;<br><br><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-title">LogFactory</span>(<span class="hljs-params"></span>)</span> &#123;<br><span class="hljs-comment">// disable construction</span><br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Log <span class="hljs-function"><span class="hljs-title">getLog</span>(<span class="hljs-params">Class&lt;?&gt; aClass</span>)</span> &#123;<br><span class="hljs-keyword">return</span> getLog(aClass.getName());<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸ªç‰¹åˆ«çš„åœ°æ–¹ï¼Œæ˜¯Logå˜é‡çš„çš„ç±»å‹æ˜¯Constructor&lt;? extends Log&gt;ï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥å·¥å‚ç”Ÿäº§çš„ä¸åªæ˜¯ä¸€ä¸ªäº§å“ï¼Œè€Œæ˜¯å…·æœ‰Logå…¬å…±æ¥å£çš„ä¸€ç³»åˆ—äº§å“ï¼Œæ¯”å¦‚Log4jImplã€Slf4jImplç­‰å¾ˆå¤šå…·ä½“çš„Logã€‚</p><h2 id="ä¸‰ã€å•ä¾‹æ¨¡å¼"><a href="#ä¸‰ã€å•ä¾‹æ¨¡å¼" class="headerlink" title="ä¸‰ã€å•ä¾‹æ¨¡å¼"></a>ä¸‰ã€å•ä¾‹æ¨¡å¼</h2><p>å•ä¾‹æ¨¡å¼(Singleton Pattern)ï¼šå•ä¾‹æ¨¡å¼ç¡®ä¿æŸä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œè€Œä¸”è‡ªè¡Œå®ä¾‹åŒ–å¹¶å‘æ•´ä¸ªç³»ç»Ÿæä¾›è¿™ä¸ªå®ä¾‹ï¼Œè¿™ä¸ªç±»ç§°ä¸ºå•ä¾‹ç±»ï¼Œå®ƒæä¾›å…¨å±€è®¿é—®çš„æ–¹æ³•ã€‚</p><p>å•ä¾‹æ¨¡å¼çš„è¦ç‚¹æœ‰ä¸‰ä¸ªï¼šä¸€æ˜¯æŸä¸ªç±»åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹ï¼›äºŒæ˜¯å®ƒå¿…é¡»è‡ªè¡Œåˆ›å»ºè¿™ä¸ªå®ä¾‹ï¼›ä¸‰æ˜¯å®ƒå¿…é¡»è‡ªè¡Œå‘æ•´ä¸ªç³»ç»Ÿæä¾›è¿™ä¸ªå®ä¾‹ã€‚å•ä¾‹æ¨¡å¼æ˜¯ä¸€ç§å¯¹è±¡åˆ›å»ºå‹æ¨¡å¼ã€‚å•ä¾‹æ¨¡å¼åˆåå•ä»¶æ¨¡å¼æˆ–å•æ€æ¨¡å¼ã€‚</p><p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p><p>åœ¨Mybatisä¸­æœ‰ä¸¤ä¸ªåœ°æ–¹ç”¨åˆ°å•ä¾‹æ¨¡å¼ï¼ŒErrorContextå’ŒLogFactoryï¼Œå…¶ä¸­ErrorContextæ˜¯ç”¨åœ¨æ¯ä¸ªçº¿ç¨‹èŒƒå›´å†…çš„å•ä¾‹ï¼Œç”¨äºè®°å½•è¯¥çº¿ç¨‹çš„æ‰§è¡Œç¯å¢ƒé”™è¯¯ä¿¡æ¯ï¼Œè€ŒLogFactoryåˆ™æ˜¯æä¾›ç»™æ•´ä¸ªMybatisä½¿ç”¨çš„æ—¥å¿—å·¥å‚ï¼Œç”¨äºè·å¾—é’ˆå¯¹é¡¹ç›®é…ç½®å¥½çš„æ—¥å¿—å¯¹è±¡ã€‚</p><p><strong>ErrorContextçš„å•ä¾‹å®ç°ä»£ç ï¼š</strong></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ErrorContext</span> &#123;<br><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final <span class="hljs-title">ThreadLocal</span>&lt;<span class="hljs-title">ErrorContext</span>&gt; LOCAL</span> = <span class="hljs-keyword">new</span> ThreadLocal&lt;ErrorContext&gt;();<br><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">ErrorContext</span>(<span class="hljs-params"></span>)</span> &#123;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ErrorContext <span class="hljs-title">instance</span>(<span class="hljs-params"></span>)</span> &#123;<br>ErrorContext context = LOCAL.<span class="hljs-keyword">get</span>();<br><span class="hljs-keyword">if</span> (context == <span class="hljs-literal">null</span>) &#123;<br>context = <span class="hljs-keyword">new</span> ErrorContext();<br>LOCAL.<span class="hljs-keyword">set</span>(context);<br>&#125;<br><span class="hljs-keyword">return</span> context;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>æ„é€ å‡½æ•°æ˜¯privateä¿®é¥°ï¼Œå…·æœ‰ä¸€ä¸ªstaticçš„å±€éƒ¨instanceå˜é‡å’Œä¸€ä¸ªè·å–instanceå˜é‡çš„æ–¹æ³•ï¼Œåœ¨è·å–å®ä¾‹çš„æ–¹æ³•ä¸­ï¼Œå…ˆåˆ¤æ–­æ˜¯å¦ä¸ºç©ºå¦‚æœæ˜¯çš„è¯å°±å…ˆåˆ›å»ºï¼Œç„¶åè¿”å›æ„é€ å¥½çš„å¯¹è±¡ã€‚</p><p>åªæ˜¯è¿™é‡Œæœ‰ä¸ªæœ‰è¶£çš„åœ°æ–¹æ˜¯ï¼ŒLOCALçš„é™æ€å®ä¾‹å˜é‡ä½¿ç”¨äº†ThreadLocalä¿®é¥°ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒå±äºæ¯ä¸ªçº¿ç¨‹å„è‡ªçš„æ•°æ®ï¼Œè€Œåœ¨instance()æ–¹æ³•ä¸­ï¼Œå…ˆè·å–æœ¬çº¿ç¨‹çš„è¯¥å®ä¾‹ï¼Œå¦‚æœæ²¡æœ‰å°±åˆ›å»ºè¯¥çº¿ç¨‹ç‹¬æœ‰çš„ErrorContextã€‚</p><h2 id="å››ã€ä»£ç†æ¨¡å¼"><a href="#å››ã€ä»£ç†æ¨¡å¼" class="headerlink" title="å››ã€ä»£ç†æ¨¡å¼"></a>å››ã€ä»£ç†æ¨¡å¼</h2><p>ä»£ç†æ¨¡å¼å¯ä»¥è®¤ä¸ºæ˜¯Mybatisçš„æ ¸å¿ƒä½¿ç”¨çš„æ¨¡å¼ï¼Œæ­£æ˜¯ç”±äºè¿™ä¸ªæ¨¡å¼ï¼Œæˆ‘ä»¬åªéœ€è¦ç¼–å†™Mapper.javaæ¥å£ï¼Œä¸éœ€è¦å®ç°ï¼Œç”±Mybatisåå°å¸®æˆ‘ä»¬å®Œæˆå…·ä½“SQLçš„æ‰§è¡Œã€‚</p><p>ä»£ç†æ¨¡å¼(Proxy Pattern) ï¼šç»™æŸä¸€ä¸ªå¯¹è±¡æä¾›ä¸€ä¸ªä»£ ç†ï¼Œå¹¶ç”±ä»£ç†å¯¹è±¡æ§åˆ¶å¯¹åŸå¯¹è±¡çš„å¼•ç”¨ã€‚ä»£ç†æ¨¡å¼çš„è‹± æ–‡å«åšProxyæˆ–Surrogateï¼Œå®ƒæ˜¯ä¸€ç§å¯¹è±¡ç»“æ„å‹æ¨¡å¼ã€‚</p><p><strong>ä»£ç†æ¨¡å¼åŒ…å«å¦‚ä¸‹è§’è‰²ï¼š</strong></p><h3 id="1-Subject"><a href="#1-Subject" class="headerlink" title="1.Subject:"></a>1.Subject:</h3><p>æŠ½è±¡ä¸»é¢˜è§’è‰²</p><h3 id="2-Proxy"><a href="#2-Proxy" class="headerlink" title="2.Proxy:"></a>2.Proxy:</h3><p>ä»£ç†ä¸»é¢˜è§’è‰²</p><h3 id="3-RealSubject"><a href="#3-RealSubject" class="headerlink" title="3.RealSubject:"></a>3.RealSubject:</h3><p>çœŸå®ä¸»é¢˜è§’è‰²</p><p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p><p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p><p>è¿™é‡Œæœ‰ä¸¤ä¸ªæ­¥éª¤ï¼Œç¬¬ä¸€ä¸ªæ˜¯æå‰åˆ›å»ºä¸€ä¸ªProxyï¼Œç¬¬äºŒä¸ªæ˜¯ä½¿ç”¨çš„æ—¶å€™ä¼šè‡ªåŠ¨è¯·æ±‚Proxyï¼Œç„¶åç”±Proxyæ¥æ‰§è¡Œå…·ä½“äº‹åŠ¡ï¼› å½“æˆ‘ä»¬ä½¿ç”¨Configurationçš„getMapperæ–¹æ³•æ—¶ï¼Œä¼šè°ƒç”¨mapperRegistry.getMapperæ–¹æ³•ï¼Œè€Œè¯¥æ–¹æ³•åˆä¼šè°ƒç”¨mapperProxyFactory.newInstance(sqlSession)æ¥ç”Ÿæˆä¸€ä¸ªå…·ä½“çš„ä»£ç†ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author </span>Lasse Voss</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MapperProxyFactory</span>&lt;<span class="hljs-title">T</span>&gt; </span>&#123;<br><br><span class="hljs-keyword">private</span> final Class&lt;T&gt; mapperInterface;<br><span class="hljs-keyword">private</span> final <span class="hljs-built_in">Map</span>&lt;Method, MapperMethod&gt; methodCache = <span class="hljs-keyword">new</span> ConcurrentHashMap&lt;Method, MapperMethod&gt;();<br><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-title">MapperProxyFactory</span>(<span class="hljs-params">Class&lt;T&gt; mapperInterface</span>)</span> &#123;<br><span class="hljs-built_in">this</span>.mapperInterface = mapperInterface;<br>&#125;<br><br><span class="hljs-keyword">public</span> Class&lt;T&gt; <span class="hljs-function"><span class="hljs-title">getMapperInterface</span>(<span class="hljs-params"></span>)</span> &#123;<br><span class="hljs-keyword">return</span> mapperInterface;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-built_in">Map</span>&lt;Method, MapperMethod&gt; <span class="hljs-function"><span class="hljs-title">getMethodCache</span>(<span class="hljs-params"></span>)</span> &#123;<br><span class="hljs-keyword">return</span> methodCache;<br>&#125;<br><br><span class="hljs-meta">@SuppressWarnings</span>(<span class="hljs-string">&quot;unchecked&quot;</span>)<br><span class="hljs-keyword">protected</span> T <span class="hljs-function"><span class="hljs-title">newInstance</span>(<span class="hljs-params">MapperProxy&lt;T&gt; mapperProxy</span>)</span> &#123;<br><span class="hljs-keyword">return</span> (T) <span class="hljs-built_in">Proxy</span>.newProxyInstance(mapperInterface.getClassLoader(), <span class="hljs-keyword">new</span> Class[] &#123; mapperInterface &#125;,<br>mapperProxy);<br>&#125;<br><br><span class="hljs-keyword">public</span> T <span class="hljs-function"><span class="hljs-title">newInstance</span>(<span class="hljs-params">SqlSession sqlSession</span>)</span> &#123;<br>final MapperProxy&lt;T&gt; mapperProxy = <span class="hljs-keyword">new</span> MapperProxy&lt;T&gt;(sqlSession, mapperInterface, methodCache);<br><span class="hljs-keyword">return</span> newInstance(mapperProxy);<br>&#125;<br><br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œï¼Œå…ˆé€šè¿‡T newInstance(SqlSession sqlSession)æ–¹æ³•ä¼šå¾—åˆ°ä¸€ä¸ªMapperProxyå¯¹è±¡ï¼Œç„¶åè°ƒç”¨T newInstance(MapperProxymapperProxy)ç”Ÿæˆä»£ç†å¯¹è±¡ç„¶åè¿”å›ã€‚</p><p><strong>è€ŒæŸ¥çœ‹MapperProxyçš„ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹å†…å®¹ï¼š</strong></p><figure class="highlight monkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs monkey"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MapperProxy</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title">InvocationHandler</span>, <span class="hljs-title">Serializable</span> &#123;</span><br><br>@Override<br><span class="hljs-keyword">public</span> Object invoke(Object proxy, <span class="hljs-function"><span class="hljs-keyword">Method</span> <span class="hljs-title">method</span>, <span class="hljs-title">Object</span>[] <span class="hljs-title">args</span>) <span class="hljs-title">throws</span> <span class="hljs-title">Throwable</span> &#123;</span><br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-keyword">if</span> (Object.class.equals(method.getDeclaringClass())) &#123;<br><span class="hljs-keyword">return</span> method.invoke(this, args);<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isDefaultMethod(<span class="hljs-function"><span class="hljs-keyword">method</span>)) &#123;</span><br><span class="hljs-keyword">return</span> invokeDefaultMethod(proxy, <span class="hljs-function"><span class="hljs-keyword">method</span>, <span class="hljs-title">args</span>);</span><br>&#125;<br>&#125; <span class="hljs-keyword">catch</span> (Throwable t) &#123;<br><span class="hljs-keyword">throw</span> ExceptionUtil.unwrapThrowable(t);<br>&#125;<br><span class="hljs-keyword">final</span> MapperMethod mapperMethod = cachedMapperMethod(<span class="hljs-function"><span class="hljs-keyword">method</span>);</span><br><span class="hljs-keyword">return</span> mapperMethod.execute(sqlSession, args);<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>éå¸¸å…¸å‹çš„ï¼Œè¯¥MapperProxyç±»å®ç°äº†InvocationHandleræ¥å£ï¼Œå¹¶ä¸”å®ç°äº†è¯¥æ¥å£çš„invokeæ–¹æ³•ã€‚</p><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬åªéœ€è¦ç¼–å†™Mapper.javaæ¥å£ç±»ï¼Œå½“çœŸæ­£æ‰§è¡Œä¸€ä¸ªMapperæ¥å£çš„æ—¶å€™ï¼Œå°±ä¼šè½¬å‘ç»™MapperProxy.invokeæ–¹æ³•ï¼Œè€Œè¯¥æ–¹æ³•åˆ™ä¼šè°ƒç”¨åç»­çš„sqlSession.cud&gt;executor.execute&gt;prepareStatementç­‰ä¸€ç³»åˆ—æ–¹æ³•ï¼Œå®ŒæˆSQLçš„æ‰§è¡Œå’Œè¿”å›ã€‚</p><h2 id="äº”ã€ç»„åˆæ¨¡å¼"><a href="#äº”ã€ç»„åˆæ¨¡å¼" class="headerlink" title="äº”ã€ç»„åˆæ¨¡å¼"></a>äº”ã€ç»„åˆæ¨¡å¼</h2><p>ç»„åˆæ¨¡å¼ç»„åˆå¤šä¸ªå¯¹è±¡å½¢æˆæ ‘å½¢ç»“æ„ä»¥è¡¨ç¤ºâ€œæ•´ä½“-éƒ¨åˆ†â€çš„ç»“æ„å±‚æ¬¡ã€‚</p><p>ç»„åˆæ¨¡å¼å¯¹å•ä¸ªå¯¹è±¡(å¶å­å¯¹è±¡)å’Œç»„åˆå¯¹è±¡(ç»„åˆå¯¹è±¡)å…·æœ‰ä¸€è‡´æ€§ï¼Œå®ƒå°†å¯¹è±¡ç»„ç»‡åˆ°æ ‘ç»“æ„ä¸­ï¼Œå¯ä»¥ç”¨æ¥æè¿°æ•´ä½“ä¸éƒ¨åˆ†çš„å…³ç³»ã€‚åŒæ—¶å®ƒä¹Ÿæ¨¡ç³Šäº†ç®€å•å…ƒç´ (å¶å­å¯¹è±¡)å’Œå¤æ‚å…ƒç´ (å®¹å™¨å¯¹è±¡)çš„æ¦‚å¿µï¼Œä½¿å¾—å®¢æˆ·èƒ½å¤Ÿåƒå¤„ç†ç®€å•å…ƒç´ ä¸€æ ·æ¥å¤„ç†å¤æ‚å…ƒç´ ï¼Œä»è€Œä½¿å®¢æˆ·ç¨‹åºèƒ½å¤Ÿä¸å¤æ‚å…ƒç´ çš„å†…éƒ¨ç»“æ„è§£è€¦ã€‚</p><p>åœ¨ä½¿ç”¨ç»„åˆæ¨¡å¼ä¸­éœ€è¦æ³¨æ„ä¸€ç‚¹ä¹Ÿæ˜¯ç»„åˆæ¨¡å¼æœ€å…³é”®çš„åœ°æ–¹ï¼šå¶å­å¯¹è±¡å’Œç»„åˆå¯¹è±¡å®ç°ç›¸åŒçš„æ¥å£ã€‚è¿™å°±æ˜¯ç»„åˆæ¨¡å¼èƒ½å¤Ÿå°†å¶å­èŠ‚ç‚¹å’Œå¯¹è±¡èŠ‚ç‚¹è¿›è¡Œä¸€è‡´å¤„ç†çš„åŸå› ã€‚</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fce4762c12a74809aacc0143f05a2ce7~tplv-k3u1fbpfcp-watermark.image" alt="img"></p><p><strong>Mybatisæ”¯æŒåŠ¨æ€SQLçš„å¼ºå¤§åŠŸèƒ½ï¼Œæ¯”å¦‚ä¸‹é¢çš„è¿™ä¸ªSQLï¼š</strong></p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;update&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;org.format.dynamicproxy.mybatis.bean.User&quot;</span>&gt;</span></span><br><span class="xml">    UPDATE users</span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">trim</span> <span class="hljs-attr">prefix</span>=<span class="hljs-string">&quot;SET&quot;</span> <span class="hljs-attr">prefixOverrides</span>=<span class="hljs-string">&quot;,&quot;</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;name != null and name != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="xml">            name = #</span><span class="hljs-template-variable">&#123;name&#125;</span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;age != null and age != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="xml">            , age = #</span><span class="hljs-template-variable">&#123;age&#125;</span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;birthday != null and birthday != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="xml">            , birthday = #</span><span class="hljs-template-variable">&#123;birthday&#125;</span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">trim</span>&gt;</span></span><br><span class="xml">    where id = $</span><span class="hljs-template-variable">&#123;id&#125;</span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span></span><br><span class="xml">å¤åˆ¶ä»£ç </span><br></code></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œé¢ä½¿ç”¨åˆ°äº†trimã€ifç­‰åŠ¨æ€å…ƒç´ ï¼Œå¯ä»¥æ ¹æ®æ¡ä»¶æ¥ç”Ÿæˆä¸åŒæƒ…å†µä¸‹çš„SQLï¼›</p><p>åœ¨DynamicSqlSource.getBoundSqlæ–¹æ³•é‡Œï¼Œè°ƒç”¨äº†rootSqlNode.apply(context)æ–¹æ³•ï¼Œapplyæ–¹æ³•æ˜¯æ‰€æœ‰çš„åŠ¨æ€èŠ‚ç‚¹éƒ½å®ç°çš„æ¥å£ï¼š</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-symbol">SqlNode</span> &#123;<br><span class="hljs-built_in">bool</span>ean apply(DynamicContext context);<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p><strong>å¯¹äºå®ç°è¯¥SqlSourceæ¥å£çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œå°±æ˜¯æ•´ä¸ªç»„åˆæ¨¡å¼æ ‘çš„å„ä¸ªèŠ‚ç‚¹ï¼š</strong></p><p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p><p>ç»„åˆæ¨¡å¼çš„ç®€å•ä¹‹å¤„åœ¨äºï¼Œæ‰€æœ‰çš„å­èŠ‚ç‚¹éƒ½æ˜¯åŒä¸€ç±»èŠ‚ç‚¹ï¼Œå¯ä»¥é€’å½’çš„å‘ä¸‹æ‰§è¡Œï¼Œæ¯”å¦‚å¯¹äºTextSqlNodeï¼Œå› ä¸ºå®ƒæ˜¯æœ€åº•å±‚çš„å¶å­èŠ‚ç‚¹ï¼Œæ‰€ä»¥ç›´æ¥å°†å¯¹åº”çš„å†…å®¹appendåˆ°SQLè¯­å¥ä¸­ï¼š</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">@Override<br>public boolean apply(DynamicContext context) &#123;<br>GenericTokenParser parser = create<span class="hljs-constructor">Parser(<span class="hljs-params">new</span> BindingTokenParser(<span class="hljs-params">context</span>, <span class="hljs-params">injectionFilter</span>)</span>);<br>context.append<span class="hljs-constructor">Sql(<span class="hljs-params">parser</span>.<span class="hljs-params">parse</span>(<span class="hljs-params">text</span>)</span>);<br>return <span class="hljs-literal">true</span>;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>ä½†æ˜¯å¯¹äºIfSqlNodeï¼Œå°±éœ€è¦å…ˆåšåˆ¤æ–­ï¼Œå¦‚æœåˆ¤æ–­é€šè¿‡ï¼Œä»ç„¶ä¼šè°ƒç”¨å­å…ƒç´ çš„SqlNodeï¼Œå³contents.applyæ–¹æ³•ï¼Œå®ç°é€’å½’çš„è§£æã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-function"><span class="hljs-title">apply</span>(<span class="hljs-params">DynamicContext context</span>)</span> &#123;<br><span class="hljs-keyword">if</span> (evaluator.evaluateBoolean(test, context.getBindings())) &#123;<br>contents.apply(context);<br><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><h2 id="å…­ã€æ¨¡æ¿æ–¹æ³•æ¨¡å¼"><a href="#å…­ã€æ¨¡æ¿æ–¹æ³•æ¨¡å¼" class="headerlink" title="å…­ã€æ¨¡æ¿æ–¹æ³•æ¨¡å¼"></a>å…­ã€æ¨¡æ¿æ–¹æ³•æ¨¡å¼</h2><p>æ¨¡æ¿æ–¹æ³•æ¨¡å¼æ˜¯æ‰€æœ‰æ¨¡å¼ä¸­æœ€ä¸ºå¸¸è§çš„å‡ ä¸ªæ¨¡å¼ä¹‹ä¸€ï¼Œæ˜¯åŸºäºç»§æ‰¿çš„ä»£ç å¤ç”¨çš„åŸºæœ¬æŠ€æœ¯ã€‚</p><p>æ¨¡æ¿æ–¹æ³•æ¨¡å¼éœ€è¦å¼€å‘æŠ½è±¡ç±»å’Œå…·ä½“å­ç±»çš„è®¾è®¡å¸ˆä¹‹é—´çš„åä½œã€‚ä¸€ä¸ªè®¾è®¡å¸ˆè´Ÿè´£ç»™å‡ºä¸€ä¸ªç®—æ³•çš„è½®å»“å’Œéª¨æ¶ï¼Œå¦ä¸€äº›è®¾è®¡å¸ˆåˆ™è´Ÿè´£ç»™å‡ºè¿™ä¸ªç®—æ³•çš„å„ä¸ªé€»è¾‘æ­¥éª¤ã€‚ä»£è¡¨è¿™äº›å…·ä½“é€»è¾‘æ­¥éª¤çš„æ–¹æ³•ç§°åšåŸºæœ¬æ–¹æ³•(primitive method)ï¼›è€Œå°†è¿™äº›åŸºæœ¬æ–¹æ³•æ±‡æ€»èµ·æ¥çš„æ–¹æ³•å«åšæ¨¡æ¿æ–¹æ³•(template method)ï¼Œè¿™ä¸ªè®¾è®¡æ¨¡å¼çš„åå­—å°±æ˜¯ä»æ­¤è€Œæ¥ã€‚</p><p>æ¨¡æ¿ç±»å®šä¹‰ä¸€ä¸ªæ“ä½œä¸­çš„ç®—æ³•çš„éª¨æ¶ï¼Œè€Œå°†ä¸€äº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ä¸­ã€‚ä½¿å¾—å­ç±»å¯ä»¥ä¸æ”¹å˜ä¸€ä¸ªç®—æ³•çš„ç»“æ„å³å¯é‡å®šä¹‰è¯¥ç®—æ³•çš„æŸäº›ç‰¹å®šæ­¥éª¤ã€‚</p><p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p><p>åœ¨Mybatisä¸­ï¼ŒsqlSessionçš„SQLæ‰§è¡Œï¼Œéƒ½æ˜¯å§”æ‰˜ç»™Executorå®ç°çš„ï¼ŒExecutoråŒ…å«ä»¥ä¸‹ç»“æ„ï¼š</p><p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p><p>å…¶ä¸­çš„BaseExecutorå°±é‡‡ç”¨äº†æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Œå®ƒå®ç°äº†å¤§éƒ¨åˆ†çš„SQLæ‰§è¡Œé€»è¾‘ï¼Œç„¶åæŠŠä»¥ä¸‹å‡ ä¸ªæ–¹æ³•äº¤ç»™å­ç±»å®šåˆ¶åŒ–å®Œæˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">int</span> <span class="hljs-title">doUpdate</span><span class="hljs-params">(MappedStatement ms, Object parameter)</span> <span class="hljs-keyword">throws</span> SQLException</span>;<br><br><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> List&lt;BatchResult&gt; <span class="hljs-title">doFlushStatements</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> isRollback)</span> <span class="hljs-keyword">throws</span> SQLException</span>;<br><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> &lt;E&gt; <span class="hljs-function">List&lt;E&gt; <span class="hljs-title">doQuery</span><span class="hljs-params">(MappedStatement ms, Object parameter, RowBounds rowBounds,</span></span><br><span class="hljs-function"><span class="hljs-params">ResultHandler resultHandler, BoundSql boundSql)</span> <span class="hljs-keyword">throws</span> SQLException</span>;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p><strong>è¯¥æ¨¡æ¿æ–¹æ³•ç±»æœ‰å‡ ä¸ªå­ç±»çš„å…·ä½“å®ç°ï¼Œä½¿ç”¨äº†ä¸åŒçš„ç­–ç•¥ï¼š</strong></p><h3 id="1-ç®€å•SimpleExecutor"><a href="#1-ç®€å•SimpleExecutor" class="headerlink" title="1.ç®€å•SimpleExecutor"></a>1.ç®€å•SimpleExecutor</h3><p>æ¯æ‰§è¡Œä¸€æ¬¡updateæˆ–selectï¼Œå°±å¼€å¯ä¸€ä¸ªStatementå¯¹è±¡ï¼Œç”¨å®Œç«‹åˆ»å…³é—­Statementå¯¹è±¡ã€‚ï¼ˆå¯ä»¥æ˜¯Statementæˆ–PrepareStatementå¯¹è±¡ï¼‰</p><h3 id="2-é‡ç”¨ReuseExecutor"><a href="#2-é‡ç”¨ReuseExecutor" class="headerlink" title="2.é‡ç”¨ReuseExecutor"></a>2.é‡ç”¨ReuseExecutor</h3><p>æ‰§è¡Œupdateæˆ–selectï¼Œä»¥sqlä½œä¸ºkeyæŸ¥æ‰¾Statementå¯¹è±¡ï¼Œå­˜åœ¨å°±ä½¿ç”¨ï¼Œä¸å­˜åœ¨å°±åˆ›å»ºï¼Œç”¨å®Œåï¼Œä¸å…³é—­Statementå¯¹è±¡ï¼Œè€Œæ˜¯æ”¾ç½®äºMap&lt;String, Statement&gt;å†…ï¼Œä¾›ä¸‹ä¸€æ¬¡ä½¿ç”¨ã€‚ï¼ˆå¯ä»¥æ˜¯Statementæˆ–PrepareStatementå¯¹è±¡ï¼‰</p><h3 id="3-æ‰¹é‡BatchExecutor"><a href="#3-æ‰¹é‡BatchExecutor" class="headerlink" title="3.æ‰¹é‡BatchExecutor"></a>3.æ‰¹é‡BatchExecutor</h3><p>æ‰§è¡Œupdateï¼ˆæ²¡æœ‰selectï¼ŒJDBCæ‰¹å¤„ç†ä¸æ”¯æŒselectï¼‰ï¼Œå°†æ‰€æœ‰sqléƒ½æ·»åŠ åˆ°æ‰¹å¤„ç†ä¸­ï¼ˆaddBatch()ï¼‰ï¼Œç­‰å¾…ç»Ÿä¸€æ‰§è¡Œï¼ˆexecuteBatch()ï¼‰ï¼Œå®ƒç¼“å­˜äº†å¤šä¸ªStatementå¯¹è±¡ï¼Œæ¯ä¸ªStatementå¯¹è±¡éƒ½æ˜¯addBatch()å®Œæ¯•åï¼Œç­‰å¾…é€ä¸€æ‰§è¡ŒexecuteBatch()æ‰¹å¤„ç†çš„ï¼›BatchExecutorç›¸å½“äºç»´æŠ¤äº†å¤šä¸ªæ¡¶ï¼Œæ¯ä¸ªæ¡¶é‡Œéƒ½è£…äº†å¾ˆå¤šå±äºè‡ªå·±çš„SQLï¼Œå°±åƒè‹¹æœè“é‡Œè£…äº†å¾ˆå¤šè‹¹æœï¼Œç•ªèŒ„è“é‡Œè£…äº†å¾ˆå¤šç•ªèŒ„ï¼Œæœ€åï¼Œå†ç»Ÿä¸€å€’è¿›ä»“åº“ã€‚ï¼ˆå¯ä»¥æ˜¯Statementæˆ–PrepareStatementå¯¹è±¡ï¼‰</p><p><strong>æ¯”å¦‚åœ¨SimpleExecutorä¸­è¿™æ ·å®ç°updateæ–¹æ³•ï¼š</strong></p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">doUpdate</span><span class="hljs-params">(MappedStatement ms, Object parameter)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>Statement stmt = <span class="hljs-keyword">null</span>;<br><span class="hljs-keyword">try</span> &#123;<br>Configuration configuration = ms.getConfiguration();<br>StatementHandler <span class="hljs-keyword">handler</span> = configuration.newStatementHandler(<span class="hljs-keyword">this</span>, ms, parameter, RowBounds.DEFAULT, <span class="hljs-keyword">null</span>,<br><span class="hljs-keyword">null</span>);<br>stmt = prepareStatement(<span class="hljs-keyword">handler</span>, ms.getStatementLog());<br><span class="hljs-function"><span class="hljs-keyword">return</span> <span class="hljs-keyword">handler</span>.<span class="hljs-title">update</span><span class="hljs-params">(stmt)</span></span>;<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>closeStatement(stmt);<br>&#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><h2 id="ä¸ƒã€é€‚é…å™¨æ¨¡å¼"><a href="#ä¸ƒã€é€‚é…å™¨æ¨¡å¼" class="headerlink" title="ä¸ƒã€é€‚é…å™¨æ¨¡å¼"></a>ä¸ƒã€é€‚é…å™¨æ¨¡å¼</h2><p>é€‚é…å™¨æ¨¡å¼(Adapter Pattern) ï¼šå°†ä¸€ä¸ªæ¥å£è½¬æ¢æˆå®¢æˆ·å¸Œæœ›çš„å¦ä¸€ä¸ªæ¥å£ï¼Œé€‚é…å™¨æ¨¡å¼ä½¿æ¥å£ä¸å…¼å®¹çš„é‚£äº›ç±»å¯ä»¥ä¸€èµ·å·¥ä½œï¼Œå…¶åˆ«åä¸ºåŒ…è£…å™¨(Wrapper)ã€‚é€‚é…å™¨æ¨¡å¼æ—¢å¯ä»¥ä½œä¸ºç±»ç»“æ„å‹æ¨¡å¼ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºå¯¹è±¡ç»“æ„å‹æ¨¡å¼ã€‚</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e6f7fcb8510047b0bc2e09172782ef02~tplv-k3u1fbpfcp-watermark.image" alt="img"></p><p><strong>åœ¨Mybatsiçš„loggingåŒ…ä¸­ï¼Œæœ‰ä¸€ä¸ªLogæ¥å£ï¼š</strong></p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * @author Clinton Begin</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> interface Log &#123;<br><br><span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isDebugEnabled</span><span class="hljs-params">()</span></span>;<br><br><span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isTraceEnabled</span><span class="hljs-params">()</span></span>;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">error</span><span class="hljs-params">(<span class="hljs-keyword">String</span> s, Throwable e)</span></span>;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">error</span><span class="hljs-params">(<span class="hljs-keyword">String</span> s)</span></span>;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">debug</span><span class="hljs-params">(<span class="hljs-keyword">String</span> s)</span></span>;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">trace</span><span class="hljs-params">(<span class="hljs-keyword">String</span> s)</span></span>;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">warn</span><span class="hljs-params">(<span class="hljs-keyword">String</span> s)</span></span>;<br><br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>è¯¥æ¥å£å®šä¹‰äº†Mybatisç›´æ¥ä½¿ç”¨çš„æ—¥å¿—æ–¹æ³•ï¼Œè€ŒLogæ¥å£å…·ä½“ç”±è°æ¥å®ç°å‘¢ï¼ŸMybatisæä¾›äº†å¤šç§æ—¥å¿—æ¡†æ¶çš„å®ç°ï¼Œè¿™äº›å®ç°éƒ½åŒ¹é…è¿™ä¸ªLogæ¥å£æ‰€å®šä¹‰çš„æ¥å£æ–¹æ³•ï¼Œæœ€ç»ˆå®ç°äº†æ‰€æœ‰å¤–éƒ¨æ—¥å¿—æ¡†æ¶åˆ°Mybatisæ—¥å¿—åŒ…çš„é€‚é…ï¼š</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4df50a29785f432996b49e42d807ac60~tplv-k3u1fbpfcp-watermark.image" alt="img"></p><p>æ¯”å¦‚å¯¹äºLog4jImplçš„å®ç°æ¥è¯´ï¼Œè¯¥å®ç°æŒæœ‰äº†org.apache.log4j.Loggerçš„å®ä¾‹ï¼Œç„¶åæ‰€æœ‰çš„æ—¥å¿—æ–¹æ³•ï¼Œå‡å§”æ‰˜è¯¥å®ä¾‹æ¥å®ç°ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Log4jImpl</span> <span class="hljs-title">implements</span> <span class="hljs-title">Log</span> </span>&#123;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final <span class="hljs-built_in">String</span> FQCN = Log4jImpl.class.getName();<br><br><span class="hljs-keyword">private</span> Logger log;<br><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-title">Log4jImpl</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> clazz</span>)</span> &#123;<br>log = Logger.getLogger(clazz);<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-function"><span class="hljs-title">isDebugEnabled</span>(<span class="hljs-params"></span>)</span> &#123;<br><span class="hljs-keyword">return</span> log.isDebugEnabled();<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-function"><span class="hljs-title">isTraceEnabled</span>(<span class="hljs-params"></span>)</span> &#123;<br><span class="hljs-keyword">return</span> log.isTraceEnabled();<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-function"><span class="hljs-title">error</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> s, Throwable e</span>)</span> &#123;<br>log.log(FQCN, Level.ERROR, s, e);<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-function"><span class="hljs-title">error</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> s</span>)</span> &#123;<br>log.log(FQCN, Level.ERROR, s, <span class="hljs-literal">null</span>);<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-function"><span class="hljs-title">debug</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> s</span>)</span> &#123;<br>log.log(FQCN, Level.DEBUG, s, <span class="hljs-literal">null</span>);<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-function"><span class="hljs-title">trace</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> s</span>)</span> &#123;<br>log.log(FQCN, Level.TRACE, s, <span class="hljs-literal">null</span>);<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-function"><span class="hljs-title">warn</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> s</span>)</span> &#123;<br>log.log(FQCN, Level.WARN, s, <span class="hljs-literal">null</span>);<br>&#125;<br><br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><h2 id="å…«ã€è£…é¥°è€…æ¨¡å¼"><a href="#å…«ã€è£…é¥°è€…æ¨¡å¼" class="headerlink" title="å…«ã€è£…é¥°è€…æ¨¡å¼"></a>å…«ã€è£…é¥°è€…æ¨¡å¼</h2><p>è£…é¥°æ¨¡å¼(Decorator Pattern) ï¼šåŠ¨æ€åœ°ç»™ä¸€ä¸ªå¯¹è±¡å¢åŠ ä¸€äº›é¢å¤–çš„èŒè´£(Responsibility)ï¼Œå°±å¢åŠ å¯¹è±¡åŠŸèƒ½æ¥è¯´ï¼Œè£…é¥°æ¨¡å¼æ¯”ç”Ÿæˆå­ç±»å®ç°æ›´ä¸ºçµæ´»ã€‚å…¶åˆ«åä¹Ÿå¯ä»¥ç§°ä¸ºåŒ…è£…å™¨(Wrapper)ï¼Œä¸é€‚é…å™¨æ¨¡å¼çš„åˆ«åç›¸åŒï¼Œä½†å®ƒä»¬é€‚ç”¨äºä¸åŒçš„åœºåˆã€‚æ ¹æ®ç¿»è¯‘çš„ä¸åŒï¼Œè£…é¥°æ¨¡å¼ä¹Ÿæœ‰äººç§°ä¹‹ä¸ºâ€œæ²¹æ¼†å·¥æ¨¡å¼â€ï¼Œå®ƒæ˜¯ä¸€ç§å¯¹è±¡ç»“æ„å‹æ¨¡å¼ã€‚</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/46cf5d22d32b4882b35d19fdce820371~tplv-k3u1fbpfcp-watermark.image" alt="img"></p><p>åœ¨mybatisä¸­ï¼Œç¼“å­˜çš„åŠŸèƒ½ç”±æ ¹æ¥å£Cacheï¼ˆorg.apache.ibatis.cache.Cacheï¼‰å®šä¹‰ã€‚æ•´ä¸ªä½“ç³»é‡‡ç”¨è£…é¥°å™¨è®¾è®¡æ¨¡å¼ï¼Œæ•°æ®å­˜å‚¨å’Œç¼“å­˜çš„åŸºæœ¬åŠŸèƒ½ç”±PerpetualCacheï¼ˆorg.apache.ibatis.cache.impl.PerpetualCacheï¼‰æ°¸ä¹…ç¼“å­˜å®ç°ï¼Œç„¶åé€šè¿‡ä¸€ç³»åˆ—çš„è£…é¥°å™¨æ¥å¯¹PerpetualCacheæ°¸ä¹…ç¼“å­˜è¿›è¡Œç¼“å­˜ç­–ç•¥ç­‰æ–¹ä¾¿çš„æ§åˆ¶ã€‚å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fb8621391df348aab88431138a1d2d30~tplv-k3u1fbpfcp-watermark.image" alt="img"></p><p><strong>ç”¨äºè£…é¥°PerpetualCacheçš„æ ‡å‡†è£…é¥°å™¨å…±æœ‰8ä¸ªï¼ˆå…¨éƒ¨åœ¨org.apache.ibatis.cache.decoratorsåŒ…ä¸­ï¼‰ï¼š</strong></p><h3 id="1-FifoCacheï¼š"><a href="#1-FifoCacheï¼š" class="headerlink" title="1.FifoCacheï¼š"></a>1.FifoCacheï¼š</h3><p>å…ˆè¿›å…ˆå‡ºç®—æ³•ï¼Œç¼“å­˜å›æ”¶ç­–ç•¥</p><h3 id="2-LoggingCacheï¼š"><a href="#2-LoggingCacheï¼š" class="headerlink" title="2.LoggingCacheï¼š"></a>2.LoggingCacheï¼š</h3><p>è¾“å‡ºç¼“å­˜å‘½ä¸­çš„æ—¥å¿—ä¿¡æ¯</p><h3 id="3-LruCacheï¼š"><a href="#3-LruCacheï¼š" class="headerlink" title="3.LruCacheï¼š"></a>3.LruCacheï¼š</h3><p>æœ€è¿‘æœ€å°‘ä½¿ç”¨ç®—æ³•ï¼Œç¼“å­˜å›æ”¶ç­–ç•¥</p><h3 id="4-ScheduledCacheï¼š"><a href="#4-ScheduledCacheï¼š" class="headerlink" title="4.ScheduledCacheï¼š"></a>4.ScheduledCacheï¼š</h3><p>è°ƒåº¦ç¼“å­˜ï¼Œè´Ÿè´£å®šæ—¶æ¸…ç©ºç¼“å­˜</p><h3 id="5-SerializedCacheï¼š"><a href="#5-SerializedCacheï¼š" class="headerlink" title="5.SerializedCacheï¼š"></a>5.SerializedCacheï¼š</h3><p>ç¼“å­˜åºåˆ—åŒ–å’Œååºåˆ—åŒ–å­˜å‚¨</p><h3 id="6-SoftCacheï¼š"><a href="#6-SoftCacheï¼š" class="headerlink" title="6.SoftCacheï¼š"></a>6.SoftCacheï¼š</h3><p>åŸºäºè½¯å¼•ç”¨å®ç°çš„ç¼“å­˜ç®¡ç†ç­–ç•¥</p><h3 id="7-SynchronizedCacheï¼š"><a href="#7-SynchronizedCacheï¼š" class="headerlink" title="7.SynchronizedCacheï¼š"></a>7.SynchronizedCacheï¼š</h3><p>åŒæ­¥çš„ç¼“å­˜è£…é¥°å™¨ï¼Œç”¨äºé˜²æ­¢å¤šçº¿ç¨‹å¹¶å‘è®¿é—®</p><h3 id="8-WeakCacheï¼š"><a href="#8-WeakCacheï¼š" class="headerlink" title="8.WeakCacheï¼š"></a>8.WeakCacheï¼š</h3><p><strong>åŸºäºå¼±å¼•ç”¨å®ç°çš„ç¼“å­˜ç®¡ç†ç­–ç•¥</strong></p><p>å¦å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šçš„è£…é¥°å™¨TransactionalCacheï¼šäº‹åŠ¡æ€§çš„ç¼“å­˜</p><p>æ­£å¦‚å¤§å¤šæ•°æŒä¹…å±‚æ¡†æ¶ä¸€æ ·ï¼Œmybatisç¼“å­˜åŒæ ·åˆ†ä¸ºä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜</p><h3 id="1-ä¸€çº§ç¼“å­˜"><a href="#1-ä¸€çº§ç¼“å­˜" class="headerlink" title="1.ä¸€çº§ç¼“å­˜"></a>1.ä¸€çº§ç¼“å­˜</h3><p>åˆå«æœ¬åœ°ç¼“å­˜ï¼Œæ˜¯PerpetualCacheç±»å‹çš„æ°¸ä¹…ç¼“å­˜ï¼Œä¿å­˜åœ¨æ‰§è¡Œå™¨ä¸­ï¼ˆBaseExecutorï¼‰ï¼Œè€Œæ‰§è¡Œå™¨åˆåœ¨SqlSessionï¼ˆDefaultSqlSessionï¼‰ä¸­ï¼Œæ‰€ä»¥ä¸€çº§ç¼“å­˜çš„ç”Ÿå‘½å‘¨æœŸä¸SqlSessionæ˜¯ç›¸åŒçš„ã€‚</p><h3 id="2-äºŒçº§ç¼“å­˜"><a href="#2-äºŒçº§ç¼“å­˜" class="headerlink" title="2.äºŒçº§ç¼“å­˜"></a>2.äºŒçº§ç¼“å­˜</h3><p>åˆå«è‡ªå®šä¹‰ç¼“å­˜ï¼Œå®ç°äº†Cacheæ¥å£çš„ç±»éƒ½å¯ä»¥ä½œä¸ºäºŒçº§ç¼“å­˜ï¼Œæ‰€ä»¥å¯é…ç½®å¦‚encacheç­‰çš„ç¬¬ä¸‰æ–¹ç¼“å­˜ã€‚äºŒçº§ç¼“å­˜ä»¥namespaceåç§°ç©ºé—´ä¸ºå…¶å”¯ä¸€æ ‡è¯†ï¼Œè¢«ä¿å­˜åœ¨Configurationæ ¸å¿ƒé…ç½®å¯¹è±¡ä¸­ã€‚</p><h3 id="3-äºŒçº§ç¼“å­˜å¯¹è±¡"><a href="#3-äºŒçº§ç¼“å­˜å¯¹è±¡" class="headerlink" title="3.äºŒçº§ç¼“å­˜å¯¹è±¡"></a>3.äºŒçº§ç¼“å­˜å¯¹è±¡</h3><p>é»˜è®¤ç±»å‹ä¸ºPerpetualCacheï¼Œå¦‚æœé…ç½®çš„ç¼“å­˜æ˜¯é»˜è®¤ç±»å‹ï¼Œåˆ™mybatisä¼šæ ¹æ®é…ç½®è‡ªåŠ¨è¿½åŠ ä¸€ç³»åˆ—è£…é¥°å™¨ã€‚</p><p><strong>Cacheå¯¹è±¡ä¹‹é—´çš„å¼•ç”¨é¡ºåºä¸ºï¼š</strong></p><p>SynchronizedCacheâ€“&gt;LoggingCacheâ€“&gt;SerializedCacheâ€“&gt;ScheduledCacheâ€“&gt;LruCacheâ€“&gt;PerpetualCache</p><h2 id="ä¹ã€è¿­ä»£å™¨æ¨¡å¼"><a href="#ä¹ã€è¿­ä»£å™¨æ¨¡å¼" class="headerlink" title="ä¹ã€è¿­ä»£å™¨æ¨¡å¼"></a>ä¹ã€è¿­ä»£å™¨æ¨¡å¼</h2><p>è¿­ä»£å™¨ï¼ˆIteratorï¼‰æ¨¡å¼ï¼Œåˆå«åšæ¸¸æ ‡ï¼ˆCursorï¼‰æ¨¡å¼ã€‚GOFç»™å‡ºçš„å®šä¹‰ä¸ºï¼šæä¾›ä¸€ç§æ–¹æ³•è®¿é—®ä¸€ä¸ªå®¹å™¨ï¼ˆcontainerï¼‰å¯¹è±¡ä¸­å„ä¸ªå…ƒç´ ï¼Œè€Œåˆä¸éœ€æš´éœ²è¯¥å¯¹è±¡çš„å†…éƒ¨ç»†èŠ‚ã€‚</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b1308f1e7c444af9ae7e66110668ccac~tplv-k3u1fbpfcp-watermark.image" alt="img"></p><p>Javaçš„Iteratorå°±æ˜¯è¿­ä»£å™¨æ¨¡å¼çš„æ¥å£ï¼Œåªè¦å®ç°äº†è¯¥æ¥å£ï¼Œå°±ç›¸å½“äºåº”ç”¨äº†è¿­ä»£å™¨æ¨¡å¼ï¼š</p><p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p><p>æ¯”å¦‚Mybatisçš„PropertyTokenizeræ˜¯propertyåŒ…ä¸­çš„é‡é‡çº§ç±»ï¼Œè¯¥ç±»ä¼šè¢«reflectionåŒ…ä¸­å…¶ä»–çš„ç±»é¢‘ç¹çš„å¼•ç”¨åˆ°ã€‚è¿™ä¸ªç±»å®ç°äº†Iteratoræ¥å£ï¼Œåœ¨ä½¿ç”¨æ—¶ç»å¸¸è¢«ç”¨åˆ°çš„æ˜¯Iteratoræ¥å£ä¸­çš„hasNextè¿™ä¸ªå‡½æ•°ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PropertyTokenizer</span> <span class="hljs-title">implements</span> <span class="hljs-title">Iterator</span>&lt;<span class="hljs-title">PropertyTokenizer</span>&gt; </span>&#123;<br><span class="hljs-keyword">private</span> <span class="hljs-built_in">String</span> name;<br><span class="hljs-keyword">private</span> <span class="hljs-built_in">String</span> indexedName;<br><span class="hljs-keyword">private</span> <span class="hljs-built_in">String</span> index;<br><span class="hljs-keyword">private</span> <span class="hljs-built_in">String</span> children;<br><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-title">PropertyTokenizer</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> fullname</span>)</span> &#123;<br>int delim = fullname.indexOf(<span class="hljs-string">&#x27;.&#x27;</span>);<br><span class="hljs-keyword">if</span> (delim &gt; -<span class="hljs-number">1</span>) &#123;<br>name = fullname.substring(<span class="hljs-number">0</span>, delim);<br>children = fullname.substring(delim + <span class="hljs-number">1</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>name = fullname;<br>children = <span class="hljs-literal">null</span>;<br>&#125;<br>indexedName = name;<br>delim = name.indexOf(<span class="hljs-string">&#x27;[&#x27;</span>);<br><span class="hljs-keyword">if</span> (delim &gt; -<span class="hljs-number">1</span>) &#123;<br>index = name.substring(delim + <span class="hljs-number">1</span>, name.length() - <span class="hljs-number">1</span>);<br>name = name.substring(<span class="hljs-number">0</span>, delim);<br>&#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-built_in">String</span> <span class="hljs-function"><span class="hljs-title">getName</span>(<span class="hljs-params"></span>)</span> &#123;<br><span class="hljs-keyword">return</span> name;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-built_in">String</span> <span class="hljs-function"><span class="hljs-title">getIndex</span>(<span class="hljs-params"></span>)</span> &#123;<br><span class="hljs-keyword">return</span> index;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-built_in">String</span> <span class="hljs-function"><span class="hljs-title">getIndexedName</span>(<span class="hljs-params"></span>)</span> &#123;<br><span class="hljs-keyword">return</span> indexedName;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-built_in">String</span> <span class="hljs-function"><span class="hljs-title">getChildren</span>(<span class="hljs-params"></span>)</span> &#123;<br><span class="hljs-keyword">return</span> children;<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-function"><span class="hljs-title">hasNext</span>(<span class="hljs-params"></span>)</span> &#123;<br><span class="hljs-keyword">return</span> children != <span class="hljs-literal">null</span>;<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> PropertyTokenizer <span class="hljs-function"><span class="hljs-title">next</span>(<span class="hljs-params"></span>)</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> PropertyTokenizer(children);<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-function"><span class="hljs-title">remove</span>(<span class="hljs-params"></span>)</span> &#123;<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UnsupportedOperationException(<br><span class="hljs-string">&quot;Remove is not supported, as it has no meaning in the context of properties.&quot;</span>);<br>&#125;<br>&#125;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªç±»ä¼ å…¥ä¸€ä¸ªå­—ç¬¦ä¸²åˆ°æ„é€ å‡½æ•°ï¼Œç„¶åæä¾›äº†iteratoræ–¹æ³•å¯¹è§£æåçš„å­ä¸²è¿›è¡Œéå†ï¼Œæ˜¯ä¸€ä¸ªå¾ˆå¸¸ç”¨çš„æ–¹æ³•ç±»ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
      <tag>mybatis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰</title>
    <link href="/blog/2021/01/01/%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95%EF%BC%88SSO%EF%BC%89/"/>
    <url>/blog/2021/01/01/%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95%EF%BC%88SSO%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>å•ç‚¹ç™»å½•åˆç§°ä¹‹ä¸ºSingle Sign Onï¼Œç®€ç§°SSOï¼Œå•ç‚¹ç™»å½•å¯ä»¥é€šè¿‡åŸºäºç”¨æˆ·ä¼šè¯çš„å…±äº«ï¼Œä»–åˆ†æ–‡ä¸¤ç§ï¼Œå…ˆæ¥çœ‹ç¬¬ä¸€ç§ï¼Œé‚£å°±æ˜¯ä»–çš„åŸç†æ˜¯åˆ†å¸ƒå¼ä¼šè¯æ¥å®ç°ã€‚</p><p>æ¯”å¦‚è¯´ç°åœ¨æœ‰ä¸ªä¸€çº§åŸŸåä¸º <a href="http://www.imooc.com/">www.imooc.com</a> ï¼Œæ˜¯æ•™è‚²ç±»ç½‘ç«™ï¼Œä½†æ˜¯æ…•è¯¾ç½‘æœ‰å…¶ä»–çš„äº§å“çº¿ï¼Œå¯ä»¥é€šè¿‡æ„å»ºäºŒçº§åŸŸåæä¾›æœåŠ¡ç»™ç”¨æˆ·è®¿é—®ï¼Œæ¯”å¦‚ï¼š music.imooc.com ï¼Œ blog.imooc.com ç­‰ç­‰ï¼Œåˆ†åˆ«ä¸ºæ…•è¯¾éŸ³ä¹ä»¥åŠæ…•è¯¾åšå®¢ç­‰ï¼Œç”¨æˆ·åªéœ€è¦åœ¨å…¶ä¸­ä¸€ä¸ªç«™ç‚¹ç™»å½•ï¼Œé‚£ä¹ˆå…¶ä»–ç«™ç‚¹ä¹Ÿä¼šéšä¹‹è€Œç™»å½•ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨æˆ·è‡ªå§‹è‡³ç»ˆåªåœ¨æŸä¸€ä¸ªç½‘ç«™ä¸‹ç™»å½•åï¼Œé‚£ä¹ˆä»–æ‰€äº§ç”Ÿçš„ä¼šè¯ï¼Œå°±å…±äº«ç»™äº†å…¶ä»–çš„ç½‘ç«™ï¼Œå®ç°äº†å•ç‚¹ç½‘ç«™ç™»å½•åï¼ŒåŒæ—¶é—´æ¥ç™»å½•äº†å…¶ä»–çš„ç½‘ç«™ï¼Œé‚£ä¹ˆè¿™ä¸ªå…¶å®å°±æ˜¯å•ç‚¹ç™»å½•ï¼Œä»–ä»¬çš„ä¼šè¯æ˜¯å…±äº«çš„ï¼Œéƒ½æ˜¯åŒä¸€ä¸ªç”¨æˆ·ä¼šè¯ã€‚</p><h2 id="Cookie-Redis-å®ç°-SSO"><a href="#Cookie-Redis-å®ç°-SSO" class="headerlink" title="Cookie + Redis å®ç° SSO"></a>Cookie + Redis å®ç° SSO</h2><p>é‚£ä¹ˆä¹‹å‰æˆ‘ä»¬æ‰€å®ç°çš„åˆ†å¸ƒå¼ä¼šè¯åç«¯æ˜¯åŸºäºredisçš„ï¼Œå¦‚æ­¤ä¼šè¯å¯ä»¥æµçªœåœ¨åç«¯çš„ä»»æ„ç³»ç»Ÿï¼Œéƒ½èƒ½è·å–åˆ°ç¼“å­˜ä¸­çš„ç”¨æˆ·æ•°æ®ä¿¡æ¯ï¼Œå‰ç«¯é€šè¿‡ä½¿ç”¨cookieï¼Œå¯ä»¥ä¿è¯åœ¨åŒåŸŸåçš„ä¸€çº§äºŒçº§ä¸‹è·å–ï¼Œé‚£ä¹ˆè¿™æ ·ä¸€æ¥ï¼Œcookieä¸­çš„ä¿¡æ¯useridå’Œtokenæ˜¯å¯ä»¥åœ¨å‘é€è¯·æ±‚çš„æ—¶å€™æºå¸¦ä¸Šçš„ï¼Œè¿™æ ·ä»å‰ç«¯è¯·æ±‚åç«¯åæ˜¯å¯ä»¥è·å–æ‹¿åˆ°çš„ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå…¶å®ç”¨æˆ·åœ¨æŸä¸€ç«¯ç™»å½•æ³¨å†Œä»¥åï¼Œå…¶å®cookieå’Œredisä¸­éƒ½ä¼šå¸¦æœ‰ç”¨æˆ·ä¿¡æ¯ï¼Œåªè¦ç”¨æˆ·ä¸é€€å‡ºï¼Œé‚£ä¹ˆå°±èƒ½åœ¨ä»»æ„ä¸€ä¸ªç«™ç‚¹å®ç°ç™»å½•äº†ã€‚</p><p>é‚£ä¹ˆè¿™ä¸ªåŸç†ä¸»è¦ä¹Ÿæ˜¯cookieå’Œç½‘ç«™çš„ä¾èµ–å…³ç³»ï¼Œé¡¶çº§åŸŸå <a href="http://www.imooc.com/">www.imooc.com</a> å’Œ *.imooc.comçš„cookieå€¼æ˜¯å¯ä»¥å…±äº«çš„ï¼Œå¯ä»¥è¢«æºå¸¦è‡³åç«¯çš„ï¼Œæ¯”å¦‚è®¾ç½®ä¸º .imooc.comï¼Œ.t.mukewang.comï¼Œå¦‚æ­¤æ˜¯OKçš„ã€‚<br> äºŒçº§åŸŸåè‡ªå·±çš„ç‹¬ç«‹cookieæ˜¯ä¸èƒ½å…±äº«çš„ï¼Œä¸èƒ½è¢«å…¶ä»–äºŒçº§åŸŸåè·å–ï¼Œæ¯”å¦‚ï¼šmusic.imooc.comçš„cookieæ˜¯ä¸èƒ½è¢«mtv.imooc.comå…±äº«ï¼Œä¸¤è€…äº’ä¸å½±å“ï¼Œè¦å…±äº«å¿…é¡»è®¾ç½®ä¸º.imooc.comã€‚</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/00e2afe7458740a8bec8c2326e3ab6b1~tplv-k3u1fbpfcp-watermark.image" alt="img"></p><h2 id="é¡¶çº§åŸŸåä¸åŒæ€ä¹ˆåŠ"><a href="#é¡¶çº§åŸŸåä¸åŒæ€ä¹ˆåŠ" class="headerlink" title="é¡¶çº§åŸŸåä¸åŒæ€ä¹ˆåŠ?"></a>é¡¶çº§åŸŸåä¸åŒæ€ä¹ˆåŠ?</h2><p>ä¸Šä¸€èŠ‚å•ç‚¹ç™»å½•æ˜¯åŸºäºç›¸åŒé¡¶çº§åŸŸååšçš„ï¼Œé‚£ä¹ˆå¦‚æœé¡¶çº§åŸŸåéƒ½ä¸ä¸€æ ·ï¼Œå’‹åŠï¼Ÿæ¯”å¦‚ <a href="http://www.imooc.com/">www.imooc.com</a> è¦å’Œ<a href="http://www.mukewang.com/">www.mukewang.com</a> çš„ä¼šè¯å®ç°å…±äº«ï¼Œè¿™ä¸ªæ—¶å€™åˆè¯¥å¦‚ä½•ï¼Ÿï¼å¦‚ä¸‹å›¾ï¼Œè¿™ä¸ªæ—¶å€™çš„cookieç”±äºé¡¶çº§åŸŸåä¸åŒï¼Œå°±ä¸èƒ½å®ç°cookieè·¨åŸŸäº†ï¼Œæ¯ä¸ªç«™ç‚¹å„è‡ªè¯·æ±‚åˆ°æœåŠ¡ç«¯ï¼Œcookieæ— æ³•åŒæ­¥ã€‚æ¯”å¦‚ï¼Œ<a href="http://www.imooc.com/">www.imooc.com</a> ä¸‹çš„ç”¨æˆ·å‘èµ·è¯·æ±‚åä¼šæœ‰cookieï¼Œä½†æ˜¯ä»–åˆè®¿é—®äº†<a href="http://www.abc.com/">www.abc.com</a> ï¼Œç”±äºcookieæ— æ³•æºå¸¦ï¼Œæ‰€ä»¥ä¼šè¦ä½ äºŒæ¬¡ç™»å½•ã€‚<br> é‚£ä¹ˆé‡åˆ°é¡¶çº§åŸŸåä¸åŒå´åˆè¦å®ç°å•ç‚¹ç™»å½•è¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿæˆ‘ä»¬æ¥å‚è€ƒä¸‹é¢ä¸€å¼ å›¾ï¼š <img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/668be1732242402a8a8f83534b883774~tplv-k3u1fbpfcp-watermark.image" alt="img"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå¤šä¸ªç³»ç»Ÿä¹‹é—´çš„ç™»å½•ä¼šé€šè¿‡ä¸€ä¸ªç‹¬ç«‹çš„ç™»å½•ç³»ç»Ÿå»åšéªŒè¯ï¼Œå®ƒå°±ç›¸å½“äºæ˜¯ä¸€ä¸ªä¸­ä»‹å…¬å¸ï¼Œæ•´åˆäº†æ‰€æœ‰äººï¼Œä½ è¦çœ‹æˆ¿ç»è¿‡ä¸­ä»‹å…è®¸æ‹¿é’¥åŒ™å°±è¡Œï¼Œå®ç°äº†ç»Ÿä¸€çš„ç™»å½•ã€‚é‚£ä¹ˆè¿™ä¸ªå°±ç§°ä¹‹ä¸ºCASç³»ç»Ÿï¼ŒCASå…¨ç§°ä¸ºCentral Authentication Serviceå³ä¸­å¤®è®¤è¯æœåŠ¡ï¼Œæ˜¯ä¸€ä¸ªå•ç‚¹ç™»å½•çš„è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥ç”¨äºä¸åŒé¡¶çº§åŸŸåä¹‹é—´çš„å•ç‚¹ç™»å½•ã€‚</p><p>è¿‡ç¨‹è§£æ <img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/fe338ecce616416d868e91c8058ce0e1~tplv-k3u1fbpfcp-watermark.image" alt="img"></p><p>ç”¨æˆ·é¦–æ¬¡ç™»å½•æ—¶æµç¨‹å¦‚ä¸‹ï¼š</p><p>1)ã€ç”¨æˆ·æµè§ˆå™¨è®¿é—®ç³»ç»ŸAéœ€ç™»å½•å—é™èµ„æºï¼Œæ­¤æ—¶è¿›è¡Œç™»å½•æ£€æŸ¥ï¼Œå‘ç°æœªç™»å½•ï¼Œç„¶åè¿›è¡Œè·å–ç¥¨æ®æ“ä½œï¼Œå‘ç°æ²¡æœ‰ç¥¨æ®ã€‚</p><p>2)ã€ç³»ç»ŸAå‘ç°è¯¥è¯·æ±‚éœ€è¦ç™»å½•ï¼Œå°†è¯·æ±‚é‡å®šå‘åˆ°è®¤è¯ä¸­å¿ƒï¼Œè·å–å…¨å±€ç¥¨æ®æ“ä½œï¼Œæ²¡æœ‰ï¼Œè¿›è¡Œç™»å½•ã€‚</p><p>3)ã€è®¤è¯ä¸­å¿ƒå‘ˆç°ç™»å½•é¡µé¢ï¼Œç”¨æˆ·ç™»å½•ï¼Œç™»å½•æˆåŠŸåï¼Œè®¤è¯ä¸­å¿ƒé‡å®šå‘è¯·æ±‚åˆ°ç³»ç»ŸAï¼Œå¹¶é™„ä¸Šè®¤è¯é€šè¿‡ä»¤ç‰Œï¼Œæ­¤æ—¶è®¤è¯ä¸­å¿ƒåŒæ—¶ç”Ÿæˆäº†å…¨å±€ç¥¨æ®ã€‚</p><p>4)ã€æ­¤æ—¶å†æ¬¡è¿›è¡Œç™»å½•æ£€æŸ¥ï¼Œå‘ç°æœªç™»å½•ï¼Œç„¶åå†æ¬¡è·å–ç¥¨æ®æ“ä½œï¼Œæ­¤æ—¶å¯ä»¥è·å¾—ç¥¨æ®(ä»¤ç‰Œ)ï¼Œç³»ç»ŸAä¸è®¤è¯ä¸­å¿ƒé€šä¿¡ï¼ŒéªŒè¯ä»¤ç‰Œæœ‰æ•ˆ,è¯æ˜ç”¨æˆ·å·²ç™»å½•ã€‚</p><p>5)ã€ç³»ç»ŸAå°†å—é™èµ„æºè¿”ç»™ç”¨æˆ·</p><p>å·²ç™»å½•ç”¨æˆ·é¦–æ¬¡è®¿é—®åº”ç”¨ç¾¤ä¸­ç³»ç»ŸBæ—¶ï¼š</p><p>1)ã€æµè§ˆå™¨è®¿é—®å¦ä¸€åº”ç”¨Béœ€ç™»å½•å—é™èµ„æºï¼Œæ­¤æ—¶è¿›è¡Œç™»å½•æ£€æŸ¥ï¼Œå‘ç°æœªç™»å½•ï¼Œç„¶åè¿›è¡Œè·å–ç¥¨æ®æ“ä½œï¼Œå‘ç°æ²¡æœ‰ç¥¨æ®ã€‚</p><p>2)ã€ç³»ç»ŸBå‘ç°è¯¥è¯·æ±‚éœ€è¦ç™»å½•ï¼Œå°†è¯·æ±‚é‡å®šå‘åˆ°è®¤è¯ä¸­å¿ƒï¼Œè·å–å…¨å±€ç¥¨æ®æ“ä½œï¼Œè·å–å…¨å±€ç¥¨æ®ï¼Œå¯ä»¥è·å¾—ï¼Œè®¤è¯ä¸­å¿ƒå‘ç°å·²ç»ç™»å½•ã€‚</p><p>3)ã€è®¤è¯ä¸­å¿ƒå‘æ”¾ä¸´æ—¶ç¥¨æ®(ä»¤ç‰Œ)ï¼Œå¹¶æºå¸¦è¯¥ä»¤ç‰Œé‡å®šå‘åˆ°ç³»ç»ŸBã€‚</p><p>4)ã€æ­¤æ—¶å†æ¬¡è¿›è¡Œç™»å½•æ£€æŸ¥ï¼Œå‘ç°æœªç™»å½•ï¼Œç„¶åå†æ¬¡è·å–ç¥¨æ®æ“ä½œï¼Œæ­¤æ—¶å¯ä»¥è·å¾—ç¥¨æ®(ä»¤ç‰Œ)ï¼Œç³»ç»ŸBä¸è®¤è¯ä¸­å¿ƒé€šä¿¡ï¼ŒéªŒè¯ä»¤ç‰Œæœ‰æ•ˆ,è¯æ˜ç”¨æˆ·å·²ç™»å½•ã€‚</p><p>5)ã€ç³»ç»ŸBå°†å—é™èµ„æºè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><p>å…¨å±€ç¥¨æ®çš„æ„ä¹‰å°±æ˜¯åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å·²ç»åœ¨è®¤è¯ä¸­å¿ƒç™»é™†è¿‡ã€‚<br> ä¸´æ—¶ç¥¨æ®çš„æ„ä¹‰æ˜¯ç­¾å‘ç»™ç”¨æˆ·ä¸€ä¸ªç™»é™†çš„è®¤è¯ã€‚</p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SSOController</span> </span>&#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserService userService;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RedisOperator redisOperator;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String REDIS_USER_TOKEN = <span class="hljs-string">&quot;redis_user_token&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String REDIS_USER_TICKET = <span class="hljs-string">&quot;redis_user_ticket&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String REDIS_TMP_TICKET = <span class="hljs-string">&quot;redis_tmp_ticket&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String COOKIE_USER_TICKET = <span class="hljs-string">&quot;cookie_user_ticket&quot;</span>;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/login&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">login</span><span class="hljs-params">(String returnUrl,</span></span><br><span class="hljs-function"><span class="hljs-params">                        Model model,</span></span><br><span class="hljs-function"><span class="hljs-params">                        HttpServletRequest request,</span></span><br><span class="hljs-function"><span class="hljs-params">                        HttpServletResponse response)</span> </span>&#123;<br><br>        model.addAttribute(<span class="hljs-string">&quot;returnUrl&quot;</span>, returnUrl);<br><br>        <span class="hljs-comment">// 1. è·å–userTicketé—¨ç¥¨ï¼Œå¦‚æœcookieä¸­èƒ½å¤Ÿè·å–åˆ°ï¼Œè¯æ˜ç”¨æˆ·ç™»å½•è¿‡ï¼Œæ­¤æ—¶ç­¾å‘ä¸€ä¸ªä¸€æ¬¡æ€§çš„ä¸´æ—¶ç¥¨æ®å¹¶ä¸”å›è·³</span><br>        String userTicket = getCookie(request, COOKIE_USER_TICKET);<br><br>        <span class="hljs-keyword">boolean</span> isVerified = verifyUserTicket(userTicket);<br>        <span class="hljs-keyword">if</span> (isVerified) &#123;<br>            String tmpTicket = createTmpTicket();<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:&quot;</span> + returnUrl + <span class="hljs-string">&quot;?tmpTicket=&quot;</span> + tmpTicket;<br>        &#125;<br><br>        <span class="hljs-comment">// 2. ç”¨æˆ·ä»æœªç™»å½•è¿‡ï¼Œç¬¬ä¸€æ¬¡è¿›å…¥åˆ™è·³è½¬åˆ°CASçš„ç»Ÿä¸€ç™»å½•é¡µé¢</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;login&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ ¡éªŒCASå…¨å±€ç”¨æˆ·é—¨ç¥¨</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> userTicket</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">verifyUserTicket</span><span class="hljs-params">(String userTicket)</span> </span>&#123;<br><br>        <span class="hljs-comment">// 0. éªŒè¯CASé—¨ç¥¨ä¸èƒ½ä¸ºç©º</span><br>        <span class="hljs-keyword">if</span> (StringUtils.isBlank(userTicket)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// 1. éªŒè¯CASé—¨ç¥¨æ˜¯å¦æœ‰æ•ˆ</span><br>        String userId = redisOperator.get(REDIS_USER_TICKET + <span class="hljs-string">&quot;:&quot;</span> + userTicket);<br>        <span class="hljs-keyword">if</span> (StringUtils.isBlank(userId)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// 2. éªŒè¯é—¨ç¥¨å¯¹åº”çš„userä¼šè¯æ˜¯å¦å­˜åœ¨</span><br>        String userRedis = redisOperator.get(REDIS_USER_TOKEN + <span class="hljs-string">&quot;:&quot;</span> + userId);<br>        <span class="hljs-keyword">if</span> (StringUtils.isBlank(userRedis)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * CASçš„ç»Ÿä¸€ç™»å½•æ¥å£</span><br><span class="hljs-comment">     *      ç›®çš„ï¼š</span><br><span class="hljs-comment">     *          1. ç™»å½•ååˆ›å»ºç”¨æˆ·çš„å…¨å±€ä¼šè¯                 -&gt;  uniqueToken</span><br><span class="hljs-comment">     *          2. åˆ›å»ºç”¨æˆ·å…¨å±€é—¨ç¥¨ï¼Œç”¨ä»¥è¡¨ç¤ºåœ¨CASç«¯æ˜¯å¦ç™»å½•  -&gt;  userTicket</span><br><span class="hljs-comment">     *          3. åˆ›å»ºç”¨æˆ·çš„ä¸´æ—¶ç¥¨æ®ï¼Œç”¨äºå›è·³å›ä¼           -&gt;  tmpTicket</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PostMapping(&quot;/doLogin&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">doLogin</span><span class="hljs-params">(String username,</span></span><br><span class="hljs-function"><span class="hljs-params">                          String password,</span></span><br><span class="hljs-function"><span class="hljs-params">                          String returnUrl,</span></span><br><span class="hljs-function"><span class="hljs-params">                          Model model,</span></span><br><span class="hljs-function"><span class="hljs-params">                          HttpServletRequest request,</span></span><br><span class="hljs-function"><span class="hljs-params">                          HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br><br>        model.addAttribute(<span class="hljs-string">&quot;returnUrl&quot;</span>, returnUrl);<br><br>        <span class="hljs-comment">// 0. åˆ¤æ–­ç”¨æˆ·åå’Œå¯†ç å¿…é¡»ä¸ä¸ºç©º</span><br>        <span class="hljs-keyword">if</span> (StringUtils.isBlank(username) ||<br>                StringUtils.isBlank(password)) &#123;<br>            model.addAttribute(<span class="hljs-string">&quot;errmsg&quot;</span>, <span class="hljs-string">&quot;ç”¨æˆ·åæˆ–å¯†ç ä¸èƒ½ä¸ºç©º&quot;</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;login&quot;</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// 1. å®ç°ç™»å½•</span><br>        Users userResult = userService.queryUserForLogin(username,<br>                MD5Utils.getMD5Str(password));<br>        <span class="hljs-keyword">if</span> (userResult == <span class="hljs-keyword">null</span>) &#123;<br>            model.addAttribute(<span class="hljs-string">&quot;errmsg&quot;</span>, <span class="hljs-string">&quot;ç”¨æˆ·åæˆ–å¯†ç ä¸æ­£ç¡®&quot;</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;login&quot;</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// 2. å®ç°ç”¨æˆ·çš„redisä¼šè¯</span><br>        String uniqueToken = UUID.randomUUID().toString().trim();<br>        UsersVO usersVO = <span class="hljs-keyword">new</span> UsersVO();<br>        BeanUtils.copyProperties(userResult, usersVO);<br>        usersVO.setUserUniqueToken(uniqueToken);<br>        redisOperator.set(REDIS_USER_TOKEN + <span class="hljs-string">&quot;:&quot;</span> + userResult.getId(),<br>                JsonUtils.objectToJson(usersVO));<br><br>        <span class="hljs-comment">// 3. ç”Ÿæˆticketé—¨ç¥¨ï¼Œå…¨å±€é—¨ç¥¨ï¼Œä»£è¡¨ç”¨æˆ·åœ¨CASç«¯ç™»å½•è¿‡</span><br>        String userTicket = UUID.randomUUID().toString().trim();<br><br>        <span class="hljs-comment">// 3.1 ç”¨æˆ·å…¨å±€é—¨ç¥¨éœ€è¦æ”¾å…¥CASç«¯çš„cookieä¸­</span><br>        setCookie(COOKIE_USER_TICKET, userTicket, response);<br><br>        <span class="hljs-comment">// 4. userTicketå…³è”ç”¨æˆ·idï¼Œå¹¶ä¸”æ”¾å…¥åˆ°redisä¸­ï¼Œä»£è¡¨è¿™ä¸ªç”¨æˆ·æœ‰é—¨ç¥¨äº†ï¼Œå¯ä»¥åœ¨å„ä¸ªæ™¯åŒºæ¸¸ç©</span><br>        redisOperator.set(REDIS_USER_TICKET + <span class="hljs-string">&quot;:&quot;</span> + userTicket, userResult.getId());<br><br>        <span class="hljs-comment">// 5. ç”Ÿæˆä¸´æ—¶ç¥¨æ®ï¼Œå›è·³åˆ°è°ƒç”¨ç«¯ç½‘ç«™ï¼Œæ˜¯ç”±CASç«¯æ‰€ç­¾å‘çš„ä¸€ä¸ªä¸€æ¬¡æ€§çš„ä¸´æ—¶ticket</span><br>        String tmpTicket = createTmpTicket();<br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * userTicket: ç”¨äºè¡¨ç¤ºç”¨æˆ·åœ¨CASç«¯çš„ä¸€ä¸ªç™»å½•çŠ¶æ€ï¼šå·²ç»ç™»å½•</span><br><span class="hljs-comment">         * tmpTicket: ç”¨äºé¢å‘ç»™ç”¨æˆ·è¿›è¡Œä¸€æ¬¡æ€§çš„éªŒè¯çš„ç¥¨æ®ï¼Œæœ‰æ—¶æ•ˆæ€§</span><br><span class="hljs-comment">         */</span><br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * ä¸¾ä¾‹ï¼š</span><br><span class="hljs-comment">         *      æˆ‘ä»¬å»åŠ¨ç‰©å›­ç©è€ï¼Œå¤§é—¨å£ä¹°äº†ä¸€å¼ ç»Ÿä¸€çš„é—¨ç¥¨ï¼Œè¿™ä¸ªå°±æ˜¯CASç³»ç»Ÿçš„å…¨å±€é—¨ç¥¨å’Œç”¨æˆ·å…¨å±€ä¼šè¯ã€‚</span><br><span class="hljs-comment">         *      åŠ¨ç‰©å›­é‡Œæœ‰ä¸€äº›å°çš„æ™¯ç‚¹ï¼Œéœ€è¦å‡­ä½ çš„é—¨ç¥¨å»é¢†å–ä¸€æ¬¡æ€§çš„ç¥¨æ®ï¼Œæœ‰äº†è¿™å¼ ç¥¨æ®ä»¥åå°±èƒ½å»ä¸€äº›å°çš„æ™¯ç‚¹æ¸¸ç©äº†ã€‚</span><br><span class="hljs-comment">         *      è¿™æ ·çš„ä¸€ä¸ªä¸ªçš„å°æ™¯ç‚¹å…¶å®å°±æ˜¯æˆ‘ä»¬è¿™é‡Œæ‰€å¯¹åº”çš„ä¸€ä¸ªä¸ªçš„ç«™ç‚¹ã€‚</span><br><span class="hljs-comment">         *      å½“æˆ‘ä»¬ä½¿ç”¨å®Œæ¯•è¿™å¼ ä¸´æ—¶ç¥¨æ®ä»¥åï¼Œå°±éœ€è¦é”€æ¯ã€‚</span><br><span class="hljs-comment">         */</span><br><br><span class="hljs-comment">//        return &quot;login&quot;;</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:&quot;</span> + returnUrl + <span class="hljs-string">&quot;?tmpTicket=&quot;</span> + tmpTicket;<br>    &#125;<br><br><br>    <span class="hljs-meta">@PostMapping(&quot;/verifyTmpTicket&quot;)</span><br>    <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> IMOOCJSONResult <span class="hljs-title">verifyTmpTicket</span><span class="hljs-params">(String tmpTicket,</span></span><br><span class="hljs-function"><span class="hljs-params">                                           HttpServletRequest request,</span></span><br><span class="hljs-function"><span class="hljs-params">                                           HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br><br>        <span class="hljs-comment">// ä½¿ç”¨ä¸€æ¬¡æ€§ä¸´æ—¶ç¥¨æ®æ¥éªŒè¯ç”¨æˆ·æ˜¯å¦ç™»å½•ï¼Œå¦‚æœç™»å½•è¿‡ï¼ŒæŠŠç”¨æˆ·ä¼šè¯ä¿¡æ¯è¿”å›ç»™ç«™ç‚¹</span><br>        <span class="hljs-comment">// ä½¿ç”¨å®Œæ¯•åï¼Œéœ€è¦é”€æ¯ä¸´æ—¶ç¥¨æ®</span><br>        String tmpTicketValue = redisOperator.get(REDIS_TMP_TICKET + <span class="hljs-string">&quot;:&quot;</span> + tmpTicket);<br>        <span class="hljs-keyword">if</span> (StringUtils.isBlank(tmpTicketValue)) &#123;<br>            <span class="hljs-keyword">return</span> IMOOCJSONResult.errorUserTicket(<span class="hljs-string">&quot;ç”¨æˆ·ç¥¨æ®å¼‚å¸¸&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-comment">// 0. å¦‚æœä¸´æ—¶ç¥¨æ®OKï¼Œåˆ™éœ€è¦é”€æ¯ï¼Œå¹¶ä¸”æ‹¿åˆ°CASç«¯cookieä¸­çš„å…¨å±€userTicketï¼Œä»¥æ­¤å†è·å–ç”¨æˆ·ä¼šè¯</span><br>        <span class="hljs-keyword">if</span> (!tmpTicketValue.equals(MD5Utils.getMD5Str(tmpTicket))) &#123;<br>            <span class="hljs-keyword">return</span> IMOOCJSONResult.errorUserTicket(<span class="hljs-string">&quot;ç”¨æˆ·ç¥¨æ®å¼‚å¸¸&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// é”€æ¯ä¸´æ—¶ç¥¨æ®</span><br>            redisOperator.del(REDIS_TMP_TICKET + <span class="hljs-string">&quot;:&quot;</span> + tmpTicket);<br>        &#125;<br><br>        <span class="hljs-comment">// 1. éªŒè¯å¹¶ä¸”è·å–ç”¨æˆ·çš„userTicket</span><br>        String userTicket = getCookie(request, COOKIE_USER_TICKET);<br>        String userId = redisOperator.get(REDIS_USER_TICKET + <span class="hljs-string">&quot;:&quot;</span> + userTicket);<br>        <span class="hljs-keyword">if</span> (StringUtils.isBlank(userId)) &#123;<br>            <span class="hljs-keyword">return</span> IMOOCJSONResult.errorUserTicket(<span class="hljs-string">&quot;ç”¨æˆ·ç¥¨æ®å¼‚å¸¸&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-comment">// 2. éªŒè¯é—¨ç¥¨å¯¹åº”çš„userä¼šè¯æ˜¯å¦å­˜åœ¨</span><br>        String userRedis = redisOperator.get(REDIS_USER_TOKEN + <span class="hljs-string">&quot;:&quot;</span> + userId);<br>        <span class="hljs-keyword">if</span> (StringUtils.isBlank(userRedis)) &#123;<br>            <span class="hljs-keyword">return</span> IMOOCJSONResult.errorUserTicket(<span class="hljs-string">&quot;ç”¨æˆ·ç¥¨æ®å¼‚å¸¸&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-comment">// éªŒè¯æˆåŠŸï¼Œè¿”å›OKï¼Œæºå¸¦ç”¨æˆ·ä¼šè¯</span><br>        <span class="hljs-keyword">return</span> IMOOCJSONResult.ok(JsonUtils.jsonToPojo(userRedis, UsersVO.class));<br>    &#125;<br><br>    <span class="hljs-meta">@PostMapping(&quot;/logout&quot;)</span><br>    <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> IMOOCJSONResult <span class="hljs-title">logout</span><span class="hljs-params">(String userId,</span></span><br><span class="hljs-function"><span class="hljs-params">                                  HttpServletRequest request,</span></span><br><span class="hljs-function"><span class="hljs-params">                                  HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br><br>        <span class="hljs-comment">// 0. è·å–CASä¸­çš„ç”¨æˆ·é—¨ç¥¨</span><br>        String userTicket = getCookie(request, COOKIE_USER_TICKET);<br><br>        <span class="hljs-comment">// 1. æ¸…é™¤userTicketç¥¨æ®ï¼Œredis/cookie</span><br>        deleteCookie(COOKIE_USER_TICKET, response);<br>        redisOperator.del(REDIS_USER_TICKET + <span class="hljs-string">&quot;:&quot;</span> + userTicket);<br><br>        <span class="hljs-comment">// 2. æ¸…é™¤ç”¨æˆ·å…¨å±€ä¼šè¯ï¼ˆåˆ†å¸ƒå¼ä¼šè¯ï¼‰</span><br>        redisOperator.del(REDIS_USER_TOKEN + <span class="hljs-string">&quot;:&quot;</span> + userId);<br><br>        <span class="hljs-keyword">return</span> IMOOCJSONResult.ok();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆ›å»ºä¸´æ—¶ç¥¨æ®</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">createTmpTicket</span><span class="hljs-params">()</span> </span>&#123;<br>        String tmpTicket = UUID.randomUUID().toString().trim();<br>        <span class="hljs-keyword">try</span> &#123;<br>            redisOperator.set(REDIS_TMP_TICKET + <span class="hljs-string">&quot;:&quot;</span> + tmpTicket,<br>                    MD5Utils.getMD5Str(tmpTicket), <span class="hljs-number">600</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> tmpTicket;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setCookie</span><span class="hljs-params">(String key,</span></span><br><span class="hljs-function"><span class="hljs-params">                           String val,</span></span><br><span class="hljs-function"><span class="hljs-params">                           HttpServletResponse response)</span> </span>&#123;<br><br>        Cookie cookie = <span class="hljs-keyword">new</span> Cookie(key, val);<br>        cookie.setDomain(<span class="hljs-string">&quot;sso.com&quot;</span>);<br>        cookie.setPath(<span class="hljs-string">&quot;/&quot;</span>);<br>        response.addCookie(cookie);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteCookie</span><span class="hljs-params">(String key,</span></span><br><span class="hljs-function"><span class="hljs-params">                              HttpServletResponse response)</span> </span>&#123;<br><br>        Cookie cookie = <span class="hljs-keyword">new</span> Cookie(key, <span class="hljs-keyword">null</span>);<br>        cookie.setDomain(<span class="hljs-string">&quot;sso.com&quot;</span>);<br>        cookie.setPath(<span class="hljs-string">&quot;/&quot;</span>);<br>        cookie.setMaxAge(-<span class="hljs-number">1</span>);<br>        response.addCookie(cookie);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">getCookie</span><span class="hljs-params">(HttpServletRequest request, String key)</span> </span>&#123;<br><br>        Cookie[] cookieList = request.getCookies();<br>        <span class="hljs-keyword">if</span> (cookieList == <span class="hljs-keyword">null</span> || StringUtils.isBlank(key)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>        &#125;<br><br>        String cookieValue = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span> ; i &lt; cookieList.length; i ++) &#123;<br>            <span class="hljs-keyword">if</span> (cookieList[i].getName().equals(key)) &#123;<br>                cookieValue = cookieList[i].getValue();<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> cookieValue;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>åç«¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å­¦ä¹ </tag>
      
      <tag>å•ç‚¹ç™»å½•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸šåŠ¡å’ŒæŠ€æœ¯</title>
    <link href="/blog/2020/12/28/%E4%B8%9A%E5%8A%A1%E5%92%8C%E6%8A%80%E6%9C%AF/"/>
    <url>/blog/2020/12/28/%E4%B8%9A%E5%8A%A1%E5%92%8C%E6%8A%80%E6%9C%AF/</url>
    
    <content type="html"><![CDATA[<p> èº«å¤„ä¸šåŠ¡çš„æˆ‘ä»¬ï¼ŒæŠ€æœ¯ä¸Šå¦‚ä½•è‡ªæ‹”ï¼Ÿ</p><p>æ–‡ç« ç›®å½•æ¦‚è¿°è‡ªæˆ‘å›é¡¾ä¸šåŠ¡ä¸æŠ€æœ¯çš„å›°æ‰°å¸¦ç€é—®é¢˜æ€è€ƒä»€ä¹ˆæ˜¯æŠ€æœ¯å’Œä¸šåŠ¡ä¸šåŠ¡æŠ€æœ¯æŠ€æœ¯å’Œä¸šåŠ¡çš„å…³ç³»ä¸šåŠ¡ä¸ä¸ºè§£å†³ä¸šåŠ¡è€Œè¡ç”Ÿçš„ä¸šåŠ¡å¯¹å¾…ä¸šåŠ¡çš„æ€åº¦å› ä½ åœ¨å›¢é˜Ÿçš„è§’è‰²ä¸åŒè€Œä¸åŒä»æ‰€è°“çš„ä¸šåŠ¡ä»£ç ä¸­è·³å‡ºå¦‚ä½•è½»æ¾ã€æ¼‚äº®çš„æå®šä¸šåŠ¡â€¦â€¦</p><p>çœ‹äº†ç½‘ä¸Šçš„å­¦ä¹ æ–¹æ³•ï¼Œä¹Ÿç»¼åˆäº†ä¸€ä¸‹ä»–äººçš„æ„è§ï¼Œæ€»ç»“ä¸‹æ¥ï¼Œæƒ³æ¥è‡ªæˆ‘å­¦ä¹ ä»¥åŠè‡ªæˆ‘æå‡çš„æ–¹å¼ï¼Œå¤§æŠµå°±æ˜¯å¦‚ä¸‹ä¸‰ç§äº†</p><ol><li> ä»æ–‡å­—è§†å›¾ä¸­å­¦ä¹ </li><li> å‘èº«è¾¹çš„äººå­¦ä¹ </li><li> å‘è‡ªå·±å­¦ä¹ </li></ol><p>å…¶ä¸­å‘è‡ªå·±å­¦ä¹ æœ€ä¸ºé è°±ã€‚</p><p>è€Œå‘è‡ªå·±å­¦ä¹ æœ€æœ‰æ•ˆçš„æ–¹æ³•ï¼Œå°±æ˜¯è‡ªçœã€‚</p><p>â€œæ›¾å­æ›°: å¾æ—¥ä¸‰çœå¾èº«ï¼Œä¸ºäººè°‹è€Œä¸å¿ ä¹? ä¸æœ‹å‹äº¤è€Œä¸ä¿¡ä¹? ä¼ ä¸ä¹ ä¹?â€</p><p>â€œå¤äººè¯šä¸æˆ‘æ¬ºâ€ã€‚æ€»ç»“ï¼Œæ˜¯è‡ªçœåé¦ˆå‡ºæ¥çš„ä¸€ç§ç»“æœã€‚å†™è¿™ç¯‡æ–‡ç« ï¼Œå¸Œæœ›ä¸åªæ˜¯è‡ªå·±èƒ½å¤Ÿå­¦åˆ°ä¸œè¥¿ï¼Œè¿›è¡Œæˆé•¿ï¼Œä¹Ÿå¸Œæœ›èƒ½å°†è‡ªå·±çš„æ€è€ƒå’Œç»éªŒä¼ æ’­å‡ºæ¥ï¼Œä¸å¤§å®¶å…±å‹‰ã€‚</p><p>ä»å¹´åˆåˆ°å¹´æœ«ï¼Œä»ä¸€ä¸ªæŠ€æœ¯äººå‘˜ ä»… 3 äººçš„å°æ‰‹æ¸¸å…¬å¸åˆ°äº†å¦‚ä»Šå¼€å‘å›¢é˜Ÿè¿‘ 200 äººçš„ä¸­å¤§å‹å…¬å¸ã€‚</p><p>ä¸‹é¢ä»å·¥ä½œå’Œä¸ªäººæˆé•¿ä¸¤ä¸ªæ–¹é¢è¿›è¡Œå…¥æ‰‹ï¼Œå‰–æä¸€ä¸‹è‡ªå·±ã€‚</p><p>å·¥ä½œä¸Šï¼Œä»ä¸€ä¸ªäººåŸ‹å¤´å¹²æ´»ï¼Œåˆ°ä¸»å¯¼è·¨ 4ï¼Œ5 ä¸ªå°éƒ¨é—¨å…±åŒåä½œçš„æŠ€æœ¯ç»ç†ä»¥åŠç°åœ¨ä½œä¸ºä¸€ä¸ªå°ç»„çš„ leaderï¼Œä½œä¸ºå‘˜å·¥ï¼Œå¦‚ä½•åœ¨ä¸šåŠ¡ä¸­ç»§ç»­æˆé•¿ä¸‹å»ä»¥åŠå¦‚ä½•åœ¨å…¬å¸ä½“ç°å‡ºè‡ªå·±çš„ä¸å¯æ›¿ä»£æ€§ï¼ˆæŠ€æœ¯å’Œä¸šåŠ¡ä¸Šçš„ï¼‰ï¼Œä¹Ÿè®©å…¬å¸çœ‹åˆ°ä½ çš„æ½œåŠ›ï¼ˆä½ çš„æˆé•¿èƒ½ä¸ºå…¬å¸ä¸ºå›¢é˜Ÿå¸¦æ¥çš„æ”¶ç›Šï¼‰ï¼›ä½œä¸ºå°ç»„ leaderï¼Œå¦‚ä½•æ›´å¥½çš„å¸¦å¥½è‡ªå·±çš„å°ç»„ï¼ˆè¿™ç‚¹åœ¨åé¢å¹¶æ²¡æœ‰è®²åˆ°ï¼Œæ˜å¹´è§ï¼‰ï¼›</p><p>å¦å¤–ï¼Œè‡ªå·±æŠ€æœ¯ä¸Šçš„æˆé•¿ã€‚ä¹Ÿè®¸æˆ‘æ‰¯ä¸€å¤§å †çš„æŠ€æœ¯åè¯ï¼Œå¹¶ä¸æ˜¯å¾ˆç›´è§‚ï¼Œç®€å•ç²—æš´çš„è®²ï¼Œå°±æ˜¯ä»ä¸€ä¸ªæ—¥æµé‡ä¸åˆ°ä¸‡çº§çš„æ¸¸æˆåˆ°å¦‚ä»Šæ—¥æµé‡äº¿çº§çš„é¡¹ç›®ä»¥åŠå…¶ä»–å¤§å¤§å°å°é«˜æµé‡é¡¹ç›®çš„å¼€å‘ã€‚</p><p>ç¨å¾®ä»æŠ€æœ¯å±‚é¢è¯´å°±æ˜¯ Java çš„å•ä½“ SpringBoot é¡¹ç›®å‘å±•åˆ°åŸºäº Dubboã€SpringBoot çš„ï¼Œä½¿ç”¨åˆ°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œåˆ†å¸ƒå¼é”ï¼Œåˆ†å¸ƒå¼æ•°æ®åˆ†ç‰‡ï¼Œè´Ÿè½½ã€é™æµã€ç†”æ–­ã€é™çº§ã€é“¾è·¯è¿½è¸ªã€elasticsearchã€æ¶ˆæ¯é˜Ÿåˆ—ã€ç¼“å­˜ redisã€è‡ªåŠ¨åŒ–éƒ¨ç½²ã€apolloã€Sentinel ç­‰ä¸€å¤§å †åè¯å’ŒæŠ€æœ¯æ­å»ºçš„é«˜å¹¶å‘é«˜å¯ç”¨æœåŠ¡åŒ–é¡¹ç›®ï¼›</p><p>å‡­æˆ‘è¿™æµ…è–„çš„çŸ¥è¯†ï¼Œè‡³å°‘ç›®å‰ä¸å¯èƒ½ç”¨è‡ªå·±ç†è§£çš„æ¦‚å¿µæ¥æŠŠä¸Šé¢åˆ—åˆ°çš„ä¸€äº›çŸ¥è¯†ç‚¹çš„åŸç†æ¥è¿›è¡Œè®²è§£ï¼Œè‡ªå·±å¯¹å…¶ä¹Ÿåªæ˜¯æ‡‚ä¸ªå¤§æ¦‚ï¼Œæ›´ä¸æƒ³è¯¯äººå­å¼Ÿï¼Œä»…ä»…è®²ç‚¹è‡ªå·±ä¹Ÿä¼¼æ‡‚éæ‡‚çš„æ¦‚å¿µã€‚è‡ªå·±ç›®å‰å¯¹å…¶ç†è§£çš„ï¼Œå°±æ˜¯å¾ˆå¤šå¼€å‘æ‰€å¤„çš„ï¼Œè°ƒç”¨æ¥å£ä½¿ç”¨çš„è¿™ä¸ªå±‚æ¬¡ã€‚åŸç†çŸ¥è¯†ï¼Œä»¥åä¼šæ…¢æ…¢é“æ¥ã€‚ä½™ç”Ÿæ¼«æ¼«ï¼Œè¯·å›å‹¿æ€¥ã€‚</p><p>ç¯‡å¹…æœ‰é™ï¼Œå¼€å§‹æƒ³ç€èƒ½å†™å¾ˆå¤šï¼Œä½†æ˜¯æ€è€ƒä¸‹æ¥ï¼Œå…³äºæŠ€æœ¯å’Œä¸šåŠ¡å°±èƒ½å†™ä¸€å¤§ç¯‡çš„æ–‡å­—ã€‚</p><p>ç›¸ä¿¡å¾ˆå¤šå¼€å‘ç»å¸¸ä¼šè¢«ä¸šåŠ¡ä»£ç æ‰€å›°æ‰°ï¼Œç»å¤§å¤šæ•°éƒ½æ˜¯æœ‰æ¢¦æƒ³çš„ç¨‹åºçŒ¿ï¼Œå¤§å®¶éƒ½æœ‰ç€ä¸€ä¸ªæƒ³ä½¿ç”¨ä»£ç æ”¹å˜ä¸–ç•Œçš„æ¢¦ï¼Œå½“åˆæˆ‘é€‰æ‹©è½¯ä»¶å·¥ç¨‹è¿™ä¸ªä¸“ä¸šï¼ŒåŸå› ä¹‹ä¸€å°±æ˜¯æˆ‘è§‰å¾—æˆ‘å“¥ä½¿ç”¨ä»£ç å¼€å‘ä¸€ä¸ªç½‘ç«™å‡ºæ¥æ˜¯ä¸€ä»¶ç‰›é€¼å“„å“„çš„äº‹æƒ…ã€‚</p><p>ç°åœ¨å€’æ˜¯è§‰å¾—ï¼Œæ¯”å¦‚å¼€å‘ä¸€ä¸ª GitHub å¼€æºé¡¹ç›®çš„ star å‡ åƒä¸Šä¸‡æ‰æ˜¯ç‰›é€¼å“„å“„çš„äº‹æƒ…äº†ã€‚</p><p>åœ¨å·¥ä½œä¸­ï¼Œå¤©å¤©å†™ä¸šåŠ¡ä»£ç ï¼Œè‡ªå·±å¦‚ä½•åœ¨æŠ€æœ¯ä¸Šè¿›æ­¥ï¼Ÿå¤§å®¶æ˜¯ä¸æ˜¯ä¹Ÿç»å¸¸å¿ƒç”Ÿç–‘æƒ‘ï¼Œæˆ‘ä»¥å‰ä¹Ÿå›°æ‰°è¿‡ï¼ˆè‡ªå·±çš„è€å¤§åœ¨æ€»ç»“ä¸­ç‚¹é†’äº†æˆ‘ï¼Œå¯¹æŠ€æœ¯æœ‰è¿½æ±‚ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å¾ˆå¥½çš„ç»“åˆä¸šåŠ¡ã€‚è‡ªå·±ä¹Ÿå¥½å¥½è¿›è¡Œäº†åçœï¼Œæœé›†äº†å¾ˆå¤šèµ„æ–™ï¼Œä¹Ÿè¯¢é—®äº†å¦å¤–çš„å¤§ä½¬ï¼Œå¦‚ä½•æ›´å¥½çš„å¤„ç†ä¸šåŠ¡å’ŒæŠ€æœ¯ï¼‰ï¼Œç°åœ¨å€’æ˜¯è§‰å¾—è´´åˆä¸šåŠ¡æ›´åŠ èƒ½å¤Ÿæå‡æ‰“ç£¨è‡ªå·±çš„æŠ€æœ¯ä»¥åŠå¢åŠ è‡ªå·±åœ¨å…¬å¸çš„ä¸å¯æ›¿ä»£æ€§ã€‚</p><p>çœ‹åˆ°æœ‰æ–‡ç« è¿™æ ·æ¯”å–»ä¸šåŠ¡ä¸æŠ€æœ¯ï¼Œå†™ä¸šåŠ¡ä»£ç å­¦ä¹ çš„æŠ€æœ¯å°±åƒæ¸¸æˆä¸­å‡çº§æ‰“æ€ªä¸€æ ·ï¼Œå¼€å§‹æ‰“å°æ€ªï¼Œç»éªŒå€¼å¾ˆé«˜ï¼Œè¶Šåˆ°åé¢ç»éªŒå€¼è¶Šå°‘ï¼Œæ‰“å°æ€ªå·²ç»ä¸èƒ½æå‡ç»éªŒå€¼äº†ã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦æ‰“ä¸€äº›æ›´é«˜çº§çš„æ€ªï¼Œåˆ·ä¸€äº›æœ‰æŒ‘æˆ˜çš„å‰¯æœ¬äº†ï¼Œæ²¡çœ‹åˆ°å“ªä¸ªæ¸¸æˆåªè¦ä¸€ç›´æ‰“å°æ€ªå°±èƒ½å‡åˆ°é¡¶çº§çš„ã€‚ æˆä¸ºæŠ€æœ¯å¤§ç‰›çš„è·¯ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œä½ è¦ä¸æ–­çš„æå‡è‡ªå·±çš„æ°´å¹³ï¼Œç„¶åé¢ä¸´æ›´å¤§çš„æŒ‘æˆ˜ï¼Œé€šè¿‡åº”å¯¹è¿™äº›æŒ‘æˆ˜ä»è€Œä½¿è‡ªå·±æ°´å¹³æ›´ä¸Šä¸€çº§ï¼Œç„¶åå¦‚æ­¤å¾€å¤ï¼Œæœ€ç»ˆè¾¾åˆ°æŠ€æœ¯å¤§ç‰›ç”šè‡³ä¸šç•Œå¤§ç‰›çš„å¢ƒç•Œï¼Œå†™ä¸šåŠ¡ä»£ç åªæ˜¯è¿™ä¸ªæ‰“æ€ªå‡çº§è·¯ä¸Šçš„ä¸€ä¸ªæŒ‘æˆ˜è€Œå·²ã€‚ä¸šåŠ¡ä»£ç éƒ½å†™ä¸å¥½çš„ç¨‹åºå‘˜è‚¯å®šæ— æ³•æˆä¸ºæŠ€æœ¯å¤§ç‰›ï¼Œä½†åªæŠŠä¸šåŠ¡ä»£ç å†™å¥½çš„ç¨‹åºå‘˜ä¹Ÿè¿˜ä¸èƒ½æˆä¸ºæŠ€æœ¯å¤§ç‰›ã€‚å¯¹åº”è‡ªå·±æ‰€å¤„çš„è§’è‰²ï¼Œæ›´å¥½çš„æŒ–æ˜å‡ºè‡ªå·±çš„æ½œåŠ›ä¸æå‡å®åŠ›ï¼Œåˆ›é€ å‡ºæ›´å¤šçš„ä»·å€¼ã€‚</p><p>å†è¯´ä¸€ä¸ªç°å®ä¸­çš„é—®é¢˜ï¼Œå·¥ä½œéƒ½æ˜¯åŸºäºä¸šåŠ¡æ¥é©±åŠ¨çš„ï¼Œå›½å†…åŸºæœ¬æ‰€æœ‰å…¬å¸ï¼ˆæŠ›å¼€ç ”ç©¶ä¸è®²ï¼Œå¹¿ä¹‰ä¸Šæ¥è¯´ï¼Œæ‰€æœ‰çš„æŠ€æœ¯éƒ½æ˜¯ä¸ºä¸šåŠ¡æœåŠ¡çš„ï¼‰éƒ½æ˜¯ä¸šåŠ¡æ¥é©±åŠ¨çš„ã€‚ é˜¿é‡Œçš„ä¸­é—´ä»¶å›¢é˜Ÿï¼Œä¹Ÿæ˜¯ä¸šåŠ¡é©±åŠ¨è€Œæˆç«‹çš„å›¢é˜Ÿï¼ˆä¸ºäº†è§£å†³é˜¿é‡Œå†…éƒ¨å¤æ‚çš„ä¸šåŠ¡åœºæ™¯ã€é£é€Ÿçš„ä¸šåŠ¡å¢é•¿ã€é«˜å¹¶å‘çš„å¤§ä¿ƒæ´ªå³°ã€å±‚å‡ºä¸ç©·çš„ç¨³å®šæ€§é—®é¢˜è€Œæˆç«‹çš„å›¢é˜Ÿï¼‰ï¼Œåªæ˜¯åšçš„äº‹æƒ…æ¯”æˆ‘ä»¬çš„é«˜å¤§ä¸Šï¼ˆé«˜åˆ†å¸ƒå¼ RPC æœåŠ¡æ¡†æ¶ã€é«˜å¯é åˆ†å¸ƒå¼æ¶ˆæ¯ä¸­é—´ä»¶ã€åˆ†å¸ƒå¼æ•°æ®å±‚ã€æµ·é‡æ•°æ®å­˜å‚¨ã€å®æ—¶è®¡ç®—ã€ç³»ç»Ÿæ€§èƒ½ä¼˜åŒ–ã€æ¶æ„é«˜å¯ç”¨ç­‰ï¼‰ï¼Œåé¢ä¼šä»‹ç»åˆ°å› ä¸šåŠ¡éœ€è¦è€Œè¡ç”Ÿé«˜æ·±æŠ€æœ¯ã€‚</p><h2 id="å¸¦ç€é—®é¢˜æ€è€ƒ"><a href="#å¸¦ç€é—®é¢˜æ€è€ƒ" class="headerlink" title="å¸¦ç€é—®é¢˜æ€è€ƒ"></a>å¸¦ç€é—®é¢˜æ€è€ƒ</h2><p>ä½œä¸ºå¼€å‘äººå‘˜ï¼Œå¦‚ä½•é¢å¯¹ â€œCRUDï¼Œå¤©å¤©å†™ä¸šåŠ¡ä»£ç â€ è¿™ä¸ªäº‹æƒ…ï¼Œå¯ä»¥æ€è€ƒä¸‹é¢çš„å‡ ä¸ªé—®é¢˜</p><ol><li> ä»€ä¹ˆæ˜¯æŠ€æœ¯å’Œä¸šåŠ¡</li><li> ä¸šåŠ¡å’ŒæŠ€æœ¯çš„å…³ç³»</li><li> ä¸šåŠ¡ä¸ä¸ºè§£å†³ä¸šåŠ¡è€Œè¡ç”Ÿçš„ä¸šåŠ¡</li><li> å¯¹å¾…ä¸šåŠ¡çš„æ€åº¦å› ä½ åœ¨å›¢é˜Ÿçš„è§’è‰²ä¸åŒè€Œä¸åŒ</li><li> å¦‚ä½•ä»æ‰€è°“çš„ä¸šåŠ¡ä»£ç ä¸­å­¦ä¹ æ·±å…¥</li></ol><h3 id="ä»€ä¹ˆæ˜¯æŠ€æœ¯å’Œä¸šåŠ¡"><a href="#ä»€ä¹ˆæ˜¯æŠ€æœ¯å’Œä¸šåŠ¡" class="headerlink" title="ä»€ä¹ˆæ˜¯æŠ€æœ¯å’Œä¸šåŠ¡"></a>ä»€ä¹ˆæ˜¯æŠ€æœ¯å’Œä¸šåŠ¡</h3><p>æ¥ä¸‹æ¥å°±ä»ä¸šåŠ¡å’ŒæŠ€æœ¯æ¥å…¥æ‰‹è¿›è¡Œåˆ†æäº†ã€‚</p><p>å›å½’åˆ°è¿™ä¸¤ä¸ªè¯çš„å®šä¹‰ã€‚</p><p>ç»´åŸºç™¾ç§‘æ˜¯è¿™ä¹ˆè§£é‡Šçš„ï¼š</p><h4 id="ä¸šåŠ¡"><a href="#ä¸šåŠ¡" class="headerlink" title="ä¸šåŠ¡"></a>ä¸šåŠ¡</h4><p><strong>ä¸šåŠ¡æ˜¯æŒ‡æŸç§æœ‰ç›®çš„çš„å·¥ä½œæˆ–å·¥ä½œé¡¹ç›®ã€‚</strong> è€ƒè™‘åˆ°ä¼ä¸šå·²ç»æˆä¸ºç°ä»£ç¤¾ä¼šæœ€å¸¸è§çš„æ´»åŠ¨ä¸»ä½“ï¼Œæ•…å¯ä¸ºä¸šåŠ¡ä½œç°å®å®šä¹‰ï¼Œå³ä¼ä¸šè¿ç”¨ç§‘å­¦æ–¹æ³•å’Œç”Ÿäº§å·¥è‰ºç”Ÿäº§å‡ºå¯äº¤ä»˜ç”¨æˆ·ä½¿ç”¨çš„äº§å“ä¸æœåŠ¡ï¼Œå¹¶ä»¥æ­¤ä¸ºä¼ä¸šå¸¦æ¥åˆ©ç›Šçš„è¡Œä¸ºã€‚</p><p>ä¸åªæ˜¯ä¸ºä¼ä¸šï¼Œèƒ½ä¸ºäººç±»æœ¬èº«å¸¦æ¥åˆ©ç›Šçš„éœ€æ±‚ï¼Œéƒ½å¯ä»¥ç§°ä¹‹ä¸ºä¸šåŠ¡ã€‚</p><h4 id="æŠ€æœ¯"><a href="#æŠ€æœ¯" class="headerlink" title="æŠ€æœ¯"></a>æŠ€æœ¯</h4><p><strong>æŠ€æœ¯å¯ä»¥æŒ‡äººç±»å¯¹æœºå™¨ã€ç¡¬ä»¶æˆ–äººé€ å™¨çš¿çš„è¿ç”¨ï¼Œä½†å®ƒä¹Ÿå¯ä»¥åŒ…å«æ›´å¹¿çš„æ¶æ„ï¼Œå¦‚ç³»ç»Ÿã€ç»„ç»‡æ–¹æ³•å­¦å’ŒæŠ€å·§</strong></p><p>å®ƒæ˜¯çŸ¥è¯†è¿›åŒ–çš„ä¸»ä½“ï¼Œç”±ç¤¾ä¼šå½¢å¡‘æˆ–å½¢å¡‘ç¤¾ä¼šã€‚å¦‚ç”µè„‘ç­‰æ–°æŠ€æœ¯çš„å¢ç”Ÿä½¿äººä»¬ç›¸ä¿¡æŠ€æœ¯æ˜¯ç¤¾ä¼šè¿›åŒ–çš„å†³å®šæ€§åŠ›é‡ï¼Œæ¢å¥è¯è¯´ï¼Œå®ƒæ˜¯é©±åŠ¨æ”¹å˜çš„è‡ªå‘æ€§åŠ¨åŠ›ã€‚</p><p>é€šè¿‡äººä¸ºåˆ›é€ æ¡ä»¶ï¼Œè®©æŒ‡å®šçš„äº‹ä»¶èƒ½å¤ŸæŒ‰ç…§äººç±»çš„æ„æ„¿å‘ç”Ÿï¼Œè¿™å°±æ˜¯æŠ€æœ¯ã€‚</p><p>æ¯”å¦‚å–ç«ï¼Œæœ€æ—©äººç±»åªèƒ½é æ‰“é›·ç­‰è‡ªç„¶ç°è±¡äº§ç”Ÿç«ã€‚</p><p>å–ç«å…¶å®å°±æ˜¯ä¸€ä¸ªä¸šåŠ¡ç›®æ ‡ï¼Œè¦è§£å†³çš„æ˜¯äººç±»è‡ªå·±çš„é—®é¢˜ï¼Œè¿™å°±æ˜¯ä¸šåŠ¡ï¼Œå®é™…å°±æ˜¯äººç±»çš„åˆ©ç›Šã€‚è¿™ä¸ªæ—¶å€™äººç±»å¹¶æ²¡æœ‰ç”Ÿç«çš„æŠ€æœ¯ï¼Œåªèƒ½é ä¸æ–­çš„åŠ æœ¨æï¼Œä¿æŒç«ä¸ç†„ç­ã€‚</p><p>åæ¥äººä»¬å‘ç°äº†é’»æœ¨å–ç«ï¼šåªè¦ç”¨ä¸€ä¸ªå¹²çš„æœ¨æ£ï¼Œåœ¨å¦ä¸€ä¸ªå¹²æœ¨è¡¨é¢å¿«é€Ÿçš„è½¬åŠ¨ï¼Œå°±å¯ä»¥ç”Ÿç«ã€‚è¿™ä¸ªåŠæ³•è®©äººç±»å¯ä»¥è‡ªè¡Œåˆ›é€ ç«æºï¼Œå°±äº§ç”Ÿäº†é’»æœ¨å–ç«çš„æŠ€æœ¯ã€‚</p><p>ä½†æ˜¯åŒæ‰‹å¿«é€Ÿè½¬åŠ¨æœ¨æ£é’»æœ¨å–ç«ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰äººéƒ½èƒ½å¤Ÿåšå¾—åˆ°çš„ï¼Œéœ€è¦å¾ˆå¤šåŠ›é‡å’Œé€Ÿåº¦ï¼Œå¯¹äººçš„è¦æ±‚å¤ªé«˜ã€‚ä¸ºäº†è§£å†³å¿«é€Ÿè½¬åŠ¨çš„é—®é¢˜ï¼Œå°±æœ‰äººé‡‡ç”¨å¼“å¼¦æ¥æå‡æœ¨æ£è½¬åŠ¨çš„é€Ÿåº¦ã€‚</p><p>ä¸šåŠ¡ç›®æ ‡æ˜¯ä¸ºäº†å–ç«ï¼Œé’»æœ¨å–ç«è¿™ä¸ªæŠ€æœ¯çš„å‡ºç°è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</p><p>é’»æœ¨å–ç«çš„æ•ˆç‡ä¸é«˜ï¼Œå½±å“äº†ä¸šåŠ¡ï¼ˆå–ç«ï¼‰çš„æ•ˆç‡ï¼Œå°±æœ‰äº†è¿›ä¸€æ­¥æ”¹è¿›çš„åŠ¨æœºï¼Œæ”¹è¿›è½¬åŠ¨æœ¨æ£çš„æ–¹å¼ï¼Œäº§ç”Ÿäº†å¼“å¼¦è½¬åŠ¨æœ¨æ£çš„æŠ€æœ¯ã€‚</p><p>å†ç”¨æ¯”è¾ƒç°ä»£åŒ–çš„ä¸šåŠ¡æ¥è¿›è¡Œè¯´æ˜ä¸€ä¸‹</p><p>æ¯”å¦‚å–æ¬¾å°±æ˜¯ä¸€ç§ä¸šåŠ¡ï¼ŒATM æœºå†…è¿è½¬çš„è½¯ä»¶ï¼Œè¦è§£å†³çš„ä¸šåŠ¡å°±æ˜¯å–æ¬¾ã€‚ï¼ˆå–æ¬¾æ˜¯ä¸ºäº†äº¤æ˜“ï¼Œå½“åˆäº¤æ˜“ä¸æ–¹ä¾¿ï¼Œäºæ˜¯ä¾¿æœ‰äº†ç§»åŠ¨æ”¯ä»˜ï¼Œèšåˆæ”¯ä»˜ç­‰ç­‰ï¼‰ æ¯”å¦‚ä¹°ç«è½¦ç¥¨ä¹Ÿæ˜¯ä¸šåŠ¡ï¼Œ12306 è¿™ä¸ªç½‘ç«™å°±æ˜¯ä¸ºè§£å†³ä¹°è½¦ç¥¨çš„ä¸šåŠ¡æœåŠ¡çš„ã€‚ï¼ˆæ˜¥è¿ä¹°ç¥¨ä¸æ˜“ï¼Œäºæ˜¯å‡ºç°äº†æŠ¢ç¥¨è½¯ä»¶ï¼ŒåŠ é€Ÿè½¯ä»¶ç­‰ç­‰ï¼‰</p><p>å®ç°è½¯ä»¶ / ç½‘ç«™åŠŸèƒ½çš„ç³»ç»Ÿï¼Œæ¶æ„ï¼Œæ¡†æ¶ç­‰ä¾¿æ˜¯æŠ€æœ¯ï¼ˆè€ŒæŠ€æœ¯æœ¬èº«åˆå¯èƒ½æ˜¯å»ºç«‹åœ¨å…¶ä»–æŠ€æœ¯ä¹‹ä¸Šçš„ï¼‰ã€‚</p><p>ä»ä¸Šé¢çš„å®šä¹‰ä»¥åŠä¾‹å­ä¸­ï¼Œå¯ä»¥çŸ¥é“ï¼Œä¸šåŠ¡æ˜¯å…·æœ‰å¼ºç›®çš„æ€§çš„ï¼Œæ¯”å¦‚è¯´æˆ‘çš„ä¸šåŠ¡å°±æ˜¯ä¸ºäº†å–æ¬¾ï¼Œè€Œ 12306 ç½‘ç«™çš„ä¸šåŠ¡å°±æ˜¯ä¸ºäº†è§£å†³ä¹°è½¦ç¥¨çš„ä¸šåŠ¡æœåŠ¡ï¼Œæ˜¯ä¸ºæŸä¸ªå…·ä½“ç‰¹å®šçš„é—®é¢˜è€Œç”Ÿçš„ï¼›ä½†æ˜¯ä¸šåŠ¡å°±å…·æœ‰å¼±ç›®çš„æ€§ï¼Œæ™®éæ€§å’Œé€šç”¨æ€§ï¼Œæ¯”å¦‚å‰é¢å®ç°å–æ¬¾çš„æŠ€æœ¯æ¡†æ¶ï¼Œå¯èƒ½åœ¨ 12306 ä¸­çš„æ¡†æ¶è¿˜èƒ½å¤ç”¨ç­‰ç­‰ã€‚</p><p>æŠ€æœ¯å­˜åœ¨æ¼”å˜ï¼Œä¹Ÿæ˜¯ä¸ºäº†æ›´æ–¹ä¾¿çš„æœåŠ¡äºä¸šåŠ¡æœ¬èº«ã€‚</p><h3 id="æŠ€æœ¯å’Œä¸šåŠ¡çš„å…³ç³»"><a href="#æŠ€æœ¯å’Œä¸šåŠ¡çš„å…³ç³»" class="headerlink" title="æŠ€æœ¯å’Œä¸šåŠ¡çš„å…³ç³»"></a>æŠ€æœ¯å’Œä¸šåŠ¡çš„å…³ç³»</h3><p>æ¥ä¸‹æ¥ä»¥å–ç«ä¸ºä¾‹å§ã€‚</p><p>å‰é¢è¯´åˆ°æœ€å¼€å§‹æ˜¯é€šè¿‡é›·ç”µè·å–ç«æºï¼Œæ¥ä¸‹æ¥æ˜¯ç«çŸ³ã€é’»æœ¨å–ç«ï¼Œç„¶åæ¸æ¸æ¼”å˜åˆ°å¼“å¼¦åŠ é€Ÿè½¬åŠ¨æœ¨æ£å–ç«ï¼Œéšç€ç§‘æŠ€çš„å‘å±•ï¼Œæ¸æ¸çš„ç”Ÿæˆç«æºä¾¿æˆä¸ºäº†ä¸€ç§ä¸šåŠ¡ï¼Œå¹¶ä¸”å¯ä»¥å‡ºå”®å¸¦æ¥å¦å¤–çš„åˆ©ç›Šï¼Œè¿™ä¸ªæ—¶å€™ï¼Œç”Ÿæˆç«æŸ´ã€æ‰“ç«æœºä¾¿æ˜¯ä¸šåŠ¡ã€‚è€Œå…¶ä¸­ä¸šåŠ¡ä¸­ä½¿ç”¨çš„å‰§çƒˆæ°§åŒ–è¿˜åŸååº”ã€æ±½æ²¹åˆ¶ä½œã€ç‰©ç†åŒ–å­¦çŸ¥è¯†ã€å·¥ä¸šåˆ¶ä½œç­‰ä¾¿æ˜¯æŠ€æœ¯ã€‚</p><p>ç®€å•çš„å¯ä»¥å¾—å‡ºå¦‚ä¸‹å‡ ä¸ªç»“è®º</p><ol><li> æŠ€æœ¯æ˜¯ä¸ºäº†è§£å†³ä¸šåŠ¡çš„é—®é¢˜è€Œäº§ç”Ÿçš„ï¼Œæ²¡æœ‰äº†ä¸šåŠ¡ï¼ŒæŠ€æœ¯å°±æ²¡æœ‰äº†å­˜åœ¨çš„å‰æ</li><li> æœ‰äº†æ›´å¥½çš„æŠ€æœ¯ï¼Œæ•ˆç‡æ›´å·®çš„æŠ€æœ¯ï¼Œå°±ä¼šæ…¢æ…¢çš„è¢«æ·˜æ±°ï¼Œæ¶ˆå¤±ï¼Œä¸€åˆ‡éƒ½éµä»äººç±»çš„åˆ©ç›Šè¯‰æ±‚ â€“ ä¹Ÿå°±æ˜¯ä¸šåŠ¡</li></ol><p>æœ‰äººä¼šé—®ï¼Œä¸ç”¨é’»æœ¨å–ç«äº†ï¼Œä½†æ˜¯å¼“å¼¦åŠ é€Ÿè½¬åŠ¨æœ¨æ£è¿˜å¯ä»¥ç”¨å•Šï¼Ÿ æ²¡é”™ï¼Œå› ä¸ºå¼“å¼¦è½¬åŠ¨æœ¨æ£è¿™ä¸ªæŠ€æœ¯ï¼Œä¸æ˜¯æ¥ç”Ÿç«çš„ï¼Œæ˜¯ç”¨æ¥åŠ é€Ÿæœ¨æ£è½¬åŠ¨çš„ï¼Œæ‰€è§£å†³çš„é—®é¢˜ä¸ä¸€æ ·ï¼ˆå¼•å‡ºäº†åé¢å› è§£å†³ä¸šåŠ¡è€Œè¡ç”Ÿå‡ºæ¥çš„ä¸šåŠ¡ï¼‰ã€‚ä½†æ˜¯å¤šç§ä¸åŒçš„æŠ€æœ¯ï¼Œåˆç†ç»“åˆèµ·æ¥ï¼Œä¼šæ›´å¥½æ›´æœ‰æ•ˆç‡çš„è§£å†³ä¸šåŠ¡é—®é¢˜ã€‚</p><p>æ‰€ä»¥æŠ€æœ¯ä¸æŠ€æœ¯ä¹‹é—´ï¼Œæœ‰å¦‚ä¸‹çš„ä¸¤ç§å…³ç³»ï¼š</p><ol><li> åœ¨è§£å†³åŒä¸€ä¸ªä¸šåŠ¡é—®é¢˜çš„å‰æä¸‹ï¼Œæ›´é«˜æ•ˆï¼Œæ›´ä½æˆæœ¬çš„æŠ€æœ¯ï¼Œä¼šæ·˜æ±°ä½æ•ˆï¼Œé«˜æˆæœ¬çš„æŠ€æœ¯ã€‚è¿™æ˜¯äººç±»åˆ©ç›Šè¯‰æ±‚æ‰€å†³å®šçš„ã€‚</li><li> ä¸€èˆ¬åˆšå¼€å§‹è§£å†³æ ¹æœ¬é—®é¢˜çš„æŠ€æœ¯ï¼ˆé’»æœ¨å–ç«ï¼‰çš„æ•ˆç‡æ˜¯æ¯”è¾ƒä½çš„ï¼Œåªæ˜¯æŠŠä¸å¯èƒ½å˜æˆäº†å¯èƒ½ï¼ˆä»è¿™ä¸€ç‚¹ä¸Šæ¥è¯´ï¼ŒæŠ€æœ¯æ‰æ˜¯ä¸šåŠ¡çš„ ä¿ƒæˆè€…ï¼‰ã€‚ç„¶åå°±ä¼šæœ‰æé«˜æ•ˆç‡çš„éœ€æ±‚å‡ºç°ï¼Œè¦æ±‚æ”¹è¿›è¿™ä¸ªæŠ€æœ¯ã€‚è¿™ä¸ªæŠ€æœ¯çš„ä½æ•ˆç‡éƒ¨åˆ†å°±ä¼šè¢«å…¶ä»–äººï¼ˆæˆ–è€…æŠ€æœ¯å‘æ˜äººè‡ªå·±ï¼‰åŠ ä»¥æ”¹è¿›ï¼Œè¿™éƒ¨åˆ†å°±ä¼šå½¢æˆæ–°çš„æŠ€æœ¯ã€‚</li></ol><p>å½“æ›´å¥½çš„æŠ€æœ¯å‘ç”Ÿçš„æ—¶å€™ï¼Œå¿…å®šä¼šå½¢æˆä¸€ä¸ªåˆ‡åˆ†ï¼Œæ–°æŠ€æœ¯ä¼šé€šè¿‡æŸç§æ–¹å¼å’ŒåŸæœ‰çš„æŠ€æœ¯è¿æ¥åœ¨ä¸€èµ·å½¢æˆä¸€ä¸ªæ•´ä½“ï¼Œè®©è¿™ä¸ªæ–°çš„æŠ€æœ¯å¯ä»¥å’ŒåŸæœ‰æŠ€æœ¯å…±åŒå·¥ä½œï¼Œä½¿å¾—åŸæœ‰çš„æŠ€æœ¯å¯ä»¥ç”¨æ›´é«˜çš„æ•ˆç‡è§£å†³é—®é¢˜ã€‚å› ä¸ºè¦è§£å†³çš„ä¸»è¦ä¸šåŠ¡ï¼ˆç”Ÿç«ï¼‰å¹¶æ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼Œåˆ†æ‹†æ‰€å½¢æˆçš„æ˜¯ä¸€ä¸ªæ ‘çŠ¶çš„ç»“æ„ã€‚</p><p>è¿™ä¸ªæ—¶å€™å…¶å®å·²ç»äº§ç”Ÿäº†æ¶æ„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€èˆ¬æ˜¯å…ˆæœ‰æŠ€æœ¯ï¼Œæ‰ä¼šæœ‰æ¶æ„ã€‚è¿™äº›å…¶ä»–æŠ€æœ¯ï¼ˆå¼“å¼¦æ‹‰åŠ¨æœ¨æ£ã€æ°§åŒ–è¿˜åŸååº”ç”Ÿç«ç­‰ï¼‰ï¼Œæ˜¯ä»ç›´æ¥è§£å†³é—®é¢˜çš„åˆå§‹ä¸»è¦æŠ€æœ¯ä¸­åˆ†æ‹†å‡ºæ¥å½¢æˆçš„ï¼Œå¹¶é€šè¿‡æ ‘çŠ¶ç»“æ„å’Œä¸»è¦æŠ€æœ¯ï¼ˆé’»æœ¨å–ç«ï¼‰ç»„åˆåœ¨ä¸€èµ·ã€‚åœ¨è§£å†³ä¸»è¦é—®é¢˜ï¼ˆç”Ÿç«ï¼‰ä¹‹åï¼Œå†å¼€å§‹é€æ¸çš„åˆ†æ‹†ä¸ºæ›´ä¸ºç»†ç²’åº¦çš„æŠ€æœ¯ï¼ˆå¼“å¼¦è½¬æœ¨æ£ï¼‰</p><p>è€Œè¿™ä¸ªç»†ç²’åº¦çš„æŠ€æœ¯ï¼ˆå¼“å¼¦è½¬åŠ¨æœ¨æ£ï¼‰å¾€å¾€ä¸ä¼šå’Œä¸šåŠ¡çš„ä¸»è¦ç›®æ ‡ï¼ˆç”Ÿç«ï¼‰å‘ç”Ÿç›´æ¥çš„å…³ç³»ã€‚ä¸åŒçš„æŠ€æœ¯ï¼Œé€šè¿‡æ ‘çŠ¶ç»“æ„ï¼Œç»„åˆåœ¨ä¸€èµ·ï¼Œå½¢æˆäº†ä¸€ä¸ªå®Œæ•´çš„æ¶æ„è§£å†³æ–¹æ¡ˆï¼Œå…±åŒå®Œæˆä¸šåŠ¡çš„ç›®æ ‡ã€‚è¿™å°±æ˜¯æŠ€æœ¯ï¼Œä¸šåŠ¡å’Œæ¶æ„ä¹‹é—´çš„å…³ç³»ã€‚ï¼ˆåˆ†æç«æŸ´ä¸æ‰“ç«æœºåŸç†ç”Ÿæˆç«æºç±»ä¼¼ï¼‰</p><p>å¾ˆå¤šäººæŠŠè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºæ¶æ„çš„è¿›åŒ–ï¼Œæˆ‘æ›´æ„¿æ„æŠŠè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºæŠ€æœ¯çš„è¿›æ­¥æ‰€å¯¼è‡´çš„æ–°çš„æ¶æ„åˆ†æ‹†ï¼Œå› ä¸ºè¿™ä¸ªè¿‡ç¨‹å†…åœ¨çš„åŠ¨åŠ›ï¼Œæ›´å¤šçš„æ˜¯æ¥è‡ªæŠ€æœ¯å¯¹è§£å†³ä¸šåŠ¡é—®é¢˜çš„è§£å†³ã€‚</p><p>æˆ‘ä»¬å›åˆ°å¼€å‘è€…èº«ä¸Šæ¥çœ‹ï¼Œå†™ä¸šåŠ¡ä»£ç å¤šä¸€äº›ï¼Œè¿˜æ˜¯æ‰€è°“çš„æŠ€æœ¯ä»£ç å¤šä¸€äº›ï¼Œæ²¡æœ‰é«˜ä¸‹ä¹‹åˆ†ï¼Œåªæœ‰ä¸ªäººå–å‘å’Œç»„ç»‡åˆ†å·¥çš„ä¸åŒã€‚</p><h3 id="ä¸šåŠ¡ä¸ä¸ºè§£å†³ä¸šåŠ¡è€Œè¡ç”Ÿçš„ä¸šåŠ¡"><a href="#ä¸šåŠ¡ä¸ä¸ºè§£å†³ä¸šåŠ¡è€Œè¡ç”Ÿçš„ä¸šåŠ¡" class="headerlink" title="ä¸šåŠ¡ä¸ä¸ºè§£å†³ä¸šåŠ¡è€Œè¡ç”Ÿçš„ä¸šåŠ¡"></a>ä¸šåŠ¡ä¸ä¸ºè§£å†³ä¸šåŠ¡è€Œè¡ç”Ÿçš„ä¸šåŠ¡</h3><p>æ‰“å¼€æ·˜å®é¦–é¡µï¼Œéšä¾¿æµè§ˆä¸€ä¸ªå•†å“è¯¦æƒ…é¡µé¢ã€‚</p><p>æ˜¯ä¸æ˜¯æœ‰äººä¼šç¬¬ä¸€çœ¼è§‰å¾—å•†å“å°é¢ï¼Œä¼˜æƒ åˆ¸ç­‰ç›¸å…³ä¿¡æ¯çš„ä»£ç æ˜¯æ²¡æœ‰ä»€ä¹ˆæŠ€æœ¯å«é‡çš„ï¼Œå› ä¸ºé‚£äº›æ˜¯ä¸šåŠ¡ä»£ç ã€‚</p><p>æ˜¯ä¸æ˜¯è§‰å¾—å†™å•†å“é¡µé¢çš„æ¡†æ¶ï¼Œåˆ†å¸ƒå¼æ¶æ„ï¼Œåˆ†å¸ƒå¼ç¼“å­˜ï¼ŒJMQï¼ŒRedis æˆ–è€…è¯´æ˜¯ ç­‰æŠ€æœ¯æ‰æ˜¯æœ‰æŠ€æœ¯å«é‡çš„ã€‚</p><p>ä½†å®é™…ä¸Šï¼Œæ‰€è°“çš„ä¸šåŠ¡ä»£ç å’ŒæŠ€æœ¯ä»£ç ï¼Œå®ƒä»¬çš„åŒºåˆ«ï¼Œä»…ä»…æ˜¯å’Œä¸šåŠ¡çš„è·ç¦»è¿œè¿‘ä¸åŒè€Œå·²ï¼šä¸šåŠ¡ä»£ç ç¦»ä¸šåŠ¡æ›´è¿‘ï¼ŒæŠ€æœ¯ä»£ç ç¦»ä¸šåŠ¡ç¨è¿œã€‚å®ƒä»¬æœ€ç»ˆéƒ½æ˜¯æŒ‡å‘ä¸šåŠ¡å®ç°çš„ã€‚</p><p>è€Œä¸”ï¼Œå¯ä»¥è€ƒè™‘æ¢ä¸€ç§è§†è§’æ¥çœ‹ä¸šåŠ¡ï¼Œå°±ä¼šå‘ç°ï¼Œå…¶å®æ¯ä¸€å±‚ä»£ç ï¼Œéƒ½æœåŠ¡äºå®ƒçš„ä¸Šä¸€å±‚ä»£ç ï¼Œä¸Šä¸€å±‚ä»£ç ï¼Œå°±æ˜¯å®ƒçš„ä¸šåŠ¡ï¼</p><p>![](data:;base64,&lt;?xml version=)â€ alt=â€imgâ€ data-src=â€<a href="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/901f02baa8e24b23abc9cf09be674f41~tplv-k3u1fbpfcp-zoom-1.image&quot;">https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/901f02baa8e24b23abc9cf09be674f41~tplv-k3u1fbpfcp-zoom-1.image&quot;</a> data-width=â€800â€ data-height=â€600â€ /&gt;</p><p>æ¯”å¦‚è¯¦æƒ…é¡µæ¶æ„çš„ç¬¬ 2 å±‚ â€œå¯¹å¤–æä¾› APIâ€ ä¸­çš„â€œå•†å“ä»‹ç»â€ ï¼Œå®ƒçš„æœåŠ¡å¯¹è±¡ï¼Œå°±æ˜¯å‰ç«¯é¡µé¢ï¼Œè¦è§£å†³çš„ä¸šåŠ¡ï¼Œå°±æ˜¯â€œå“åº”å‰ç«¯é¡µé¢çš„æŸ¥è¯¢ï¼Œæä¾›å•†å“ä»‹ç»â€</p><p>è€Œç¬¬ 2 å±‚åº•éƒ¨çš„å‰ç«¯æ•°æ®é›†ç¾¤ï¼ˆJIMDBï¼‰ï¼Œå®ƒçš„æœåŠ¡å¯¹è±¡ï¼Œå°±æ˜¯å•†å“ä»‹ç»ï¼Œè¦è§£å†³çš„ä¸šåŠ¡ï¼Œå°±æ˜¯ â€œå­˜å‚¨å•†å“æˆ–ä»£ç†å•†å“ä»‹ç»ä¿¡æ¯â€ã€‚</p><p>ç®€å•è¯´ï¼Œæ¯ä¸€å±‚æŠ€æœ¯å®ç°ï¼Œéƒ½æœåŠ¡äºä¸Šä¸€å±‚ï¼Œéƒ½ä»¥ä¸Šä¸€å±‚çš„éœ€æ±‚ä¸ºä¸šåŠ¡ã€‚ ä»è¿™ä¸ªè§’åº¦è®²ï¼Œç°å®ä¸­çš„ä¸šåŠ¡åœ¨è¢«è™šæ‹ŸåŒ–çš„è¿‡ç¨‹ä¸­ï¼Œä¼šåœ¨æŠ€æœ¯å®ç°å±‚é¢å¼•å‘åˆ†å±‚ï¼Œäº§ç”Ÿä¸­é—´æ€§ã€å¯¹ç”¨æˆ·ä¸å¯è§çš„æ–°ä¸šåŠ¡ã€‚</p><p>ä½†æ˜¯ä¸ºä»€ä¹ˆå¾ˆå¤šå¼€å‘è€…åˆè§‰å¾—æ‰€åšçš„æŠ€æœ¯å®ç°è¶Šæ¥è¿‘ç°å®ä¸šåŠ¡è¶Šæ²¡æŠ€æœ¯å«é‡å‘¢ï¼Ÿ</p><p>è¿™æ˜¯å› ä¸ºï¼Œä½ è¶Šæ¥è¿‘ç”¨æˆ·ä¸šåŠ¡ï¼š</p><ol><li> ç»†èŠ‚è¶Šå¤šï¼Œç¹çåº¦è¶Šé«˜ï¼Œè¶Šä¸å®¹æ˜“åšå¥½ï¼Œè¶Šå®¹æ˜“å› ä¸ºä¸€ç‚¹å°ç‘•ç–µè€Œè¢«å¦å®šï¼Œè®©äººè§‰å¾—è‡ªå·±çš„åŠ³åŠ¨æ²¡ä»·å€¼</li><li> ç°å®æ€§è¶Šå¼ºï¼Œå˜åŒ–å‡ ç‡è¶Šé«˜ï¼Œè¶Šå®¹æ˜“æ¥å›ä¿®æ”¹ä»£ç ï¼Œè¶Šè®©äººè§‰å¾—è‡ªå·±çš„æŒæ§æ„Ÿä½ä¸‹</li><li> å®ç°çš„ä»£ç å¯è¿ç§»æ€§è¶Šå·®ï¼ŒåŠ³åŠ¨æˆæœè¢«å¤ç”¨çš„æ¦‚ç‡è¶Šä½</li></ol><p>è€Œå½“ä½ è¿œç¦»ç”¨æˆ·ä¸šåŠ¡æ—¶ï¼š</p><ol><li> ä½ ç”¨åˆ°çš„æŠ€æœ¯ï¼Œå¤šæ•°éƒ½æ˜¯è¢«é«˜åº¦æŠ½è±¡è¿‡çš„ã€ç”¨æ¥è§£å†³ä»ç”¨æˆ·ä¸šåŠ¡è¡ç”Ÿå‡ºçš„æŠ€æœ¯æ€§ä¸šåŠ¡çš„ï¼Œå®ƒä»¬æ¯”å…·ä½“çš„ç”¨æˆ·ä¸šåŠ¡ç¨³å®šï¼Œå®ƒä»¬çš„é€‚ç”¨é¢æ›´å¹¿ï¼Œä¹Ÿæ›´å®¹æ˜“è¢«è¿ç§»åˆ°å…¶å®ƒçš„ä¸šåŠ¡é¢†åŸŸ</li><li> ä½ çš„åŠ³åŠ¨æˆæœå› ä¸ºå…·æœ‰æŠ½è±¡å±æ€§ï¼Œè¢«å¤ç”¨çš„æ¦‚ç‡ä¼šæ›´é«˜ï¼Œä½ ä¼šæ›´æ„¿æ„æ‰“ç£¨å®ƒï¼Œä¼šæ›´æœ‰æˆå°±æ„Ÿ</li><li> ä½ å—åˆ°å‹åŠ›ï¼Œç»è¿‡è·ç¦»ç”¨æˆ·è¿‘çš„å‡ å±‚åŒäº‹çš„ä¼ é€’ï¼Œå¾—åˆ°äº†è¡°å‡ï¼Œæ²¡é‚£ä¹ˆå¤§</li><li> ä½ æ‰“äº¤é“çš„å¯¹è±¡ï¼Œå¤šæ•°æ—¶å€™æ˜¯å†…éƒ¨åŒäº‹ã€æ˜¯æŠ€æœ¯äººç¾¤ï¼Œæ›´å®¹æ˜“è¾¾æˆä¸€è‡´</li></ol><h3 id="å¯¹å¾…ä¸šåŠ¡çš„æ€åº¦å› ä½ åœ¨å›¢é˜Ÿçš„è§’è‰²ä¸åŒè€Œä¸åŒ"><a href="#å¯¹å¾…ä¸šåŠ¡çš„æ€åº¦å› ä½ åœ¨å›¢é˜Ÿçš„è§’è‰²ä¸åŒè€Œä¸åŒ" class="headerlink" title="å¯¹å¾…ä¸šåŠ¡çš„æ€åº¦å› ä½ åœ¨å›¢é˜Ÿçš„è§’è‰²ä¸åŒè€Œä¸åŒ"></a>å¯¹å¾…ä¸šåŠ¡çš„æ€åº¦å› ä½ åœ¨å›¢é˜Ÿçš„è§’è‰²ä¸åŒè€Œä¸åŒ</h3><p>ä½ å¯¹ä¸šåŠ¡çš„æ€åº¦ï¼Œä¼šå› ä½ åœ¨å›¢é˜Ÿä¸­æ‰¿æ‹…çš„è§’è‰²ä¸åŒè€Œä¸åŒã€‚è¿™æ˜¯ç”±å¼€å‘å›¢é˜Ÿçš„ç»„ç»‡ç»“æ„å’ŒèŒè´£åˆ†å·¥å¯¼è‡´çš„ã€‚</p><p>ä¸‹é¢æ˜¯ â€œå›¢é˜Ÿç»“æ„ã€èƒ½åŠ›ä¸èŒè´£â€ å›¾ï¼š</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/7e6220e13c624ca3852ac1cad0528ec2~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>åœ¨ä¸€ä¸ªå¼€å‘å›¢é˜Ÿä¸­ï¼Œæ¶æ„å¸ˆè¿™ä¸ªè§’è‰²ï¼Œä¼šè´Ÿè´£ä¸šåŠ¡æ‹†åˆ†å’Œè½¯ä»¶æ¶æ„çš„å·¥ä½œï¼Œå¹¶ä¸”é¢†å¯¼å›¢é˜Ÿæ¥å®ç°æ»¡è¶³ä¸šåŠ¡çš„è½¯ä»¶ã€‚</p><ul><li>  æ³¨ 1 ï¼šæœ‰çš„ç ”å‘å›¢é˜Ÿé‡Œæœ‰ä¸šåŠ¡æ¶æ„å¸ˆå’Œè½¯ä»¶æ¶æ„å¸ˆä¸¤ç§è§’è‰²ï¼Œä¸šåŠ¡æ‹†åˆ†ç”±ä¸šåŠ¡æ¶æ„å¸ˆæˆ–ä¸šåŠ¡åˆ†æå¸ˆå®Œæˆã€‚</li><li>  æ³¨ 2 ï¼šè½¯ä»¶æ¶æ„å¸ˆå’Œä¸šåŠ¡æ¶æ„å¸ˆè¿™ä¸¤ä¸ªè§’è‰²ä¹Ÿå¯èƒ½ç”±æ²¡æœ‰æ¶æ„å¸ˆå¤´è¡”çš„ç ”å‘ç»ç†å…¼ä»»ã€‚ æ¶æ„å¸ˆä¸€å®šæ˜¯è¦ä»¥ä¸šåŠ¡ä¸ºå¯¼å‘çš„ï¼Œè¦ææ‡‚ä¸šåŠ¡çš„ã€‚æ‰€ä»¥ï¼Œåœ¨æ¶æ„å¸ˆè¿™ä¸ªé˜¶æ®µï¼Œåœ¨å›¢é˜Ÿç®¡ç†è€…è¿™ä¸ªé˜¶æ®µï¼Œä¸šåŠ¡çš„é‡è¦æ€§ï¼Œå¾€å¾€æ˜¯é«˜äºæŠ€æœ¯çš„ï¼Œåœ¨ä»–ä»¬çš„çœ¼ä¸­ï¼Œä¸šåŠ¡ç»Ÿé¢†æŠ€æœ¯ï¼ŒæŠ€æœ¯æ˜¯ç”¨æ¥å®ç°ä¸šåŠ¡çš„ã€‚</li></ul><p>å½“å›¢é˜Ÿå®Œæˆä¸šåŠ¡æ¶æ„å’Œè½¯ä»¶æ¶æ„ä¹‹åï¼Œå°±ä¼šé€‰æ‹©ä¸åŒçš„å¼€å‘è€…æ¥è´Ÿè´£ä¸åŒåŠŸèƒ½æ¨¡å—çš„å®ç°ã€‚</p><p>è´Ÿè´£ä¸åŒåŠŸèƒ½æ¨¡å—å®ç°çš„å¼€å‘è€…ï¼Œå¿…é¡»èƒ½å¤Ÿç†è§£ä¸šåŠ¡ï¼Œå¹¶ä¸”è¦ç†Ÿæ‚‰æŸä¸ªæŠ€æœ¯æ ˆï¼Œèƒ½å¤Ÿè¿›è¡Œæ¨¡å—è®¾è®¡å’Œä»»åŠ¡æ‹†åˆ†ï¼Œæˆ‘ç§°è¿™æ ·çš„å¼€å‘è€…ä¸º â€œç†Ÿç»ƒå¼€å‘è€…â€ã€‚</p><p>ç†Ÿç»ƒå¼€å‘è€…ä¼šæ‰¿æ¥ç”±æ¶æ„å¸ˆåˆ†æ´¾çš„å­ä¸šåŠ¡ï¼Œè´Ÿè´£æ¨¡å—è®¾è®¡å’Œæ‹†åˆ†ï¼ŒæŠŠæ‹†åˆ†åçš„å°ä»»åŠ¡ï¼Œäº¤ç»™æ™®é€šç¨‹åºå‘˜æ¥å®Œæˆã€‚</p><p>å½“ä½ æ˜¯ä¸€ä¸ªç†Ÿç»ƒå¼€å‘è€…æ—¶ï¼Œä¸šåŠ¡å’ŒæŠ€æœ¯å‡ ä¹åŒç­‰é‡è¦ï¼Œå› ä¸ºï¼š</p><p>ä½ ä¸ç†è§£ä¸šåŠ¡ï¼Œå°±å¾ˆéš¾å°†å­ä¸šåŠ¡æ¨¡å—æ˜ å°„åˆ°è½¯ä»¶å®ç°ä¸Šï¼Œä¹Ÿå¾ˆéš¾åšè¿›ä¸€æ­¥çš„ä¸šåŠ¡æ‹†åˆ†ã€‚</p><p>ä½ ä¸å…·å¤‡å®Œæ•´çš„æŠ€æœ¯æ ˆå’Œç›¸åº”çš„çŸ¥è¯†ä½“ç³»ï¼Œå°±å¾ˆéš¾æ‰¾åˆ°åˆé€‚çš„æŠ€æœ¯æ¥å®ç°ä¸šåŠ¡ï¼Œä¹Ÿå¾ˆéš¾åšè½¯ä»¶æ¨¡å—çš„æ‹†åˆ†ã€‚</p><p>ç†Ÿç»ƒå¼€å‘è€…å®Œæˆäº†å­ä¸šåŠ¡å’Œè½¯ä»¶æ¨¡å—çš„æ‹†åˆ†ï¼Œä¼šå½¢æˆä¸€ç³»åˆ—çš„å¶å­å‹ä»»åŠ¡ï¼Œå¹¶æŠŠå®ƒä»¬åˆ†æ´¾ç»™å…·å¤‡ç‰¹å®šä¸“é¡¹æŠ€æœ¯èƒ½åŠ›çš„æ™®é€šç¨‹åºå‘˜ã€‚</p><p>æ™®é€šç¨‹åºå‘˜è¦åšçš„äº‹æƒ…æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯æ¥å—åˆ«äººåˆ†æ´¾çš„ä»»åŠ¡ï¼Œå®ç°ç‰¹å®šçš„ä¸šåŠ¡ç»†èŠ‚ã€‚</p><p>æ³¨æ„å½“ä½ æ˜¯ä¸€ä¸ªæ™®é€šç¨‹åºå‘˜çš„æ—¶å€™ï¼Œå›¢é˜Ÿè¦æ±‚ä½ å…·å¤‡ä¸€å®šçš„ä¸“é¡¹æŠ€æœ¯èƒ½åŠ›ï¼Œèƒ½å¤Ÿå®Œæˆä»»åŠ¡å³å¯ï¼Œä½ çš„è§’è‰²ï¼Œå°±æ‹¿æŠŠèºä¸åˆ€æ‹§èºä¸ï¼Œæ‹§å¥½èºä¸å°± Ok ã€‚</p><p>è¿™ä¸ªæ—¶å€™ï¼Œä½ å†…å¿ƒæ˜¯ç—›è‹¦çš„ï¼Œå¯¹ä¸åœåœ°å†™ä¸šåŠ¡ä»£ç æ˜¯æ‹’ç»çš„ï¼Œå› ä¸ºä½ è¦å†æ‰¾å·¥ä½œæ—¶ï¼Œåˆ«çš„ç»„ç»‡çœ‹é‡ä½ çš„ä¸“é¡¹æŠ€æœ¯èƒ½åŠ›ç”šäºä¸šåŠ¡èƒ½åŠ›ï¼ˆä»–ä»¬æœ‰äººåšä¸šåŠ¡æ‹†åˆ†ï¼Œä½ è¿‡å»äº†èƒ½æ‹§èºä¸å³å¯ï¼‰ï¼Œè€Œä½ åœ¨ç°æœ‰ç»„ç»‡ä¸­ï¼Œå´å› ä¸ºæ·±é™·ä¸šåŠ¡ä»£ç çš„ç¼–å†™è€Œæ— æ³•æŒç»­æ·¬ç‚¼ä½ çš„æŠ€èƒ½èƒ½åŠ›ã€‚</p><p>è€Œå¼€å‘ä¸­æ™®é€šç¨‹åºå‘˜æ˜¯å æ¯”æœ€å¤§çš„ï¼Œæ‰€ä»¥ç»å¸¸èƒ½çœ‹åˆ°æ–‡ç« æˆ–è€…æœ‰äººæé—®çº ç»“å†™ä¸šåŠ¡ä»£ç è¿™ä»¶äº‹ï¼</p><p>é‚£ä¹ˆï¼Œè¯¥å¦‚ä½•æ‰èƒ½è§£è„±å‘¢ï¼Ÿ</p><h3 id="ä»æ‰€è°“çš„ä¸šåŠ¡ä»£ç ä¸­è·³å‡º"><a href="#ä»æ‰€è°“çš„ä¸šåŠ¡ä»£ç ä¸­è·³å‡º" class="headerlink" title="ä»æ‰€è°“çš„ä¸šåŠ¡ä»£ç ä¸­è·³å‡º"></a>ä»æ‰€è°“çš„ä¸šåŠ¡ä»£ç ä¸­è·³å‡º</h3><p>é¦–å…ˆï¼Œå¾ˆé—æ†¾çš„å‘Šè¯‰å„ä½ï¼Œè¿™ä¸æ˜¯ä¸€è¹´è€Œå°±çš„ï¼Œæ˜¯ä¸€ä¸ªæŠ€æœ¯æ·±åº¦å’Œä¸šåŠ¡å±‚æ¬¡ç§¯ç´¯çš„è¿‡ç¨‹ï¼Œè¿™éœ€è¦æ—¶é—´ã€‚</p><p>ä½œä¸ºä¸€åæŠ€æœ¯äººå‘˜ï¼Œä¸€æ–¹é¢è¦è®¤è¯†åˆ°æŠ€æœ¯åªæ˜¯ç”¨æ¥è§£å†³ç‰¹å®šé—®é¢˜çš„å·¥å…·ï¼Œæ‰€ä»¥ä¸€å®šè¦ä»é—®é¢˜å‡ºå‘ï¼Œæå‡ºè§£å†³æ–¹æ¡ˆï¼Œè€Œä¸èƒ½ä¸€å‘³çš„è¿½æ±‚æŠ€æœ¯çš„å®Œç¾ã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œä¹Ÿè¦è®¤è¯†åˆ°æŠ€æœ¯æœ¬èº«ä¹Ÿå¯èƒ½æˆä¸ºä¸€é¡¹ä¸šåŠ¡ï¼Œåªè¦å®ƒè¶³å¤Ÿé€šç”¨ï¼Œèƒ½å¤Ÿç»™å…¶ä»–äººã€ç»„ç»‡æä¾›æœ‰ä»·å€¼çš„è§£å†³æ–¹æ¡ˆã€‚</p><p>ä½†æ˜¯ï¼Œå…¬å¸ä¸šåŠ¡ä»£ç å¤ªå¤šï¼Œæ€»æ˜¯ â€œæ²‰è¿·ä¸šåŠ¡æ— æ³•è‡ªæ‹”â€ï¼Œå¦‚ä½•æ›´å¥½çš„æå‡è‡ªå·±ï¼Œè®©è‡ªå·±å‘å…‰å‘äº®ï¼Œèƒ½å¤Ÿæä¾›æ›´å¤šæœ‰ä»·å€¼çš„ä¸œè¥¿ã€‚</p><p>ä¹Ÿçœ‹åˆ°å¾ˆå¤šæ–‡ç« è¯´çš„æ˜¯ï¼Œéœ€è¦è‡ªå·±æŒ¤å‡ºæ—¶é—´å‡ºæ¥è¿›è¡Œå­¦ä¹ ï¼Œä¹Ÿå°±æ˜¯åœ¨å·¥ä½œä¹‹ä½™è¿›è¡Œæå‡ï¼Œè‡ªå·±è®¤çœŸçš„æƒ³ä¸€æƒ³ï¼Œåœ¨ä¸šåŠ¡ä¸ŠçœŸçš„æ˜¯æ— æ³•æå‡è‡ªå·±å—ï¼Ÿ å½“æˆ‘ä»¬è½»æ¾ã€æ¼‚äº®çš„æå®šä¸šåŠ¡åï¼Œèƒ½ä¸èƒ½å†ä»ä¸‹é¢çš„æ–¹é¢å…¥æ‰‹è¿›è¡Œæ€è€ƒå‘¢ã€‚ ä¾‹å¦‚</p><ul><li>  ç†Ÿæ‚‰ä¸šåŠ¡ç›¸å…³çš„æ›´å¤šä¸šåŠ¡å’Œä»£ç ï¼Œä¸ç®¡ä¸šåŠ¡æ˜¯ä¸æ˜¯ä½ è´Ÿè´£çš„ï¼Œä¸ç®¡ä»£ç æ˜¯ä¸æ˜¯ä½ å†™çš„ï¼›è¿™æ ·çš„å¥½å¤„å¤ªå¤šï¼Œä¸åˆ—ä¸¾ï¼Œæœ‰å…´è¶£çš„å¯ä»¥æœç´¢</li><li>  è¿™ä¸ªä¸šåŠ¡æœ‰æ²¡æœ‰ä¼˜åŒ–çš„ç‚¹ï¼›</li><li>  é‡å¤ä»£ç å¤ªå¤šï¼Œæ˜¯ä¸æ˜¯å¯ä»¥è€ƒè™‘ä½¿ç”¨è®¾è®¡æ¨¡å¼è¿›è¡Œä¼˜åŒ–</li><li>  ç³»ç»Ÿä¸­ä¸šåŠ¡æ˜¯ä¸æ˜¯åºå¤§ï¼Œèƒ½ä¸èƒ½è¿›è¡Œè§£è€¦æˆå‡ ä¸ªæœåŠ¡æˆ–è€…æ¨¡å—</li><li>  å¼€æºæ¡†æ¶ä¸­çš„ä¸€äº›åŠŸèƒ½æ­£å¥½èƒ½å¤Ÿç”¨åˆ°ï¼Œå¯ä¸å¯ä»¥å¼•è¿›</li><li>  ä»£ç ä¸­æ€§èƒ½æœ‰æ²¡æœ‰éœ€è¦ä¼˜åŒ–çš„åœ°æ–¹</li><li>  åœ¨é«˜å¹¶å‘æƒ…å†µä¸‹ï¼Œæœ‰æ²¡æœ‰æ½œåœ¨ Bug</li><li>  èƒ½ä¸èƒ½ä½¿ç”¨ç¼“å­˜ï¼Œå‡å°‘æ•°æ®åº“å‹åŠ›ï¼Œå¢åŠ è®¿é—®æ€§èƒ½</li><li>  æ€è€ƒä¸€ä¸‹è¿™ä¸ªç³»ç»Ÿçš„æ¶æ„ï¼Œè¯¥ç³»ç»Ÿä½¿ç”¨äº†äº›ä»€ä¹ˆæŠ€æœ¯ï¼Œæˆ‘è¿˜æœ‰å“ªäº›ä¸çŸ¥é“çš„</li><li>  ç³»ç»Ÿä¸ºä»€ä¹ˆä½¿ç”¨è¿™ä¸ªæŠ€æœ¯ï¼Œä¸ºä»€ä¹ˆä½¿ç”¨è¿™ç§æ¶æ„</li><li>  ä¸‹æ¬¡ç±»ä¼¼çš„ä¸šåŠ¡ï¼Œæˆ‘èƒ½ä¸èƒ½æŠ½å‡ºç›¸å…³ä»£ç ï¼Œè¿›è¡Œå¤ç”¨ï¼Œæˆ–è€…ç›´æ¥å¼€å‘æˆæœåŠ¡ï¼Œæš´éœ²å‡ºæ¥</li><li>  â€¦ â€¦</li></ul><p>å¾ˆå¤šæ™®é€šç¨‹åºå‘˜å¤©å¤©æŠ±æ€¨è€å†™ä¸šåŠ¡ä»£ç æ²¡é•¿è¿›ï¼Œå¯æ‰‹ä¸Šçš„ä»»åŠ¡å´æ€»æ˜¯æ•·è¡äº†äº‹ï¼Œå®Œæˆå¾—å‡‘å‡‘åˆåˆï¼Œç”šè‡³è¿˜å‡ºç°é¢‘ç°çº¿ä¸Š Bugï¼Œé‚£æ˜¯å¾ˆéš¾æ‘†é‡å¤ç®€å•ä¸šåŠ¡ä»»åŠ¡çš„æ³¥æ²¼çš„ã€‚</p><h4 id="å¦‚ä½•è½»æ¾ã€æ¼‚äº®çš„æå®šä¸šåŠ¡"><a href="#å¦‚ä½•è½»æ¾ã€æ¼‚äº®çš„æå®šä¸šåŠ¡" class="headerlink" title="å¦‚ä½•è½»æ¾ã€æ¼‚äº®çš„æå®šä¸šåŠ¡"></a>å¦‚ä½•è½»æ¾ã€æ¼‚äº®çš„æå®šä¸šåŠ¡</h4><p>å¯ä»¥ä»è¿™å››æ–¹é¢è¿›è¡Œå…¥æ‰‹ï¼š</p><ol><li> åœ¨æ·±åº¦ï¼ˆç ”ç©¶é¢†åŸŸä¸­éå¸¸å…·æœ‰ä»£è¡¨æ€§çš„æŸå‡ ä¸ªæ¡†æ¶çš„åŸç†é“¾ï¼‰å’Œå¹¿åº¦ï¼ˆå¼€æºçš„æ¡†æ¶è¿™ä¹ˆå¤šï¼Œè‡³å°‘è¦è®¤è¯†å§ï¼‰ä¸¤ä¸ªæ–¹é¢æå‡æŠ€æœ¯èƒ½åŠ›ï¼ˆå¦‚æœå½“ä¸‹ä»»åŠ¡ç¹é‡ï¼Œå°±åˆ©ç”¨ä¸šä½™æ—¶é—´ç»ƒä¹ ï¼‰</li><li> æŠŠè‡ªå·±çš„åšçš„äº‹æƒ…æ”¾åœ¨å…¨å±€ç†è§£ï¼Œæå‡ä¸šåŠ¡ç†è§£èƒ½åŠ›</li><li> åŸ¹å…»å¥½çš„å·¥ä½œä¹ æƒ¯ï¼Œæ¯”å¦‚è®¡åˆ’ã€å›é¡¾ã€æ€»ç»“ç­‰</li><li> åšå¥½æ±‡æŠ¥å’Œå±•ç¤ºï¼Œè®©é¢†å¯¼çŸ¥é“ä½ çš„èƒ½åŠ›</li></ol><p>å½“ä½ æ…¢æ…¢åšäº†ä¸Šé¢ 4 ç‚¹ä¹‹åï¼Œæ¯æ¬¡æ‹¿åˆ°ä»»åŠ¡ï¼Œéƒ½èƒ½è½»æ¾åˆæ¼‚äº®åœ°æå®šï¼Œè¶…å‡ºé¢†å¯¼çš„é¢„æœŸï¼Œè¿˜æœ‰æœªå‘æŒ¥å®Œçš„ç«åŠ›ï¼Œé‚£å›¢é˜Ÿå°±ä¸€å®šä¼šç»™ä½ å¤æ‚ä¸€ç‚¹çš„ä»»åŠ¡ã€‚</p><p>å¦‚æœä½ è¿˜èƒ½è½»æ¾ã€æ¼‚äº®åœ°æå®šå¹¶ä¸”è¿˜æœ‰ä½™åŠ›ï¼Œé‚£å›¢é˜Ÿå°±ä¼šç»™ä½ å¤æ‚åº¦å†é«˜ä¸€äº›çš„ä»»åŠ¡ã€‚</p><p>å¾€å¤å¾ªç¯ï¼Œä½ å°±å¯ä»¥è·³å‡ºæœ€ç®€å•çš„ä¸šåŠ¡ä»£ç ç¼–å†™ï¼Œåšè¶Šæ¥è¶Šé‡è¦çš„äº‹æƒ…ï¼Œä½ çš„ä¸å¯æ›¿ä»£æ€§ä¹Ÿå˜å¾—è¶Šæ¥è¶Šå¼ºã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æ„Ÿæ‚Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å­¦ä¹ </tag>
      
      <tag>æ„Ÿæ‚Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>hexoéƒ¨ç½²åˆ°gitee</title>
    <link href="/blog/2020/12/27/hexo%E9%83%A8%E7%BD%B2%E5%88%B0gitee/"/>
    <url>/blog/2020/12/27/hexo%E9%83%A8%E7%BD%B2%E5%88%B0gitee/</url>
    
    <content type="html"><![CDATA[<p>å› ä¸ºæœåŠ¡å™¨å’ŒåŸŸåï¼Œå³å°†åˆ°æœŸï¼Œæ‰€ä»¥å‡†å¤‡å…³é—­è‡ªå»ºåšå®¢ï¼Œå°†åšå®¢è¿ç§»åˆ°ç äº‘ä¸Šï¼Œç”¨å…è´¹çš„åŸŸåå’Œå­˜å‚¨ã€‚</p><p>é¦–å…ˆé€‰æ‹©å“ªä¸ªgitå¹³å°ï¼Œæˆ‘å°è¯•äº†ä½¿ç”¨github pagesï¼Œä½†å¾ˆéš¾å—ï¼Œæˆ‘åªèƒ½åœ¨FAN QIANGçŠ¶æ€ä¸‹æ­£å¸¸è®¿é—®ï¼Œè€Œä¸”é€Ÿåº¦åæ…¢ï¼Œæ”¹äº†hostsä¹Ÿæ²¡å•¥ç”¨ï¼Œè€Œä¸”æ–‡ç« æ•°å¦‚æœå¤šäº†èµ·æ¥ï¼Œæ›´æ–°ç½‘ç«™çš„é€Ÿåº¦æ›´æ˜¯æ…¢å¾—ä¸è¡Œï¼Œæ‰€ä»¥è¿˜æ˜¯é€‰æ‹©å›½å†…çš„ä¸€äº›gitå¹³å°æ¯”è¾ƒå¥½ï¼Œæ¯”å¦‚ç äº‘(gitee)ï¼ŒCodingç­‰ã€‚</p><p>ç„¶åæ˜¯åšå®¢ç³»ç»Ÿçš„é€‰æ‹©ï¼Œæˆ‘é¦–å…ˆå°è¯•çš„æ˜¯Grideaï¼Œç•Œé¢å¯ä»¥ï¼ŒæŒºå¥½çœ‹çš„ï¼Œä½†å°±æ˜¯åªæ”¯æŒgithub pageså’Œcoding pagesï¼Œè¿˜æœ‰ä¸ªäººæœåŠ¡å™¨æ­å»ºã€‚github pagesä¸ç”¨è¯´ï¼Œé€Ÿåº¦æ…¢ï¼Œæˆ‘å¤±è´¥äº†æ— æ•°æ¬¡ã€‚codingæˆ‘ä¹Ÿè¯•äº†å¾ˆå¤šæ¬¡ï¼Œå®åœ¨æ˜¯æ‰¾ä¸å‡ºé—®é¢˜æ‰€åœ¨(åŸºæœ¬éƒ½æ˜¯è¿ä¸ä¸Šçš„é—®é¢˜ï¼Œæ²¡æ³•è§£å†³)ã€‚å¦‚æœæƒ³å°è¯•çš„å°ä¼™ä¼´å¯ä»¥å»å®˜ç½‘çœ‹çœ‹<a href="https://links.jianshu.com/go?to=https://gridea.dev/">https://gridea.dev/</a>ï¼Œä¸Šé¢æœ‰æ­å»ºæ–¹æ³•ã€‚</p><p>è¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯hexo+giteeã€‚</p><h1 id="ç¯å¢ƒé…ç½®"><a href="#ç¯å¢ƒé…ç½®" class="headerlink" title="ç¯å¢ƒé…ç½®"></a>ç¯å¢ƒé…ç½®</h1><p>é¦–å…ˆè¦ä¸‹è½½<a href="https://links.jianshu.com/go?to=http://nodejs.cn/">Node.js</a>ï¼Œç„¶åå®‰è£…<a href="https://links.jianshu.com/go?to=https://git-scm.com/downloads">Git</a>ï¼Œæ¥ç€æ³¨å†Œ<a href="https://links.jianshu.com/go?to=https://gitee.com/">ç äº‘</a>ï¼Œæœ€åå®‰è£…Hexoï¼ŒHexoå®‰è£…å‘½ä»¤è¡Œ(cmd æˆ– gitbash):</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs undefined">npm install hexo-cli -g<br></code></pre></td></tr></table></figure><p>é€Ÿåº¦æ…¢å¯ä»¥å…ˆæ”¹ä¸€ä¸‹å®‰è£…æº:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">npm config <span class="hljs-built_in">set</span> registry https:<span class="hljs-comment">//registry.npm.taobao.org</span><br></code></pre></td></tr></table></figure><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/image-20201227123923753.png" alt="image-20201227123923753"></p><p>å¦‚æœé‡åˆ°ä¸Šé¢çš„æƒ…å†µï¼Œå°±éœ€è¦è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼Œä¸€èˆ¬åœ¨macæ‰ä¼šé‡åˆ°è¿™ç§ã€‚</p><p>1ã€vim ~/.bash_profile ç¼–è¾‘æ–‡ä»¶ã€‚</p><p>2ã€åœ¨æœ€åè¿½åŠ ä¸‹é¢ä¸‰è¡Œä»£ç ã€‚</p><p>alias ll=â€˜ls -alFâ€™</p><p>alias la=â€˜ls -Aâ€™</p><p>alias l=â€˜ls -CFâ€™</p><p>3ã€åˆ·æ–°é…ç½®æ–‡ä»¶ï¼Œsource ~/.bash_profile ã€‚</p><p>åé¢å¦‚æœè¿˜é‡åˆ°ï¼Œç›´æ¥åˆ·æ–°é…ç½®æ–‡ä»¶å³å¯ï¼Œå’Œmavenåœ¨macæ‰€é‡åˆ°çš„é—®é¢˜ä¸€æ ·ï¼Œè¿˜æœªæ‰¾åˆ°è§£å†³æ–¹æ¡ˆã€‚</p><p>åœ¨æƒ³è¦å­˜æ”¾åšå®¢çš„ç›®å½•é‡Œå³é”®æ‰“å¼€æ§åˆ¶å°ï¼Œç„¶åè¾“å…¥ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">hexo <span class="hljs-keyword">init</span><br></code></pre></td></tr></table></figure><p>æ¥ç€ç”Ÿæˆé™æ€é¡µé¢ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs undefined">hexo g<br></code></pre></td></tr></table></figure><p>ç„¶åå¯åŠ¨æœ¬åœ°æœåŠ¡ï¼ŒæŸ¥çœ‹ç•Œé¢æ˜¯å¦ç”Ÿæˆï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs undefined">hexo s<br></code></pre></td></tr></table></figure><p>å°†<code>http://localhost:4000</code>å¤åˆ¶åˆ°æµè§ˆå™¨æŸ¥çœ‹ï¼Œé»˜è®¤ä¸»é¢˜ä¸º<code>landscape</code>ã€‚(åœ¨ä¸‹é¢çš„æ¯æ¬¡é…ç½®ä¸­ï¼Œå¯¹æ ¹ç›®å½•çš„<code>_config.yml</code>ä¿®æ”¹åéƒ½è¦é‡æ–°æ‰§è¡Œ<code>hexo g</code>ï¼ŒåŒæ—¶å¯ä»¥ä¸æ–­åˆ·æ–°æœ¬åœ°æœåŠ¡æŸ¥çœ‹æ•ˆæœ)</p><h1 id="ä¸»é¢˜"><a href="#ä¸»é¢˜" class="headerlink" title="ä¸»é¢˜"></a>ä¸»é¢˜</h1><p>è¿™é‡Œæˆ‘é€‰çš„è¿™ä¸€æ¬¾ä¸»é¢˜ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å»å®˜ç½‘é€‰æ‹©ï¼Œé…ç½®æ–¹æ³•éƒ½å·®ä¸å¤šã€‚<a href="https://hexo.fluid-dev.com/docs/">https://hexo.fluid-dev.com/docs/</a>  è¿™é‡Œæˆ‘ç”¨çš„ç¬¬äºŒç§éƒ¨ç½²æ–¹å¼ã€‚</p><h1 id="å†™æ–‡ç« "><a href="#å†™æ–‡ç« " class="headerlink" title="å†™æ–‡ç« "></a>å†™æ–‡ç« </h1><p>åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">hexo <span class="hljs-keyword">new</span> <span class="hljs-string">&quot;æµ‹è¯•&#x27;æ–°å¢æ–‡ç« &quot;</span><br></code></pre></td></tr></table></figure><p>ç¼–å†™å°±è‡ªå·±ç”¨æœ¬åœ°ç¼–è¾‘å™¨ï¼Œæ‰“å¼€å³å¯ã€‚</p><h1 id="é…ç½®ç äº‘"><a href="#é…ç½®ç äº‘" class="headerlink" title="é…ç½®ç äº‘"></a>é…ç½®ç äº‘</h1><p>æ‰“å¼€æ ¹ç›®å½• _config.yml</p><p>1ã€ä¿®æ”¹è¯­è¨€ï¼Œlanguage: zh-CNã€‚</p><p>2ã€ä¿®æ”¹éƒ¨ç½²åˆ°ç äº‘çš„è®¿é—®åœ°å€ï¼Œ</p><p><img src="https://gitee.com/cuixiaoyan/uPic/raw/master/uPic/image-20201227125538853.png" alt="image-20201227125538853"></p><p>url: <a href="https://gitee.com/cuixiaoyan/blog/">https://gitee.com/cuixiaoyan/blog/</a><br>root: /blog/</p><p>3ã€ç äº‘ä»“åº“åœ°å€ï¼Œ</p><p>deploy:<br>  type: git<br>  repo: <a href="https://gitee.com/cuixiaoyan/blog.git">https://gitee.com/cuixiaoyan/blog.git</a><br>  branch: master</p><p>4ã€æäº¤æ­¥éª¤ã€‚</p><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs excel">hexo <span class="hljs-built_in">clean</span><br>hexo g<br>hexo d<br>ç„¶ååˆ·æ–°ä¸Šæ–¹ï¼Œgitee pages æ‰è¡Œï¼Œæ³¨æ„ï¼Œä»“åº“çš„åœ°å€ï¼Œå’Œæ–‡ç« çš„è·¯å¾„æ˜¯ä¸åŒçš„ã€‚<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>éƒ¨ç½²</tag>
      
      <tag>åšå®¢</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
